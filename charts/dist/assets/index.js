var gR=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var MK=gR((li,ci)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();/**
* @vue/shared v3.4.35
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Nv(n,e){const t=new Set(n.split(","));return r=>t.has(r)}const Dn={},oc=[],Ci=()=>{},vR=()=>!1,kp=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),zv=n=>n.startsWith("onUpdate:"),nr=Object.assign,Uv=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},bR=Object.prototype.hasOwnProperty,en=(n,e)=>bR.call(n,e),Ot=Array.isArray,sc=n=>Bp(n)==="[object Map]",VC=n=>Bp(n)==="[object Set]",Ht=n=>typeof n=="function",jn=n=>typeof n=="string",Qs=n=>typeof n=="symbol",_n=n=>n!==null&&typeof n=="object",GC=n=>(_n(n)||Ht(n))&&Ht(n.then)&&Ht(n.catch),WC=Object.prototype.toString,Bp=n=>WC.call(n),yR=n=>Bp(n).slice(8,-1),jC=n=>Bp(n)==="[object Object]",$v=n=>jn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Lu=Nv(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Np=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},_R=/-(\w)/g,Ka=Np(n=>n.replace(_R,(e,t)=>t?t.toUpperCase():"")),xR=/\B([A-Z])/g,ll=Np(n=>n.replace(xR,"-$1").toLowerCase()),qC=Np(n=>n.charAt(0).toUpperCase()+n.slice(1)),Lm=Np(n=>n?`on${qC(n)}`:""),Gs=(n,e)=>!Object.is(n,e),Fm=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},XC=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},wR=n=>{const e=parseFloat(n);return isNaN(e)?n:e},SR=n=>{const e=jn(n)?Number(n):NaN;return isNaN(e)?n:e};let xy;const YC=()=>xy||(xy=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Hv(n){if(Ot(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],i=jn(r)?TR(r):Hv(r);if(i)for(const o in i)e[o]=i[o]}return e}else if(jn(n)||_n(n))return n}const CR=/;(?![^(]*\))/g,AR=/:([^]+)/,MR=/\/\*[^]*?\*\//g;function TR(n){const e={};return n.replace(MR,"").split(CR).forEach(t=>{if(t){const r=t.split(AR);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function zp(n){let e="";if(jn(n))e=n;else if(Ot(n))for(let t=0;t<n.length;t++){const r=zp(n[t]);r&&(e+=r+" ")}else if(_n(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const ER="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",PR=Nv(ER);function KC(n){return!!n||n===""}const ZC=n=>!!(n&&n.__v_isRef===!0),ac=n=>jn(n)?n:n==null?"":Ot(n)||_n(n)&&(n.toString===WC||!Ht(n.toString))?ZC(n)?ac(n.value):JSON.stringify(n,JC,2):String(n),JC=(n,e)=>ZC(e)?JC(n,e.value):sc(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,i],o)=>(t[Om(r,o)+" =>"]=i,t),{})}:VC(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Om(t))}:Qs(e)?Om(e):_n(e)&&!Ot(e)&&!jC(e)?String(e):e,Om=(n,e="")=>{var t;return Qs(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.4.35
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let zi;class RR{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=zi,!e&&zi&&(this.index=(zi.scopes||(zi.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const t=zi;try{return zi=this,e()}finally{zi=t}}}on(){zi=this}off(){zi=this.parent}stop(e){if(this._active){let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.scopes)for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);if(!this.detached&&this.parent&&!e){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.parent=void 0,this._active=!1}}}function IR(n,e=zi){e&&e.active&&e.effects.push(n)}function DR(){return zi}let za;class Vv{constructor(e,t,r,i){this.fn=e,this.trigger=t,this.scheduler=r,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,IR(this,i)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,ea();for(let e=0;e<this._depsLength;e++){const t=this.deps[e];if(t.computed&&(LR(t.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),ta()}return this._dirtyLevel>=4}set dirty(e){this._dirtyLevel=e?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let e=Bs,t=za;try{return Bs=!0,za=this,this._runnings++,wy(this),this.fn()}finally{Sy(this),this._runnings--,za=t,Bs=e}}stop(){this.active&&(wy(this),Sy(this),this.onStop&&this.onStop(),this.active=!1)}}function LR(n){return n.value}function wy(n){n._trackId++,n._depsLength=0}function Sy(n){if(n.deps.length>n._depsLength){for(let e=n._depsLength;e<n.deps.length;e++)QC(n.deps[e],n);n.deps.length=n._depsLength}}function QC(n,e){const t=n.get(e);t!==void 0&&e._trackId!==t&&(n.delete(e),n.size===0&&n.cleanup())}let Bs=!0,o1=0;const eA=[];function ea(){eA.push(Bs),Bs=!1}function ta(){const n=eA.pop();Bs=n===void 0?!0:n}function Gv(){o1++}function Wv(){for(o1--;!o1&&s1.length;)s1.shift()()}function tA(n,e,t){if(e.get(n)!==n._trackId){e.set(n,n._trackId);const r=n.deps[n._depsLength];r!==e?(r&&QC(r,n),n.deps[n._depsLength++]=e):n._depsLength++}}const s1=[];function nA(n,e,t){Gv();for(const r of n.keys()){let i;r._dirtyLevel<e&&(i??(i=n.get(r)===r._trackId))&&(r._shouldSchedule||(r._shouldSchedule=r._dirtyLevel===0),r._dirtyLevel=e),r._shouldSchedule&&(i??(i=n.get(r)===r._trackId))&&(r.trigger(),(!r._runnings||r.allowRecurse)&&r._dirtyLevel!==2&&(r._shouldSchedule=!1,r.scheduler&&s1.push(r.scheduler)))}Wv()}const rA=(n,e)=>{const t=new Map;return t.cleanup=n,t.computed=e,t},Uf=new WeakMap,Ua=Symbol(""),a1=Symbol("");function Jr(n,e,t){if(Bs&&za){let r=Uf.get(n);r||Uf.set(n,r=new Map);let i=r.get(t);i||r.set(t,i=rA(()=>r.delete(t))),tA(za,i)}}function Ko(n,e,t,r,i,o){const s=Uf.get(n);if(!s)return;let a=[];if(e==="clear")a=[...s.values()];else if(t==="length"&&Ot(n)){const l=Number(r);s.forEach((c,u)=>{(u==="length"||!Qs(u)&&u>=l)&&a.push(c)})}else switch(t!==void 0&&a.push(s.get(t)),e){case"add":Ot(n)?$v(t)&&a.push(s.get("length")):(a.push(s.get(Ua)),sc(n)&&a.push(s.get(a1)));break;case"delete":Ot(n)||(a.push(s.get(Ua)),sc(n)&&a.push(s.get(a1)));break;case"set":sc(n)&&a.push(s.get(Ua));break}Gv();for(const l of a)l&&nA(l,4);Wv()}function FR(n,e){const t=Uf.get(n);return t&&t.get(e)}const OR=Nv("__proto__,__v_isRef,__isVue"),iA=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Qs)),Cy=kR();function kR(){const n={};return["includes","indexOf","lastIndexOf"].forEach(e=>{n[e]=function(...t){const r=tn(this);for(let o=0,s=this.length;o<s;o++)Jr(r,"get",o+"");const i=r[e](...t);return i===-1||i===!1?r[e](...t.map(tn)):i}}),["push","pop","shift","unshift","splice"].forEach(e=>{n[e]=function(...t){ea(),Gv();const r=tn(this)[e].apply(this,t);return Wv(),ta(),r}}),n}function BR(n){Qs(n)||(n=String(n));const e=tn(this);return Jr(e,"has",n),e.hasOwnProperty(n)}class oA{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){const i=this._isReadonly,o=this._isShallow;if(t==="__v_isReactive")return!i;if(t==="__v_isReadonly")return i;if(t==="__v_isShallow")return o;if(t==="__v_raw")return r===(i?o?KR:cA:o?lA:aA).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const s=Ot(e);if(!i){if(s&&en(Cy,t))return Reflect.get(Cy,t,r);if(t==="hasOwnProperty")return BR}const a=Reflect.get(e,t,r);return(Qs(t)?iA.has(t):OR(t))||(i||Jr(e,"get",t),o)?a:Tr(a)?s&&$v(t)?a:a.value:_n(a)?i?ed(a):Xv(a):a}}class sA extends oA{constructor(e=!1){super(!1,e)}set(e,t,r,i){let o=e[t];if(!this._isShallow){const l=Za(o);if(!bc(r)&&!Za(r)&&(o=tn(o),r=tn(r)),!Ot(e)&&Tr(o)&&!Tr(r))return l?!1:(o.value=r,!0)}const s=Ot(e)&&$v(t)?Number(t)<e.length:en(e,t),a=Reflect.set(e,t,r,i);return e===tn(i)&&(s?Gs(r,o)&&Ko(e,"set",t,r):Ko(e,"add",t,r)),a}deleteProperty(e,t){const r=en(e,t);e[t];const i=Reflect.deleteProperty(e,t);return i&&r&&Ko(e,"delete",t,void 0),i}has(e,t){const r=Reflect.has(e,t);return(!Qs(t)||!iA.has(t))&&Jr(e,"has",t),r}ownKeys(e){return Jr(e,"iterate",Ot(e)?"length":Ua),Reflect.ownKeys(e)}}class NR extends oA{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const zR=new sA,UR=new NR,$R=new sA(!0),jv=n=>n,Up=n=>Reflect.getPrototypeOf(n);function Xd(n,e,t=!1,r=!1){n=n.__v_raw;const i=tn(n),o=tn(e);t||(Gs(e,o)&&Jr(i,"get",e),Jr(i,"get",o));const{has:s}=Up(i),a=r?jv:t?Kv:td;if(s.call(i,e))return a(n.get(e));if(s.call(i,o))return a(n.get(o));n!==i&&n.get(e)}function Yd(n,e=!1){const t=this.__v_raw,r=tn(t),i=tn(n);return e||(Gs(n,i)&&Jr(r,"has",n),Jr(r,"has",i)),n===i?t.has(n):t.has(n)||t.has(i)}function Kd(n,e=!1){return n=n.__v_raw,!e&&Jr(tn(n),"iterate",Ua),Reflect.get(n,"size",n)}function Ay(n,e=!1){!e&&!bc(n)&&!Za(n)&&(n=tn(n));const t=tn(this);return Up(t).has.call(t,n)||(t.add(n),Ko(t,"add",n,n)),this}function My(n,e,t=!1){!t&&!bc(e)&&!Za(e)&&(e=tn(e));const r=tn(this),{has:i,get:o}=Up(r);let s=i.call(r,n);s||(n=tn(n),s=i.call(r,n));const a=o.call(r,n);return r.set(n,e),s?Gs(e,a)&&Ko(r,"set",n,e):Ko(r,"add",n,e),this}function Ty(n){const e=tn(this),{has:t,get:r}=Up(e);let i=t.call(e,n);i||(n=tn(n),i=t.call(e,n)),r&&r.call(e,n);const o=e.delete(n);return i&&Ko(e,"delete",n,void 0),o}function Ey(){const n=tn(this),e=n.size!==0,t=n.clear();return e&&Ko(n,"clear",void 0,void 0),t}function Zd(n,e){return function(r,i){const o=this,s=o.__v_raw,a=tn(s),l=e?jv:n?Kv:td;return!n&&Jr(a,"iterate",Ua),s.forEach((c,u)=>r.call(i,l(c),l(u),o))}}function Jd(n,e,t){return function(...r){const i=this.__v_raw,o=tn(i),s=sc(o),a=n==="entries"||n===Symbol.iterator&&s,l=n==="keys"&&s,c=i[n](...r),u=t?jv:e?Kv:td;return!e&&Jr(o,"iterate",l?a1:Ua),{next(){const{value:d,done:h}=c.next();return h?{value:d,done:h}:{value:a?[u(d[0]),u(d[1])]:u(d),done:h}},[Symbol.iterator](){return this}}}}function hs(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function HR(){const n={get(o){return Xd(this,o)},get size(){return Kd(this)},has:Yd,add:Ay,set:My,delete:Ty,clear:Ey,forEach:Zd(!1,!1)},e={get(o){return Xd(this,o,!1,!0)},get size(){return Kd(this)},has:Yd,add(o){return Ay.call(this,o,!0)},set(o,s){return My.call(this,o,s,!0)},delete:Ty,clear:Ey,forEach:Zd(!1,!0)},t={get(o){return Xd(this,o,!0)},get size(){return Kd(this,!0)},has(o){return Yd.call(this,o,!0)},add:hs("add"),set:hs("set"),delete:hs("delete"),clear:hs("clear"),forEach:Zd(!0,!1)},r={get(o){return Xd(this,o,!0,!0)},get size(){return Kd(this,!0)},has(o){return Yd.call(this,o,!0)},add:hs("add"),set:hs("set"),delete:hs("delete"),clear:hs("clear"),forEach:Zd(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(o=>{n[o]=Jd(o,!1,!1),t[o]=Jd(o,!0,!1),e[o]=Jd(o,!1,!0),r[o]=Jd(o,!0,!0)}),[n,t,e,r]}const[VR,GR,WR,jR]=HR();function qv(n,e){const t=e?n?jR:WR:n?GR:VR;return(r,i,o)=>i==="__v_isReactive"?!n:i==="__v_isReadonly"?n:i==="__v_raw"?r:Reflect.get(en(t,i)&&i in r?t:r,i,o)}const qR={get:qv(!1,!1)},XR={get:qv(!1,!0)},YR={get:qv(!0,!1)},aA=new WeakMap,lA=new WeakMap,cA=new WeakMap,KR=new WeakMap;function ZR(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function JR(n){return n.__v_skip||!Object.isExtensible(n)?0:ZR(yR(n))}function Xv(n){return Za(n)?n:Yv(n,!1,zR,qR,aA)}function QR(n){return Yv(n,!1,$R,XR,lA)}function ed(n){return Yv(n,!0,UR,YR,cA)}function Yv(n,e,t,r,i){if(!_n(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const o=i.get(n);if(o)return o;const s=JR(n);if(s===0)return n;const a=new Proxy(n,s===2?r:t);return i.set(n,a),a}function Fu(n){return Za(n)?Fu(n.__v_raw):!!(n&&n.__v_isReactive)}function Za(n){return!!(n&&n.__v_isReadonly)}function bc(n){return!!(n&&n.__v_isShallow)}function uA(n){return n?!!n.__v_raw:!1}function tn(n){const e=n&&n.__v_raw;return e?tn(e):n}function e3(n){return Object.isExtensible(n)&&XC(n,"__v_skip",!0),n}const td=n=>_n(n)?Xv(n):n,Kv=n=>_n(n)?ed(n):n;class dA{constructor(e,t,r,i){this.getter=e,this._setter=t,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Vv(()=>e(this._value),()=>bf(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=r}get value(){const e=tn(this);return(!e._cacheable||e.effect.dirty)&&Gs(e._value,e._value=e.effect.run())&&bf(e,4),hA(e),e.effect._dirtyLevel>=2&&bf(e,2),e._value}set value(e){this._setter(e)}get _dirty(){return this.effect.dirty}set _dirty(e){this.effect.dirty=e}}function t3(n,e,t=!1){let r,i;const o=Ht(n);return o?(r=n,i=Ci):(r=n.get,i=n.set),new dA(r,i,o||!i,t)}function hA(n){var e;Bs&&za&&(n=tn(n),tA(za,(e=n.dep)!=null?e:n.dep=rA(()=>n.dep=void 0,n instanceof dA?n:void 0)))}function bf(n,e=4,t,r){n=tn(n);const i=n.dep;i&&nA(i,e)}function Tr(n){return!!(n&&n.__v_isRef===!0)}function Je(n){return fA(n,!1)}function n3(n){return fA(n,!0)}function fA(n,e){return Tr(n)?n:new r3(n,e)}class r3{constructor(e,t){this.__v_isShallow=t,this.dep=void 0,this.__v_isRef=!0,this._rawValue=t?e:tn(e),this._value=t?e:td(e)}get value(){return hA(this),this._value}set value(e){const t=this.__v_isShallow||bc(e)||Za(e);e=t?e:tn(e),Gs(e,this._rawValue)&&(this._rawValue,this._rawValue=e,this._value=t?e:td(e),bf(this,4))}}function hr(n){return Tr(n)?n.value:n}const i3={get:(n,e,t)=>hr(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const i=n[e];return Tr(i)&&!Tr(t)?(i.value=t,!0):Reflect.set(n,e,t,r)}};function pA(n){return Fu(n)?n:new Proxy(n,i3)}class o3{constructor(e,t,r){this._object=e,this._key=t,this._defaultValue=r,this.__v_isRef=!0}get value(){const e=this._object[this._key];return e===void 0?this._defaultValue:e}set value(e){this._object[this._key]=e}get dep(){return FR(tn(this._object),this._key)}}class s3{constructor(e){this._getter=e,this.__v_isRef=!0,this.__v_isReadonly=!0}get value(){return this._getter()}}function Jt(n,e,t){return Tr(n)?n:Ht(n)?new s3(n):_n(n)&&arguments.length>1?a3(n,e,t):Je(n)}function a3(n,e,t){const r=n[e];return Tr(r)?r:new o3(n,e,t)}/**
* @vue/runtime-core v3.4.35
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ns(n,e,t,r){try{return r?n(...r):n()}catch(i){$p(i,e,t)}}function Ai(n,e,t,r){if(Ht(n)){const i=Ns(n,e,t,r);return i&&GC(i)&&i.catch(o=>{$p(o,e,t)}),i}if(Ot(n)){const i=[];for(let o=0;o<n.length;o++)i.push(Ai(n[o],e,t,r));return i}}function $p(n,e,t,r=!0){const i=e?e.vnode:null;if(e){let o=e.parent;const s=e.proxy,a=`https://vuejs.org/error-reference/#runtime-${t}`;for(;o;){const c=o.ec;if(c){for(let u=0;u<c.length;u++)if(c[u](n,s,a)===!1)return}o=o.parent}const l=e.appContext.config.errorHandler;if(l){ea(),Ns(l,null,10,[n,s,a]),ta();return}}l3(n,t,i,r)}function l3(n,e,t,r=!0){console.error(n)}let nd=!1,l1=!1;const Ar=[];let mo=0;const lc=[];let Ts=null,Ra=0;const mA=Promise.resolve();let Zv=null;function ui(n){const e=Zv||mA;return n?e.then(this?n.bind(this):n):e}function c3(n){let e=mo+1,t=Ar.length;for(;e<t;){const r=e+t>>>1,i=Ar[r],o=rd(i);o<n||o===n&&i.pre?e=r+1:t=r}return e}function Jv(n){(!Ar.length||!Ar.includes(n,nd&&n.allowRecurse?mo+1:mo))&&(n.id==null?Ar.push(n):Ar.splice(c3(n.id),0,n),gA())}function gA(){!nd&&!l1&&(l1=!0,Zv=mA.then(bA))}function u3(n){const e=Ar.indexOf(n);e>mo&&Ar.splice(e,1)}function d3(n){Ot(n)?lc.push(...n):(!Ts||!Ts.includes(n,n.allowRecurse?Ra+1:Ra))&&lc.push(n),gA()}function Py(n,e,t=nd?mo+1:0){for(;t<Ar.length;t++){const r=Ar[t];if(r&&r.pre){if(n&&r.id!==n.uid)continue;Ar.splice(t,1),t--,r()}}}function vA(n){if(lc.length){const e=[...new Set(lc)].sort((t,r)=>rd(t)-rd(r));if(lc.length=0,Ts){Ts.push(...e);return}for(Ts=e,Ra=0;Ra<Ts.length;Ra++){const t=Ts[Ra];t.active!==!1&&t()}Ts=null,Ra=0}}const rd=n=>n.id==null?1/0:n.id,h3=(n,e)=>{const t=rd(n)-rd(e);if(t===0){if(n.pre&&!e.pre)return-1;if(e.pre&&!n.pre)return 1}return t};function bA(n){l1=!1,nd=!0,Ar.sort(h3);try{for(mo=0;mo<Ar.length;mo++){const e=Ar[mo];e&&e.active!==!1&&Ns(e,e.i,e.i?15:14)}}finally{mo=0,Ar.length=0,vA(),nd=!1,Zv=null,(Ar.length||lc.length)&&bA()}}let gr=null,yA=null;function $f(n){const e=gr;return gr=n,yA=n&&n.type.__scopeId||null,e}function bo(n,e=gr,t){if(!e||n._n)return n;const r=(...i)=>{r._d&&Uy(-1);const o=$f(e);let s;try{s=n(...i)}finally{$f(o),r._d&&Uy(1)}return s};return r._n=!0,r._c=!0,r._d=!0,r}function Ic(n,e){if(gr===null)return n;const t=qp(gr),r=n.dirs||(n.dirs=[]);for(let i=0;i<e.length;i++){let[o,s,a,l=Dn]=e[i];o&&(Ht(o)&&(o={mounted:o,updated:o}),o.deep&&Ls(s),r.push({dir:o,instance:t,value:s,oldValue:void 0,arg:a,modifiers:l}))}return n}function ma(n,e,t,r){const i=n.dirs,o=e&&e.dirs;for(let s=0;s<i.length;s++){const a=i[s];o&&(a.oldValue=o[s].value);let l=a.dir[r];l&&(ea(),Ai(l,t,8,[n.el,a,n,e]),ta())}}const Es=Symbol("_leaveCb"),Qd=Symbol("_enterCb");function _A(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Er(()=>{n.isMounted=!0}),Nr(()=>{n.isUnmounting=!0}),n}const mi=[Function,Array],xA={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:mi,onEnter:mi,onAfterEnter:mi,onEnterCancelled:mi,onBeforeLeave:mi,onLeave:mi,onAfterLeave:mi,onLeaveCancelled:mi,onBeforeAppear:mi,onAppear:mi,onAfterAppear:mi,onAppearCancelled:mi},wA=n=>{const e=n.subTree;return e.component?wA(e.component):e},f3={name:"BaseTransition",props:xA,setup(n,{slots:e}){const t=Td(),r=_A();return()=>{const i=e.default&&Qv(e.default(),!0);if(!i||!i.length)return;let o=i[0];if(i.length>1){for(const h of i)if(h.type!==mr){o=h;break}}const s=tn(n),{mode:a}=s;if(r.isLeaving)return km(o);const l=Ry(o);if(!l)return km(o);let c=id(l,s,r,t,h=>c=h);yc(l,c);const u=t.subTree,d=u&&Ry(u);if(d&&d.type!==mr&&!Ia(l,d)&&wA(t).type!==mr){const h=id(d,s,r,t);if(yc(d,h),a==="out-in"&&l.type!==mr)return r.isLeaving=!0,h.afterLeave=()=>{r.isLeaving=!1,t.update.active!==!1&&(t.effect.dirty=!0,t.update())},km(o);a==="in-out"&&l.type!==mr&&(h.delayLeave=(m,f,v)=>{const g=SA(r,d);g[String(d.key)]=d,m[Es]=()=>{f(),m[Es]=void 0,delete c.delayedLeave},c.delayedLeave=v})}return o}}},p3=f3;function SA(n,e){const{leavingVNodes:t}=n;let r=t.get(e.type);return r||(r=Object.create(null),t.set(e.type,r)),r}function id(n,e,t,r,i){const{appear:o,mode:s,persisted:a=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:u,onEnterCancelled:d,onBeforeLeave:h,onLeave:m,onAfterLeave:f,onLeaveCancelled:v,onBeforeAppear:g,onAppear:b,onAfterAppear:S,onAppearCancelled:p}=e,y=String(n.key),w=SA(t,n),x=(C,T)=>{C&&Ai(C,r,9,T)},_=(C,T)=>{const I=T[1];x(C,T),Ot(C)?C.every(M=>M.length<=1)&&I():C.length<=1&&I()},A={mode:s,persisted:a,beforeEnter(C){let T=l;if(!t.isMounted)if(o)T=g||l;else return;C[Es]&&C[Es](!0);const I=w[y];I&&Ia(n,I)&&I.el[Es]&&I.el[Es](),x(T,[C])},enter(C){let T=c,I=u,M=d;if(!t.isMounted)if(o)T=b||c,I=S||u,M=p||d;else return;let P=!1;const E=C[Qd]=R=>{P||(P=!0,R?x(M,[C]):x(I,[C]),A.delayedLeave&&A.delayedLeave(),C[Qd]=void 0)};T?_(T,[C,E]):E()},leave(C,T){const I=String(n.key);if(C[Qd]&&C[Qd](!0),t.isUnmounting)return T();x(h,[C]);let M=!1;const P=C[Es]=E=>{M||(M=!0,T(),E?x(v,[C]):x(f,[C]),C[Es]=void 0,w[I]===n&&delete w[I])};w[I]=n,m?_(m,[C,P]):P()},clone(C){const T=id(C,e,t,r,i);return i&&i(T),T}};return A}function km(n){if(Hp(n))return n=es(n),n.children=null,n}function Ry(n){if(!Hp(n))return n;const{shapeFlag:e,children:t}=n;if(t){if(e&16)return t[0];if(e&32&&Ht(t.default))return t.default()}}function yc(n,e){n.shapeFlag&6&&n.component?yc(n.component.subTree,e):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function Qv(n,e=!1,t){let r=[],i=0;for(let o=0;o<n.length;o++){let s=n[o];const a=t==null?s.key:String(t)+String(s.key!=null?s.key:o);s.type===$n?(s.patchFlag&128&&i++,r=r.concat(Qv(s.children,e,a))):(e||s.type!==mr)&&r.push(a!=null?es(s,{key:a}):s)}if(i>1)for(let o=0;o<r.length;o++)r[o].patchFlag=-2;return r}/*! #__NO_SIDE_EFFECTS__ */function Vt(n,e){return Ht(n)?nr({name:n.name},e,{setup:n}):n}const Ou=n=>!!n.type.__asyncLoader,Hp=n=>n.type.__isKeepAlive;function eb(n,e){CA(n,"a",e)}function tb(n,e){CA(n,"da",e)}function CA(n,e,t=Mr){const r=n.__wdc||(n.__wdc=()=>{let i=t;for(;i;){if(i.isDeactivated)return;i=i.parent}return n()});if(Vp(e,r,t),t){let i=t.parent;for(;i&&i.parent;)Hp(i.parent.vnode)&&m3(r,e,t,i),i=i.parent}}function m3(n,e,t,r){const i=Vp(e,n,r,!0);TA(()=>{Uv(r[e],i)},t)}function Vp(n,e,t=Mr,r=!1){if(t){const i=t[n]||(t[n]=[]),o=e.__weh||(e.__weh=(...s)=>{ea();const a=Ed(t),l=Ai(e,t,n,s);return a(),ta(),l});return r?i.unshift(o):i.push(o),o}}const ss=n=>(e,t=Mr)=>{(!jp||n==="sp")&&Vp(n,(...r)=>e(...r),t)},Gp=ss("bm"),Er=ss("m"),AA=ss("bu"),MA=ss("u"),Nr=ss("bum"),TA=ss("um"),g3=ss("sp"),v3=ss("rtg"),b3=ss("rtc");function y3(n,e=Mr){Vp("ec",n,e)}const _3=Symbol.for("v-ndc");function x3(n,e,t,r){let i;const o=t;if(Ot(n)||jn(n)){i=new Array(n.length);for(let s=0,a=n.length;s<a;s++)i[s]=e(n[s],s,void 0,o)}else if(typeof n=="number"){i=new Array(n);for(let s=0;s<n;s++)i[s]=e(s+1,s,void 0,o)}else if(_n(n))if(n[Symbol.iterator])i=Array.from(n,(s,a)=>e(s,a,void 0,o));else{const s=Object.keys(n);i=new Array(s.length);for(let a=0,l=s.length;a<l;a++){const c=s[a];i[a]=e(n[c],c,a,o)}}else i=[];return i}function nb(n,e,t={},r,i){if(gr.isCE||gr.parent&&Ou(gr.parent)&&gr.parent.isCE)return pn("slot",t,r);let o=n[e];o&&o._c&&(o._d=!1),Mn();const s=o&&EA(o(t)),a=js($n,{key:(t.key||s&&s.key||`_${e}`)+(!s&&r?"_fb":"")},s||[],s&&n._===1?64:-2);return a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),o&&o._c&&(o._d=!0),a}function EA(n){return n.some(e=>sd(e)?!(e.type===mr||e.type===$n&&!EA(e.children)):!0)?n:null}const c1=n=>n?XA(n)?qp(n):c1(n.parent):null,ku=nr(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>c1(n.parent),$root:n=>c1(n.root),$emit:n=>n.emit,$options:n=>rb(n),$forceUpdate:n=>n.f||(n.f=()=>{n.effect.dirty=!0,Jv(n.update)}),$nextTick:n=>n.n||(n.n=ui.bind(n.proxy)),$watch:n=>j3.bind(n)}),Bm=(n,e)=>n!==Dn&&!n.__isScriptSetup&&en(n,e),w3={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:i,props:o,accessCache:s,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const m=s[e];if(m!==void 0)switch(m){case 1:return r[e];case 2:return i[e];case 4:return t[e];case 3:return o[e]}else{if(Bm(r,e))return s[e]=1,r[e];if(i!==Dn&&en(i,e))return s[e]=2,i[e];if((c=n.propsOptions[0])&&en(c,e))return s[e]=3,o[e];if(t!==Dn&&en(t,e))return s[e]=4,t[e];u1&&(s[e]=0)}}const u=ku[e];let d,h;if(u)return e==="$attrs"&&Jr(n.attrs,"get",""),u(n);if((d=a.__cssModules)&&(d=d[e]))return d;if(t!==Dn&&en(t,e))return s[e]=4,t[e];if(h=l.config.globalProperties,en(h,e))return h[e]},set({_:n},e,t){const{data:r,setupState:i,ctx:o}=n;return Bm(i,e)?(i[e]=t,!0):r!==Dn&&en(r,e)?(r[e]=t,!0):en(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(o[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:i,propsOptions:o}},s){let a;return!!t[s]||n!==Dn&&en(n,s)||Bm(e,s)||(a=o[0])&&en(a,s)||en(r,s)||en(ku,s)||en(i.config.globalProperties,s)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:en(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function Iy(n){return Ot(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let u1=!0;function S3(n){const e=rb(n),t=n.proxy,r=n.ctx;u1=!1,e.beforeCreate&&Dy(e.beforeCreate,n,"bc");const{data:i,computed:o,methods:s,watch:a,provide:l,inject:c,created:u,beforeMount:d,mounted:h,beforeUpdate:m,updated:f,activated:v,deactivated:g,beforeDestroy:b,beforeUnmount:S,destroyed:p,unmounted:y,render:w,renderTracked:x,renderTriggered:_,errorCaptured:A,serverPrefetch:C,expose:T,inheritAttrs:I,components:M,directives:P,filters:E}=e;if(c&&C3(c,r,null),s)for(const L in s){const F=s[L];Ht(F)&&(r[L]=F.bind(t))}if(i){const L=i.call(t,t);_n(L)&&(n.data=Xv(L))}if(u1=!0,o)for(const L in o){const F=o[L],H=Ht(F)?F.bind(t,t):Ht(F.get)?F.get.bind(t,t):Ci,$=!Ht(F)&&Ht(F.set)?F.set.bind(t):Ci,O=rt({get:H,set:$});Object.defineProperty(r,L,{enumerable:!0,configurable:!0,get:()=>O.value,set:k=>O.value=k})}if(a)for(const L in a)PA(a[L],r,t,L);if(l){const L=Ht(l)?l.call(t):l;Reflect.ownKeys(L).forEach(F=>{Xi(F,L[F])})}u&&Dy(u,n,"c");function B(L,F){Ot(F)?F.forEach(H=>L(H.bind(t))):F&&L(F.bind(t))}if(B(Gp,d),B(Er,h),B(AA,m),B(MA,f),B(eb,v),B(tb,g),B(y3,A),B(b3,x),B(v3,_),B(Nr,S),B(TA,y),B(g3,C),Ot(T))if(T.length){const L=n.exposed||(n.exposed={});T.forEach(F=>{Object.defineProperty(L,F,{get:()=>t[F],set:H=>t[F]=H})})}else n.exposed||(n.exposed={});w&&n.render===Ci&&(n.render=w),I!=null&&(n.inheritAttrs=I),M&&(n.components=M),P&&(n.directives=P)}function C3(n,e,t=Ci){Ot(n)&&(n=d1(n));for(const r in n){const i=n[r];let o;_n(i)?"default"in i?o=vn(i.from||r,i.default,!0):o=vn(i.from||r):o=vn(i),Tr(o)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>o.value,set:s=>o.value=s}):e[r]=o}}function Dy(n,e,t){Ai(Ot(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function PA(n,e,t,r){const i=r.includes(".")?GA(t,r):()=>t[r];if(jn(n)){const o=e[n];Ht(o)&&bn(i,o)}else if(Ht(n))bn(i,n.bind(t));else if(_n(n))if(Ot(n))n.forEach(o=>PA(o,e,t,r));else{const o=Ht(n.handler)?n.handler.bind(t):e[n.handler];Ht(o)&&bn(i,o,n)}}function rb(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:i,optionsCache:o,config:{optionMergeStrategies:s}}=n.appContext,a=o.get(e);let l;return a?l=a:!i.length&&!t&&!r?l=e:(l={},i.length&&i.forEach(c=>Hf(l,c,s,!0)),Hf(l,e,s)),_n(e)&&o.set(e,l),l}function Hf(n,e,t,r=!1){const{mixins:i,extends:o}=e;o&&Hf(n,o,t,!0),i&&i.forEach(s=>Hf(n,s,t,!0));for(const s in e)if(!(r&&s==="expose")){const a=A3[s]||t&&t[s];n[s]=a?a(n[s],e[s]):e[s]}return n}const A3={data:Ly,props:Fy,emits:Fy,methods:wu,computed:wu,beforeCreate:Ir,created:Ir,beforeMount:Ir,mounted:Ir,beforeUpdate:Ir,updated:Ir,beforeDestroy:Ir,beforeUnmount:Ir,destroyed:Ir,unmounted:Ir,activated:Ir,deactivated:Ir,errorCaptured:Ir,serverPrefetch:Ir,components:wu,directives:wu,watch:T3,provide:Ly,inject:M3};function Ly(n,e){return e?n?function(){return nr(Ht(n)?n.call(this,this):n,Ht(e)?e.call(this,this):e)}:e:n}function M3(n,e){return wu(d1(n),d1(e))}function d1(n){if(Ot(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Ir(n,e){return n?[...new Set([].concat(n,e))]:e}function wu(n,e){return n?nr(Object.create(null),n,e):e}function Fy(n,e){return n?Ot(n)&&Ot(e)?[...new Set([...n,...e])]:nr(Object.create(null),Iy(n),Iy(e??{})):e}function T3(n,e){if(!n)return e;if(!e)return n;const t=nr(Object.create(null),n);for(const r in e)t[r]=Ir(n[r],e[r]);return t}function RA(){return{app:null,config:{isNativeTag:vR,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let E3=0;function P3(n,e){return function(r,i=null){Ht(r)||(r=nr({},r)),i!=null&&!_n(i)&&(i=null);const o=RA(),s=new WeakSet;let a=!1;const l=o.app={_uid:E3++,_component:r,_props:i,_container:null,_context:o,_instance:null,version:hI,get config(){return o.config},set config(c){},use(c,...u){return s.has(c)||(c&&Ht(c.install)?(s.add(c),c.install(l,...u)):Ht(c)&&(s.add(c),c(l,...u))),l},mixin(c){return o.mixins.includes(c)||o.mixins.push(c),l},component(c,u){return u?(o.components[c]=u,l):o.components[c]},directive(c,u){return u?(o.directives[c]=u,l):o.directives[c]},mount(c,u,d){if(!a){const h=pn(r,i);return h.appContext=o,d===!0?d="svg":d===!1&&(d=void 0),u&&e?e(h,c):n(h,c,d),a=!0,l._container=c,c.__vue_app__=l,qp(h.component)}},unmount(){a&&(n(null,l._container),delete l._container.__vue_app__)},provide(c,u){return o.provides[c]=u,l},runWithContext(c){const u=Bu;Bu=l;try{return c()}finally{Bu=u}}};return l}}let Bu=null;function Xi(n,e){if(Mr){let t=Mr.provides;const r=Mr.parent&&Mr.parent.provides;r===t&&(t=Mr.provides=Object.create(r)),t[n]=e}}function vn(n,e,t=!1){const r=Mr||gr;if(r||Bu){const i=r?r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:Bu._context.provides;if(i&&n in i)return i[n];if(arguments.length>1)return t&&Ht(e)?e.call(r&&r.proxy):e}}const IA={},DA=()=>Object.create(IA),LA=n=>Object.getPrototypeOf(n)===IA;function R3(n,e,t,r=!1){const i={},o=DA();n.propsDefaults=Object.create(null),FA(n,e,i,o);for(const s in n.propsOptions[0])s in i||(i[s]=void 0);t?n.props=r?i:QR(i):n.type.props?n.props=i:n.props=o,n.attrs=o}function I3(n,e,t,r){const{props:i,attrs:o,vnode:{patchFlag:s}}=n,a=tn(i),[l]=n.propsOptions;let c=!1;if((r||s>0)&&!(s&16)){if(s&8){const u=n.vnode.dynamicProps;for(let d=0;d<u.length;d++){let h=u[d];if(Wp(n.emitsOptions,h))continue;const m=e[h];if(l)if(en(o,h))m!==o[h]&&(o[h]=m,c=!0);else{const f=Ka(h);i[f]=h1(l,a,f,m,n,!1)}else m!==o[h]&&(o[h]=m,c=!0)}}}else{FA(n,e,i,o)&&(c=!0);let u;for(const d in a)(!e||!en(e,d)&&((u=ll(d))===d||!en(e,u)))&&(l?t&&(t[d]!==void 0||t[u]!==void 0)&&(i[d]=h1(l,a,d,void 0,n,!0)):delete i[d]);if(o!==a)for(const d in o)(!e||!en(e,d))&&(delete o[d],c=!0)}c&&Ko(n.attrs,"set","")}function FA(n,e,t,r){const[i,o]=n.propsOptions;let s=!1,a;if(e)for(let l in e){if(Lu(l))continue;const c=e[l];let u;i&&en(i,u=Ka(l))?!o||!o.includes(u)?t[u]=c:(a||(a={}))[u]=c:Wp(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,s=!0)}if(o){const l=tn(t),c=a||Dn;for(let u=0;u<o.length;u++){const d=o[u];t[d]=h1(i,l,d,c[d],n,!en(c,d))}}return s}function h1(n,e,t,r,i,o){const s=n[t];if(s!=null){const a=en(s,"default");if(a&&r===void 0){const l=s.default;if(s.type!==Function&&!s.skipFactory&&Ht(l)){const{propsDefaults:c}=i;if(t in c)r=c[t];else{const u=Ed(i);r=c[t]=l.call(null,e),u()}}else r=l}s[0]&&(o&&!a?r=!1:s[1]&&(r===""||r===ll(t))&&(r=!0))}return r}const D3=new WeakMap;function OA(n,e,t=!1){const r=t?D3:e.propsCache,i=r.get(n);if(i)return i;const o=n.props,s={},a=[];let l=!1;if(!Ht(n)){const u=d=>{l=!0;const[h,m]=OA(d,e,!0);nr(s,h),m&&a.push(...m)};!t&&e.mixins.length&&e.mixins.forEach(u),n.extends&&u(n.extends),n.mixins&&n.mixins.forEach(u)}if(!o&&!l)return _n(n)&&r.set(n,oc),oc;if(Ot(o))for(let u=0;u<o.length;u++){const d=Ka(o[u]);Oy(d)&&(s[d]=Dn)}else if(o)for(const u in o){const d=Ka(u);if(Oy(d)){const h=o[u],m=s[d]=Ot(h)||Ht(h)?{type:h}:nr({},h),f=m.type;let v=!1,g=!0;if(Ot(f))for(let b=0;b<f.length;++b){const S=f[b],p=Ht(S)&&S.name;if(p==="Boolean"){v=!0;break}else p==="String"&&(g=!1)}else v=Ht(f)&&f.name==="Boolean";m[0]=v,m[1]=g,(v||en(m,"default"))&&a.push(d)}}const c=[s,a];return _n(n)&&r.set(n,c),c}function Oy(n){return n[0]!=="$"&&!Lu(n)}const kA=n=>n[0]==="_"||n==="$stable",ib=n=>Ot(n)?n.map(ho):[ho(n)],L3=(n,e,t)=>{if(e._n)return e;const r=bo((...i)=>ib(e(...i)),t);return r._c=!1,r},BA=(n,e,t)=>{const r=n._ctx;for(const i in n){if(kA(i))continue;const o=n[i];if(Ht(o))e[i]=L3(i,o,r);else if(o!=null){const s=ib(o);e[i]=()=>s}}},NA=(n,e)=>{const t=ib(e);n.slots.default=()=>t},zA=(n,e,t)=>{for(const r in e)(t||r!=="_")&&(n[r]=e[r])},F3=(n,e,t)=>{const r=n.slots=DA();if(n.vnode.shapeFlag&32){const i=e._;i?(zA(r,e,t),t&&XC(r,"_",i,!0)):BA(e,r)}else e&&NA(n,e)},O3=(n,e,t)=>{const{vnode:r,slots:i}=n;let o=!0,s=Dn;if(r.shapeFlag&32){const a=e._;a?t&&a===1?o=!1:zA(i,e,t):(o=!e.$stable,BA(e,i)),s=e}else e&&(NA(n,e),s={default:1});if(o)for(const a in i)!kA(a)&&s[a]==null&&delete i[a]};function f1(n,e,t,r,i=!1){if(Ot(n)){n.forEach((h,m)=>f1(h,e&&(Ot(e)?e[m]:e),t,r,i));return}if(Ou(r)&&!i)return;const o=r.shapeFlag&4?qp(r.component):r.el,s=i?null:o,{i:a,r:l}=n,c=e&&e.r,u=a.refs===Dn?a.refs={}:a.refs,d=a.setupState;if(c!=null&&c!==l&&(jn(c)?(u[c]=null,en(d,c)&&(d[c]=null)):Tr(c)&&(c.value=null)),Ht(l))Ns(l,a,12,[s,u]);else{const h=jn(l),m=Tr(l);if(h||m){const f=()=>{if(n.f){const v=h?en(d,l)?d[l]:u[l]:l.value;i?Ot(v)&&Uv(v,o):Ot(v)?v.includes(o)||v.push(o):h?(u[l]=[o],en(d,l)&&(d[l]=u[l])):(l.value=[o],n.k&&(u[n.k]=l.value))}else h?(u[l]=s,en(d,l)&&(d[l]=s)):m&&(l.value=s,n.k&&(u[n.k]=s))};s?(f.id=-1,Vr(f,t)):f()}}}const UA=Symbol("_vte"),k3=n=>n.__isTeleport,Nu=n=>n&&(n.disabled||n.disabled===""),ky=n=>typeof SVGElement<"u"&&n instanceof SVGElement,By=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,p1=(n,e)=>{const t=n&&n.to;return jn(t)?e?e(t):null:t},B3={name:"Teleport",__isTeleport:!0,process(n,e,t,r,i,o,s,a,l,c){const{mc:u,pc:d,pbc:h,o:{insert:m,querySelector:f,createText:v,createComment:g}}=c,b=Nu(e.props);let{shapeFlag:S,children:p,dynamicChildren:y}=e;if(n==null){const w=e.el=v(""),x=e.anchor=v("");m(w,t,r),m(x,t,r);const _=e.target=p1(e.props,f),A=HA(_,e,v,m);_&&(s==="svg"||ky(_)?s="svg":(s==="mathml"||By(_))&&(s="mathml"));const C=(T,I)=>{S&16&&u(p,T,I,i,o,s,a,l)};b?C(t,x):_&&C(_,A)}else{e.el=n.el,e.targetStart=n.targetStart;const w=e.anchor=n.anchor,x=e.target=n.target,_=e.targetAnchor=n.targetAnchor,A=Nu(n.props),C=A?t:x,T=A?w:_;if(s==="svg"||ky(x)?s="svg":(s==="mathml"||By(x))&&(s="mathml"),y?(h(n.dynamicChildren,y,C,i,o,s,a),ob(n,e,!0)):l||d(n,e,C,T,i,o,s,a,!1),b)A?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):eh(e,t,w,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const I=e.target=p1(e.props,f);I&&eh(e,I,null,c,0)}else A&&eh(e,x,_,c,1)}$A(e)},remove(n,e,t,{um:r,o:{remove:i}},o){const{shapeFlag:s,children:a,anchor:l,targetStart:c,targetAnchor:u,target:d,props:h}=n;if(d&&(i(c),i(u)),o&&i(l),s&16){const m=o||!Nu(h);for(let f=0;f<a.length;f++){const v=a[f];r(v,e,t,m,!!v.dynamicChildren)}}},move:eh,hydrate:N3};function eh(n,e,t,{o:{insert:r},m:i},o=2){o===0&&r(n.targetAnchor,e,t);const{el:s,anchor:a,shapeFlag:l,children:c,props:u}=n,d=o===2;if(d&&r(s,e,t),(!d||Nu(u))&&l&16)for(let h=0;h<c.length;h++)i(c[h],e,t,2);d&&r(a,e,t)}function N3(n,e,t,r,i,o,{o:{nextSibling:s,parentNode:a,querySelector:l,insert:c,createText:u}},d){const h=e.target=p1(e.props,l);if(h){const m=h._lpa||h.firstChild;if(e.shapeFlag&16)if(Nu(e.props))e.anchor=d(s(n),e,a(n),t,r,i,o),e.targetStart=m,e.targetAnchor=m&&s(m);else{e.anchor=s(n);let f=m;for(;f;){if(f&&f.nodeType===8){if(f.data==="teleport start anchor")e.targetStart=f;else if(f.data==="teleport anchor"){e.targetAnchor=f,h._lpa=e.targetAnchor&&s(e.targetAnchor);break}}f=s(f)}e.targetAnchor||HA(h,e,u,c),d(m&&s(m),e,h,t,r,i,o)}$A(e)}return e.anchor&&s(e.anchor)}const z3=B3;function $A(n){const e=n.ctx;if(e&&e.ut){let t=n.children[0].el;for(;t&&t!==n.targetAnchor;)t.nodeType===1&&t.setAttribute("data-v-owner",e.uid),t=t.nextSibling;e.ut()}}function HA(n,e,t,r){const i=e.targetStart=t(""),o=e.targetAnchor=t("");return i[UA]=o,n&&(r(i,n),r(o,n)),o}const Vr=eI;function U3(n){return $3(n)}function $3(n,e){const t=YC();t.__VUE__=!0;const{insert:r,remove:i,patchProp:o,createElement:s,createText:a,createComment:l,setText:c,setElementText:u,parentNode:d,nextSibling:h,setScopeId:m=Ci,insertStaticContent:f}=n,v=(U,K,be,me=null,le=null,xe=null,pe=void 0,ye=null,Me=!!K.dynamicChildren)=>{if(U===K)return;U&&!Ia(U,K)&&(me=ce(U),k(U,le,xe,!0),U=null),K.patchFlag===-2&&(Me=!1,K.dynamicChildren=null);const{type:Ce,ref:z,shapeFlag:D}=K;switch(Ce){case Md:g(U,K,be,me);break;case mr:b(U,K,be,me);break;case Um:U==null&&S(K,be,me,pe);break;case $n:M(U,K,be,me,le,xe,pe,ye,Me);break;default:D&1?w(U,K,be,me,le,xe,pe,ye,Me):D&6?P(U,K,be,me,le,xe,pe,ye,Me):(D&64||D&128)&&Ce.process(U,K,be,me,le,xe,pe,ye,Me,se)}z!=null&&le&&f1(z,U&&U.ref,xe,K||U,!K)},g=(U,K,be,me)=>{if(U==null)r(K.el=a(K.children),be,me);else{const le=K.el=U.el;K.children!==U.children&&c(le,K.children)}},b=(U,K,be,me)=>{U==null?r(K.el=l(K.children||""),be,me):K.el=U.el},S=(U,K,be,me)=>{[U.el,U.anchor]=f(U.children,K,be,me,U.el,U.anchor)},p=({el:U,anchor:K},be,me)=>{let le;for(;U&&U!==K;)le=h(U),r(U,be,me),U=le;r(K,be,me)},y=({el:U,anchor:K})=>{let be;for(;U&&U!==K;)be=h(U),i(U),U=be;i(K)},w=(U,K,be,me,le,xe,pe,ye,Me)=>{K.type==="svg"?pe="svg":K.type==="math"&&(pe="mathml"),U==null?x(K,be,me,le,xe,pe,ye,Me):C(U,K,le,xe,pe,ye,Me)},x=(U,K,be,me,le,xe,pe,ye)=>{let Me,Ce;const{props:z,shapeFlag:D,transition:q,dirs:_e}=U;if(Me=U.el=s(U.type,xe,z&&z.is,z),D&8?u(Me,U.children):D&16&&A(U.children,Me,null,me,le,Nm(U,xe),pe,ye),_e&&ma(U,null,me,"created"),_(Me,U,U.scopeId,pe,me),z){for(const Re in z)Re!=="value"&&!Lu(Re)&&o(Me,Re,null,z[Re],xe,me);"value"in z&&o(Me,"value",null,z.value,xe),(Ce=z.onVnodeBeforeMount)&&io(Ce,me,U)}_e&&ma(U,null,me,"beforeMount");const ve=H3(le,q);ve&&q.beforeEnter(Me),r(Me,K,be),((Ce=z&&z.onVnodeMounted)||ve||_e)&&Vr(()=>{Ce&&io(Ce,me,U),ve&&q.enter(Me),_e&&ma(U,null,me,"mounted")},le)},_=(U,K,be,me,le)=>{if(be&&m(U,be),me)for(let xe=0;xe<me.length;xe++)m(U,me[xe]);if(le){let xe=le.subTree;if(K===xe){const pe=le.vnode;_(U,pe,pe.scopeId,pe.slotScopeIds,le.parent)}}},A=(U,K,be,me,le,xe,pe,ye,Me=0)=>{for(let Ce=Me;Ce<U.length;Ce++){const z=U[Ce]=ye?Ps(U[Ce]):ho(U[Ce]);v(null,z,K,be,me,le,xe,pe,ye)}},C=(U,K,be,me,le,xe,pe)=>{const ye=K.el=U.el;let{patchFlag:Me,dynamicChildren:Ce,dirs:z}=K;Me|=U.patchFlag&16;const D=U.props||Dn,q=K.props||Dn;let _e;if(be&&ga(be,!1),(_e=q.onVnodeBeforeUpdate)&&io(_e,be,K,U),z&&ma(K,U,be,"beforeUpdate"),be&&ga(be,!0),(D.innerHTML&&q.innerHTML==null||D.textContent&&q.textContent==null)&&u(ye,""),Ce?T(U.dynamicChildren,Ce,ye,be,me,Nm(K,le),xe):pe||F(U,K,ye,null,be,me,Nm(K,le),xe,!1),Me>0){if(Me&16)I(ye,D,q,be,le);else if(Me&2&&D.class!==q.class&&o(ye,"class",null,q.class,le),Me&4&&o(ye,"style",D.style,q.style,le),Me&8){const ve=K.dynamicProps;for(let Re=0;Re<ve.length;Re++){const ze=ve[Re],Le=D[ze],Ve=q[ze];(Ve!==Le||ze==="value")&&o(ye,ze,Le,Ve,le,be)}}Me&1&&U.children!==K.children&&u(ye,K.children)}else!pe&&Ce==null&&I(ye,D,q,be,le);((_e=q.onVnodeUpdated)||z)&&Vr(()=>{_e&&io(_e,be,K,U),z&&ma(K,U,be,"updated")},me)},T=(U,K,be,me,le,xe,pe)=>{for(let ye=0;ye<K.length;ye++){const Me=U[ye],Ce=K[ye],z=Me.el&&(Me.type===$n||!Ia(Me,Ce)||Me.shapeFlag&70)?d(Me.el):be;v(Me,Ce,z,null,me,le,xe,pe,!0)}},I=(U,K,be,me,le)=>{if(K!==be){if(K!==Dn)for(const xe in K)!Lu(xe)&&!(xe in be)&&o(U,xe,K[xe],null,le,me);for(const xe in be){if(Lu(xe))continue;const pe=be[xe],ye=K[xe];pe!==ye&&xe!=="value"&&o(U,xe,ye,pe,le,me)}"value"in be&&o(U,"value",K.value,be.value,le)}},M=(U,K,be,me,le,xe,pe,ye,Me)=>{const Ce=K.el=U?U.el:a(""),z=K.anchor=U?U.anchor:a("");let{patchFlag:D,dynamicChildren:q,slotScopeIds:_e}=K;_e&&(ye=ye?ye.concat(_e):_e),U==null?(r(Ce,be,me),r(z,be,me),A(K.children||[],be,z,le,xe,pe,ye,Me)):D>0&&D&64&&q&&U.dynamicChildren?(T(U.dynamicChildren,q,be,le,xe,pe,ye),(K.key!=null||le&&K===le.subTree)&&ob(U,K,!0)):F(U,K,be,z,le,xe,pe,ye,Me)},P=(U,K,be,me,le,xe,pe,ye,Me)=>{K.slotScopeIds=ye,U==null?K.shapeFlag&512?le.ctx.activate(K,be,me,pe,Me):E(K,be,me,le,xe,pe,Me):R(U,K,Me)},E=(U,K,be,me,le,xe,pe)=>{const ye=U.component=sI(U,me,le);if(Hp(U)&&(ye.ctx.renderer=se),aI(ye,!1,pe),ye.asyncDep){if(le&&le.registerDep(ye,B,pe),!U.el){const Me=ye.subTree=pn(mr);b(null,Me,K,be)}}else B(ye,U,K,be,le,xe,pe)},R=(U,K,be)=>{const me=K.component=U.component;if(Z3(U,K,be))if(me.asyncDep&&!me.asyncResolved){L(me,K,be);return}else me.next=K,u3(me.update),me.effect.dirty=!0,me.update();else K.el=U.el,me.vnode=K},B=(U,K,be,me,le,xe,pe)=>{const ye=()=>{if(U.isMounted){let{next:z,bu:D,u:q,parent:_e,vnode:ve}=U;{const Ze=VA(U);if(Ze){z&&(z.el=ve.el,L(U,z,pe)),Ze.asyncDep.then(()=>{U.isUnmounted||ye()});return}}let Re=z,ze;ga(U,!1),z?(z.el=ve.el,L(U,z,pe)):z=ve,D&&Fm(D),(ze=z.props&&z.props.onVnodeBeforeUpdate)&&io(ze,_e,z,ve),ga(U,!0);const Le=zm(U),Ve=U.subTree;U.subTree=Le,v(Ve,Le,d(Ve.el),ce(Ve),U,le,xe),z.el=Le.el,Re===null&&J3(U,Le.el),q&&Vr(q,le),(ze=z.props&&z.props.onVnodeUpdated)&&Vr(()=>io(ze,_e,z,ve),le)}else{let z;const{el:D,props:q}=K,{bm:_e,m:ve,parent:Re}=U,ze=Ou(K);if(ga(U,!1),_e&&Fm(_e),!ze&&(z=q&&q.onVnodeBeforeMount)&&io(z,Re,K),ga(U,!0),D&&ue){const Le=()=>{U.subTree=zm(U),ue(D,U.subTree,U,le,null)};ze?K.type.__asyncLoader().then(()=>!U.isUnmounted&&Le()):Le()}else{const Le=U.subTree=zm(U);v(null,Le,be,me,U,le,xe),K.el=Le.el}if(ve&&Vr(ve,le),!ze&&(z=q&&q.onVnodeMounted)){const Le=K;Vr(()=>io(z,Re,Le),le)}(K.shapeFlag&256||Re&&Ou(Re.vnode)&&Re.vnode.shapeFlag&256)&&U.a&&Vr(U.a,le),U.isMounted=!0,K=be=me=null}},Me=U.effect=new Vv(ye,Ci,()=>Jv(Ce),U.scope),Ce=U.update=()=>{Me.dirty&&Me.run()};Ce.i=U,Ce.id=U.uid,ga(U,!0),Ce()},L=(U,K,be)=>{K.component=U;const me=U.vnode.props;U.vnode=K,U.next=null,I3(U,K.props,me,be),O3(U,K.children,be),ea(),Py(U),ta()},F=(U,K,be,me,le,xe,pe,ye,Me=!1)=>{const Ce=U&&U.children,z=U?U.shapeFlag:0,D=K.children,{patchFlag:q,shapeFlag:_e}=K;if(q>0){if(q&128){$(Ce,D,be,me,le,xe,pe,ye,Me);return}else if(q&256){H(Ce,D,be,me,le,xe,pe,ye,Me);return}}_e&8?(z&16&&Q(Ce,le,xe),D!==Ce&&u(be,D)):z&16?_e&16?$(Ce,D,be,me,le,xe,pe,ye,Me):Q(Ce,le,xe,!0):(z&8&&u(be,""),_e&16&&A(D,be,me,le,xe,pe,ye,Me))},H=(U,K,be,me,le,xe,pe,ye,Me)=>{U=U||oc,K=K||oc;const Ce=U.length,z=K.length,D=Math.min(Ce,z);let q;for(q=0;q<D;q++){const _e=K[q]=Me?Ps(K[q]):ho(K[q]);v(U[q],_e,be,null,le,xe,pe,ye,Me)}Ce>z?Q(U,le,xe,!0,!1,D):A(K,be,me,le,xe,pe,ye,Me,D)},$=(U,K,be,me,le,xe,pe,ye,Me)=>{let Ce=0;const z=K.length;let D=U.length-1,q=z-1;for(;Ce<=D&&Ce<=q;){const _e=U[Ce],ve=K[Ce]=Me?Ps(K[Ce]):ho(K[Ce]);if(Ia(_e,ve))v(_e,ve,be,null,le,xe,pe,ye,Me);else break;Ce++}for(;Ce<=D&&Ce<=q;){const _e=U[D],ve=K[q]=Me?Ps(K[q]):ho(K[q]);if(Ia(_e,ve))v(_e,ve,be,null,le,xe,pe,ye,Me);else break;D--,q--}if(Ce>D){if(Ce<=q){const _e=q+1,ve=_e<z?K[_e].el:me;for(;Ce<=q;)v(null,K[Ce]=Me?Ps(K[Ce]):ho(K[Ce]),be,ve,le,xe,pe,ye,Me),Ce++}}else if(Ce>q)for(;Ce<=D;)k(U[Ce],le,xe,!0),Ce++;else{const _e=Ce,ve=Ce,Re=new Map;for(Ce=ve;Ce<=q;Ce++){const he=K[Ce]=Me?Ps(K[Ce]):ho(K[Ce]);he.key!=null&&Re.set(he.key,Ce)}let ze,Le=0;const Ve=q-ve+1;let Ze=!1,ut=0;const Ne=new Array(Ve);for(Ce=0;Ce<Ve;Ce++)Ne[Ce]=0;for(Ce=_e;Ce<=D;Ce++){const he=U[Ce];if(Le>=Ve){k(he,le,xe,!0);continue}let Ae;if(he.key!=null)Ae=Re.get(he.key);else for(ze=ve;ze<=q;ze++)if(Ne[ze-ve]===0&&Ia(he,K[ze])){Ae=ze;break}Ae===void 0?k(he,le,xe,!0):(Ne[Ae-ve]=Ce+1,Ae>=ut?ut=Ae:Ze=!0,v(he,K[Ae],be,null,le,xe,pe,ye,Me),Le++)}const ct=Ze?V3(Ne):oc;for(ze=ct.length-1,Ce=Ve-1;Ce>=0;Ce--){const he=ve+Ce,Ae=K[he],Fe=he+1<z?K[he+1].el:me;Ne[Ce]===0?v(null,Ae,be,Fe,le,xe,pe,ye,Me):Ze&&(ze<0||Ce!==ct[ze]?O(Ae,be,Fe,2):ze--)}}},O=(U,K,be,me,le=null)=>{const{el:xe,type:pe,transition:ye,children:Me,shapeFlag:Ce}=U;if(Ce&6){O(U.component.subTree,K,be,me);return}if(Ce&128){U.suspense.move(K,be,me);return}if(Ce&64){pe.move(U,K,be,se);return}if(pe===$n){r(xe,K,be);for(let D=0;D<Me.length;D++)O(Me[D],K,be,me);r(U.anchor,K,be);return}if(pe===Um){p(U,K,be);return}if(me!==2&&Ce&1&&ye)if(me===0)ye.beforeEnter(xe),r(xe,K,be),Vr(()=>ye.enter(xe),le);else{const{leave:D,delayLeave:q,afterLeave:_e}=ye,ve=()=>r(xe,K,be),Re=()=>{D(xe,()=>{ve(),_e&&_e()})};q?q(xe,ve,Re):Re()}else r(xe,K,be)},k=(U,K,be,me=!1,le=!1)=>{const{type:xe,props:pe,ref:ye,children:Me,dynamicChildren:Ce,shapeFlag:z,patchFlag:D,dirs:q,cacheIndex:_e}=U;if(D===-2&&(le=!1),ye!=null&&f1(ye,null,be,U,!0),_e!=null&&(K.renderCache[_e]=void 0),z&256){K.ctx.deactivate(U);return}const ve=z&1&&q,Re=!Ou(U);let ze;if(Re&&(ze=pe&&pe.onVnodeBeforeUnmount)&&io(ze,K,U),z&6)ne(U.component,be,me);else{if(z&128){U.suspense.unmount(be,me);return}ve&&ma(U,null,K,"beforeUnmount"),z&64?U.type.remove(U,K,be,se,me):Ce&&!Ce.hasOnce&&(xe!==$n||D>0&&D&64)?Q(Ce,K,be,!1,!0):(xe===$n&&D&384||!le&&z&16)&&Q(Me,K,be),me&&X(U)}(Re&&(ze=pe&&pe.onVnodeUnmounted)||ve)&&Vr(()=>{ze&&io(ze,K,U),ve&&ma(U,null,K,"unmounted")},be)},X=U=>{const{type:K,el:be,anchor:me,transition:le}=U;if(K===$n){ie(be,me);return}if(K===Um){y(U);return}const xe=()=>{i(be),le&&!le.persisted&&le.afterLeave&&le.afterLeave()};if(U.shapeFlag&1&&le&&!le.persisted){const{leave:pe,delayLeave:ye}=le,Me=()=>pe(be,xe);ye?ye(U.el,xe,Me):Me()}else xe()},ie=(U,K)=>{let be;for(;U!==K;)be=h(U),i(U),U=be;i(K)},ne=(U,K,be)=>{const{bum:me,scope:le,update:xe,subTree:pe,um:ye,m:Me,a:Ce}=U;Ny(Me),Ny(Ce),me&&Fm(me),le.stop(),xe&&(xe.active=!1,k(pe,U,K,be)),ye&&Vr(ye,K),Vr(()=>{U.isUnmounted=!0},K),K&&K.pendingBranch&&!K.isUnmounted&&U.asyncDep&&!U.asyncResolved&&U.suspenseId===K.pendingId&&(K.deps--,K.deps===0&&K.resolve())},Q=(U,K,be,me=!1,le=!1,xe=0)=>{for(let pe=xe;pe<U.length;pe++)k(U[pe],K,be,me,le)},ce=U=>{if(U.shapeFlag&6)return ce(U.component.subTree);if(U.shapeFlag&128)return U.suspense.next();const K=h(U.anchor||U.el),be=K&&K[UA];return be?h(be):K};let Z=!1;const re=(U,K,be)=>{U==null?K._vnode&&k(K._vnode,null,null,!0):v(K._vnode||null,U,K,null,null,null,be),Z||(Z=!0,Py(),vA(),Z=!1),K._vnode=U},se={p:v,um:k,m:O,r:X,mt:E,mc:A,pc:F,pbc:T,n:ce,o:n};let fe,ue;return{render:re,hydrate:fe,createApp:P3(re,fe)}}function Nm({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function ga({effect:n,update:e},t){n.allowRecurse=e.allowRecurse=t}function H3(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function ob(n,e,t=!1){const r=n.children,i=e.children;if(Ot(r)&&Ot(i))for(let o=0;o<r.length;o++){const s=r[o];let a=i[o];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=i[o]=Ps(i[o]),a.el=s.el),!t&&a.patchFlag!==-2&&ob(s,a)),a.type===Md&&(a.el=s.el)}}function V3(n){const e=n.slice(),t=[0];let r,i,o,s,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(i=t[t.length-1],n[i]<c){e[r]=i,t.push(r);continue}for(o=0,s=t.length-1;o<s;)a=o+s>>1,n[t[a]]<c?o=a+1:s=a;c<n[t[o]]&&(o>0&&(e[r]=t[o-1]),t[o]=r)}}for(o=t.length,s=t[o-1];o-- >0;)t[o]=s,s=e[s];return t}function VA(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:VA(e)}function Ny(n){if(n)for(let e=0;e<n.length;e++)n[e].active=!1}const G3=Symbol.for("v-scx"),W3=()=>vn(G3);function Ws(n,e){return sb(n,null,e)}const th={};function bn(n,e,t){return sb(n,e,t)}function sb(n,e,{immediate:t,deep:r,flush:i,once:o,onTrack:s,onTrigger:a}=Dn){if(e&&o){const x=e;e=(..._)=>{x(..._),w()}}const l=Mr,c=x=>r===!0?x:Ls(x,r===!1?1:void 0);let u,d=!1,h=!1;if(Tr(n)?(u=()=>n.value,d=bc(n)):Fu(n)?(u=()=>c(n),d=!0):Ot(n)?(h=!0,d=n.some(x=>Fu(x)||bc(x)),u=()=>n.map(x=>{if(Tr(x))return x.value;if(Fu(x))return c(x);if(Ht(x))return Ns(x,l,2)})):Ht(n)?e?u=()=>Ns(n,l,2):u=()=>(m&&m(),Ai(n,l,3,[f])):u=Ci,e&&r){const x=u;u=()=>Ls(x())}let m,f=x=>{m=p.onStop=()=>{Ns(x,l,4),m=p.onStop=void 0}},v;if(jp)if(f=Ci,e?t&&Ai(e,l,3,[u(),h?[]:void 0,f]):u(),i==="sync"){const x=W3();v=x.__watcherHandles||(x.__watcherHandles=[])}else return Ci;let g=h?new Array(n.length).fill(th):th;const b=()=>{if(!(!p.active||!p.dirty))if(e){const x=p.run();(r||d||(h?x.some((_,A)=>Gs(_,g[A])):Gs(x,g)))&&(m&&m(),Ai(e,l,3,[x,g===th?void 0:h&&g[0]===th?[]:g,f]),g=x)}else p.run()};b.allowRecurse=!!e;let S;i==="sync"?S=b:i==="post"?S=()=>Vr(b,l&&l.suspense):(b.pre=!0,l&&(b.id=l.uid),S=()=>Jv(b));const p=new Vv(u,Ci,S),y=DR(),w=()=>{p.stop(),y&&Uv(y.effects,p)};return e?t?b():g=p.run():i==="post"?Vr(p.run.bind(p),l&&l.suspense):p.run(),v&&v.push(w),w}function j3(n,e,t){const r=this.proxy,i=jn(n)?n.includes(".")?GA(r,n):()=>r[n]:n.bind(r,r);let o;Ht(e)?o=e:(o=e.handler,t=e);const s=Ed(this),a=sb(i,o.bind(r),t);return s(),a}function GA(n,e){const t=e.split(".");return()=>{let r=n;for(let i=0;i<t.length&&r;i++)r=r[t[i]];return r}}function Ls(n,e=1/0,t){if(e<=0||!_n(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,Tr(n))Ls(n.value,e,t);else if(Ot(n))for(let r=0;r<n.length;r++)Ls(n[r],e,t);else if(VC(n)||sc(n))n.forEach(r=>{Ls(r,e,t)});else if(jC(n)){for(const r in n)Ls(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&Ls(n[r],e,t)}return n}const q3=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Ka(e)}Modifiers`]||n[`${ll(e)}Modifiers`];function X3(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Dn;let i=t;const o=e.startsWith("update:"),s=o&&q3(r,e.slice(7));s&&(s.trim&&(i=t.map(u=>jn(u)?u.trim():u)),s.number&&(i=t.map(wR)));let a,l=r[a=Lm(e)]||r[a=Lm(Ka(e))];!l&&o&&(l=r[a=Lm(ll(e))]),l&&Ai(l,n,6,i);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,Ai(c,n,6,i)}}function WA(n,e,t=!1){const r=e.emitsCache,i=r.get(n);if(i!==void 0)return i;const o=n.emits;let s={},a=!1;if(!Ht(n)){const l=c=>{const u=WA(c,e,!0);u&&(a=!0,nr(s,u))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!o&&!a?(_n(n)&&r.set(n,null),null):(Ot(o)?o.forEach(l=>s[l]=null):nr(s,o),_n(n)&&r.set(n,s),s)}function Wp(n,e){return!n||!kp(e)?!1:(e=e.slice(2).replace(/Once$/,""),en(n,e[0].toLowerCase()+e.slice(1))||en(n,ll(e))||en(n,e))}function zm(n){const{type:e,vnode:t,proxy:r,withProxy:i,propsOptions:[o],slots:s,attrs:a,emit:l,render:c,renderCache:u,props:d,data:h,setupState:m,ctx:f,inheritAttrs:v}=n,g=$f(n);let b,S;try{if(t.shapeFlag&4){const y=i||r,w=y;b=ho(c.call(w,y,u,d,m,h,f)),S=a}else{const y=e;b=ho(y.length>1?y(d,{attrs:a,slots:s,emit:l}):y(d,null)),S=e.props?a:Y3(a)}}catch(y){zu.length=0,$p(y,n,1),b=pn(mr)}let p=b;if(S&&v!==!1){const y=Object.keys(S),{shapeFlag:w}=p;y.length&&w&7&&(o&&y.some(zv)&&(S=K3(S,o)),p=es(p,S,!1,!0))}return t.dirs&&(p=es(p,null,!1,!0),p.dirs=p.dirs?p.dirs.concat(t.dirs):t.dirs),t.transition&&(p.transition=t.transition),b=p,$f(g),b}const Y3=n=>{let e;for(const t in n)(t==="class"||t==="style"||kp(t))&&((e||(e={}))[t]=n[t]);return e},K3=(n,e)=>{const t={};for(const r in n)(!zv(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function Z3(n,e,t){const{props:r,children:i,component:o}=n,{props:s,children:a,patchFlag:l}=e,c=o.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?zy(r,s,c):!!s;if(l&8){const u=e.dynamicProps;for(let d=0;d<u.length;d++){const h=u[d];if(s[h]!==r[h]&&!Wp(c,h))return!0}}}else return(i||a)&&(!a||!a.$stable)?!0:r===s?!1:r?s?zy(r,s,c):!0:!!s;return!1}function zy(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let i=0;i<r.length;i++){const o=r[i];if(e[o]!==n[o]&&!Wp(t,o))return!0}return!1}function J3({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const Q3=n=>n.__isSuspense;function eI(n,e){e&&e.pendingBranch?Ot(n)?e.effects.push(...n):e.effects.push(n):d3(n)}const $n=Symbol.for("v-fgt"),Md=Symbol.for("v-txt"),mr=Symbol.for("v-cmt"),Um=Symbol.for("v-stc"),zu=[];let ai=null;function Mn(n=!1){zu.push(ai=n?null:[])}function tI(){zu.pop(),ai=zu[zu.length-1]||null}let od=1;function Uy(n){od+=n,n<0&&ai&&(ai.hasOnce=!0)}function jA(n){return n.dynamicChildren=od>0?ai||oc:null,tI(),od>0&&ai&&ai.push(n),n}function fr(n,e,t,r,i,o){return jA(Yn(n,e,t,r,i,o,!0))}function js(n,e,t,r,i){return jA(pn(n,e,t,r,i,!0))}function sd(n){return n?n.__v_isVNode===!0:!1}function Ia(n,e){return n.type===e.type&&n.key===e.key}const qA=({key:n})=>n??null,yf=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?jn(n)||Tr(n)||Ht(n)?{i:gr,r:n,k:e,f:!!t}:n:null);function Yn(n,e=null,t=null,r=0,i=null,o=n===$n?0:1,s=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&qA(e),ref:e&&yf(e),scopeId:yA,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:r,dynamicProps:i,dynamicChildren:null,appContext:null,ctx:gr};return a?(ab(l,t),o&128&&n.normalize(l)):t&&(l.shapeFlag|=jn(t)?8:16),od>0&&!s&&ai&&(l.patchFlag>0||o&6)&&l.patchFlag!==32&&ai.push(l),l}const pn=nI;function nI(n,e=null,t=null,r=0,i=null,o=!1){if((!n||n===_3)&&(n=mr),sd(n)){const a=es(n,e,!0);return t&&ab(a,t),od>0&&!o&&ai&&(a.shapeFlag&6?ai[ai.indexOf(n)]=a:ai.push(a)),a.patchFlag=-2,a}if(dI(n)&&(n=n.__vccOpts),e){e=rI(e);let{class:a,style:l}=e;a&&!jn(a)&&(e.class=zp(a)),_n(l)&&(uA(l)&&!Ot(l)&&(l=nr({},l)),e.style=Hv(l))}const s=jn(n)?1:Q3(n)?128:k3(n)?64:_n(n)?4:Ht(n)?2:0;return Yn(n,e,t,r,i,s,o,!0)}function rI(n){return n?uA(n)||LA(n)?nr({},n):n:null}function es(n,e,t=!1,r=!1){const{props:i,ref:o,patchFlag:s,children:a,transition:l}=n,c=e?Dc(i||{},e):i,u={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&qA(c),ref:e&&e.ref?t&&o?Ot(o)?o.concat(yf(e)):[o,yf(e)]:yf(e):o,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==$n?s===-1?16:s|16:s,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&es(n.ssContent),ssFallback:n.ssFallback&&es(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&yc(u,l.clone(u)),u}function Ja(n=" ",e=0){return pn(Md,null,n,e)}function Zc(n="",e=!1){return e?(Mn(),js(mr,null,n)):pn(mr,null,n)}function ho(n){return n==null||typeof n=="boolean"?pn(mr):Ot(n)?pn($n,null,n.slice()):typeof n=="object"?Ps(n):pn(Md,null,String(n))}function Ps(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:es(n)}function ab(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Ot(e))t=16;else if(typeof e=="object")if(r&65){const i=e.default;i&&(i._c&&(i._d=!1),ab(n,i()),i._c&&(i._d=!0));return}else{t=32;const i=e._;!i&&!LA(e)?e._ctx=gr:i===3&&gr&&(gr.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Ht(e)?(e={default:e,_ctx:gr},t=32):(e=String(e),r&64?(t=16,e=[Ja(e)]):t=8);n.children=e,n.shapeFlag|=t}function Dc(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const i in r)if(i==="class")e.class!==r.class&&(e.class=zp([e.class,r.class]));else if(i==="style")e.style=Hv([e.style,r.style]);else if(kp(i)){const o=e[i],s=r[i];s&&o!==s&&!(Ot(o)&&o.includes(s))&&(e[i]=o?[].concat(o,s):s)}else i!==""&&(e[i]=r[i])}return e}function io(n,e,t,r=null){Ai(n,e,7,[t,r])}const iI=RA();let oI=0;function sI(n,e,t){const r=n.type,i=(e?e.appContext:n.appContext)||iI,o={uid:oI++,vnode:n,type:r,parent:e,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,scope:new RR(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:OA(r,i),emitsOptions:WA(r,i),emit:null,emitted:null,propsDefaults:Dn,inheritAttrs:r.inheritAttrs,ctx:Dn,data:Dn,props:Dn,attrs:Dn,slots:Dn,refs:Dn,setupState:Dn,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return o.ctx={_:o},o.root=e?e.root:o,o.emit=X3.bind(null,o),n.ce&&n.ce(o),o}let Mr=null;const Td=()=>Mr||gr;let Vf,m1;{const n=YC(),e=(t,r)=>{let i;return(i=n[t])||(i=n[t]=[]),i.push(r),o=>{i.length>1?i.forEach(s=>s(o)):i[0](o)}};Vf=e("__VUE_INSTANCE_SETTERS__",t=>Mr=t),m1=e("__VUE_SSR_SETTERS__",t=>jp=t)}const Ed=n=>{const e=Mr;return Vf(n),n.scope.on(),()=>{n.scope.off(),Vf(e)}},$y=()=>{Mr&&Mr.scope.off(),Vf(null)};function XA(n){return n.vnode.shapeFlag&4}let jp=!1;function aI(n,e=!1,t=!1){e&&m1(e);const{props:r,children:i}=n.vnode,o=XA(n);R3(n,r,o,e),F3(n,i,t);const s=o?lI(n,e):void 0;return e&&m1(!1),s}function lI(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,w3);const{setup:r}=t;if(r){const i=n.setupContext=r.length>1?uI(n):null,o=Ed(n);ea();const s=Ns(r,n,0,[n.props,i]);if(ta(),o(),GC(s)){if(s.then($y,$y),e)return s.then(a=>{Hy(n,a,e)}).catch(a=>{$p(a,n,0)});n.asyncDep=s}else Hy(n,s,e)}else YA(n,e)}function Hy(n,e,t){Ht(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:_n(e)&&(n.setupState=pA(e)),YA(n,t)}let Vy;function YA(n,e,t){const r=n.type;if(!n.render){if(!e&&Vy&&!r.render){const i=r.template||rb(n).template;if(i){const{isCustomElement:o,compilerOptions:s}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=nr(nr({isCustomElement:o,delimiters:a},s),l);r.render=Vy(i,c)}}n.render=r.render||Ci}{const i=Ed(n);ea();try{S3(n)}finally{ta(),i()}}}const cI={get(n,e){return Jr(n,"get",""),n[e]}};function uI(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,cI),slots:n.slots,emit:n.emit,expose:e}}function qp(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(pA(e3(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in ku)return ku[t](n)},has(e,t){return t in e||t in ku}})):n.proxy}function dI(n){return Ht(n)&&"__vccOpts"in n}const rt=(n,e)=>t3(n,e,jp);function ge(n,e,t){const r=arguments.length;return r===2?_n(e)&&!Ot(e)?sd(e)?pn(n,null,[e]):pn(n,e):pn(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&sd(t)&&(t=[t]),pn(n,e,t))}const hI="3.4.35";/**
* @vue/runtime-dom v3.4.35
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const fI="http://www.w3.org/2000/svg",pI="http://www.w3.org/1998/Math/MathML",Wo=typeof document<"u"?document:null,Gy=Wo&&Wo.createElement("template"),mI={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const i=e==="svg"?Wo.createElementNS(fI,n):e==="mathml"?Wo.createElementNS(pI,n):t?Wo.createElement(n,{is:t}):Wo.createElement(n);return n==="select"&&r&&r.multiple!=null&&i.setAttribute("multiple",r.multiple),i},createText:n=>Wo.createTextNode(n),createComment:n=>Wo.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Wo.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,i,o){const s=t?t.previousSibling:e.lastChild;if(i&&(i===o||i.nextSibling))for(;e.insertBefore(i.cloneNode(!0),t),!(i===o||!(i=i.nextSibling)););else{Gy.innerHTML=r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n;const a=Gy.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[s?s.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},fs="transition",Jc="animation",_c=Symbol("_vtc"),Mo=(n,{slots:e})=>ge(p3,ZA(n),e);Mo.displayName="Transition";const KA={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},gI=Mo.props=nr({},xA,KA),va=(n,e=[])=>{Ot(n)?n.forEach(t=>t(...e)):n&&n(...e)},Wy=n=>n?Ot(n)?n.some(e=>e.length>1):n.length>1:!1;function ZA(n){const e={};for(const M in n)M in KA||(e[M]=n[M]);if(n.css===!1)return e;const{name:t="v",type:r,duration:i,enterFromClass:o=`${t}-enter-from`,enterActiveClass:s=`${t}-enter-active`,enterToClass:a=`${t}-enter-to`,appearFromClass:l=o,appearActiveClass:c=s,appearToClass:u=a,leaveFromClass:d=`${t}-leave-from`,leaveActiveClass:h=`${t}-leave-active`,leaveToClass:m=`${t}-leave-to`}=n,f=vI(i),v=f&&f[0],g=f&&f[1],{onBeforeEnter:b,onEnter:S,onEnterCancelled:p,onLeave:y,onLeaveCancelled:w,onBeforeAppear:x=b,onAppear:_=S,onAppearCancelled:A=p}=e,C=(M,P,E)=>{Ms(M,P?u:a),Ms(M,P?c:s),E&&E()},T=(M,P)=>{M._isLeaving=!1,Ms(M,d),Ms(M,m),Ms(M,h),P&&P()},I=M=>(P,E)=>{const R=M?_:S,B=()=>C(P,M,E);va(R,[P,B]),jy(()=>{Ms(P,M?l:o),Vo(P,M?u:a),Wy(R)||qy(P,r,v,B)})};return nr(e,{onBeforeEnter(M){va(b,[M]),Vo(M,o),Vo(M,s)},onBeforeAppear(M){va(x,[M]),Vo(M,l),Vo(M,c)},onEnter:I(!1),onAppear:I(!0),onLeave(M,P){M._isLeaving=!0;const E=()=>T(M,P);Vo(M,d),Vo(M,h),QA(),jy(()=>{M._isLeaving&&(Ms(M,d),Vo(M,m),Wy(y)||qy(M,r,g,E))}),va(y,[M,E])},onEnterCancelled(M){C(M,!1),va(p,[M])},onAppearCancelled(M){C(M,!0),va(A,[M])},onLeaveCancelled(M){T(M),va(w,[M])}})}function vI(n){if(n==null)return null;if(_n(n))return[$m(n.enter),$m(n.leave)];{const e=$m(n);return[e,e]}}function $m(n){return SR(n)}function Vo(n,e){e.split(/\s+/).forEach(t=>t&&n.classList.add(t)),(n[_c]||(n[_c]=new Set)).add(e)}function Ms(n,e){e.split(/\s+/).forEach(r=>r&&n.classList.remove(r));const t=n[_c];t&&(t.delete(e),t.size||(n[_c]=void 0))}function jy(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let bI=0;function qy(n,e,t,r){const i=n._endId=++bI,o=()=>{i===n._endId&&r()};if(t)return setTimeout(o,t);const{type:s,timeout:a,propCount:l}=JA(n,e);if(!s)return r();const c=s+"end";let u=0;const d=()=>{n.removeEventListener(c,h),o()},h=m=>{m.target===n&&++u>=l&&d()};setTimeout(()=>{u<l&&d()},a+1),n.addEventListener(c,h)}function JA(n,e){const t=window.getComputedStyle(n),r=f=>(t[f]||"").split(", "),i=r(`${fs}Delay`),o=r(`${fs}Duration`),s=Xy(i,o),a=r(`${Jc}Delay`),l=r(`${Jc}Duration`),c=Xy(a,l);let u=null,d=0,h=0;e===fs?s>0&&(u=fs,d=s,h=o.length):e===Jc?c>0&&(u=Jc,d=c,h=l.length):(d=Math.max(s,c),u=d>0?s>c?fs:Jc:null,h=u?u===fs?o.length:l.length:0);const m=u===fs&&/\b(transform|all)(,|$)/.test(r(`${fs}Property`).toString());return{type:u,timeout:d,propCount:h,hasTransform:m}}function Xy(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max(...e.map((t,r)=>Yy(t)+Yy(n[r])))}function Yy(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function QA(){return document.body.offsetHeight}function yI(n,e,t){const r=n[_c];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const Gf=Symbol("_vod"),eM=Symbol("_vsh"),tM={beforeMount(n,{value:e},{transition:t}){n[Gf]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):Qc(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),Qc(n,!0),r.enter(n)):r.leave(n,()=>{Qc(n,!1)}):Qc(n,e))},beforeUnmount(n,{value:e}){Qc(n,e)}};function Qc(n,e){n.style.display=e?n[Gf]:"none",n[eM]=!e}const _I=Symbol(""),xI=/(^|;)\s*display\s*:/;function wI(n,e,t){const r=n.style,i=jn(t);let o=!1;if(t&&!i){if(e)if(jn(e))for(const s of e.split(";")){const a=s.slice(0,s.indexOf(":")).trim();t[a]==null&&_f(r,a,"")}else for(const s in e)t[s]==null&&_f(r,s,"");for(const s in t)s==="display"&&(o=!0),_f(r,s,t[s])}else if(i){if(e!==t){const s=r[_I];s&&(t+=";"+s),r.cssText=t,o=xI.test(t)}}else e&&n.removeAttribute("style");Gf in n&&(n[Gf]=o?r.display:"",n[eM]&&(r.display="none"))}const Ky=/\s*!important$/;function _f(n,e,t){if(Ot(t))t.forEach(r=>_f(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=SI(n,e);Ky.test(t)?n.setProperty(ll(r),t.replace(Ky,""),"important"):n[r]=t}}const Zy=["Webkit","Moz","ms"],Hm={};function SI(n,e){const t=Hm[e];if(t)return t;let r=Ka(e);if(r!=="filter"&&r in n)return Hm[e]=r;r=qC(r);for(let i=0;i<Zy.length;i++){const o=Zy[i]+r;if(o in n)return Hm[e]=o}return e}const Jy="http://www.w3.org/1999/xlink";function Qy(n,e,t,r,i,o=PR(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Jy,e.slice(6,e.length)):n.setAttributeNS(Jy,e,t):t==null||o&&!KC(t)?n.removeAttribute(e):n.setAttribute(e,o?"":Qs(t)?String(t):t)}function CI(n,e,t,r){if(e==="innerHTML"||e==="textContent"){if(t==null)return;n[e]=t;return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const s=i==="OPTION"?n.getAttribute("value")||"":n.value,a=t==null?"":String(t);(s!==a||!("_value"in n))&&(n.value=a),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const s=typeof n[e];s==="boolean"?t=KC(t):t==null&&s==="string"?(t="",o=!0):s==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(e)}function AI(n,e,t,r){n.addEventListener(e,t,r)}function MI(n,e,t,r){n.removeEventListener(e,t,r)}const e_=Symbol("_vei");function TI(n,e,t,r,i=null){const o=n[e_]||(n[e_]={}),s=o[e];if(r&&s)s.value=r;else{const[a,l]=EI(e);if(r){const c=o[e]=II(r,i);AI(n,a,c,l)}else s&&(MI(n,a,s,l),o[e]=void 0)}}const t_=/(?:Once|Passive|Capture)$/;function EI(n){let e;if(t_.test(n)){e={};let r;for(;r=n.match(t_);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):ll(n.slice(2)),e]}let Vm=0;const PI=Promise.resolve(),RI=()=>Vm||(PI.then(()=>Vm=0),Vm=Date.now());function II(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;Ai(DI(r,t.value),e,5,[r])};return t.value=n,t.attached=RI(),t}function DI(n,e){if(Ot(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>i=>!i._stopped&&r&&r(i))}else return e}const n_=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,LI=(n,e,t,r,i,o)=>{const s=i==="svg";e==="class"?yI(n,r,s):e==="style"?wI(n,t,r):kp(e)?zv(e)||TI(n,e,t,r,o):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):FI(n,e,r,s))?(CI(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Qy(n,e,r,s,o,e!=="value")):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Qy(n,e,r,s))};function FI(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&n_(e)&&Ht(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const i=n.tagName;if(i==="IMG"||i==="VIDEO"||i==="CANVAS"||i==="SOURCE")return!1}return n_(e)&&jn(t)?!1:e in n}const nM=new WeakMap,rM=new WeakMap,Wf=Symbol("_moveCb"),r_=Symbol("_enterCb"),iM={name:"TransitionGroup",props:nr({},gI,{tag:String,moveClass:String}),setup(n,{slots:e}){const t=Td(),r=_A();let i,o;return MA(()=>{if(!i.length)return;const s=n.moveClass||`${n.name||"v"}-move`;if(!UI(i[0].el,t.vnode.el,s))return;i.forEach(BI),i.forEach(NI);const a=i.filter(zI);QA(),a.forEach(l=>{const c=l.el,u=c.style;Vo(c,s),u.transform=u.webkitTransform=u.transitionDuration="";const d=c[Wf]=h=>{h&&h.target!==c||(!h||/transform$/.test(h.propertyName))&&(c.removeEventListener("transitionend",d),c[Wf]=null,Ms(c,s))};c.addEventListener("transitionend",d)})}),()=>{const s=tn(n),a=ZA(s);let l=s.tag||$n;if(i=[],o)for(let c=0;c<o.length;c++){const u=o[c];u.el&&u.el instanceof Element&&(i.push(u),yc(u,id(u,a,r,t)),nM.set(u,u.el.getBoundingClientRect()))}o=e.default?Qv(e.default()):[];for(let c=0;c<o.length;c++){const u=o[c];u.key!=null&&yc(u,id(u,a,r,t))}return pn(l,null,o)}}},OI=n=>delete n.mode;iM.props;const kI=iM;function BI(n){const e=n.el;e[Wf]&&e[Wf](),e[r_]&&e[r_]()}function NI(n){rM.set(n,n.el.getBoundingClientRect())}function zI(n){const e=nM.get(n),t=rM.get(n),r=e.left-t.left,i=e.top-t.top;if(r||i){const o=n.el.style;return o.transform=o.webkitTransform=`translate(${r}px,${i}px)`,o.transitionDuration="0s",n}}function UI(n,e,t){const r=n.cloneNode(),i=n[_c];i&&i.forEach(a=>{a.split(/\s+/).forEach(l=>l&&r.classList.remove(l))}),t.split(/\s+/).forEach(a=>a&&r.classList.add(a)),r.style.display="none";const o=e.nodeType===1?e:e.parentNode;o.appendChild(r);const{hasTransform:s}=JA(r);return o.removeChild(r),s}const $I=nr({patchProp:LI},mI);let i_;function HI(){return i_||(i_=U3($I))}const VI=(...n)=>{const e=HI().createApp(...n),{mount:t}=e;return e.mount=r=>{const i=WI(r);if(!i)return;const o=e._component;!Ht(o)&&!o.render&&!o.template&&(o.template=i.innerHTML),i.innerHTML="";const s=t(i,!1,GI(i));return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),s},e};function GI(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function WI(n){return jn(n)?document.querySelector(n):n}function oM(n,e){return function(){return n.apply(e,arguments)}}const{toString:jI}=Object.prototype,{getPrototypeOf:lb}=Object,Xp=(n=>e=>{const t=jI.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Qi=n=>(n=n.toLowerCase(),e=>Xp(e)===n),Yp=n=>e=>typeof e===n,{isArray:Lc}=Array,ad=Yp("undefined");function qI(n){return n!==null&&!ad(n)&&n.constructor!==null&&!ad(n.constructor)&&di(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const sM=Qi("ArrayBuffer");function XI(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&sM(n.buffer),e}const YI=Yp("string"),di=Yp("function"),aM=Yp("number"),Kp=n=>n!==null&&typeof n=="object",KI=n=>n===!0||n===!1,xf=n=>{if(Xp(n)!=="object")return!1;const e=lb(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},ZI=Qi("Date"),JI=Qi("File"),QI=Qi("Blob"),e5=Qi("FileList"),t5=n=>Kp(n)&&di(n.pipe),n5=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||di(n.append)&&((e=Xp(n))==="formdata"||e==="object"&&di(n.toString)&&n.toString()==="[object FormData]"))},r5=Qi("URLSearchParams"),[i5,o5,s5,a5]=["ReadableStream","Request","Response","Headers"].map(Qi),l5=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Pd(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,i;if(typeof n!="object"&&(n=[n]),Lc(n))for(r=0,i=n.length;r<i;r++)e.call(null,n[r],r,n);else{const o=t?Object.getOwnPropertyNames(n):Object.keys(n),s=o.length;let a;for(r=0;r<s;r++)a=o[r],e.call(null,n[a],a,n)}}function lM(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,i;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}const Oa=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,cM=n=>!ad(n)&&n!==Oa;function g1(){const{caseless:n}=cM(this)&&this||{},e={},t=(r,i)=>{const o=n&&lM(e,i)||i;xf(e[o])&&xf(r)?e[o]=g1(e[o],r):xf(r)?e[o]=g1({},r):Lc(r)?e[o]=r.slice():e[o]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&Pd(arguments[r],t);return e}const c5=(n,e,t,{allOwnKeys:r}={})=>(Pd(e,(i,o)=>{t&&di(i)?n[o]=oM(i,t):n[o]=i},{allOwnKeys:r}),n),u5=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),d5=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},h5=(n,e,t,r)=>{let i,o,s;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),o=i.length;o-- >0;)s=i[o],(!r||r(s,n,e))&&!a[s]&&(e[s]=n[s],a[s]=!0);n=t!==!1&&lb(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},f5=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},p5=n=>{if(!n)return null;if(Lc(n))return n;let e=n.length;if(!aM(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},m5=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&lb(Uint8Array)),g5=(n,e)=>{const r=(n&&n[Symbol.iterator]).call(n);let i;for(;(i=r.next())&&!i.done;){const o=i.value;e.call(n,o[0],o[1])}},v5=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},b5=Qi("HTMLFormElement"),y5=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,i){return r.toUpperCase()+i}),o_=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),_5=Qi("RegExp"),uM=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};Pd(t,(i,o)=>{let s;(s=e(i,o,n))!==!1&&(r[o]=s||i)}),Object.defineProperties(n,r)},x5=n=>{uM(n,(e,t)=>{if(di(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(di(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},w5=(n,e)=>{const t={},r=i=>{i.forEach(o=>{t[o]=!0})};return Lc(n)?r(n):r(String(n).split(e)),t},S5=()=>{},C5=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e,Gm="abcdefghijklmnopqrstuvwxyz",s_="0123456789",dM={DIGIT:s_,ALPHA:Gm,ALPHA_DIGIT:Gm+Gm.toUpperCase()+s_},A5=(n=16,e=dM.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function M5(n){return!!(n&&di(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const T5=n=>{const e=new Array(10),t=(r,i)=>{if(Kp(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const o=Lc(r)?[]:{};return Pd(r,(s,a)=>{const l=t(s,i+1);!ad(l)&&(o[a]=l)}),e[i]=void 0,o}}return r};return t(n,0)},E5=Qi("AsyncFunction"),P5=n=>n&&(Kp(n)||di(n))&&di(n.then)&&di(n.catch),hM=((n,e)=>n?setImmediate:e?((t,r)=>(Oa.addEventListener("message",({source:i,data:o})=>{i===Oa&&o===t&&r.length&&r.shift()()},!1),i=>{r.push(i),Oa.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",di(Oa.postMessage)),R5=typeof queueMicrotask<"u"?queueMicrotask.bind(Oa):typeof process<"u"&&process.nextTick||hM,je={isArray:Lc,isArrayBuffer:sM,isBuffer:qI,isFormData:n5,isArrayBufferView:XI,isString:YI,isNumber:aM,isBoolean:KI,isObject:Kp,isPlainObject:xf,isReadableStream:i5,isRequest:o5,isResponse:s5,isHeaders:a5,isUndefined:ad,isDate:ZI,isFile:JI,isBlob:QI,isRegExp:_5,isFunction:di,isStream:t5,isURLSearchParams:r5,isTypedArray:m5,isFileList:e5,forEach:Pd,merge:g1,extend:c5,trim:l5,stripBOM:u5,inherits:d5,toFlatObject:h5,kindOf:Xp,kindOfTest:Qi,endsWith:f5,toArray:p5,forEachEntry:g5,matchAll:v5,isHTMLForm:b5,hasOwnProperty:o_,hasOwnProp:o_,reduceDescriptors:uM,freezeMethods:x5,toObjectSet:w5,toCamelCase:y5,noop:S5,toFiniteNumber:C5,findKey:lM,global:Oa,isContextDefined:cM,ALPHABET:dM,generateString:A5,isSpecCompliantForm:M5,toJSONObject:T5,isAsyncFn:E5,isThenable:P5,setImmediate:hM,asap:R5};function Wt(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i)}je.inherits(Wt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:je.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const fM=Wt.prototype,pM={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{pM[n]={value:n}});Object.defineProperties(Wt,pM);Object.defineProperty(fM,"isAxiosError",{value:!0});Wt.from=(n,e,t,r,i,o)=>{const s=Object.create(fM);return je.toFlatObject(n,s,function(l){return l!==Error.prototype},a=>a!=="isAxiosError"),Wt.call(s,n.message,e,t,r,i),s.cause=n,s.name=n.name,o&&Object.assign(s,o),s};const I5=null;function v1(n){return je.isPlainObject(n)||je.isArray(n)}function mM(n){return je.endsWith(n,"[]")?n.slice(0,-2):n}function a_(n,e,t){return n?n.concat(e).map(function(i,o){return i=mM(i),!t&&o?"["+i+"]":i}).join(t?".":""):e}function D5(n){return je.isArray(n)&&!n.some(v1)}const L5=je.toFlatObject(je,{},null,function(e){return/^is[A-Z]/.test(e)});function Zp(n,e,t){if(!je.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=je.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,g){return!je.isUndefined(g[v])});const r=t.metaTokens,i=t.visitor||u,o=t.dots,s=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&je.isSpecCompliantForm(e);if(!je.isFunction(i))throw new TypeError("visitor must be a function");function c(f){if(f===null)return"";if(je.isDate(f))return f.toISOString();if(!l&&je.isBlob(f))throw new Wt("Blob is not supported. Use a Buffer instead.");return je.isArrayBuffer(f)||je.isTypedArray(f)?l&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function u(f,v,g){let b=f;if(f&&!g&&typeof f=="object"){if(je.endsWith(v,"{}"))v=r?v:v.slice(0,-2),f=JSON.stringify(f);else if(je.isArray(f)&&D5(f)||(je.isFileList(f)||je.endsWith(v,"[]"))&&(b=je.toArray(f)))return v=mM(v),b.forEach(function(p,y){!(je.isUndefined(p)||p===null)&&e.append(s===!0?a_([v],y,o):s===null?v:v+"[]",c(p))}),!1}return v1(f)?!0:(e.append(a_(g,v,o),c(f)),!1)}const d=[],h=Object.assign(L5,{defaultVisitor:u,convertValue:c,isVisitable:v1});function m(f,v){if(!je.isUndefined(f)){if(d.indexOf(f)!==-1)throw Error("Circular reference detected in "+v.join("."));d.push(f),je.forEach(f,function(b,S){(!(je.isUndefined(b)||b===null)&&i.call(e,b,je.isString(S)?S.trim():S,v,h))===!0&&m(b,v?v.concat(S):[S])}),d.pop()}}if(!je.isObject(n))throw new TypeError("data must be an object");return m(n),e}function l_(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function cb(n,e){this._pairs=[],n&&Zp(n,this,e)}const gM=cb.prototype;gM.append=function(e,t){this._pairs.push([e,t])};gM.toString=function(e){const t=e?function(r){return e.call(this,r,l_)}:l_;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function F5(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function vM(n,e,t){if(!e)return n;const r=t&&t.encode||F5,i=t&&t.serialize;let o;if(i?o=i(e,t):o=je.isURLSearchParams(e)?e.toString():new cb(e,t).toString(r),o){const s=n.indexOf("#");s!==-1&&(n=n.slice(0,s)),n+=(n.indexOf("?")===-1?"?":"&")+o}return n}class c_{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){je.forEach(this.handlers,function(r){r!==null&&e(r)})}}const bM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},O5=typeof URLSearchParams<"u"?URLSearchParams:cb,k5=typeof FormData<"u"?FormData:null,B5=typeof Blob<"u"?Blob:null,N5={isBrowser:!0,classes:{URLSearchParams:O5,FormData:k5,Blob:B5},protocols:["http","https","file","blob","url","data"]},ub=typeof window<"u"&&typeof document<"u",z5=(n=>ub&&["ReactNative","NativeScript","NS"].indexOf(n)<0)(typeof navigator<"u"&&navigator.product),U5=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",$5=ub&&window.location.href||"http://localhost",H5=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ub,hasStandardBrowserEnv:z5,hasStandardBrowserWebWorkerEnv:U5,origin:$5},Symbol.toStringTag,{value:"Module"})),Yi={...H5,...N5};function V5(n,e){return Zp(n,new Yi.classes.URLSearchParams,Object.assign({visitor:function(t,r,i,o){return Yi.isNode&&je.isBuffer(t)?(this.append(r,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function G5(n){return je.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function W5(n){const e={},t=Object.keys(n);let r;const i=t.length;let o;for(r=0;r<i;r++)o=t[r],e[o]=n[o];return e}function yM(n){function e(t,r,i,o){let s=t[o++];if(s==="__proto__")return!0;const a=Number.isFinite(+s),l=o>=t.length;return s=!s&&je.isArray(i)?i.length:s,l?(je.hasOwnProp(i,s)?i[s]=[i[s],r]:i[s]=r,!a):((!i[s]||!je.isObject(i[s]))&&(i[s]=[]),e(t,r,i[s],o)&&je.isArray(i[s])&&(i[s]=W5(i[s])),!a)}if(je.isFormData(n)&&je.isFunction(n.entries)){const t={};return je.forEachEntry(n,(r,i)=>{e(G5(r),i,t,0)}),t}return null}function j5(n,e,t){if(je.isString(n))try{return(e||JSON.parse)(n),je.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const Rd={transitional:bM,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",i=r.indexOf("application/json")>-1,o=je.isObject(e);if(o&&je.isHTMLForm(e)&&(e=new FormData(e)),je.isFormData(e))return i?JSON.stringify(yM(e)):e;if(je.isArrayBuffer(e)||je.isBuffer(e)||je.isStream(e)||je.isFile(e)||je.isBlob(e)||je.isReadableStream(e))return e;if(je.isArrayBufferView(e))return e.buffer;if(je.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(r.indexOf("application/x-www-form-urlencoded")>-1)return V5(e,this.formSerializer).toString();if((a=je.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Zp(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return o||i?(t.setContentType("application/json",!1),j5(e)):e}],transformResponse:[function(e){const t=this.transitional||Rd.transitional,r=t&&t.forcedJSONParsing,i=this.responseType==="json";if(je.isResponse(e)||je.isReadableStream(e))return e;if(e&&je.isString(e)&&(r&&!this.responseType||i)){const s=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(s)throw a.name==="SyntaxError"?Wt.from(a,Wt.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Yi.classes.FormData,Blob:Yi.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};je.forEach(["delete","get","head","post","put","patch"],n=>{Rd.headers[n]={}});const q5=je.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),X5=n=>{const e={};let t,r,i;return n&&n.split(`
`).forEach(function(s){i=s.indexOf(":"),t=s.substring(0,i).trim().toLowerCase(),r=s.substring(i+1).trim(),!(!t||e[t]&&q5[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},u_=Symbol("internals");function eu(n){return n&&String(n).trim().toLowerCase()}function wf(n){return n===!1||n==null?n:je.isArray(n)?n.map(wf):String(n)}function Y5(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const K5=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Wm(n,e,t,r,i){if(je.isFunction(r))return r.call(this,e,t);if(i&&(e=t),!!je.isString(e)){if(je.isString(r))return e.indexOf(r)!==-1;if(je.isRegExp(r))return r.test(e)}}function Z5(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function J5(n,e){const t=je.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(i,o,s){return this[r].call(this,e,i,o,s)},configurable:!0})})}class Yr{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function o(a,l,c){const u=eu(l);if(!u)throw new Error("header name must be a non-empty string");const d=je.findKey(i,u);(!d||i[d]===void 0||c===!0||c===void 0&&i[d]!==!1)&&(i[d||l]=wf(a))}const s=(a,l)=>je.forEach(a,(c,u)=>o(c,u,l));if(je.isPlainObject(e)||e instanceof this.constructor)s(e,t);else if(je.isString(e)&&(e=e.trim())&&!K5(e))s(X5(e),t);else if(je.isHeaders(e))for(const[a,l]of e.entries())o(l,a,r);else e!=null&&o(t,e,r);return this}get(e,t){if(e=eu(e),e){const r=je.findKey(this,e);if(r){const i=this[r];if(!t)return i;if(t===!0)return Y5(i);if(je.isFunction(t))return t.call(this,i,r);if(je.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=eu(e),e){const r=je.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||Wm(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let i=!1;function o(s){if(s=eu(s),s){const a=je.findKey(r,s);a&&(!t||Wm(r,r[a],a,t))&&(delete r[a],i=!0)}}return je.isArray(e)?e.forEach(o):o(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;for(;r--;){const o=t[r];(!e||Wm(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){const t=this,r={};return je.forEach(this,(i,o)=>{const s=je.findKey(r,o);if(s){t[s]=wf(i),delete t[o];return}const a=e?Z5(o):String(o).trim();a!==o&&delete t[o],t[a]=wf(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return je.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&je.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(i=>r.set(i)),r}static accessor(e){const r=(this[u_]=this[u_]={accessors:{}}).accessors,i=this.prototype;function o(s){const a=eu(s);r[a]||(J5(i,s),r[a]=!0)}return je.isArray(e)?e.forEach(o):o(e),this}}Yr.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);je.reduceDescriptors(Yr.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});je.freezeMethods(Yr);function jm(n,e){const t=this||Rd,r=e||t,i=Yr.from(r.headers);let o=r.data;return je.forEach(n,function(a){o=a.call(t,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function _M(n){return!!(n&&n.__CANCEL__)}function Fc(n,e,t){Wt.call(this,n??"canceled",Wt.ERR_CANCELED,e,t),this.name="CanceledError"}je.inherits(Fc,Wt,{__CANCEL__:!0});function xM(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Wt("Request failed with status code "+t.status,[Wt.ERR_BAD_REQUEST,Wt.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Q5(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function e4(n,e){n=n||10;const t=new Array(n),r=new Array(n);let i=0,o=0,s;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=r[o];s||(s=c),t[i]=l,r[i]=c;let d=o,h=0;for(;d!==i;)h+=t[d++],d=d%n;if(i=(i+1)%n,i===o&&(o=(o+1)%n),c-s<e)return;const m=u&&c-u;return m?Math.round(h*1e3/m):void 0}}function t4(n,e){let t=0,r=1e3/e,i,o;const s=(c,u=Date.now())=>{t=u,i=null,o&&(clearTimeout(o),o=null),n.apply(null,c)};return[(...c)=>{const u=Date.now(),d=u-t;d>=r?s(c,u):(i=c,o||(o=setTimeout(()=>{o=null,s(i)},r-d)))},()=>i&&s(i)]}const jf=(n,e,t=3)=>{let r=0;const i=e4(50,250);return t4(o=>{const s=o.loaded,a=o.lengthComputable?o.total:void 0,l=s-r,c=i(l),u=s<=a;r=s;const d={loaded:s,total:a,progress:a?s/a:void 0,bytes:l,rate:c||void 0,estimated:c&&a&&u?(a-s)/c:void 0,event:o,lengthComputable:a!=null,[e?"download":"upload"]:!0};n(d)},t)},d_=(n,e)=>{const t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},h_=n=>(...e)=>je.asap(()=>n(...e)),n4=Yi.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let r;function i(o){let s=o;return e&&(t.setAttribute("href",s),s=t.href),t.setAttribute("href",s),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return r=i(window.location.href),function(s){const a=je.isString(s)?i(s):s;return a.protocol===r.protocol&&a.host===r.host}}():function(){return function(){return!0}}(),r4=Yi.hasStandardBrowserEnv?{write(n,e,t,r,i,o){const s=[n+"="+encodeURIComponent(e)];je.isNumber(t)&&s.push("expires="+new Date(t).toGMTString()),je.isString(r)&&s.push("path="+r),je.isString(i)&&s.push("domain="+i),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function i4(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function o4(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function wM(n,e){return n&&!i4(e)?o4(n,e):e}const f_=n=>n instanceof Yr?{...n}:n;function Qa(n,e){e=e||{};const t={};function r(c,u,d){return je.isPlainObject(c)&&je.isPlainObject(u)?je.merge.call({caseless:d},c,u):je.isPlainObject(u)?je.merge({},u):je.isArray(u)?u.slice():u}function i(c,u,d){if(je.isUndefined(u)){if(!je.isUndefined(c))return r(void 0,c,d)}else return r(c,u,d)}function o(c,u){if(!je.isUndefined(u))return r(void 0,u)}function s(c,u){if(je.isUndefined(u)){if(!je.isUndefined(c))return r(void 0,c)}else return r(void 0,u)}function a(c,u,d){if(d in e)return r(c,u);if(d in n)return r(void 0,c)}const l={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(c,u)=>i(f_(c),f_(u),!0)};return je.forEach(Object.keys(Object.assign({},n,e)),function(u){const d=l[u]||i,h=d(n[u],e[u],u);je.isUndefined(h)&&d!==a||(t[u]=h)}),t}const SM=n=>{const e=Qa({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:o,headers:s,auth:a}=e;e.headers=s=Yr.from(s),e.url=vM(wM(e.baseURL,e.url),n.params,n.paramsSerializer),a&&s.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let l;if(je.isFormData(t)){if(Yi.hasStandardBrowserEnv||Yi.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if((l=s.getContentType())!==!1){const[c,...u]=l?l.split(";").map(d=>d.trim()).filter(Boolean):[];s.setContentType([c||"multipart/form-data",...u].join("; "))}}if(Yi.hasStandardBrowserEnv&&(r&&je.isFunction(r)&&(r=r(e)),r||r!==!1&&n4(e.url))){const c=i&&o&&r4.read(o);c&&s.set(i,c)}return e},s4=typeof XMLHttpRequest<"u",a4=s4&&function(n){return new Promise(function(t,r){const i=SM(n);let o=i.data;const s=Yr.from(i.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:c}=i,u,d,h,m,f;function v(){m&&m(),f&&f(),i.cancelToken&&i.cancelToken.unsubscribe(u),i.signal&&i.signal.removeEventListener("abort",u)}let g=new XMLHttpRequest;g.open(i.method.toUpperCase(),i.url,!0),g.timeout=i.timeout;function b(){if(!g)return;const p=Yr.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),w={data:!a||a==="text"||a==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:p,config:n,request:g};xM(function(_){t(_),v()},function(_){r(_),v()},w),g=null}"onloadend"in g?g.onloadend=b:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(b)},g.onabort=function(){g&&(r(new Wt("Request aborted",Wt.ECONNABORTED,n,g)),g=null)},g.onerror=function(){r(new Wt("Network Error",Wt.ERR_NETWORK,n,g)),g=null},g.ontimeout=function(){let y=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const w=i.transitional||bM;i.timeoutErrorMessage&&(y=i.timeoutErrorMessage),r(new Wt(y,w.clarifyTimeoutError?Wt.ETIMEDOUT:Wt.ECONNABORTED,n,g)),g=null},o===void 0&&s.setContentType(null),"setRequestHeader"in g&&je.forEach(s.toJSON(),function(y,w){g.setRequestHeader(w,y)}),je.isUndefined(i.withCredentials)||(g.withCredentials=!!i.withCredentials),a&&a!=="json"&&(g.responseType=i.responseType),c&&([h,f]=jf(c,!0),g.addEventListener("progress",h)),l&&g.upload&&([d,m]=jf(l),g.upload.addEventListener("progress",d),g.upload.addEventListener("loadend",m)),(i.cancelToken||i.signal)&&(u=p=>{g&&(r(!p||p.type?new Fc(null,n,g):p),g.abort(),g=null)},i.cancelToken&&i.cancelToken.subscribe(u),i.signal&&(i.signal.aborted?u():i.signal.addEventListener("abort",u)));const S=Q5(i.url);if(S&&Yi.protocols.indexOf(S)===-1){r(new Wt("Unsupported protocol "+S+":",Wt.ERR_BAD_REQUEST,n));return}g.send(o||null)})},l4=(n,e)=>{let t=new AbortController,r;const i=function(l){if(!r){r=!0,s();const c=l instanceof Error?l:this.reason;t.abort(c instanceof Wt?c:new Fc(c instanceof Error?c.message:c))}};let o=e&&setTimeout(()=>{i(new Wt(`timeout ${e} of ms exceeded`,Wt.ETIMEDOUT))},e);const s=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(l=>{l&&(l.removeEventListener?l.removeEventListener("abort",i):l.unsubscribe(i))}),n=null)};n.forEach(l=>l&&l.addEventListener&&l.addEventListener("abort",i));const{signal:a}=t;return a.unsubscribe=s,[a,()=>{o&&clearTimeout(o),o=null}]},c4=function*(n,e){let t=n.byteLength;if(!e||t<e){yield n;return}let r=0,i;for(;r<t;)i=r+e,yield n.slice(r,i),r=i},u4=async function*(n,e,t){for await(const r of n)yield*c4(ArrayBuffer.isView(r)?r:await t(String(r)),e)},p_=(n,e,t,r,i)=>{const o=u4(n,e,i);let s=0,a,l=c=>{a||(a=!0,r&&r(c))};return new ReadableStream({async pull(c){try{const{done:u,value:d}=await o.next();if(u){l(),c.close();return}let h=d.byteLength;if(t){let m=s+=h;t(m)}c.enqueue(new Uint8Array(d))}catch(u){throw l(u),u}},cancel(c){return l(c),o.return()}},{highWaterMark:2})},Jp=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",CM=Jp&&typeof ReadableStream=="function",b1=Jp&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),AM=(n,...e)=>{try{return!!n(...e)}catch{return!1}},d4=CM&&AM(()=>{let n=!1;const e=new Request(Yi.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),m_=64*1024,y1=CM&&AM(()=>je.isReadableStream(new Response("").body)),qf={stream:y1&&(n=>n.body)};Jp&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!qf[e]&&(qf[e]=je.isFunction(n[e])?t=>t[e]():(t,r)=>{throw new Wt(`Response type '${e}' is not supported`,Wt.ERR_NOT_SUPPORT,r)})})})(new Response);const h4=async n=>{if(n==null)return 0;if(je.isBlob(n))return n.size;if(je.isSpecCompliantForm(n))return(await new Request(n).arrayBuffer()).byteLength;if(je.isArrayBufferView(n)||je.isArrayBuffer(n))return n.byteLength;if(je.isURLSearchParams(n)&&(n=n+""),je.isString(n))return(await b1(n)).byteLength},f4=async(n,e)=>{const t=je.toFiniteNumber(n.getContentLength());return t??h4(e)},p4=Jp&&(async n=>{let{url:e,method:t,data:r,signal:i,cancelToken:o,timeout:s,onDownloadProgress:a,onUploadProgress:l,responseType:c,headers:u,withCredentials:d="same-origin",fetchOptions:h}=SM(n);c=c?(c+"").toLowerCase():"text";let[m,f]=i||o||s?l4([i,o],s):[],v,g;const b=()=>{!v&&setTimeout(()=>{m&&m.unsubscribe()}),v=!0};let S;try{if(l&&d4&&t!=="get"&&t!=="head"&&(S=await f4(u,r))!==0){let x=new Request(e,{method:"POST",body:r,duplex:"half"}),_;if(je.isFormData(r)&&(_=x.headers.get("content-type"))&&u.setContentType(_),x.body){const[A,C]=d_(S,jf(h_(l)));r=p_(x.body,m_,A,C,b1)}}je.isString(d)||(d=d?"include":"omit"),g=new Request(e,{...h,signal:m,method:t.toUpperCase(),headers:u.normalize().toJSON(),body:r,duplex:"half",credentials:d});let p=await fetch(g);const y=y1&&(c==="stream"||c==="response");if(y1&&(a||y)){const x={};["status","statusText","headers"].forEach(T=>{x[T]=p[T]});const _=je.toFiniteNumber(p.headers.get("content-length")),[A,C]=a&&d_(_,jf(h_(a),!0))||[];p=new Response(p_(p.body,m_,A,()=>{C&&C(),y&&b()},b1),x)}c=c||"text";let w=await qf[je.findKey(qf,c)||"text"](p,n);return!y&&b(),f&&f(),await new Promise((x,_)=>{xM(x,_,{data:w,headers:Yr.from(p.headers),status:p.status,statusText:p.statusText,config:n,request:g})})}catch(p){throw b(),p&&p.name==="TypeError"&&/fetch/i.test(p.message)?Object.assign(new Wt("Network Error",Wt.ERR_NETWORK,n,g),{cause:p.cause||p}):Wt.from(p,p&&p.code,n,g)}}),_1={http:I5,xhr:a4,fetch:p4};je.forEach(_1,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const g_=n=>`- ${n}`,m4=n=>je.isFunction(n)||n===null||n===!1,MM={getAdapter:n=>{n=je.isArray(n)?n:[n];const{length:e}=n;let t,r;const i={};for(let o=0;o<e;o++){t=n[o];let s;if(r=t,!m4(t)&&(r=_1[(s=String(t)).toLowerCase()],r===void 0))throw new Wt(`Unknown adapter '${s}'`);if(r)break;i[s||"#"+o]=r}if(!r){const o=Object.entries(i).map(([a,l])=>`adapter ${a} `+(l===!1?"is not supported by the environment":"is not available in the build"));let s=e?o.length>1?`since :
`+o.map(g_).join(`
`):" "+g_(o[0]):"as no adapter specified";throw new Wt("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return r},adapters:_1};function qm(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Fc(null,n)}function v_(n){return qm(n),n.headers=Yr.from(n.headers),n.data=jm.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),MM.getAdapter(n.adapter||Rd.adapter)(n).then(function(r){return qm(n),r.data=jm.call(n,n.transformResponse,r),r.headers=Yr.from(r.headers),r},function(r){return _M(r)||(qm(n),r&&r.response&&(r.response.data=jm.call(n,n.transformResponse,r.response),r.response.headers=Yr.from(r.response.headers))),Promise.reject(r)})}const TM="1.7.3",db={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{db[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const b_={};db.transitional=function(e,t,r){function i(o,s){return"[Axios v"+TM+"] Transitional option '"+o+"'"+s+(r?". "+r:"")}return(o,s,a)=>{if(e===!1)throw new Wt(i(s," has been removed"+(t?" in "+t:"")),Wt.ERR_DEPRECATED);return t&&!b_[s]&&(b_[s]=!0,console.warn(i(s," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,s,a):!0}};function g4(n,e,t){if(typeof n!="object")throw new Wt("options must be an object",Wt.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let i=r.length;for(;i-- >0;){const o=r[i],s=e[o];if(s){const a=n[o],l=a===void 0||s(a,o,n);if(l!==!0)throw new Wt("option "+o+" must be "+l,Wt.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Wt("Unknown option "+o,Wt.ERR_BAD_OPTION)}}const x1={assertOptions:g4,validators:db},ps=x1.validators;class $a{constructor(e){this.defaults=e,this.interceptors={request:new c_,response:new c_}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;const o=i.stack?i.stack.replace(/^.+\n/,""):"";try{r.stack?o&&!String(r.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+o):r.stack=o}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Qa(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:o}=t;r!==void 0&&x1.assertOptions(r,{silentJSONParsing:ps.transitional(ps.boolean),forcedJSONParsing:ps.transitional(ps.boolean),clarifyTimeoutError:ps.transitional(ps.boolean)},!1),i!=null&&(je.isFunction(i)?t.paramsSerializer={serialize:i}:x1.assertOptions(i,{encode:ps.function,serialize:ps.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=o&&je.merge(o.common,o[t.method]);o&&je.forEach(["delete","get","head","post","put","patch","common"],f=>{delete o[f]}),t.headers=Yr.concat(s,o);const a=[];let l=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(t)===!1||(l=l&&v.synchronous,a.unshift(v.fulfilled,v.rejected))});const c=[];this.interceptors.response.forEach(function(v){c.push(v.fulfilled,v.rejected)});let u,d=0,h;if(!l){const f=[v_.bind(this),void 0];for(f.unshift.apply(f,a),f.push.apply(f,c),h=f.length,u=Promise.resolve(t);d<h;)u=u.then(f[d++],f[d++]);return u}h=a.length;let m=t;for(d=0;d<h;){const f=a[d++],v=a[d++];try{m=f(m)}catch(g){v.call(this,g);break}}try{u=v_.call(this,m)}catch(f){return Promise.reject(f)}for(d=0,h=c.length;d<h;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=Qa(this.defaults,e);const t=wM(e.baseURL,e.url);return vM(t,e.params,e.paramsSerializer)}}je.forEach(["delete","get","head","options"],function(e){$a.prototype[e]=function(t,r){return this.request(Qa(r||{},{method:e,url:t,data:(r||{}).data}))}});je.forEach(["post","put","patch"],function(e){function t(r){return function(o,s,a){return this.request(Qa(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}$a.prototype[e]=t(),$a.prototype[e+"Form"]=t(!0)});class hb{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});const r=this;this.promise.then(i=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](i);r._listeners=null}),this.promise.then=i=>{let o;const s=new Promise(a=>{r.subscribe(a),o=a}).then(i);return s.cancel=function(){r.unsubscribe(o)},s},e(function(o,s,a){r.reason||(r.reason=new Fc(o,s,a),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new hb(function(i){e=i}),cancel:e}}}function v4(n){return function(t){return n.apply(null,t)}}function b4(n){return je.isObject(n)&&n.isAxiosError===!0}const w1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(w1).forEach(([n,e])=>{w1[e]=n});function EM(n){const e=new $a(n),t=oM($a.prototype.request,e);return je.extend(t,$a.prototype,e,{allOwnKeys:!0}),je.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return EM(Qa(n,i))},t}const Zn=EM(Rd);Zn.Axios=$a;Zn.CanceledError=Fc;Zn.CancelToken=hb;Zn.isCancel=_M;Zn.VERSION=TM;Zn.toFormData=Zp;Zn.AxiosError=Wt;Zn.Cancel=Zn.CanceledError;Zn.all=function(e){return Promise.all(e)};Zn.spread=v4;Zn.isAxiosError=b4;Zn.mergeConfig=Qa;Zn.AxiosHeaders=Yr;Zn.formToJSON=n=>yM(je.isHTMLForm(n)?new FormData(n):n);Zn.getAdapter=MM.getAdapter;Zn.HttpStatusCode=w1;Zn.default=Zn;function y4(n,e){return Mn(),fr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[Yn("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})])}function _4(n,e){return Mn(),fr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[Yn("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m18.75 4.5-7.5 7.5 7.5 7.5m-6-15L5.25 12l7.5 7.5"})])}function x4(n,e){return Mn(),fr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[Yn("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m5.25 4.5 7.5 7.5-7.5 7.5m6-15 7.5 7.5-7.5 7.5"})])}function w4(n,e){return Mn(),fr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[Yn("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"})])}function S4(n,e){return Mn(),fr("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[Yn("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5m.75-9 3-3 2.148 2.148A12.061 12.061 0 0 1 16.5 7.605"})])}let Xf=[];const PM=new WeakMap;function C4(){Xf.forEach(n=>n(...PM.get(n))),Xf=[]}function RM(n,...e){PM.set(n,e),!Xf.includes(n)&&Xf.push(n)===1&&requestAnimationFrame(C4)}function Uu(n,e){let{target:t}=n;for(;t;){if(t.dataset&&t.dataset[e]!==void 0)return!0;t=t.parentElement}return!1}function ld(n){return n.composedPath()[0]||null}function cd(n){return typeof n=="string"?n.endsWith("px")?Number(n.slice(0,n.length-2)):Number(n):n}function nh(n){if(n!=null)return typeof n=="number"?`${n}px`:n.endsWith("px")?n:`${n}px`}function Zo(n,e){const t=n.trim().split(/\s+/g),r={top:t[0]};switch(t.length){case 1:r.right=t[0],r.bottom=t[0],r.left=t[0];break;case 2:r.right=t[1],r.left=t[1],r.bottom=t[0];break;case 3:r.right=t[1],r.bottom=t[2],r.left=t[1];break;case 4:r.right=t[1],r.bottom=t[2],r.left=t[3];break;default:throw new Error("[seemly/getMargin]:"+n+" is not a valid value.")}return e===void 0?r:r[e]}const y_={black:"#000",silver:"#C0C0C0",gray:"#808080",white:"#FFF",maroon:"#800000",red:"#F00",purple:"#800080",fuchsia:"#F0F",green:"#008000",lime:"#0F0",olive:"#808000",yellow:"#FF0",navy:"#000080",blue:"#00F",teal:"#008080",aqua:"#0FF",transparent:"#0000"},Oc="^\\s*",kc="\\s*$",ka="\\s*((\\.\\d+)|(\\d+(\\.\\d*)?))\\s*",Ba="([0-9A-Fa-f])",Na="([0-9A-Fa-f]{2})",A4=new RegExp(`${Oc}rgb\\s*\\(${ka},${ka},${ka}\\)${kc}`),M4=new RegExp(`${Oc}rgba\\s*\\(${ka},${ka},${ka},${ka}\\)${kc}`),T4=new RegExp(`${Oc}#${Ba}${Ba}${Ba}${kc}`),E4=new RegExp(`${Oc}#${Na}${Na}${Na}${kc}`),P4=new RegExp(`${Oc}#${Ba}${Ba}${Ba}${Ba}${kc}`),R4=new RegExp(`${Oc}#${Na}${Na}${Na}${Na}${kc}`);function $r(n){return parseInt(n,16)}function qs(n){try{let e;if(e=E4.exec(n))return[$r(e[1]),$r(e[2]),$r(e[3]),1];if(e=A4.exec(n))return[Sr(e[1]),Sr(e[5]),Sr(e[9]),1];if(e=M4.exec(n))return[Sr(e[1]),Sr(e[5]),Sr(e[9]),$u(e[13])];if(e=T4.exec(n))return[$r(e[1]+e[1]),$r(e[2]+e[2]),$r(e[3]+e[3]),1];if(e=R4.exec(n))return[$r(e[1]),$r(e[2]),$r(e[3]),$u($r(e[4])/255)];if(e=P4.exec(n))return[$r(e[1]+e[1]),$r(e[2]+e[2]),$r(e[3]+e[3]),$u($r(e[4]+e[4])/255)];if(n in y_)return qs(y_[n]);throw new Error(`[seemly/rgba]: Invalid color value ${n}.`)}catch(e){throw e}}function I4(n){return n>1?1:n<0?0:n}function S1(n,e,t,r){return`rgba(${Sr(n)}, ${Sr(e)}, ${Sr(t)}, ${I4(r)})`}function Xm(n,e,t,r,i){return Sr((n*e*(1-r)+t*r)/i)}function $i(n,e){Array.isArray(n)||(n=qs(n)),Array.isArray(e)||(e=qs(e));const t=n[3],r=e[3],i=$u(t+r-t*r);return S1(Xm(n[0],t,e[0],r,i),Xm(n[1],t,e[1],r,i),Xm(n[2],t,e[2],r,i),i)}function Nt(n,e){const[t,r,i,o=1]=Array.isArray(n)?n:qs(n);return e.alpha?S1(t,r,i,e.alpha):S1(t,r,i,o)}function rh(n,e){const[t,r,i,o=1]=Array.isArray(n)?n:qs(n),{lightness:s=1,alpha:a=1}=e;return D4([t*s,r*s,i*s,o*a])}function $u(n){const e=Math.round(Number(n)*100)/100;return e>1?1:e<0?0:e}function Sr(n){const e=Math.round(Number(n));return e>255?255:e<0?0:e}function D4(n){const[e,t,r]=n;return 3 in n?`rgba(${Sr(e)}, ${Sr(t)}, ${Sr(r)}, ${$u(n[3])})`:`rgba(${Sr(e)}, ${Sr(t)}, ${Sr(r)}, 1)`}function L4(n=8){return Math.random().toString(16).slice(2,2+n)}function F4(n,e=[],t){const r={};return e.forEach(i=>{r[i]=n[i]}),Object.assign(r,t)}function C1(n,e=!0,t=[]){return n.forEach(r=>{if(r!==null){if(typeof r!="object"){(typeof r=="string"||typeof r=="number")&&t.push(Ja(String(r)));return}if(Array.isArray(r)){C1(r,e,t);return}if(r.type===$n){if(r.children===null)return;Array.isArray(r.children)&&C1(r.children,e,t)}else{if(r.type===mr&&e)return;t.push(r)}}}),t}function zt(n,...e){if(Array.isArray(n))n.forEach(t=>zt(t,...e));else return n(...e)}function Jl(n,...e){return typeof n=="function"?n(...e):typeof n=="string"?Ja(n):typeof n=="number"?Ja(String(n)):null}function A1(n,e){console.error(`[naive/${n}]: ${e}`)}function O4(n,e){throw new Error(`[naive/${n}]: ${e}`)}function __(n){switch(typeof n){case"string":return n||void 0;case"number":return String(n);default:return}}function x_(n,e="default",t=void 0){const r=n[e];if(!r)return A1("getFirstSlotVNode",`slot[${e}] is empty`),null;const i=C1(r(t));return i.length===1?i[0]:(A1("getFirstSlotVNode",`slot[${e}] should have exactly one child`),null)}function Id(n){return n.some(e=>sd(e)?!(e.type===mr||e.type===$n&&!Id(e.children)):!0)?n:null}function Ki(n,e){return n&&Id(n())||e()}function k4(n,e,t){return n&&Id(n(e))||t(e)}function vr(n,e){const t=n&&Id(n());return e(t||null)}function M1(n){return!(n&&Id(n()))}function Ym(n){const e=n.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?e[0]:t=>{n.forEach(r=>{r&&r(t)})}}const T1=Vt({render(){var n,e;return(e=(n=this.$slots).default)===null||e===void 0?void 0:e.call(n)}}),B4=/^(\d|\.)+$/,w_=/(\d|\.)+/;function fo(n,{c:e=1,offset:t=0,attachPx:r=!0}={}){if(typeof n=="number"){const i=(n+t)*e;return i===0?"0":`${i}px`}else if(typeof n=="string")if(B4.test(n)){const i=(Number(n)+t)*e;return r?i===0?"0":`${i}px`:`${i}`}else{const i=w_.exec(n);return i?n.replace(w_,String((Number(i[0])+t)*e)):n}return n}function Yf(n){return n.replace(/#|\(|\)|,|\s|\./g,"_")}function N4(n){const{left:e,right:t,top:r,bottom:i}=Zo(n);return`${r} ${t} ${i} ${e}`}function z4(n){let e=0;for(let t=0;t<n.length;++t)n[t]==="&"&&++e;return e}const IM=/\s*,(?![^(]*\))\s*/g,U4=/\s+/g;function $4(n,e){const t=[];return e.split(IM).forEach(r=>{let i=z4(r);if(i){if(i===1){n.forEach(s=>{t.push(r.replace("&",s))});return}}else{n.forEach(s=>{t.push((s&&s+" ")+r)});return}let o=[r];for(;i--;){const s=[];o.forEach(a=>{n.forEach(l=>{s.push(a.replace("&",l))})}),o=s}o.forEach(s=>t.push(s))}),t}function H4(n,e){const t=[];return e.split(IM).forEach(r=>{n.forEach(i=>{t.push((i&&i+" ")+r)})}),t}function V4(n){let e=[""];return n.forEach(t=>{t=t&&t.trim(),t&&(t.includes("&")?e=$4(e,t):e=H4(e,t))}),e.join(", ").replace(U4," ")}function S_(n){if(!n)return;const e=n.parentElement;e&&e.removeChild(n)}function Qp(n,e){return(e??document.head).querySelector(`style[cssr-id="${n}"]`)}function G4(n){const e=document.createElement("style");return e.setAttribute("cssr-id",n),e}function ih(n){return n?/^\s*@(s|m)/.test(n):!1}const W4=/[A-Z]/g;function DM(n){return n.replace(W4,e=>"-"+e.toLowerCase())}function j4(n,e="  "){return typeof n=="object"&&n!==null?` {
`+Object.entries(n).map(t=>e+`  ${DM(t[0])}: ${t[1]};`).join(`
`)+`
`+e+"}":`: ${n};`}function q4(n,e,t){return typeof n=="function"?n({context:e.context,props:t}):n}function C_(n,e,t,r){if(!e)return"";const i=q4(e,t,r);if(!i)return"";if(typeof i=="string")return`${n} {
${i}
}`;const o=Object.keys(i);if(o.length===0)return t.config.keepEmptyBlock?n+` {
}`:"";const s=n?[n+" {"]:[];return o.forEach(a=>{const l=i[a];if(a==="raw"){s.push(`
`+l+`
`);return}a=DM(a),l!=null&&s.push(`  ${a}${j4(l)}`)}),n&&s.push("}"),s.join(`
`)}function E1(n,e,t){n&&n.forEach(r=>{if(Array.isArray(r))E1(r,e,t);else if(typeof r=="function"){const i=r(e);Array.isArray(i)?E1(i,e,t):i&&t(i)}else r&&t(r)})}function LM(n,e,t,r,i){const o=n.$;let s="";if(!o||typeof o=="string")ih(o)?s=o:e.push(o);else if(typeof o=="function"){const c=o({context:r.context,props:i});ih(c)?s=c:e.push(c)}else if(o.before&&o.before(r.context),!o.$||typeof o.$=="string")ih(o.$)?s=o.$:e.push(o.$);else if(o.$){const c=o.$({context:r.context,props:i});ih(c)?s=c:e.push(c)}const a=V4(e),l=C_(a,n.props,r,i);s?t.push(`${s} {`):l.length&&t.push(l),n.children&&E1(n.children,{context:r.context,props:i},c=>{if(typeof c=="string"){const u=C_(a,{raw:c},r,i);t.push(u)}else LM(c,e,t,r,i)}),e.pop(),s&&t.push("}"),o&&o.after&&o.after(r.context)}function X4(n,e,t){const r=[];return LM(n,[],r,e,t),r.join(`

`)}function P1(n){for(var e=0,t,r=0,i=n.length;i>=4;++r,i-=4)t=n.charCodeAt(r)&255|(n.charCodeAt(++r)&255)<<8|(n.charCodeAt(++r)&255)<<16|(n.charCodeAt(++r)&255)<<24,t=(t&65535)*1540483477+((t>>>16)*59797<<16),t^=t>>>24,e=(t&65535)*1540483477+((t>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(i){case 3:e^=(n.charCodeAt(r+2)&255)<<16;case 2:e^=(n.charCodeAt(r+1)&255)<<8;case 1:e^=n.charCodeAt(r)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}typeof window<"u"&&(window.__cssrContext={});function Y4(n,e,t,r){const{els:i}=e;if(t===void 0)i.forEach(S_),e.els=[];else{const o=Qp(t,r);o&&i.includes(o)&&(S_(o),e.els=i.filter(s=>s!==o))}}function A_(n,e){n.push(e)}function K4(n,e,t,r,i,o,s,a,l){let c;if(t===void 0&&(c=e.render(r),t=P1(c)),l){l.adapter(t,c??e.render(r));return}a===void 0&&(a=document.head);const u=Qp(t,a);if(u!==null&&!o)return u;const d=u??G4(t);if(c===void 0&&(c=e.render(r)),d.textContent=c,u!==null)return u;if(s){const h=a.querySelector(`meta[name="${s}"]`);if(h)return a.insertBefore(d,h),A_(e.els,d),d}return i?a.insertBefore(d,a.querySelector("style, link")):a.appendChild(d),A_(e.els,d),d}function Z4(n){return X4(this,this.instance,n)}function J4(n={}){const{id:e,ssr:t,props:r,head:i=!1,force:o=!1,anchorMetaName:s,parent:a}=n;return K4(this.instance,this,e,r,i,o,s,a,t)}function Q4(n={}){const{id:e,parent:t}=n;Y4(this.instance,this,e,t)}const oh=function(n,e,t,r){return{instance:n,$:e,props:t,children:r,els:[],render:Z4,mount:J4,unmount:Q4}},eD=function(n,e,t,r){return Array.isArray(e)?oh(n,{$:null},null,e):Array.isArray(t)?oh(n,e,null,t):Array.isArray(r)?oh(n,e,t,r):oh(n,e,t,null)};function FM(n={}){const e={c:(...t)=>eD(e,...t),use:(t,...r)=>t.install(e,...r),find:Qp,context:{},config:n};return e}function tD(n,e){if(n===void 0)return!1;if(e){const{context:{ids:t}}=e;return t.has(n)}return Qp(n)!==null}function nD(n){let e=".",t="__",r="--",i;if(n){let f=n.blockPrefix;f&&(e=f),f=n.elementPrefix,f&&(t=f),f=n.modifierPrefix,f&&(r=f)}const o={install(f){i=f.c;const v=f.context;v.bem={},v.bem.b=null,v.bem.els=null}};function s(f){let v,g;return{before(b){v=b.bem.b,g=b.bem.els,b.bem.els=null},after(b){b.bem.b=v,b.bem.els=g},$({context:b,props:S}){return f=typeof f=="string"?f:f({context:b,props:S}),b.bem.b=f,`${(S==null?void 0:S.bPrefix)||e}${b.bem.b}`}}}function a(f){let v;return{before(g){v=g.bem.els},after(g){g.bem.els=v},$({context:g,props:b}){return f=typeof f=="string"?f:f({context:g,props:b}),g.bem.els=f.split(",").map(S=>S.trim()),g.bem.els.map(S=>`${(b==null?void 0:b.bPrefix)||e}${g.bem.b}${t}${S}`).join(", ")}}}function l(f){return{$({context:v,props:g}){f=typeof f=="string"?f:f({context:v,props:g});const b=f.split(",").map(y=>y.trim());function S(y){return b.map(w=>`&${(g==null?void 0:g.bPrefix)||e}${v.bem.b}${y!==void 0?`${t}${y}`:""}${r}${w}`).join(", ")}const p=v.bem.els;return p!==null?S(p[0]):S()}}}function c(f){return{$({context:v,props:g}){f=typeof f=="string"?f:f({context:v,props:g});const b=v.bem.els;return`&:not(${(g==null?void 0:g.bPrefix)||e}${v.bem.b}${b!==null&&b.length>0?`${t}${b[0]}`:""}${r}${f})`}}}return Object.assign(o,{cB:(...f)=>i(s(f[0]),f[1],f[2]),cE:(...f)=>i(a(f[0]),f[1],f[2]),cM:(...f)=>i(l(f[0]),f[1],f[2]),cNotM:(...f)=>i(c(f[0]),f[1],f[2])}),o}const rD="n",Kf=`.${rD}-`,iD="__",oD="--",OM=FM(),kM=nD({blockPrefix:Kf,elementPrefix:iD,modifierPrefix:oD});OM.use(kM);const{c:tt,find:EK}=OM,{cB:Ke,cE:Ye,cM:pt,cNotM:ar}=kM;function sD(n){return tt(({props:{bPrefix:e}})=>`${e||Kf}modal, ${e||Kf}drawer`,[n])}function aD(n){return tt(({props:{bPrefix:e}})=>`${e||Kf}popover`,[n])}const lD=(...n)=>tt(">",[Ke(...n)]);function gt(n,e){return n+(e==="default"?"":e.replace(/^[a-z]/,t=>t.toUpperCase()))}let Km;function cD(){return Km===void 0&&(Km=navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Km}const em=typeof document<"u"&&typeof window<"u",uD=new WeakSet;function dD(n){uD.add(n)}function hD(n){const e=Je(!!n.value);if(e.value)return ed(e);const t=bn(n,r=>{r&&(e.value=!0,t())});return ed(e)}function er(n){const e=rt(n),t=Je(e.value);return bn(e,r=>{t.value=r}),typeof n=="function"?t:{__v_isRef:!0,get value(){return t.value},set value(r){n.set(r)}}}const fD=typeof window<"u";let cc,Hu;const pD=()=>{var n,e;cc=fD?(e=(n=document)===null||n===void 0?void 0:n.fonts)===null||e===void 0?void 0:e.ready:void 0,Hu=!1,cc!==void 0?cc.then(()=>{Hu=!0}):Hu=!0};pD();function mD(n){if(Hu)return;let e=!1;Er(()=>{Hu||cc==null||cc.then(()=>{e||n()})}),Nr(()=>{e=!0})}function Sf(n){return n.composedPath()[0]}const gD={mousemoveoutside:new WeakMap,clickoutside:new WeakMap};function vD(n,e,t){if(n==="mousemoveoutside"){const r=i=>{e.contains(Sf(i))||t(i)};return{mousemove:r,touchstart:r}}else if(n==="clickoutside"){let r=!1;const i=s=>{r=!e.contains(Sf(s))},o=s=>{r&&(e.contains(Sf(s))||t(s))};return{mousedown:i,mouseup:o,touchstart:i,touchend:o}}return console.error(`[evtd/create-trap-handler]: name \`${n}\` is invalid. This could be a bug of evtd.`),{}}function BM(n,e,t){const r=gD[n];let i=r.get(e);i===void 0&&r.set(e,i=new WeakMap);let o=i.get(t);return o===void 0&&i.set(t,o=vD(n,e,t)),o}function bD(n,e,t,r){if(n==="mousemoveoutside"||n==="clickoutside"){const i=BM(n,e,t);return Object.keys(i).forEach(o=>{Bn(o,document,i[o],r)}),!0}return!1}function yD(n,e,t,r){if(n==="mousemoveoutside"||n==="clickoutside"){const i=BM(n,e,t);return Object.keys(i).forEach(o=>{Tn(o,document,i[o],r)}),!0}return!1}function _D(){if(typeof window>"u")return{on:()=>{},off:()=>{}};const n=new WeakMap,e=new WeakMap;function t(){n.set(this,!0)}function r(){n.set(this,!0),e.set(this,!0)}function i(_,A,C){const T=_[A];return _[A]=function(){return C.apply(_,arguments),T.apply(_,arguments)},_}function o(_,A){_[A]=Event.prototype[A]}const s=new WeakMap,a=Object.getOwnPropertyDescriptor(Event.prototype,"currentTarget");function l(){var _;return(_=s.get(this))!==null&&_!==void 0?_:null}function c(_,A){a!==void 0&&Object.defineProperty(_,"currentTarget",{configurable:!0,enumerable:!0,get:A??a.get})}const u={bubble:{},capture:{}},d={};function h(){const _=function(A){const{type:C,eventPhase:T,bubbles:I}=A,M=Sf(A);if(T===2)return;const P=T===1?"capture":"bubble";let E=M;const R=[];for(;E===null&&(E=window),R.push(E),E!==window;)E=E.parentNode||null;const B=u.capture[C],L=u.bubble[C];if(i(A,"stopPropagation",t),i(A,"stopImmediatePropagation",r),c(A,l),P==="capture"){if(B===void 0)return;for(let F=R.length-1;F>=0&&!n.has(A);--F){const H=R[F],$=B.get(H);if($!==void 0){s.set(A,H);for(const O of $){if(e.has(A))break;O(A)}}if(F===0&&!I&&L!==void 0){const O=L.get(H);if(O!==void 0)for(const k of O){if(e.has(A))break;k(A)}}}}else if(P==="bubble"){if(L===void 0)return;for(let F=0;F<R.length&&!n.has(A);++F){const H=R[F],$=L.get(H);if($!==void 0){s.set(A,H);for(const O of $){if(e.has(A))break;O(A)}}}}o(A,"stopPropagation"),o(A,"stopImmediatePropagation"),c(A)};return _.displayName="evtdUnifiedHandler",_}function m(){const _=function(A){const{type:C,eventPhase:T}=A;if(T!==2)return;const I=d[C];I!==void 0&&I.forEach(M=>M(A))};return _.displayName="evtdUnifiedWindowEventHandler",_}const f=h(),v=m();function g(_,A){const C=u[_];return C[A]===void 0&&(C[A]=new Map,window.addEventListener(A,f,_==="capture")),C[A]}function b(_){return d[_]===void 0&&(d[_]=new Set,window.addEventListener(_,v)),d[_]}function S(_,A){let C=_.get(A);return C===void 0&&_.set(A,C=new Set),C}function p(_,A,C,T){const I=u[A][C];if(I!==void 0){const M=I.get(_);if(M!==void 0&&M.has(T))return!0}return!1}function y(_,A){const C=d[_];return!!(C!==void 0&&C.has(A))}function w(_,A,C,T){let I;if(typeof T=="object"&&T.once===!0?I=B=>{x(_,A,I,T),C(B)}:I=C,bD(_,A,I,T))return;const P=T===!0||typeof T=="object"&&T.capture===!0?"capture":"bubble",E=g(P,_),R=S(E,A);if(R.has(I)||R.add(I),A===window){const B=b(_);B.has(I)||B.add(I)}}function x(_,A,C,T){if(yD(_,A,C,T))return;const M=T===!0||typeof T=="object"&&T.capture===!0,P=M?"capture":"bubble",E=g(P,_),R=S(E,A);if(A===window&&!p(A,M?"bubble":"capture",_,C)&&y(_,C)){const L=d[_];L.delete(C),L.size===0&&(window.removeEventListener(_,v),d[_]=void 0)}R.has(C)&&R.delete(C),R.size===0&&E.delete(A),E.size===0&&(window.removeEventListener(_,f,P==="capture"),u[P][_]=void 0)}return{on:w,off:x}}const{on:Bn,off:Tn}=_D();function el(n,e){return bn(n,t=>{t!==void 0&&(e.value=t)}),rt(()=>n.value===void 0?e.value:n.value)}function Dd(){const n=Je(!1);return Er(()=>{n.value=!0}),ed(n)}function NM(n,e){return rt(()=>{for(const t of e)if(n[t]!==void 0)return n[t];return n[e[e.length-1]]})}const xD=(typeof window>"u"?!1:/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!window.MSStream;function wD(){return xD}const fb="n-internal-select-menu",zM="n-internal-select-menu-body",UM="n-modal-body",$M="n-drawer-body",HM="n-popover-body",VM="__disabled__";function Ti(n){const e=vn(UM,null),t=vn($M,null),r=vn(HM,null),i=vn(zM,null),o=Je();if(typeof document<"u"){o.value=document.fullscreenElement;const s=()=>{o.value=document.fullscreenElement};Er(()=>{Bn("fullscreenchange",document,s)}),Nr(()=>{Tn("fullscreenchange",document,s)})}return er(()=>{var s;const{to:a}=n;return a!==void 0?a===!1?VM:a===!0?o.value||"body":a:e!=null&&e.value?(s=e.value.$el)!==null&&s!==void 0?s:e.value:t!=null&&t.value?t.value:r!=null&&r.value?r.value:i!=null&&i.value?i.value:a??(o.value||"body")})}Ti.tdkey=VM;Ti.propTo={type:[String,Object,Boolean],default:void 0};function R1(n,e,t="default"){const r=e[t];if(r===void 0)throw new Error(`[vueuc/${n}]: slot[${t}] is empty.`);return r()}function I1(n,e=!0,t=[]){return n.forEach(r=>{if(r!==null){if(typeof r!="object"){(typeof r=="string"||typeof r=="number")&&t.push(Ja(String(r)));return}if(Array.isArray(r)){I1(r,e,t);return}if(r.type===$n){if(r.children===null)return;Array.isArray(r.children)&&I1(r.children,e,t)}else r.type!==mr&&t.push(r)}}),t}function M_(n,e,t="default"){const r=e[t];if(r===void 0)throw new Error(`[vueuc/${n}]: slot[${t}] is empty.`);const i=I1(r());if(i.length===1)return i[0];throw new Error(`[vueuc/${n}]: slot[${t}] should have exactly one child.`)}let ms=null;function GM(){if(ms===null&&(ms=document.getElementById("v-binder-view-measurer"),ms===null)){ms=document.createElement("div"),ms.id="v-binder-view-measurer";const{style:n}=ms;n.position="fixed",n.left="0",n.right="0",n.top="0",n.bottom="0",n.pointerEvents="none",n.visibility="hidden",document.body.appendChild(ms)}return ms.getBoundingClientRect()}function SD(n,e){const t=GM();return{top:e,left:n,height:0,width:0,right:t.width-n,bottom:t.height-e}}function Zm(n){const e=n.getBoundingClientRect(),t=GM();return{left:e.left-t.left,top:e.top-t.top,bottom:t.height+t.top-e.bottom,right:t.width+t.left-e.right,width:e.width,height:e.height}}function CD(n){return n.nodeType===9?null:n.parentNode}function WM(n){if(n===null)return null;const e=CD(n);if(e===null)return null;if(e.nodeType===9)return document;if(e.nodeType===1){const{overflow:t,overflowX:r,overflowY:i}=getComputedStyle(e);if(/(auto|scroll|overlay)/.test(t+i+r))return e}return WM(e)}const pb=Vt({name:"Binder",props:{syncTargetWithParent:Boolean,syncTarget:{type:Boolean,default:!0}},setup(n){var e;Xi("VBinder",(e=Td())===null||e===void 0?void 0:e.proxy);const t=vn("VBinder",null),r=Je(null),i=b=>{r.value=b,t&&n.syncTargetWithParent&&t.setTargetRef(b)};let o=[];const s=()=>{let b=r.value;for(;b=WM(b),b!==null;)o.push(b);for(const S of o)Bn("scroll",S,d,!0)},a=()=>{for(const b of o)Tn("scroll",b,d,!0);o=[]},l=new Set,c=b=>{l.size===0&&s(),l.has(b)||l.add(b)},u=b=>{l.has(b)&&l.delete(b),l.size===0&&a()},d=()=>{RM(h)},h=()=>{l.forEach(b=>b())},m=new Set,f=b=>{m.size===0&&Bn("resize",window,g),m.has(b)||m.add(b)},v=b=>{m.has(b)&&m.delete(b),m.size===0&&Tn("resize",window,g)},g=()=>{m.forEach(b=>b())};return Nr(()=>{Tn("resize",window,g),a()}),{targetRef:r,setTargetRef:i,addScrollListener:c,removeScrollListener:u,addResizeListener:f,removeResizeListener:v}},render(){return R1("binder",this.$slots)}}),mb=Vt({name:"Target",setup(){const{setTargetRef:n,syncTarget:e}=vn("VBinder");return{syncTarget:e,setTargetDirective:{mounted:n,updated:n}}},render(){const{syncTarget:n,setTargetDirective:e}=this;return n?Ic(M_("follower",this.$slots),[[e]]):M_("follower",this.$slots)}}),xl="@@mmoContext",jM={mounted(n,{value:e}){n[xl]={handler:void 0},typeof e=="function"&&(n[xl].handler=e,Bn("mousemoveoutside",n,e))},updated(n,{value:e}){const t=n[xl];typeof e=="function"?t.handler?t.handler!==e&&(Tn("mousemoveoutside",n,t.handler),t.handler=e,Bn("mousemoveoutside",n,e)):(n[xl].handler=e,Bn("mousemoveoutside",n,e)):t.handler&&(Tn("mousemoveoutside",n,t.handler),t.handler=void 0)},unmounted(n){const{handler:e}=n[xl];e&&Tn("mousemoveoutside",n,e),n[xl].handler=void 0}},wl="@@coContext",Zf={mounted(n,{value:e,modifiers:t}){n[wl]={handler:void 0},typeof e=="function"&&(n[wl].handler=e,Bn("clickoutside",n,e,{capture:t.capture}))},updated(n,{value:e,modifiers:t}){const r=n[wl];typeof e=="function"?r.handler?r.handler!==e&&(Tn("clickoutside",n,r.handler,{capture:t.capture}),r.handler=e,Bn("clickoutside",n,e,{capture:t.capture})):(n[wl].handler=e,Bn("clickoutside",n,e,{capture:t.capture})):r.handler&&(Tn("clickoutside",n,r.handler,{capture:t.capture}),r.handler=void 0)},unmounted(n,{modifiers:e}){const{handler:t}=n[wl];t&&Tn("clickoutside",n,t,{capture:e.capture}),n[wl].handler=void 0}};function AD(n,e){console.error(`[vdirs/${n}]: ${e}`)}class MD{constructor(){this.elementZIndex=new Map,this.nextZIndex=2e3}get elementCount(){return this.elementZIndex.size}ensureZIndex(e,t){const{elementZIndex:r}=this;if(t!==void 0){e.style.zIndex=`${t}`,r.delete(e);return}const{nextZIndex:i}=this;r.has(e)&&r.get(e)+1===this.nextZIndex||(e.style.zIndex=`${i}`,r.set(e,i),this.nextZIndex=i+1,this.squashState())}unregister(e,t){const{elementZIndex:r}=this;r.has(e)?r.delete(e):t===void 0&&AD("z-index-manager/unregister-element","Element not found when unregistering."),this.squashState()}squashState(){const{elementCount:e}=this;e||(this.nextZIndex=2e3),this.nextZIndex-e>2500&&this.rearrange()}rearrange(){const e=Array.from(this.elementZIndex.entries());e.sort((t,r)=>t[1]-r[1]),this.nextZIndex=2e3,e.forEach(t=>{const r=t[0],i=this.nextZIndex++;`${i}`!==r.style.zIndex&&(r.style.zIndex=`${i}`)})}}const Jm=new MD,Sl="@@ziContext",qM={mounted(n,e){const{value:t={}}=e,{zIndex:r,enabled:i}=t;n[Sl]={enabled:!!i,initialized:!1},i&&(Jm.ensureZIndex(n,r),n[Sl].initialized=!0)},updated(n,e){const{value:t={}}=e,{zIndex:r,enabled:i}=t,o=n[Sl].enabled;i&&!o&&(Jm.ensureZIndex(n,r),n[Sl].initialized=!0),n[Sl].enabled=!!i},unmounted(n,e){if(!n[Sl].initialized)return;const{value:t={}}=e,{zIndex:r}=t;Jm.unregister(n,r)}},TD="@css-render/vue3-ssr";function ED(n,e){return`<style cssr-id="${n}">
${e}
</style>`}function PD(n,e,t){const{styles:r,ids:i}=t;i.has(n)||r!==null&&(i.add(n),r.push(ED(n,e)))}const RD=typeof document<"u";function cl(){if(RD)return;const n=vn(TD,null);if(n!==null)return{adapter:(e,t)=>PD(e,t,n),context:n}}function T_(n,e){console.error(`[vueuc/${n}]: ${e}`)}const{c:Fs}=FM(),gb="vueuc-style";function E_(n){return n&-n}class ID{constructor(e,t){this.l=e,this.min=t;const r=new Array(e+1);for(let i=0;i<e+1;++i)r[i]=0;this.ft=r}add(e,t){if(t===0)return;const{l:r,ft:i}=this;for(e+=1;e<=r;)i[e]+=t,e+=E_(e)}get(e){return this.sum(e+1)-this.sum(e)}sum(e){if(e===void 0&&(e=this.l),e<=0)return 0;const{ft:t,min:r,l:i}=this;if(e>i)throw new Error("[FinweckTree.sum]: `i` is larger than length.");let o=e*r;for(;e>0;)o+=t[e],e-=E_(e);return o}getBound(e){let t=0,r=this.l;for(;r>t;){const i=Math.floor((t+r)/2),o=this.sum(i);if(o>e){r=i;continue}else if(o<e){if(t===i)return this.sum(t+1)<=e?t+1:i;t=i}else return i}return t}}function P_(n){return typeof n=="string"?document.querySelector(n):n()}const DD=Vt({name:"LazyTeleport",props:{to:{type:[String,Object],default:void 0},disabled:Boolean,show:{type:Boolean,required:!0}},setup(n){return{showTeleport:hD(Jt(n,"show")),mergedTo:rt(()=>{const{to:e}=n;return e??"body"})}},render(){return this.showTeleport?this.disabled?R1("lazy-teleport",this.$slots):ge(z3,{disabled:this.disabled,to:this.mergedTo},R1("lazy-teleport",this.$slots)):null}}),sh={top:"bottom",bottom:"top",left:"right",right:"left"},R_={start:"end",center:"center",end:"start"},Qm={top:"height",bottom:"height",left:"width",right:"width"},LD={"bottom-start":"top left",bottom:"top center","bottom-end":"top right","top-start":"bottom left",top:"bottom center","top-end":"bottom right","right-start":"top left",right:"center left","right-end":"bottom left","left-start":"top right",left:"center right","left-end":"bottom right"},FD={"bottom-start":"bottom left",bottom:"bottom center","bottom-end":"bottom right","top-start":"top left",top:"top center","top-end":"top right","right-start":"top right",right:"center right","right-end":"bottom right","left-start":"top left",left:"center left","left-end":"bottom left"},OD={"bottom-start":"right","bottom-end":"left","top-start":"right","top-end":"left","right-start":"bottom","right-end":"top","left-start":"bottom","left-end":"top"},I_={top:!0,bottom:!1,left:!0,right:!1},D_={top:"end",bottom:"start",left:"end",right:"start"};function kD(n,e,t,r,i,o){if(!i||o)return{placement:n,top:0,left:0};const[s,a]=n.split("-");let l=a??"center",c={top:0,left:0};const u=(m,f,v)=>{let g=0,b=0;const S=t[m]-e[f]-e[m];return S>0&&r&&(v?b=I_[f]?S:-S:g=I_[f]?S:-S),{left:g,top:b}},d=s==="left"||s==="right";if(l!=="center"){const m=OD[n],f=sh[m],v=Qm[m];if(t[v]>e[v]){if(e[m]+e[v]<t[v]){const g=(t[v]-e[v])/2;e[m]<g||e[f]<g?e[m]<e[f]?(l=R_[a],c=u(v,f,d)):c=u(v,m,d):l="center"}}else t[v]<e[v]&&e[f]<0&&e[m]>e[f]&&(l=R_[a])}else{const m=s==="bottom"||s==="top"?"left":"top",f=sh[m],v=Qm[m],g=(t[v]-e[v])/2;(e[m]<g||e[f]<g)&&(e[m]>e[f]?(l=D_[m],c=u(v,m,d)):(l=D_[f],c=u(v,f,d)))}let h=s;return e[s]<t[Qm[s]]&&e[s]<e[sh[s]]&&(h=sh[s]),{placement:l!=="center"?`${h}-${l}`:h,left:c.left,top:c.top}}function BD(n,e){return e?FD[n]:LD[n]}function ND(n,e,t,r,i,o){if(o)switch(n){case"bottom-start":return{top:`${Math.round(t.top-e.top+t.height)}px`,left:`${Math.round(t.left-e.left)}px`,transform:"translateY(-100%)"};case"bottom-end":return{top:`${Math.round(t.top-e.top+t.height)}px`,left:`${Math.round(t.left-e.left+t.width)}px`,transform:"translateX(-100%) translateY(-100%)"};case"top-start":return{top:`${Math.round(t.top-e.top)}px`,left:`${Math.round(t.left-e.left)}px`,transform:""};case"top-end":return{top:`${Math.round(t.top-e.top)}px`,left:`${Math.round(t.left-e.left+t.width)}px`,transform:"translateX(-100%)"};case"right-start":return{top:`${Math.round(t.top-e.top)}px`,left:`${Math.round(t.left-e.left+t.width)}px`,transform:"translateX(-100%)"};case"right-end":return{top:`${Math.round(t.top-e.top+t.height)}px`,left:`${Math.round(t.left-e.left+t.width)}px`,transform:"translateX(-100%) translateY(-100%)"};case"left-start":return{top:`${Math.round(t.top-e.top)}px`,left:`${Math.round(t.left-e.left)}px`,transform:""};case"left-end":return{top:`${Math.round(t.top-e.top+t.height)}px`,left:`${Math.round(t.left-e.left)}px`,transform:"translateY(-100%)"};case"top":return{top:`${Math.round(t.top-e.top)}px`,left:`${Math.round(t.left-e.left+t.width/2)}px`,transform:"translateX(-50%)"};case"right":return{top:`${Math.round(t.top-e.top+t.height/2)}px`,left:`${Math.round(t.left-e.left+t.width)}px`,transform:"translateX(-100%) translateY(-50%)"};case"left":return{top:`${Math.round(t.top-e.top+t.height/2)}px`,left:`${Math.round(t.left-e.left)}px`,transform:"translateY(-50%)"};case"bottom":default:return{top:`${Math.round(t.top-e.top+t.height)}px`,left:`${Math.round(t.left-e.left+t.width/2)}px`,transform:"translateX(-50%) translateY(-100%)"}}switch(n){case"bottom-start":return{top:`${Math.round(t.top-e.top+t.height+r)}px`,left:`${Math.round(t.left-e.left+i)}px`,transform:""};case"bottom-end":return{top:`${Math.round(t.top-e.top+t.height+r)}px`,left:`${Math.round(t.left-e.left+t.width+i)}px`,transform:"translateX(-100%)"};case"top-start":return{top:`${Math.round(t.top-e.top+r)}px`,left:`${Math.round(t.left-e.left+i)}px`,transform:"translateY(-100%)"};case"top-end":return{top:`${Math.round(t.top-e.top+r)}px`,left:`${Math.round(t.left-e.left+t.width+i)}px`,transform:"translateX(-100%) translateY(-100%)"};case"right-start":return{top:`${Math.round(t.top-e.top+r)}px`,left:`${Math.round(t.left-e.left+t.width+i)}px`,transform:""};case"right-end":return{top:`${Math.round(t.top-e.top+t.height+r)}px`,left:`${Math.round(t.left-e.left+t.width+i)}px`,transform:"translateY(-100%)"};case"left-start":return{top:`${Math.round(t.top-e.top+r)}px`,left:`${Math.round(t.left-e.left+i)}px`,transform:"translateX(-100%)"};case"left-end":return{top:`${Math.round(t.top-e.top+t.height+r)}px`,left:`${Math.round(t.left-e.left+i)}px`,transform:"translateX(-100%) translateY(-100%)"};case"top":return{top:`${Math.round(t.top-e.top+r)}px`,left:`${Math.round(t.left-e.left+t.width/2+i)}px`,transform:"translateY(-100%) translateX(-50%)"};case"right":return{top:`${Math.round(t.top-e.top+t.height/2+r)}px`,left:`${Math.round(t.left-e.left+t.width+i)}px`,transform:"translateY(-50%)"};case"left":return{top:`${Math.round(t.top-e.top+t.height/2+r)}px`,left:`${Math.round(t.left-e.left+i)}px`,transform:"translateY(-50%) translateX(-100%)"};case"bottom":default:return{top:`${Math.round(t.top-e.top+t.height+r)}px`,left:`${Math.round(t.left-e.left+t.width/2+i)}px`,transform:"translateX(-50%)"}}}const zD=Fs([Fs(".v-binder-follower-container",{position:"absolute",left:"0",right:"0",top:"0",height:"0",pointerEvents:"none",zIndex:"auto"}),Fs(".v-binder-follower-content",{position:"absolute",zIndex:"auto"},[Fs("> *",{pointerEvents:"all"})])]),vb=Vt({name:"Follower",inheritAttrs:!1,props:{show:Boolean,enabled:{type:Boolean,default:void 0},placement:{type:String,default:"bottom"},syncTrigger:{type:Array,default:["resize","scroll"]},to:[String,Object],flip:{type:Boolean,default:!0},internalShift:Boolean,x:Number,y:Number,width:String,minWidth:String,containerClass:String,teleportDisabled:Boolean,zindexable:{type:Boolean,default:!0},zIndex:Number,overlap:Boolean},setup(n){const e=vn("VBinder"),t=er(()=>n.enabled!==void 0?n.enabled:n.show),r=Je(null),i=Je(null),o=()=>{const{syncTrigger:h}=n;h.includes("scroll")&&e.addScrollListener(l),h.includes("resize")&&e.addResizeListener(l)},s=()=>{e.removeScrollListener(l),e.removeResizeListener(l)};Er(()=>{t.value&&(l(),o())});const a=cl();zD.mount({id:"vueuc/binder",head:!0,anchorMetaName:gb,ssr:a}),Nr(()=>{s()}),mD(()=>{t.value&&l()});const l=()=>{if(!t.value)return;const h=r.value;if(h===null)return;const m=e.targetRef,{x:f,y:v,overlap:g}=n,b=f!==void 0&&v!==void 0?SD(f,v):Zm(m);h.style.setProperty("--v-target-width",`${Math.round(b.width)}px`),h.style.setProperty("--v-target-height",`${Math.round(b.height)}px`);const{width:S,minWidth:p,placement:y,internalShift:w,flip:x}=n;h.setAttribute("v-placement",y),g?h.setAttribute("v-overlap",""):h.removeAttribute("v-overlap");const{style:_}=h;S==="target"?_.width=`${b.width}px`:S!==void 0?_.width=S:_.width="",p==="target"?_.minWidth=`${b.width}px`:p!==void 0?_.minWidth=p:_.minWidth="";const A=Zm(h),C=Zm(i.value),{left:T,top:I,placement:M}=kD(y,b,A,w,x,g),P=BD(M,g),{left:E,top:R,transform:B}=ND(M,C,b,I,T,g);h.setAttribute("v-placement",M),h.style.setProperty("--v-offset-left",`${Math.round(T)}px`),h.style.setProperty("--v-offset-top",`${Math.round(I)}px`),h.style.transform=`translateX(${E}) translateY(${R}) ${B}`,h.style.setProperty("--v-transform-origin",P),h.style.transformOrigin=P};bn(t,h=>{h?(o(),c()):s()});const c=()=>{ui().then(l).catch(h=>console.error(h))};["placement","x","y","internalShift","flip","width","overlap","minWidth"].forEach(h=>{bn(Jt(n,h),l)}),["teleportDisabled"].forEach(h=>{bn(Jt(n,h),c)}),bn(Jt(n,"syncTrigger"),h=>{h.includes("resize")?e.addResizeListener(l):e.removeResizeListener(l),h.includes("scroll")?e.addScrollListener(l):e.removeScrollListener(l)});const u=Dd(),d=er(()=>{const{to:h}=n;if(h!==void 0)return h;u.value});return{VBinder:e,mergedEnabled:t,offsetContainerRef:i,followerRef:r,mergedTo:d,syncPosition:l}},render(){return ge(DD,{show:this.show,to:this.mergedTo,disabled:this.teleportDisabled},{default:()=>{var n,e;const t=ge("div",{class:["v-binder-follower-container",this.containerClass],ref:"offsetContainerRef"},[ge("div",{class:"v-binder-follower-content",ref:"followerRef"},(e=(n=this.$slots).default)===null||e===void 0?void 0:e.call(n))]);return this.zindexable?Ic(t,[[qM,{enabled:this.mergedEnabled,zIndex:this.zIndex}]]):t}})}});var Ha=[],UD=function(){return Ha.some(function(n){return n.activeTargets.length>0})},$D=function(){return Ha.some(function(n){return n.skippedTargets.length>0})},L_="ResizeObserver loop completed with undelivered notifications.",HD=function(){var n;typeof ErrorEvent=="function"?n=new ErrorEvent("error",{message:L_}):(n=document.createEvent("Event"),n.initEvent("error",!1,!1),n.message=L_),window.dispatchEvent(n)},ud;(function(n){n.BORDER_BOX="border-box",n.CONTENT_BOX="content-box",n.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"})(ud||(ud={}));var Va=function(n){return Object.freeze(n)},VD=function(){function n(e,t){this.inlineSize=e,this.blockSize=t,Va(this)}return n}(),XM=function(){function n(e,t,r,i){return this.x=e,this.y=t,this.width=r,this.height=i,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,Va(this)}return n.prototype.toJSON=function(){var e=this,t=e.x,r=e.y,i=e.top,o=e.right,s=e.bottom,a=e.left,l=e.width,c=e.height;return{x:t,y:r,top:i,right:o,bottom:s,left:a,width:l,height:c}},n.fromRect=function(e){return new n(e.x,e.y,e.width,e.height)},n}(),bb=function(n){return n instanceof SVGElement&&"getBBox"in n},YM=function(n){if(bb(n)){var e=n.getBBox(),t=e.width,r=e.height;return!t&&!r}var i=n,o=i.offsetWidth,s=i.offsetHeight;return!(o||s||n.getClientRects().length)},F_=function(n){var e;if(n instanceof Element)return!0;var t=(e=n==null?void 0:n.ownerDocument)===null||e===void 0?void 0:e.defaultView;return!!(t&&n instanceof t.Element)},GD=function(n){switch(n.tagName){case"INPUT":if(n.type!=="image")break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1},Vu=typeof window<"u"?window:{},ah=new WeakMap,O_=/auto|scroll/,WD=/^tb|vertical/,jD=/msie|trident/i.test(Vu.navigator&&Vu.navigator.userAgent),oo=function(n){return parseFloat(n||"0")},uc=function(n,e,t){return n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=!1),new VD((t?e:n)||0,(t?n:e)||0)},k_=Va({devicePixelContentBoxSize:uc(),borderBoxSize:uc(),contentBoxSize:uc(),contentRect:new XM(0,0,0,0)}),KM=function(n,e){if(e===void 0&&(e=!1),ah.has(n)&&!e)return ah.get(n);if(YM(n))return ah.set(n,k_),k_;var t=getComputedStyle(n),r=bb(n)&&n.ownerSVGElement&&n.getBBox(),i=!jD&&t.boxSizing==="border-box",o=WD.test(t.writingMode||""),s=!r&&O_.test(t.overflowY||""),a=!r&&O_.test(t.overflowX||""),l=r?0:oo(t.paddingTop),c=r?0:oo(t.paddingRight),u=r?0:oo(t.paddingBottom),d=r?0:oo(t.paddingLeft),h=r?0:oo(t.borderTopWidth),m=r?0:oo(t.borderRightWidth),f=r?0:oo(t.borderBottomWidth),v=r?0:oo(t.borderLeftWidth),g=d+c,b=l+u,S=v+m,p=h+f,y=a?n.offsetHeight-p-n.clientHeight:0,w=s?n.offsetWidth-S-n.clientWidth:0,x=i?g+S:0,_=i?b+p:0,A=r?r.width:oo(t.width)-x-w,C=r?r.height:oo(t.height)-_-y,T=A+g+w+S,I=C+b+y+p,M=Va({devicePixelContentBoxSize:uc(Math.round(A*devicePixelRatio),Math.round(C*devicePixelRatio),o),borderBoxSize:uc(T,I,o),contentBoxSize:uc(A,C,o),contentRect:new XM(d,l,A,C)});return ah.set(n,M),M},ZM=function(n,e,t){var r=KM(n,t),i=r.borderBoxSize,o=r.contentBoxSize,s=r.devicePixelContentBoxSize;switch(e){case ud.DEVICE_PIXEL_CONTENT_BOX:return s;case ud.BORDER_BOX:return i;default:return o}},qD=function(){function n(e){var t=KM(e);this.target=e,this.contentRect=t.contentRect,this.borderBoxSize=Va([t.borderBoxSize]),this.contentBoxSize=Va([t.contentBoxSize]),this.devicePixelContentBoxSize=Va([t.devicePixelContentBoxSize])}return n}(),JM=function(n){if(YM(n))return 1/0;for(var e=0,t=n.parentNode;t;)e+=1,t=t.parentNode;return e},XD=function(){var n=1/0,e=[];Ha.forEach(function(s){if(s.activeTargets.length!==0){var a=[];s.activeTargets.forEach(function(c){var u=new qD(c.target),d=JM(c.target);a.push(u),c.lastReportedSize=ZM(c.target,c.observedBox),d<n&&(n=d)}),e.push(function(){s.callback.call(s.observer,a,s.observer)}),s.activeTargets.splice(0,s.activeTargets.length)}});for(var t=0,r=e;t<r.length;t++){var i=r[t];i()}return n},B_=function(n){Ha.forEach(function(t){t.activeTargets.splice(0,t.activeTargets.length),t.skippedTargets.splice(0,t.skippedTargets.length),t.observationTargets.forEach(function(i){i.isActive()&&(JM(i.target)>n?t.activeTargets.push(i):t.skippedTargets.push(i))})})},YD=function(){var n=0;for(B_(n);UD();)n=XD(),B_(n);return $D()&&HD(),n>0},eg,QM=[],KD=function(){return QM.splice(0).forEach(function(n){return n()})},ZD=function(n){if(!eg){var e=0,t=document.createTextNode(""),r={characterData:!0};new MutationObserver(function(){return KD()}).observe(t,r),eg=function(){t.textContent="".concat(e?e--:e++)}}QM.push(n),eg()},JD=function(n){ZD(function(){requestAnimationFrame(n)})},Cf=0,QD=function(){return!!Cf},eL=250,tL={attributes:!0,characterData:!0,childList:!0,subtree:!0},N_=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],z_=function(n){return n===void 0&&(n=0),Date.now()+n},tg=!1,nL=function(){function n(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return n.prototype.run=function(e){var t=this;if(e===void 0&&(e=eL),!tg){tg=!0;var r=z_(e);JD(function(){var i=!1;try{i=YD()}finally{if(tg=!1,e=r-z_(),!QD())return;i?t.run(1e3):e>0?t.run(e):t.start()}})}},n.prototype.schedule=function(){this.stop(),this.run()},n.prototype.observe=function(){var e=this,t=function(){return e.observer&&e.observer.observe(document.body,tL)};document.body?t():Vu.addEventListener("DOMContentLoaded",t)},n.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),N_.forEach(function(t){return Vu.addEventListener(t,e.listener,!0)}))},n.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),N_.forEach(function(t){return Vu.removeEventListener(t,e.listener,!0)}),this.stopped=!0)},n}(),D1=new nL,U_=function(n){!Cf&&n>0&&D1.start(),Cf+=n,!Cf&&D1.stop()},rL=function(n){return!bb(n)&&!GD(n)&&getComputedStyle(n).display==="inline"},iL=function(){function n(e,t){this.target=e,this.observedBox=t||ud.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return n.prototype.isActive=function(){var e=ZM(this.target,this.observedBox,!0);return rL(this.target)&&(this.lastReportedSize=e),this.lastReportedSize.inlineSize!==e.inlineSize||this.lastReportedSize.blockSize!==e.blockSize},n}(),oL=function(){function n(e,t){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=t}return n}(),lh=new WeakMap,$_=function(n,e){for(var t=0;t<n.length;t+=1)if(n[t].target===e)return t;return-1},ch=function(){function n(){}return n.connect=function(e,t){var r=new oL(e,t);lh.set(e,r)},n.observe=function(e,t,r){var i=lh.get(e),o=i.observationTargets.length===0;$_(i.observationTargets,t)<0&&(o&&Ha.push(i),i.observationTargets.push(new iL(t,r&&r.box)),U_(1),D1.schedule())},n.unobserve=function(e,t){var r=lh.get(e),i=$_(r.observationTargets,t),o=r.observationTargets.length===1;i>=0&&(o&&Ha.splice(Ha.indexOf(r),1),r.observationTargets.splice(i,1),U_(-1))},n.disconnect=function(e){var t=this,r=lh.get(e);r.observationTargets.slice().forEach(function(i){return t.unobserve(e,i.target)}),r.activeTargets.splice(0,r.activeTargets.length)},n}(),sL=function(){function n(e){if(arguments.length===0)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if(typeof e!="function")throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");ch.connect(this,e)}return n.prototype.observe=function(e,t){if(arguments.length===0)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!F_(e))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");ch.observe(this,e,t)},n.prototype.unobserve=function(e){if(arguments.length===0)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!F_(e))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");ch.unobserve(this,e)},n.prototype.disconnect=function(){ch.disconnect(this)},n.toString=function(){return"function ResizeObserver () { [polyfill code] }"},n}();class aL{constructor(){this.handleResize=this.handleResize.bind(this),this.observer=new(typeof window<"u"&&window.ResizeObserver||sL)(this.handleResize),this.elHandlersMap=new Map}handleResize(e){for(const t of e){const r=this.elHandlersMap.get(t.target);r!==void 0&&r(t)}}registerHandler(e,t){this.elHandlersMap.set(e,t),this.observer.observe(e)}unregisterHandler(e){this.elHandlersMap.has(e)&&(this.elHandlersMap.delete(e),this.observer.unobserve(e))}}const Jf=new aL,dd=Vt({name:"ResizeObserver",props:{onResize:Function},setup(n){let e=!1;const t=Td().proxy;function r(i){const{onResize:o}=n;o!==void 0&&o(i)}Er(()=>{const i=t.$el;if(i===void 0){T_("resize-observer","$el does not exist.");return}if(i.nextElementSibling!==i.nextSibling&&i.nodeType===3&&i.nodeValue!==""){T_("resize-observer","$el can not be observed (it may be a text node).");return}i.nextElementSibling!==null&&(Jf.registerHandler(i.nextElementSibling,r),e=!0)}),Nr(()=>{e&&Jf.unregisterHandler(t.$el.nextElementSibling)})},render(){return nb(this.$slots,"default")}});let uh;function lL(){return typeof document>"u"?!1:(uh===void 0&&("matchMedia"in window?uh=window.matchMedia("(pointer:coarse)").matches:uh=!1),uh)}let ng;function H_(){return typeof document>"u"?1:(ng===void 0&&(ng="chrome"in window?window.devicePixelRatio:1),ng)}const cL=Fs(".v-vl",{maxHeight:"inherit",height:"100%",overflow:"auto",minWidth:"1px"},[Fs("&:not(.v-vl--show-scrollbar)",{scrollbarWidth:"none"},[Fs("&::-webkit-scrollbar, &::-webkit-scrollbar-track-piece, &::-webkit-scrollbar-thumb",{width:0,height:0,display:"none"})])]),uL=Vt({name:"VirtualList",inheritAttrs:!1,props:{showScrollbar:{type:Boolean,default:!0},items:{type:Array,default:()=>[]},itemSize:{type:Number,required:!0},itemResizable:Boolean,itemsStyle:[String,Object],visibleItemsTag:{type:[String,Object],default:"div"},visibleItemsProps:Object,ignoreItemResize:Boolean,onScroll:Function,onWheel:Function,onResize:Function,defaultScrollKey:[Number,String],defaultScrollIndex:Number,keyField:{type:String,default:"key"},paddingTop:{type:[Number,String],default:0},paddingBottom:{type:[Number,String],default:0}},setup(n){const e=cl();cL.mount({id:"vueuc/virtual-list",head:!0,anchorMetaName:gb,ssr:e}),Er(()=>{const{defaultScrollIndex:I,defaultScrollKey:M}=n;I!=null?f({index:I}):M!=null&&f({key:M})});let t=!1,r=!1;eb(()=>{if(t=!1,!r){r=!0;return}f({top:d.value,left:u})}),tb(()=>{t=!0,r||(r=!0)});const i=rt(()=>{const I=new Map,{keyField:M}=n;return n.items.forEach((P,E)=>{I.set(P[M],E)}),I}),o=Je(null),s=Je(void 0),a=new Map,l=rt(()=>{const{items:I,itemSize:M,keyField:P}=n,E=new ID(I.length,M);return I.forEach((R,B)=>{const L=R[P],F=a.get(L);F!==void 0&&E.add(B,F)}),E}),c=Je(0);let u=0;const d=Je(0),h=er(()=>Math.max(l.value.getBound(d.value-cd(n.paddingTop))-1,0)),m=rt(()=>{const{value:I}=s;if(I===void 0)return[];const{items:M,itemSize:P}=n,E=h.value,R=Math.min(E+Math.ceil(I/P+1),M.length-1),B=[];for(let L=E;L<=R;++L)B.push(M[L]);return B}),f=(I,M)=>{if(typeof I=="number"){S(I,M,"auto");return}const{left:P,top:E,index:R,key:B,position:L,behavior:F,debounce:H=!0}=I;if(P!==void 0||E!==void 0)S(P,E,F);else if(R!==void 0)b(R,F,H);else if(B!==void 0){const $=i.value.get(B);$!==void 0&&b($,F,H)}else L==="bottom"?S(0,Number.MAX_SAFE_INTEGER,F):L==="top"&&S(0,0,F)};let v,g=null;function b(I,M,P){const{value:E}=l,R=E.sum(I)+cd(n.paddingTop);if(!P)o.value.scrollTo({left:0,top:R,behavior:M});else{v=I,g!==null&&window.clearTimeout(g),g=window.setTimeout(()=>{v=void 0,g=null},16);const{scrollTop:B,offsetHeight:L}=o.value;if(R>B){const F=E.get(I);R+F<=B+L||o.value.scrollTo({left:0,top:R+F-L,behavior:M})}else o.value.scrollTo({left:0,top:R,behavior:M})}}function S(I,M,P){o.value.scrollTo({left:I,top:M,behavior:P})}function p(I,M){var P,E,R;if(t||n.ignoreItemResize||T(M.target))return;const{value:B}=l,L=i.value.get(I),F=B.get(L),H=(R=(E=(P=M.borderBoxSize)===null||P===void 0?void 0:P[0])===null||E===void 0?void 0:E.blockSize)!==null&&R!==void 0?R:M.contentRect.height;if(H===F)return;H-n.itemSize===0?a.delete(I):a.set(I,H-n.itemSize);const O=H-F;if(O===0)return;B.add(L,O);const k=o.value;if(k!=null){if(v===void 0){const X=B.sum(L);k.scrollTop>X&&k.scrollBy(0,O)}else if(L<v)k.scrollBy(0,O);else if(L===v){const X=B.sum(L);H+X>k.scrollTop+k.offsetHeight&&k.scrollBy(0,O)}C()}c.value++}const y=!lL();let w=!1;function x(I){var M;(M=n.onScroll)===null||M===void 0||M.call(n,I),(!y||!w)&&C()}function _(I){var M;if((M=n.onWheel)===null||M===void 0||M.call(n,I),y){const P=o.value;if(P!=null){if(I.deltaX===0&&(P.scrollTop===0&&I.deltaY<=0||P.scrollTop+P.offsetHeight>=P.scrollHeight&&I.deltaY>=0))return;I.preventDefault(),P.scrollTop+=I.deltaY/H_(),P.scrollLeft+=I.deltaX/H_(),C(),w=!0,RM(()=>{w=!1})}}}function A(I){if(t||T(I.target)||I.contentRect.height===s.value)return;s.value=I.contentRect.height;const{onResize:M}=n;M!==void 0&&M(I)}function C(){const{value:I}=o;I!=null&&(d.value=I.scrollTop,u=I.scrollLeft)}function T(I){let M=I;for(;M!==null;){if(M.style.display==="none")return!0;M=M.parentElement}return!1}return{listHeight:s,listStyle:{overflow:"auto"},keyToIndex:i,itemsStyle:rt(()=>{const{itemResizable:I}=n,M=nh(l.value.sum());return c.value,[n.itemsStyle,{boxSizing:"content-box",height:I?"":M,minHeight:I?M:"",paddingTop:nh(n.paddingTop),paddingBottom:nh(n.paddingBottom)}]}),visibleItemsStyle:rt(()=>(c.value,{transform:`translateY(${nh(l.value.sum(h.value))})`})),viewportItems:m,listElRef:o,itemsElRef:Je(null),scrollTo:f,handleListResize:A,handleListScroll:x,handleListWheel:_,handleItemResize:p}},render(){const{itemResizable:n,keyField:e,keyToIndex:t,visibleItemsTag:r}=this;return ge(dd,{onResize:this.handleListResize},{default:()=>{var i,o;return ge("div",Dc(this.$attrs,{class:["v-vl",this.showScrollbar&&"v-vl--show-scrollbar"],onScroll:this.handleListScroll,onWheel:this.handleListWheel,ref:"listElRef"}),[this.items.length!==0?ge("div",{ref:"itemsElRef",class:"v-vl-items",style:this.itemsStyle},[ge(r,Object.assign({class:"v-vl-visible-items",style:this.visibleItemsStyle},this.visibleItemsProps),{default:()=>this.viewportItems.map(s=>{const a=s[e],l=t.get(a),c=this.$slots.default({item:s,index:l})[0];return n?ge(dd,{key:a,onResize:u=>this.handleItemResize(a,u)},{default:()=>c}):(c.key=a,c)})})]):(o=(i=this.$slots).empty)===null||o===void 0?void 0:o.call(i)])}})}}),Io="v-hidden",dL=Fs("[v-hidden]",{display:"none!important"}),V_=Vt({name:"Overflow",props:{getCounter:Function,getTail:Function,updateCounter:Function,onUpdateCount:Function,onUpdateOverflow:Function},setup(n,{slots:e}){const t=Je(null),r=Je(null);function i(s){const{value:a}=t,{getCounter:l,getTail:c}=n;let u;if(l!==void 0?u=l():u=r.value,!a||!u)return;u.hasAttribute(Io)&&u.removeAttribute(Io);const{children:d}=a;if(s.showAllItemsBeforeCalculate)for(const p of d)p.hasAttribute(Io)&&p.removeAttribute(Io);const h=a.offsetWidth,m=[],f=e.tail?c==null?void 0:c():null;let v=f?f.offsetWidth:0,g=!1;const b=a.children.length-(e.tail?1:0);for(let p=0;p<b-1;++p){if(p<0)continue;const y=d[p];if(g){y.hasAttribute(Io)||y.setAttribute(Io,"");continue}else y.hasAttribute(Io)&&y.removeAttribute(Io);const w=y.offsetWidth;if(v+=w,m[p]=w,v>h){const{updateCounter:x}=n;for(let _=p;_>=0;--_){const A=b-1-_;x!==void 0?x(A):u.textContent=`${A}`;const C=u.offsetWidth;if(v-=m[_],v+C<=h||_===0){g=!0,p=_-1,f&&(p===-1?(f.style.maxWidth=`${h-C}px`,f.style.boxSizing="border-box"):f.style.maxWidth="");const{onUpdateCount:T}=n;T&&T(A);break}}}}const{onUpdateOverflow:S}=n;g?S!==void 0&&S(!0):(S!==void 0&&S(!1),u.setAttribute(Io,""))}const o=cl();return dL.mount({id:"vueuc/overflow",head:!0,anchorMetaName:gb,ssr:o}),Er(()=>i({showAllItemsBeforeCalculate:!1})),{selfRef:t,counterRef:r,sync:i}},render(){const{$slots:n}=this;return ui(()=>this.sync({showAllItemsBeforeCalculate:!1})),ge("div",{class:"v-overflow",ref:"selfRef"},[nb(n,"default"),n.counter?n.counter():ge("span",{style:{display:"inline-block"},ref:"counterRef"}),n.tail?n.tail():null])}});function eT(n){return n instanceof HTMLElement}function tT(n){for(let e=0;e<n.childNodes.length;e++){const t=n.childNodes[e];if(eT(t)&&(rT(t)||tT(t)))return!0}return!1}function nT(n){for(let e=n.childNodes.length-1;e>=0;e--){const t=n.childNodes[e];if(eT(t)&&(rT(t)||nT(t)))return!0}return!1}function rT(n){if(!hL(n))return!1;try{n.focus({preventScroll:!0})}catch{}return document.activeElement===n}function hL(n){if(n.tabIndex>0||n.tabIndex===0&&n.getAttribute("tabIndex")!==null)return!0;if(n.getAttribute("disabled"))return!1;switch(n.nodeName){case"A":return!!n.href&&n.rel!=="ignore";case"INPUT":return n.type!=="hidden"&&n.type!=="file";case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}}let tu=[];const fL=Vt({name:"FocusTrap",props:{disabled:Boolean,active:Boolean,autoFocus:{type:Boolean,default:!0},onEsc:Function,initialFocusTo:String,finalFocusTo:String,returnFocusOnDeactivated:{type:Boolean,default:!0}},setup(n){const e=L4(),t=Je(null),r=Je(null);let i=!1,o=!1;const s=typeof document>"u"?null:document.activeElement;function a(){return tu[tu.length-1]===e}function l(g){var b;g.code==="Escape"&&a()&&((b=n.onEsc)===null||b===void 0||b.call(n,g))}Er(()=>{bn(()=>n.active,g=>{g?(d(),Bn("keydown",document,l)):(Tn("keydown",document,l),i&&h())},{immediate:!0})}),Nr(()=>{Tn("keydown",document,l),i&&h()});function c(g){if(!o&&a()){const b=u();if(b===null||b.contains(ld(g)))return;m("first")}}function u(){const g=t.value;if(g===null)return null;let b=g;for(;b=b.nextSibling,!(b===null||b instanceof Element&&b.tagName==="DIV"););return b}function d(){var g;if(!n.disabled){if(tu.push(e),n.autoFocus){const{initialFocusTo:b}=n;b===void 0?m("first"):(g=P_(b))===null||g===void 0||g.focus({preventScroll:!0})}i=!0,document.addEventListener("focus",c,!0)}}function h(){var g;if(n.disabled||(document.removeEventListener("focus",c,!0),tu=tu.filter(S=>S!==e),a()))return;const{finalFocusTo:b}=n;b!==void 0?(g=P_(b))===null||g===void 0||g.focus({preventScroll:!0}):n.returnFocusOnDeactivated&&s instanceof HTMLElement&&(o=!0,s.focus({preventScroll:!0}),o=!1)}function m(g){if(a()&&n.active){const b=t.value,S=r.value;if(b!==null&&S!==null){const p=u();if(p==null||p===S){o=!0,b.focus({preventScroll:!0}),o=!1;return}o=!0;const y=g==="first"?tT(p):nT(p);o=!1,y||(o=!0,b.focus({preventScroll:!0}),o=!1)}}}function f(g){if(o)return;const b=u();b!==null&&(g.relatedTarget!==null&&b.contains(g.relatedTarget)?m("last"):m("first"))}function v(g){o||(g.relatedTarget!==null&&g.relatedTarget===t.value?m("last"):m("first"))}return{focusableStartRef:t,focusableEndRef:r,focusableStyle:"position: absolute; height: 0; width: 0;",handleStartFocus:f,handleEndFocus:v}},render(){const{default:n}=this.$slots;if(n===void 0)return null;if(this.disabled)return n();const{active:e,focusableStyle:t}=this;return ge($n,null,[ge("div",{"aria-hidden":"true",tabindex:e?"0":"-1",ref:"focusableStartRef",style:t,onFocus:this.handleStartFocus}),n(),ge("div",{"aria-hidden":"true",style:t,ref:"focusableEndRef",tabindex:e?"0":"-1",onFocus:this.handleEndFocus})])}});function iT(n,e){e&&(Er(()=>{const{value:t}=n;t&&Jf.registerHandler(t,e)}),Nr(()=>{const{value:t}=n;t&&Jf.unregisterHandler(t)}))}function pL(n){const e={isDeactivated:!1};let t=!1;return eb(()=>{if(e.isDeactivated=!1,!t){t=!0;return}n()}),tb(()=>{e.isDeactivated=!0,t||(t=!0)}),e}const G_="n-form-item";function Ld(n,{defaultSize:e="medium",mergedSize:t,mergedDisabled:r}={}){const i=vn(G_,null);Xi(G_,null);const o=rt(t?()=>t(i):()=>{const{size:l}=n;if(l)return l;if(i){const{mergedSize:c}=i;if(c.value!==void 0)return c.value}return e}),s=rt(r?()=>r(i):()=>{const{disabled:l}=n;return l!==void 0?l:i?i.disabled.value:!1}),a=rt(()=>{const{status:l}=n;return l||(i==null?void 0:i.mergedValidationStatus.value)});return Nr(()=>{i&&i.restoreValidation()}),{mergedSizeRef:o,mergedDisabledRef:s,mergedStatusRef:a,nTriggerFormBlur(){i&&i.handleContentBlur()},nTriggerFormChange(){i&&i.handleContentChange()},nTriggerFormFocus(){i&&i.handleContentFocus()},nTriggerFormInput(){i&&i.handleContentInput()}}}var oT=typeof global=="object"&&global&&global.Object===Object&&global,mL=typeof self=="object"&&self&&self.Object===Object&&self,Po=oT||mL||Function("return this")(),Xs=Po.Symbol,sT=Object.prototype,gL=sT.hasOwnProperty,vL=sT.toString,nu=Xs?Xs.toStringTag:void 0;function bL(n){var e=gL.call(n,nu),t=n[nu];try{n[nu]=void 0;var r=!0}catch{}var i=vL.call(n);return r&&(e?n[nu]=t:delete n[nu]),i}var yL=Object.prototype,_L=yL.toString;function xL(n){return _L.call(n)}var wL="[object Null]",SL="[object Undefined]",W_=Xs?Xs.toStringTag:void 0;function ul(n){return n==null?n===void 0?SL:wL:W_&&W_ in Object(n)?bL(n):xL(n)}function Ys(n){return n!=null&&typeof n=="object"}var CL="[object Symbol]";function yb(n){return typeof n=="symbol"||Ys(n)&&ul(n)==CL}function aT(n,e){for(var t=-1,r=n==null?0:n.length,i=Array(r);++t<r;)i[t]=e(n[t],t,n);return i}var Ei=Array.isArray,AL=1/0,j_=Xs?Xs.prototype:void 0,q_=j_?j_.toString:void 0;function lT(n){if(typeof n=="string")return n;if(Ei(n))return aT(n,lT)+"";if(yb(n))return q_?q_.call(n):"";var e=n+"";return e=="0"&&1/n==-AL?"-0":e}function na(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}function _b(n){return n}var ML="[object AsyncFunction]",TL="[object Function]",EL="[object GeneratorFunction]",PL="[object Proxy]";function xb(n){if(!na(n))return!1;var e=ul(n);return e==TL||e==EL||e==ML||e==PL}var rg=Po["__core-js_shared__"],X_=function(){var n=/[^.]+$/.exec(rg&&rg.keys&&rg.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function RL(n){return!!X_&&X_ in n}var IL=Function.prototype,DL=IL.toString;function dl(n){if(n!=null){try{return DL.call(n)}catch{}try{return n+""}catch{}}return""}var LL=/[\\^$.*+?()[\]{}|]/g,FL=/^\[object .+?Constructor\]$/,OL=Function.prototype,kL=Object.prototype,BL=OL.toString,NL=kL.hasOwnProperty,zL=RegExp("^"+BL.call(NL).replace(LL,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function UL(n){if(!na(n)||RL(n))return!1;var e=xb(n)?zL:FL;return e.test(dl(n))}function $L(n,e){return n==null?void 0:n[e]}function hl(n,e){var t=$L(n,e);return UL(t)?t:void 0}var L1=hl(Po,"WeakMap"),Y_=Object.create,HL=function(){function n(){}return function(e){if(!na(e))return{};if(Y_)return Y_(e);n.prototype=e;var t=new n;return n.prototype=void 0,t}}();function VL(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}function GL(n,e){var t=-1,r=n.length;for(e||(e=Array(r));++t<r;)e[t]=n[t];return e}var WL=800,jL=16,qL=Date.now;function XL(n){var e=0,t=0;return function(){var r=qL(),i=jL-(r-t);if(t=r,i>0){if(++e>=WL)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}function YL(n){return function(){return n}}var Qf=function(){try{var n=hl(Object,"defineProperty");return n({},"",{}),n}catch{}}(),KL=Qf?function(n,e){return Qf(n,"toString",{configurable:!0,enumerable:!1,value:YL(e),writable:!0})}:_b,ZL=XL(KL),JL=9007199254740991,QL=/^(?:0|[1-9]\d*)$/;function wb(n,e){var t=typeof n;return e=e??JL,!!e&&(t=="number"||t!="symbol"&&QL.test(n))&&n>-1&&n%1==0&&n<e}function Sb(n,e,t){e=="__proto__"&&Qf?Qf(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}function Fd(n,e){return n===e||n!==n&&e!==e}var eF=Object.prototype,tF=eF.hasOwnProperty;function nF(n,e,t){var r=n[e];(!(tF.call(n,e)&&Fd(r,t))||t===void 0&&!(e in n))&&Sb(n,e,t)}function rF(n,e,t,r){var i=!t;t||(t={});for(var o=-1,s=e.length;++o<s;){var a=e[o],l=void 0;l===void 0&&(l=n[a]),i?Sb(t,a,l):nF(t,a,l)}return t}var K_=Math.max;function iF(n,e,t){return e=K_(e===void 0?n.length-1:e,0),function(){for(var r=arguments,i=-1,o=K_(r.length-e,0),s=Array(o);++i<o;)s[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=t(s),VL(n,this,a)}}function oF(n,e){return ZL(iF(n,e,_b),n+"")}var sF=9007199254740991;function Cb(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=sF}function Bc(n){return n!=null&&Cb(n.length)&&!xb(n)}function aF(n,e,t){if(!na(t))return!1;var r=typeof e;return(r=="number"?Bc(t)&&wb(e,t.length):r=="string"&&e in t)?Fd(t[e],n):!1}function lF(n){return oF(function(e,t){var r=-1,i=t.length,o=i>1?t[i-1]:void 0,s=i>2?t[2]:void 0;for(o=n.length>3&&typeof o=="function"?(i--,o):void 0,s&&aF(t[0],t[1],s)&&(o=i<3?void 0:o,i=1),e=Object(e);++r<i;){var a=t[r];a&&n(e,a,r,o)}return e})}var cF=Object.prototype;function Ab(n){var e=n&&n.constructor,t=typeof e=="function"&&e.prototype||cF;return n===t}function uF(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}var dF="[object Arguments]";function Z_(n){return Ys(n)&&ul(n)==dF}var cT=Object.prototype,hF=cT.hasOwnProperty,fF=cT.propertyIsEnumerable,ep=Z_(function(){return arguments}())?Z_:function(n){return Ys(n)&&hF.call(n,"callee")&&!fF.call(n,"callee")};function pF(){return!1}var uT=typeof li=="object"&&li&&!li.nodeType&&li,J_=uT&&typeof ci=="object"&&ci&&!ci.nodeType&&ci,mF=J_&&J_.exports===uT,Q_=mF?Po.Buffer:void 0,gF=Q_?Q_.isBuffer:void 0,tp=gF||pF,vF="[object Arguments]",bF="[object Array]",yF="[object Boolean]",_F="[object Date]",xF="[object Error]",wF="[object Function]",SF="[object Map]",CF="[object Number]",AF="[object Object]",MF="[object RegExp]",TF="[object Set]",EF="[object String]",PF="[object WeakMap]",RF="[object ArrayBuffer]",IF="[object DataView]",DF="[object Float32Array]",LF="[object Float64Array]",FF="[object Int8Array]",OF="[object Int16Array]",kF="[object Int32Array]",BF="[object Uint8Array]",NF="[object Uint8ClampedArray]",zF="[object Uint16Array]",UF="[object Uint32Array]",Cn={};Cn[DF]=Cn[LF]=Cn[FF]=Cn[OF]=Cn[kF]=Cn[BF]=Cn[NF]=Cn[zF]=Cn[UF]=!0;Cn[vF]=Cn[bF]=Cn[RF]=Cn[yF]=Cn[IF]=Cn[_F]=Cn[xF]=Cn[wF]=Cn[SF]=Cn[CF]=Cn[AF]=Cn[MF]=Cn[TF]=Cn[EF]=Cn[PF]=!1;function $F(n){return Ys(n)&&Cb(n.length)&&!!Cn[ul(n)]}function HF(n){return function(e){return n(e)}}var dT=typeof li=="object"&&li&&!li.nodeType&&li,Gu=dT&&typeof ci=="object"&&ci&&!ci.nodeType&&ci,VF=Gu&&Gu.exports===dT,ig=VF&&oT.process,ex=function(){try{var n=Gu&&Gu.require&&Gu.require("util").types;return n||ig&&ig.binding&&ig.binding("util")}catch{}}(),tx=ex&&ex.isTypedArray,Mb=tx?HF(tx):$F,GF=Object.prototype,WF=GF.hasOwnProperty;function hT(n,e){var t=Ei(n),r=!t&&ep(n),i=!t&&!r&&tp(n),o=!t&&!r&&!i&&Mb(n),s=t||r||i||o,a=s?uF(n.length,String):[],l=a.length;for(var c in n)(e||WF.call(n,c))&&!(s&&(c=="length"||i&&(c=="offset"||c=="parent")||o&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||wb(c,l)))&&a.push(c);return a}function fT(n,e){return function(t){return n(e(t))}}var jF=fT(Object.keys,Object),qF=Object.prototype,XF=qF.hasOwnProperty;function YF(n){if(!Ab(n))return jF(n);var e=[];for(var t in Object(n))XF.call(n,t)&&t!="constructor"&&e.push(t);return e}function Tb(n){return Bc(n)?hT(n):YF(n)}function KF(n){var e=[];if(n!=null)for(var t in Object(n))e.push(t);return e}var ZF=Object.prototype,JF=ZF.hasOwnProperty;function QF(n){if(!na(n))return KF(n);var e=Ab(n),t=[];for(var r in n)r=="constructor"&&(e||!JF.call(n,r))||t.push(r);return t}function pT(n){return Bc(n)?hT(n,!0):QF(n)}var eO=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tO=/^\w*$/;function Eb(n,e){if(Ei(n))return!1;var t=typeof n;return t=="number"||t=="symbol"||t=="boolean"||n==null||yb(n)?!0:tO.test(n)||!eO.test(n)||e!=null&&n in Object(e)}var hd=hl(Object,"create");function nO(){this.__data__=hd?hd(null):{},this.size=0}function rO(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var iO="__lodash_hash_undefined__",oO=Object.prototype,sO=oO.hasOwnProperty;function aO(n){var e=this.__data__;if(hd){var t=e[n];return t===iO?void 0:t}return sO.call(e,n)?e[n]:void 0}var lO=Object.prototype,cO=lO.hasOwnProperty;function uO(n){var e=this.__data__;return hd?e[n]!==void 0:cO.call(e,n)}var dO="__lodash_hash_undefined__";function hO(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=hd&&e===void 0?dO:e,this}function tl(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}tl.prototype.clear=nO;tl.prototype.delete=rO;tl.prototype.get=aO;tl.prototype.has=uO;tl.prototype.set=hO;function fO(){this.__data__=[],this.size=0}function tm(n,e){for(var t=n.length;t--;)if(Fd(n[t][0],e))return t;return-1}var pO=Array.prototype,mO=pO.splice;function gO(n){var e=this.__data__,t=tm(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():mO.call(e,t,1),--this.size,!0}function vO(n){var e=this.__data__,t=tm(e,n);return t<0?void 0:e[t][1]}function bO(n){return tm(this.__data__,n)>-1}function yO(n,e){var t=this.__data__,r=tm(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}function as(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}as.prototype.clear=fO;as.prototype.delete=gO;as.prototype.get=vO;as.prototype.has=bO;as.prototype.set=yO;var fd=hl(Po,"Map");function _O(){this.size=0,this.__data__={hash:new tl,map:new(fd||as),string:new tl}}function xO(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}function nm(n,e){var t=n.__data__;return xO(e)?t[typeof e=="string"?"string":"hash"]:t.map}function wO(n){var e=nm(this,n).delete(n);return this.size-=e?1:0,e}function SO(n){return nm(this,n).get(n)}function CO(n){return nm(this,n).has(n)}function AO(n,e){var t=nm(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}function ls(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}ls.prototype.clear=_O;ls.prototype.delete=wO;ls.prototype.get=SO;ls.prototype.has=CO;ls.prototype.set=AO;var MO="Expected a function";function Pb(n,e){if(typeof n!="function"||e!=null&&typeof e!="function")throw new TypeError(MO);var t=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=t.cache;if(o.has(i))return o.get(i);var s=n.apply(this,r);return t.cache=o.set(i,s)||o,s};return t.cache=new(Pb.Cache||ls),t}Pb.Cache=ls;var TO=500;function EO(n){var e=Pb(n,function(r){return t.size===TO&&t.clear(),r}),t=e.cache;return e}var PO=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,RO=/\\(\\)?/g,IO=EO(function(n){var e=[];return n.charCodeAt(0)===46&&e.push(""),n.replace(PO,function(t,r,i,o){e.push(i?o.replace(RO,"$1"):r||t)}),e});function mT(n){return n==null?"":lT(n)}function gT(n,e){return Ei(n)?n:Eb(n,e)?[n]:IO(mT(n))}var DO=1/0;function rm(n){if(typeof n=="string"||yb(n))return n;var e=n+"";return e=="0"&&1/n==-DO?"-0":e}function vT(n,e){e=gT(e,n);for(var t=0,r=e.length;n!=null&&t<r;)n=n[rm(e[t++])];return t&&t==r?n:void 0}function LO(n,e,t){var r=n==null?void 0:vT(n,e);return r===void 0?t:r}function FO(n,e){for(var t=-1,r=e.length,i=n.length;++t<r;)n[i+t]=e[t];return n}var bT=fT(Object.getPrototypeOf,Object),OO="[object Object]",kO=Function.prototype,BO=Object.prototype,yT=kO.toString,NO=BO.hasOwnProperty,zO=yT.call(Object);function UO(n){if(!Ys(n)||ul(n)!=OO)return!1;var e=bT(n);if(e===null)return!0;var t=NO.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&yT.call(t)==zO}function $O(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=n[r+e];return o}function HO(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:$O(n,e,t)}var VO="\\ud800-\\udfff",GO="\\u0300-\\u036f",WO="\\ufe20-\\ufe2f",jO="\\u20d0-\\u20ff",qO=GO+WO+jO,XO="\\ufe0e\\ufe0f",YO="\\u200d",KO=RegExp("["+YO+VO+qO+XO+"]");function _T(n){return KO.test(n)}function ZO(n){return n.split("")}var xT="\\ud800-\\udfff",JO="\\u0300-\\u036f",QO="\\ufe20-\\ufe2f",ek="\\u20d0-\\u20ff",tk=JO+QO+ek,nk="\\ufe0e\\ufe0f",rk="["+xT+"]",F1="["+tk+"]",O1="\\ud83c[\\udffb-\\udfff]",ik="(?:"+F1+"|"+O1+")",wT="[^"+xT+"]",ST="(?:\\ud83c[\\udde6-\\uddff]){2}",CT="[\\ud800-\\udbff][\\udc00-\\udfff]",ok="\\u200d",AT=ik+"?",MT="["+nk+"]?",sk="(?:"+ok+"(?:"+[wT,ST,CT].join("|")+")"+MT+AT+")*",ak=MT+AT+sk,lk="(?:"+[wT+F1+"?",F1,ST,CT,rk].join("|")+")",ck=RegExp(O1+"(?="+O1+")|"+lk+ak,"g");function uk(n){return n.match(ck)||[]}function dk(n){return _T(n)?uk(n):ZO(n)}function hk(n){return function(e){e=mT(e);var t=_T(e)?dk(e):void 0,r=t?t[0]:e.charAt(0),i=t?HO(t,1).join(""):e.slice(1);return r[n]()+i}}var fk=hk("toUpperCase");function pk(){this.__data__=new as,this.size=0}function mk(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}function gk(n){return this.__data__.get(n)}function vk(n){return this.__data__.has(n)}var bk=200;function yk(n,e){var t=this.__data__;if(t instanceof as){var r=t.__data__;if(!fd||r.length<bk-1)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new ls(r)}return t.set(n,e),this.size=t.size,this}function _o(n){var e=this.__data__=new as(n);this.size=e.size}_o.prototype.clear=pk;_o.prototype.delete=mk;_o.prototype.get=gk;_o.prototype.has=vk;_o.prototype.set=yk;var TT=typeof li=="object"&&li&&!li.nodeType&&li,nx=TT&&typeof ci=="object"&&ci&&!ci.nodeType&&ci,_k=nx&&nx.exports===TT,rx=_k?Po.Buffer:void 0;rx&&rx.allocUnsafe;function xk(n,e){return n.slice()}function wk(n,e){for(var t=-1,r=n==null?0:n.length,i=0,o=[];++t<r;){var s=n[t];e(s,t,n)&&(o[i++]=s)}return o}function Sk(){return[]}var Ck=Object.prototype,Ak=Ck.propertyIsEnumerable,ix=Object.getOwnPropertySymbols,Mk=ix?function(n){return n==null?[]:(n=Object(n),wk(ix(n),function(e){return Ak.call(n,e)}))}:Sk;function Tk(n,e,t){var r=e(n);return Ei(n)?r:FO(r,t(n))}function ox(n){return Tk(n,Tb,Mk)}var k1=hl(Po,"DataView"),B1=hl(Po,"Promise"),N1=hl(Po,"Set"),sx="[object Map]",Ek="[object Object]",ax="[object Promise]",lx="[object Set]",cx="[object WeakMap]",ux="[object DataView]",Pk=dl(k1),Rk=dl(fd),Ik=dl(B1),Dk=dl(N1),Lk=dl(L1),Rs=ul;(k1&&Rs(new k1(new ArrayBuffer(1)))!=ux||fd&&Rs(new fd)!=sx||B1&&Rs(B1.resolve())!=ax||N1&&Rs(new N1)!=lx||L1&&Rs(new L1)!=cx)&&(Rs=function(n){var e=ul(n),t=e==Ek?n.constructor:void 0,r=t?dl(t):"";if(r)switch(r){case Pk:return ux;case Rk:return sx;case Ik:return ax;case Dk:return lx;case Lk:return cx}return e});var np=Po.Uint8Array;function Fk(n){var e=new n.constructor(n.byteLength);return new np(e).set(new np(n)),e}function Ok(n,e){var t=Fk(n.buffer);return new n.constructor(t,n.byteOffset,n.length)}function kk(n){return typeof n.constructor=="function"&&!Ab(n)?HL(bT(n)):{}}var Bk="__lodash_hash_undefined__";function Nk(n){return this.__data__.set(n,Bk),this}function zk(n){return this.__data__.has(n)}function rp(n){var e=-1,t=n==null?0:n.length;for(this.__data__=new ls;++e<t;)this.add(n[e])}rp.prototype.add=rp.prototype.push=Nk;rp.prototype.has=zk;function Uk(n,e){for(var t=-1,r=n==null?0:n.length;++t<r;)if(e(n[t],t,n))return!0;return!1}function $k(n,e){return n.has(e)}var Hk=1,Vk=2;function ET(n,e,t,r,i,o){var s=t&Hk,a=n.length,l=e.length;if(a!=l&&!(s&&l>a))return!1;var c=o.get(n),u=o.get(e);if(c&&u)return c==e&&u==n;var d=-1,h=!0,m=t&Vk?new rp:void 0;for(o.set(n,e),o.set(e,n);++d<a;){var f=n[d],v=e[d];if(r)var g=s?r(v,f,d,e,n,o):r(f,v,d,n,e,o);if(g!==void 0){if(g)continue;h=!1;break}if(m){if(!Uk(e,function(b,S){if(!$k(m,S)&&(f===b||i(f,b,t,r,o)))return m.push(S)})){h=!1;break}}else if(!(f===v||i(f,v,t,r,o))){h=!1;break}}return o.delete(n),o.delete(e),h}function Gk(n){var e=-1,t=Array(n.size);return n.forEach(function(r,i){t[++e]=[i,r]}),t}function Wk(n){var e=-1,t=Array(n.size);return n.forEach(function(r){t[++e]=r}),t}var jk=1,qk=2,Xk="[object Boolean]",Yk="[object Date]",Kk="[object Error]",Zk="[object Map]",Jk="[object Number]",Qk="[object RegExp]",eB="[object Set]",tB="[object String]",nB="[object Symbol]",rB="[object ArrayBuffer]",iB="[object DataView]",dx=Xs?Xs.prototype:void 0,og=dx?dx.valueOf:void 0;function oB(n,e,t,r,i,o,s){switch(t){case iB:if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case rB:return!(n.byteLength!=e.byteLength||!o(new np(n),new np(e)));case Xk:case Yk:case Jk:return Fd(+n,+e);case Kk:return n.name==e.name&&n.message==e.message;case Qk:case tB:return n==e+"";case Zk:var a=Gk;case eB:var l=r&jk;if(a||(a=Wk),n.size!=e.size&&!l)return!1;var c=s.get(n);if(c)return c==e;r|=qk,s.set(n,e);var u=ET(a(n),a(e),r,i,o,s);return s.delete(n),u;case nB:if(og)return og.call(n)==og.call(e)}return!1}var sB=1,aB=Object.prototype,lB=aB.hasOwnProperty;function cB(n,e,t,r,i,o){var s=t&sB,a=ox(n),l=a.length,c=ox(e),u=c.length;if(l!=u&&!s)return!1;for(var d=l;d--;){var h=a[d];if(!(s?h in e:lB.call(e,h)))return!1}var m=o.get(n),f=o.get(e);if(m&&f)return m==e&&f==n;var v=!0;o.set(n,e),o.set(e,n);for(var g=s;++d<l;){h=a[d];var b=n[h],S=e[h];if(r)var p=s?r(S,b,h,e,n,o):r(b,S,h,n,e,o);if(!(p===void 0?b===S||i(b,S,t,r,o):p)){v=!1;break}g||(g=h=="constructor")}if(v&&!g){var y=n.constructor,w=e.constructor;y!=w&&"constructor"in n&&"constructor"in e&&!(typeof y=="function"&&y instanceof y&&typeof w=="function"&&w instanceof w)&&(v=!1)}return o.delete(n),o.delete(e),v}var uB=1,hx="[object Arguments]",fx="[object Array]",dh="[object Object]",dB=Object.prototype,px=dB.hasOwnProperty;function hB(n,e,t,r,i,o){var s=Ei(n),a=Ei(e),l=s?fx:Rs(n),c=a?fx:Rs(e);l=l==hx?dh:l,c=c==hx?dh:c;var u=l==dh,d=c==dh,h=l==c;if(h&&tp(n)){if(!tp(e))return!1;s=!0,u=!1}if(h&&!u)return o||(o=new _o),s||Mb(n)?ET(n,e,t,r,i,o):oB(n,e,l,t,r,i,o);if(!(t&uB)){var m=u&&px.call(n,"__wrapped__"),f=d&&px.call(e,"__wrapped__");if(m||f){var v=m?n.value():n,g=f?e.value():e;return o||(o=new _o),i(v,g,t,r,o)}}return h?(o||(o=new _o),cB(n,e,t,r,i,o)):!1}function Rb(n,e,t,r,i){return n===e?!0:n==null||e==null||!Ys(n)&&!Ys(e)?n!==n&&e!==e:hB(n,e,t,r,Rb,i)}var fB=1,pB=2;function mB(n,e,t,r){var i=t.length,o=i;if(n==null)return!o;for(n=Object(n);i--;){var s=t[i];if(s[2]?s[1]!==n[s[0]]:!(s[0]in n))return!1}for(;++i<o;){s=t[i];var a=s[0],l=n[a],c=s[1];if(s[2]){if(l===void 0&&!(a in n))return!1}else{var u=new _o,d;if(!(d===void 0?Rb(c,l,fB|pB,r,u):d))return!1}}return!0}function PT(n){return n===n&&!na(n)}function gB(n){for(var e=Tb(n),t=e.length;t--;){var r=e[t],i=n[r];e[t]=[r,i,PT(i)]}return e}function RT(n,e){return function(t){return t==null?!1:t[n]===e&&(e!==void 0||n in Object(t))}}function vB(n){var e=gB(n);return e.length==1&&e[0][2]?RT(e[0][0],e[0][1]):function(t){return t===n||mB(t,n,e)}}function bB(n,e){return n!=null&&e in Object(n)}function yB(n,e,t){e=gT(e,n);for(var r=-1,i=e.length,o=!1;++r<i;){var s=rm(e[r]);if(!(o=n!=null&&t(n,s)))break;n=n[s]}return o||++r!=i?o:(i=n==null?0:n.length,!!i&&Cb(i)&&wb(s,i)&&(Ei(n)||ep(n)))}function _B(n,e){return n!=null&&yB(n,e,bB)}var xB=1,wB=2;function SB(n,e){return Eb(n)&&PT(e)?RT(rm(n),e):function(t){var r=LO(t,n);return r===void 0&&r===e?_B(t,n):Rb(e,r,xB|wB)}}function CB(n){return function(e){return e==null?void 0:e[n]}}function AB(n){return function(e){return vT(e,n)}}function MB(n){return Eb(n)?CB(rm(n)):AB(n)}function TB(n){return typeof n=="function"?n:n==null?_b:typeof n=="object"?Ei(n)?SB(n[0],n[1]):vB(n):MB(n)}function EB(n){return function(e,t,r){for(var i=-1,o=Object(e),s=r(e),a=s.length;a--;){var l=s[++i];if(t(o[l],l,o)===!1)break}return e}}var IT=EB();function PB(n,e){return n&&IT(n,e,Tb)}function RB(n,e){return function(t,r){if(t==null)return t;if(!Bc(t))return n(t,r);for(var i=t.length,o=-1,s=Object(t);++o<i&&r(s[o],o,s)!==!1;);return t}}var IB=RB(PB);function z1(n,e,t){(t!==void 0&&!Fd(n[e],t)||t===void 0&&!(e in n))&&Sb(n,e,t)}function DB(n){return Ys(n)&&Bc(n)}function U1(n,e){if(!(e==="constructor"&&typeof n[e]=="function")&&e!="__proto__")return n[e]}function LB(n){return rF(n,pT(n))}function FB(n,e,t,r,i,o,s){var a=U1(n,t),l=U1(e,t),c=s.get(l);if(c){z1(n,t,c);return}var u=o?o(a,l,t+"",n,e,s):void 0,d=u===void 0;if(d){var h=Ei(l),m=!h&&tp(l),f=!h&&!m&&Mb(l);u=l,h||m||f?Ei(a)?u=a:DB(a)?u=GL(a):m?(d=!1,u=xk(l)):f?(d=!1,u=Ok(l)):u=[]:UO(l)||ep(l)?(u=a,ep(a)?u=LB(a):(!na(a)||xb(a))&&(u=kk(l))):d=!1}d&&(s.set(l,u),i(u,l,r,o,s),s.delete(l)),z1(n,t,u)}function DT(n,e,t,r,i){n!==e&&IT(e,function(o,s){if(i||(i=new _o),na(o))FB(n,e,s,t,DT,r,i);else{var a=r?r(U1(n,s),o,s+"",n,e,i):void 0;a===void 0&&(a=o),z1(n,s,a)}},pT)}function OB(n,e){var t=-1,r=Bc(n)?Array(n.length):[];return IB(n,function(i,o,s){r[++t]=e(i,o,s)}),r}function kB(n,e){var t=Ei(n)?aT:OB;return t(n,TB(e))}var hh=lF(function(n,e,t){DT(n,e,t)});const fl={fontFamily:'v-sans, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',fontFamilyMono:"v-mono, SFMono-Regular, Menlo, Consolas, Courier, monospace",fontWeight:"400",fontWeightStrong:"500",cubicBezierEaseInOut:"cubic-bezier(.4, 0, .2, 1)",cubicBezierEaseOut:"cubic-bezier(0, 0, .2, 1)",cubicBezierEaseIn:"cubic-bezier(.4, 0, 1, 1)",borderRadius:"3px",borderRadiusSmall:"2px",fontSize:"14px",fontSizeMini:"12px",fontSizeTiny:"12px",fontSizeSmall:"14px",fontSizeMedium:"14px",fontSizeLarge:"15px",fontSizeHuge:"16px",lineHeight:"1.6",heightMini:"16px",heightTiny:"22px",heightSmall:"28px",heightMedium:"34px",heightLarge:"40px",heightHuge:"46px"},{fontSize:BB,fontFamily:NB,lineHeight:zB}=fl,LT=tt("body",`
 margin: 0;
 font-size: ${BB};
 font-family: ${NB};
 line-height: ${zB};
 -webkit-text-size-adjust: 100%;
 -webkit-tap-highlight-color: transparent;
`,[tt("input",`
 font-family: inherit;
 font-size: inherit;
 `)]),pl="n-config-provider",pd="naive-ui-style";function cn(n,e,t,r,i,o){const s=cl(),a=vn(pl,null);if(t){const c=()=>{const u=o==null?void 0:o.value;t.mount({id:u===void 0?e:u+e,head:!0,props:{bPrefix:u?`.${u}-`:void 0},anchorMetaName:pd,ssr:s}),a!=null&&a.preflightStyleDisabled||LT.mount({id:"n-global",head:!0,anchorMetaName:pd,ssr:s})};s?c():Gp(c)}return rt(()=>{var c;const{theme:{common:u,self:d,peers:h={}}={},themeOverrides:m={},builtinThemeOverrides:f={}}=i,{common:v,peers:g}=m,{common:b=void 0,[n]:{common:S=void 0,self:p=void 0,peers:y={}}={}}=(a==null?void 0:a.mergedThemeRef.value)||{},{common:w=void 0,[n]:x={}}=(a==null?void 0:a.mergedThemeOverridesRef.value)||{},{common:_,peers:A={}}=x,C=hh({},u||S||b||r.common,w,_,v),T=hh((c=d||p||r.self)===null||c===void 0?void 0:c(C),f,x,m);return{common:C,self:T,peers:hh({},r.peers,y,h),peerOverrides:hh({},f.peers,A,g)}})}cn.props={theme:Object,themeOverrides:Object,builtinThemeOverrides:Object};const UB="n";function ei(n={},e={defaultBordered:!0}){const t=vn(pl,null);return{inlineThemeDisabled:t==null?void 0:t.inlineThemeDisabled,mergedRtlRef:t==null?void 0:t.mergedRtlRef,mergedComponentPropsRef:t==null?void 0:t.mergedComponentPropsRef,mergedBreakpointsRef:t==null?void 0:t.mergedBreakpointsRef,mergedBorderedRef:rt(()=>{var r,i;const{bordered:o}=n;return o!==void 0?o:(i=(r=t==null?void 0:t.mergedBorderedRef.value)!==null&&r!==void 0?r:e.defaultBordered)!==null&&i!==void 0?i:!0}),mergedClsPrefixRef:t?t.mergedClsPrefixRef:n3(UB),namespaceRef:rt(()=>t==null?void 0:t.mergedNamespaceRef.value)}}const $B={name:"en-US",global:{undo:"Undo",redo:"Redo",confirm:"Confirm",clear:"Clear"},Popconfirm:{positiveText:"Confirm",negativeText:"Cancel"},Cascader:{placeholder:"Please Select",loading:"Loading",loadingRequiredMessage:n=>`Please load all ${n}'s descendants before checking it.`},Time:{dateFormat:"yyyy-MM-dd",dateTimeFormat:"yyyy-MM-dd HH:mm:ss"},DatePicker:{yearFormat:"yyyy",monthFormat:"MMM",dayFormat:"eeeeee",yearTypeFormat:"yyyy",monthTypeFormat:"yyyy-MM",dateFormat:"yyyy-MM-dd",dateTimeFormat:"yyyy-MM-dd HH:mm:ss",quarterFormat:"yyyy-qqq",weekFormat:"RRRR-w",clear:"Clear",now:"Now",confirm:"Confirm",selectTime:"Select Time",selectDate:"Select Date",datePlaceholder:"Select Date",datetimePlaceholder:"Select Date and Time",monthPlaceholder:"Select Month",yearPlaceholder:"Select Year",quarterPlaceholder:"Select Quarter",weekPlaceholder:"Select Week",startDatePlaceholder:"Start Date",endDatePlaceholder:"End Date",startDatetimePlaceholder:"Start Date and Time",endDatetimePlaceholder:"End Date and Time",startMonthPlaceholder:"Start Month",endMonthPlaceholder:"End Month",monthBeforeYear:!0,firstDayOfWeek:6,today:"Today"},DataTable:{checkTableAll:"Select all in the table",uncheckTableAll:"Unselect all in the table",confirm:"Confirm",clear:"Clear"},LegacyTransfer:{sourceTitle:"Source",targetTitle:"Target"},Transfer:{selectAll:"Select all",unselectAll:"Unselect all",clearAll:"Clear",total:n=>`Total ${n} items`,selected:n=>`${n} items selected`},Empty:{description:"No Data"},Select:{placeholder:"Please Select"},TimePicker:{placeholder:"Select Time",positiveText:"OK",negativeText:"Cancel",now:"Now",clear:"Clear"},Pagination:{goto:"Goto",selectionSuffix:"page"},DynamicTags:{add:"Add"},Log:{loading:"Loading"},Input:{placeholder:"Please Input"},InputNumber:{placeholder:"Please Input"},DynamicInput:{create:"Create"},ThemeEditor:{title:"Theme Editor",clearAllVars:"Clear All Variables",clearSearch:"Clear Search",filterCompName:"Filter Component Name",filterVarName:"Filter Variable Name",import:"Import",export:"Export",restore:"Reset to Default"},Image:{tipPrevious:"Previous picture (←)",tipNext:"Next picture (→)",tipCounterclockwise:"Counterclockwise",tipClockwise:"Clockwise",tipZoomOut:"Zoom out",tipZoomIn:"Zoom in",tipDownload:"Download",tipClose:"Close (Esc)",tipOriginalSize:"Zoom to original size"}};function sg(n){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):n.defaultWidth,r=n.formats[t]||n.formats[n.defaultWidth];return r}}function ru(n){return function(e,t){var r=t!=null&&t.context?String(t.context):"standalone",i;if(r==="formatting"&&n.formattingValues){var o=n.defaultFormattingWidth||n.defaultWidth,s=t!=null&&t.width?String(t.width):o;i=n.formattingValues[s]||n.formattingValues[o]}else{var a=n.defaultWidth,l=t!=null&&t.width?String(t.width):n.defaultWidth;i=n.values[l]||n.values[a]}var c=n.argumentCallback?n.argumentCallback(e):e;return i[c]}}function iu(n){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t.width,i=r&&n.matchPatterns[r]||n.matchPatterns[n.defaultMatchWidth],o=e.match(i);if(!o)return null;var s=o[0],a=r&&n.parsePatterns[r]||n.parsePatterns[n.defaultParseWidth],l=Array.isArray(a)?VB(a,function(d){return d.test(s)}):HB(a,function(d){return d.test(s)}),c;c=n.valueCallback?n.valueCallback(l):l,c=t.valueCallback?t.valueCallback(c):c;var u=e.slice(s.length);return{value:c,rest:u}}}function HB(n,e){for(var t in n)if(n.hasOwnProperty(t)&&e(n[t]))return t}function VB(n,e){for(var t=0;t<n.length;t++)if(e(n[t]))return t}function GB(n){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=e.match(n.matchPattern);if(!r)return null;var i=r[0],o=e.match(n.parsePattern);if(!o)return null;var s=n.valueCallback?n.valueCallback(o[0]):o[0];s=t.valueCallback?t.valueCallback(s):s;var a=e.slice(i.length);return{value:s,rest:a}}}var WB={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},jB=function(e,t,r){var i,o=WB[e];return typeof o=="string"?i=o:t===1?i=o.one:i=o.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+i:i+" ago":i},qB={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},XB={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},YB={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},KB={date:sg({formats:qB,defaultWidth:"full"}),time:sg({formats:XB,defaultWidth:"full"}),dateTime:sg({formats:YB,defaultWidth:"full"})},ZB={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},JB=function(e,t,r,i){return ZB[e]},QB={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},eN={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},tN={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},nN={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},rN={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},iN={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},oN=function(e,t){var r=Number(e),i=r%100;if(i>20||i<10)switch(i%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},sN={ordinalNumber:oN,era:ru({values:QB,defaultWidth:"wide"}),quarter:ru({values:eN,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:ru({values:tN,defaultWidth:"wide"}),day:ru({values:nN,defaultWidth:"wide"}),dayPeriod:ru({values:rN,defaultWidth:"wide",formattingValues:iN,defaultFormattingWidth:"wide"})},aN=/^(\d+)(th|st|nd|rd)?/i,lN=/\d+/i,cN={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},uN={any:[/^b/i,/^(a|c)/i]},dN={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},hN={any:[/1/i,/2/i,/3/i,/4/i]},fN={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},pN={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},mN={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},gN={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},vN={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},bN={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},yN={ordinalNumber:GB({matchPattern:aN,parsePattern:lN,valueCallback:function(e){return parseInt(e,10)}}),era:iu({matchPatterns:cN,defaultMatchWidth:"wide",parsePatterns:uN,defaultParseWidth:"any"}),quarter:iu({matchPatterns:dN,defaultMatchWidth:"wide",parsePatterns:hN,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:iu({matchPatterns:fN,defaultMatchWidth:"wide",parsePatterns:pN,defaultParseWidth:"any"}),day:iu({matchPatterns:mN,defaultMatchWidth:"wide",parsePatterns:gN,defaultParseWidth:"any"}),dayPeriod:iu({matchPatterns:vN,defaultMatchWidth:"any",parsePatterns:bN,defaultParseWidth:"any"})},_N={code:"en-US",formatDistance:jB,formatLong:KB,formatRelative:JB,localize:sN,match:yN,options:{weekStartsOn:0,firstWeekContainsDate:1}};const xN={name:"en-US",locale:_N};function im(n){const{mergedLocaleRef:e,mergedDateLocaleRef:t}=vn(pl,null)||{},r=rt(()=>{var o,s;return(s=(o=e==null?void 0:e.value)===null||o===void 0?void 0:o[n])!==null&&s!==void 0?s:$B[n]});return{dateLocaleRef:rt(()=>{var o;return(o=t==null?void 0:t.value)!==null&&o!==void 0?o:xN}),localeRef:r}}function Nc(n,e,t){if(!e)return;const r=cl(),i=vn(pl,null),o=()=>{const s=t.value;e.mount({id:s===void 0?n:s+n,head:!0,anchorMetaName:pd,props:{bPrefix:s?`.${s}-`:void 0},ssr:r}),i!=null&&i.preflightStyleDisabled||LT.mount({id:"n-global",head:!0,anchorMetaName:pd,ssr:r})};r?o():Gp(o)}function Qr(n,e,t,r){var i;t||O4("useThemeClass","cssVarsRef is not passed");const o=(i=vn(pl,null))===null||i===void 0?void 0:i.mergedThemeHashRef,s=Je(""),a=cl();let l;const c=`__${n}`,u=()=>{let d=c;const h=e?e.value:void 0,m=o==null?void 0:o.value;m&&(d+=`-${m}`),h&&(d+=`-${h}`);const{themeOverrides:f,builtinThemeOverrides:v}=r;f&&(d+=`-${P1(JSON.stringify(f))}`),v&&(d+=`-${P1(JSON.stringify(v))}`),s.value=d,l=()=>{const g=t.value;let b="";for(const S in g)b+=`${S}: ${g[S]};`;tt(`.${d}`,b).mount({id:d,ssr:a}),l=void 0}};return Ws(()=>{u()}),{themeClass:s,onRender:()=>{l==null||l()}}}function ra(n,e,t){if(!e)return;const r=cl(),i=rt(()=>{const{value:s}=e;if(!s)return;const a=s[n];if(a)return a}),o=()=>{Ws(()=>{const{value:s}=t,a=`${s}${n}Rtl`;if(tD(a,r))return;const{value:l}=i;l&&l.style.mount({id:a,head:!0,anchorMetaName:pd,props:{bPrefix:s?`.${s}-`:void 0},ssr:r})})};return r?o():Gp(o),i}const wN=Vt({name:"Add",render(){return ge("svg",{width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ge("path",{d:"M256 112V400M400 256H112",stroke:"currentColor","stroke-width":"32","stroke-linecap":"round","stroke-linejoin":"round"}))}});function zc(n,e){return Vt({name:fk(n),setup(){var t;const r=(t=vn(pl,null))===null||t===void 0?void 0:t.mergedIconsRef;return()=>{var i;const o=(i=r==null?void 0:r.value)===null||i===void 0?void 0:i[n];return o?o():e}}})}const SN=Vt({name:"Checkmark",render(){return ge("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},ge("g",{fill:"none"},ge("path",{d:"M14.046 3.486a.75.75 0 0 1-.032 1.06l-7.93 7.474a.85.85 0 0 1-1.188-.022l-2.68-2.72a.75.75 0 1 1 1.068-1.053l2.234 2.267l7.468-7.038a.75.75 0 0 1 1.06.032z",fill:"currentColor"})))}}),FT=zc("close",ge("svg",{viewBox:"0 0 12 12",version:"1.1",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0},ge("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},ge("g",{fill:"currentColor","fill-rule":"nonzero"},ge("path",{d:"M2.08859116,2.2156945 L2.14644661,2.14644661 C2.32001296,1.97288026 2.58943736,1.95359511 2.7843055,2.08859116 L2.85355339,2.14644661 L6,5.293 L9.14644661,2.14644661 C9.34170876,1.95118446 9.65829124,1.95118446 9.85355339,2.14644661 C10.0488155,2.34170876 10.0488155,2.65829124 9.85355339,2.85355339 L6.707,6 L9.85355339,9.14644661 C10.0271197,9.32001296 10.0464049,9.58943736 9.91140884,9.7843055 L9.85355339,9.85355339 C9.67998704,10.0271197 9.41056264,10.0464049 9.2156945,9.91140884 L9.14644661,9.85355339 L6,6.707 L2.85355339,9.85355339 C2.65829124,10.0488155 2.34170876,10.0488155 2.14644661,9.85355339 C1.95118446,9.65829124 1.95118446,9.34170876 2.14644661,9.14644661 L5.293,6 L2.14644661,2.85355339 C1.97288026,2.67998704 1.95359511,2.41056264 2.08859116,2.2156945 L2.14644661,2.14644661 L2.08859116,2.2156945 Z"}))))),CN=Vt({name:"Eye",render(){return ge("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},ge("path",{d:"M255.66 112c-77.94 0-157.89 45.11-220.83 135.33a16 16 0 0 0-.27 17.77C82.92 340.8 161.8 400 255.66 400c92.84 0 173.34-59.38 221.79-135.25a16.14 16.14 0 0 0 0-17.47C428.89 172.28 347.8 112 255.66 112z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"}),ge("circle",{cx:"256",cy:"256",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"}))}}),AN=Vt({name:"EyeOff",render(){return ge("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},ge("path",{d:"M432 448a15.92 15.92 0 0 1-11.31-4.69l-352-352a16 16 0 0 1 22.62-22.62l352 352A16 16 0 0 1 432 448z",fill:"currentColor"}),ge("path",{d:"M255.66 384c-41.49 0-81.5-12.28-118.92-36.5c-34.07-22-64.74-53.51-88.7-91v-.08c19.94-28.57 41.78-52.73 65.24-72.21a2 2 0 0 0 .14-2.94L93.5 161.38a2 2 0 0 0-2.71-.12c-24.92 21-48.05 46.76-69.08 76.92a31.92 31.92 0 0 0-.64 35.54c26.41 41.33 60.4 76.14 98.28 100.65C162 402 207.9 416 255.66 416a239.13 239.13 0 0 0 75.8-12.58a2 2 0 0 0 .77-3.31l-21.58-21.58a4 4 0 0 0-3.83-1a204.8 204.8 0 0 1-51.16 6.47z",fill:"currentColor"}),ge("path",{d:"M490.84 238.6c-26.46-40.92-60.79-75.68-99.27-100.53C349 110.55 302 96 255.66 96a227.34 227.34 0 0 0-74.89 12.83a2 2 0 0 0-.75 3.31l21.55 21.55a4 4 0 0 0 3.88 1a192.82 192.82 0 0 1 50.21-6.69c40.69 0 80.58 12.43 118.55 37c34.71 22.4 65.74 53.88 89.76 91a.13.13 0 0 1 0 .16a310.72 310.72 0 0 1-64.12 72.73a2 2 0 0 0-.15 2.95l19.9 19.89a2 2 0 0 0 2.7.13a343.49 343.49 0 0 0 68.64-78.48a32.2 32.2 0 0 0-.1-34.78z",fill:"currentColor"}),ge("path",{d:"M256 160a95.88 95.88 0 0 0-21.37 2.4a2 2 0 0 0-1 3.38l112.59 112.56a2 2 0 0 0 3.38-1A96 96 0 0 0 256 160z",fill:"currentColor"}),ge("path",{d:"M165.78 233.66a2 2 0 0 0-3.38 1a96 96 0 0 0 115 115a2 2 0 0 0 1-3.38z",fill:"currentColor"}))}}),MN=Vt({name:"Empty",render(){return ge("svg",{viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ge("path",{d:"M26 7.5C26 11.0899 23.0899 14 19.5 14C15.9101 14 13 11.0899 13 7.5C13 3.91015 15.9101 1 19.5 1C23.0899 1 26 3.91015 26 7.5ZM16.8536 4.14645C16.6583 3.95118 16.3417 3.95118 16.1464 4.14645C15.9512 4.34171 15.9512 4.65829 16.1464 4.85355L18.7929 7.5L16.1464 10.1464C15.9512 10.3417 15.9512 10.6583 16.1464 10.8536C16.3417 11.0488 16.6583 11.0488 16.8536 10.8536L19.5 8.20711L22.1464 10.8536C22.3417 11.0488 22.6583 11.0488 22.8536 10.8536C23.0488 10.6583 23.0488 10.3417 22.8536 10.1464L20.2071 7.5L22.8536 4.85355C23.0488 4.65829 23.0488 4.34171 22.8536 4.14645C22.6583 3.95118 22.3417 3.95118 22.1464 4.14645L19.5 6.79289L16.8536 4.14645Z",fill:"currentColor"}),ge("path",{d:"M25 22.75V12.5991C24.5572 13.0765 24.053 13.4961 23.5 13.8454V16H17.5L17.3982 16.0068C17.0322 16.0565 16.75 16.3703 16.75 16.75C16.75 18.2688 15.5188 19.5 14 19.5C12.4812 19.5 11.25 18.2688 11.25 16.75L11.2432 16.6482C11.1935 16.2822 10.8797 16 10.5 16H4.5V7.25C4.5 6.2835 5.2835 5.5 6.25 5.5H12.2696C12.4146 4.97463 12.6153 4.47237 12.865 4H6.25C4.45507 4 3 5.45507 3 7.25V22.75C3 24.5449 4.45507 26 6.25 26H21.75C23.5449 26 25 24.5449 25 22.75ZM4.5 22.75V17.5H9.81597L9.85751 17.7041C10.2905 19.5919 11.9808 21 14 21L14.215 20.9947C16.2095 20.8953 17.842 19.4209 18.184 17.5H23.5V22.75C23.5 23.7165 22.7165 24.5 21.75 24.5H6.25C5.2835 24.5 4.5 23.7165 4.5 22.75Z",fill:"currentColor"}))}}),TN=zc("error",ge("svg",{viewBox:"0 0 48 48",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},ge("g",{stroke:"none","stroke-width":"1","fill-rule":"evenodd"},ge("g",{"fill-rule":"nonzero"},ge("path",{d:"M24,4 C35.045695,4 44,12.954305 44,24 C44,35.045695 35.045695,44 24,44 C12.954305,44 4,35.045695 4,24 C4,12.954305 12.954305,4 24,4 Z M17.8838835,16.1161165 L17.7823881,16.0249942 C17.3266086,15.6583353 16.6733914,15.6583353 16.2176119,16.0249942 L16.1161165,16.1161165 L16.0249942,16.2176119 C15.6583353,16.6733914 15.6583353,17.3266086 16.0249942,17.7823881 L16.1161165,17.8838835 L22.233,24 L16.1161165,30.1161165 L16.0249942,30.2176119 C15.6583353,30.6733914 15.6583353,31.3266086 16.0249942,31.7823881 L16.1161165,31.8838835 L16.2176119,31.9750058 C16.6733914,32.3416647 17.3266086,32.3416647 17.7823881,31.9750058 L17.8838835,31.8838835 L24,25.767 L30.1161165,31.8838835 L30.2176119,31.9750058 C30.6733914,32.3416647 31.3266086,32.3416647 31.7823881,31.9750058 L31.8838835,31.8838835 L31.9750058,31.7823881 C32.3416647,31.3266086 32.3416647,30.6733914 31.9750058,30.2176119 L31.8838835,30.1161165 L25.767,24 L31.8838835,17.8838835 L31.9750058,17.7823881 C32.3416647,17.3266086 32.3416647,16.6733914 31.9750058,16.2176119 L31.8838835,16.1161165 L31.7823881,16.0249942 C31.3266086,15.6583353 30.6733914,15.6583353 30.2176119,16.0249942 L30.1161165,16.1161165 L24,22.233 L17.8838835,16.1161165 L17.7823881,16.0249942 L17.8838835,16.1161165 Z"}))))),EN=zc("info",ge("svg",{viewBox:"0 0 28 28",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},ge("g",{stroke:"none","stroke-width":"1","fill-rule":"evenodd"},ge("g",{"fill-rule":"nonzero"},ge("path",{d:"M14,2 C20.6274,2 26,7.37258 26,14 C26,20.6274 20.6274,26 14,26 C7.37258,26 2,20.6274 2,14 C2,7.37258 7.37258,2 14,2 Z M14,11 C13.4477,11 13,11.4477 13,12 L13,12 L13,20 C13,20.5523 13.4477,21 14,21 C14.5523,21 15,20.5523 15,20 L15,20 L15,12 C15,11.4477 14.5523,11 14,11 Z M14,6.75 C13.3096,6.75 12.75,7.30964 12.75,8 C12.75,8.69036 13.3096,9.25 14,9.25 C14.6904,9.25 15.25,8.69036 15.25,8 C15.25,7.30964 14.6904,6.75 14,6.75 Z"}))))),PN=Vt({name:"Remove",render(){return ge("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},ge("line",{x1:"400",y1:"256",x2:"112",y2:"256",style:`
        fill: none;
        stroke: currentColor;
        stroke-linecap: round;
        stroke-linejoin: round;
        stroke-width: 32px;
      `}))}}),RN=zc("success",ge("svg",{viewBox:"0 0 48 48",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},ge("g",{stroke:"none","stroke-width":"1","fill-rule":"evenodd"},ge("g",{"fill-rule":"nonzero"},ge("path",{d:"M24,4 C35.045695,4 44,12.954305 44,24 C44,35.045695 35.045695,44 24,44 C12.954305,44 4,35.045695 4,24 C4,12.954305 12.954305,4 24,4 Z M32.6338835,17.6161165 C32.1782718,17.1605048 31.4584514,17.1301307 30.9676119,17.5249942 L30.8661165,17.6161165 L20.75,27.732233 L17.1338835,24.1161165 C16.6457281,23.6279612 15.8542719,23.6279612 15.3661165,24.1161165 C14.9105048,24.5717282 14.8801307,25.2915486 15.2749942,25.7823881 L15.3661165,25.8838835 L19.8661165,30.3838835 C20.3217282,30.8394952 21.0415486,30.8698693 21.5323881,30.4750058 L21.6338835,30.3838835 L32.6338835,19.3838835 C33.1220388,18.8957281 33.1220388,18.1042719 32.6338835,17.6161165 Z"}))))),IN=zc("warning",ge("svg",{viewBox:"0 0 24 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},ge("g",{stroke:"none","stroke-width":"1","fill-rule":"evenodd"},ge("g",{"fill-rule":"nonzero"},ge("path",{d:"M12,2 C17.523,2 22,6.478 22,12 C22,17.522 17.523,22 12,22 C6.477,22 2,17.522 2,12 C2,6.478 6.477,2 12,2 Z M12.0018002,15.0037242 C11.450254,15.0037242 11.0031376,15.4508407 11.0031376,16.0023869 C11.0031376,16.553933 11.450254,17.0010495 12.0018002,17.0010495 C12.5533463,17.0010495 13.0004628,16.553933 13.0004628,16.0023869 C13.0004628,15.4508407 12.5533463,15.0037242 12.0018002,15.0037242 Z M11.99964,7 C11.4868042,7.00018474 11.0642719,7.38637706 11.0066858,7.8837365 L11,8.00036004 L11.0018003,13.0012393 L11.00857,13.117858 C11.0665141,13.6151758 11.4893244,14.0010638 12.0021602,14.0008793 C12.514996,14.0006946 12.9375283,13.6145023 12.9951144,13.1171428 L13.0018002,13.0005193 L13,7.99964009 L12.9932303,7.8830214 C12.9352861,7.38570354 12.5124758,6.99981552 11.99964,7 Z"}))))),DN=Vt({name:"ChevronDown",render(){return ge("svg",{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ge("path",{d:"M3.14645 5.64645C3.34171 5.45118 3.65829 5.45118 3.85355 5.64645L8 9.79289L12.1464 5.64645C12.3417 5.45118 12.6583 5.45118 12.8536 5.64645C13.0488 5.84171 13.0488 6.15829 12.8536 6.35355L8.35355 10.8536C8.15829 11.0488 7.84171 11.0488 7.64645 10.8536L3.14645 6.35355C2.95118 6.15829 2.95118 5.84171 3.14645 5.64645Z",fill:"currentColor"}))}}),LN=zc("clear",ge("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},ge("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},ge("g",{fill:"currentColor","fill-rule":"nonzero"},ge("path",{d:"M8,2 C11.3137085,2 14,4.6862915 14,8 C14,11.3137085 11.3137085,14 8,14 C4.6862915,14 2,11.3137085 2,8 C2,4.6862915 4.6862915,2 8,2 Z M6.5343055,5.83859116 C6.33943736,5.70359511 6.07001296,5.72288026 5.89644661,5.89644661 L5.89644661,5.89644661 L5.83859116,5.9656945 C5.70359511,6.16056264 5.72288026,6.42998704 5.89644661,6.60355339 L5.89644661,6.60355339 L7.293,8 L5.89644661,9.39644661 L5.83859116,9.4656945 C5.70359511,9.66056264 5.72288026,9.92998704 5.89644661,10.1035534 L5.89644661,10.1035534 L5.9656945,10.1614088 C6.16056264,10.2964049 6.42998704,10.2771197 6.60355339,10.1035534 L6.60355339,10.1035534 L8,8.707 L9.39644661,10.1035534 L9.4656945,10.1614088 C9.66056264,10.2964049 9.92998704,10.2771197 10.1035534,10.1035534 L10.1035534,10.1035534 L10.1614088,10.0343055 C10.2964049,9.83943736 10.2771197,9.57001296 10.1035534,9.39644661 L10.1035534,9.39644661 L8.707,8 L10.1035534,6.60355339 L10.1614088,6.5343055 C10.2964049,6.33943736 10.2771197,6.07001296 10.1035534,5.89644661 L10.1035534,5.89644661 L10.0343055,5.83859116 C9.83943736,5.70359511 9.57001296,5.72288026 9.39644661,5.89644661 L9.39644661,5.89644661 L8,7.293 L6.60355339,5.89644661 Z"}))))),Ib=Vt({name:"BaseIconSwitchTransition",setup(n,{slots:e}){const t=Dd();return()=>ge(Mo,{name:"icon-switch-transition",appear:t.value},e)}}),OT=Vt({name:"FadeInExpandTransition",props:{appear:Boolean,group:Boolean,mode:String,onLeave:Function,onAfterLeave:Function,onAfterEnter:Function,width:Boolean,reverse:Boolean},setup(n,{slots:e}){function t(a){n.width?a.style.maxWidth=`${a.offsetWidth}px`:a.style.maxHeight=`${a.offsetHeight}px`,a.offsetWidth}function r(a){n.width?a.style.maxWidth="0":a.style.maxHeight="0",a.offsetWidth;const{onLeave:l}=n;l&&l()}function i(a){n.width?a.style.maxWidth="":a.style.maxHeight="";const{onAfterLeave:l}=n;l&&l()}function o(a){if(a.style.transition="none",n.width){const l=a.offsetWidth;a.style.maxWidth="0",a.offsetWidth,a.style.transition="",a.style.maxWidth=`${l}px`}else if(n.reverse)a.style.maxHeight=`${a.offsetHeight}px`,a.offsetHeight,a.style.transition="",a.style.maxHeight="0";else{const l=a.offsetHeight;a.style.maxHeight="0",a.offsetWidth,a.style.transition="",a.style.maxHeight=`${l}px`}a.offsetWidth}function s(a){var l;n.width?a.style.maxWidth="":n.reverse||(a.style.maxHeight=""),(l=n.onAfterEnter)===null||l===void 0||l.call(n)}return()=>{const{group:a,width:l,appear:c,mode:u}=n,d=a?kI:Mo,h={name:l?"fade-in-width-expand-transition":"fade-in-height-expand-transition",appear:c,onEnter:o,onAfterEnter:s,onBeforeLeave:t,onLeave:r,onAfterLeave:i};return a||(h.mode=u),ge(d,h,e)}}}),FN=Ke("base-icon",`
 height: 1em;
 width: 1em;
 line-height: 1em;
 text-align: center;
 display: inline-block;
 position: relative;
 fill: currentColor;
 transform: translateZ(0);
`,[tt("svg",`
 height: 1em;
 width: 1em;
 `)]),Ji=Vt({name:"BaseIcon",props:{role:String,ariaLabel:String,ariaDisabled:{type:Boolean,default:void 0},ariaHidden:{type:Boolean,default:void 0},clsPrefix:{type:String,required:!0},onClick:Function,onMousedown:Function,onMouseup:Function},setup(n){Nc("-base-icon",FN,Jt(n,"clsPrefix"))},render(){return ge("i",{class:`${this.clsPrefix}-base-icon`,onClick:this.onClick,onMousedown:this.onMousedown,onMouseup:this.onMouseup,role:this.role,"aria-label":this.ariaLabel,"aria-hidden":this.ariaHidden,"aria-disabled":this.ariaDisabled},this.$slots)}}),ON=Ke("base-close",`
 display: flex;
 align-items: center;
 justify-content: center;
 cursor: pointer;
 background-color: transparent;
 color: var(--n-close-icon-color);
 border-radius: var(--n-close-border-radius);
 height: var(--n-close-size);
 width: var(--n-close-size);
 font-size: var(--n-close-icon-size);
 outline: none;
 border: none;
 position: relative;
 padding: 0;
`,[pt("absolute",`
 height: var(--n-close-icon-size);
 width: var(--n-close-icon-size);
 `),tt("&::before",`
 content: "";
 position: absolute;
 width: var(--n-close-size);
 height: var(--n-close-size);
 left: 50%;
 top: 50%;
 transform: translateY(-50%) translateX(-50%);
 transition: inherit;
 border-radius: inherit;
 `),ar("disabled",[tt("&:hover",`
 color: var(--n-close-icon-color-hover);
 `),tt("&:hover::before",`
 background-color: var(--n-close-color-hover);
 `),tt("&:focus::before",`
 background-color: var(--n-close-color-hover);
 `),tt("&:active",`
 color: var(--n-close-icon-color-pressed);
 `),tt("&:active::before",`
 background-color: var(--n-close-color-pressed);
 `)]),pt("disabled",`
 cursor: not-allowed;
 color: var(--n-close-icon-color-disabled);
 background-color: transparent;
 `),pt("round",[tt("&::before",`
 border-radius: 50%;
 `)])]),kT=Vt({name:"BaseClose",props:{isButtonTag:{type:Boolean,default:!0},clsPrefix:{type:String,required:!0},disabled:{type:Boolean,default:void 0},focusable:{type:Boolean,default:!0},round:Boolean,onClick:Function,absolute:Boolean},setup(n){return Nc("-base-close",ON,Jt(n,"clsPrefix")),()=>{const{clsPrefix:e,disabled:t,absolute:r,round:i,isButtonTag:o}=n;return ge(o?"button":"div",{type:o?"button":void 0,tabindex:t||!n.focusable?-1:0,"aria-disabled":t,"aria-label":"close",role:o?void 0:"button",disabled:t,class:[`${e}-base-close`,r&&`${e}-base-close--absolute`,t&&`${e}-base-close--disabled`,i&&`${e}-base-close--round`],onMousedown:a=>{n.focusable||a.preventDefault()},onClick:n.onClick},ge(Ji,{clsPrefix:e},{default:()=>ge(FT,null)}))}}}),kN=Vt({props:{onFocus:Function,onBlur:Function},setup(n){return()=>ge("div",{style:"width: 0; height: 0",tabindex:0,onFocus:n.onFocus,onBlur:n.onBlur})}}),{cubicBezierEaseInOut:BN}=fl;function ip({originalTransform:n="",left:e=0,top:t=0,transition:r=`all .3s ${BN} !important`}={}){return[tt("&.icon-switch-transition-enter-from, &.icon-switch-transition-leave-to",{transform:`${n} scale(0.75)`,left:e,top:t,opacity:0}),tt("&.icon-switch-transition-enter-to, &.icon-switch-transition-leave-from",{transform:`scale(1) ${n}`,left:e,top:t,opacity:1}),tt("&.icon-switch-transition-enter-active, &.icon-switch-transition-leave-active",{transformOrigin:"center",position:"absolute",left:e,top:t,transition:r})]}const NN=tt([tt("@keyframes rotator",`
 0% {
 -webkit-transform: rotate(0deg);
 transform: rotate(0deg);
 }
 100% {
 -webkit-transform: rotate(360deg);
 transform: rotate(360deg);
 }`),Ke("base-loading",`
 position: relative;
 line-height: 0;
 width: 1em;
 height: 1em;
 `,[Ye("transition-wrapper",`
 position: absolute;
 width: 100%;
 height: 100%;
 `,[ip()]),Ye("placeholder",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 `,[ip({left:"50%",top:"50%",originalTransform:"translateX(-50%) translateY(-50%)"})]),Ye("container",`
 animation: rotator 3s linear infinite both;
 `,[Ye("icon",`
 height: 1em;
 width: 1em;
 `)])])]),ag="1.6s",zN={strokeWidth:{type:Number,default:28},stroke:{type:String,default:void 0}},Db=Vt({name:"BaseLoading",props:Object.assign({clsPrefix:{type:String,required:!0},show:{type:Boolean,default:!0},scale:{type:Number,default:1},radius:{type:Number,default:100}},zN),setup(n){Nc("-base-loading",NN,Jt(n,"clsPrefix"))},render(){const{clsPrefix:n,radius:e,strokeWidth:t,stroke:r,scale:i}=this,o=e/i;return ge("div",{class:`${n}-base-loading`,role:"img","aria-label":"loading"},ge(Ib,null,{default:()=>this.show?ge("div",{key:"icon",class:`${n}-base-loading__transition-wrapper`},ge("div",{class:`${n}-base-loading__container`},ge("svg",{class:`${n}-base-loading__icon`,viewBox:`0 0 ${2*o} ${2*o}`,xmlns:"http://www.w3.org/2000/svg",style:{color:r}},ge("g",null,ge("animateTransform",{attributeName:"transform",type:"rotate",values:`0 ${o} ${o};270 ${o} ${o}`,begin:"0s",dur:ag,fill:"freeze",repeatCount:"indefinite"}),ge("circle",{class:`${n}-base-loading__icon`,fill:"none",stroke:"currentColor","stroke-width":t,"stroke-linecap":"round",cx:o,cy:o,r:e-t/2,"stroke-dasharray":5.67*e,"stroke-dashoffset":18.48*e},ge("animateTransform",{attributeName:"transform",type:"rotate",values:`0 ${o} ${o};135 ${o} ${o};450 ${o} ${o}`,begin:"0s",dur:ag,fill:"freeze",repeatCount:"indefinite"}),ge("animate",{attributeName:"stroke-dashoffset",values:`${5.67*e};${1.42*e};${5.67*e}`,begin:"0s",dur:ag,fill:"freeze",repeatCount:"indefinite"})))))):ge("div",{key:"placeholder",class:`${n}-base-loading__placeholder`},this.$slots)}))}});function mx(n){return Array.isArray(n)?n:[n]}const $1={STOP:"STOP"};function BT(n,e){const t=e(n);n.children!==void 0&&t!==$1.STOP&&n.children.forEach(r=>BT(r,e))}function UN(n,e={}){const{preserveGroup:t=!1}=e,r=[],i=t?s=>{s.isLeaf||(r.push(s.key),o(s.children))}:s=>{s.isLeaf||(s.isGroup||r.push(s.key),o(s.children))};function o(s){s.forEach(i)}return o(n),r}function $N(n,e){const{isLeaf:t}=n;return t!==void 0?t:!e(n)}function HN(n){return n.children}function VN(n){return n.key}function GN(){return!1}function WN(n,e){const{isLeaf:t}=n;return!(t===!1&&!Array.isArray(e(n)))}function jN(n){return n.disabled===!0}function qN(n,e){return n.isLeaf===!1&&!Array.isArray(e(n))}function lg(n){var e;return n==null?[]:Array.isArray(n)?n:(e=n.checkedKeys)!==null&&e!==void 0?e:[]}function cg(n){var e;return n==null||Array.isArray(n)?[]:(e=n.indeterminateKeys)!==null&&e!==void 0?e:[]}function XN(n,e){const t=new Set(n);return e.forEach(r=>{t.has(r)||t.add(r)}),Array.from(t)}function YN(n,e){const t=new Set(n);return e.forEach(r=>{t.has(r)&&t.delete(r)}),Array.from(t)}function KN(n){return(n==null?void 0:n.type)==="group"}function ZN(n){const e=new Map;return n.forEach((t,r)=>{e.set(t.key,r)}),t=>{var r;return(r=e.get(t))!==null&&r!==void 0?r:null}}class JN extends Error{constructor(){super(),this.message="SubtreeNotLoadedError: checking a subtree whose required nodes are not fully loaded."}}function QN(n,e,t,r){return op(e.concat(n),t,r,!1)}function e6(n,e){const t=new Set;return n.forEach(r=>{const i=e.treeNodeMap.get(r);if(i!==void 0){let o=i.parent;for(;o!==null&&!(o.disabled||t.has(o.key));)t.add(o.key),o=o.parent}}),t}function t6(n,e,t,r){const i=op(e,t,r,!1),o=op(n,t,r,!0),s=e6(n,t),a=[];return i.forEach(l=>{(o.has(l)||s.has(l))&&a.push(l)}),a.forEach(l=>i.delete(l)),i}function ug(n,e){const{checkedKeys:t,keysToCheck:r,keysToUncheck:i,indeterminateKeys:o,cascade:s,leafOnly:a,checkStrategy:l,allowNotLoaded:c}=n;if(!s)return r!==void 0?{checkedKeys:XN(t,r),indeterminateKeys:Array.from(o)}:i!==void 0?{checkedKeys:YN(t,i),indeterminateKeys:Array.from(o)}:{checkedKeys:Array.from(t),indeterminateKeys:Array.from(o)};const{levelTreeNodeMap:u}=e;let d;i!==void 0?d=t6(i,t,e,c):r!==void 0?d=QN(r,t,e,c):d=op(t,e,c,!1);const h=l==="parent",m=l==="child"||a,f=d,v=new Set,g=Math.max.apply(null,Array.from(u.keys()));for(let b=g;b>=0;b-=1){const S=b===0,p=u.get(b);for(const y of p){if(y.isLeaf)continue;const{key:w,shallowLoaded:x}=y;if(m&&x&&y.children.forEach(T=>{!T.disabled&&!T.isLeaf&&T.shallowLoaded&&f.has(T.key)&&f.delete(T.key)}),y.disabled||!x)continue;let _=!0,A=!1,C=!0;for(const T of y.children){const I=T.key;if(!T.disabled){if(C&&(C=!1),f.has(I))A=!0;else if(v.has(I)){A=!0,_=!1;break}else if(_=!1,A)break}}_&&!C?(h&&y.children.forEach(T=>{!T.disabled&&f.has(T.key)&&f.delete(T.key)}),f.add(w)):A&&v.add(w),S&&m&&f.has(w)&&f.delete(w)}}return{checkedKeys:Array.from(f),indeterminateKeys:Array.from(v)}}function op(n,e,t,r){const{treeNodeMap:i,getChildren:o}=e,s=new Set,a=new Set(n);return n.forEach(l=>{const c=i.get(l);c!==void 0&&BT(c,u=>{if(u.disabled)return $1.STOP;const{key:d}=u;if(!s.has(d)&&(s.add(d),a.add(d),qN(u.rawNode,o))){if(r)return $1.STOP;if(!t)throw new JN}})}),a}function n6(n,{includeGroup:e=!1,includeSelf:t=!0},r){var i;const o=r.treeNodeMap;let s=n==null?null:(i=o.get(n))!==null&&i!==void 0?i:null;const a={keyPath:[],treeNodePath:[],treeNode:s};if(s!=null&&s.ignored)return a.treeNode=null,a;for(;s;)!s.ignored&&(e||!s.isGroup)&&a.treeNodePath.push(s),s=s.parent;return a.treeNodePath.reverse(),t||a.treeNodePath.pop(),a.keyPath=a.treeNodePath.map(l=>l.key),a}function r6(n){if(n.length===0)return null;const e=n[0];return e.isGroup||e.ignored||e.disabled?e.getNext():e}function i6(n,e){const t=n.siblings,r=t.length,{index:i}=n;return e?t[(i+1)%r]:i===t.length-1?null:t[i+1]}function gx(n,e,{loop:t=!1,includeDisabled:r=!1}={}){const i=e==="prev"?o6:i6,o={reverse:e==="prev"};let s=!1,a=null;function l(c){if(c!==null){if(c===n){if(!s)s=!0;else if(!n.disabled&&!n.isGroup){a=n;return}}else if((!c.disabled||r)&&!c.ignored&&!c.isGroup){a=c;return}if(c.isGroup){const u=Lb(c,o);u!==null?a=u:l(i(c,t))}else{const u=i(c,!1);if(u!==null)l(u);else{const d=s6(c);d!=null&&d.isGroup?l(i(d,t)):t&&l(i(c,!0))}}}}return l(n),a}function o6(n,e){const t=n.siblings,r=t.length,{index:i}=n;return e?t[(i-1+r)%r]:i===0?null:t[i-1]}function s6(n){return n.parent}function Lb(n,e={}){const{reverse:t=!1}=e,{children:r}=n;if(r){const{length:i}=r,o=t?i-1:0,s=t?-1:i,a=t?-1:1;for(let l=o;l!==s;l+=a){const c=r[l];if(!c.disabled&&!c.ignored)if(c.isGroup){const u=Lb(c,e);if(u!==null)return u}else return c}}return null}const a6={getChild(){return this.ignored?null:Lb(this)},getParent(){const{parent:n}=this;return n!=null&&n.isGroup?n.getParent():n},getNext(n={}){return gx(this,"next",n)},getPrev(n={}){return gx(this,"prev",n)}};function l6(n,e){const t=e?new Set(e):void 0,r=[];function i(o){o.forEach(s=>{r.push(s),!(s.isLeaf||!s.children||s.ignored)&&(s.isGroup||t===void 0||t.has(s.key))&&i(s.children)})}return i(n),r}function c6(n,e){const t=n.key;for(;e;){if(e.key===t)return!0;e=e.parent}return!1}function NT(n,e,t,r,i,o=null,s=0){const a=[];return n.forEach((l,c)=>{var u;const d=Object.create(r);if(d.rawNode=l,d.siblings=a,d.level=s,d.index=c,d.isFirstChild=c===0,d.isLastChild=c+1===n.length,d.parent=o,!d.ignored){const h=i(l);Array.isArray(h)&&(d.children=NT(h,e,t,r,i,d,s+1))}a.push(d),e.set(d.key,d),t.has(s)||t.set(s,[]),(u=t.get(s))===null||u===void 0||u.push(d)}),a}function u6(n,e={}){var t;const r=new Map,i=new Map,{getDisabled:o=jN,getIgnored:s=GN,getIsGroup:a=KN,getKey:l=VN}=e,c=(t=e.getChildren)!==null&&t!==void 0?t:HN,u=e.ignoreEmptyChildren?y=>{const w=c(y);return Array.isArray(w)?w.length?w:null:w}:c,d=Object.assign({get key(){return l(this.rawNode)},get disabled(){return o(this.rawNode)},get isGroup(){return a(this.rawNode)},get isLeaf(){return $N(this.rawNode,u)},get shallowLoaded(){return WN(this.rawNode,u)},get ignored(){return s(this.rawNode)},contains(y){return c6(this,y)}},a6),h=NT(n,r,i,d,u);function m(y){if(y==null)return null;const w=r.get(y);return w&&!w.isGroup&&!w.ignored?w:null}function f(y){if(y==null)return null;const w=r.get(y);return w&&!w.ignored?w:null}function v(y,w){const x=f(y);return x?x.getPrev(w):null}function g(y,w){const x=f(y);return x?x.getNext(w):null}function b(y){const w=f(y);return w?w.getParent():null}function S(y){const w=f(y);return w?w.getChild():null}const p={treeNodes:h,treeNodeMap:r,levelTreeNodeMap:i,maxLevel:Math.max(...i.keys()),getChildren:u,getFlattenedNodes(y){return l6(h,y)},getNode:m,getPrev:v,getNext:g,getParent:b,getChild:S,getFirstAvailableNode(){return r6(h)},getPath(y,w={}){return n6(y,w,p)},getCheckedKeys(y,w={}){const{cascade:x=!0,leafOnly:_=!1,checkStrategy:A="all",allowNotLoaded:C=!1}=w;return ug({checkedKeys:lg(y),indeterminateKeys:cg(y),cascade:x,leafOnly:_,checkStrategy:A,allowNotLoaded:C},p)},check(y,w,x={}){const{cascade:_=!0,leafOnly:A=!1,checkStrategy:C="all",allowNotLoaded:T=!1}=x;return ug({checkedKeys:lg(w),indeterminateKeys:cg(w),keysToCheck:y==null?[]:mx(y),cascade:_,leafOnly:A,checkStrategy:C,allowNotLoaded:T},p)},uncheck(y,w,x={}){const{cascade:_=!0,leafOnly:A=!1,checkStrategy:C="all",allowNotLoaded:T=!1}=x;return ug({checkedKeys:lg(w),indeterminateKeys:cg(w),keysToUncheck:y==null?[]:mx(y),cascade:_,leafOnly:A,checkStrategy:C,allowNotLoaded:T},p)},getNonLeafKeys(y={}){return UN(h,y)}};return p}const Pt={neutralBase:"#FFF",neutralInvertBase:"#000",neutralTextBase:"#000",neutralPopover:"#fff",neutralCard:"#fff",neutralModal:"#fff",neutralBody:"#fff",alpha1:"0.82",alpha2:"0.72",alpha3:"0.38",alpha4:"0.24",alpha5:"0.18",alphaClose:"0.6",alphaDisabled:"0.5",alphaDisabledInput:"0.02",alphaPending:"0.05",alphaTablePending:"0.02",alphaPressed:"0.07",alphaAvatar:"0.2",alphaRail:"0.14",alphaProgressRail:".08",alphaBorder:"0.12",alphaDivider:"0.06",alphaInput:"0",alphaAction:"0.02",alphaTab:"0.04",alphaScrollbar:"0.25",alphaScrollbarHover:"0.4",alphaCode:"0.05",alphaTag:"0.02",primaryHover:"#36ad6a",primaryDefault:"#18a058",primaryActive:"#0c7a43",primarySuppl:"#36ad6a",infoHover:"#4098fc",infoDefault:"#2080f0",infoActive:"#1060c9",infoSuppl:"#4098fc",errorHover:"#de576d",errorDefault:"#d03050",errorActive:"#ab1f3f",errorSuppl:"#de576d",warningHover:"#fcb040",warningDefault:"#f0a020",warningActive:"#c97c10",warningSuppl:"#fcb040",successHover:"#36ad6a",successDefault:"#18a058",successActive:"#0c7a43",successSuppl:"#36ad6a"},d6=qs(Pt.neutralBase),zT=qs(Pt.neutralInvertBase),h6=`rgba(${zT.slice(0,3).join(", ")}, `;function vx(n){return`${h6+String(n)})`}function yr(n){const e=Array.from(zT);return e[3]=Number(n),$i(d6,e)}const ti=Object.assign(Object.assign({name:"common"},fl),{baseColor:Pt.neutralBase,primaryColor:Pt.primaryDefault,primaryColorHover:Pt.primaryHover,primaryColorPressed:Pt.primaryActive,primaryColorSuppl:Pt.primarySuppl,infoColor:Pt.infoDefault,infoColorHover:Pt.infoHover,infoColorPressed:Pt.infoActive,infoColorSuppl:Pt.infoSuppl,successColor:Pt.successDefault,successColorHover:Pt.successHover,successColorPressed:Pt.successActive,successColorSuppl:Pt.successSuppl,warningColor:Pt.warningDefault,warningColorHover:Pt.warningHover,warningColorPressed:Pt.warningActive,warningColorSuppl:Pt.warningSuppl,errorColor:Pt.errorDefault,errorColorHover:Pt.errorHover,errorColorPressed:Pt.errorActive,errorColorSuppl:Pt.errorSuppl,textColorBase:Pt.neutralTextBase,textColor1:"rgb(31, 34, 37)",textColor2:"rgb(51, 54, 57)",textColor3:"rgb(118, 124, 130)",textColorDisabled:yr(Pt.alpha4),placeholderColor:yr(Pt.alpha4),placeholderColorDisabled:yr(Pt.alpha5),iconColor:yr(Pt.alpha4),iconColorHover:rh(yr(Pt.alpha4),{lightness:.75}),iconColorPressed:rh(yr(Pt.alpha4),{lightness:.9}),iconColorDisabled:yr(Pt.alpha5),opacity1:Pt.alpha1,opacity2:Pt.alpha2,opacity3:Pt.alpha3,opacity4:Pt.alpha4,opacity5:Pt.alpha5,dividerColor:"rgb(239, 239, 245)",borderColor:"rgb(224, 224, 230)",closeIconColor:yr(Number(Pt.alphaClose)),closeIconColorHover:yr(Number(Pt.alphaClose)),closeIconColorPressed:yr(Number(Pt.alphaClose)),closeColorHover:"rgba(0, 0, 0, .09)",closeColorPressed:"rgba(0, 0, 0, .13)",clearColor:yr(Pt.alpha4),clearColorHover:rh(yr(Pt.alpha4),{lightness:.75}),clearColorPressed:rh(yr(Pt.alpha4),{lightness:.9}),scrollbarColor:vx(Pt.alphaScrollbar),scrollbarColorHover:vx(Pt.alphaScrollbarHover),scrollbarWidth:"5px",scrollbarHeight:"5px",scrollbarBorderRadius:"5px",progressRailColor:yr(Pt.alphaProgressRail),railColor:"rgb(219, 219, 223)",popoverColor:Pt.neutralPopover,tableColor:Pt.neutralCard,cardColor:Pt.neutralCard,modalColor:Pt.neutralModal,bodyColor:Pt.neutralBody,tagColor:"#eee",avatarColor:yr(Pt.alphaAvatar),invertedColor:"rgb(0, 20, 40)",inputColor:yr(Pt.alphaInput),codeColor:"rgb(244, 244, 248)",tabColor:"rgb(247, 247, 250)",actionColor:"rgb(250, 250, 252)",tableHeaderColor:"rgb(250, 250, 252)",hoverColor:"rgb(243, 243, 245)",tableColorHover:"rgba(0, 0, 100, 0.03)",tableColorStriped:"rgba(0, 0, 100, 0.02)",pressedColor:"rgb(237, 237, 239)",opacityDisabled:Pt.alphaDisabled,inputColorDisabled:"rgb(250, 250, 252)",buttonColor2:"rgba(46, 51, 56, .05)",buttonColor2Hover:"rgba(46, 51, 56, .09)",buttonColor2Pressed:"rgba(46, 51, 56, .13)",boxShadow1:"0 1px 2px -2px rgba(0, 0, 0, .08), 0 3px 6px 0 rgba(0, 0, 0, .06), 0 5px 12px 4px rgba(0, 0, 0, .04)",boxShadow2:"0 3px 6px -4px rgba(0, 0, 0, .12), 0 6px 16px 0 rgba(0, 0, 0, .08), 0 9px 28px 8px rgba(0, 0, 0, .05)",boxShadow3:"0 6px 16px -9px rgba(0, 0, 0, .08), 0 9px 28px 0 rgba(0, 0, 0, .05), 0 12px 48px 16px rgba(0, 0, 0, .03)"}),f6={iconSizeSmall:"34px",iconSizeMedium:"40px",iconSizeLarge:"46px",iconSizeHuge:"52px"};function p6(n){const{textColorDisabled:e,iconColor:t,textColor2:r,fontSizeSmall:i,fontSizeMedium:o,fontSizeLarge:s,fontSizeHuge:a}=n;return Object.assign(Object.assign({},f6),{fontSizeSmall:i,fontSizeMedium:o,fontSizeLarge:s,fontSizeHuge:a,textColor:e,iconColor:t,extraTextColor:r})}const UT={name:"Empty",common:ti,self:p6},m6=Ke("empty",`
 display: flex;
 flex-direction: column;
 align-items: center;
 font-size: var(--n-font-size);
`,[Ye("icon",`
 width: var(--n-icon-size);
 height: var(--n-icon-size);
 font-size: var(--n-icon-size);
 line-height: var(--n-icon-size);
 color: var(--n-icon-color);
 transition:
 color .3s var(--n-bezier);
 `,[tt("+",[Ye("description",`
 margin-top: 8px;
 `)])]),Ye("description",`
 transition: color .3s var(--n-bezier);
 color: var(--n-text-color);
 `),Ye("extra",`
 text-align: center;
 transition: color .3s var(--n-bezier);
 margin-top: 12px;
 color: var(--n-extra-text-color);
 `)]),g6=Object.assign(Object.assign({},cn.props),{description:String,showDescription:{type:Boolean,default:!0},showIcon:{type:Boolean,default:!0},size:{type:String,default:"medium"},renderIcon:Function}),v6=Vt({name:"Empty",props:g6,setup(n){const{mergedClsPrefixRef:e,inlineThemeDisabled:t}=ei(n),r=cn("Empty","-empty",m6,UT,n,e),{localeRef:i}=im("Empty"),o=vn(pl,null),s=rt(()=>{var u,d,h;return(u=n.description)!==null&&u!==void 0?u:(h=(d=o==null?void 0:o.mergedComponentPropsRef.value)===null||d===void 0?void 0:d.Empty)===null||h===void 0?void 0:h.description}),a=rt(()=>{var u,d;return((d=(u=o==null?void 0:o.mergedComponentPropsRef.value)===null||u===void 0?void 0:u.Empty)===null||d===void 0?void 0:d.renderIcon)||(()=>ge(MN,null))}),l=rt(()=>{const{size:u}=n,{common:{cubicBezierEaseInOut:d},self:{[gt("iconSize",u)]:h,[gt("fontSize",u)]:m,textColor:f,iconColor:v,extraTextColor:g}}=r.value;return{"--n-icon-size":h,"--n-font-size":m,"--n-bezier":d,"--n-text-color":f,"--n-icon-color":v,"--n-extra-text-color":g}}),c=t?Qr("empty",rt(()=>{let u="";const{size:d}=n;return u+=d[0],u}),l,n):void 0;return{mergedClsPrefix:e,mergedRenderIcon:a,localizedDescription:rt(()=>s.value||i.value.description),cssVars:t?void 0:l,themeClass:c==null?void 0:c.themeClass,onRender:c==null?void 0:c.onRender}},render(){const{$slots:n,mergedClsPrefix:e,onRender:t}=this;return t==null||t(),ge("div",{class:[`${e}-empty`,this.themeClass],style:this.cssVars},this.showIcon?ge("div",{class:`${e}-empty__icon`},n.icon?n.icon():ge(Ji,{clsPrefix:e},{default:this.mergedRenderIcon})):null,this.showDescription?ge("div",{class:`${e}-empty__description`},n.default?n.default():this.localizedDescription):null,n.extra?ge("div",{class:`${e}-empty__extra`},n.extra()):null)}}),b6={railInsetHorizontal:"auto 2px 4px 2px",railInsetVertical:"2px 4px 2px auto",railColor:"transparent"};function y6(n){const{scrollbarColor:e,scrollbarColorHover:t,scrollbarHeight:r,scrollbarWidth:i,scrollbarBorderRadius:o}=n;return Object.assign(Object.assign({},b6),{height:r,width:i,borderRadius:o,color:e,colorHover:t})}const $T={name:"Scrollbar",common:ti,self:y6},{cubicBezierEaseInOut:bx}=fl;function _6({name:n="fade-in",enterDuration:e="0.2s",leaveDuration:t="0.2s",enterCubicBezier:r=bx,leaveCubicBezier:i=bx}={}){return[tt(`&.${n}-transition-enter-active`,{transition:`all ${e} ${r}!important`}),tt(`&.${n}-transition-leave-active`,{transition:`all ${t} ${i}!important`}),tt(`&.${n}-transition-enter-from, &.${n}-transition-leave-to`,{opacity:0}),tt(`&.${n}-transition-leave-from, &.${n}-transition-enter-to`,{opacity:1})]}const x6=Ke("scrollbar",`
 overflow: hidden;
 position: relative;
 z-index: auto;
 height: 100%;
 width: 100%;
`,[tt(">",[Ke("scrollbar-container",`
 width: 100%;
 overflow: scroll;
 height: 100%;
 min-height: inherit;
 max-height: inherit;
 scrollbar-width: none;
 `,[tt("&::-webkit-scrollbar, &::-webkit-scrollbar-track-piece, &::-webkit-scrollbar-thumb",`
 width: 0;
 height: 0;
 display: none;
 `),tt(">",[Ke("scrollbar-content",`
 box-sizing: border-box;
 min-width: 100%;
 `)])])]),tt(">, +",[Ke("scrollbar-rail",`
 position: absolute;
 pointer-events: none;
 user-select: none;
 background: var(--n-scrollbar-rail-color);
 -webkit-user-select: none;
 `,[pt("horizontal",`
 inset: var(--n-scrollbar-rail-inset-horizontal);
 height: var(--n-scrollbar-height);
 `,[tt(">",[Ye("scrollbar",`
 height: var(--n-scrollbar-height);
 border-radius: var(--n-scrollbar-border-radius);
 right: 0;
 `)])]),pt("vertical",`
 inset: var(--n-scrollbar-rail-inset-vertical);
 width: var(--n-scrollbar-width);
 `,[tt(">",[Ye("scrollbar",`
 width: var(--n-scrollbar-width);
 border-radius: var(--n-scrollbar-border-radius);
 bottom: 0;
 `)])]),pt("disabled",[tt(">",[Ye("scrollbar","pointer-events: none;")])]),tt(">",[Ye("scrollbar",`
 z-index: 1;
 position: absolute;
 cursor: pointer;
 pointer-events: all;
 background-color: var(--n-scrollbar-color);
 transition: background-color .2s var(--n-scrollbar-bezier);
 `,[_6(),tt("&:hover","background-color: var(--n-scrollbar-color-hover);")])])])])]),w6=Object.assign(Object.assign({},cn.props),{duration:{type:Number,default:0},scrollable:{type:Boolean,default:!0},xScrollable:Boolean,trigger:{type:String,default:"hover"},useUnifiedContainer:Boolean,triggerDisplayManually:Boolean,container:Function,content:Function,containerClass:String,containerStyle:[String,Object],contentClass:[String,Array],contentStyle:[String,Object],horizontalRailStyle:[String,Object],verticalRailStyle:[String,Object],onScroll:Function,onWheel:Function,onResize:Function,internalOnUpdateScrollLeft:Function,internalHoistYRail:Boolean}),Fb=Vt({name:"Scrollbar",props:w6,inheritAttrs:!1,setup(n){const{mergedClsPrefixRef:e,inlineThemeDisabled:t,mergedRtlRef:r}=ei(n),i=ra("Scrollbar",r,e),o=Je(null),s=Je(null),a=Je(null),l=Je(null),c=Je(null),u=Je(null),d=Je(null),h=Je(null),m=Je(null),f=Je(null),v=Je(null),g=Je(0),b=Je(0),S=Je(!1),p=Je(!1);let y=!1,w=!1,x,_,A=0,C=0,T=0,I=0;const M=wD(),P=cn("Scrollbar","-scrollbar",x6,$T,n,e),E=rt(()=>{const{value:he}=h,{value:Ae}=u,{value:Fe}=f;return he===null||Ae===null||Fe===null?0:Math.min(he,Fe*he/Ae+cd(P.value.self.width)*1.5)}),R=rt(()=>`${E.value}px`),B=rt(()=>{const{value:he}=m,{value:Ae}=d,{value:Fe}=v;return he===null||Ae===null||Fe===null?0:Fe*he/Ae+cd(P.value.self.height)*1.5}),L=rt(()=>`${B.value}px`),F=rt(()=>{const{value:he}=h,{value:Ae}=g,{value:Fe}=u,{value:ke}=f;if(he===null||Fe===null||ke===null)return 0;{const We=Fe-he;return We?Ae/We*(ke-E.value):0}}),H=rt(()=>`${F.value}px`),$=rt(()=>{const{value:he}=m,{value:Ae}=b,{value:Fe}=d,{value:ke}=v;if(he===null||Fe===null||ke===null)return 0;{const We=Fe-he;return We?Ae/We*(ke-B.value):0}}),O=rt(()=>`${$.value}px`),k=rt(()=>{const{value:he}=h,{value:Ae}=u;return he!==null&&Ae!==null&&Ae>he}),X=rt(()=>{const{value:he}=m,{value:Ae}=d;return he!==null&&Ae!==null&&Ae>he}),ie=rt(()=>{const{trigger:he}=n;return he==="none"||S.value}),ne=rt(()=>{const{trigger:he}=n;return he==="none"||p.value}),Q=rt(()=>{const{container:he}=n;return he?he():s.value}),ce=rt(()=>{const{content:he}=n;return he?he():a.value}),Z=(he,Ae)=>{if(!n.scrollable)return;if(typeof he=="number"){U(he,Ae??0,0,!1,"auto");return}const{left:Fe,top:ke,index:We,elSize:ee,position:Ie,behavior:Se,el:Ee,debounce:Ge=!0}=he;(Fe!==void 0||ke!==void 0)&&U(Fe??0,ke??0,0,!1,Se),Ee!==void 0?U(0,Ee.offsetTop,Ee.offsetHeight,Ge,Se):We!==void 0&&ee!==void 0?U(0,We*ee,ee,Ge,Se):Ie==="bottom"?U(0,Number.MAX_SAFE_INTEGER,0,!1,Se):Ie==="top"&&U(0,0,0,!1,Se)},re=pL(()=>{n.container||Z({top:g.value,left:b.value})}),se=()=>{re.isDeactivated||q()},fe=he=>{if(re.isDeactivated)return;const{onResize:Ae}=n;Ae&&Ae(he),q()},ue=(he,Ae)=>{if(!n.scrollable)return;const{value:Fe}=Q;Fe&&(typeof he=="object"?Fe.scrollBy(he):Fe.scrollBy(he,Ae||0))};function U(he,Ae,Fe,ke,We){const{value:ee}=Q;if(ee){if(ke){const{scrollTop:Ie,offsetHeight:Se}=ee;if(Ae>Ie){Ae+Fe<=Ie+Se||ee.scrollTo({left:he,top:Ae+Fe-Se,behavior:We});return}}ee.scrollTo({left:he,top:Ae,behavior:We})}}function K(){pe(),ye(),q()}function be(){me()}function me(){le(),xe()}function le(){_!==void 0&&window.clearTimeout(_),_=window.setTimeout(()=>{p.value=!1},n.duration)}function xe(){x!==void 0&&window.clearTimeout(x),x=window.setTimeout(()=>{S.value=!1},n.duration)}function pe(){x!==void 0&&window.clearTimeout(x),S.value=!0}function ye(){_!==void 0&&window.clearTimeout(_),p.value=!0}function Me(he){const{onScroll:Ae}=n;Ae&&Ae(he),Ce()}function Ce(){const{value:he}=Q;he&&(g.value=he.scrollTop,b.value=he.scrollLeft*(i!=null&&i.value?-1:1))}function z(){const{value:he}=ce;he&&(u.value=he.offsetHeight,d.value=he.offsetWidth);const{value:Ae}=Q;Ae&&(h.value=Ae.offsetHeight,m.value=Ae.offsetWidth);const{value:Fe}=c,{value:ke}=l;Fe&&(v.value=Fe.offsetWidth),ke&&(f.value=ke.offsetHeight)}function D(){const{value:he}=Q;he&&(g.value=he.scrollTop,b.value=he.scrollLeft*(i!=null&&i.value?-1:1),h.value=he.offsetHeight,m.value=he.offsetWidth,u.value=he.scrollHeight,d.value=he.scrollWidth);const{value:Ae}=c,{value:Fe}=l;Ae&&(v.value=Ae.offsetWidth),Fe&&(f.value=Fe.offsetHeight)}function q(){n.scrollable&&(n.useUnifiedContainer?D():(z(),Ce()))}function _e(he){var Ae;return!(!((Ae=o.value)===null||Ae===void 0)&&Ae.contains(ld(he)))}function ve(he){he.preventDefault(),he.stopPropagation(),w=!0,Bn("mousemove",window,Re,!0),Bn("mouseup",window,ze,!0),C=b.value,T=i!=null&&i.value?window.innerWidth-he.clientX:he.clientX}function Re(he){if(!w)return;x!==void 0&&window.clearTimeout(x),_!==void 0&&window.clearTimeout(_);const{value:Ae}=m,{value:Fe}=d,{value:ke}=B;if(Ae===null||Fe===null)return;const ee=(i!=null&&i.value?window.innerWidth-he.clientX-T:he.clientX-T)*(Fe-Ae)/(Ae-ke),Ie=Fe-Ae;let Se=C+ee;Se=Math.min(Ie,Se),Se=Math.max(Se,0);const{value:Ee}=Q;if(Ee){Ee.scrollLeft=Se*(i!=null&&i.value?-1:1);const{internalOnUpdateScrollLeft:Ge}=n;Ge&&Ge(Se)}}function ze(he){he.preventDefault(),he.stopPropagation(),Tn("mousemove",window,Re,!0),Tn("mouseup",window,ze,!0),w=!1,q(),_e(he)&&me()}function Le(he){he.preventDefault(),he.stopPropagation(),y=!0,Bn("mousemove",window,Ve,!0),Bn("mouseup",window,Ze,!0),A=g.value,I=he.clientY}function Ve(he){if(!y)return;x!==void 0&&window.clearTimeout(x),_!==void 0&&window.clearTimeout(_);const{value:Ae}=h,{value:Fe}=u,{value:ke}=E;if(Ae===null||Fe===null)return;const ee=(he.clientY-I)*(Fe-Ae)/(Ae-ke),Ie=Fe-Ae;let Se=A+ee;Se=Math.min(Ie,Se),Se=Math.max(Se,0);const{value:Ee}=Q;Ee&&(Ee.scrollTop=Se)}function Ze(he){he.preventDefault(),he.stopPropagation(),Tn("mousemove",window,Ve,!0),Tn("mouseup",window,Ze,!0),y=!1,q(),_e(he)&&me()}Ws(()=>{const{value:he}=X,{value:Ae}=k,{value:Fe}=e,{value:ke}=c,{value:We}=l;ke&&(he?ke.classList.remove(`${Fe}-scrollbar-rail--disabled`):ke.classList.add(`${Fe}-scrollbar-rail--disabled`)),We&&(Ae?We.classList.remove(`${Fe}-scrollbar-rail--disabled`):We.classList.add(`${Fe}-scrollbar-rail--disabled`))}),Er(()=>{n.container||q()}),Nr(()=>{x!==void 0&&window.clearTimeout(x),_!==void 0&&window.clearTimeout(_),Tn("mousemove",window,Ve,!0),Tn("mouseup",window,Ze,!0)});const ut=rt(()=>{const{common:{cubicBezierEaseInOut:he},self:{color:Ae,colorHover:Fe,height:ke,width:We,borderRadius:ee,railInsetHorizontal:Ie,railInsetVertical:Se,railColor:Ee}}=P.value;return{"--n-scrollbar-bezier":he,"--n-scrollbar-color":Ae,"--n-scrollbar-color-hover":Fe,"--n-scrollbar-border-radius":ee,"--n-scrollbar-width":We,"--n-scrollbar-height":ke,"--n-scrollbar-rail-inset-horizontal":Ie,"--n-scrollbar-rail-inset-vertical":i!=null&&i.value?N4(Se):Se,"--n-scrollbar-rail-color":Ee}}),Ne=t?Qr("scrollbar",void 0,ut,n):void 0;return Object.assign(Object.assign({},{scrollTo:Z,scrollBy:ue,sync:q,syncUnifiedContainer:D,handleMouseEnterWrapper:K,handleMouseLeaveWrapper:be}),{mergedClsPrefix:e,rtlEnabled:i,containerScrollTop:g,wrapperRef:o,containerRef:s,contentRef:a,yRailRef:l,xRailRef:c,needYBar:k,needXBar:X,yBarSizePx:R,xBarSizePx:L,yBarTopPx:H,xBarLeftPx:O,isShowXBar:ie,isShowYBar:ne,isIos:M,handleScroll:Me,handleContentResize:se,handleContainerResize:fe,handleYScrollMouseDown:Le,handleXScrollMouseDown:ve,cssVars:t?void 0:ut,themeClass:Ne==null?void 0:Ne.themeClass,onRender:Ne==null?void 0:Ne.onRender})},render(){var n;const{$slots:e,mergedClsPrefix:t,triggerDisplayManually:r,rtlEnabled:i,internalHoistYRail:o}=this;if(!this.scrollable)return(n=e.default)===null||n===void 0?void 0:n.call(e);const s=this.trigger==="none",a=(u,d)=>ge("div",{ref:"yRailRef",class:[`${t}-scrollbar-rail`,`${t}-scrollbar-rail--vertical`,u],"data-scrollbar-rail":!0,style:[d||"",this.verticalRailStyle],"aria-hidden":!0},ge(s?T1:Mo,s?null:{name:"fade-in-transition"},{default:()=>this.needYBar&&this.isShowYBar&&!this.isIos?ge("div",{class:`${t}-scrollbar-rail__scrollbar`,style:{height:this.yBarSizePx,top:this.yBarTopPx},onMousedown:this.handleYScrollMouseDown}):null})),l=()=>{var u,d;return(u=this.onRender)===null||u===void 0||u.call(this),ge("div",Dc(this.$attrs,{role:"none",ref:"wrapperRef",class:[`${t}-scrollbar`,this.themeClass,i&&`${t}-scrollbar--rtl`],style:this.cssVars,onMouseenter:r?void 0:this.handleMouseEnterWrapper,onMouseleave:r?void 0:this.handleMouseLeaveWrapper}),[this.container?(d=e.default)===null||d===void 0?void 0:d.call(e):ge("div",{role:"none",ref:"containerRef",class:[`${t}-scrollbar-container`,this.containerClass],style:this.containerStyle,onScroll:this.handleScroll,onWheel:this.onWheel},ge(dd,{onResize:this.handleContentResize},{default:()=>ge("div",{ref:"contentRef",role:"none",style:[{width:this.xScrollable?"fit-content":null},this.contentStyle],class:[`${t}-scrollbar-content`,this.contentClass]},e)})),o?null:a(void 0,void 0),this.xScrollable&&ge("div",{ref:"xRailRef",class:[`${t}-scrollbar-rail`,`${t}-scrollbar-rail--horizontal`],style:this.horizontalRailStyle,"data-scrollbar-rail":!0,"aria-hidden":!0},ge(s?T1:Mo,s?null:{name:"fade-in-transition"},{default:()=>this.needXBar&&this.isShowXBar&&!this.isIos?ge("div",{class:`${t}-scrollbar-rail__scrollbar`,style:{width:this.xBarSizePx,right:i?this.xBarLeftPx:void 0,left:i?void 0:this.xBarLeftPx},onMousedown:this.handleXScrollMouseDown}):null}))])},c=this.container?l():ge(dd,{onResize:this.handleContainerResize},{default:l});return o?ge($n,null,c,a(this.themeClass,this.cssVars)):c}}),S6=Fb,C6={height:"calc(var(--n-option-height) * 7.6)",paddingSmall:"4px 0",paddingMedium:"4px 0",paddingLarge:"4px 0",paddingHuge:"4px 0",optionPaddingSmall:"0 12px",optionPaddingMedium:"0 12px",optionPaddingLarge:"0 12px",optionPaddingHuge:"0 12px",loadingSize:"18px"};function A6(n){const{borderRadius:e,popoverColor:t,textColor3:r,dividerColor:i,textColor2:o,primaryColorPressed:s,textColorDisabled:a,primaryColor:l,opacityDisabled:c,hoverColor:u,fontSizeSmall:d,fontSizeMedium:h,fontSizeLarge:m,fontSizeHuge:f,heightSmall:v,heightMedium:g,heightLarge:b,heightHuge:S}=n;return Object.assign(Object.assign({},C6),{optionFontSizeSmall:d,optionFontSizeMedium:h,optionFontSizeLarge:m,optionFontSizeHuge:f,optionHeightSmall:v,optionHeightMedium:g,optionHeightLarge:b,optionHeightHuge:S,borderRadius:e,color:t,groupHeaderTextColor:r,actionDividerColor:i,optionTextColor:o,optionTextColorPressed:s,optionTextColorDisabled:a,optionTextColorActive:l,optionOpacityDisabled:c,optionCheckColor:l,optionColorPending:u,optionColorActive:"rgba(0, 0, 0, 0)",optionColorActivePending:u,actionTextColor:o,loadingColor:l})}const HT={name:"InternalSelectMenu",common:ti,peers:{Scrollbar:$T,Empty:UT},self:A6};function M6(n,e){return ge(Mo,{name:"fade-in-scale-up-transition"},{default:()=>n?ge(Ji,{clsPrefix:e,class:`${e}-base-select-option__check`},{default:()=>ge(SN)}):null})}const yx=Vt({name:"NBaseSelectOption",props:{clsPrefix:{type:String,required:!0},tmNode:{type:Object,required:!0}},setup(n){const{valueRef:e,pendingTmNodeRef:t,multipleRef:r,valueSetRef:i,renderLabelRef:o,renderOptionRef:s,labelFieldRef:a,valueFieldRef:l,showCheckmarkRef:c,nodePropsRef:u,handleOptionClick:d,handleOptionMouseEnter:h}=vn(fb),m=er(()=>{const{value:b}=t;return b?n.tmNode.key===b.key:!1});function f(b){const{tmNode:S}=n;S.disabled||d(b,S)}function v(b){const{tmNode:S}=n;S.disabled||h(b,S)}function g(b){const{tmNode:S}=n,{value:p}=m;S.disabled||p||h(b,S)}return{multiple:r,isGrouped:er(()=>{const{tmNode:b}=n,{parent:S}=b;return S&&S.rawNode.type==="group"}),showCheckmark:c,nodeProps:u,isPending:m,isSelected:er(()=>{const{value:b}=e,{value:S}=r;if(b===null)return!1;const p=n.tmNode.rawNode[l.value];if(S){const{value:y}=i;return y.has(p)}else return b===p}),labelField:a,renderLabel:o,renderOption:s,handleMouseMove:g,handleMouseEnter:v,handleClick:f}},render(){const{clsPrefix:n,tmNode:{rawNode:e},isSelected:t,isPending:r,isGrouped:i,showCheckmark:o,nodeProps:s,renderOption:a,renderLabel:l,handleClick:c,handleMouseEnter:u,handleMouseMove:d}=this,h=M6(t,n),m=l?[l(e,t),o&&h]:[Jl(e[this.labelField],e,t),o&&h],f=s==null?void 0:s(e),v=ge("div",Object.assign({},f,{class:[`${n}-base-select-option`,e.class,f==null?void 0:f.class,{[`${n}-base-select-option--disabled`]:e.disabled,[`${n}-base-select-option--selected`]:t,[`${n}-base-select-option--grouped`]:i,[`${n}-base-select-option--pending`]:r,[`${n}-base-select-option--show-checkmark`]:o}],style:[(f==null?void 0:f.style)||"",e.style||""],onClick:Ym([c,f==null?void 0:f.onClick]),onMouseenter:Ym([u,f==null?void 0:f.onMouseenter]),onMousemove:Ym([d,f==null?void 0:f.onMousemove])}),ge("div",{class:`${n}-base-select-option__content`},m));return e.render?e.render({node:v,option:e,selected:t}):a?a({node:v,option:e,selected:t}):v}}),_x=Vt({name:"NBaseSelectGroupHeader",props:{clsPrefix:{type:String,required:!0},tmNode:{type:Object,required:!0}},setup(){const{renderLabelRef:n,renderOptionRef:e,labelFieldRef:t,nodePropsRef:r}=vn(fb);return{labelField:t,nodeProps:r,renderLabel:n,renderOption:e}},render(){const{clsPrefix:n,renderLabel:e,renderOption:t,nodeProps:r,tmNode:{rawNode:i}}=this,o=r==null?void 0:r(i),s=e?e(i,!1):Jl(i[this.labelField],i,!1),a=ge("div",Object.assign({},o,{class:[`${n}-base-select-group-header`,o==null?void 0:o.class]}),s);return i.render?i.render({node:a,option:i}):t?t({node:a,option:i,selected:!1}):a}}),{cubicBezierEaseIn:xx,cubicBezierEaseOut:wx}=fl;function sp({transformOrigin:n="inherit",duration:e=".2s",enterScale:t=".9",originalTransform:r="",originalTransition:i=""}={}){return[tt("&.fade-in-scale-up-transition-leave-active",{transformOrigin:n,transition:`opacity ${e} ${xx}, transform ${e} ${xx} ${i&&`,${i}`}`}),tt("&.fade-in-scale-up-transition-enter-active",{transformOrigin:n,transition:`opacity ${e} ${wx}, transform ${e} ${wx} ${i&&`,${i}`}`}),tt("&.fade-in-scale-up-transition-enter-from, &.fade-in-scale-up-transition-leave-to",{opacity:0,transform:`${r} scale(${t})`}),tt("&.fade-in-scale-up-transition-leave-from, &.fade-in-scale-up-transition-enter-to",{opacity:1,transform:`${r} scale(1)`})]}const T6=Ke("base-select-menu",`
 line-height: 1.5;
 outline: none;
 z-index: 0;
 position: relative;
 border-radius: var(--n-border-radius);
 transition:
 background-color .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier);
 background-color: var(--n-color);
`,[Ke("scrollbar",`
 max-height: var(--n-height);
 `),Ke("virtual-list",`
 max-height: var(--n-height);
 `),Ke("base-select-option",`
 min-height: var(--n-option-height);
 font-size: var(--n-option-font-size);
 display: flex;
 align-items: center;
 `,[Ye("content",`
 z-index: 1;
 white-space: nowrap;
 text-overflow: ellipsis;
 overflow: hidden;
 `)]),Ke("base-select-group-header",`
 min-height: var(--n-option-height);
 font-size: .93em;
 display: flex;
 align-items: center;
 `),Ke("base-select-menu-option-wrapper",`
 position: relative;
 width: 100%;
 `),Ye("loading, empty",`
 display: flex;
 padding: 12px 32px;
 flex: 1;
 justify-content: center;
 `),Ye("loading",`
 color: var(--n-loading-color);
 font-size: var(--n-loading-size);
 `),Ye("header",`
 padding: 8px var(--n-option-padding-left);
 font-size: var(--n-option-font-size);
 transition: 
 color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 border-bottom: 1px solid var(--n-action-divider-color);
 color: var(--n-action-text-color);
 `),Ye("action",`
 padding: 8px var(--n-option-padding-left);
 font-size: var(--n-option-font-size);
 transition: 
 color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 border-top: 1px solid var(--n-action-divider-color);
 color: var(--n-action-text-color);
 `),Ke("base-select-group-header",`
 position: relative;
 cursor: default;
 padding: var(--n-option-padding);
 color: var(--n-group-header-text-color);
 `),Ke("base-select-option",`
 cursor: pointer;
 position: relative;
 padding: var(--n-option-padding);
 transition:
 color .3s var(--n-bezier),
 opacity .3s var(--n-bezier);
 box-sizing: border-box;
 color: var(--n-option-text-color);
 opacity: 1;
 `,[pt("show-checkmark",`
 padding-right: calc(var(--n-option-padding-right) + 20px);
 `),tt("&::before",`
 content: "";
 position: absolute;
 left: 4px;
 right: 4px;
 top: 0;
 bottom: 0;
 border-radius: var(--n-border-radius);
 transition: background-color .3s var(--n-bezier);
 `),tt("&:active",`
 color: var(--n-option-text-color-pressed);
 `),pt("grouped",`
 padding-left: calc(var(--n-option-padding-left) * 1.5);
 `),pt("pending",[tt("&::before",`
 background-color: var(--n-option-color-pending);
 `)]),pt("selected",`
 color: var(--n-option-text-color-active);
 `,[tt("&::before",`
 background-color: var(--n-option-color-active);
 `),pt("pending",[tt("&::before",`
 background-color: var(--n-option-color-active-pending);
 `)])]),pt("disabled",`
 cursor: not-allowed;
 `,[ar("selected",`
 color: var(--n-option-text-color-disabled);
 `),pt("selected",`
 opacity: var(--n-option-opacity-disabled);
 `)]),Ye("check",`
 font-size: 16px;
 position: absolute;
 right: calc(var(--n-option-padding-right) - 4px);
 top: calc(50% - 7px);
 color: var(--n-option-check-color);
 transition: color .3s var(--n-bezier);
 `,[sp({enterScale:"0.5"})])])]),E6=Vt({name:"InternalSelectMenu",props:Object.assign(Object.assign({},cn.props),{clsPrefix:{type:String,required:!0},scrollable:{type:Boolean,default:!0},treeMate:{type:Object,required:!0},multiple:Boolean,size:{type:String,default:"medium"},value:{type:[String,Number,Array],default:null},autoPending:Boolean,virtualScroll:{type:Boolean,default:!0},show:{type:Boolean,default:!0},labelField:{type:String,default:"label"},valueField:{type:String,default:"value"},loading:Boolean,focusable:Boolean,renderLabel:Function,renderOption:Function,nodeProps:Function,showCheckmark:{type:Boolean,default:!0},onMousedown:Function,onScroll:Function,onFocus:Function,onBlur:Function,onKeyup:Function,onKeydown:Function,onTabOut:Function,onMouseenter:Function,onMouseleave:Function,onResize:Function,resetMenuOnOptionsChange:{type:Boolean,default:!0},inlineThemeDisabled:Boolean,onToggle:Function}),setup(n){const{mergedClsPrefixRef:e,mergedRtlRef:t}=ei(n),r=ra("InternalSelectMenu",t,e),i=cn("InternalSelectMenu","-internal-select-menu",T6,HT,n,Jt(n,"clsPrefix")),o=Je(null),s=Je(null),a=Je(null),l=rt(()=>n.treeMate.getFlattenedNodes()),c=rt(()=>ZN(l.value)),u=Je(null);function d(){const{treeMate:k}=n;let X=null;const{value:ie}=n;ie===null?X=k.getFirstAvailableNode():(n.multiple?X=k.getNode((ie||[])[(ie||[]).length-1]):X=k.getNode(ie),(!X||X.disabled)&&(X=k.getFirstAvailableNode())),E(X||null)}function h(){const{value:k}=u;k&&!n.treeMate.getNode(k.key)&&(u.value=null)}let m;bn(()=>n.show,k=>{k?m=bn(()=>n.treeMate,()=>{n.resetMenuOnOptionsChange?(n.autoPending?d():h(),ui(R)):h()},{immediate:!0}):m==null||m()},{immediate:!0}),Nr(()=>{m==null||m()});const f=rt(()=>cd(i.value.self[gt("optionHeight",n.size)])),v=rt(()=>Zo(i.value.self[gt("padding",n.size)])),g=rt(()=>n.multiple&&Array.isArray(n.value)?new Set(n.value):new Set),b=rt(()=>{const k=l.value;return k&&k.length===0});function S(k){const{onToggle:X}=n;X&&X(k)}function p(k){const{onScroll:X}=n;X&&X(k)}function y(k){var X;(X=a.value)===null||X===void 0||X.sync(),p(k)}function w(){var k;(k=a.value)===null||k===void 0||k.sync()}function x(){const{value:k}=u;return k||null}function _(k,X){X.disabled||E(X,!1)}function A(k,X){X.disabled||S(X)}function C(k){var X;Uu(k,"action")||(X=n.onKeyup)===null||X===void 0||X.call(n,k)}function T(k){var X;Uu(k,"action")||(X=n.onKeydown)===null||X===void 0||X.call(n,k)}function I(k){var X;(X=n.onMousedown)===null||X===void 0||X.call(n,k),!n.focusable&&k.preventDefault()}function M(){const{value:k}=u;k&&E(k.getNext({loop:!0}),!0)}function P(){const{value:k}=u;k&&E(k.getPrev({loop:!0}),!0)}function E(k,X=!1){u.value=k,X&&R()}function R(){var k,X;const ie=u.value;if(!ie)return;const ne=c.value(ie.key);ne!==null&&(n.virtualScroll?(k=s.value)===null||k===void 0||k.scrollTo({index:ne}):(X=a.value)===null||X===void 0||X.scrollTo({index:ne,elSize:f.value}))}function B(k){var X,ie;!((X=o.value)===null||X===void 0)&&X.contains(k.target)&&((ie=n.onFocus)===null||ie===void 0||ie.call(n,k))}function L(k){var X,ie;!((X=o.value)===null||X===void 0)&&X.contains(k.relatedTarget)||(ie=n.onBlur)===null||ie===void 0||ie.call(n,k)}Xi(fb,{handleOptionMouseEnter:_,handleOptionClick:A,valueSetRef:g,pendingTmNodeRef:u,nodePropsRef:Jt(n,"nodeProps"),showCheckmarkRef:Jt(n,"showCheckmark"),multipleRef:Jt(n,"multiple"),valueRef:Jt(n,"value"),renderLabelRef:Jt(n,"renderLabel"),renderOptionRef:Jt(n,"renderOption"),labelFieldRef:Jt(n,"labelField"),valueFieldRef:Jt(n,"valueField")}),Xi(zM,o),Er(()=>{const{value:k}=a;k&&k.sync()});const F=rt(()=>{const{size:k}=n,{common:{cubicBezierEaseInOut:X},self:{height:ie,borderRadius:ne,color:Q,groupHeaderTextColor:ce,actionDividerColor:Z,optionTextColorPressed:re,optionTextColor:se,optionTextColorDisabled:fe,optionTextColorActive:ue,optionOpacityDisabled:U,optionCheckColor:K,actionTextColor:be,optionColorPending:me,optionColorActive:le,loadingColor:xe,loadingSize:pe,optionColorActivePending:ye,[gt("optionFontSize",k)]:Me,[gt("optionHeight",k)]:Ce,[gt("optionPadding",k)]:z}}=i.value;return{"--n-height":ie,"--n-action-divider-color":Z,"--n-action-text-color":be,"--n-bezier":X,"--n-border-radius":ne,"--n-color":Q,"--n-option-font-size":Me,"--n-group-header-text-color":ce,"--n-option-check-color":K,"--n-option-color-pending":me,"--n-option-color-active":le,"--n-option-color-active-pending":ye,"--n-option-height":Ce,"--n-option-opacity-disabled":U,"--n-option-text-color":se,"--n-option-text-color-active":ue,"--n-option-text-color-disabled":fe,"--n-option-text-color-pressed":re,"--n-option-padding":z,"--n-option-padding-left":Zo(z,"left"),"--n-option-padding-right":Zo(z,"right"),"--n-loading-color":xe,"--n-loading-size":pe}}),{inlineThemeDisabled:H}=n,$=H?Qr("internal-select-menu",rt(()=>n.size[0]),F,n):void 0,O={selfRef:o,next:M,prev:P,getPendingTmNode:x};return iT(o,n.onResize),Object.assign({mergedTheme:i,mergedClsPrefix:e,rtlEnabled:r,virtualListRef:s,scrollbarRef:a,itemSize:f,padding:v,flattenedNodes:l,empty:b,virtualListContainer(){const{value:k}=s;return k==null?void 0:k.listElRef},virtualListContent(){const{value:k}=s;return k==null?void 0:k.itemsElRef},doScroll:p,handleFocusin:B,handleFocusout:L,handleKeyUp:C,handleKeyDown:T,handleMouseDown:I,handleVirtualListResize:w,handleVirtualListScroll:y,cssVars:H?void 0:F,themeClass:$==null?void 0:$.themeClass,onRender:$==null?void 0:$.onRender},O)},render(){const{$slots:n,virtualScroll:e,clsPrefix:t,mergedTheme:r,themeClass:i,onRender:o}=this;return o==null||o(),ge("div",{ref:"selfRef",tabindex:this.focusable?0:-1,class:[`${t}-base-select-menu`,this.rtlEnabled&&`${t}-base-select-menu--rtl`,i,this.multiple&&`${t}-base-select-menu--multiple`],style:this.cssVars,onFocusin:this.handleFocusin,onFocusout:this.handleFocusout,onKeyup:this.handleKeyUp,onKeydown:this.handleKeyDown,onMousedown:this.handleMouseDown,onMouseenter:this.onMouseenter,onMouseleave:this.onMouseleave},vr(n.header,s=>s&&ge("div",{class:`${t}-base-select-menu__header`,"data-header":!0,key:"header"},s)),this.loading?ge("div",{class:`${t}-base-select-menu__loading`},ge(Db,{clsPrefix:t,strokeWidth:20})):this.empty?ge("div",{class:`${t}-base-select-menu__empty`,"data-empty":!0},Ki(n.empty,()=>[ge(v6,{theme:r.peers.Empty,themeOverrides:r.peerOverrides.Empty})])):ge(Fb,{ref:"scrollbarRef",theme:r.peers.Scrollbar,themeOverrides:r.peerOverrides.Scrollbar,scrollable:this.scrollable,container:e?this.virtualListContainer:void 0,content:e?this.virtualListContent:void 0,onScroll:e?void 0:this.doScroll},{default:()=>e?ge(uL,{ref:"virtualListRef",class:`${t}-virtual-list`,items:this.flattenedNodes,itemSize:this.itemSize,showScrollbar:!1,paddingTop:this.padding.top,paddingBottom:this.padding.bottom,onResize:this.handleVirtualListResize,onScroll:this.handleVirtualListScroll,itemResizable:!0},{default:({item:s})=>s.isGroup?ge(_x,{key:s.key,clsPrefix:t,tmNode:s}):s.ignored?null:ge(yx,{clsPrefix:t,key:s.key,tmNode:s})}):ge("div",{class:`${t}-base-select-menu-option-wrapper`,style:{paddingTop:this.padding.top,paddingBottom:this.padding.bottom}},this.flattenedNodes.map(s=>s.isGroup?ge(_x,{key:s.key,clsPrefix:t,tmNode:s}):ge(yx,{clsPrefix:t,key:s.key,tmNode:s})))}),vr(n.action,s=>s&&[ge("div",{class:`${t}-base-select-menu__action`,"data-action":!0,key:"action"},s),ge(kN,{onFocus:this.onTabOut,key:"focus-detector"})]))}}),P6=Ke("base-wave",`
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 border-radius: inherit;
`),R6=Vt({name:"BaseWave",props:{clsPrefix:{type:String,required:!0}},setup(n){Nc("-base-wave",P6,Jt(n,"clsPrefix"));const e=Je(null),t=Je(!1);let r=null;return Nr(()=>{r!==null&&window.clearTimeout(r)}),{active:t,selfRef:e,play(){r!==null&&(window.clearTimeout(r),t.value=!1,r=null),ui(()=>{var i;(i=e.value)===null||i===void 0||i.offsetHeight,t.value=!0,r=window.setTimeout(()=>{t.value=!1,r=null},1e3)})}}},render(){const{clsPrefix:n}=this;return ge("div",{ref:"selfRef","aria-hidden":!0,class:[`${n}-base-wave`,this.active&&`${n}-base-wave--active`]})}}),I6={space:"6px",spaceArrow:"10px",arrowOffset:"10px",arrowOffsetVertical:"10px",arrowHeight:"6px",padding:"8px 14px"};function D6(n){const{boxShadow2:e,popoverColor:t,textColor2:r,borderRadius:i,fontSize:o,dividerColor:s}=n;return Object.assign(Object.assign({},I6),{fontSize:o,borderRadius:i,color:t,dividerColor:s,textColor:r,boxShadow:e})}const VT={name:"Popover",common:ti,self:D6},dg={top:"bottom",bottom:"top",left:"right",right:"left"},Jn="var(--n-arrow-height) * 1.414",L6=tt([Ke("popover",`
 transition:
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
 position: relative;
 font-size: var(--n-font-size);
 color: var(--n-text-color);
 box-shadow: var(--n-box-shadow);
 word-break: break-word;
 `,[tt(">",[Ke("scrollbar",`
 height: inherit;
 max-height: inherit;
 `)]),ar("raw",`
 background-color: var(--n-color);
 border-radius: var(--n-border-radius);
 `,[ar("scrollable",[ar("show-header-or-footer","padding: var(--n-padding);")])]),Ye("header",`
 padding: var(--n-padding);
 border-bottom: 1px solid var(--n-divider-color);
 transition: border-color .3s var(--n-bezier);
 `),Ye("footer",`
 padding: var(--n-padding);
 border-top: 1px solid var(--n-divider-color);
 transition: border-color .3s var(--n-bezier);
 `),pt("scrollable, show-header-or-footer",[Ye("content",`
 padding: var(--n-padding);
 `)])]),Ke("popover-shared",`
 transform-origin: inherit;
 `,[Ke("popover-arrow-wrapper",`
 position: absolute;
 overflow: hidden;
 pointer-events: none;
 `,[Ke("popover-arrow",`
 transition: background-color .3s var(--n-bezier);
 position: absolute;
 display: block;
 width: calc(${Jn});
 height: calc(${Jn});
 box-shadow: 0 0 8px 0 rgba(0, 0, 0, .12);
 transform: rotate(45deg);
 background-color: var(--n-color);
 pointer-events: all;
 `)]),tt("&.popover-transition-enter-from, &.popover-transition-leave-to",`
 opacity: 0;
 transform: scale(.85);
 `),tt("&.popover-transition-enter-to, &.popover-transition-leave-from",`
 transform: scale(1);
 opacity: 1;
 `),tt("&.popover-transition-enter-active",`
 transition:
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier),
 opacity .15s var(--n-bezier-ease-out),
 transform .15s var(--n-bezier-ease-out);
 `),tt("&.popover-transition-leave-active",`
 transition:
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier),
 opacity .15s var(--n-bezier-ease-in),
 transform .15s var(--n-bezier-ease-in);
 `)]),gi("top-start",`
 top: calc(${Jn} / -2);
 left: calc(${Do("top-start")} - var(--v-offset-left));
 `),gi("top",`
 top: calc(${Jn} / -2);
 transform: translateX(calc(${Jn} / -2)) rotate(45deg);
 left: 50%;
 `),gi("top-end",`
 top: calc(${Jn} / -2);
 right: calc(${Do("top-end")} + var(--v-offset-left));
 `),gi("bottom-start",`
 bottom: calc(${Jn} / -2);
 left: calc(${Do("bottom-start")} - var(--v-offset-left));
 `),gi("bottom",`
 bottom: calc(${Jn} / -2);
 transform: translateX(calc(${Jn} / -2)) rotate(45deg);
 left: 50%;
 `),gi("bottom-end",`
 bottom: calc(${Jn} / -2);
 right: calc(${Do("bottom-end")} + var(--v-offset-left));
 `),gi("left-start",`
 left: calc(${Jn} / -2);
 top: calc(${Do("left-start")} - var(--v-offset-top));
 `),gi("left",`
 left: calc(${Jn} / -2);
 transform: translateY(calc(${Jn} / -2)) rotate(45deg);
 top: 50%;
 `),gi("left-end",`
 left: calc(${Jn} / -2);
 bottom: calc(${Do("left-end")} + var(--v-offset-top));
 `),gi("right-start",`
 right: calc(${Jn} / -2);
 top: calc(${Do("right-start")} - var(--v-offset-top));
 `),gi("right",`
 right: calc(${Jn} / -2);
 transform: translateY(calc(${Jn} / -2)) rotate(45deg);
 top: 50%;
 `),gi("right-end",`
 right: calc(${Jn} / -2);
 bottom: calc(${Do("right-end")} + var(--v-offset-top));
 `),...kB({top:["right-start","left-start"],right:["top-end","bottom-end"],bottom:["right-end","left-end"],left:["top-start","bottom-start"]},(n,e)=>{const t=["right","left"].includes(e),r=t?"width":"height";return n.map(i=>{const o=i.split("-")[1]==="end",a=`calc((${`var(--v-target-${r}, 0px)`} - ${Jn}) / 2)`,l=Do(i);return tt(`[v-placement="${i}"] >`,[Ke("popover-shared",[pt("center-arrow",[Ke("popover-arrow",`${e}: calc(max(${a}, ${l}) ${o?"+":"-"} var(--v-offset-${t?"left":"top"}));`)])])])})})]);function Do(n){return["top","bottom"].includes(n.split("-")[0])?"var(--n-arrow-offset)":"var(--n-arrow-offset-vertical)"}function gi(n,e){const t=n.split("-")[0],r=["top","bottom"].includes(t)?"height: var(--n-space-arrow);":"width: var(--n-space-arrow);";return tt(`[v-placement="${n}"] >`,[Ke("popover-shared",`
 margin-${dg[t]}: var(--n-space);
 `,[pt("show-arrow",`
 margin-${dg[t]}: var(--n-space-arrow);
 `),pt("overlap",`
 margin: 0;
 `),lD("popover-arrow-wrapper",`
 right: 0;
 left: 0;
 top: 0;
 bottom: 0;
 ${t}: 100%;
 ${dg[t]}: auto;
 ${r}
 `,[Ke("popover-arrow",e)])])])}const GT=Object.assign(Object.assign({},cn.props),{to:Ti.propTo,show:Boolean,trigger:String,showArrow:Boolean,delay:Number,duration:Number,raw:Boolean,arrowPointToCenter:Boolean,arrowClass:String,arrowStyle:[String,Object],arrowWrapperClass:String,arrowWrapperStyle:[String,Object],displayDirective:String,x:Number,y:Number,flip:Boolean,overlap:Boolean,placement:String,width:[Number,String],keepAliveOnHover:Boolean,scrollable:Boolean,contentClass:String,contentStyle:[Object,String],headerClass:String,headerStyle:[Object,String],footerClass:String,footerStyle:[Object,String],internalDeactivateImmediately:Boolean,animated:Boolean,onClickoutside:Function,internalTrapFocus:Boolean,internalOnAfterLeave:Function,minWidth:Number,maxWidth:Number});function F6({arrowClass:n,arrowStyle:e,arrowWrapperClass:t,arrowWrapperStyle:r,clsPrefix:i}){return ge("div",{key:"__popover-arrow__",style:r,class:[`${i}-popover-arrow-wrapper`,t]},ge("div",{class:[`${i}-popover-arrow`,n],style:e}))}const O6=Vt({name:"PopoverBody",inheritAttrs:!1,props:GT,setup(n,{slots:e,attrs:t}){const{namespaceRef:r,mergedClsPrefixRef:i,inlineThemeDisabled:o}=ei(n),s=cn("Popover","-popover",L6,VT,n,i),a=Je(null),l=vn("NPopover"),c=Je(null),u=Je(n.show),d=Je(!1);Ws(()=>{const{show:_}=n;_&&!cD()&&!n.internalDeactivateImmediately&&(d.value=!0)});const h=rt(()=>{const{trigger:_,onClickoutside:A}=n,C=[],{positionManuallyRef:{value:T}}=l;return T||(_==="click"&&!A&&C.push([Zf,y,void 0,{capture:!0}]),_==="hover"&&C.push([jM,p])),A&&C.push([Zf,y,void 0,{capture:!0}]),(n.displayDirective==="show"||n.animated&&d.value)&&C.push([tM,n.show]),C}),m=rt(()=>{const{common:{cubicBezierEaseInOut:_,cubicBezierEaseIn:A,cubicBezierEaseOut:C},self:{space:T,spaceArrow:I,padding:M,fontSize:P,textColor:E,dividerColor:R,color:B,boxShadow:L,borderRadius:F,arrowHeight:H,arrowOffset:$,arrowOffsetVertical:O}}=s.value;return{"--n-box-shadow":L,"--n-bezier":_,"--n-bezier-ease-in":A,"--n-bezier-ease-out":C,"--n-font-size":P,"--n-text-color":E,"--n-color":B,"--n-divider-color":R,"--n-border-radius":F,"--n-arrow-height":H,"--n-arrow-offset":$,"--n-arrow-offset-vertical":O,"--n-padding":M,"--n-space":T,"--n-space-arrow":I}}),f=rt(()=>{const _=n.width==="trigger"?void 0:fo(n.width),A=[];_&&A.push({width:_});const{maxWidth:C,minWidth:T}=n;return C&&A.push({maxWidth:fo(C)}),T&&A.push({maxWidth:fo(T)}),o||A.push(m.value),A}),v=o?Qr("popover",void 0,m,n):void 0;l.setBodyInstance({syncPosition:g}),Nr(()=>{l.setBodyInstance(null)}),bn(Jt(n,"show"),_=>{n.animated||(_?u.value=!0:u.value=!1)});function g(){var _;(_=a.value)===null||_===void 0||_.syncPosition()}function b(_){n.trigger==="hover"&&n.keepAliveOnHover&&n.show&&l.handleMouseEnter(_)}function S(_){n.trigger==="hover"&&n.keepAliveOnHover&&l.handleMouseLeave(_)}function p(_){n.trigger==="hover"&&!w().contains(ld(_))&&l.handleMouseMoveOutside(_)}function y(_){(n.trigger==="click"&&!w().contains(ld(_))||n.onClickoutside)&&l.handleClickOutside(_)}function w(){return l.getTriggerElement()}Xi(HM,c),Xi($M,null),Xi(UM,null);function x(){if(v==null||v.onRender(),!(n.displayDirective==="show"||n.show||n.animated&&d.value))return null;let A;const C=l.internalRenderBodyRef.value,{value:T}=i;if(C)A=C([`${T}-popover-shared`,v==null?void 0:v.themeClass.value,n.overlap&&`${T}-popover-shared--overlap`,n.showArrow&&`${T}-popover-shared--show-arrow`,n.arrowPointToCenter&&`${T}-popover-shared--center-arrow`],c,f.value,b,S);else{const{value:I}=l.extraClassRef,{internalTrapFocus:M}=n,P=!M1(e.header)||!M1(e.footer),E=()=>{var R,B;const L=P?ge($n,null,vr(e.header,$=>$?ge("div",{class:[`${T}-popover__header`,n.headerClass],style:n.headerStyle},$):null),vr(e.default,$=>$?ge("div",{class:[`${T}-popover__content`,n.contentClass],style:n.contentStyle},e):null),vr(e.footer,$=>$?ge("div",{class:[`${T}-popover__footer`,n.footerClass],style:n.footerStyle},$):null)):n.scrollable?(R=e.default)===null||R===void 0?void 0:R.call(e):ge("div",{class:[`${T}-popover__content`,n.contentClass],style:n.contentStyle},e),F=n.scrollable?ge(S6,{contentClass:P?void 0:`${T}-popover__content ${(B=n.contentClass)!==null&&B!==void 0?B:""}`,contentStyle:P?void 0:n.contentStyle},{default:()=>L}):L,H=n.showArrow?F6({arrowClass:n.arrowClass,arrowStyle:n.arrowStyle,arrowWrapperClass:n.arrowWrapperClass,arrowWrapperStyle:n.arrowWrapperStyle,clsPrefix:T}):null;return[F,H]};A=ge("div",Dc({class:[`${T}-popover`,`${T}-popover-shared`,v==null?void 0:v.themeClass.value,I.map(R=>`${T}-${R}`),{[`${T}-popover--scrollable`]:n.scrollable,[`${T}-popover--show-header-or-footer`]:P,[`${T}-popover--raw`]:n.raw,[`${T}-popover-shared--overlap`]:n.overlap,[`${T}-popover-shared--show-arrow`]:n.showArrow,[`${T}-popover-shared--center-arrow`]:n.arrowPointToCenter}],ref:c,style:f.value,onKeydown:l.handleKeydown,onMouseenter:b,onMouseleave:S},t),M?ge(fL,{active:n.show,autoFocus:!0},{default:E}):E())}return Ic(A,h.value)}return{displayed:d,namespace:r,isMounted:l.isMountedRef,zIndex:l.zIndexRef,followerRef:a,adjustedTo:Ti(n),followerEnabled:u,renderContentNode:x}},render(){return ge(vb,{ref:"followerRef",zIndex:this.zIndex,show:this.show,enabled:this.followerEnabled,to:this.adjustedTo,x:this.x,y:this.y,flip:this.flip,placement:this.placement,containerClass:this.namespace,overlap:this.overlap,width:this.width==="trigger"?"target":void 0,teleportDisabled:this.adjustedTo===Ti.tdkey},{default:()=>this.animated?ge(Mo,{name:"popover-transition",appear:this.isMounted,onEnter:()=>{this.followerEnabled=!0},onAfterLeave:()=>{var n;(n=this.internalOnAfterLeave)===null||n===void 0||n.call(this),this.followerEnabled=!1,this.displayed=!1}},{default:this.renderContentNode}):this.renderContentNode()})}}),k6=Object.keys(GT),B6={focus:["onFocus","onBlur"],click:["onClick"],hover:["onMouseenter","onMouseleave"],manual:[],nested:["onFocus","onBlur","onMouseenter","onMouseleave","onClick"]};function N6(n,e,t){B6[e].forEach(r=>{n.props?n.props=Object.assign({},n.props):n.props={};const i=n.props[r],o=t[r];i?n.props[r]=(...s)=>{i(...s),o(...s)}:n.props[r]=o})}const z6={show:{type:Boolean,default:void 0},defaultShow:Boolean,showArrow:{type:Boolean,default:!0},trigger:{type:String,default:"hover"},delay:{type:Number,default:100},duration:{type:Number,default:100},raw:Boolean,placement:{type:String,default:"top"},x:Number,y:Number,arrowPointToCenter:Boolean,disabled:Boolean,getDisabled:Function,displayDirective:{type:String,default:"if"},arrowClass:String,arrowStyle:[String,Object],arrowWrapperClass:String,arrowWrapperStyle:[String,Object],flip:{type:Boolean,default:!0},animated:{type:Boolean,default:!0},width:{type:[Number,String],default:void 0},overlap:Boolean,keepAliveOnHover:{type:Boolean,default:!0},zIndex:Number,to:Ti.propTo,scrollable:Boolean,contentClass:String,contentStyle:[Object,String],headerClass:String,headerStyle:[Object,String],footerClass:String,footerStyle:[Object,String],onClickoutside:Function,"onUpdate:show":[Function,Array],onUpdateShow:[Function,Array],internalDeactivateImmediately:Boolean,internalSyncTargetWithParent:Boolean,internalInheritedEventHandlers:{type:Array,default:()=>[]},internalTrapFocus:Boolean,internalExtraClass:{type:Array,default:()=>[]},onShow:[Function,Array],onHide:[Function,Array],arrow:{type:Boolean,default:void 0},minWidth:Number,maxWidth:Number},U6=Object.assign(Object.assign(Object.assign({},cn.props),z6),{internalOnAfterLeave:Function,internalRenderBody:Function}),$6=Vt({name:"Popover",inheritAttrs:!1,props:U6,__popover__:!0,setup(n){const e=Dd(),t=Je(null),r=rt(()=>n.show),i=Je(n.defaultShow),o=el(r,i),s=er(()=>n.disabled?!1:o.value),a=()=>{if(n.disabled)return!0;const{getDisabled:R}=n;return!!(R!=null&&R())},l=()=>a()?!1:o.value,c=NM(n,["arrow","showArrow"]),u=rt(()=>n.overlap?!1:c.value);let d=null;const h=Je(null),m=Je(null),f=er(()=>n.x!==void 0&&n.y!==void 0);function v(R){const{"onUpdate:show":B,onUpdateShow:L,onShow:F,onHide:H}=n;i.value=R,B&&zt(B,R),L&&zt(L,R),R&&F&&zt(F,!0),R&&H&&zt(H,!1)}function g(){d&&d.syncPosition()}function b(){const{value:R}=h;R&&(window.clearTimeout(R),h.value=null)}function S(){const{value:R}=m;R&&(window.clearTimeout(R),m.value=null)}function p(){const R=a();if(n.trigger==="focus"&&!R){if(l())return;v(!0)}}function y(){const R=a();if(n.trigger==="focus"&&!R){if(!l())return;v(!1)}}function w(){const R=a();if(n.trigger==="hover"&&!R){if(S(),h.value!==null||l())return;const B=()=>{v(!0),h.value=null},{delay:L}=n;L===0?B():h.value=window.setTimeout(B,L)}}function x(){const R=a();if(n.trigger==="hover"&&!R){if(b(),m.value!==null||!l())return;const B=()=>{v(!1),m.value=null},{duration:L}=n;L===0?B():m.value=window.setTimeout(B,L)}}function _(){x()}function A(R){var B;l()&&(n.trigger==="click"&&(b(),S(),v(!1)),(B=n.onClickoutside)===null||B===void 0||B.call(n,R))}function C(){if(n.trigger==="click"&&!a()){b(),S();const R=!l();v(R)}}function T(R){n.internalTrapFocus&&R.key==="Escape"&&(b(),S(),v(!1))}function I(R){i.value=R}function M(){var R;return(R=t.value)===null||R===void 0?void 0:R.targetRef}function P(R){d=R}return Xi("NPopover",{getTriggerElement:M,handleKeydown:T,handleMouseEnter:w,handleMouseLeave:x,handleClickOutside:A,handleMouseMoveOutside:_,setBodyInstance:P,positionManuallyRef:f,isMountedRef:e,zIndexRef:Jt(n,"zIndex"),extraClassRef:Jt(n,"internalExtraClass"),internalRenderBodyRef:Jt(n,"internalRenderBody")}),Ws(()=>{o.value&&a()&&v(!1)}),{binderInstRef:t,positionManually:f,mergedShowConsideringDisabledProp:s,uncontrolledShow:i,mergedShowArrow:u,getMergedShow:l,setShow:I,handleClick:C,handleMouseEnter:w,handleMouseLeave:x,handleFocus:p,handleBlur:y,syncPosition:g}},render(){var n;const{positionManually:e,$slots:t}=this;let r,i=!1;if(!e&&(t.activator?r=x_(t,"activator"):r=x_(t,"trigger"),r)){r=es(r),r=r.type===Md?ge("span",[r]):r;const o={onClick:this.handleClick,onMouseenter:this.handleMouseEnter,onMouseleave:this.handleMouseLeave,onFocus:this.handleFocus,onBlur:this.handleBlur};if(!((n=r.type)===null||n===void 0)&&n.__popover__)i=!0,r.props||(r.props={internalSyncTargetWithParent:!0,internalInheritedEventHandlers:[]}),r.props.internalSyncTargetWithParent=!0,r.props.internalInheritedEventHandlers?r.props.internalInheritedEventHandlers=[o,...r.props.internalInheritedEventHandlers]:r.props.internalInheritedEventHandlers=[o];else{const{internalInheritedEventHandlers:s}=this,a=[o,...s],l={onBlur:c=>{a.forEach(u=>{u.onBlur(c)})},onFocus:c=>{a.forEach(u=>{u.onFocus(c)})},onClick:c=>{a.forEach(u=>{u.onClick(c)})},onMouseenter:c=>{a.forEach(u=>{u.onMouseenter(c)})},onMouseleave:c=>{a.forEach(u=>{u.onMouseleave(c)})}};N6(r,s?"nested":e?"manual":this.trigger,l)}}return ge(pb,{ref:"binderInstRef",syncTarget:!i,syncTargetWithParent:this.internalSyncTargetWithParent},{default:()=>{this.mergedShowConsideringDisabledProp;const o=this.getMergedShow();return[this.internalTrapFocus&&o?Ic(ge("div",{style:{position:"fixed",inset:0}}),[[qM,{enabled:o,zIndex:this.zIndex}]]):null,e?null:ge(mb,null,{default:()=>r}),ge(O6,F4(this.$props,k6,Object.assign(Object.assign({},this.$attrs),{showArrow:this.mergedShowArrow,show:o})),{default:()=>{var s,a;return(a=(s=this.$slots).default)===null||a===void 0?void 0:a.call(s)},header:()=>{var s,a;return(a=(s=this.$slots).header)===null||a===void 0?void 0:a.call(s)},footer:()=>{var s,a;return(a=(s=this.$slots).footer)===null||a===void 0?void 0:a.call(s)}})]}})}}),H6={closeIconSizeTiny:"12px",closeIconSizeSmall:"12px",closeIconSizeMedium:"14px",closeIconSizeLarge:"14px",closeSizeTiny:"16px",closeSizeSmall:"16px",closeSizeMedium:"18px",closeSizeLarge:"18px",padding:"0 7px",closeMargin:"0 0 0 4px"};function V6(n){const{textColor2:e,primaryColorHover:t,primaryColorPressed:r,primaryColor:i,infoColor:o,successColor:s,warningColor:a,errorColor:l,baseColor:c,borderColor:u,opacityDisabled:d,tagColor:h,closeIconColor:m,closeIconColorHover:f,closeIconColorPressed:v,borderRadiusSmall:g,fontSizeMini:b,fontSizeTiny:S,fontSizeSmall:p,fontSizeMedium:y,heightMini:w,heightTiny:x,heightSmall:_,heightMedium:A,closeColorHover:C,closeColorPressed:T,buttonColor2Hover:I,buttonColor2Pressed:M,fontWeightStrong:P}=n;return Object.assign(Object.assign({},H6),{closeBorderRadius:g,heightTiny:w,heightSmall:x,heightMedium:_,heightLarge:A,borderRadius:g,opacityDisabled:d,fontSizeTiny:b,fontSizeSmall:S,fontSizeMedium:p,fontSizeLarge:y,fontWeightStrong:P,textColorCheckable:e,textColorHoverCheckable:e,textColorPressedCheckable:e,textColorChecked:c,colorCheckable:"#0000",colorHoverCheckable:I,colorPressedCheckable:M,colorChecked:i,colorCheckedHover:t,colorCheckedPressed:r,border:`1px solid ${u}`,textColor:e,color:h,colorBordered:"rgb(250, 250, 252)",closeIconColor:m,closeIconColorHover:f,closeIconColorPressed:v,closeColorHover:C,closeColorPressed:T,borderPrimary:`1px solid ${Nt(i,{alpha:.3})}`,textColorPrimary:i,colorPrimary:Nt(i,{alpha:.12}),colorBorderedPrimary:Nt(i,{alpha:.1}),closeIconColorPrimary:i,closeIconColorHoverPrimary:i,closeIconColorPressedPrimary:i,closeColorHoverPrimary:Nt(i,{alpha:.12}),closeColorPressedPrimary:Nt(i,{alpha:.18}),borderInfo:`1px solid ${Nt(o,{alpha:.3})}`,textColorInfo:o,colorInfo:Nt(o,{alpha:.12}),colorBorderedInfo:Nt(o,{alpha:.1}),closeIconColorInfo:o,closeIconColorHoverInfo:o,closeIconColorPressedInfo:o,closeColorHoverInfo:Nt(o,{alpha:.12}),closeColorPressedInfo:Nt(o,{alpha:.18}),borderSuccess:`1px solid ${Nt(s,{alpha:.3})}`,textColorSuccess:s,colorSuccess:Nt(s,{alpha:.12}),colorBorderedSuccess:Nt(s,{alpha:.1}),closeIconColorSuccess:s,closeIconColorHoverSuccess:s,closeIconColorPressedSuccess:s,closeColorHoverSuccess:Nt(s,{alpha:.12}),closeColorPressedSuccess:Nt(s,{alpha:.18}),borderWarning:`1px solid ${Nt(a,{alpha:.35})}`,textColorWarning:a,colorWarning:Nt(a,{alpha:.15}),colorBorderedWarning:Nt(a,{alpha:.12}),closeIconColorWarning:a,closeIconColorHoverWarning:a,closeIconColorPressedWarning:a,closeColorHoverWarning:Nt(a,{alpha:.12}),closeColorPressedWarning:Nt(a,{alpha:.18}),borderError:`1px solid ${Nt(l,{alpha:.23})}`,textColorError:l,colorError:Nt(l,{alpha:.1}),colorBorderedError:Nt(l,{alpha:.08}),closeIconColorError:l,closeIconColorHoverError:l,closeIconColorPressedError:l,closeColorHoverError:Nt(l,{alpha:.12}),closeColorPressedError:Nt(l,{alpha:.18})})}const G6={name:"Tag",common:ti,self:V6},W6={color:Object,type:{type:String,default:"default"},round:Boolean,size:{type:String,default:"medium"},closable:Boolean,disabled:{type:Boolean,default:void 0}},j6=Ke("tag",`
 --n-close-margin: var(--n-close-margin-top) var(--n-close-margin-right) var(--n-close-margin-bottom) var(--n-close-margin-left);
 white-space: nowrap;
 position: relative;
 box-sizing: border-box;
 cursor: default;
 display: inline-flex;
 align-items: center;
 flex-wrap: nowrap;
 padding: var(--n-padding);
 border-radius: var(--n-border-radius);
 color: var(--n-text-color);
 background-color: var(--n-color);
 transition: 
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier),
 opacity .3s var(--n-bezier);
 line-height: 1;
 height: var(--n-height);
 font-size: var(--n-font-size);
`,[pt("strong",`
 font-weight: var(--n-font-weight-strong);
 `),Ye("border",`
 pointer-events: none;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 border-radius: inherit;
 border: var(--n-border);
 transition: border-color .3s var(--n-bezier);
 `),Ye("icon",`
 display: flex;
 margin: 0 4px 0 0;
 color: var(--n-text-color);
 transition: color .3s var(--n-bezier);
 font-size: var(--n-avatar-size-override);
 `),Ye("avatar",`
 display: flex;
 margin: 0 6px 0 0;
 `),Ye("close",`
 margin: var(--n-close-margin);
 transition:
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
 `),pt("round",`
 padding: 0 calc(var(--n-height) / 3);
 border-radius: calc(var(--n-height) / 2);
 `,[Ye("icon",`
 margin: 0 4px 0 calc((var(--n-height) - 8px) / -2);
 `),Ye("avatar",`
 margin: 0 6px 0 calc((var(--n-height) - 8px) / -2);
 `),pt("closable",`
 padding: 0 calc(var(--n-height) / 4) 0 calc(var(--n-height) / 3);
 `)]),pt("icon, avatar",[pt("round",`
 padding: 0 calc(var(--n-height) / 3) 0 calc(var(--n-height) / 2);
 `)]),pt("disabled",`
 cursor: not-allowed !important;
 opacity: var(--n-opacity-disabled);
 `),pt("checkable",`
 cursor: pointer;
 box-shadow: none;
 color: var(--n-text-color-checkable);
 background-color: var(--n-color-checkable);
 `,[ar("disabled",[tt("&:hover","background-color: var(--n-color-hover-checkable);",[ar("checked","color: var(--n-text-color-hover-checkable);")]),tt("&:active","background-color: var(--n-color-pressed-checkable);",[ar("checked","color: var(--n-text-color-pressed-checkable);")])]),pt("checked",`
 color: var(--n-text-color-checked);
 background-color: var(--n-color-checked);
 `,[ar("disabled",[tt("&:hover","background-color: var(--n-color-checked-hover);"),tt("&:active","background-color: var(--n-color-checked-pressed);")])])])]),q6=Object.assign(Object.assign(Object.assign({},cn.props),W6),{bordered:{type:Boolean,default:void 0},checked:Boolean,checkable:Boolean,strong:Boolean,triggerClickOnClose:Boolean,onClose:[Array,Function],onMouseenter:Function,onMouseleave:Function,"onUpdate:checked":Function,onUpdateChecked:Function,internalCloseFocusable:{type:Boolean,default:!0},internalCloseIsButtonTag:{type:Boolean,default:!0},onCheckedChange:Function}),X6="n-tag",hg=Vt({name:"Tag",props:q6,setup(n){const e=Je(null),{mergedBorderedRef:t,mergedClsPrefixRef:r,inlineThemeDisabled:i,mergedRtlRef:o}=ei(n),s=cn("Tag","-tag",j6,G6,n,r);Xi(X6,{roundRef:Jt(n,"round")});function a(){if(!n.disabled&&n.checkable){const{checked:m,onCheckedChange:f,onUpdateChecked:v,"onUpdate:checked":g}=n;v&&v(!m),g&&g(!m),f&&f(!m)}}function l(m){if(n.triggerClickOnClose||m.stopPropagation(),!n.disabled){const{onClose:f}=n;f&&zt(f,m)}}const c={setTextContent(m){const{value:f}=e;f&&(f.textContent=m)}},u=ra("Tag",o,r),d=rt(()=>{const{type:m,size:f,color:{color:v,textColor:g}={}}=n,{common:{cubicBezierEaseInOut:b},self:{padding:S,closeMargin:p,borderRadius:y,opacityDisabled:w,textColorCheckable:x,textColorHoverCheckable:_,textColorPressedCheckable:A,textColorChecked:C,colorCheckable:T,colorHoverCheckable:I,colorPressedCheckable:M,colorChecked:P,colorCheckedHover:E,colorCheckedPressed:R,closeBorderRadius:B,fontWeightStrong:L,[gt("colorBordered",m)]:F,[gt("closeSize",f)]:H,[gt("closeIconSize",f)]:$,[gt("fontSize",f)]:O,[gt("height",f)]:k,[gt("color",m)]:X,[gt("textColor",m)]:ie,[gt("border",m)]:ne,[gt("closeIconColor",m)]:Q,[gt("closeIconColorHover",m)]:ce,[gt("closeIconColorPressed",m)]:Z,[gt("closeColorHover",m)]:re,[gt("closeColorPressed",m)]:se}}=s.value,fe=Zo(p);return{"--n-font-weight-strong":L,"--n-avatar-size-override":`calc(${k} - 8px)`,"--n-bezier":b,"--n-border-radius":y,"--n-border":ne,"--n-close-icon-size":$,"--n-close-color-pressed":se,"--n-close-color-hover":re,"--n-close-border-radius":B,"--n-close-icon-color":Q,"--n-close-icon-color-hover":ce,"--n-close-icon-color-pressed":Z,"--n-close-icon-color-disabled":Q,"--n-close-margin-top":fe.top,"--n-close-margin-right":fe.right,"--n-close-margin-bottom":fe.bottom,"--n-close-margin-left":fe.left,"--n-close-size":H,"--n-color":v||(t.value?F:X),"--n-color-checkable":T,"--n-color-checked":P,"--n-color-checked-hover":E,"--n-color-checked-pressed":R,"--n-color-hover-checkable":I,"--n-color-pressed-checkable":M,"--n-font-size":O,"--n-height":k,"--n-opacity-disabled":w,"--n-padding":S,"--n-text-color":g||ie,"--n-text-color-checkable":x,"--n-text-color-checked":C,"--n-text-color-hover-checkable":_,"--n-text-color-pressed-checkable":A}}),h=i?Qr("tag",rt(()=>{let m="";const{type:f,size:v,color:{color:g,textColor:b}={}}=n;return m+=f[0],m+=v[0],g&&(m+=`a${Yf(g)}`),b&&(m+=`b${Yf(b)}`),t.value&&(m+="c"),m}),d,n):void 0;return Object.assign(Object.assign({},c),{rtlEnabled:u,mergedClsPrefix:r,contentRef:e,mergedBordered:t,handleClick:a,handleCloseClick:l,cssVars:i?void 0:d,themeClass:h==null?void 0:h.themeClass,onRender:h==null?void 0:h.onRender})},render(){var n,e;const{mergedClsPrefix:t,rtlEnabled:r,closable:i,color:{borderColor:o}={},round:s,onRender:a,$slots:l}=this;a==null||a();const c=vr(l.avatar,d=>d&&ge("div",{class:`${t}-tag__avatar`},d)),u=vr(l.icon,d=>d&&ge("div",{class:`${t}-tag__icon`},d));return ge("div",{class:[`${t}-tag`,this.themeClass,{[`${t}-tag--rtl`]:r,[`${t}-tag--strong`]:this.strong,[`${t}-tag--disabled`]:this.disabled,[`${t}-tag--checkable`]:this.checkable,[`${t}-tag--checked`]:this.checkable&&this.checked,[`${t}-tag--round`]:s,[`${t}-tag--avatar`]:c,[`${t}-tag--icon`]:u,[`${t}-tag--closable`]:i}],style:this.cssVars,onClick:this.handleClick,onMouseenter:this.onMouseenter,onMouseleave:this.onMouseleave},u||c,ge("span",{class:`${t}-tag__content`,ref:"contentRef"},(e=(n=this.$slots).default)===null||e===void 0?void 0:e.call(n)),!this.checkable&&i?ge(kT,{clsPrefix:t,class:`${t}-tag__close`,disabled:this.disabled,onClick:this.handleCloseClick,focusable:this.internalCloseFocusable,round:s,isButtonTag:this.internalCloseIsButtonTag,absolute:!0}):null,!this.checkable&&this.mergedBordered?ge("div",{class:`${t}-tag__border`,style:{borderColor:o}}):null)}}),Y6=Ke("base-clear",`
 flex-shrink: 0;
 height: 1em;
 width: 1em;
 position: relative;
`,[tt(">",[Ye("clear",`
 font-size: var(--n-clear-size);
 height: 1em;
 width: 1em;
 cursor: pointer;
 color: var(--n-clear-color);
 transition: color .3s var(--n-bezier);
 display: flex;
 `,[tt("&:hover",`
 color: var(--n-clear-color-hover)!important;
 `),tt("&:active",`
 color: var(--n-clear-color-pressed)!important;
 `)]),Ye("placeholder",`
 display: flex;
 `),Ye("clear, placeholder",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 `,[ip({originalTransform:"translateX(-50%) translateY(-50%)",left:"50%",top:"50%"})])])]),H1=Vt({name:"BaseClear",props:{clsPrefix:{type:String,required:!0},show:Boolean,onClear:Function},setup(n){return Nc("-base-clear",Y6,Jt(n,"clsPrefix")),{handleMouseDown(e){e.preventDefault()}}},render(){const{clsPrefix:n}=this;return ge("div",{class:`${n}-base-clear`},ge(Ib,null,{default:()=>{var e,t;return this.show?ge("div",{key:"dismiss",class:`${n}-base-clear__clear`,onClick:this.onClear,onMousedown:this.handleMouseDown,"data-clear":!0},Ki(this.$slots.icon,()=>[ge(Ji,{clsPrefix:n},{default:()=>ge(LN,null)})])):ge("div",{key:"icon",class:`${n}-base-clear__placeholder`},(t=(e=this.$slots).placeholder)===null||t===void 0?void 0:t.call(e))}}))}}),WT=Vt({name:"InternalSelectionSuffix",props:{clsPrefix:{type:String,required:!0},showArrow:{type:Boolean,default:void 0},showClear:{type:Boolean,default:void 0},loading:{type:Boolean,default:!1},onClear:Function},setup(n,{slots:e}){return()=>{const{clsPrefix:t}=n;return ge(Db,{clsPrefix:t,class:`${t}-base-suffix`,strokeWidth:24,scale:.85,show:n.loading},{default:()=>n.showArrow?ge(H1,{clsPrefix:t,show:n.showClear,onClear:n.onClear},{placeholder:()=>ge(Ji,{clsPrefix:t,class:`${t}-base-suffix__arrow`},{default:()=>Ki(e.default,()=>[ge(DN,null)])})}):null})}}}),K6={paddingSingle:"0 26px 0 12px",paddingMultiple:"3px 26px 0 12px",clearSize:"16px",arrowSize:"16px"};function Z6(n){const{borderRadius:e,textColor2:t,textColorDisabled:r,inputColor:i,inputColorDisabled:o,primaryColor:s,primaryColorHover:a,warningColor:l,warningColorHover:c,errorColor:u,errorColorHover:d,borderColor:h,iconColor:m,iconColorDisabled:f,clearColor:v,clearColorHover:g,clearColorPressed:b,placeholderColor:S,placeholderColorDisabled:p,fontSizeTiny:y,fontSizeSmall:w,fontSizeMedium:x,fontSizeLarge:_,heightTiny:A,heightSmall:C,heightMedium:T,heightLarge:I}=n;return Object.assign(Object.assign({},K6),{fontSizeTiny:y,fontSizeSmall:w,fontSizeMedium:x,fontSizeLarge:_,heightTiny:A,heightSmall:C,heightMedium:T,heightLarge:I,borderRadius:e,textColor:t,textColorDisabled:r,placeholderColor:S,placeholderColorDisabled:p,color:i,colorDisabled:o,colorActive:i,border:`1px solid ${h}`,borderHover:`1px solid ${a}`,borderActive:`1px solid ${s}`,borderFocus:`1px solid ${a}`,boxShadowHover:"none",boxShadowActive:`0 0 0 2px ${Nt(s,{alpha:.2})}`,boxShadowFocus:`0 0 0 2px ${Nt(s,{alpha:.2})}`,caretColor:s,arrowColor:m,arrowColorDisabled:f,loadingColor:s,borderWarning:`1px solid ${l}`,borderHoverWarning:`1px solid ${c}`,borderActiveWarning:`1px solid ${l}`,borderFocusWarning:`1px solid ${c}`,boxShadowHoverWarning:"none",boxShadowActiveWarning:`0 0 0 2px ${Nt(l,{alpha:.2})}`,boxShadowFocusWarning:`0 0 0 2px ${Nt(l,{alpha:.2})}`,colorActiveWarning:i,caretColorWarning:l,borderError:`1px solid ${u}`,borderHoverError:`1px solid ${d}`,borderActiveError:`1px solid ${u}`,borderFocusError:`1px solid ${d}`,boxShadowHoverError:"none",boxShadowActiveError:`0 0 0 2px ${Nt(u,{alpha:.2})}`,boxShadowFocusError:`0 0 0 2px ${Nt(u,{alpha:.2})}`,colorActiveError:i,caretColorError:u,clearColor:v,clearColorHover:g,clearColorPressed:b})}const jT={name:"InternalSelection",common:ti,peers:{Popover:VT},self:Z6},J6=tt([Ke("base-selection",`
 --n-padding-single: var(--n-padding-single-top) var(--n-padding-single-right) var(--n-padding-single-bottom) var(--n-padding-single-left);
 --n-padding-multiple: var(--n-padding-multiple-top) var(--n-padding-multiple-right) var(--n-padding-multiple-bottom) var(--n-padding-multiple-left);
 position: relative;
 z-index: auto;
 box-shadow: none;
 width: 100%;
 max-width: 100%;
 display: inline-block;
 vertical-align: bottom;
 border-radius: var(--n-border-radius);
 min-height: var(--n-height);
 line-height: 1.5;
 font-size: var(--n-font-size);
 `,[Ke("base-loading",`
 color: var(--n-loading-color);
 `),Ke("base-selection-tags","min-height: var(--n-height);"),Ye("border, state-border",`
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 pointer-events: none;
 border: var(--n-border);
 border-radius: inherit;
 transition:
 box-shadow .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `),Ye("state-border",`
 z-index: 1;
 border-color: #0000;
 `),Ke("base-suffix",`
 cursor: pointer;
 position: absolute;
 top: 50%;
 transform: translateY(-50%);
 right: 10px;
 `,[Ye("arrow",`
 font-size: var(--n-arrow-size);
 color: var(--n-arrow-color);
 transition: color .3s var(--n-bezier);
 `)]),Ke("base-selection-overlay",`
 display: flex;
 align-items: center;
 white-space: nowrap;
 pointer-events: none;
 position: absolute;
 top: 0;
 right: 0;
 bottom: 0;
 left: 0;
 padding: var(--n-padding-single);
 transition: color .3s var(--n-bezier);
 `,[Ye("wrapper",`
 flex-basis: 0;
 flex-grow: 1;
 overflow: hidden;
 text-overflow: ellipsis;
 `)]),Ke("base-selection-placeholder",`
 color: var(--n-placeholder-color);
 `,[Ye("inner",`
 max-width: 100%;
 overflow: hidden;
 `)]),Ke("base-selection-tags",`
 cursor: pointer;
 outline: none;
 box-sizing: border-box;
 position: relative;
 z-index: auto;
 display: flex;
 padding: var(--n-padding-multiple);
 flex-wrap: wrap;
 align-items: center;
 width: 100%;
 vertical-align: bottom;
 background-color: var(--n-color);
 border-radius: inherit;
 transition:
 color .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `),Ke("base-selection-label",`
 height: var(--n-height);
 display: inline-flex;
 width: 100%;
 vertical-align: bottom;
 cursor: pointer;
 outline: none;
 z-index: auto;
 box-sizing: border-box;
 position: relative;
 transition:
 color .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 border-radius: inherit;
 background-color: var(--n-color);
 align-items: center;
 `,[Ke("base-selection-input",`
 font-size: inherit;
 line-height: inherit;
 outline: none;
 cursor: pointer;
 box-sizing: border-box;
 border:none;
 width: 100%;
 padding: var(--n-padding-single);
 background-color: #0000;
 color: var(--n-text-color);
 transition: color .3s var(--n-bezier);
 caret-color: var(--n-caret-color);
 `,[Ye("content",`
 text-overflow: ellipsis;
 overflow: hidden;
 white-space: nowrap; 
 `)]),Ye("render-label",`
 color: var(--n-text-color);
 `)]),ar("disabled",[tt("&:hover",[Ye("state-border",`
 box-shadow: var(--n-box-shadow-hover);
 border: var(--n-border-hover);
 `)]),pt("focus",[Ye("state-border",`
 box-shadow: var(--n-box-shadow-focus);
 border: var(--n-border-focus);
 `)]),pt("active",[Ye("state-border",`
 box-shadow: var(--n-box-shadow-active);
 border: var(--n-border-active);
 `),Ke("base-selection-label","background-color: var(--n-color-active);"),Ke("base-selection-tags","background-color: var(--n-color-active);")])]),pt("disabled","cursor: not-allowed;",[Ye("arrow",`
 color: var(--n-arrow-color-disabled);
 `),Ke("base-selection-label",`
 cursor: not-allowed;
 background-color: var(--n-color-disabled);
 `,[Ke("base-selection-input",`
 cursor: not-allowed;
 color: var(--n-text-color-disabled);
 `),Ye("render-label",`
 color: var(--n-text-color-disabled);
 `)]),Ke("base-selection-tags",`
 cursor: not-allowed;
 background-color: var(--n-color-disabled);
 `),Ke("base-selection-placeholder",`
 cursor: not-allowed;
 color: var(--n-placeholder-color-disabled);
 `)]),Ke("base-selection-input-tag",`
 height: calc(var(--n-height) - 6px);
 line-height: calc(var(--n-height) - 6px);
 outline: none;
 display: none;
 position: relative;
 margin-bottom: 3px;
 max-width: 100%;
 vertical-align: bottom;
 `,[Ye("input",`
 font-size: inherit;
 font-family: inherit;
 min-width: 1px;
 padding: 0;
 background-color: #0000;
 outline: none;
 border: none;
 max-width: 100%;
 overflow: hidden;
 width: 1em;
 line-height: inherit;
 cursor: pointer;
 color: var(--n-text-color);
 caret-color: var(--n-caret-color);
 `),Ye("mirror",`
 position: absolute;
 left: 0;
 top: 0;
 white-space: pre;
 visibility: hidden;
 user-select: none;
 -webkit-user-select: none;
 opacity: 0;
 `)]),["warning","error"].map(n=>pt(`${n}-status`,[Ye("state-border",`border: var(--n-border-${n});`),ar("disabled",[tt("&:hover",[Ye("state-border",`
 box-shadow: var(--n-box-shadow-hover-${n});
 border: var(--n-border-hover-${n});
 `)]),pt("active",[Ye("state-border",`
 box-shadow: var(--n-box-shadow-active-${n});
 border: var(--n-border-active-${n});
 `),Ke("base-selection-label",`background-color: var(--n-color-active-${n});`),Ke("base-selection-tags",`background-color: var(--n-color-active-${n});`)]),pt("focus",[Ye("state-border",`
 box-shadow: var(--n-box-shadow-focus-${n});
 border: var(--n-border-focus-${n});
 `)])])]))]),Ke("base-selection-popover",`
 margin-bottom: -3px;
 display: flex;
 flex-wrap: wrap;
 margin-right: -8px;
 `),Ke("base-selection-tag-wrapper",`
 max-width: 100%;
 display: inline-flex;
 padding: 0 7px 3px 0;
 `,[tt("&:last-child","padding-right: 0;"),Ke("tag",`
 font-size: 14px;
 max-width: 100%;
 `,[Ye("content",`
 line-height: 1.25;
 text-overflow: ellipsis;
 overflow: hidden;
 `)])])]),Q6=Vt({name:"InternalSelection",props:Object.assign(Object.assign({},cn.props),{clsPrefix:{type:String,required:!0},bordered:{type:Boolean,default:void 0},active:Boolean,pattern:{type:String,default:""},placeholder:String,selectedOption:{type:Object,default:null},selectedOptions:{type:Array,default:null},labelField:{type:String,default:"label"},valueField:{type:String,default:"value"},multiple:Boolean,filterable:Boolean,clearable:Boolean,disabled:Boolean,size:{type:String,default:"medium"},loading:Boolean,autofocus:Boolean,showArrow:{type:Boolean,default:!0},inputProps:Object,focused:Boolean,renderTag:Function,onKeydown:Function,onClick:Function,onBlur:Function,onFocus:Function,onDeleteOption:Function,maxTagCount:[String,Number],ellipsisTagPopoverProps:Object,onClear:Function,onPatternInput:Function,onPatternFocus:Function,onPatternBlur:Function,renderLabel:Function,status:String,inlineThemeDisabled:Boolean,ignoreComposition:{type:Boolean,default:!0},onResize:Function}),setup(n){const{mergedClsPrefixRef:e,mergedRtlRef:t}=ei(n),r=ra("InternalSelection",t,e),i=Je(null),o=Je(null),s=Je(null),a=Je(null),l=Je(null),c=Je(null),u=Je(null),d=Je(null),h=Je(null),m=Je(null),f=Je(!1),v=Je(!1),g=Je(!1),b=cn("InternalSelection","-internal-selection",J6,jT,n,Jt(n,"clsPrefix")),S=rt(()=>n.clearable&&!n.disabled&&(g.value||n.active)),p=rt(()=>n.selectedOption?n.renderTag?n.renderTag({option:n.selectedOption,handleClose:()=>{}}):n.renderLabel?n.renderLabel(n.selectedOption,!0):Jl(n.selectedOption[n.labelField],n.selectedOption,!0):n.placeholder),y=rt(()=>{const D=n.selectedOption;if(D)return D[n.labelField]}),w=rt(()=>n.multiple?!!(Array.isArray(n.selectedOptions)&&n.selectedOptions.length):n.selectedOption!==null);function x(){var D;const{value:q}=i;if(q){const{value:_e}=o;_e&&(_e.style.width=`${q.offsetWidth}px`,n.maxTagCount!=="responsive"&&((D=h.value)===null||D===void 0||D.sync({showAllItemsBeforeCalculate:!1})))}}function _(){const{value:D}=m;D&&(D.style.display="none")}function A(){const{value:D}=m;D&&(D.style.display="inline-block")}bn(Jt(n,"active"),D=>{D||_()}),bn(Jt(n,"pattern"),()=>{n.multiple&&ui(x)});function C(D){const{onFocus:q}=n;q&&q(D)}function T(D){const{onBlur:q}=n;q&&q(D)}function I(D){const{onDeleteOption:q}=n;q&&q(D)}function M(D){const{onClear:q}=n;q&&q(D)}function P(D){const{onPatternInput:q}=n;q&&q(D)}function E(D){var q;(!D.relatedTarget||!(!((q=s.value)===null||q===void 0)&&q.contains(D.relatedTarget)))&&C(D)}function R(D){var q;!((q=s.value)===null||q===void 0)&&q.contains(D.relatedTarget)||T(D)}function B(D){M(D)}function L(){g.value=!0}function F(){g.value=!1}function H(D){!n.active||!n.filterable||D.target!==o.value&&D.preventDefault()}function $(D){I(D)}const O=Je(!1);function k(D){if(D.key==="Backspace"&&!O.value&&!n.pattern.length){const{selectedOptions:q}=n;q!=null&&q.length&&$(q[q.length-1])}}let X=null;function ie(D){const{value:q}=i;if(q){const _e=D.target.value;q.textContent=_e,x()}n.ignoreComposition&&O.value?X=D:P(D)}function ne(){O.value=!0}function Q(){O.value=!1,n.ignoreComposition&&P(X),X=null}function ce(D){var q;v.value=!0,(q=n.onPatternFocus)===null||q===void 0||q.call(n,D)}function Z(D){var q;v.value=!1,(q=n.onPatternBlur)===null||q===void 0||q.call(n,D)}function re(){var D,q;if(n.filterable)v.value=!1,(D=c.value)===null||D===void 0||D.blur(),(q=o.value)===null||q===void 0||q.blur();else if(n.multiple){const{value:_e}=a;_e==null||_e.blur()}else{const{value:_e}=l;_e==null||_e.blur()}}function se(){var D,q,_e;n.filterable?(v.value=!1,(D=c.value)===null||D===void 0||D.focus()):n.multiple?(q=a.value)===null||q===void 0||q.focus():(_e=l.value)===null||_e===void 0||_e.focus()}function fe(){const{value:D}=o;D&&(A(),D.focus())}function ue(){const{value:D}=o;D&&D.blur()}function U(D){const{value:q}=u;q&&q.setTextContent(`+${D}`)}function K(){const{value:D}=d;return D}function be(){return o.value}let me=null;function le(){me!==null&&window.clearTimeout(me)}function xe(){n.active||(le(),me=window.setTimeout(()=>{w.value&&(f.value=!0)},100))}function pe(){le()}function ye(D){D||(le(),f.value=!1)}bn(w,D=>{D||(f.value=!1)}),Er(()=>{Ws(()=>{const D=c.value;D&&(n.disabled?D.removeAttribute("tabindex"):D.tabIndex=v.value?-1:0)})}),iT(s,n.onResize);const{inlineThemeDisabled:Me}=n,Ce=rt(()=>{const{size:D}=n,{common:{cubicBezierEaseInOut:q},self:{borderRadius:_e,color:ve,placeholderColor:Re,textColor:ze,paddingSingle:Le,paddingMultiple:Ve,caretColor:Ze,colorDisabled:ut,textColorDisabled:Ne,placeholderColorDisabled:ct,colorActive:he,boxShadowFocus:Ae,boxShadowActive:Fe,boxShadowHover:ke,border:We,borderFocus:ee,borderHover:Ie,borderActive:Se,arrowColor:Ee,arrowColorDisabled:Ge,loadingColor:ft,colorActiveWarning:Rt,boxShadowFocusWarning:St,boxShadowActiveWarning:N,boxShadowHoverWarning:j,borderWarning:Y,borderFocusWarning:oe,borderHoverWarning:de,borderActiveWarning:G,colorActiveError:ae,boxShadowFocusError:we,boxShadowActiveError:He,boxShadowHoverError:qe,borderError:Qe,borderFocusError:vt,borderHoverError:ot,borderActiveError:et,clearColor:J,clearColorHover:Pe,clearColorPressed:Oe,clearSize:De,arrowSize:$e,[gt("height",D)]:it,[gt("fontSize",D)]:mt}}=b.value,bt=Zo(Le),lt=Zo(Ve);return{"--n-bezier":q,"--n-border":We,"--n-border-active":Se,"--n-border-focus":ee,"--n-border-hover":Ie,"--n-border-radius":_e,"--n-box-shadow-active":Fe,"--n-box-shadow-focus":Ae,"--n-box-shadow-hover":ke,"--n-caret-color":Ze,"--n-color":ve,"--n-color-active":he,"--n-color-disabled":ut,"--n-font-size":mt,"--n-height":it,"--n-padding-single-top":bt.top,"--n-padding-multiple-top":lt.top,"--n-padding-single-right":bt.right,"--n-padding-multiple-right":lt.right,"--n-padding-single-left":bt.left,"--n-padding-multiple-left":lt.left,"--n-padding-single-bottom":bt.bottom,"--n-padding-multiple-bottom":lt.bottom,"--n-placeholder-color":Re,"--n-placeholder-color-disabled":ct,"--n-text-color":ze,"--n-text-color-disabled":Ne,"--n-arrow-color":Ee,"--n-arrow-color-disabled":Ge,"--n-loading-color":ft,"--n-color-active-warning":Rt,"--n-box-shadow-focus-warning":St,"--n-box-shadow-active-warning":N,"--n-box-shadow-hover-warning":j,"--n-border-warning":Y,"--n-border-focus-warning":oe,"--n-border-hover-warning":de,"--n-border-active-warning":G,"--n-color-active-error":ae,"--n-box-shadow-focus-error":we,"--n-box-shadow-active-error":He,"--n-box-shadow-hover-error":qe,"--n-border-error":Qe,"--n-border-focus-error":vt,"--n-border-hover-error":ot,"--n-border-active-error":et,"--n-clear-size":De,"--n-clear-color":J,"--n-clear-color-hover":Pe,"--n-clear-color-pressed":Oe,"--n-arrow-size":$e}}),z=Me?Qr("internal-selection",rt(()=>n.size[0]),Ce,n):void 0;return{mergedTheme:b,mergedClearable:S,mergedClsPrefix:e,rtlEnabled:r,patternInputFocused:v,filterablePlaceholder:p,label:y,selected:w,showTagsPanel:f,isComposing:O,counterRef:u,counterWrapperRef:d,patternInputMirrorRef:i,patternInputRef:o,selfRef:s,multipleElRef:a,singleElRef:l,patternInputWrapperRef:c,overflowRef:h,inputTagElRef:m,handleMouseDown:H,handleFocusin:E,handleClear:B,handleMouseEnter:L,handleMouseLeave:F,handleDeleteOption:$,handlePatternKeyDown:k,handlePatternInputInput:ie,handlePatternInputBlur:Z,handlePatternInputFocus:ce,handleMouseEnterCounter:xe,handleMouseLeaveCounter:pe,handleFocusout:R,handleCompositionEnd:Q,handleCompositionStart:ne,onPopoverUpdateShow:ye,focus:se,focusInput:fe,blur:re,blurInput:ue,updateCounter:U,getCounter:K,getTail:be,renderLabel:n.renderLabel,cssVars:Me?void 0:Ce,themeClass:z==null?void 0:z.themeClass,onRender:z==null?void 0:z.onRender}},render(){const{status:n,multiple:e,size:t,disabled:r,filterable:i,maxTagCount:o,bordered:s,clsPrefix:a,ellipsisTagPopoverProps:l,onRender:c,renderTag:u,renderLabel:d}=this;c==null||c();const h=o==="responsive",m=typeof o=="number",f=h||m,v=ge(T1,null,{default:()=>ge(WT,{clsPrefix:a,loading:this.loading,showArrow:this.showArrow,showClear:this.mergedClearable&&this.selected,onClear:this.handleClear},{default:()=>{var b,S;return(S=(b=this.$slots).arrow)===null||S===void 0?void 0:S.call(b)}})});let g;if(e){const{labelField:b}=this,S=P=>ge("div",{class:`${a}-base-selection-tag-wrapper`,key:P.value},u?u({option:P,handleClose:()=>{this.handleDeleteOption(P)}}):ge(hg,{size:t,closable:!P.disabled,disabled:r,onClose:()=>{this.handleDeleteOption(P)},internalCloseIsButtonTag:!1,internalCloseFocusable:!1},{default:()=>d?d(P,!0):Jl(P[b],P,!0)})),p=()=>(m?this.selectedOptions.slice(0,o):this.selectedOptions).map(S),y=i?ge("div",{class:`${a}-base-selection-input-tag`,ref:"inputTagElRef",key:"__input-tag__"},ge("input",Object.assign({},this.inputProps,{ref:"patternInputRef",tabindex:-1,disabled:r,value:this.pattern,autofocus:this.autofocus,class:`${a}-base-selection-input-tag__input`,onBlur:this.handlePatternInputBlur,onFocus:this.handlePatternInputFocus,onKeydown:this.handlePatternKeyDown,onInput:this.handlePatternInputInput,onCompositionstart:this.handleCompositionStart,onCompositionend:this.handleCompositionEnd})),ge("span",{ref:"patternInputMirrorRef",class:`${a}-base-selection-input-tag__mirror`},this.pattern)):null,w=h?()=>ge("div",{class:`${a}-base-selection-tag-wrapper`,ref:"counterWrapperRef"},ge(hg,{size:t,ref:"counterRef",onMouseenter:this.handleMouseEnterCounter,onMouseleave:this.handleMouseLeaveCounter,disabled:r})):void 0;let x;if(m){const P=this.selectedOptions.length-o;P>0&&(x=ge("div",{class:`${a}-base-selection-tag-wrapper`,key:"__counter__"},ge(hg,{size:t,ref:"counterRef",onMouseenter:this.handleMouseEnterCounter,disabled:r},{default:()=>`+${P}`})))}const _=h?i?ge(V_,{ref:"overflowRef",updateCounter:this.updateCounter,getCounter:this.getCounter,getTail:this.getTail,style:{width:"100%",display:"flex",overflow:"hidden"}},{default:p,counter:w,tail:()=>y}):ge(V_,{ref:"overflowRef",updateCounter:this.updateCounter,getCounter:this.getCounter,style:{width:"100%",display:"flex",overflow:"hidden"}},{default:p,counter:w}):m&&x?p().concat(x):p(),A=f?()=>ge("div",{class:`${a}-base-selection-popover`},h?p():this.selectedOptions.map(S)):void 0,C=f?Object.assign({show:this.showTagsPanel,trigger:"hover",overlap:!0,placement:"top",width:"trigger",onUpdateShow:this.onPopoverUpdateShow,theme:this.mergedTheme.peers.Popover,themeOverrides:this.mergedTheme.peerOverrides.Popover},l):null,I=(this.selected?!1:this.active?!this.pattern&&!this.isComposing:!0)?ge("div",{class:`${a}-base-selection-placeholder ${a}-base-selection-overlay`},ge("div",{class:`${a}-base-selection-placeholder__inner`},this.placeholder)):null,M=i?ge("div",{ref:"patternInputWrapperRef",class:`${a}-base-selection-tags`},_,h?null:y,v):ge("div",{ref:"multipleElRef",class:`${a}-base-selection-tags`,tabindex:r?void 0:0},_,v);g=ge($n,null,f?ge($6,Object.assign({},C,{scrollable:!0,style:"max-height: calc(var(--v-target-height) * 6.6);"}),{trigger:()=>M,default:A}):M,I)}else if(i){const b=this.pattern||this.isComposing,S=this.active?!b:!this.selected,p=this.active?!1:this.selected;g=ge("div",{ref:"patternInputWrapperRef",class:`${a}-base-selection-label`,title:this.patternInputFocused?void 0:__(this.label)},ge("input",Object.assign({},this.inputProps,{ref:"patternInputRef",class:`${a}-base-selection-input`,value:this.active?this.pattern:"",placeholder:"",readonly:r,disabled:r,tabindex:-1,autofocus:this.autofocus,onFocus:this.handlePatternInputFocus,onBlur:this.handlePatternInputBlur,onInput:this.handlePatternInputInput,onCompositionstart:this.handleCompositionStart,onCompositionend:this.handleCompositionEnd})),p?ge("div",{class:`${a}-base-selection-label__render-label ${a}-base-selection-overlay`,key:"input"},ge("div",{class:`${a}-base-selection-overlay__wrapper`},u?u({option:this.selectedOption,handleClose:()=>{}}):d?d(this.selectedOption,!0):Jl(this.label,this.selectedOption,!0))):null,S?ge("div",{class:`${a}-base-selection-placeholder ${a}-base-selection-overlay`,key:"placeholder"},ge("div",{class:`${a}-base-selection-overlay__wrapper`},this.filterablePlaceholder)):null,v)}else g=ge("div",{ref:"singleElRef",class:`${a}-base-selection-label`,tabindex:this.disabled?void 0:0},this.label!==void 0?ge("div",{class:`${a}-base-selection-input`,title:__(this.label),key:"input"},ge("div",{class:`${a}-base-selection-input__content`},u?u({option:this.selectedOption,handleClose:()=>{}}):d?d(this.selectedOption,!0):Jl(this.label,this.selectedOption,!0))):ge("div",{class:`${a}-base-selection-placeholder ${a}-base-selection-overlay`,key:"placeholder"},ge("div",{class:`${a}-base-selection-placeholder__inner`},this.placeholder)),v);return ge("div",{ref:"selfRef",class:[`${a}-base-selection`,this.rtlEnabled&&`${a}-base-selection--rtl`,this.themeClass,n&&`${a}-base-selection--${n}-status`,{[`${a}-base-selection--active`]:this.active,[`${a}-base-selection--selected`]:this.selected||this.active&&this.pattern,[`${a}-base-selection--disabled`]:this.disabled,[`${a}-base-selection--multiple`]:this.multiple,[`${a}-base-selection--focus`]:this.focused}],style:this.cssVars,onClick:this.onClick,onMouseenter:this.handleMouseEnter,onMouseleave:this.handleMouseLeave,onKeydown:this.onKeydown,onFocusin:this.handleFocusin,onFocusout:this.handleFocusout,onMousedown:this.handleMouseDown},g,s?ge("div",{class:`${a}-base-selection__border`}):null,s?ge("div",{class:`${a}-base-selection__state-border`}):null)}}),{cubicBezierEaseInOut:gs}=fl;function ez({duration:n=".2s",delay:e=".1s"}={}){return[tt("&.fade-in-width-expand-transition-leave-from, &.fade-in-width-expand-transition-enter-to",{opacity:1}),tt("&.fade-in-width-expand-transition-leave-to, &.fade-in-width-expand-transition-enter-from",`
 opacity: 0!important;
 margin-left: 0!important;
 margin-right: 0!important;
 `),tt("&.fade-in-width-expand-transition-leave-active",`
 overflow: hidden;
 transition:
 opacity ${n} ${gs},
 max-width ${n} ${gs} ${e},
 margin-left ${n} ${gs} ${e},
 margin-right ${n} ${gs} ${e};
 `),tt("&.fade-in-width-expand-transition-enter-active",`
 overflow: hidden;
 transition:
 opacity ${n} ${gs} ${e},
 max-width ${n} ${gs},
 margin-left ${n} ${gs},
 margin-right ${n} ${gs};
 `)]}const tz={iconMargin:"11px 8px 0 12px",iconMarginRtl:"11px 12px 0 8px",iconSize:"24px",closeIconSize:"16px",closeSize:"20px",closeMargin:"13px 14px 0 0",closeMarginRtl:"13px 0 0 14px",padding:"13px"};function nz(n){const{lineHeight:e,borderRadius:t,fontWeightStrong:r,baseColor:i,dividerColor:o,actionColor:s,textColor1:a,textColor2:l,closeColorHover:c,closeColorPressed:u,closeIconColor:d,closeIconColorHover:h,closeIconColorPressed:m,infoColor:f,successColor:v,warningColor:g,errorColor:b,fontSize:S}=n;return Object.assign(Object.assign({},tz),{fontSize:S,lineHeight:e,titleFontWeight:r,borderRadius:t,border:`1px solid ${o}`,color:s,titleTextColor:a,iconColor:l,contentTextColor:l,closeBorderRadius:t,closeColorHover:c,closeColorPressed:u,closeIconColor:d,closeIconColorHover:h,closeIconColorPressed:m,borderInfo:`1px solid ${$i(i,Nt(f,{alpha:.25}))}`,colorInfo:$i(i,Nt(f,{alpha:.08})),titleTextColorInfo:a,iconColorInfo:f,contentTextColorInfo:l,closeColorHoverInfo:c,closeColorPressedInfo:u,closeIconColorInfo:d,closeIconColorHoverInfo:h,closeIconColorPressedInfo:m,borderSuccess:`1px solid ${$i(i,Nt(v,{alpha:.25}))}`,colorSuccess:$i(i,Nt(v,{alpha:.08})),titleTextColorSuccess:a,iconColorSuccess:v,contentTextColorSuccess:l,closeColorHoverSuccess:c,closeColorPressedSuccess:u,closeIconColorSuccess:d,closeIconColorHoverSuccess:h,closeIconColorPressedSuccess:m,borderWarning:`1px solid ${$i(i,Nt(g,{alpha:.33}))}`,colorWarning:$i(i,Nt(g,{alpha:.08})),titleTextColorWarning:a,iconColorWarning:g,contentTextColorWarning:l,closeColorHoverWarning:c,closeColorPressedWarning:u,closeIconColorWarning:d,closeIconColorHoverWarning:h,closeIconColorPressedWarning:m,borderError:`1px solid ${$i(i,Nt(b,{alpha:.25}))}`,colorError:$i(i,Nt(b,{alpha:.08})),titleTextColorError:a,iconColorError:b,contentTextColorError:l,closeColorHoverError:c,closeColorPressedError:u,closeIconColorError:d,closeIconColorHoverError:h,closeIconColorPressedError:m})}const rz={name:"Alert",common:ti,self:nz},{cubicBezierEaseInOut:so,cubicBezierEaseOut:iz,cubicBezierEaseIn:oz}=fl;function sz({overflow:n="hidden",duration:e=".3s",originalTransition:t="",leavingDelay:r="0s",foldPadding:i=!1,enterToProps:o=void 0,leaveToProps:s=void 0,reverse:a=!1}={}){const l=a?"leave":"enter",c=a?"enter":"leave";return[tt(`&.fade-in-height-expand-transition-${c}-from,
 &.fade-in-height-expand-transition-${l}-to`,Object.assign(Object.assign({},o),{opacity:1})),tt(`&.fade-in-height-expand-transition-${c}-to,
 &.fade-in-height-expand-transition-${l}-from`,Object.assign(Object.assign({},s),{opacity:0,marginTop:"0 !important",marginBottom:"0 !important",paddingTop:i?"0 !important":void 0,paddingBottom:i?"0 !important":void 0})),tt(`&.fade-in-height-expand-transition-${c}-active`,`
 overflow: ${n};
 transition:
 max-height ${e} ${so} ${r},
 opacity ${e} ${iz} ${r},
 margin-top ${e} ${so} ${r},
 margin-bottom ${e} ${so} ${r},
 padding-top ${e} ${so} ${r},
 padding-bottom ${e} ${so} ${r}
 ${t?`,${t}`:""}
 `),tt(`&.fade-in-height-expand-transition-${l}-active`,`
 overflow: ${n};
 transition:
 max-height ${e} ${so},
 opacity ${e} ${oz},
 margin-top ${e} ${so},
 margin-bottom ${e} ${so},
 padding-top ${e} ${so},
 padding-bottom ${e} ${so}
 ${t?`,${t}`:""}
 `)]}const az=Ke("alert",`
 line-height: var(--n-line-height);
 border-radius: var(--n-border-radius);
 position: relative;
 transition: background-color .3s var(--n-bezier);
 background-color: var(--n-color);
 text-align: start;
 word-break: break-word;
`,[Ye("border",`
 border-radius: inherit;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 transition: border-color .3s var(--n-bezier);
 border: var(--n-border);
 pointer-events: none;
 `),pt("closable",[Ke("alert-body",[Ye("title",`
 padding-right: 24px;
 `)])]),Ye("icon",{color:"var(--n-icon-color)"}),Ke("alert-body",{padding:"var(--n-padding)"},[Ye("title",{color:"var(--n-title-text-color)"}),Ye("content",{color:"var(--n-content-text-color)"})]),sz({originalTransition:"transform .3s var(--n-bezier)",enterToProps:{transform:"scale(1)"},leaveToProps:{transform:"scale(0.9)"}}),Ye("icon",`
 position: absolute;
 left: 0;
 top: 0;
 align-items: center;
 justify-content: center;
 display: flex;
 width: var(--n-icon-size);
 height: var(--n-icon-size);
 font-size: var(--n-icon-size);
 margin: var(--n-icon-margin);
 `),Ye("close",`
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 position: absolute;
 right: 0;
 top: 0;
 margin: var(--n-close-margin);
 `),pt("show-icon",[Ke("alert-body",{paddingLeft:"calc(var(--n-icon-margin-left) + var(--n-icon-size) + var(--n-icon-margin-right))"})]),pt("right-adjust",[Ke("alert-body",{paddingRight:"calc(var(--n-close-size) + var(--n-padding) + 2px)"})]),Ke("alert-body",`
 border-radius: var(--n-border-radius);
 transition: border-color .3s var(--n-bezier);
 `,[Ye("title",`
 transition: color .3s var(--n-bezier);
 font-size: 16px;
 line-height: 19px;
 font-weight: var(--n-title-font-weight);
 `,[tt("& +",[Ye("content",{marginTop:"9px"})])]),Ye("content",{transition:"color .3s var(--n-bezier)",fontSize:"var(--n-font-size)"})]),Ye("icon",{transition:"color .3s var(--n-bezier)"})]),lz=Object.assign(Object.assign({},cn.props),{title:String,showIcon:{type:Boolean,default:!0},type:{type:String,default:"default"},bordered:{type:Boolean,default:!0},closable:Boolean,onClose:Function,onAfterLeave:Function,onAfterHide:Function}),qT=Vt({name:"Alert",inheritAttrs:!1,props:lz,setup(n){const{mergedClsPrefixRef:e,mergedBorderedRef:t,inlineThemeDisabled:r,mergedRtlRef:i}=ei(n),o=cn("Alert","-alert",az,rz,n,e),s=ra("Alert",i,e),a=rt(()=>{const{common:{cubicBezierEaseInOut:m},self:f}=o.value,{fontSize:v,borderRadius:g,titleFontWeight:b,lineHeight:S,iconSize:p,iconMargin:y,iconMarginRtl:w,closeIconSize:x,closeBorderRadius:_,closeSize:A,closeMargin:C,closeMarginRtl:T,padding:I}=f,{type:M}=n,{left:P,right:E}=Zo(y);return{"--n-bezier":m,"--n-color":f[gt("color",M)],"--n-close-icon-size":x,"--n-close-border-radius":_,"--n-close-color-hover":f[gt("closeColorHover",M)],"--n-close-color-pressed":f[gt("closeColorPressed",M)],"--n-close-icon-color":f[gt("closeIconColor",M)],"--n-close-icon-color-hover":f[gt("closeIconColorHover",M)],"--n-close-icon-color-pressed":f[gt("closeIconColorPressed",M)],"--n-icon-color":f[gt("iconColor",M)],"--n-border":f[gt("border",M)],"--n-title-text-color":f[gt("titleTextColor",M)],"--n-content-text-color":f[gt("contentTextColor",M)],"--n-line-height":S,"--n-border-radius":g,"--n-font-size":v,"--n-title-font-weight":b,"--n-icon-size":p,"--n-icon-margin":y,"--n-icon-margin-rtl":w,"--n-close-size":A,"--n-close-margin":C,"--n-close-margin-rtl":T,"--n-padding":I,"--n-icon-margin-left":P,"--n-icon-margin-right":E}}),l=r?Qr("alert",rt(()=>n.type[0]),a,n):void 0,c=Je(!0),u=()=>{const{onAfterLeave:m,onAfterHide:f}=n;m&&m(),f&&f()};return{rtlEnabled:s,mergedClsPrefix:e,mergedBordered:t,visible:c,handleCloseClick:()=>{var m;Promise.resolve((m=n.onClose)===null||m===void 0?void 0:m.call(n)).then(f=>{f!==!1&&(c.value=!1)})},handleAfterLeave:()=>{u()},mergedTheme:o,cssVars:r?void 0:a,themeClass:l==null?void 0:l.themeClass,onRender:l==null?void 0:l.onRender}},render(){var n;return(n=this.onRender)===null||n===void 0||n.call(this),ge(OT,{onAfterLeave:this.handleAfterLeave},{default:()=>{const{mergedClsPrefix:e,$slots:t}=this,r={class:[`${e}-alert`,this.themeClass,this.closable&&`${e}-alert--closable`,this.showIcon&&`${e}-alert--show-icon`,!this.title&&this.closable&&`${e}-alert--right-adjust`,this.rtlEnabled&&`${e}-alert--rtl`],style:this.cssVars,role:"alert"};return this.visible?ge("div",Object.assign({},Dc(this.$attrs,r)),this.closable&&ge(kT,{clsPrefix:e,class:`${e}-alert__close`,onClick:this.handleCloseClick}),this.bordered&&ge("div",{class:`${e}-alert__border`}),this.showIcon&&ge("div",{class:`${e}-alert__icon`,"aria-hidden":"true"},Ki(t.icon,()=>[ge(Ji,{clsPrefix:e},{default:()=>{switch(this.type){case"success":return ge(RN,null);case"info":return ge(EN,null);case"warning":return ge(IN,null);case"error":return ge(TN,null);default:return null}}})])),ge("div",{class:[`${e}-alert-body`,this.mergedBordered&&`${e}-alert-body--bordered`]},vr(t.header,i=>{const o=i||this.title;return o?ge("div",{class:`${e}-alert-body__title`},o):null}),t.default&&ge("div",{class:`${e}-alert-body__content`},t))):null}})}});function ap(n){return n.type==="group"}function XT(n){return n.type==="ignored"}function fg(n,e){try{return!!(1+e.toString().toLowerCase().indexOf(n.trim().toLowerCase()))}catch{return!1}}function cz(n,e){return{getIsGroup:ap,getIgnored:XT,getKey(r){return ap(r)?r.name||r.key||"key-required":r[n]},getChildren(r){return r[e]}}}function uz(n,e,t,r){if(!e)return n;function i(o){if(!Array.isArray(o))return[];const s=[];for(const a of o)if(ap(a)){const l=i(a[r]);l.length&&s.push(Object.assign({},a,{[r]:l}))}else{if(XT(a))continue;e(t,a)&&s.push(a)}return s}return i(n)}function dz(n,e,t){const r=new Map;return n.forEach(i=>{ap(i)?i[t].forEach(o=>{r.set(o[e],o)}):r.set(i[e],i)}),r}const hz=em&&"chrome"in window;em&&navigator.userAgent.includes("Firefox");const YT=em&&navigator.userAgent.includes("Safari")&&!hz,fz={paddingTiny:"0 8px",paddingSmall:"0 10px",paddingMedium:"0 12px",paddingLarge:"0 14px",clearSize:"16px"};function pz(n){const{textColor2:e,textColor3:t,textColorDisabled:r,primaryColor:i,primaryColorHover:o,inputColor:s,inputColorDisabled:a,borderColor:l,warningColor:c,warningColorHover:u,errorColor:d,errorColorHover:h,borderRadius:m,lineHeight:f,fontSizeTiny:v,fontSizeSmall:g,fontSizeMedium:b,fontSizeLarge:S,heightTiny:p,heightSmall:y,heightMedium:w,heightLarge:x,actionColor:_,clearColor:A,clearColorHover:C,clearColorPressed:T,placeholderColor:I,placeholderColorDisabled:M,iconColor:P,iconColorDisabled:E,iconColorHover:R,iconColorPressed:B}=n;return Object.assign(Object.assign({},fz),{countTextColorDisabled:r,countTextColor:t,heightTiny:p,heightSmall:y,heightMedium:w,heightLarge:x,fontSizeTiny:v,fontSizeSmall:g,fontSizeMedium:b,fontSizeLarge:S,lineHeight:f,lineHeightTextarea:f,borderRadius:m,iconSize:"16px",groupLabelColor:_,groupLabelTextColor:e,textColor:e,textColorDisabled:r,textDecorationColor:e,caretColor:i,placeholderColor:I,placeholderColorDisabled:M,color:s,colorDisabled:a,colorFocus:s,groupLabelBorder:`1px solid ${l}`,border:`1px solid ${l}`,borderHover:`1px solid ${o}`,borderDisabled:`1px solid ${l}`,borderFocus:`1px solid ${o}`,boxShadowFocus:`0 0 0 2px ${Nt(i,{alpha:.2})}`,loadingColor:i,loadingColorWarning:c,borderWarning:`1px solid ${c}`,borderHoverWarning:`1px solid ${u}`,colorFocusWarning:s,borderFocusWarning:`1px solid ${u}`,boxShadowFocusWarning:`0 0 0 2px ${Nt(c,{alpha:.2})}`,caretColorWarning:c,loadingColorError:d,borderError:`1px solid ${d}`,borderHoverError:`1px solid ${h}`,colorFocusError:s,borderFocusError:`1px solid ${h}`,boxShadowFocusError:`0 0 0 2px ${Nt(d,{alpha:.2})}`,caretColorError:d,clearColor:A,clearColorHover:C,clearColorPressed:T,iconColor:P,iconColorDisabled:E,iconColorHover:R,iconColorPressed:B,suffixTextColor:e})}const KT={name:"Input",common:ti,self:pz},ZT="n-input";function mz(n){let e=0;for(const t of n)e++;return e}function fh(n){return n===""||n==null}function gz(n){const e=Je(null);function t(){const{value:o}=n;if(!(o!=null&&o.focus)){i();return}const{selectionStart:s,selectionEnd:a,value:l}=o;if(s==null||a==null){i();return}e.value={start:s,end:a,beforeText:l.slice(0,s),afterText:l.slice(a)}}function r(){var o;const{value:s}=e,{value:a}=n;if(!s||!a)return;const{value:l}=a,{start:c,beforeText:u,afterText:d}=s;let h=l.length;if(l.endsWith(d))h=l.length-d.length;else if(l.startsWith(u))h=u.length;else{const m=u[c-1],f=l.indexOf(m,c-1);f!==-1&&(h=f+1)}(o=a.setSelectionRange)===null||o===void 0||o.call(a,h,h)}function i(){e.value=null}return bn(n,i),{recordCursor:t,restoreCursor:r}}const Sx=Vt({name:"InputWordCount",setup(n,{slots:e}){const{mergedValueRef:t,maxlengthRef:r,mergedClsPrefixRef:i,countGraphemesRef:o}=vn(ZT),s=rt(()=>{const{value:a}=t;return a===null||Array.isArray(a)?0:(o.value||mz)(a)});return()=>{const{value:a}=r,{value:l}=t;return ge("span",{class:`${i.value}-input-word-count`},k4(e.default,{value:l===null||Array.isArray(l)?"":l},()=>[a===void 0?s.value:`${s.value} / ${a}`]))}}}),vz=Ke("input",`
 max-width: 100%;
 cursor: text;
 line-height: 1.5;
 z-index: auto;
 outline: none;
 box-sizing: border-box;
 position: relative;
 display: inline-flex;
 border-radius: var(--n-border-radius);
 background-color: var(--n-color);
 transition: background-color .3s var(--n-bezier);
 font-size: var(--n-font-size);
 --n-padding-vertical: calc((var(--n-height) - 1.5 * var(--n-font-size)) / 2);
`,[Ye("input, textarea",`
 overflow: hidden;
 flex-grow: 1;
 position: relative;
 `),Ye("input-el, textarea-el, input-mirror, textarea-mirror, separator, placeholder",`
 box-sizing: border-box;
 font-size: inherit;
 line-height: 1.5;
 font-family: inherit;
 border: none;
 outline: none;
 background-color: #0000;
 text-align: inherit;
 transition:
 -webkit-text-fill-color .3s var(--n-bezier),
 caret-color .3s var(--n-bezier),
 color .3s var(--n-bezier),
 text-decoration-color .3s var(--n-bezier);
 `),Ye("input-el, textarea-el",`
 -webkit-appearance: none;
 scrollbar-width: none;
 width: 100%;
 min-width: 0;
 text-decoration-color: var(--n-text-decoration-color);
 color: var(--n-text-color);
 caret-color: var(--n-caret-color);
 background-color: transparent;
 `,[tt("&::-webkit-scrollbar, &::-webkit-scrollbar-track-piece, &::-webkit-scrollbar-thumb",`
 width: 0;
 height: 0;
 display: none;
 `),tt("&::placeholder",`
 color: #0000;
 -webkit-text-fill-color: transparent !important;
 `),tt("&:-webkit-autofill ~",[Ye("placeholder","display: none;")])]),pt("round",[ar("textarea","border-radius: calc(var(--n-height) / 2);")]),Ye("placeholder",`
 pointer-events: none;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 overflow: hidden;
 color: var(--n-placeholder-color);
 `,[tt("span",`
 width: 100%;
 display: inline-block;
 `)]),pt("textarea",[Ye("placeholder","overflow: visible;")]),ar("autosize","width: 100%;"),pt("autosize",[Ye("textarea-el, input-el",`
 position: absolute;
 top: 0;
 left: 0;
 height: 100%;
 `)]),Ke("input-wrapper",`
 overflow: hidden;
 display: inline-flex;
 flex-grow: 1;
 position: relative;
 padding-left: var(--n-padding-left);
 padding-right: var(--n-padding-right);
 `),Ye("input-mirror",`
 padding: 0;
 height: var(--n-height);
 line-height: var(--n-height);
 overflow: hidden;
 visibility: hidden;
 position: static;
 white-space: pre;
 pointer-events: none;
 `),Ye("input-el",`
 padding: 0;
 height: var(--n-height);
 line-height: var(--n-height);
 `,[tt("&[type=password]::-ms-reveal","display: none;"),tt("+",[Ye("placeholder",`
 display: flex;
 align-items: center; 
 `)])]),ar("textarea",[Ye("placeholder","white-space: nowrap;")]),Ye("eye",`
 display: flex;
 align-items: center;
 justify-content: center;
 transition: color .3s var(--n-bezier);
 `),pt("textarea","width: 100%;",[Ke("input-word-count",`
 position: absolute;
 right: var(--n-padding-right);
 bottom: var(--n-padding-vertical);
 `),pt("resizable",[Ke("input-wrapper",`
 resize: vertical;
 min-height: var(--n-height);
 `)]),Ye("textarea-el, textarea-mirror, placeholder",`
 height: 100%;
 padding-left: 0;
 padding-right: 0;
 padding-top: var(--n-padding-vertical);
 padding-bottom: var(--n-padding-vertical);
 word-break: break-word;
 display: inline-block;
 vertical-align: bottom;
 box-sizing: border-box;
 line-height: var(--n-line-height-textarea);
 margin: 0;
 resize: none;
 white-space: pre-wrap;
 scroll-padding-block-end: var(--n-padding-vertical);
 `),Ye("textarea-mirror",`
 width: 100%;
 pointer-events: none;
 overflow: hidden;
 visibility: hidden;
 position: static;
 white-space: pre-wrap;
 overflow-wrap: break-word;
 `)]),pt("pair",[Ye("input-el, placeholder","text-align: center;"),Ye("separator",`
 display: flex;
 align-items: center;
 transition: color .3s var(--n-bezier);
 color: var(--n-text-color);
 white-space: nowrap;
 `,[Ke("icon",`
 color: var(--n-icon-color);
 `),Ke("base-icon",`
 color: var(--n-icon-color);
 `)])]),pt("disabled",`
 cursor: not-allowed;
 background-color: var(--n-color-disabled);
 `,[Ye("border","border: var(--n-border-disabled);"),Ye("input-el, textarea-el",`
 cursor: not-allowed;
 color: var(--n-text-color-disabled);
 text-decoration-color: var(--n-text-color-disabled);
 `),Ye("placeholder","color: var(--n-placeholder-color-disabled);"),Ye("separator","color: var(--n-text-color-disabled);",[Ke("icon",`
 color: var(--n-icon-color-disabled);
 `),Ke("base-icon",`
 color: var(--n-icon-color-disabled);
 `)]),Ke("input-word-count",`
 color: var(--n-count-text-color-disabled);
 `),Ye("suffix, prefix","color: var(--n-text-color-disabled);",[Ke("icon",`
 color: var(--n-icon-color-disabled);
 `),Ke("internal-icon",`
 color: var(--n-icon-color-disabled);
 `)])]),ar("disabled",[Ye("eye",`
 color: var(--n-icon-color);
 cursor: pointer;
 `,[tt("&:hover",`
 color: var(--n-icon-color-hover);
 `),tt("&:active",`
 color: var(--n-icon-color-pressed);
 `)]),tt("&:hover",[Ye("state-border","border: var(--n-border-hover);")]),pt("focus","background-color: var(--n-color-focus);",[Ye("state-border",`
 border: var(--n-border-focus);
 box-shadow: var(--n-box-shadow-focus);
 `)])]),Ye("border, state-border",`
 box-sizing: border-box;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 pointer-events: none;
 border-radius: inherit;
 border: var(--n-border);
 transition:
 box-shadow .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `),Ye("state-border",`
 border-color: #0000;
 z-index: 1;
 `),Ye("prefix","margin-right: 4px;"),Ye("suffix",`
 margin-left: 4px;
 `),Ye("suffix, prefix",`
 transition: color .3s var(--n-bezier);
 flex-wrap: nowrap;
 flex-shrink: 0;
 line-height: var(--n-height);
 white-space: nowrap;
 display: inline-flex;
 align-items: center;
 justify-content: center;
 color: var(--n-suffix-text-color);
 `,[Ke("base-loading",`
 font-size: var(--n-icon-size);
 margin: 0 2px;
 color: var(--n-loading-color);
 `),Ke("base-clear",`
 font-size: var(--n-icon-size);
 `,[Ye("placeholder",[Ke("base-icon",`
 transition: color .3s var(--n-bezier);
 color: var(--n-icon-color);
 font-size: var(--n-icon-size);
 `)])]),tt(">",[Ke("icon",`
 transition: color .3s var(--n-bezier);
 color: var(--n-icon-color);
 font-size: var(--n-icon-size);
 `)]),Ke("base-icon",`
 font-size: var(--n-icon-size);
 `)]),Ke("input-word-count",`
 pointer-events: none;
 line-height: 1.5;
 font-size: .85em;
 color: var(--n-count-text-color);
 transition: color .3s var(--n-bezier);
 margin-left: 4px;
 font-variant: tabular-nums;
 `),["warning","error"].map(n=>pt(`${n}-status`,[ar("disabled",[Ke("base-loading",`
 color: var(--n-loading-color-${n})
 `),Ye("input-el, textarea-el",`
 caret-color: var(--n-caret-color-${n});
 `),Ye("state-border",`
 border: var(--n-border-${n});
 `),tt("&:hover",[Ye("state-border",`
 border: var(--n-border-hover-${n});
 `)]),tt("&:focus",`
 background-color: var(--n-color-focus-${n});
 `,[Ye("state-border",`
 box-shadow: var(--n-box-shadow-focus-${n});
 border: var(--n-border-focus-${n});
 `)]),pt("focus",`
 background-color: var(--n-color-focus-${n});
 `,[Ye("state-border",`
 box-shadow: var(--n-box-shadow-focus-${n});
 border: var(--n-border-focus-${n});
 `)])])]))]),bz=Ke("input",[pt("disabled",[Ye("input-el, textarea-el",`
 -webkit-text-fill-color: var(--n-text-color-disabled);
 `)])]),yz=Object.assign(Object.assign({},cn.props),{bordered:{type:Boolean,default:void 0},type:{type:String,default:"text"},placeholder:[Array,String],defaultValue:{type:[String,Array],default:null},value:[String,Array],disabled:{type:Boolean,default:void 0},size:String,rows:{type:[Number,String],default:3},round:Boolean,minlength:[String,Number],maxlength:[String,Number],clearable:Boolean,autosize:{type:[Boolean,Object],default:!1},pair:Boolean,separator:String,readonly:{type:[String,Boolean],default:!1},passivelyActivated:Boolean,showPasswordOn:String,stateful:{type:Boolean,default:!0},autofocus:Boolean,inputProps:Object,resizable:{type:Boolean,default:!0},showCount:Boolean,loading:{type:Boolean,default:void 0},allowInput:Function,renderCount:Function,onMousedown:Function,onKeydown:Function,onKeyup:[Function,Array],onInput:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onClick:[Function,Array],onChange:[Function,Array],onClear:[Function,Array],countGraphemes:Function,status:String,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],textDecoration:[String,Array],attrSize:{type:Number,default:20},onInputBlur:[Function,Array],onInputFocus:[Function,Array],onDeactivate:[Function,Array],onActivate:[Function,Array],onWrapperFocus:[Function,Array],onWrapperBlur:[Function,Array],internalDeactivateOnEnter:Boolean,internalForceFocus:Boolean,internalLoadingBeforeSuffix:{type:Boolean,default:!0},showPasswordToggle:Boolean}),_z=Vt({name:"Input",props:yz,setup(n){const{mergedClsPrefixRef:e,mergedBorderedRef:t,inlineThemeDisabled:r,mergedRtlRef:i}=ei(n),o=cn("Input","-input",vz,KT,n,e);YT&&Nc("-input-safari",bz,e);const s=Je(null),a=Je(null),l=Je(null),c=Je(null),u=Je(null),d=Je(null),h=Je(null),m=gz(h),f=Je(null),{localeRef:v}=im("Input"),g=Je(n.defaultValue),b=Jt(n,"value"),S=el(b,g),p=Ld(n),{mergedSizeRef:y,mergedDisabledRef:w,mergedStatusRef:x}=p,_=Je(!1),A=Je(!1),C=Je(!1),T=Je(!1);let I=null;const M=rt(()=>{const{placeholder:G,pair:ae}=n;return ae?Array.isArray(G)?G:G===void 0?["",""]:[G,G]:G===void 0?[v.value.placeholder]:[G]}),P=rt(()=>{const{value:G}=C,{value:ae}=S,{value:we}=M;return!G&&(fh(ae)||Array.isArray(ae)&&fh(ae[0]))&&we[0]}),E=rt(()=>{const{value:G}=C,{value:ae}=S,{value:we}=M;return!G&&we[1]&&(fh(ae)||Array.isArray(ae)&&fh(ae[1]))}),R=er(()=>n.internalForceFocus||_.value),B=er(()=>{if(w.value||n.readonly||!n.clearable||!R.value&&!A.value)return!1;const{value:G}=S,{value:ae}=R;return n.pair?!!(Array.isArray(G)&&(G[0]||G[1]))&&(A.value||ae):!!G&&(A.value||ae)}),L=rt(()=>{const{showPasswordOn:G}=n;if(G)return G;if(n.showPasswordToggle)return"click"}),F=Je(!1),H=rt(()=>{const{textDecoration:G}=n;return G?Array.isArray(G)?G.map(ae=>({textDecoration:ae})):[{textDecoration:G}]:["",""]}),$=Je(void 0),O=()=>{var G,ae;if(n.type==="textarea"){const{autosize:we}=n;if(we&&($.value=(ae=(G=f.value)===null||G===void 0?void 0:G.$el)===null||ae===void 0?void 0:ae.offsetWidth),!a.value||typeof we=="boolean")return;const{paddingTop:He,paddingBottom:qe,lineHeight:Qe}=window.getComputedStyle(a.value),vt=Number(He.slice(0,-2)),ot=Number(qe.slice(0,-2)),et=Number(Qe.slice(0,-2)),{value:J}=l;if(!J)return;if(we.minRows){const Pe=Math.max(we.minRows,1),Oe=`${vt+ot+et*Pe}px`;J.style.minHeight=Oe}if(we.maxRows){const Pe=`${vt+ot+et*we.maxRows}px`;J.style.maxHeight=Pe}}},k=rt(()=>{const{maxlength:G}=n;return G===void 0?void 0:Number(G)});Er(()=>{const{value:G}=S;Array.isArray(G)||Ee(G)});const X=Td().proxy;function ie(G,ae){const{onUpdateValue:we,"onUpdate:value":He,onInput:qe}=n,{nTriggerFormInput:Qe}=p;we&&zt(we,G,ae),He&&zt(He,G,ae),qe&&zt(qe,G,ae),g.value=G,Qe()}function ne(G,ae){const{onChange:we}=n,{nTriggerFormChange:He}=p;we&&zt(we,G,ae),g.value=G,He()}function Q(G){const{onBlur:ae}=n,{nTriggerFormBlur:we}=p;ae&&zt(ae,G),we()}function ce(G){const{onFocus:ae}=n,{nTriggerFormFocus:we}=p;ae&&zt(ae,G),we()}function Z(G){const{onClear:ae}=n;ae&&zt(ae,G)}function re(G){const{onInputBlur:ae}=n;ae&&zt(ae,G)}function se(G){const{onInputFocus:ae}=n;ae&&zt(ae,G)}function fe(){const{onDeactivate:G}=n;G&&zt(G)}function ue(){const{onActivate:G}=n;G&&zt(G)}function U(G){const{onClick:ae}=n;ae&&zt(ae,G)}function K(G){const{onWrapperFocus:ae}=n;ae&&zt(ae,G)}function be(G){const{onWrapperBlur:ae}=n;ae&&zt(ae,G)}function me(){C.value=!0}function le(G){C.value=!1,G.target===d.value?xe(G,1):xe(G,0)}function xe(G,ae=0,we="input"){const He=G.target.value;if(Ee(He),G instanceof InputEvent&&!G.isComposing&&(C.value=!1),n.type==="textarea"){const{value:Qe}=f;Qe&&Qe.syncUnifiedContainer()}if(I=He,C.value)return;m.recordCursor();const qe=pe(He);if(qe)if(!n.pair)we==="input"?ie(He,{source:ae}):ne(He,{source:ae});else{let{value:Qe}=S;Array.isArray(Qe)?Qe=[Qe[0],Qe[1]]:Qe=["",""],Qe[ae]=He,we==="input"?ie(Qe,{source:ae}):ne(Qe,{source:ae})}X.$forceUpdate(),qe||ui(m.restoreCursor)}function pe(G){const{countGraphemes:ae,maxlength:we,minlength:He}=n;if(ae){let Qe;if(we!==void 0&&(Qe===void 0&&(Qe=ae(G)),Qe>Number(we))||He!==void 0&&(Qe===void 0&&(Qe=ae(G)),Qe<Number(we)))return!1}const{allowInput:qe}=n;return typeof qe=="function"?qe(G):!0}function ye(G){re(G),G.relatedTarget===s.value&&fe(),G.relatedTarget!==null&&(G.relatedTarget===u.value||G.relatedTarget===d.value||G.relatedTarget===a.value)||(T.value=!1),D(G,"blur"),h.value=null}function Me(G,ae){se(G),_.value=!0,T.value=!0,ue(),D(G,"focus"),ae===0?h.value=u.value:ae===1?h.value=d.value:ae===2&&(h.value=a.value)}function Ce(G){n.passivelyActivated&&(be(G),D(G,"blur"))}function z(G){n.passivelyActivated&&(_.value=!0,K(G),D(G,"focus"))}function D(G,ae){G.relatedTarget!==null&&(G.relatedTarget===u.value||G.relatedTarget===d.value||G.relatedTarget===a.value||G.relatedTarget===s.value)||(ae==="focus"?(ce(G),_.value=!0):ae==="blur"&&(Q(G),_.value=!1))}function q(G,ae){xe(G,ae,"change")}function _e(G){U(G)}function ve(G){Z(G),Re()}function Re(){n.pair?(ie(["",""],{source:"clear"}),ne(["",""],{source:"clear"})):(ie("",{source:"clear"}),ne("",{source:"clear"}))}function ze(G){const{onMousedown:ae}=n;ae&&ae(G);const{tagName:we}=G.target;if(we!=="INPUT"&&we!=="TEXTAREA"){if(n.resizable){const{value:He}=s;if(He){const{left:qe,top:Qe,width:vt,height:ot}=He.getBoundingClientRect(),et=14;if(qe+vt-et<G.clientX&&G.clientX<qe+vt&&Qe+ot-et<G.clientY&&G.clientY<Qe+ot)return}}G.preventDefault(),_.value||Fe()}}function Le(){var G;A.value=!0,n.type==="textarea"&&((G=f.value)===null||G===void 0||G.handleMouseEnterWrapper())}function Ve(){var G;A.value=!1,n.type==="textarea"&&((G=f.value)===null||G===void 0||G.handleMouseLeaveWrapper())}function Ze(){w.value||L.value==="click"&&(F.value=!F.value)}function ut(G){if(w.value)return;G.preventDefault();const ae=He=>{He.preventDefault(),Tn("mouseup",document,ae)};if(Bn("mouseup",document,ae),L.value!=="mousedown")return;F.value=!0;const we=()=>{F.value=!1,Tn("mouseup",document,we)};Bn("mouseup",document,we)}function Ne(G){n.onKeyup&&zt(n.onKeyup,G)}function ct(G){switch(n.onKeydown&&zt(n.onKeydown,G),G.key){case"Escape":Ae();break;case"Enter":he(G);break}}function he(G){var ae,we;if(n.passivelyActivated){const{value:He}=T;if(He){n.internalDeactivateOnEnter&&Ae();return}G.preventDefault(),n.type==="textarea"?(ae=a.value)===null||ae===void 0||ae.focus():(we=u.value)===null||we===void 0||we.focus()}}function Ae(){n.passivelyActivated&&(T.value=!1,ui(()=>{var G;(G=s.value)===null||G===void 0||G.focus()}))}function Fe(){var G,ae,we;w.value||(n.passivelyActivated?(G=s.value)===null||G===void 0||G.focus():((ae=a.value)===null||ae===void 0||ae.focus(),(we=u.value)===null||we===void 0||we.focus()))}function ke(){var G;!((G=s.value)===null||G===void 0)&&G.contains(document.activeElement)&&document.activeElement.blur()}function We(){var G,ae;(G=a.value)===null||G===void 0||G.select(),(ae=u.value)===null||ae===void 0||ae.select()}function ee(){w.value||(a.value?a.value.focus():u.value&&u.value.focus())}function Ie(){const{value:G}=s;G!=null&&G.contains(document.activeElement)&&G!==document.activeElement&&Ae()}function Se(G){if(n.type==="textarea"){const{value:ae}=a;ae==null||ae.scrollTo(G)}else{const{value:ae}=u;ae==null||ae.scrollTo(G)}}function Ee(G){const{type:ae,pair:we,autosize:He}=n;if(!we&&He)if(ae==="textarea"){const{value:qe}=l;qe&&(qe.textContent=`${G??""}\r
`)}else{const{value:qe}=c;qe&&(G?qe.textContent=G:qe.innerHTML="&nbsp;")}}function Ge(){O()}const ft=Je({top:"0"});function Rt(G){var ae;const{scrollTop:we}=G.target;ft.value.top=`${-we}px`,(ae=f.value)===null||ae===void 0||ae.syncUnifiedContainer()}let St=null;Ws(()=>{const{autosize:G,type:ae}=n;G&&ae==="textarea"?St=bn(S,we=>{!Array.isArray(we)&&we!==I&&Ee(we)}):St==null||St()});let N=null;Ws(()=>{n.type==="textarea"?N=bn(S,G=>{var ae;!Array.isArray(G)&&G!==I&&((ae=f.value)===null||ae===void 0||ae.syncUnifiedContainer())}):N==null||N()}),Xi(ZT,{mergedValueRef:S,maxlengthRef:k,mergedClsPrefixRef:e,countGraphemesRef:Jt(n,"countGraphemes")});const j={wrapperElRef:s,inputElRef:u,textareaElRef:a,isCompositing:C,clear:Re,focus:Fe,blur:ke,select:We,deactivate:Ie,activate:ee,scrollTo:Se},Y=ra("Input",i,e),oe=rt(()=>{const{value:G}=y,{common:{cubicBezierEaseInOut:ae},self:{color:we,borderRadius:He,textColor:qe,caretColor:Qe,caretColorError:vt,caretColorWarning:ot,textDecorationColor:et,border:J,borderDisabled:Pe,borderHover:Oe,borderFocus:De,placeholderColor:$e,placeholderColorDisabled:it,lineHeightTextarea:mt,colorDisabled:bt,colorFocus:lt,textColorDisabled:Ue,boxShadowFocus:nt,iconSize:dt,colorFocusWarning:Ct,boxShadowFocusWarning:yt,borderWarning:At,borderFocusWarning:Dt,borderHoverWarning:Tt,colorFocusError:Mt,boxShadowFocusError:kt,borderError:$t,borderFocusError:Ur,borderHoverError:Pi,clearSize:Ri,clearColor:Ii,clearColorHover:Fn,clearColorPressed:Pr,iconColor:Di,iconColorDisabled:Hn,suffixTextColor:Li,countTextColor:yl,countTextColorDisabled:to,iconColorHover:aa,iconColorPressed:la,loadingColor:ca,loadingColorError:ua,loadingColorWarning:da,[gt("padding",G)]:ha,[gt("fontSize",G)]:fa,[gt("height",G)]:pa}}=o.value,{left:no,right:_l}=Zo(ha);return{"--n-bezier":ae,"--n-count-text-color":yl,"--n-count-text-color-disabled":to,"--n-color":we,"--n-font-size":fa,"--n-border-radius":He,"--n-height":pa,"--n-padding-left":no,"--n-padding-right":_l,"--n-text-color":qe,"--n-caret-color":Qe,"--n-text-decoration-color":et,"--n-border":J,"--n-border-disabled":Pe,"--n-border-hover":Oe,"--n-border-focus":De,"--n-placeholder-color":$e,"--n-placeholder-color-disabled":it,"--n-icon-size":dt,"--n-line-height-textarea":mt,"--n-color-disabled":bt,"--n-color-focus":lt,"--n-text-color-disabled":Ue,"--n-box-shadow-focus":nt,"--n-loading-color":ca,"--n-caret-color-warning":ot,"--n-color-focus-warning":Ct,"--n-box-shadow-focus-warning":yt,"--n-border-warning":At,"--n-border-focus-warning":Dt,"--n-border-hover-warning":Tt,"--n-loading-color-warning":da,"--n-caret-color-error":vt,"--n-color-focus-error":Mt,"--n-box-shadow-focus-error":kt,"--n-border-error":$t,"--n-border-focus-error":Ur,"--n-border-hover-error":Pi,"--n-loading-color-error":ua,"--n-clear-color":Ii,"--n-clear-size":Ri,"--n-clear-color-hover":Fn,"--n-clear-color-pressed":Pr,"--n-icon-color":Di,"--n-icon-color-hover":aa,"--n-icon-color-pressed":la,"--n-icon-color-disabled":Hn,"--n-suffix-text-color":Li}}),de=r?Qr("input",rt(()=>{const{value:G}=y;return G[0]}),oe,n):void 0;return Object.assign(Object.assign({},j),{wrapperElRef:s,inputElRef:u,inputMirrorElRef:c,inputEl2Ref:d,textareaElRef:a,textareaMirrorElRef:l,textareaScrollbarInstRef:f,rtlEnabled:Y,uncontrolledValue:g,mergedValue:S,passwordVisible:F,mergedPlaceholder:M,showPlaceholder1:P,showPlaceholder2:E,mergedFocus:R,isComposing:C,activated:T,showClearButton:B,mergedSize:y,mergedDisabled:w,textDecorationStyle:H,mergedClsPrefix:e,mergedBordered:t,mergedShowPasswordOn:L,placeholderStyle:ft,mergedStatus:x,textAreaScrollContainerWidth:$,handleTextAreaScroll:Rt,handleCompositionStart:me,handleCompositionEnd:le,handleInput:xe,handleInputBlur:ye,handleInputFocus:Me,handleWrapperBlur:Ce,handleWrapperFocus:z,handleMouseEnter:Le,handleMouseLeave:Ve,handleMouseDown:ze,handleChange:q,handleClick:_e,handleClear:ve,handlePasswordToggleClick:Ze,handlePasswordToggleMousedown:ut,handleWrapperKeydown:ct,handleWrapperKeyup:Ne,handleTextAreaMirrorResize:Ge,getTextareaScrollContainer:()=>a.value,mergedTheme:o,cssVars:r?void 0:oe,themeClass:de==null?void 0:de.themeClass,onRender:de==null?void 0:de.onRender})},render(){var n,e;const{mergedClsPrefix:t,mergedStatus:r,themeClass:i,type:o,countGraphemes:s,onRender:a}=this,l=this.$slots;return a==null||a(),ge("div",{ref:"wrapperElRef",class:[`${t}-input`,i,r&&`${t}-input--${r}-status`,{[`${t}-input--rtl`]:this.rtlEnabled,[`${t}-input--disabled`]:this.mergedDisabled,[`${t}-input--textarea`]:o==="textarea",[`${t}-input--resizable`]:this.resizable&&!this.autosize,[`${t}-input--autosize`]:this.autosize,[`${t}-input--round`]:this.round&&o!=="textarea",[`${t}-input--pair`]:this.pair,[`${t}-input--focus`]:this.mergedFocus,[`${t}-input--stateful`]:this.stateful}],style:this.cssVars,tabindex:!this.mergedDisabled&&this.passivelyActivated&&!this.activated?0:void 0,onFocus:this.handleWrapperFocus,onBlur:this.handleWrapperBlur,onClick:this.handleClick,onMousedown:this.handleMouseDown,onMouseenter:this.handleMouseEnter,onMouseleave:this.handleMouseLeave,onCompositionstart:this.handleCompositionStart,onCompositionend:this.handleCompositionEnd,onKeyup:this.handleWrapperKeyup,onKeydown:this.handleWrapperKeydown},ge("div",{class:`${t}-input-wrapper`},vr(l.prefix,c=>c&&ge("div",{class:`${t}-input__prefix`},c)),o==="textarea"?ge(Fb,{ref:"textareaScrollbarInstRef",class:`${t}-input__textarea`,container:this.getTextareaScrollContainer,triggerDisplayManually:!0,useUnifiedContainer:!0,internalHoistYRail:!0},{default:()=>{var c,u;const{textAreaScrollContainerWidth:d}=this,h={width:this.autosize&&d&&`${d}px`};return ge($n,null,ge("textarea",Object.assign({},this.inputProps,{ref:"textareaElRef",class:[`${t}-input__textarea-el`,(c=this.inputProps)===null||c===void 0?void 0:c.class],autofocus:this.autofocus,rows:Number(this.rows),placeholder:this.placeholder,value:this.mergedValue,disabled:this.mergedDisabled,maxlength:s?void 0:this.maxlength,minlength:s?void 0:this.minlength,readonly:this.readonly,tabindex:this.passivelyActivated&&!this.activated?-1:void 0,style:[this.textDecorationStyle[0],(u=this.inputProps)===null||u===void 0?void 0:u.style,h],onBlur:this.handleInputBlur,onFocus:m=>{this.handleInputFocus(m,2)},onInput:this.handleInput,onChange:this.handleChange,onScroll:this.handleTextAreaScroll})),this.showPlaceholder1?ge("div",{class:`${t}-input__placeholder`,style:[this.placeholderStyle,h],key:"placeholder"},this.mergedPlaceholder[0]):null,this.autosize?ge(dd,{onResize:this.handleTextAreaMirrorResize},{default:()=>ge("div",{ref:"textareaMirrorElRef",class:`${t}-input__textarea-mirror`,key:"mirror"})}):null)}}):ge("div",{class:`${t}-input__input`},ge("input",Object.assign({type:o==="password"&&this.mergedShowPasswordOn&&this.passwordVisible?"text":o},this.inputProps,{ref:"inputElRef",class:[`${t}-input__input-el`,(n=this.inputProps)===null||n===void 0?void 0:n.class],style:[this.textDecorationStyle[0],(e=this.inputProps)===null||e===void 0?void 0:e.style],tabindex:this.passivelyActivated&&!this.activated?-1:void 0,placeholder:this.mergedPlaceholder[0],disabled:this.mergedDisabled,maxlength:s?void 0:this.maxlength,minlength:s?void 0:this.minlength,value:Array.isArray(this.mergedValue)?this.mergedValue[0]:this.mergedValue,readonly:this.readonly,autofocus:this.autofocus,size:this.attrSize,onBlur:this.handleInputBlur,onFocus:c=>{this.handleInputFocus(c,0)},onInput:c=>{this.handleInput(c,0)},onChange:c=>{this.handleChange(c,0)}})),this.showPlaceholder1?ge("div",{class:`${t}-input__placeholder`},ge("span",null,this.mergedPlaceholder[0])):null,this.autosize?ge("div",{class:`${t}-input__input-mirror`,key:"mirror",ref:"inputMirrorElRef"}," "):null),!this.pair&&vr(l.suffix,c=>c||this.clearable||this.showCount||this.mergedShowPasswordOn||this.loading!==void 0?ge("div",{class:`${t}-input__suffix`},[vr(l["clear-icon-placeholder"],u=>(this.clearable||u)&&ge(H1,{clsPrefix:t,show:this.showClearButton,onClear:this.handleClear},{placeholder:()=>u,icon:()=>{var d,h;return(h=(d=this.$slots)["clear-icon"])===null||h===void 0?void 0:h.call(d)}})),this.internalLoadingBeforeSuffix?null:c,this.loading!==void 0?ge(WT,{clsPrefix:t,loading:this.loading,showArrow:!1,showClear:!1,style:this.cssVars}):null,this.internalLoadingBeforeSuffix?c:null,this.showCount&&this.type!=="textarea"?ge(Sx,null,{default:u=>{var d;return(d=l.count)===null||d===void 0?void 0:d.call(l,u)}}):null,this.mergedShowPasswordOn&&this.type==="password"?ge("div",{class:`${t}-input__eye`,onMousedown:this.handlePasswordToggleMousedown,onClick:this.handlePasswordToggleClick},this.passwordVisible?Ki(l["password-visible-icon"],()=>[ge(Ji,{clsPrefix:t},{default:()=>ge(CN,null)})]):Ki(l["password-invisible-icon"],()=>[ge(Ji,{clsPrefix:t},{default:()=>ge(AN,null)})])):null]):null)),this.pair?ge("span",{class:`${t}-input__separator`},Ki(l.separator,()=>[this.separator])):null,this.pair?ge("div",{class:`${t}-input-wrapper`},ge("div",{class:`${t}-input__input`},ge("input",{ref:"inputEl2Ref",type:this.type,class:`${t}-input__input-el`,tabindex:this.passivelyActivated&&!this.activated?-1:void 0,placeholder:this.mergedPlaceholder[1],disabled:this.mergedDisabled,maxlength:s?void 0:this.maxlength,minlength:s?void 0:this.minlength,value:Array.isArray(this.mergedValue)?this.mergedValue[1]:void 0,readonly:this.readonly,style:this.textDecorationStyle[1],onBlur:this.handleInputBlur,onFocus:c=>{this.handleInputFocus(c,1)},onInput:c=>{this.handleInput(c,1)},onChange:c=>{this.handleChange(c,1)}}),this.showPlaceholder2?ge("div",{class:`${t}-input__placeholder`},ge("span",null,this.mergedPlaceholder[1])):null),vr(l.suffix,c=>(this.clearable||c)&&ge("div",{class:`${t}-input__suffix`},[this.clearable&&ge(H1,{clsPrefix:t,show:this.showClearButton,onClear:this.handleClear},{icon:()=>{var u;return(u=l["clear-icon"])===null||u===void 0?void 0:u.call(l)},placeholder:()=>{var u;return(u=l["clear-icon-placeholder"])===null||u===void 0?void 0:u.call(l)}}),c]))):null,this.mergedBordered?ge("div",{class:`${t}-input__border`}):null,this.mergedBordered?ge("div",{class:`${t}-input__state-border`}):null,this.showCount&&o==="textarea"?ge(Sx,null,{default:c=>{var u;const{renderCount:d}=this;return d?d(c):(u=l.count)===null||u===void 0?void 0:u.call(l,c)}}):null)}});function ba(n){return $i(n,[255,255,255,.16])}function ph(n){return $i(n,[0,0,0,.12])}const xz="n-button-group",wz={paddingTiny:"0 6px",paddingSmall:"0 10px",paddingMedium:"0 14px",paddingLarge:"0 18px",paddingRoundTiny:"0 10px",paddingRoundSmall:"0 14px",paddingRoundMedium:"0 18px",paddingRoundLarge:"0 22px",iconMarginTiny:"6px",iconMarginSmall:"6px",iconMarginMedium:"6px",iconMarginLarge:"6px",iconSizeTiny:"14px",iconSizeSmall:"18px",iconSizeMedium:"18px",iconSizeLarge:"20px",rippleDuration:".6s"};function Sz(n){const{heightTiny:e,heightSmall:t,heightMedium:r,heightLarge:i,borderRadius:o,fontSizeTiny:s,fontSizeSmall:a,fontSizeMedium:l,fontSizeLarge:c,opacityDisabled:u,textColor2:d,textColor3:h,primaryColorHover:m,primaryColorPressed:f,borderColor:v,primaryColor:g,baseColor:b,infoColor:S,infoColorHover:p,infoColorPressed:y,successColor:w,successColorHover:x,successColorPressed:_,warningColor:A,warningColorHover:C,warningColorPressed:T,errorColor:I,errorColorHover:M,errorColorPressed:P,fontWeight:E,buttonColor2:R,buttonColor2Hover:B,buttonColor2Pressed:L,fontWeightStrong:F}=n;return Object.assign(Object.assign({},wz),{heightTiny:e,heightSmall:t,heightMedium:r,heightLarge:i,borderRadiusTiny:o,borderRadiusSmall:o,borderRadiusMedium:o,borderRadiusLarge:o,fontSizeTiny:s,fontSizeSmall:a,fontSizeMedium:l,fontSizeLarge:c,opacityDisabled:u,colorOpacitySecondary:"0.16",colorOpacitySecondaryHover:"0.22",colorOpacitySecondaryPressed:"0.28",colorSecondary:R,colorSecondaryHover:B,colorSecondaryPressed:L,colorTertiary:R,colorTertiaryHover:B,colorTertiaryPressed:L,colorQuaternary:"#0000",colorQuaternaryHover:B,colorQuaternaryPressed:L,color:"#0000",colorHover:"#0000",colorPressed:"#0000",colorFocus:"#0000",colorDisabled:"#0000",textColor:d,textColorTertiary:h,textColorHover:m,textColorPressed:f,textColorFocus:m,textColorDisabled:d,textColorText:d,textColorTextHover:m,textColorTextPressed:f,textColorTextFocus:m,textColorTextDisabled:d,textColorGhost:d,textColorGhostHover:m,textColorGhostPressed:f,textColorGhostFocus:m,textColorGhostDisabled:d,border:`1px solid ${v}`,borderHover:`1px solid ${m}`,borderPressed:`1px solid ${f}`,borderFocus:`1px solid ${m}`,borderDisabled:`1px solid ${v}`,rippleColor:g,colorPrimary:g,colorHoverPrimary:m,colorPressedPrimary:f,colorFocusPrimary:m,colorDisabledPrimary:g,textColorPrimary:b,textColorHoverPrimary:b,textColorPressedPrimary:b,textColorFocusPrimary:b,textColorDisabledPrimary:b,textColorTextPrimary:g,textColorTextHoverPrimary:m,textColorTextPressedPrimary:f,textColorTextFocusPrimary:m,textColorTextDisabledPrimary:d,textColorGhostPrimary:g,textColorGhostHoverPrimary:m,textColorGhostPressedPrimary:f,textColorGhostFocusPrimary:m,textColorGhostDisabledPrimary:g,borderPrimary:`1px solid ${g}`,borderHoverPrimary:`1px solid ${m}`,borderPressedPrimary:`1px solid ${f}`,borderFocusPrimary:`1px solid ${m}`,borderDisabledPrimary:`1px solid ${g}`,rippleColorPrimary:g,colorInfo:S,colorHoverInfo:p,colorPressedInfo:y,colorFocusInfo:p,colorDisabledInfo:S,textColorInfo:b,textColorHoverInfo:b,textColorPressedInfo:b,textColorFocusInfo:b,textColorDisabledInfo:b,textColorTextInfo:S,textColorTextHoverInfo:p,textColorTextPressedInfo:y,textColorTextFocusInfo:p,textColorTextDisabledInfo:d,textColorGhostInfo:S,textColorGhostHoverInfo:p,textColorGhostPressedInfo:y,textColorGhostFocusInfo:p,textColorGhostDisabledInfo:S,borderInfo:`1px solid ${S}`,borderHoverInfo:`1px solid ${p}`,borderPressedInfo:`1px solid ${y}`,borderFocusInfo:`1px solid ${p}`,borderDisabledInfo:`1px solid ${S}`,rippleColorInfo:S,colorSuccess:w,colorHoverSuccess:x,colorPressedSuccess:_,colorFocusSuccess:x,colorDisabledSuccess:w,textColorSuccess:b,textColorHoverSuccess:b,textColorPressedSuccess:b,textColorFocusSuccess:b,textColorDisabledSuccess:b,textColorTextSuccess:w,textColorTextHoverSuccess:x,textColorTextPressedSuccess:_,textColorTextFocusSuccess:x,textColorTextDisabledSuccess:d,textColorGhostSuccess:w,textColorGhostHoverSuccess:x,textColorGhostPressedSuccess:_,textColorGhostFocusSuccess:x,textColorGhostDisabledSuccess:w,borderSuccess:`1px solid ${w}`,borderHoverSuccess:`1px solid ${x}`,borderPressedSuccess:`1px solid ${_}`,borderFocusSuccess:`1px solid ${x}`,borderDisabledSuccess:`1px solid ${w}`,rippleColorSuccess:w,colorWarning:A,colorHoverWarning:C,colorPressedWarning:T,colorFocusWarning:C,colorDisabledWarning:A,textColorWarning:b,textColorHoverWarning:b,textColorPressedWarning:b,textColorFocusWarning:b,textColorDisabledWarning:b,textColorTextWarning:A,textColorTextHoverWarning:C,textColorTextPressedWarning:T,textColorTextFocusWarning:C,textColorTextDisabledWarning:d,textColorGhostWarning:A,textColorGhostHoverWarning:C,textColorGhostPressedWarning:T,textColorGhostFocusWarning:C,textColorGhostDisabledWarning:A,borderWarning:`1px solid ${A}`,borderHoverWarning:`1px solid ${C}`,borderPressedWarning:`1px solid ${T}`,borderFocusWarning:`1px solid ${C}`,borderDisabledWarning:`1px solid ${A}`,rippleColorWarning:A,colorError:I,colorHoverError:M,colorPressedError:P,colorFocusError:M,colorDisabledError:I,textColorError:b,textColorHoverError:b,textColorPressedError:b,textColorFocusError:b,textColorDisabledError:b,textColorTextError:I,textColorTextHoverError:M,textColorTextPressedError:P,textColorTextFocusError:M,textColorTextDisabledError:d,textColorGhostError:I,textColorGhostHoverError:M,textColorGhostPressedError:P,textColorGhostFocusError:M,textColorGhostDisabledError:I,borderError:`1px solid ${I}`,borderHoverError:`1px solid ${M}`,borderPressedError:`1px solid ${P}`,borderFocusError:`1px solid ${M}`,borderDisabledError:`1px solid ${I}`,rippleColorError:I,waveOpacity:"0.6",fontWeight:E,fontWeightStrong:F})}const JT={name:"Button",common:ti,self:Sz},Cz=tt([Ke("button",`
 margin: 0;
 font-weight: var(--n-font-weight);
 line-height: 1;
 font-family: inherit;
 padding: var(--n-padding);
 height: var(--n-height);
 font-size: var(--n-font-size);
 border-radius: var(--n-border-radius);
 color: var(--n-text-color);
 background-color: var(--n-color);
 width: var(--n-width);
 white-space: nowrap;
 outline: none;
 position: relative;
 z-index: auto;
 border: none;
 display: inline-flex;
 flex-wrap: nowrap;
 flex-shrink: 0;
 align-items: center;
 justify-content: center;
 user-select: none;
 -webkit-user-select: none;
 text-align: center;
 cursor: pointer;
 text-decoration: none;
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 opacity .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[pt("color",[Ye("border",{borderColor:"var(--n-border-color)"}),pt("disabled",[Ye("border",{borderColor:"var(--n-border-color-disabled)"})]),ar("disabled",[tt("&:focus",[Ye("state-border",{borderColor:"var(--n-border-color-focus)"})]),tt("&:hover",[Ye("state-border",{borderColor:"var(--n-border-color-hover)"})]),tt("&:active",[Ye("state-border",{borderColor:"var(--n-border-color-pressed)"})]),pt("pressed",[Ye("state-border",{borderColor:"var(--n-border-color-pressed)"})])])]),pt("disabled",{backgroundColor:"var(--n-color-disabled)",color:"var(--n-text-color-disabled)"},[Ye("border",{border:"var(--n-border-disabled)"})]),ar("disabled",[tt("&:focus",{backgroundColor:"var(--n-color-focus)",color:"var(--n-text-color-focus)"},[Ye("state-border",{border:"var(--n-border-focus)"})]),tt("&:hover",{backgroundColor:"var(--n-color-hover)",color:"var(--n-text-color-hover)"},[Ye("state-border",{border:"var(--n-border-hover)"})]),tt("&:active",{backgroundColor:"var(--n-color-pressed)",color:"var(--n-text-color-pressed)"},[Ye("state-border",{border:"var(--n-border-pressed)"})]),pt("pressed",{backgroundColor:"var(--n-color-pressed)",color:"var(--n-text-color-pressed)"},[Ye("state-border",{border:"var(--n-border-pressed)"})])]),pt("loading","cursor: wait;"),Ke("base-wave",`
 pointer-events: none;
 top: 0;
 right: 0;
 bottom: 0;
 left: 0;
 animation-iteration-count: 1;
 animation-duration: var(--n-ripple-duration);
 animation-timing-function: var(--n-bezier-ease-out), var(--n-bezier-ease-out);
 `,[pt("active",{zIndex:1,animationName:"button-wave-spread, button-wave-opacity"})]),em&&"MozBoxSizing"in document.createElement("div").style?tt("&::moz-focus-inner",{border:0}):null,Ye("border, state-border",`
 position: absolute;
 left: 0;
 top: 0;
 right: 0;
 bottom: 0;
 border-radius: inherit;
 transition: border-color .3s var(--n-bezier);
 pointer-events: none;
 `),Ye("border",{border:"var(--n-border)"}),Ye("state-border",{border:"var(--n-border)",borderColor:"#0000",zIndex:1}),Ye("icon",`
 margin: var(--n-icon-margin);
 margin-left: 0;
 height: var(--n-icon-size);
 width: var(--n-icon-size);
 max-width: var(--n-icon-size);
 font-size: var(--n-icon-size);
 position: relative;
 flex-shrink: 0;
 `,[Ke("icon-slot",`
 height: var(--n-icon-size);
 width: var(--n-icon-size);
 position: absolute;
 left: 0;
 top: 50%;
 transform: translateY(-50%);
 display: flex;
 align-items: center;
 justify-content: center;
 `,[ip({top:"50%",originalTransform:"translateY(-50%)"})]),ez()]),Ye("content",`
 display: flex;
 align-items: center;
 flex-wrap: nowrap;
 min-width: 0;
 `,[tt("~",[Ye("icon",{margin:"var(--n-icon-margin)",marginRight:0})])]),pt("block",`
 display: flex;
 width: 100%;
 `),pt("dashed",[Ye("border, state-border",{borderStyle:"dashed !important"})]),pt("disabled",{cursor:"not-allowed",opacity:"var(--n-opacity-disabled)"})]),tt("@keyframes button-wave-spread",{from:{boxShadow:"0 0 0.5px 0 var(--n-ripple-color)"},to:{boxShadow:"0 0 0.5px 4.5px var(--n-ripple-color)"}}),tt("@keyframes button-wave-opacity",{from:{opacity:"var(--n-wave-opacity)"},to:{opacity:0}})]),Az=Object.assign(Object.assign({},cn.props),{color:String,textColor:String,text:Boolean,block:Boolean,loading:Boolean,disabled:Boolean,circle:Boolean,size:String,ghost:Boolean,round:Boolean,secondary:Boolean,tertiary:Boolean,quaternary:Boolean,strong:Boolean,focusable:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},tag:{type:String,default:"button"},type:{type:String,default:"default"},dashed:Boolean,renderIcon:Function,iconPlacement:{type:String,default:"left"},attrType:{type:String,default:"button"},bordered:{type:Boolean,default:!0},onClick:[Function,Array],nativeFocusBehavior:{type:Boolean,default:!YT}}),V1=Vt({name:"Button",props:Az,setup(n){const e=Je(null),t=Je(null),r=Je(!1),i=er(()=>!n.quaternary&&!n.tertiary&&!n.secondary&&!n.text&&(!n.color||n.ghost||n.dashed)&&n.bordered),o=vn(xz,{}),{mergedSizeRef:s}=Ld({},{defaultSize:"medium",mergedSize:y=>{const{size:w}=n;if(w)return w;const{size:x}=o;if(x)return x;const{mergedSize:_}=y||{};return _?_.value:"medium"}}),a=rt(()=>n.focusable&&!n.disabled),l=y=>{var w;a.value||y.preventDefault(),!n.nativeFocusBehavior&&(y.preventDefault(),!n.disabled&&a.value&&((w=e.value)===null||w===void 0||w.focus({preventScroll:!0})))},c=y=>{var w;if(!n.disabled&&!n.loading){const{onClick:x}=n;x&&zt(x,y),n.text||(w=t.value)===null||w===void 0||w.play()}},u=y=>{switch(y.key){case"Enter":if(!n.keyboard)return;r.value=!1}},d=y=>{switch(y.key){case"Enter":if(!n.keyboard||n.loading){y.preventDefault();return}r.value=!0}},h=()=>{r.value=!1},{inlineThemeDisabled:m,mergedClsPrefixRef:f,mergedRtlRef:v}=ei(n),g=cn("Button","-button",Cz,JT,n,f),b=ra("Button",v,f),S=rt(()=>{const y=g.value,{common:{cubicBezierEaseInOut:w,cubicBezierEaseOut:x},self:_}=y,{rippleDuration:A,opacityDisabled:C,fontWeight:T,fontWeightStrong:I}=_,M=s.value,{dashed:P,type:E,ghost:R,text:B,color:L,round:F,circle:H,textColor:$,secondary:O,tertiary:k,quaternary:X,strong:ie}=n,ne={"font-weight":ie?I:T};let Q={"--n-color":"initial","--n-color-hover":"initial","--n-color-pressed":"initial","--n-color-focus":"initial","--n-color-disabled":"initial","--n-ripple-color":"initial","--n-text-color":"initial","--n-text-color-hover":"initial","--n-text-color-pressed":"initial","--n-text-color-focus":"initial","--n-text-color-disabled":"initial"};const ce=E==="tertiary",Z=E==="default",re=ce?"default":E;if(B){const ye=$||L;Q={"--n-color":"#0000","--n-color-hover":"#0000","--n-color-pressed":"#0000","--n-color-focus":"#0000","--n-color-disabled":"#0000","--n-ripple-color":"#0000","--n-text-color":ye||_[gt("textColorText",re)],"--n-text-color-hover":ye?ba(ye):_[gt("textColorTextHover",re)],"--n-text-color-pressed":ye?ph(ye):_[gt("textColorTextPressed",re)],"--n-text-color-focus":ye?ba(ye):_[gt("textColorTextHover",re)],"--n-text-color-disabled":ye||_[gt("textColorTextDisabled",re)]}}else if(R||P){const ye=$||L;Q={"--n-color":"#0000","--n-color-hover":"#0000","--n-color-pressed":"#0000","--n-color-focus":"#0000","--n-color-disabled":"#0000","--n-ripple-color":L||_[gt("rippleColor",re)],"--n-text-color":ye||_[gt("textColorGhost",re)],"--n-text-color-hover":ye?ba(ye):_[gt("textColorGhostHover",re)],"--n-text-color-pressed":ye?ph(ye):_[gt("textColorGhostPressed",re)],"--n-text-color-focus":ye?ba(ye):_[gt("textColorGhostHover",re)],"--n-text-color-disabled":ye||_[gt("textColorGhostDisabled",re)]}}else if(O){const ye=Z?_.textColor:ce?_.textColorTertiary:_[gt("color",re)],Me=L||ye,Ce=E!=="default"&&E!=="tertiary";Q={"--n-color":Ce?Nt(Me,{alpha:Number(_.colorOpacitySecondary)}):_.colorSecondary,"--n-color-hover":Ce?Nt(Me,{alpha:Number(_.colorOpacitySecondaryHover)}):_.colorSecondaryHover,"--n-color-pressed":Ce?Nt(Me,{alpha:Number(_.colorOpacitySecondaryPressed)}):_.colorSecondaryPressed,"--n-color-focus":Ce?Nt(Me,{alpha:Number(_.colorOpacitySecondaryHover)}):_.colorSecondaryHover,"--n-color-disabled":_.colorSecondary,"--n-ripple-color":"#0000","--n-text-color":Me,"--n-text-color-hover":Me,"--n-text-color-pressed":Me,"--n-text-color-focus":Me,"--n-text-color-disabled":Me}}else if(k||X){const ye=Z?_.textColor:ce?_.textColorTertiary:_[gt("color",re)],Me=L||ye;k?(Q["--n-color"]=_.colorTertiary,Q["--n-color-hover"]=_.colorTertiaryHover,Q["--n-color-pressed"]=_.colorTertiaryPressed,Q["--n-color-focus"]=_.colorSecondaryHover,Q["--n-color-disabled"]=_.colorTertiary):(Q["--n-color"]=_.colorQuaternary,Q["--n-color-hover"]=_.colorQuaternaryHover,Q["--n-color-pressed"]=_.colorQuaternaryPressed,Q["--n-color-focus"]=_.colorQuaternaryHover,Q["--n-color-disabled"]=_.colorQuaternary),Q["--n-ripple-color"]="#0000",Q["--n-text-color"]=Me,Q["--n-text-color-hover"]=Me,Q["--n-text-color-pressed"]=Me,Q["--n-text-color-focus"]=Me,Q["--n-text-color-disabled"]=Me}else Q={"--n-color":L||_[gt("color",re)],"--n-color-hover":L?ba(L):_[gt("colorHover",re)],"--n-color-pressed":L?ph(L):_[gt("colorPressed",re)],"--n-color-focus":L?ba(L):_[gt("colorFocus",re)],"--n-color-disabled":L||_[gt("colorDisabled",re)],"--n-ripple-color":L||_[gt("rippleColor",re)],"--n-text-color":$||(L?_.textColorPrimary:ce?_.textColorTertiary:_[gt("textColor",re)]),"--n-text-color-hover":$||(L?_.textColorHoverPrimary:_[gt("textColorHover",re)]),"--n-text-color-pressed":$||(L?_.textColorPressedPrimary:_[gt("textColorPressed",re)]),"--n-text-color-focus":$||(L?_.textColorFocusPrimary:_[gt("textColorFocus",re)]),"--n-text-color-disabled":$||(L?_.textColorDisabledPrimary:_[gt("textColorDisabled",re)])};let se={"--n-border":"initial","--n-border-hover":"initial","--n-border-pressed":"initial","--n-border-focus":"initial","--n-border-disabled":"initial"};B?se={"--n-border":"none","--n-border-hover":"none","--n-border-pressed":"none","--n-border-focus":"none","--n-border-disabled":"none"}:se={"--n-border":_[gt("border",re)],"--n-border-hover":_[gt("borderHover",re)],"--n-border-pressed":_[gt("borderPressed",re)],"--n-border-focus":_[gt("borderFocus",re)],"--n-border-disabled":_[gt("borderDisabled",re)]};const{[gt("height",M)]:fe,[gt("fontSize",M)]:ue,[gt("padding",M)]:U,[gt("paddingRound",M)]:K,[gt("iconSize",M)]:be,[gt("borderRadius",M)]:me,[gt("iconMargin",M)]:le,waveOpacity:xe}=_,pe={"--n-width":H&&!B?fe:"initial","--n-height":B?"initial":fe,"--n-font-size":ue,"--n-padding":H||B?"initial":F?K:U,"--n-icon-size":be,"--n-icon-margin":le,"--n-border-radius":B?"initial":H||F?fe:me};return Object.assign(Object.assign(Object.assign(Object.assign({"--n-bezier":w,"--n-bezier-ease-out":x,"--n-ripple-duration":A,"--n-opacity-disabled":C,"--n-wave-opacity":xe},ne),Q),se),pe)}),p=m?Qr("button",rt(()=>{let y="";const{dashed:w,type:x,ghost:_,text:A,color:C,round:T,circle:I,textColor:M,secondary:P,tertiary:E,quaternary:R,strong:B}=n;w&&(y+="a"),_&&(y+="b"),A&&(y+="c"),T&&(y+="d"),I&&(y+="e"),P&&(y+="f"),E&&(y+="g"),R&&(y+="h"),B&&(y+="i"),C&&(y+=`j${Yf(C)}`),M&&(y+=`k${Yf(M)}`);const{value:L}=s;return y+=`l${L[0]}`,y+=`m${x[0]}`,y}),S,n):void 0;return{selfElRef:e,waveElRef:t,mergedClsPrefix:f,mergedFocusable:a,mergedSize:s,showBorder:i,enterPressed:r,rtlEnabled:b,handleMousedown:l,handleKeydown:d,handleBlur:h,handleKeyup:u,handleClick:c,customColorCssVars:rt(()=>{const{color:y}=n;if(!y)return null;const w=ba(y);return{"--n-border-color":y,"--n-border-color-hover":w,"--n-border-color-pressed":ph(y),"--n-border-color-focus":w,"--n-border-color-disabled":y}}),cssVars:m?void 0:S,themeClass:p==null?void 0:p.themeClass,onRender:p==null?void 0:p.onRender}},render(){const{mergedClsPrefix:n,tag:e,onRender:t}=this;t==null||t();const r=vr(this.$slots.default,i=>i&&ge("span",{class:`${n}-button__content`},i));return ge(e,{ref:"selfElRef",class:[this.themeClass,`${n}-button`,`${n}-button--${this.type}-type`,`${n}-button--${this.mergedSize}-type`,this.rtlEnabled&&`${n}-button--rtl`,this.disabled&&`${n}-button--disabled`,this.block&&`${n}-button--block`,this.enterPressed&&`${n}-button--pressed`,!this.text&&this.dashed&&`${n}-button--dashed`,this.color&&`${n}-button--color`,this.secondary&&`${n}-button--secondary`,this.loading&&`${n}-button--loading`,this.ghost&&`${n}-button--ghost`],tabindex:this.mergedFocusable?0:-1,type:this.attrType,style:this.cssVars,disabled:this.disabled,onClick:this.handleClick,onBlur:this.handleBlur,onMousedown:this.handleMousedown,onKeyup:this.handleKeyup,onKeydown:this.handleKeydown},this.iconPlacement==="right"&&r,ge(OT,{width:!0},{default:()=>vr(this.$slots.icon,i=>(this.loading||this.renderIcon||i)&&ge("span",{class:`${n}-button__icon`,style:{margin:M1(this.$slots.default)?"0":""}},ge(Ib,null,{default:()=>this.loading?ge(Db,{clsPrefix:n,key:"loading",class:`${n}-icon-slot`,strokeWidth:20}):ge("div",{key:"icon",class:`${n}-icon-slot`,role:"none"},this.renderIcon?this.renderIcon():i)})))}),this.iconPlacement==="left"&&r,this.text?null:ge(R6,{ref:"waveElRef",clsPrefix:n}),this.showBorder?ge("div",{"aria-hidden":!0,class:`${n}-button__border`,style:this.customColorCssVars}):null,this.showBorder?ge("div",{"aria-hidden":!0,class:`${n}-button__state-border`,style:this.customColorCssVars}):null)}}),Cx=V1;function Mz(n){const{boxShadow2:e}=n;return{menuBoxShadow:e}}const Tz={name:"Select",common:ti,peers:{InternalSelection:jT,InternalSelectMenu:HT},self:Mz},Ez=tt([Ke("select",`
 z-index: auto;
 outline: none;
 width: 100%;
 position: relative;
 `),Ke("select-menu",`
 margin: 4px 0;
 box-shadow: var(--n-menu-box-shadow);
 `,[sp({originalTransition:"background-color .3s var(--n-bezier), box-shadow .3s var(--n-bezier)"})])]),Pz=Object.assign(Object.assign({},cn.props),{to:Ti.propTo,bordered:{type:Boolean,default:void 0},clearable:Boolean,clearFilterAfterSelect:{type:Boolean,default:!0},options:{type:Array,default:()=>[]},defaultValue:{type:[String,Number,Array],default:null},keyboard:{type:Boolean,default:!0},value:[String,Number,Array],placeholder:String,menuProps:Object,multiple:Boolean,size:String,filterable:Boolean,disabled:{type:Boolean,default:void 0},remote:Boolean,loading:Boolean,filter:Function,placement:{type:String,default:"bottom-start"},widthMode:{type:String,default:"trigger"},tag:Boolean,onCreate:Function,fallbackOption:{type:[Function,Boolean],default:void 0},show:{type:Boolean,default:void 0},showArrow:{type:Boolean,default:!0},maxTagCount:[Number,String],ellipsisTagPopoverProps:Object,consistentMenuWidth:{type:Boolean,default:!0},virtualScroll:{type:Boolean,default:!0},labelField:{type:String,default:"label"},valueField:{type:String,default:"value"},childrenField:{type:String,default:"children"},renderLabel:Function,renderOption:Function,renderTag:Function,"onUpdate:value":[Function,Array],inputProps:Object,nodeProps:Function,ignoreComposition:{type:Boolean,default:!0},showOnFocus:Boolean,onUpdateValue:[Function,Array],onBlur:[Function,Array],onClear:[Function,Array],onFocus:[Function,Array],onScroll:[Function,Array],onSearch:[Function,Array],onUpdateShow:[Function,Array],"onUpdate:show":[Function,Array],displayDirective:{type:String,default:"show"},resetMenuOnOptionsChange:{type:Boolean,default:!0},status:String,showCheckmark:{type:Boolean,default:!0},onChange:[Function,Array],items:Array}),Rz=Vt({name:"Select",props:Pz,setup(n){const{mergedClsPrefixRef:e,mergedBorderedRef:t,namespaceRef:r,inlineThemeDisabled:i}=ei(n),o=cn("Select","-select",Ez,Tz,n,e),s=Je(n.defaultValue),a=Jt(n,"value"),l=el(a,s),c=Je(!1),u=Je(""),d=NM(n,["items","options"]),h=Je([]),m=Je([]),f=rt(()=>m.value.concat(h.value).concat(d.value)),v=rt(()=>{const{filter:he}=n;if(he)return he;const{labelField:Ae,valueField:Fe}=n;return(ke,We)=>{if(!We)return!1;const ee=We[Ae];if(typeof ee=="string")return fg(ke,ee);const Ie=We[Fe];return typeof Ie=="string"?fg(ke,Ie):typeof Ie=="number"?fg(ke,String(Ie)):!1}}),g=rt(()=>{if(n.remote)return d.value;{const{value:he}=f,{value:Ae}=u;return!Ae.length||!n.filterable?he:uz(he,v.value,Ae,n.childrenField)}}),b=rt(()=>{const{valueField:he,childrenField:Ae}=n,Fe=cz(he,Ae);return u6(g.value,Fe)}),S=rt(()=>dz(f.value,n.valueField,n.childrenField)),p=Je(!1),y=el(Jt(n,"show"),p),w=Je(null),x=Je(null),_=Je(null),{localeRef:A}=im("Select"),C=rt(()=>{var he;return(he=n.placeholder)!==null&&he!==void 0?he:A.value.placeholder}),T=[],I=Je(new Map),M=rt(()=>{const{fallbackOption:he}=n;if(he===void 0){const{labelField:Ae,valueField:Fe}=n;return ke=>({[Ae]:String(ke),[Fe]:ke})}return he===!1?!1:Ae=>Object.assign(he(Ae),{value:Ae})});function P(he){const Ae=n.remote,{value:Fe}=I,{value:ke}=S,{value:We}=M,ee=[];return he.forEach(Ie=>{if(ke.has(Ie))ee.push(ke.get(Ie));else if(Ae&&Fe.has(Ie))ee.push(Fe.get(Ie));else if(We){const Se=We(Ie);Se&&ee.push(Se)}}),ee}const E=rt(()=>{if(n.multiple){const{value:he}=l;return Array.isArray(he)?P(he):[]}return null}),R=rt(()=>{const{value:he}=l;return!n.multiple&&!Array.isArray(he)?he===null?null:P([he])[0]||null:null}),B=Ld(n),{mergedSizeRef:L,mergedDisabledRef:F,mergedStatusRef:H}=B;function $(he,Ae){const{onChange:Fe,"onUpdate:value":ke,onUpdateValue:We}=n,{nTriggerFormChange:ee,nTriggerFormInput:Ie}=B;Fe&&zt(Fe,he,Ae),We&&zt(We,he,Ae),ke&&zt(ke,he,Ae),s.value=he,ee(),Ie()}function O(he){const{onBlur:Ae}=n,{nTriggerFormBlur:Fe}=B;Ae&&zt(Ae,he),Fe()}function k(){const{onClear:he}=n;he&&zt(he)}function X(he){const{onFocus:Ae,showOnFocus:Fe}=n,{nTriggerFormFocus:ke}=B;Ae&&zt(Ae,he),ke(),Fe&&Z()}function ie(he){const{onSearch:Ae}=n;Ae&&zt(Ae,he)}function ne(he){const{onScroll:Ae}=n;Ae&&zt(Ae,he)}function Q(){var he;const{remote:Ae,multiple:Fe}=n;if(Ae){const{value:ke}=I;if(Fe){const{valueField:We}=n;(he=E.value)===null||he===void 0||he.forEach(ee=>{ke.set(ee[We],ee)})}else{const We=R.value;We&&ke.set(We[n.valueField],We)}}}function ce(he){const{onUpdateShow:Ae,"onUpdate:show":Fe}=n;Ae&&zt(Ae,he),Fe&&zt(Fe,he),p.value=he}function Z(){F.value||(ce(!0),p.value=!0,n.filterable&&Ve())}function re(){ce(!1)}function se(){u.value="",m.value=T}const fe=Je(!1);function ue(){n.filterable&&(fe.value=!0)}function U(){n.filterable&&(fe.value=!1,y.value||se())}function K(){F.value||(y.value?n.filterable?Ve():re():Z())}function be(he){var Ae,Fe;!((Fe=(Ae=_.value)===null||Ae===void 0?void 0:Ae.selfRef)===null||Fe===void 0)&&Fe.contains(he.relatedTarget)||(c.value=!1,O(he),re())}function me(he){X(he),c.value=!0}function le(){c.value=!0}function xe(he){var Ae;!((Ae=w.value)===null||Ae===void 0)&&Ae.$el.contains(he.relatedTarget)||(c.value=!1,O(he),re())}function pe(){var he;(he=w.value)===null||he===void 0||he.focus(),re()}function ye(he){var Ae;y.value&&(!((Ae=w.value)===null||Ae===void 0)&&Ae.$el.contains(ld(he))||re())}function Me(he){if(!Array.isArray(he))return[];if(M.value)return Array.from(he);{const{remote:Ae}=n,{value:Fe}=S;if(Ae){const{value:ke}=I;return he.filter(We=>Fe.has(We)||ke.has(We))}else return he.filter(ke=>Fe.has(ke))}}function Ce(he){z(he.rawNode)}function z(he){if(F.value)return;const{tag:Ae,remote:Fe,clearFilterAfterSelect:ke,valueField:We}=n;if(Ae&&!Fe){const{value:ee}=m,Ie=ee[0]||null;if(Ie){const Se=h.value;Se.length?Se.push(Ie):h.value=[Ie],m.value=T}}if(Fe&&I.value.set(he[We],he),n.multiple){const ee=Me(l.value),Ie=ee.findIndex(Se=>Se===he[We]);if(~Ie){if(ee.splice(Ie,1),Ae&&!Fe){const Se=D(he[We]);~Se&&(h.value.splice(Se,1),ke&&(u.value=""))}}else ee.push(he[We]),ke&&(u.value="");$(ee,P(ee))}else{if(Ae&&!Fe){const ee=D(he[We]);~ee?h.value=[h.value[ee]]:h.value=T}Le(),re(),$(he[We],he)}}function D(he){return h.value.findIndex(Fe=>Fe[n.valueField]===he)}function q(he){y.value||Z();const{value:Ae}=he.target;u.value=Ae;const{tag:Fe,remote:ke}=n;if(ie(Ae),Fe&&!ke){if(!Ae){m.value=T;return}const{onCreate:We}=n,ee=We?We(Ae):{[n.labelField]:Ae,[n.valueField]:Ae},{valueField:Ie,labelField:Se}=n;d.value.some(Ee=>Ee[Ie]===ee[Ie]||Ee[Se]===ee[Se])||h.value.some(Ee=>Ee[Ie]===ee[Ie]||Ee[Se]===ee[Se])?m.value=T:m.value=[ee]}}function _e(he){he.stopPropagation();const{multiple:Ae}=n;!Ae&&n.filterable&&re(),k(),Ae?$([],[]):$(null,null)}function ve(he){!Uu(he,"action")&&!Uu(he,"empty")&&!Uu(he,"header")&&he.preventDefault()}function Re(he){ne(he)}function ze(he){var Ae,Fe,ke,We,ee;if(!n.keyboard){he.preventDefault();return}switch(he.key){case" ":if(n.filterable)break;he.preventDefault();case"Enter":if(!(!((Ae=w.value)===null||Ae===void 0)&&Ae.isComposing)){if(y.value){const Ie=(Fe=_.value)===null||Fe===void 0?void 0:Fe.getPendingTmNode();Ie?Ce(Ie):n.filterable||(re(),Le())}else if(Z(),n.tag&&fe.value){const Ie=m.value[0];if(Ie){const Se=Ie[n.valueField],{value:Ee}=l;n.multiple&&Array.isArray(Ee)&&Ee.includes(Se)||z(Ie)}}}he.preventDefault();break;case"ArrowUp":if(he.preventDefault(),n.loading)return;y.value&&((ke=_.value)===null||ke===void 0||ke.prev());break;case"ArrowDown":if(he.preventDefault(),n.loading)return;y.value?(We=_.value)===null||We===void 0||We.next():Z();break;case"Escape":y.value&&(dD(he),re()),(ee=w.value)===null||ee===void 0||ee.focus();break}}function Le(){var he;(he=w.value)===null||he===void 0||he.focus()}function Ve(){var he;(he=w.value)===null||he===void 0||he.focusInput()}function Ze(){var he;y.value&&((he=x.value)===null||he===void 0||he.syncPosition())}Q(),bn(Jt(n,"options"),Q);const ut={focus:()=>{var he;(he=w.value)===null||he===void 0||he.focus()},focusInput:()=>{var he;(he=w.value)===null||he===void 0||he.focusInput()},blur:()=>{var he;(he=w.value)===null||he===void 0||he.blur()},blurInput:()=>{var he;(he=w.value)===null||he===void 0||he.blurInput()}},Ne=rt(()=>{const{self:{menuBoxShadow:he}}=o.value;return{"--n-menu-box-shadow":he}}),ct=i?Qr("select",void 0,Ne,n):void 0;return Object.assign(Object.assign({},ut),{mergedStatus:H,mergedClsPrefix:e,mergedBordered:t,namespace:r,treeMate:b,isMounted:Dd(),triggerRef:w,menuRef:_,pattern:u,uncontrolledShow:p,mergedShow:y,adjustedTo:Ti(n),uncontrolledValue:s,mergedValue:l,followerRef:x,localizedPlaceholder:C,selectedOption:R,selectedOptions:E,mergedSize:L,mergedDisabled:F,focused:c,activeWithoutMenuOpen:fe,inlineThemeDisabled:i,onTriggerInputFocus:ue,onTriggerInputBlur:U,handleTriggerOrMenuResize:Ze,handleMenuFocus:le,handleMenuBlur:xe,handleMenuTabOut:pe,handleTriggerClick:K,handleToggle:Ce,handleDeleteOption:z,handlePatternInput:q,handleClear:_e,handleTriggerBlur:be,handleTriggerFocus:me,handleKeydown:ze,handleMenuAfterLeave:se,handleMenuClickOutside:ye,handleMenuScroll:Re,handleMenuKeydown:ze,handleMenuMousedown:ve,mergedTheme:o,cssVars:i?void 0:Ne,themeClass:ct==null?void 0:ct.themeClass,onRender:ct==null?void 0:ct.onRender})},render(){return ge("div",{class:`${this.mergedClsPrefix}-select`},ge(pb,null,{default:()=>[ge(mb,null,{default:()=>ge(Q6,{ref:"triggerRef",inlineThemeDisabled:this.inlineThemeDisabled,status:this.mergedStatus,inputProps:this.inputProps,clsPrefix:this.mergedClsPrefix,showArrow:this.showArrow,maxTagCount:this.maxTagCount,ellipsisTagPopoverProps:this.ellipsisTagPopoverProps,bordered:this.mergedBordered,active:this.activeWithoutMenuOpen||this.mergedShow,pattern:this.pattern,placeholder:this.localizedPlaceholder,selectedOption:this.selectedOption,selectedOptions:this.selectedOptions,multiple:this.multiple,renderTag:this.renderTag,renderLabel:this.renderLabel,filterable:this.filterable,clearable:this.clearable,disabled:this.mergedDisabled,size:this.mergedSize,theme:this.mergedTheme.peers.InternalSelection,labelField:this.labelField,valueField:this.valueField,themeOverrides:this.mergedTheme.peerOverrides.InternalSelection,loading:this.loading,focused:this.focused,onClick:this.handleTriggerClick,onDeleteOption:this.handleDeleteOption,onPatternInput:this.handlePatternInput,onClear:this.handleClear,onBlur:this.handleTriggerBlur,onFocus:this.handleTriggerFocus,onKeydown:this.handleKeydown,onPatternBlur:this.onTriggerInputBlur,onPatternFocus:this.onTriggerInputFocus,onResize:this.handleTriggerOrMenuResize,ignoreComposition:this.ignoreComposition},{arrow:()=>{var n,e;return[(e=(n=this.$slots).arrow)===null||e===void 0?void 0:e.call(n)]}})}),ge(vb,{ref:"followerRef",show:this.mergedShow,to:this.adjustedTo,teleportDisabled:this.adjustedTo===Ti.tdkey,containerClass:this.namespace,width:this.consistentMenuWidth?"target":void 0,minWidth:"target",placement:this.placement},{default:()=>ge(Mo,{name:"fade-in-scale-up-transition",appear:this.isMounted,onAfterLeave:this.handleMenuAfterLeave},{default:()=>{var n,e,t;return this.mergedShow||this.displayDirective==="show"?((n=this.onRender)===null||n===void 0||n.call(this),Ic(ge(E6,Object.assign({},this.menuProps,{ref:"menuRef",onResize:this.handleTriggerOrMenuResize,inlineThemeDisabled:this.inlineThemeDisabled,virtualScroll:this.consistentMenuWidth&&this.virtualScroll,class:[`${this.mergedClsPrefix}-select-menu`,this.themeClass,(e=this.menuProps)===null||e===void 0?void 0:e.class],clsPrefix:this.mergedClsPrefix,focusable:!0,labelField:this.labelField,valueField:this.valueField,autoPending:!0,nodeProps:this.nodeProps,theme:this.mergedTheme.peers.InternalSelectMenu,themeOverrides:this.mergedTheme.peerOverrides.InternalSelectMenu,treeMate:this.treeMate,multiple:this.multiple,size:"medium",renderOption:this.renderOption,renderLabel:this.renderLabel,value:this.mergedValue,style:[(t=this.menuProps)===null||t===void 0?void 0:t.style,this.cssVars],onToggle:this.handleToggle,onScroll:this.handleMenuScroll,onFocus:this.handleMenuFocus,onBlur:this.handleMenuBlur,onKeydown:this.handleMenuKeydown,onTabOut:this.handleMenuTabOut,onMousedown:this.handleMenuMousedown,show:this.mergedShow,showCheckmark:this.showCheckmark,resetMenuOnOptionsChange:this.resetMenuOnOptionsChange}),{empty:()=>{var r,i;return[(i=(r=this.$slots).empty)===null||i===void 0?void 0:i.call(r)]},header:()=>{var r,i;return[(i=(r=this.$slots).header)===null||i===void 0?void 0:i.call(r)]},action:()=>{var r,i;return[(i=(r=this.$slots).action)===null||i===void 0?void 0:i.call(r)]}}),this.displayDirective==="show"?[[tM,this.mergedShow],[Zf,this.handleMenuClickOutside,void 0,{capture:!0}]]:[[Zf,this.handleMenuClickOutside,void 0,{capture:!0}]])):null}})})]}))}});function Iz(n){const{textColorBase:e,opacity1:t,opacity2:r,opacity3:i,opacity4:o,opacity5:s}=n;return{color:e,opacity1Depth:t,opacity2Depth:r,opacity3Depth:i,opacity4Depth:o,opacity5Depth:s}}const Dz={name:"Icon",common:ti,self:Iz},Lz=Ke("icon",`
 height: 1em;
 width: 1em;
 line-height: 1em;
 text-align: center;
 display: inline-block;
 position: relative;
 fill: currentColor;
 transform: translateZ(0);
`,[pt("color-transition",{transition:"color .3s var(--n-bezier)"}),pt("depth",{color:"var(--n-color)"},[tt("svg",{opacity:"var(--n-opacity)",transition:"opacity .3s var(--n-bezier)"})]),tt("svg",{height:"1em",width:"1em"})]),Fz=Object.assign(Object.assign({},cn.props),{depth:[String,Number],size:[Number,String],color:String,component:Object}),G1=Vt({_n_icon__:!0,name:"Icon",inheritAttrs:!1,props:Fz,setup(n){const{mergedClsPrefixRef:e,inlineThemeDisabled:t}=ei(n),r=cn("Icon","-icon",Lz,Dz,n,e),i=rt(()=>{const{depth:s}=n,{common:{cubicBezierEaseInOut:a},self:l}=r.value;if(s!==void 0){const{color:c,[`opacity${s}Depth`]:u}=l;return{"--n-bezier":a,"--n-color":c,"--n-opacity":u}}return{"--n-bezier":a,"--n-color":"","--n-opacity":""}}),o=t?Qr("icon",rt(()=>`${n.depth||"d"}`),i,n):void 0;return{mergedClsPrefix:e,mergedStyle:rt(()=>{const{size:s,color:a}=n;return{fontSize:fo(s),color:a}}),cssVars:t?void 0:i,themeClass:o==null?void 0:o.themeClass,onRender:o==null?void 0:o.onRender}},render(){var n;const{$parent:e,depth:t,mergedClsPrefix:r,component:i,onRender:o,themeClass:s}=this;return!((n=e==null?void 0:e.$options)===null||n===void 0)&&n._n_icon__&&A1("icon","don't wrap `n-icon` inside `n-icon`"),o==null||o(),ge("i",Dc(this.$attrs,{role:"img",class:[`${r}-icon`,s,{[`${r}-icon--depth`]:t,[`${r}-icon--color-transition`]:t!==void 0}],style:[this.cssVars,this.mergedStyle]}),i?ge(i):this.$slots)}});var QT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Oz(n){const{textColorDisabled:e}=n;return{iconColorDisabled:e}}const kz={name:"InputNumber",common:ti,peers:{Button:JT,Input:KT},self:Oz},Bz={railHeight:"4px",railWidthVertical:"4px",handleSize:"18px",dotHeight:"8px",dotWidth:"8px",dotBorderRadius:"4px"};function Nz(n){const e="rgba(0, 0, 0, .85)",t="0 2px 8px 0 rgba(0, 0, 0, 0.12)",{railColor:r,primaryColor:i,baseColor:o,cardColor:s,modalColor:a,popoverColor:l,borderRadius:c,fontSize:u,opacityDisabled:d}=n;return Object.assign(Object.assign({},Bz),{fontSize:u,markFontSize:u,railColor:r,railColorHover:r,fillColor:i,fillColorHover:i,opacityDisabled:d,handleColor:"#FFF",dotColor:s,dotColorModal:a,dotColorPopover:l,handleBoxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.3), inset 0 0 1px 0 rgba(0, 0, 0, 0.05)",handleBoxShadowHover:"0 1px 4px 0 rgba(0, 0, 0, 0.3), inset 0 0 1px 0 rgba(0, 0, 0, 0.05)",handleBoxShadowActive:"0 1px 4px 0 rgba(0, 0, 0, 0.3), inset 0 0 1px 0 rgba(0, 0, 0, 0.05)",handleBoxShadowFocus:"0 1px 4px 0 rgba(0, 0, 0, 0.3), inset 0 0 1px 0 rgba(0, 0, 0, 0.05)",indicatorColor:e,indicatorBoxShadow:t,indicatorTextColor:o,indicatorBorderRadius:c,dotBorder:`2px solid ${r}`,dotBorderActive:`2px solid ${i}`,dotBoxShadow:""})}const zz={name:"Slider",common:ti,self:Nz};Object.assign(Object.assign({},cn.props),{left:[Number,String],right:[Number,String],top:[Number,String],bottom:[Number,String],shape:{type:String,default:"circle"},position:{type:String,default:"fixed"}});const Uz="n-float-button-group";function $z(n){const{popoverColor:e,textColor2:t,buttonColor2Hover:r,buttonColor2Pressed:i,primaryColor:o,primaryColorHover:s,primaryColorPressed:a,borderRadius:l}=n;return{color:e,colorHover:r,colorPressed:i,colorPrimary:o,colorPrimaryHover:s,colorPrimaryPressed:a,textColor:t,boxShadow:"0 2px 8px 0px rgba(0, 0, 0, .16)",boxShadowHover:"0 2px 12px 0px rgba(0, 0, 0, .24)",boxShadowPressed:"0 2px 12px 0px rgba(0, 0, 0, .24)",textColorPrimary:"#fff",borderRadiusSquare:l}}const Hz={name:"FloatButton",common:ti,self:$z},Vz=Ke("float-button",`
 user-select: none;
 cursor: pointer;
 color: var(--n-text-color);
 background-color: var(--n-color);
 font-size: 18px;
 transition:
 color .3s var(--n-bezier),
 border-color .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 box-shadow: var(--n-box-shadow);
 display: flex;
 align-items: stretch;
 box-sizing: border-box;
`,[pt("circle-shape",`
 border-radius: 4096px;
 `),pt("square-shape",`
 border-radius: var(--n-border-radius-square);
 `),Ye("fill",`
 position: absolute;
 inset: 0;
 transition: background-color .3s var(--n-bezier);
 border-radius: inherit;
 `),Ye("body",`
 position: relative;
 flex-grow: 1;
 display: flex;
 align-items: center;
 justify-content: center;
 transition: transform .3s var(--n-bezier), opacity .3s var(--n-bezier);
 border-radius: inherit;
 flex-direction: column;
 box-sizing: border-box;
 padding: 2px 4px;
 gap: 2px;
 transform: scale(1);
 `,[Ye("description",`
 font-size: 12px;
 text-align: center;
 line-height: 14px;
 `)]),tt("&:hover","box-shadow: var(--n-box-shadow-hover);",[tt(">",[Ye("fill",`
 background-color: var(--n-color-hover);
 `)])]),tt("&:active","box-shadow: var(--n-box-shadow-pressed);",[tt(">",[Ye("fill",`
 background-color: var(--n-color-pressed);
 `)])]),pt("show-menu",[tt(">",[Ye("menu",`
 pointer-events: all;
 bottom: 100%;
 opacity: 1;
 `),Ye("close",`
 transform: scale(1);
 opacity: 1;
 `),Ye("body",`
 transform: scale(0.75);
 opacity: 0;
 `)])]),Ye("close",`
 opacity: 0;
 transform: scale(0.75);
 position: absolute;
 inset: 0;
 display: flex;
 align-items: center;
 justify-content: center;
 transition: transform .3s var(--n-bezier), opacity .3s var(--n-bezier);
 `),Ye("menu",`
 position: absolute;
 bottom: calc(100% - 8px);
 display: flex;
 flex-direction: column;
 opacity: 0;
 pointer-events: none;
 transition:
 opacity .3s var(--n-bezier),
 bottom .3s var(--n-bezier); 
 `,[tt("> *",`
 margin-bottom: 16px;
 `),Ke("float-button",`
 position: relative !important;
 `)])]),Gz=Object.assign(Object.assign({},cn.props),{width:{type:[Number,String],default:40},height:{type:[Number,String],default:40},left:[Number,String],right:[Number,String],top:[Number,String],bottom:[Number,String],shape:{type:String,default:"circle"},position:{type:String,default:"fixed"},type:{type:String,default:"default"},menuTrigger:String,showMenu:{type:Boolean,default:void 0},onUpdateShowMenu:{type:[Function,Array],default:void 0},"onUpdate:showMenu":{type:[Function,Array],default:void 0}}),Wz=Vt({name:"FloatButton",props:Gz,setup(n){const{mergedClsPrefixRef:e,inlineThemeDisabled:t}=ei(n),r=cn("FloatButton","-float-button",Vz,Hz,n,e),i=vn(Uz,null),o=Je(!1),s=Jt(n,"showMenu"),a=el(s,o);function l(g){const{onUpdateShowMenu:b,"onUpdate:showMenu":S}=n;o.value=g,b&&zt(b,g),S&&zt(S,g)}const c=rt(()=>{const{self:{color:g,textColor:b,boxShadow:S,boxShadowHover:p,boxShadowPressed:y,colorHover:w,colorPrimary:x,colorPrimaryHover:_,textColorPrimary:A,borderRadiusSquare:C,colorPressed:T,colorPrimaryPressed:I},common:{cubicBezierEaseInOut:M}}=r.value,{type:P}=n;return{"--n-bezier":M,"--n-box-shadow":S,"--n-box-shadow-hover":p,"--n-box-shadow-pressed":y,"--n-color":P==="primary"?x:g,"--n-text-color":P==="primary"?A:b,"--n-color-hover":P==="primary"?_:w,"--n-color-pressed":P==="primary"?I:T,"--n-border-radius-square":C}}),u=rt(()=>{const{width:g,height:b}=n;return Object.assign({position:i?void 0:n.position,width:fo(g),minHeight:fo(b)},i?null:{left:fo(n.left),right:fo(n.right),top:fo(n.top),bottom:fo(n.bottom)})}),d=rt(()=>i?i.shapeRef.value:n.shape),h=()=>{n.menuTrigger==="hover"&&l(!0)},m=()=>{n.menuTrigger==="hover"&&a.value&&l(!1)},f=()=>{n.menuTrigger==="click"&&l(!a.value)},v=t?Qr("float-button",rt(()=>n.type[0]),c,n):void 0;return{inlineStyle:u,cssVars:t?void 0:c,mergedClsPrefix:e,mergedShape:d,mergedShowMenu:a,themeClass:v==null?void 0:v.themeClass,onRender:v==null?void 0:v.onRender,Mouseenter:h,handleMouseleave:m,handleClick:f}},render(){var n;const{mergedClsPrefix:e,cssVars:t,mergedShape:r,type:i,menuTrigger:o,mergedShowMenu:s,themeClass:a,$slots:l,inlineStyle:c,onRender:u}=this,d=[[jM,this.handleMouseleave]];return u==null||u(),Ic(ge("div",{class:[`${e}-float-button`,`${e}-float-button--${r}-shape`,`${e}-float-button--${i}-type`,s&&`${e}-float-button--show-menu`,a],style:[t,c],onMouseenter:this.Mouseenter,onMouseleave:this.handleMouseleave,onClick:this.handleClick,role:"button"},ge("div",{class:`${e}-float-button__fill`,"aria-hidden":!0}),ge("div",{class:`${e}-float-button__body`},(n=l.default)===null||n===void 0?void 0:n.call(l),vr(l.description,h=>h?ge("div",{class:`${e}-float-button__description`},h):null)),o?ge("div",{class:`${e}-float-button__close`},ge(Ji,{clsPrefix:e},{default:()=>ge(FT,null)})):null,o?ge("div",{onClick:h=>{h.stopPropagation()},"data-float-button-menu":!0,class:`${e}-float-button__menu`},Ki(l.menu,()=>[])):null),d)}});function jz(n){return n==null||typeof n=="string"&&n.trim()===""?null:Number(n)}function qz(n){return n.includes(".")&&(/^(-)?\d+.*(\.|0)$/.test(n)||/^\.\d+$/.test(n))}function pg(n){return n==null?!0:!Number.isNaN(n)}function Ax(n,e){return typeof n!="number"?"":e===void 0?String(n):n.toFixed(e)}function mg(n){if(n===null)return null;if(typeof n=="number")return n;{const e=Number(n);return Number.isNaN(e)?null:e}}const Xz=tt([Ke("input-number-suffix",`
 display: inline-block;
 margin-right: 10px;
 `),Ke("input-number-prefix",`
 display: inline-block;
 margin-left: 10px;
 `)]),Mx=800,Tx=100,Yz=Object.assign(Object.assign({},cn.props),{autofocus:Boolean,loading:{type:Boolean,default:void 0},placeholder:String,defaultValue:{type:Number,default:null},value:Number,step:{type:[Number,String],default:1},min:[Number,String],max:[Number,String],size:String,disabled:{type:Boolean,default:void 0},validator:Function,bordered:{type:Boolean,default:void 0},showButton:{type:Boolean,default:!0},buttonPlacement:{type:String,default:"right"},inputProps:Object,readonly:Boolean,clearable:Boolean,keyboard:{type:Object,default:{}},updateValueOnInput:{type:Boolean,default:!0},round:{type:Boolean,default:void 0},parse:Function,format:Function,precision:Number,status:String,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onClear:[Function,Array],onChange:[Function,Array]}),Kz=Vt({name:"InputNumber",props:Yz,setup(n){const{mergedBorderedRef:e,mergedClsPrefixRef:t,mergedRtlRef:r}=ei(n),i=cn("InputNumber","-input-number",Xz,kz,n,t),{localeRef:o}=im("InputNumber"),s=Ld(n),{mergedSizeRef:a,mergedDisabledRef:l,mergedStatusRef:c}=s,u=Je(null),d=Je(null),h=Je(null),m=Je(n.defaultValue),f=Jt(n,"value"),v=el(f,m),g=Je(""),b=le=>{const xe=String(le).split(".")[1];return xe?xe.length:0},S=le=>{const xe=[n.min,n.max,n.step,le].map(pe=>pe===void 0?0:b(pe));return Math.max(...xe)},p=er(()=>{const{placeholder:le}=n;return le!==void 0?le:o.value.placeholder}),y=er(()=>{const le=mg(n.step);return le!==null?le===0?1:Math.abs(le):1}),w=er(()=>{const le=mg(n.min);return le!==null?le:null}),x=er(()=>{const le=mg(n.max);return le!==null?le:null}),_=()=>{const{value:le}=v;if(pg(le)){const{format:xe,precision:pe}=n;xe?g.value=xe(le):le===null||pe===void 0||b(le)>pe?g.value=Ax(le,void 0):g.value=Ax(le,pe)}else g.value=String(le)};_();const A=le=>{const{value:xe}=v;if(le===xe){_();return}const{"onUpdate:value":pe,onUpdateValue:ye,onChange:Me}=n,{nTriggerFormInput:Ce,nTriggerFormChange:z}=s;Me&&zt(Me,le),ye&&zt(ye,le),pe&&zt(pe,le),m.value=le,Ce(),z()},C=({offset:le,doUpdateIfValid:xe,fixPrecision:pe,isInputing:ye})=>{const{value:Me}=g;if(ye&&qz(Me))return!1;const Ce=(n.parse||jz)(Me);if(Ce===null)return xe&&A(null),null;if(pg(Ce)){const z=b(Ce),{precision:D}=n;if(D!==void 0&&D<z&&!pe)return!1;let q=Number.parseFloat((Ce+le).toFixed(D??S(Ce)));if(pg(q)){const{value:_e}=x,{value:ve}=w;if(_e!==null&&q>_e){if(!xe||ye)return!1;q=_e}if(ve!==null&&q<ve){if(!xe||ye)return!1;q=ve}return n.validator&&!n.validator(q)?!1:(xe&&A(q),q)}}return!1},T=er(()=>C({offset:0,doUpdateIfValid:!1,isInputing:!1,fixPrecision:!1})===!1),I=er(()=>{const{value:le}=v;if(n.validator&&le===null)return!1;const{value:xe}=y;return C({offset:-xe,doUpdateIfValid:!1,isInputing:!1,fixPrecision:!1})!==!1}),M=er(()=>{const{value:le}=v;if(n.validator&&le===null)return!1;const{value:xe}=y;return C({offset:+xe,doUpdateIfValid:!1,isInputing:!1,fixPrecision:!1})!==!1});function P(le){const{onFocus:xe}=n,{nTriggerFormFocus:pe}=s;xe&&zt(xe,le),pe()}function E(le){var xe,pe;if(le.target===((xe=u.value)===null||xe===void 0?void 0:xe.wrapperElRef))return;const ye=C({offset:0,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0});if(ye!==!1){const z=(pe=u.value)===null||pe===void 0?void 0:pe.inputElRef;z&&(z.value=String(ye||"")),v.value===ye&&_()}else _();const{onBlur:Me}=n,{nTriggerFormBlur:Ce}=s;Me&&zt(Me,le),Ce(),ui(()=>{_()})}function R(le){const{onClear:xe}=n;xe&&zt(xe,le)}function B(){const{value:le}=M;if(!le){Z();return}const{value:xe}=v;if(xe===null)n.validator||A($());else{const{value:pe}=y;C({offset:pe,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})}}function L(){const{value:le}=I;if(!le){Q();return}const{value:xe}=v;if(xe===null)n.validator||A($());else{const{value:pe}=y;C({offset:-pe,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})}}const F=P,H=E;function $(){if(n.validator)return null;const{value:le}=w,{value:xe}=x;return le!==null?Math.max(0,le):xe!==null?Math.min(0,xe):0}function O(le){R(le),A(null)}function k(le){var xe,pe,ye;!((xe=h.value)===null||xe===void 0)&&xe.$el.contains(le.target)&&le.preventDefault(),!((pe=d.value)===null||pe===void 0)&&pe.$el.contains(le.target)&&le.preventDefault(),(ye=u.value)===null||ye===void 0||ye.activate()}let X=null,ie=null,ne=null;function Q(){ne&&(window.clearTimeout(ne),ne=null),X&&(window.clearInterval(X),X=null)}let ce=null;function Z(){ce&&(window.clearTimeout(ce),ce=null),ie&&(window.clearInterval(ie),ie=null)}function re(){Q(),ne=window.setTimeout(()=>{X=window.setInterval(()=>{L()},Tx)},Mx),Bn("mouseup",document,Q,{once:!0})}function se(){Z(),ce=window.setTimeout(()=>{ie=window.setInterval(()=>{B()},Tx)},Mx),Bn("mouseup",document,Z,{once:!0})}const fe=()=>{ie||B()},ue=()=>{X||L()};function U(le){var xe,pe;if(le.key==="Enter"){if(le.target===((xe=u.value)===null||xe===void 0?void 0:xe.wrapperElRef))return;C({offset:0,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})!==!1&&((pe=u.value)===null||pe===void 0||pe.deactivate())}else if(le.key==="ArrowUp"){if(!M.value||n.keyboard.ArrowUp===!1)return;le.preventDefault(),C({offset:0,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})!==!1&&B()}else if(le.key==="ArrowDown"){if(!I.value||n.keyboard.ArrowDown===!1)return;le.preventDefault(),C({offset:0,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})!==!1&&L()}}function K(le){g.value=le,n.updateValueOnInput&&!n.format&&!n.parse&&n.precision===void 0&&C({offset:0,doUpdateIfValid:!0,isInputing:!0,fixPrecision:!1})}bn(v,()=>{_()});const be={focus:()=>{var le;return(le=u.value)===null||le===void 0?void 0:le.focus()},blur:()=>{var le;return(le=u.value)===null||le===void 0?void 0:le.blur()},select:()=>{var le;return(le=u.value)===null||le===void 0?void 0:le.select()}},me=ra("InputNumber",r,t);return Object.assign(Object.assign({},be),{rtlEnabled:me,inputInstRef:u,minusButtonInstRef:d,addButtonInstRef:h,mergedClsPrefix:t,mergedBordered:e,uncontrolledValue:m,mergedValue:v,mergedPlaceholder:p,displayedValueInvalid:T,mergedSize:a,mergedDisabled:l,displayedValue:g,addable:M,minusable:I,mergedStatus:c,handleFocus:F,handleBlur:H,handleClear:O,handleMouseDown:k,handleAddClick:fe,handleMinusClick:ue,handleAddMousedown:se,handleMinusMousedown:re,handleKeyDown:U,handleUpdateDisplayedValue:K,mergedTheme:i,inputThemeOverrides:{paddingSmall:"0 8px 0 10px",paddingMedium:"0 8px 0 12px",paddingLarge:"0 8px 0 14px"},buttonThemeOverrides:rt(()=>{const{self:{iconColorDisabled:le}}=i.value,[xe,pe,ye,Me]=qs(le);return{textColorTextDisabled:`rgb(${xe}, ${pe}, ${ye})`,opacityDisabled:`${Me}`}})})},render(){const{mergedClsPrefix:n,$slots:e}=this,t=()=>ge(Cx,{text:!0,disabled:!this.minusable||this.mergedDisabled||this.readonly,focusable:!1,theme:this.mergedTheme.peers.Button,themeOverrides:this.mergedTheme.peerOverrides.Button,builtinThemeOverrides:this.buttonThemeOverrides,onClick:this.handleMinusClick,onMousedown:this.handleMinusMousedown,ref:"minusButtonInstRef"},{icon:()=>Ki(e["minus-icon"],()=>[ge(Ji,{clsPrefix:n},{default:()=>ge(PN,null)})])}),r=()=>ge(Cx,{text:!0,disabled:!this.addable||this.mergedDisabled||this.readonly,focusable:!1,theme:this.mergedTheme.peers.Button,themeOverrides:this.mergedTheme.peerOverrides.Button,builtinThemeOverrides:this.buttonThemeOverrides,onClick:this.handleAddClick,onMousedown:this.handleAddMousedown,ref:"addButtonInstRef"},{icon:()=>Ki(e["add-icon"],()=>[ge(Ji,{clsPrefix:n},{default:()=>ge(wN,null)})])});return ge("div",{class:[`${n}-input-number`,this.rtlEnabled&&`${n}-input-number--rtl`]},ge(_z,{ref:"inputInstRef",autofocus:this.autofocus,status:this.mergedStatus,bordered:this.mergedBordered,loading:this.loading,value:this.displayedValue,onUpdateValue:this.handleUpdateDisplayedValue,theme:this.mergedTheme.peers.Input,themeOverrides:this.mergedTheme.peerOverrides.Input,builtinThemeOverrides:this.inputThemeOverrides,size:this.mergedSize,placeholder:this.mergedPlaceholder,disabled:this.mergedDisabled,readonly:this.readonly,round:this.round,textDecoration:this.displayedValueInvalid?"line-through":void 0,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeydown:this.handleKeyDown,onMousedown:this.handleMouseDown,onClear:this.handleClear,clearable:this.clearable,inputProps:this.inputProps,internalLoadingBeforeSuffix:!0},{prefix:()=>{var i;return this.showButton&&this.buttonPlacement==="both"?[t(),vr(e.prefix,o=>o?ge("span",{class:`${n}-input-number-prefix`},o):null)]:(i=e.prefix)===null||i===void 0?void 0:i.call(e)},suffix:()=>{var i;return this.showButton?[vr(e.suffix,o=>o?ge("span",{class:`${n}-input-number-suffix`},o):null),this.buttonPlacement==="right"?t():null,r()]:(i=e.suffix)===null||i===void 0?void 0:i.call(e)}}))}});function Ex(n){return window.TouchEvent&&n instanceof window.TouchEvent}function Px(){const n=new Map,e=t=>r=>{n.set(t,r)};return AA(()=>{n.clear()}),[n,e]}const Zz=tt([Ke("slider",`
 display: block;
 padding: calc((var(--n-handle-size) - var(--n-rail-height)) / 2) 0;
 position: relative;
 z-index: 0;
 width: 100%;
 cursor: pointer;
 user-select: none;
 -webkit-user-select: none;
 `,[pt("reverse",[Ke("slider-handles",[Ke("slider-handle-wrapper",`
 transform: translate(50%, -50%);
 `)]),Ke("slider-dots",[Ke("slider-dot",`
 transform: translateX(50%, -50%);
 `)]),pt("vertical",[Ke("slider-handles",[Ke("slider-handle-wrapper",`
 transform: translate(-50%, -50%);
 `)]),Ke("slider-marks",[Ke("slider-mark",`
 transform: translateY(calc(-50% + var(--n-dot-height) / 2));
 `)]),Ke("slider-dots",[Ke("slider-dot",`
 transform: translateX(-50%) translateY(0);
 `)])])]),pt("vertical",`
 padding: 0 calc((var(--n-handle-size) - var(--n-rail-height)) / 2);
 width: var(--n-rail-width-vertical);
 height: 100%;
 `,[Ke("slider-handles",`
 top: calc(var(--n-handle-size) / 2);
 right: 0;
 bottom: calc(var(--n-handle-size) / 2);
 left: 0;
 `,[Ke("slider-handle-wrapper",`
 top: unset;
 left: 50%;
 transform: translate(-50%, 50%);
 `)]),Ke("slider-rail",`
 height: 100%;
 `,[Ye("fill",`
 top: unset;
 right: 0;
 bottom: unset;
 left: 0;
 `)]),pt("with-mark",`
 width: var(--n-rail-width-vertical);
 margin: 0 32px 0 8px;
 `),Ke("slider-marks",`
 top: calc(var(--n-handle-size) / 2);
 right: unset;
 bottom: calc(var(--n-handle-size) / 2);
 left: 22px;
 font-size: var(--n-mark-font-size);
 `,[Ke("slider-mark",`
 transform: translateY(50%);
 white-space: nowrap;
 `)]),Ke("slider-dots",`
 top: calc(var(--n-handle-size) / 2);
 right: unset;
 bottom: calc(var(--n-handle-size) / 2);
 left: 50%;
 `,[Ke("slider-dot",`
 transform: translateX(-50%) translateY(50%);
 `)])]),pt("disabled",`
 cursor: not-allowed;
 opacity: var(--n-opacity-disabled);
 `,[Ke("slider-handle",`
 cursor: not-allowed;
 `)]),pt("with-mark",`
 width: 100%;
 margin: 8px 0 32px 0;
 `),tt("&:hover",[Ke("slider-rail",{backgroundColor:"var(--n-rail-color-hover)"},[Ye("fill",{backgroundColor:"var(--n-fill-color-hover)"})]),Ke("slider-handle",{boxShadow:"var(--n-handle-box-shadow-hover)"})]),pt("active",[Ke("slider-rail",{backgroundColor:"var(--n-rail-color-hover)"},[Ye("fill",{backgroundColor:"var(--n-fill-color-hover)"})]),Ke("slider-handle",{boxShadow:"var(--n-handle-box-shadow-hover)"})]),Ke("slider-marks",`
 position: absolute;
 top: 18px;
 left: calc(var(--n-handle-size) / 2);
 right: calc(var(--n-handle-size) / 2);
 `,[Ke("slider-mark",`
 position: absolute;
 transform: translateX(-50%);
 white-space: nowrap;
 `)]),Ke("slider-rail",`
 width: 100%;
 position: relative;
 height: var(--n-rail-height);
 background-color: var(--n-rail-color);
 transition: background-color .3s var(--n-bezier);
 border-radius: calc(var(--n-rail-height) / 2);
 `,[Ye("fill",`
 position: absolute;
 top: 0;
 bottom: 0;
 border-radius: calc(var(--n-rail-height) / 2);
 transition: background-color .3s var(--n-bezier);
 background-color: var(--n-fill-color);
 `)]),Ke("slider-handles",`
 position: absolute;
 top: 0;
 right: calc(var(--n-handle-size) / 2);
 bottom: 0;
 left: calc(var(--n-handle-size) / 2);
 `,[Ke("slider-handle-wrapper",`
 outline: none;
 position: absolute;
 top: 50%;
 transform: translate(-50%, -50%);
 cursor: pointer;
 display: flex;
 `,[Ke("slider-handle",`
 height: var(--n-handle-size);
 width: var(--n-handle-size);
 border-radius: 50%;
 overflow: hidden;
 transition: box-shadow .2s var(--n-bezier), background-color .3s var(--n-bezier);
 background-color: var(--n-handle-color);
 box-shadow: var(--n-handle-box-shadow);
 `,[tt("&:hover",`
 box-shadow: var(--n-handle-box-shadow-hover);
 `)]),tt("&:focus",[Ke("slider-handle",`
 box-shadow: var(--n-handle-box-shadow-focus);
 `,[tt("&:hover",`
 box-shadow: var(--n-handle-box-shadow-active);
 `)])])])]),Ke("slider-dots",`
 position: absolute;
 top: 50%;
 left: calc(var(--n-handle-size) / 2);
 right: calc(var(--n-handle-size) / 2);
 `,[pt("transition-disabled",[Ke("slider-dot","transition: none;")]),Ke("slider-dot",`
 transition:
 border-color .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 position: absolute;
 transform: translate(-50%, -50%);
 height: var(--n-dot-height);
 width: var(--n-dot-width);
 border-radius: var(--n-dot-border-radius);
 overflow: hidden;
 box-sizing: border-box;
 border: var(--n-dot-border);
 background-color: var(--n-dot-color);
 `,[pt("active","border: var(--n-dot-border-active);")])])]),Ke("slider-handle-indicator",`
 font-size: var(--n-font-size);
 padding: 6px 10px;
 border-radius: var(--n-indicator-border-radius);
 color: var(--n-indicator-text-color);
 background-color: var(--n-indicator-color);
 box-shadow: var(--n-indicator-box-shadow);
 `,[sp()]),Ke("slider-handle-indicator",`
 font-size: var(--n-font-size);
 padding: 6px 10px;
 border-radius: var(--n-indicator-border-radius);
 color: var(--n-indicator-text-color);
 background-color: var(--n-indicator-color);
 box-shadow: var(--n-indicator-box-shadow);
 `,[pt("top",`
 margin-bottom: 12px;
 `),pt("right",`
 margin-left: 12px;
 `),pt("bottom",`
 margin-top: 12px;
 `),pt("left",`
 margin-right: 12px;
 `),sp()]),sD(Ke("slider",[Ke("slider-dot","background-color: var(--n-dot-color-modal);")])),aD(Ke("slider",[Ke("slider-dot","background-color: var(--n-dot-color-popover);")]))]),Jz=0,Qz=Object.assign(Object.assign({},cn.props),{to:Ti.propTo,defaultValue:{type:[Number,Array],default:0},marks:Object,disabled:{type:Boolean,default:void 0},formatTooltip:Function,keyboard:{type:Boolean,default:!0},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:[Number,String],default:1},range:Boolean,value:[Number,Array],placement:String,showTooltip:{type:Boolean,default:void 0},tooltip:{type:Boolean,default:!0},vertical:Boolean,reverse:Boolean,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onDragstart:[Function],onDragend:[Function]}),e8=Vt({name:"Slider",props:Qz,setup(n){const{mergedClsPrefixRef:e,namespaceRef:t,inlineThemeDisabled:r}=ei(n),i=cn("Slider","-slider",Zz,zz,n,e),o=Je(null),[s,a]=Px(),[l,c]=Px(),u=Je(new Set),d=Ld(n),{mergedDisabledRef:h}=d,m=rt(()=>{const{step:z}=n;if(Number(z)<=0||z==="mark")return 0;const D=z.toString();let q=0;return D.includes(".")&&(q=D.length-D.indexOf(".")-1),q}),f=Je(n.defaultValue),v=Jt(n,"value"),g=el(v,f),b=rt(()=>{const{value:z}=g;return(n.range?z:[z]).map(k)}),S=rt(()=>b.value.length>2),p=rt(()=>n.placement===void 0?n.vertical?"right":"top":n.placement),y=rt(()=>{const{marks:z}=n;return z?Object.keys(z).map(Number.parseFloat):null}),w=Je(-1),x=Je(-1),_=Je(-1),A=Je(!1),C=Je(!1),T=rt(()=>{const{vertical:z,reverse:D}=n;return z?D?"top":"bottom":D?"right":"left"}),I=rt(()=>{if(S.value)return;const z=b.value,D=X(n.range?Math.min(...z):n.min),q=X(n.range?Math.max(...z):z[0]),{value:_e}=T;return n.vertical?{[_e]:`${D}%`,height:`${q-D}%`}:{[_e]:`${D}%`,width:`${q-D}%`}}),M=rt(()=>{const z=[],{marks:D}=n;if(D){const q=b.value.slice();q.sort((Le,Ve)=>Le-Ve);const{value:_e}=T,{value:ve}=S,{range:Re}=n,ze=ve?()=>!1:Le=>Re?Le>=q[0]&&Le<=q[q.length-1]:Le<=q[0];for(const Le of Object.keys(D)){const Ve=Number(Le);z.push({active:ze(Ve),label:D[Le],style:{[_e]:`${X(Ve)}%`}})}}return z});function P(z,D){const q=X(z),{value:_e}=T;return{[_e]:`${q}%`,zIndex:D===w.value?1:0}}function E(z){return n.showTooltip||_.value===z||w.value===z&&A.value}function R(z){return A.value?!(w.value===z&&x.value===z):!0}function B(z){var D;~z&&(w.value=z,(D=s.get(z))===null||D===void 0||D.focus())}function L(){l.forEach((z,D)=>{E(D)&&z.syncPosition()})}function F(z){const{"onUpdate:value":D,onUpdateValue:q}=n,{nTriggerFormInput:_e,nTriggerFormChange:ve}=d;q&&zt(q,z),D&&zt(D,z),f.value=z,_e(),ve()}function H(z){const{range:D}=n;if(D){if(Array.isArray(z)){const{value:q}=b;z.join()!==q.join()&&F(z)}}else Array.isArray(z)||b.value[0]!==z&&F(z)}function $(z,D){if(n.range){const q=b.value.slice();q.splice(D,1,z),H(q)}else H(z)}function O(z,D,q){const _e=q!==void 0;q||(q=z-D>0?1:-1);const ve=y.value||[],{step:Re}=n;if(Re==="mark"){const Ve=Q(z,ve.concat(D),_e?q:void 0);return Ve?Ve.value:D}if(Re<=0)return D;const{value:ze}=m;let Le;if(_e){const Ve=Number((D/Re).toFixed(ze)),Ze=Math.floor(Ve),ut=Ve>Ze?Ze:Ze-1,Ne=Ve<Ze?Ze:Ze+1;Le=Q(D,[Number((ut*Re).toFixed(ze)),Number((Ne*Re).toFixed(ze)),...ve],q)}else{const Ve=ne(z);Le=Q(z,[...ve,Ve])}return Le?k(Le.value):D}function k(z){return Math.min(n.max,Math.max(n.min,z))}function X(z){const{max:D,min:q}=n;return(z-q)/(D-q)*100}function ie(z){const{max:D,min:q}=n;return q+(D-q)*z}function ne(z){const{step:D,min:q}=n;if(Number(D)<=0||D==="mark")return z;const _e=Math.round((z-q)/D)*D+q;return Number(_e.toFixed(m.value))}function Q(z,D=y.value,q){if(!(D!=null&&D.length))return null;let _e=null,ve=-1;for(;++ve<D.length;){const Re=D[ve]-z,ze=Math.abs(Re);(q===void 0||Re*q>0)&&(_e===null||ze<_e.distance)&&(_e={index:ve,distance:ze,value:D[ve]})}return _e}function ce(z){const D=o.value;if(!D)return;const q=Ex(z)?z.touches[0]:z,_e=D.getBoundingClientRect();let ve;return n.vertical?ve=(_e.bottom-q.clientY)/_e.height:ve=(q.clientX-_e.left)/_e.width,n.reverse&&(ve=1-ve),ie(ve)}function Z(z){if(h.value||!n.keyboard)return;const{vertical:D,reverse:q}=n;switch(z.key){case"ArrowUp":z.preventDefault(),re(D&&q?-1:1);break;case"ArrowRight":z.preventDefault(),re(!D&&q?-1:1);break;case"ArrowDown":z.preventDefault(),re(D&&q?1:-1);break;case"ArrowLeft":z.preventDefault(),re(!D&&q?1:-1);break}}function re(z){const D=w.value;if(D===-1)return;const{step:q}=n,_e=b.value[D],ve=Number(q)<=0||q==="mark"?_e:_e+q*z;$(O(ve,_e,z>0?1:-1),D)}function se(z){var D,q;if(h.value||!Ex(z)&&z.button!==Jz)return;const _e=ce(z);if(_e===void 0)return;const ve=b.value.slice(),Re=n.range?(q=(D=Q(_e,ve))===null||D===void 0?void 0:D.index)!==null&&q!==void 0?q:-1:0;Re!==-1&&(z.preventDefault(),B(Re),fe(),$(O(_e,b.value[Re]),Re))}function fe(){A.value||(A.value=!0,n.onDragstart&&zt(n.onDragstart),Bn("touchend",document,K),Bn("mouseup",document,K),Bn("touchmove",document,U),Bn("mousemove",document,U))}function ue(){A.value&&(A.value=!1,n.onDragend&&zt(n.onDragend),Tn("touchend",document,K),Tn("mouseup",document,K),Tn("touchmove",document,U),Tn("mousemove",document,U))}function U(z){const{value:D}=w;if(!A.value||D===-1){ue();return}const q=ce(z);q!==void 0&&$(O(q,b.value[D]),D)}function K(){ue()}function be(z){w.value=z,h.value||(_.value=z)}function me(z){w.value===z&&(w.value=-1,ue()),_.value===z&&(_.value=-1)}function le(z){_.value=z}function xe(z){_.value===z&&(_.value=-1)}bn(w,(z,D)=>void ui(()=>x.value=D)),bn(g,()=>{if(n.marks){if(C.value)return;C.value=!0,ui(()=>{C.value=!1})}ui(L)}),Nr(()=>{ue()});const pe=rt(()=>{const{self:{markFontSize:z,railColor:D,railColorHover:q,fillColor:_e,fillColorHover:ve,handleColor:Re,opacityDisabled:ze,dotColor:Le,dotColorModal:Ve,handleBoxShadow:Ze,handleBoxShadowHover:ut,handleBoxShadowActive:Ne,handleBoxShadowFocus:ct,dotBorder:he,dotBoxShadow:Ae,railHeight:Fe,railWidthVertical:ke,handleSize:We,dotHeight:ee,dotWidth:Ie,dotBorderRadius:Se,fontSize:Ee,dotBorderActive:Ge,dotColorPopover:ft},common:{cubicBezierEaseInOut:Rt}}=i.value;return{"--n-bezier":Rt,"--n-dot-border":he,"--n-dot-border-active":Ge,"--n-dot-border-radius":Se,"--n-dot-box-shadow":Ae,"--n-dot-color":Le,"--n-dot-color-modal":Ve,"--n-dot-color-popover":ft,"--n-dot-height":ee,"--n-dot-width":Ie,"--n-fill-color":_e,"--n-fill-color-hover":ve,"--n-font-size":Ee,"--n-handle-box-shadow":Ze,"--n-handle-box-shadow-active":Ne,"--n-handle-box-shadow-focus":ct,"--n-handle-box-shadow-hover":ut,"--n-handle-color":Re,"--n-handle-size":We,"--n-opacity-disabled":ze,"--n-rail-color":D,"--n-rail-color-hover":q,"--n-rail-height":Fe,"--n-rail-width-vertical":ke,"--n-mark-font-size":z}}),ye=r?Qr("slider",void 0,pe,n):void 0,Me=rt(()=>{const{self:{fontSize:z,indicatorColor:D,indicatorBoxShadow:q,indicatorTextColor:_e,indicatorBorderRadius:ve}}=i.value;return{"--n-font-size":z,"--n-indicator-border-radius":ve,"--n-indicator-box-shadow":q,"--n-indicator-color":D,"--n-indicator-text-color":_e}}),Ce=r?Qr("slider-indicator",void 0,Me,n):void 0;return{mergedClsPrefix:e,namespace:t,uncontrolledValue:f,mergedValue:g,mergedDisabled:h,mergedPlacement:p,isMounted:Dd(),adjustedTo:Ti(n),dotTransitionDisabled:C,markInfos:M,isShowTooltip:E,shouldKeepTooltipTransition:R,handleRailRef:o,setHandleRefs:a,setFollowerRefs:c,fillStyle:I,getHandleStyle:P,activeIndex:w,arrifiedValues:b,followerEnabledIndexSet:u,handleRailMouseDown:se,handleHandleFocus:be,handleHandleBlur:me,handleHandleMouseEnter:le,handleHandleMouseLeave:xe,handleRailKeyDown:Z,indicatorCssVars:r?void 0:Me,indicatorThemeClass:Ce==null?void 0:Ce.themeClass,indicatorOnRender:Ce==null?void 0:Ce.onRender,cssVars:r?void 0:pe,themeClass:ye==null?void 0:ye.themeClass,onRender:ye==null?void 0:ye.onRender}},render(){var n;const{mergedClsPrefix:e,themeClass:t,formatTooltip:r}=this;return(n=this.onRender)===null||n===void 0||n.call(this),ge("div",{class:[`${e}-slider`,t,{[`${e}-slider--disabled`]:this.mergedDisabled,[`${e}-slider--active`]:this.activeIndex!==-1,[`${e}-slider--with-mark`]:this.marks,[`${e}-slider--vertical`]:this.vertical,[`${e}-slider--reverse`]:this.reverse}],style:this.cssVars,onKeydown:this.handleRailKeyDown,onMousedown:this.handleRailMouseDown,onTouchstart:this.handleRailMouseDown},ge("div",{class:`${e}-slider-rail`},ge("div",{class:`${e}-slider-rail__fill`,style:this.fillStyle}),this.marks?ge("div",{class:[`${e}-slider-dots`,this.dotTransitionDisabled&&`${e}-slider-dots--transition-disabled`]},this.markInfos.map(i=>ge("div",{key:i.label,class:[`${e}-slider-dot`,{[`${e}-slider-dot--active`]:i.active}],style:i.style}))):null,ge("div",{ref:"handleRailRef",class:`${e}-slider-handles`},this.arrifiedValues.map((i,o)=>{const s=this.isShowTooltip(o);return ge(pb,null,{default:()=>[ge(mb,null,{default:()=>ge("div",{ref:this.setHandleRefs(o),class:`${e}-slider-handle-wrapper`,tabindex:this.mergedDisabled?-1:0,role:"slider","aria-valuenow":i,"aria-valuemin":this.min,"aria-valuemax":this.max,"aria-orientation":this.vertical?"vertical":"horizontal","aria-disabled":this.disabled,style:this.getHandleStyle(i,o),onFocus:()=>{this.handleHandleFocus(o)},onBlur:()=>{this.handleHandleBlur(o)},onMouseenter:()=>{this.handleHandleMouseEnter(o)},onMouseleave:()=>{this.handleHandleMouseLeave(o)}},Ki(this.$slots.thumb,()=>[ge("div",{class:`${e}-slider-handle`})]))}),this.tooltip&&ge(vb,{ref:this.setFollowerRefs(o),show:s,to:this.adjustedTo,enabled:this.showTooltip&&!this.range||this.followerEnabledIndexSet.has(o),teleportDisabled:this.adjustedTo===Ti.tdkey,placement:this.mergedPlacement,containerClass:this.namespace},{default:()=>ge(Mo,{name:"fade-in-scale-up-transition",appear:this.isMounted,css:this.shouldKeepTooltipTransition(o),onEnter:()=>{this.followerEnabledIndexSet.add(o)},onAfterLeave:()=>{this.followerEnabledIndexSet.delete(o)}},{default:()=>{var a;return s?((a=this.indicatorOnRender)===null||a===void 0||a.call(this),ge("div",{class:[`${e}-slider-handle-indicator`,this.indicatorThemeClass,`${e}-slider-handle-indicator--${this.mergedPlacement}`],style:this.indicatorCssVars},typeof r=="function"?r(i):i)):null}})})]})})),this.marks?ge("div",{class:`${e}-slider-marks`},this.markInfos.map(i=>ge("div",{key:i.label,class:`${e}-slider-mark`,style:i.style},i.label))):null))}}),t8={class:"overflow-auto"},n8={class:"flex p-2"},r8=Yn("div",{class:"flex-1 font-thin md:text-lg p-1 md:p-2"},"Galaxy Charts",-1),i8={class:"m-4 mt-0 p-2 bg-sky-50 text-sky-900 rounded"},o8={class:"md:flex"},s8={class:"flex justify-center center-items"},a8={class:"m-1"},l8=["src"],c8={class:"overflow-hidden break-words p-1"},u8={class:"font-bold"},d8=["innerHTML"],h8={class:"px-4 pb-2"},f8={class:"font-bold"},p8={key:0,class:"text-xs py-1"},m8={key:1},g8={key:0},v8={key:1},Rx=.01,b8={__name:"SidePanel",props:{description:{type:String,default:"This visualization has no description."},inputs:{type:Array,default:()=>[]},logoUrl:{type:String,default:""},html:{type:String,default:"Visualization Title"},values:{type:Object,default:()=>{}}},emits:["update:values","toggle"],setup(n,{emit:e}){const t=n,r=Je({...t.values}),i=e;return bn(r,o=>{i("update:values",o)},{deep:!0}),(o,s)=>(Mn(),fr("div",t8,[Yn("div",n8,[r8,Yn("div",null,[pn(hr(V1),{strong:"",secondary:"",circle:"",class:"bg-sky-100 m-1"},{icon:bo(()=>[pn(hr(G1),null,{default:bo(()=>[pn(hr(w4))]),_:1})]),_:1}),pn(hr(V1),{strong:"",secondary:"",circle:"",class:"bg-sky-100 m-1",onClick:s[0]||(s[0]=a=>i("toggle"))},{icon:bo(()=>[pn(hr(G1),null,{default:bo(()=>[pn(hr(x4))]),_:1})]),_:1})])]),Yn("div",i8,[Yn("div",o8,[Yn("div",s8,[Yn("div",a8,[t.logoUrl?(Mn(),fr("img",{key:0,src:t.logoUrl,class:"min-w-14 max-w-14 object-contain"},null,8,l8)):(Mn(),js(hr(S4),{key:1,class:"size-10"}))])]),Yn("div",c8,[Yn("span",u8,ac(n.html),1),Yn("div",{class:"text-xs",innerHTML:n.description},null,8,d8)])])]),(Mn(!0),fr($n,null,x3(n.inputs,a=>(Mn(),fr("div",h8,[Yn("div",f8,ac(a.label||a.name),1),a.help?(Mn(),fr("div",p8,ac(a.help),1)):Zc("",!0),a.name in r.value?(Mn(),fr("div",m8,[a.type==="select"?(Mn(),fr("div",g8,[pn(hr(Rz),{value:r.value[a.name],"onUpdate:value":l=>r.value[a.name]=l,options:a.data},null,8,["value","onUpdate:value","options"])])):Zc("",!0),a.type==="float"?(Mn(),fr("div",v8,[a.min!==void 0&&a.max!==void 0?(Mn(),js(hr(e8),{key:0,class:"mb-2",value:r.value[a.name],"onUpdate:value":l=>r.value[a.name]=l,min:Number(a.min),max:Number(a.max),step:Rx},null,8,["value","onUpdate:value","min","max"])):Zc("",!0),pn(hr(Kz),{value:r.value[a.name],"onUpdate:value":l=>r.value[a.name]=l,size:"small",min:Number(a.min),max:Number(a.max),step:Rx},null,8,["value","onUpdate:value","min","max"])])):Zc("",!0)])):Zc("",!0)]))),256))]))}};function y8(n){const e=n.replace(/^.*[\\\/]/,"");return e.substring(0,e.lastIndexOf("."))}function _8(n,e){let t={};const i=new DOMParser().parseFromString(e,"text/xml");t.name=y8(n),t.html=i.documentElement.getAttribute("name"),t.logo=i.documentElement.getAttribute("logo");const o=i.documentElement.getElementsByTagName("description");o.length===1&&(t.description=o[0].textContent.trim());const s=i.documentElement.getElementsByTagName("specs");return s.length===1&&(t.specs=sm(s[0])),["groups","settings"].forEach(a=>{const l=i.documentElement.getElementsByTagName(a);l.length===1&&(t[a]=new om(l[0]))}),t}class om extends Array{constructor(e){super();for(const t of e.children)t.children.length>0?t.tagName===t.children[0].tagName?this.push(new om(t)):this.push(new sm(t)):t.textContent&&t.textContent.trim()&&this.push(t.textContent.trim())}}class sm{constructor(e){if(e.attributes.length>0)for(const t of e.attributes)this[t.name]=t.value;for(const t of e.children)if(t.children.length>0){let r;if(t.tagName===t.children[0].tagName)r=new om(t);else{const i=new sm(t);if(t.attributes.length>0)for(const o of t.attributes)i[o.name]=o.value;r=i}this[t.tagName]=r}else if(t.attributes.length>0){const r={};for(const i of t.attributes)r[i.name]=i.value;this[t.tagName]=r}else this[t.tagName]=t.textContent.trim()}}const x8={key:1,class:"m-2"},w8=Yn("span",{class:"text-xs"},"Please wait...",-1),S8={key:0},C8={__name:"ViewPort",props:{config:{type:Object,default:()=>{}},xml:{type:String,required:!0}},setup(n){var x;const e=n,t=Je(""),r=Je(null),i=Je(null),o=Je(null),s=Je([]),a=Je(!0),l=Je(null),c=Je(null),u=Je(!1),d=Je({}),h=document.getElementById("app"),m=JSON.parse(h.getAttribute("data-incoming"))||{},f=Je(m.root||"/"),v=rt(()=>`${f.value}${l.value}`),g=m.visualization_config||e.config,b=m.visualization_plugin,S=g.settings||((x=g.chart_dict)==null?void 0:x.settings)||{};g.dataset_url?(r.value=g.dataset_url,console.debug(`ViewPort: Found dataset url: ${r.value}.`)):g.dataset_id?(r.value=`${f.value}api/datasets/${g.dataset_id}/display`,console.debug(`ViewPort: Built dataset url from dataset id: ${r.value}.`)):t.value="Visualization requires `dataset_id` or `dataset_url`.",b?p(b,S):e.xml?Zn.get(e.xml).then(_=>{p(_8(e.xml,_.data),S)}):t.value="Visualization requires configuration from XML or attached `visualization_plugin` details.";function p(_,A){c.value=_.name,o.value=_.html,i.value=_.description,l.value=_.logo,_.settings&&(s.value=_.settings,s.value.forEach(C=>{let T=A[C.name]??C.value;C.type==="float"&&(T=Number(T)),d.value[C.name]=T})),a.value=!1}async function y(){u.value=!u.value,await ui(),window.dispatchEvent(new Event("resize"))}function w(_){d.value={..._}}return(_,A)=>t.value?(Mn(),js(hr(qT),{key:0,title:"Visualization Error!",type:"error",class:"m-2"},{default:bo(()=>[Ja(ac(t.value),1)]),_:1})):a.value?(Mn(),fr("div",x8,[Yn("span",null,[pn(hr(y4),{class:"animate-spin size-4 inline mx-1"})]),w8])):(Mn(),fr("div",{key:2,class:zp(["grid h-screen",{"grid-cols-[70%_30%]":!u.value}])},[nb(_.$slots,"default",{settings:d.value,datasetUrl:r.value,embedded:u.value}),u.value?(Mn(),fr("div",S8,[pn(hr(Wz),{strong:"",secondary:"",circle:"",class:"bg-sky-100 m-2",top:0,right:0,onClick:y},{default:bo(()=>[pn(hr(G1),null,{default:bo(()=>[pn(hr(_4))]),_:1})]),_:1})])):(Mn(),js(b8,{key:1,description:i.value,html:o.value,inputs:s.value,"logo-url":v.value,values:d.value,"onUpdate:values":w,onToggle:y},null,8,["description","html","inputs","logo-url","values"]))],2))}};/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Ob="158",A8=0,Ix=1,M8=2,eE=1,T8=2,Go=3,ts=0,Or=1,go=2,Jo=0,Qo=1,W1=2,Dx=3,Lx=4,E8=5,Da=100,P8=101,R8=102,Fx=103,Ox=104,I8=200,D8=201,L8=202,F8=203,j1=204,q1=205,O8=206,k8=207,B8=208,N8=209,z8=210,U8=211,$8=212,H8=213,V8=214,G8=0,W8=1,j8=2,lp=3,q8=4,X8=5,Y8=6,K8=7,tE=0,Z8=1,J8=2,zs=0,Q8=1,eU=2,tU=3,nU=4,rU=5,nE=300,xc=301,wc=302,X1=303,Y1=304,am=306,K1=1e3,Wi=1001,Z1=1002,gn=1003,kx=1004,gg=1005,Cr=1006,iU=1007,md=1008,Zi=1009,oU=1010,sU=1011,kb=1012,rE=1013,Os=1014,qi=1015,nl=1016,iE=1017,oE=1018,Ga=1020,aU=1021,Xr=1023,lU=1024,cU=1025,Wa=1026,Sc=1027,uU=1028,sE=1029,dU=1030,aE=1031,lE=1033,vg=33776,bg=33777,yg=33778,_g=33779,Bx=35840,Nx=35841,zx=35842,Ux=35843,hU=36196,$x=37492,Hx=37496,Vx=37808,Gx=37809,Wx=37810,jx=37811,qx=37812,Xx=37813,Yx=37814,Kx=37815,Zx=37816,Jx=37817,Qx=37818,e2=37819,t2=37820,n2=37821,xg=36492,r2=36494,i2=36495,fU=36283,o2=36284,s2=36285,a2=36286,cE=3e3,ja=3001,pU=3200,mU=3201,gU=0,vU=1,Si="",pr="srgb",ns="srgb-linear",Bb="display-p3",lm="display-p3-linear",cp="linear",Sn="srgb",up="rec709",dp="p3",Cl=7680,l2=519,bU=512,yU=513,_U=514,xU=515,wU=516,SU=517,CU=518,AU=519,Is=35044,Al=35048,c2="300 es",J1=1035,Yo=2e3,hp=2001;class Uc{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const o=i.indexOf(t);o!==-1&&i.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let o=0,s=i.length;o<s;o++)i[o].call(this,e);e.target=null}}}const _r=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Af=Math.PI/180,Q1=180/Math.PI;function Od(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(_r[n&255]+_r[n>>8&255]+_r[n>>16&255]+_r[n>>24&255]+"-"+_r[e&255]+_r[e>>8&255]+"-"+_r[e>>16&15|64]+_r[e>>24&255]+"-"+_r[t&63|128]+_r[t>>8&255]+"-"+_r[t>>16&255]+_r[t>>24&255]+_r[r&255]+_r[r>>8&255]+_r[r>>16&255]+_r[r>>24&255]).toLowerCase()}function jr(n,e,t){return Math.max(e,Math.min(t,n))}function MU(n,e){return(n%e+e)%e}function wg(n,e,t){return(1-t)*n+t*e}function u2(n){return(n&n-1)===0&&n!==0}function ev(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function ou(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Hr(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}class Ut{constructor(e=0,t=0){Ut.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(jr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),o=this.x-e.x,s=this.y-e.y;return this.x=o*r-s*i+e.x,this.y=o*i+s*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class qt{constructor(e,t,r,i,o,s,a,l,c){qt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,o,s,a,l,c)}set(e,t,r,i,o,s,a,l,c){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=o,u[5]=l,u[6]=r,u[7]=s,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,o=this.elements,s=r[0],a=r[3],l=r[6],c=r[1],u=r[4],d=r[7],h=r[2],m=r[5],f=r[8],v=i[0],g=i[3],b=i[6],S=i[1],p=i[4],y=i[7],w=i[2],x=i[5],_=i[8];return o[0]=s*v+a*S+l*w,o[3]=s*g+a*p+l*x,o[6]=s*b+a*y+l*_,o[1]=c*v+u*S+d*w,o[4]=c*g+u*p+d*x,o[7]=c*b+u*y+d*_,o[2]=h*v+m*S+f*w,o[5]=h*g+m*p+f*x,o[8]=h*b+m*y+f*_,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*s*u-t*a*c-r*o*u+r*a*l+i*o*c-i*s*l}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*s-a*c,h=a*l-u*o,m=c*o-s*l,f=t*d+r*h+i*m;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/f;return e[0]=d*v,e[1]=(i*c-u*r)*v,e[2]=(a*r-i*s)*v,e[3]=h*v,e[4]=(u*t-i*l)*v,e[5]=(i*o-a*t)*v,e[6]=m*v,e[7]=(r*l-c*t)*v,e[8]=(s*t-r*o)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,o,s,a){const l=Math.cos(o),c=Math.sin(o);return this.set(r*l,r*c,-r*(l*s+c*a)+s+e,-i*c,i*l,-i*(-c*s+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Sg.makeScale(e,t)),this}rotate(e){return this.premultiply(Sg.makeRotation(-e)),this}translate(e,t){return this.premultiply(Sg.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Sg=new qt;function uE(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function fp(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function TU(){const n=fp("canvas");return n.style.display="block",n}const d2={};function Wu(n){n in d2||(d2[n]=!0,console.warn(n))}const h2=new qt().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),f2=new qt().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),mh={[ns]:{transfer:cp,primaries:up,toReference:n=>n,fromReference:n=>n},[pr]:{transfer:Sn,primaries:up,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[lm]:{transfer:cp,primaries:dp,toReference:n=>n.applyMatrix3(f2),fromReference:n=>n.applyMatrix3(h2)},[Bb]:{transfer:Sn,primaries:dp,toReference:n=>n.convertSRGBToLinear().applyMatrix3(f2),fromReference:n=>n.applyMatrix3(h2).convertLinearToSRGB()}},EU=new Set([ns,lm]),fn={enabled:!0,_workingColorSpace:ns,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(n){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!n},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!EU.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const r=mh[e].toReference,i=mh[t].fromReference;return i(r(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return mh[n].primaries},getTransfer:function(n){return n===Si?cp:mh[n].transfer}};function dc(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Cg(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Ml;class dE{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Ml===void 0&&(Ml=fp("canvas")),Ml.width=e.width,Ml.height=e.height;const r=Ml.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=Ml}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=fp("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),o=i.data;for(let s=0;s<o.length;s++)o[s]=dc(o[s]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(dc(t[r]/255)*255):t[r]=dc(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let PU=0;class hE{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:PU++}),this.uuid=Od(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let o;if(Array.isArray(i)){o=[];for(let s=0,a=i.length;s<a;s++)i[s].isDataTexture?o.push(Ag(i[s].image)):o.push(Ag(i[s]))}else o=Ag(i);r.url=o}return t||(e.images[this.uuid]=r),r}}function Ag(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?dE.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let RU=0;class kr extends Uc{constructor(e=kr.DEFAULT_IMAGE,t=kr.DEFAULT_MAPPING,r=Wi,i=Wi,o=Cr,s=md,a=Xr,l=Zi,c=kr.DEFAULT_ANISOTROPY,u=Si){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:RU++}),this.uuid=Od(),this.name="",this.source=new hE(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=o,this.minFilter=s,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Ut(0,0),this.repeat=new Ut(1,1),this.center=new Ut(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new qt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(Wu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===ja?pr:Si),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==nE)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case K1:e.x=e.x-Math.floor(e.x);break;case Wi:e.x=e.x<0?0:1;break;case Z1:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case K1:e.y=e.y-Math.floor(e.y);break;case Wi:e.y=e.y<0?0:1;break;case Z1:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Wu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===pr?ja:cE}set encoding(e){Wu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===ja?pr:Si}}kr.DEFAULT_IMAGE=null;kr.DEFAULT_MAPPING=nE;kr.DEFAULT_ANISOTROPY=1;class lr{constructor(e=0,t=0,r=0,i=1){lr.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,o=this.w,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i+s[12]*o,this.y=s[1]*t+s[5]*r+s[9]*i+s[13]*o,this.z=s[2]*t+s[6]*r+s[10]*i+s[14]*o,this.w=s[3]*t+s[7]*r+s[11]*i+s[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,o;const l=e.elements,c=l[0],u=l[4],d=l[8],h=l[1],m=l[5],f=l[9],v=l[2],g=l[6],b=l[10];if(Math.abs(u-h)<.01&&Math.abs(d-v)<.01&&Math.abs(f-g)<.01){if(Math.abs(u+h)<.1&&Math.abs(d+v)<.1&&Math.abs(f+g)<.1&&Math.abs(c+m+b-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const p=(c+1)/2,y=(m+1)/2,w=(b+1)/2,x=(u+h)/4,_=(d+v)/4,A=(f+g)/4;return p>y&&p>w?p<.01?(r=0,i=.707106781,o=.707106781):(r=Math.sqrt(p),i=x/r,o=_/r):y>w?y<.01?(r=.707106781,i=0,o=.707106781):(i=Math.sqrt(y),r=x/i,o=A/i):w<.01?(r=.707106781,i=.707106781,o=0):(o=Math.sqrt(w),r=_/o,i=A/o),this.set(r,i,o,t),this}let S=Math.sqrt((g-f)*(g-f)+(d-v)*(d-v)+(h-u)*(h-u));return Math.abs(S)<.001&&(S=1),this.x=(g-f)/S,this.y=(d-v)/S,this.z=(h-u)/S,this.w=Math.acos((c+m+b-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class IU extends Uc{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new lr(0,0,e,t),this.scissorTest=!1,this.viewport=new lr(0,0,e,t);const i={width:e,height:t,depth:1};r.encoding!==void 0&&(Wu("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),r.colorSpace=r.encoding===ja?pr:Si),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Cr,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},r),this.texture=new kr(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps,this.texture.internalFormat=r.internalFormat,this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}setSize(e,t,r=1){(this.width!==e||this.height!==t||this.depth!==r)&&(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new hE(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class xo extends IU{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class fE extends kr{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=gn,this.minFilter=gn,this.wrapR=Wi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class DU extends kr{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=gn,this.minFilter=gn,this.wrapR=Wi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Br{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,o,s,a){let l=r[i+0],c=r[i+1],u=r[i+2],d=r[i+3];const h=o[s+0],m=o[s+1],f=o[s+2],v=o[s+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d;return}if(a===1){e[t+0]=h,e[t+1]=m,e[t+2]=f,e[t+3]=v;return}if(d!==v||l!==h||c!==m||u!==f){let g=1-a;const b=l*h+c*m+u*f+d*v,S=b>=0?1:-1,p=1-b*b;if(p>Number.EPSILON){const w=Math.sqrt(p),x=Math.atan2(w,b*S);g=Math.sin(g*x)/w,a=Math.sin(a*x)/w}const y=a*S;if(l=l*g+h*y,c=c*g+m*y,u=u*g+f*y,d=d*g+v*y,g===1-a){const w=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=w,c*=w,u*=w,d*=w}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,r,i,o,s){const a=r[i],l=r[i+1],c=r[i+2],u=r[i+3],d=o[s],h=o[s+1],m=o[s+2],f=o[s+3];return e[t]=a*f+u*d+l*m-c*h,e[t+1]=l*f+u*h+c*d-a*m,e[t+2]=c*f+u*m+a*h-l*d,e[t+3]=u*f-a*d-l*h-c*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const r=e._x,i=e._y,o=e._z,s=e._order,a=Math.cos,l=Math.sin,c=a(r/2),u=a(i/2),d=a(o/2),h=l(r/2),m=l(i/2),f=l(o/2);switch(s){case"XYZ":this._x=h*u*d+c*m*f,this._y=c*m*d-h*u*f,this._z=c*u*f+h*m*d,this._w=c*u*d-h*m*f;break;case"YXZ":this._x=h*u*d+c*m*f,this._y=c*m*d-h*u*f,this._z=c*u*f-h*m*d,this._w=c*u*d+h*m*f;break;case"ZXY":this._x=h*u*d-c*m*f,this._y=c*m*d+h*u*f,this._z=c*u*f+h*m*d,this._w=c*u*d-h*m*f;break;case"ZYX":this._x=h*u*d-c*m*f,this._y=c*m*d+h*u*f,this._z=c*u*f-h*m*d,this._w=c*u*d+h*m*f;break;case"YZX":this._x=h*u*d+c*m*f,this._y=c*m*d+h*u*f,this._z=c*u*f-h*m*d,this._w=c*u*d-h*m*f;break;case"XZY":this._x=h*u*d-c*m*f,this._y=c*m*d-h*u*f,this._z=c*u*f+h*m*d,this._w=c*u*d+h*m*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],o=t[8],s=t[1],a=t[5],l=t[9],c=t[2],u=t[6],d=t[10],h=r+a+d;if(h>0){const m=.5/Math.sqrt(h+1);this._w=.25/m,this._x=(u-l)*m,this._y=(o-c)*m,this._z=(s-i)*m}else if(r>a&&r>d){const m=2*Math.sqrt(1+r-a-d);this._w=(u-l)/m,this._x=.25*m,this._y=(i+s)/m,this._z=(o+c)/m}else if(a>d){const m=2*Math.sqrt(1+a-r-d);this._w=(o-c)/m,this._x=(i+s)/m,this._y=.25*m,this._z=(l+u)/m}else{const m=2*Math.sqrt(1+d-r-a);this._w=(s-i)/m,this._x=(o+c)/m,this._y=(l+u)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(jr(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,o=e._z,s=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=r*u+s*a+i*c-o*l,this._y=i*u+s*l+o*a-r*c,this._z=o*u+s*c+r*l-i*a,this._w=s*u-r*a-i*l-o*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,o=this._z,s=this._w;let a=s*e._w+r*e._x+i*e._y+o*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=r,this._y=i,this._z=o,this;const l=1-a*a;if(l<=Number.EPSILON){const m=1-t;return this._w=m*s+t*this._w,this._x=m*r+t*this._x,this._y=m*i+t*this._y,this._z=m*o+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),d=Math.sin((1-t)*u)/c,h=Math.sin(t*u)/c;return this._w=s*d+this._w*h,this._x=r*d+this._x*h,this._y=i*d+this._y*h,this._z=o*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),i=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(t*Math.cos(i),r*Math.sin(o),r*Math.cos(o),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class te{constructor(e=0,t=0,r=0){te.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(p2.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(p2.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[3]*r+o[6]*i,this.y=o[1]*t+o[4]*r+o[7]*i,this.z=o[2]*t+o[5]*r+o[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,o=e.elements,s=1/(o[3]*t+o[7]*r+o[11]*i+o[15]);return this.x=(o[0]*t+o[4]*r+o[8]*i+o[12])*s,this.y=(o[1]*t+o[5]*r+o[9]*i+o[13])*s,this.z=(o[2]*t+o[6]*r+o[10]*i+o[14])*s,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,o=e.x,s=e.y,a=e.z,l=e.w,c=2*(s*i-a*r),u=2*(a*t-o*i),d=2*(o*r-s*t);return this.x=t+l*c+s*d-a*u,this.y=r+l*u+a*c-o*d,this.z=i+l*d+o*u-s*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i,this.y=o[1]*t+o[5]*r+o[9]*i,this.z=o[2]*t+o[6]*r+o[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,o=e.z,s=t.x,a=t.y,l=t.z;return this.x=i*l-o*a,this.y=o*s-r*l,this.z=r*a-i*s,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return Mg.copy(this).projectOnVector(e),this.sub(Mg)}reflect(e){return this.sub(Mg.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(jr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Mg=new te,p2=new Br;class Nn{constructor(e=new te(1/0,1/0,1/0),t=new te(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Fi.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Fi.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Fi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const o=r.getAttribute("position");if(t===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let s=0,a=o.count;s<a;s++)e.isMesh===!0?e.getVertexPosition(s,Fi):Fi.fromBufferAttribute(o,s),Fi.applyMatrix4(e.matrixWorld),this.expandByPoint(Fi);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),gh.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),gh.copy(r.boundingBox)),gh.applyMatrix4(e.matrixWorld),this.union(gh)}const i=e.children;for(let o=0,s=i.length;o<s;o++)this.expandByObject(i[o],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Fi),Fi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(su),vh.subVectors(this.max,su),Tl.subVectors(e.a,su),El.subVectors(e.b,su),Pl.subVectors(e.c,su),vs.subVectors(El,Tl),bs.subVectors(Pl,El),ya.subVectors(Tl,Pl);let t=[0,-vs.z,vs.y,0,-bs.z,bs.y,0,-ya.z,ya.y,vs.z,0,-vs.x,bs.z,0,-bs.x,ya.z,0,-ya.x,-vs.y,vs.x,0,-bs.y,bs.x,0,-ya.y,ya.x,0];return!Tg(t,Tl,El,Pl,vh)||(t=[1,0,0,0,1,0,0,0,1],!Tg(t,Tl,El,Pl,vh))?!1:(bh.crossVectors(vs,bs),t=[bh.x,bh.y,bh.z],Tg(t,Tl,El,Pl,vh))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Fi).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Fi).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Lo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Lo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Lo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Lo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Lo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Lo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Lo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Lo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Lo),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Lo=[new te,new te,new te,new te,new te,new te,new te,new te],Fi=new te,gh=new Nn,Tl=new te,El=new te,Pl=new te,vs=new te,bs=new te,ya=new te,su=new te,vh=new te,bh=new te,_a=new te;function Tg(n,e,t,r,i){for(let o=0,s=n.length-3;o<=s;o+=3){_a.fromArray(n,o);const a=i.x*Math.abs(_a.x)+i.y*Math.abs(_a.y)+i.z*Math.abs(_a.z),l=e.dot(_a),c=t.dot(_a),u=r.dot(_a);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const LU=new Nn,au=new te,Eg=new te;class kd{constructor(e=new te,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):LU.setFromPoints(e).getCenter(r);let i=0;for(let o=0,s=e.length;o<s;o++)i=Math.max(i,r.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;au.subVectors(e,this.center);const t=au.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(au,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Eg.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(au.copy(e.center).add(Eg)),this.expandByPoint(au.copy(e.center).sub(Eg))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Fo=new te,Pg=new te,yh=new te,ys=new te,Rg=new te,_h=new te,Ig=new te;class Nb{constructor(e=new te,t=new te(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Fo)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Fo.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Fo.copy(this.origin).addScaledVector(this.direction,t),Fo.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){Pg.copy(e).add(t).multiplyScalar(.5),yh.copy(t).sub(e).normalize(),ys.copy(this.origin).sub(Pg);const o=e.distanceTo(t)*.5,s=-this.direction.dot(yh),a=ys.dot(this.direction),l=-ys.dot(yh),c=ys.lengthSq(),u=Math.abs(1-s*s);let d,h,m,f;if(u>0)if(d=s*l-a,h=s*a-l,f=o*u,d>=0)if(h>=-f)if(h<=f){const v=1/u;d*=v,h*=v,m=d*(d+s*h+2*a)+h*(s*d+h+2*l)+c}else h=o,d=Math.max(0,-(s*h+a)),m=-d*d+h*(h+2*l)+c;else h=-o,d=Math.max(0,-(s*h+a)),m=-d*d+h*(h+2*l)+c;else h<=-f?(d=Math.max(0,-(-s*o+a)),h=d>0?-o:Math.min(Math.max(-o,-l),o),m=-d*d+h*(h+2*l)+c):h<=f?(d=0,h=Math.min(Math.max(-o,-l),o),m=h*(h+2*l)+c):(d=Math.max(0,-(s*o+a)),h=d>0?o:Math.min(Math.max(-o,-l),o),m=-d*d+h*(h+2*l)+c);else h=s>0?-o:o,d=Math.max(0,-(s*h+a)),m=-d*d+h*(h+2*l)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,d),i&&i.copy(Pg).addScaledVector(yh,h),m}intersectSphere(e,t){Fo.subVectors(e.center,this.origin);const r=Fo.dot(this.direction),i=Fo.dot(Fo)-r*r,o=e.radius*e.radius;if(i>o)return null;const s=Math.sqrt(o-i),a=r-s,l=r+s;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,o,s,a,l;const c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return c>=0?(r=(e.min.x-h.x)*c,i=(e.max.x-h.x)*c):(r=(e.max.x-h.x)*c,i=(e.min.x-h.x)*c),u>=0?(o=(e.min.y-h.y)*u,s=(e.max.y-h.y)*u):(o=(e.max.y-h.y)*u,s=(e.min.y-h.y)*u),r>s||o>i||((o>r||isNaN(r))&&(r=o),(s<i||isNaN(i))&&(i=s),d>=0?(a=(e.min.z-h.z)*d,l=(e.max.z-h.z)*d):(a=(e.max.z-h.z)*d,l=(e.min.z-h.z)*d),r>l||a>i)||((a>r||r!==r)&&(r=a),(l<i||i!==i)&&(i=l),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,Fo)!==null}intersectTriangle(e,t,r,i,o){Rg.subVectors(t,e),_h.subVectors(r,e),Ig.crossVectors(Rg,_h);let s=this.direction.dot(Ig),a;if(s>0){if(i)return null;a=1}else if(s<0)a=-1,s=-s;else return null;ys.subVectors(this.origin,e);const l=a*this.direction.dot(_h.crossVectors(ys,_h));if(l<0)return null;const c=a*this.direction.dot(Rg.cross(ys));if(c<0||l+c>s)return null;const u=-a*ys.dot(Ig);return u<0?null:this.at(u/s,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class at{constructor(e,t,r,i,o,s,a,l,c,u,d,h,m,f,v,g){at.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,o,s,a,l,c,u,d,h,m,f,v,g)}set(e,t,r,i,o,s,a,l,c,u,d,h,m,f,v,g){const b=this.elements;return b[0]=e,b[4]=t,b[8]=r,b[12]=i,b[1]=o,b[5]=s,b[9]=a,b[13]=l,b[2]=c,b[6]=u,b[10]=d,b[14]=h,b[3]=m,b[7]=f,b[11]=v,b[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new at().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/Rl.setFromMatrixColumn(e,0).length(),o=1/Rl.setFromMatrixColumn(e,1).length(),s=1/Rl.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*o,t[5]=r[5]*o,t[6]=r[6]*o,t[7]=0,t[8]=r[8]*s,t[9]=r[9]*s,t[10]=r[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,o=e.z,s=Math.cos(r),a=Math.sin(r),l=Math.cos(i),c=Math.sin(i),u=Math.cos(o),d=Math.sin(o);if(e.order==="XYZ"){const h=s*u,m=s*d,f=a*u,v=a*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=m+f*c,t[5]=h-v*c,t[9]=-a*l,t[2]=v-h*c,t[6]=f+m*c,t[10]=s*l}else if(e.order==="YXZ"){const h=l*u,m=l*d,f=c*u,v=c*d;t[0]=h+v*a,t[4]=f*a-m,t[8]=s*c,t[1]=s*d,t[5]=s*u,t[9]=-a,t[2]=m*a-f,t[6]=v+h*a,t[10]=s*l}else if(e.order==="ZXY"){const h=l*u,m=l*d,f=c*u,v=c*d;t[0]=h-v*a,t[4]=-s*d,t[8]=f+m*a,t[1]=m+f*a,t[5]=s*u,t[9]=v-h*a,t[2]=-s*c,t[6]=a,t[10]=s*l}else if(e.order==="ZYX"){const h=s*u,m=s*d,f=a*u,v=a*d;t[0]=l*u,t[4]=f*c-m,t[8]=h*c+v,t[1]=l*d,t[5]=v*c+h,t[9]=m*c-f,t[2]=-c,t[6]=a*l,t[10]=s*l}else if(e.order==="YZX"){const h=s*l,m=s*c,f=a*l,v=a*c;t[0]=l*u,t[4]=v-h*d,t[8]=f*d+m,t[1]=d,t[5]=s*u,t[9]=-a*u,t[2]=-c*u,t[6]=m*d+f,t[10]=h-v*d}else if(e.order==="XZY"){const h=s*l,m=s*c,f=a*l,v=a*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=h*d+v,t[5]=s*u,t[9]=m*d-f,t[2]=f*d-m,t[6]=a*u,t[10]=v*d+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(FU,e,OU)}lookAt(e,t,r){const i=this.elements;return ni.subVectors(e,t),ni.lengthSq()===0&&(ni.z=1),ni.normalize(),_s.crossVectors(r,ni),_s.lengthSq()===0&&(Math.abs(r.z)===1?ni.x+=1e-4:ni.z+=1e-4,ni.normalize(),_s.crossVectors(r,ni)),_s.normalize(),xh.crossVectors(ni,_s),i[0]=_s.x,i[4]=xh.x,i[8]=ni.x,i[1]=_s.y,i[5]=xh.y,i[9]=ni.y,i[2]=_s.z,i[6]=xh.z,i[10]=ni.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,o=this.elements,s=r[0],a=r[4],l=r[8],c=r[12],u=r[1],d=r[5],h=r[9],m=r[13],f=r[2],v=r[6],g=r[10],b=r[14],S=r[3],p=r[7],y=r[11],w=r[15],x=i[0],_=i[4],A=i[8],C=i[12],T=i[1],I=i[5],M=i[9],P=i[13],E=i[2],R=i[6],B=i[10],L=i[14],F=i[3],H=i[7],$=i[11],O=i[15];return o[0]=s*x+a*T+l*E+c*F,o[4]=s*_+a*I+l*R+c*H,o[8]=s*A+a*M+l*B+c*$,o[12]=s*C+a*P+l*L+c*O,o[1]=u*x+d*T+h*E+m*F,o[5]=u*_+d*I+h*R+m*H,o[9]=u*A+d*M+h*B+m*$,o[13]=u*C+d*P+h*L+m*O,o[2]=f*x+v*T+g*E+b*F,o[6]=f*_+v*I+g*R+b*H,o[10]=f*A+v*M+g*B+b*$,o[14]=f*C+v*P+g*L+b*O,o[3]=S*x+p*T+y*E+w*F,o[7]=S*_+p*I+y*R+w*H,o[11]=S*A+p*M+y*B+w*$,o[15]=S*C+p*P+y*L+w*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],o=e[12],s=e[1],a=e[5],l=e[9],c=e[13],u=e[2],d=e[6],h=e[10],m=e[14],f=e[3],v=e[7],g=e[11],b=e[15];return f*(+o*l*d-i*c*d-o*a*h+r*c*h+i*a*m-r*l*m)+v*(+t*l*m-t*c*h+o*s*h-i*s*m+i*c*u-o*l*u)+g*(+t*c*d-t*a*m-o*s*d+r*s*m+o*a*u-r*c*u)+b*(-i*a*u-t*l*d+t*a*h+i*s*d-r*s*h+r*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],m=e[11],f=e[12],v=e[13],g=e[14],b=e[15],S=d*g*c-v*h*c+v*l*m-a*g*m-d*l*b+a*h*b,p=f*h*c-u*g*c-f*l*m+s*g*m+u*l*b-s*h*b,y=u*v*c-f*d*c+f*a*m-s*v*m-u*a*b+s*d*b,w=f*d*l-u*v*l-f*a*h+s*v*h+u*a*g-s*d*g,x=t*S+r*p+i*y+o*w;if(x===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/x;return e[0]=S*_,e[1]=(v*h*o-d*g*o-v*i*m+r*g*m+d*i*b-r*h*b)*_,e[2]=(a*g*o-v*l*o+v*i*c-r*g*c-a*i*b+r*l*b)*_,e[3]=(d*l*o-a*h*o-d*i*c+r*h*c+a*i*m-r*l*m)*_,e[4]=p*_,e[5]=(u*g*o-f*h*o+f*i*m-t*g*m-u*i*b+t*h*b)*_,e[6]=(f*l*o-s*g*o-f*i*c+t*g*c+s*i*b-t*l*b)*_,e[7]=(s*h*o-u*l*o+u*i*c-t*h*c-s*i*m+t*l*m)*_,e[8]=y*_,e[9]=(f*d*o-u*v*o-f*r*m+t*v*m+u*r*b-t*d*b)*_,e[10]=(s*v*o-f*a*o+f*r*c-t*v*c-s*r*b+t*a*b)*_,e[11]=(u*a*o-s*d*o-u*r*c+t*d*c+s*r*m-t*a*m)*_,e[12]=w*_,e[13]=(u*v*i-f*d*i+f*r*h-t*v*h-u*r*g+t*d*g)*_,e[14]=(f*a*i-s*v*i-f*r*l+t*v*l+s*r*g-t*a*g)*_,e[15]=(s*d*i-u*a*i+u*r*l-t*d*l-s*r*h+t*a*h)*_,this}scale(e){const t=this.elements,r=e.x,i=e.y,o=e.z;return t[0]*=r,t[4]*=i,t[8]*=o,t[1]*=r,t[5]*=i,t[9]*=o,t[2]*=r,t[6]*=i,t[10]*=o,t[3]*=r,t[7]*=i,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),o=1-r,s=e.x,a=e.y,l=e.z,c=o*s,u=o*a;return this.set(c*s+r,c*a-i*l,c*l+i*a,0,c*a+i*l,u*a+r,u*l-i*s,0,c*l-i*a,u*l+i*s,o*l*l+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,o,s){return this.set(1,r,o,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,o=t._x,s=t._y,a=t._z,l=t._w,c=o+o,u=s+s,d=a+a,h=o*c,m=o*u,f=o*d,v=s*u,g=s*d,b=a*d,S=l*c,p=l*u,y=l*d,w=r.x,x=r.y,_=r.z;return i[0]=(1-(v+b))*w,i[1]=(m+y)*w,i[2]=(f-p)*w,i[3]=0,i[4]=(m-y)*x,i[5]=(1-(h+b))*x,i[6]=(g+S)*x,i[7]=0,i[8]=(f+p)*_,i[9]=(g-S)*_,i[10]=(1-(h+v))*_,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let o=Rl.set(i[0],i[1],i[2]).length();const s=Rl.set(i[4],i[5],i[6]).length(),a=Rl.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),e.x=i[12],e.y=i[13],e.z=i[14],Oi.copy(this);const c=1/o,u=1/s,d=1/a;return Oi.elements[0]*=c,Oi.elements[1]*=c,Oi.elements[2]*=c,Oi.elements[4]*=u,Oi.elements[5]*=u,Oi.elements[6]*=u,Oi.elements[8]*=d,Oi.elements[9]*=d,Oi.elements[10]*=d,t.setFromRotationMatrix(Oi),r.x=o,r.y=s,r.z=a,this}makePerspective(e,t,r,i,o,s,a=Yo){const l=this.elements,c=2*o/(t-e),u=2*o/(r-i),d=(t+e)/(t-e),h=(r+i)/(r-i);let m,f;if(a===Yo)m=-(s+o)/(s-o),f=-2*s*o/(s-o);else if(a===hp)m=-s/(s-o),f=-s*o/(s-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=u,l[9]=h,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,r,i,o,s,a=Yo){const l=this.elements,c=1/(t-e),u=1/(r-i),d=1/(s-o),h=(t+e)*c,m=(r+i)*u;let f,v;if(a===Yo)f=(s+o)*d,v=-2*d;else if(a===hp)f=o*d,v=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-h,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-m,l[2]=0,l[6]=0,l[10]=v,l[14]=-f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const Rl=new te,Oi=new at,FU=new te(0,0,0),OU=new te(1,1,1),_s=new te,xh=new te,ni=new te,m2=new at,g2=new Br;class Cc{constructor(e=0,t=0,r=0,i=Cc.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,o=i[0],s=i[4],a=i[8],l=i[1],c=i[5],u=i[9],d=i[2],h=i[6],m=i[10];switch(t){case"XYZ":this._y=Math.asin(jr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,m),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(h,c),this._z=0);break;case"YXZ":this._x=Math.asin(-jr(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,m),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,o),this._z=0);break;case"ZXY":this._x=Math.asin(jr(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-d,m),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-jr(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(h,m),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(jr(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(a,m));break;case"XZY":this._z=Math.asin(-jr(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return m2.makeRotationFromQuaternion(e),this.setFromRotationMatrix(m2,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return g2.setFromEuler(this),this.setFromQuaternion(g2,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Cc.DEFAULT_ORDER="XYZ";class pE{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let kU=0;const v2=new te,Il=new Br,Oo=new at,wh=new te,lu=new te,BU=new te,NU=new Br,b2=new te(1,0,0),y2=new te(0,1,0),_2=new te(0,0,1),zU={type:"added"},UU={type:"removed"};class cr extends Uc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:kU++}),this.uuid=Od(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=cr.DEFAULT_UP.clone();const e=new te,t=new Cc,r=new Br,i=new te(1,1,1);function o(){r.setFromEuler(t,!1)}function s(){t.setFromQuaternion(r,void 0,!1)}t._onChange(o),r._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new at},normalMatrix:{value:new qt}}),this.matrix=new at,this.matrixWorld=new at,this.matrixAutoUpdate=cr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=cr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new pE,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Il.setFromAxisAngle(e,t),this.quaternion.multiply(Il),this}rotateOnWorldAxis(e,t){return Il.setFromAxisAngle(e,t),this.quaternion.premultiply(Il),this}rotateX(e){return this.rotateOnAxis(b2,e)}rotateY(e){return this.rotateOnAxis(y2,e)}rotateZ(e){return this.rotateOnAxis(_2,e)}translateOnAxis(e,t){return v2.copy(e).applyQuaternion(this.quaternion),this.position.add(v2.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(b2,e)}translateY(e){return this.translateOnAxis(y2,e)}translateZ(e){return this.translateOnAxis(_2,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Oo.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?wh.copy(e):wh.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),lu.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Oo.lookAt(lu,wh,this.up):Oo.lookAt(wh,lu,this.up),this.quaternion.setFromRotationMatrix(Oo),i&&(Oo.extractRotation(i.matrixWorld),Il.setFromRotationMatrix(Oo),this.quaternion.premultiply(Il.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(zU)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(UU)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Oo.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Oo.multiply(e.parent.matrixWorld)),e.applyMatrix4(Oo),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const s=this.children[r].getObjectByProperty(e,t);if(s!==void 0)return s}}getObjectsByProperty(e,t){let r=[];this[e]===t&&r.push(this);for(let i=0,o=this.children.length;i<o;i++){const s=this.children[i].getObjectsByProperty(e,t);s.length>0&&(r=r.concat(s))}return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(lu,e,BU),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(lu,NU,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++){const o=t[r];(o.matrixWorldAutoUpdate===!0||e===!0)&&o.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let o=0,s=i.length;o<s;o++){const a=i[o];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function o(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=o(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const d=l[c];o(e.shapes,d)}else o(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(o(e.materials,this.material[l]));i.material=a}else i.material=o(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];i.animations.push(o(e.animations,l))}}if(t){const a=s(e.geometries),l=s(e.materials),c=s(e.textures),u=s(e.images),d=s(e.shapes),h=s(e.skeletons),m=s(e.animations),f=s(e.nodes);a.length>0&&(r.geometries=a),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),u.length>0&&(r.images=u),d.length>0&&(r.shapes=d),h.length>0&&(r.skeletons=h),m.length>0&&(r.animations=m),f.length>0&&(r.nodes=f)}return r.object=i,r;function s(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}cr.DEFAULT_UP=new te(0,1,0);cr.DEFAULT_MATRIX_AUTO_UPDATE=!0;cr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ki=new te,ko=new te,Dg=new te,Bo=new te,Dl=new te,Ll=new te,x2=new te,Lg=new te,Fg=new te,Og=new te;let Sh=!1;class Vi{constructor(e=new te,t=new te,r=new te){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),ki.subVectors(e,t),i.cross(ki);const o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}static getBarycoord(e,t,r,i,o){ki.subVectors(i,t),ko.subVectors(r,t),Dg.subVectors(e,t);const s=ki.dot(ki),a=ki.dot(ko),l=ki.dot(Dg),c=ko.dot(ko),u=ko.dot(Dg),d=s*c-a*a;if(d===0)return o.set(-2,-1,-1);const h=1/d,m=(c*l-a*u)*h,f=(s*u-a*l)*h;return o.set(1-m-f,f,m)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,Bo),Bo.x>=0&&Bo.y>=0&&Bo.x+Bo.y<=1}static getUV(e,t,r,i,o,s,a,l){return Sh===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Sh=!0),this.getInterpolation(e,t,r,i,o,s,a,l)}static getInterpolation(e,t,r,i,o,s,a,l){return this.getBarycoord(e,t,r,i,Bo),l.setScalar(0),l.addScaledVector(o,Bo.x),l.addScaledVector(s,Bo.y),l.addScaledVector(a,Bo.z),l}static isFrontFacing(e,t,r,i){return ki.subVectors(r,t),ko.subVectors(e,t),ki.cross(ko).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ki.subVectors(this.c,this.b),ko.subVectors(this.a,this.b),ki.cross(ko).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Vi.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Vi.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,i,o){return Sh===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Sh=!0),Vi.getInterpolation(e,this.a,this.b,this.c,t,r,i,o)}getInterpolation(e,t,r,i,o){return Vi.getInterpolation(e,this.a,this.b,this.c,t,r,i,o)}containsPoint(e){return Vi.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Vi.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,o=this.c;let s,a;Dl.subVectors(i,r),Ll.subVectors(o,r),Lg.subVectors(e,r);const l=Dl.dot(Lg),c=Ll.dot(Lg);if(l<=0&&c<=0)return t.copy(r);Fg.subVectors(e,i);const u=Dl.dot(Fg),d=Ll.dot(Fg);if(u>=0&&d<=u)return t.copy(i);const h=l*d-u*c;if(h<=0&&l>=0&&u<=0)return s=l/(l-u),t.copy(r).addScaledVector(Dl,s);Og.subVectors(e,o);const m=Dl.dot(Og),f=Ll.dot(Og);if(f>=0&&m<=f)return t.copy(o);const v=m*c-l*f;if(v<=0&&c>=0&&f<=0)return a=c/(c-f),t.copy(r).addScaledVector(Ll,a);const g=u*f-m*d;if(g<=0&&d-u>=0&&m-f>=0)return x2.subVectors(o,i),a=(d-u)/(d-u+(m-f)),t.copy(i).addScaledVector(x2,a);const b=1/(g+v+h);return s=v*b,a=h*b,t.copy(r).addScaledVector(Dl,s).addScaledVector(Ll,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const mE={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},xs={h:0,s:0,l:0},Ch={h:0,s:0,l:0};function kg(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class _t{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=pr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,fn.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=fn.workingColorSpace){return this.r=e,this.g=t,this.b=r,fn.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=fn.workingColorSpace){if(e=MU(e,1),t=jr(t,0,1),r=jr(r,0,1),t===0)this.r=this.g=this.b=r;else{const o=r<=.5?r*(1+t):r+t-r*t,s=2*r-o;this.r=kg(s,o,e+1/3),this.g=kg(s,o,e),this.b=kg(s,o,e-1/3)}return fn.toWorkingColorSpace(this,i),this}setStyle(e,t=pr){function r(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const s=i[1],a=i[2];switch(s){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,t);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,t);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=i[1],s=o.length;if(s===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,t);if(s===6)return this.setHex(parseInt(o,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=pr){const r=mE[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=dc(e.r),this.g=dc(e.g),this.b=dc(e.b),this}copyLinearToSRGB(e){return this.r=Cg(e.r),this.g=Cg(e.g),this.b=Cg(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=pr){return fn.fromWorkingColorSpace(xr.copy(this),e),Math.round(jr(xr.r*255,0,255))*65536+Math.round(jr(xr.g*255,0,255))*256+Math.round(jr(xr.b*255,0,255))}getHexString(e=pr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=fn.workingColorSpace){fn.fromWorkingColorSpace(xr.copy(this),t);const r=xr.r,i=xr.g,o=xr.b,s=Math.max(r,i,o),a=Math.min(r,i,o);let l,c;const u=(a+s)/2;if(a===s)l=0,c=0;else{const d=s-a;switch(c=u<=.5?d/(s+a):d/(2-s-a),s){case r:l=(i-o)/d+(i<o?6:0);break;case i:l=(o-r)/d+2;break;case o:l=(r-i)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=fn.workingColorSpace){return fn.fromWorkingColorSpace(xr.copy(this),t),e.r=xr.r,e.g=xr.g,e.b=xr.b,e}getStyle(e=pr){fn.fromWorkingColorSpace(xr.copy(this),e);const t=xr.r,r=xr.g,i=xr.b;return e!==pr?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,t,r){return this.getHSL(xs),this.setHSL(xs.h+e,xs.s+t,xs.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(xs),e.getHSL(Ch);const r=wg(xs.h,Ch.h,t),i=wg(xs.s,Ch.s,t),o=wg(xs.l,Ch.l,t);return this.setHSL(r,i,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,o=e.elements;return this.r=o[0]*t+o[3]*r+o[6]*i,this.g=o[1]*t+o[4]*r+o[7]*i,this.b=o[2]*t+o[5]*r+o[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const xr=new _t;_t.NAMES=mE;let $U=0;class $c extends Uc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:$U++}),this.uuid=Od(),this.name="",this.type="Material",this.blending=Qo,this.side=ts,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=j1,this.blendDst=q1,this.blendEquation=Da,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new _t(0,0,0),this.blendAlpha=0,this.depthFunc=lp,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=l2,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Cl,this.stencilZFail=Cl,this.stencilZPass=Cl,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Qo&&(r.blending=this.blending),this.side!==ts&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==j1&&(r.blendSrc=this.blendSrc),this.blendDst!==q1&&(r.blendDst=this.blendDst),this.blendEquation!==Da&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==lp&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==l2&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Cl&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Cl&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Cl&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(o){const s=[];for(const a in o){const l=o[a];delete l.metadata,s.push(l)}return s}if(t){const o=i(e.textures),s=i(e.images);o.length>0&&(r.textures=o),s.length>0&&(r.images=s)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let o=0;o!==i;++o)r[o]=t[o].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class gE extends $c{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new _t(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=tE,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const qn=new te,Ah=new Ut;class Wn{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=Is,this.updateRange={offset:0,count:-1},this.gpuType=qi,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,o=this.itemSize;i<o;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)Ah.fromBufferAttribute(this,t),Ah.applyMatrix3(e),this.setXY(t,Ah.x,Ah.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)qn.fromBufferAttribute(this,t),qn.applyMatrix3(e),this.setXYZ(t,qn.x,qn.y,qn.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)qn.fromBufferAttribute(this,t),qn.applyMatrix4(e),this.setXYZ(t,qn.x,qn.y,qn.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)qn.fromBufferAttribute(this,t),qn.applyNormalMatrix(e),this.setXYZ(t,qn.x,qn.y,qn.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)qn.fromBufferAttribute(this,t),qn.transformDirection(e),this.setXYZ(t,qn.x,qn.y,qn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=ou(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Hr(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ou(t,this.array)),t}setX(e,t){return this.normalized&&(t=Hr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ou(t,this.array)),t}setY(e,t){return this.normalized&&(t=Hr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ou(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Hr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ou(t,this.array)),t}setW(e,t){return this.normalized&&(t=Hr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Hr(t,this.array),r=Hr(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=Hr(t,this.array),r=Hr(r,this.array),i=Hr(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,o){return e*=this.itemSize,this.normalized&&(t=Hr(t,this.array),r=Hr(r,this.array),i=Hr(i,this.array),o=Hr(o,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Is&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}class vE extends Wn{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class bE extends Wn{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class ur extends Wn{constructor(e,t,r){super(new Float32Array(e),t,r)}}let HU=0;const vi=new at,Bg=new cr,Fl=new te,ri=new Nn,cu=new Nn,or=new te;class tr extends Uc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:HU++}),this.uuid=Od(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(uE(e)?bE:vE)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const o=new qt().getNormalMatrix(e);r.applyNormalMatrix(o),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return vi.makeRotationFromQuaternion(e),this.applyMatrix4(vi),this}rotateX(e){return vi.makeRotationX(e),this.applyMatrix4(vi),this}rotateY(e){return vi.makeRotationY(e),this.applyMatrix4(vi),this}rotateZ(e){return vi.makeRotationZ(e),this.applyMatrix4(vi),this}translate(e,t,r){return vi.makeTranslation(e,t,r),this.applyMatrix4(vi),this}scale(e,t,r){return vi.makeScale(e,t,r),this.applyMatrix4(vi),this}lookAt(e){return Bg.lookAt(e),Bg.updateMatrix(),this.applyMatrix4(Bg.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Fl).negate(),this.translate(Fl.x,Fl.y,Fl.z),this}setFromPoints(e){const t=[];for(let r=0,i=e.length;r<i;r++){const o=e[r];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new ur(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Nn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new te(-1/0,-1/0,-1/0),new te(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const o=t[r];ri.setFromBufferAttribute(o),this.morphTargetsRelative?(or.addVectors(this.boundingBox.min,ri.min),this.boundingBox.expandByPoint(or),or.addVectors(this.boundingBox.max,ri.max),this.boundingBox.expandByPoint(or)):(this.boundingBox.expandByPoint(ri.min),this.boundingBox.expandByPoint(ri.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new kd);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new te,1/0);return}if(e){const r=this.boundingSphere.center;if(ri.setFromBufferAttribute(e),t)for(let o=0,s=t.length;o<s;o++){const a=t[o];cu.setFromBufferAttribute(a),this.morphTargetsRelative?(or.addVectors(ri.min,cu.min),ri.expandByPoint(or),or.addVectors(ri.max,cu.max),ri.expandByPoint(or)):(ri.expandByPoint(cu.min),ri.expandByPoint(cu.max))}ri.getCenter(r);let i=0;for(let o=0,s=e.count;o<s;o++)or.fromBufferAttribute(e,o),i=Math.max(i,r.distanceToSquared(or));if(t)for(let o=0,s=t.length;o<s;o++){const a=t[o],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)or.fromBufferAttribute(a,c),l&&(Fl.fromBufferAttribute(e,c),or.add(Fl)),i=Math.max(i,r.distanceToSquared(or))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=e.array,i=t.position.array,o=t.normal.array,s=t.uv.array,a=i.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Wn(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let T=0;T<a;T++)c[T]=new te,u[T]=new te;const d=new te,h=new te,m=new te,f=new Ut,v=new Ut,g=new Ut,b=new te,S=new te;function p(T,I,M){d.fromArray(i,T*3),h.fromArray(i,I*3),m.fromArray(i,M*3),f.fromArray(s,T*2),v.fromArray(s,I*2),g.fromArray(s,M*2),h.sub(d),m.sub(d),v.sub(f),g.sub(f);const P=1/(v.x*g.y-g.x*v.y);isFinite(P)&&(b.copy(h).multiplyScalar(g.y).addScaledVector(m,-v.y).multiplyScalar(P),S.copy(m).multiplyScalar(v.x).addScaledVector(h,-g.x).multiplyScalar(P),c[T].add(b),c[I].add(b),c[M].add(b),u[T].add(S),u[I].add(S),u[M].add(S))}let y=this.groups;y.length===0&&(y=[{start:0,count:r.length}]);for(let T=0,I=y.length;T<I;++T){const M=y[T],P=M.start,E=M.count;for(let R=P,B=P+E;R<B;R+=3)p(r[R+0],r[R+1],r[R+2])}const w=new te,x=new te,_=new te,A=new te;function C(T){_.fromArray(o,T*3),A.copy(_);const I=c[T];w.copy(I),w.sub(_.multiplyScalar(_.dot(I))).normalize(),x.crossVectors(A,I);const P=x.dot(u[T])<0?-1:1;l[T*4]=w.x,l[T*4+1]=w.y,l[T*4+2]=w.z,l[T*4+3]=P}for(let T=0,I=y.length;T<I;++T){const M=y[T],P=M.start,E=M.count;for(let R=P,B=P+E;R<B;R+=3)C(r[R+0]),C(r[R+1]),C(r[R+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Wn(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let h=0,m=r.count;h<m;h++)r.setXYZ(h,0,0,0);const i=new te,o=new te,s=new te,a=new te,l=new te,c=new te,u=new te,d=new te;if(e)for(let h=0,m=e.count;h<m;h+=3){const f=e.getX(h+0),v=e.getX(h+1),g=e.getX(h+2);i.fromBufferAttribute(t,f),o.fromBufferAttribute(t,v),s.fromBufferAttribute(t,g),u.subVectors(s,o),d.subVectors(i,o),u.cross(d),a.fromBufferAttribute(r,f),l.fromBufferAttribute(r,v),c.fromBufferAttribute(r,g),a.add(u),l.add(u),c.add(u),r.setXYZ(f,a.x,a.y,a.z),r.setXYZ(v,l.x,l.y,l.z),r.setXYZ(g,c.x,c.y,c.z)}else for(let h=0,m=t.count;h<m;h+=3)i.fromBufferAttribute(t,h+0),o.fromBufferAttribute(t,h+1),s.fromBufferAttribute(t,h+2),u.subVectors(s,o),d.subVectors(i,o),u.cross(d),r.setXYZ(h+0,u.x,u.y,u.z),r.setXYZ(h+1,u.x,u.y,u.z),r.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)or.fromBufferAttribute(e,t),or.normalize(),e.setXYZ(t,or.x,or.y,or.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,d=a.normalized,h=new c.constructor(l.length*u);let m=0,f=0;for(let v=0,g=l.length;v<g;v++){a.isInterleavedBufferAttribute?m=l[v]*a.data.stride+a.offset:m=l[v]*u;for(let b=0;b<u;b++)h[f++]=c[m++]}return new Wn(h,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new tr,r=this.index.array,i=this.attributes;for(const a in i){const l=i[a],c=e(l,r);t.setAttribute(a,c)}const o=this.morphAttributes;for(const a in o){const l=[],c=o[a];for(let u=0,d=c.length;u<d;u++){const h=c[u],m=e(h,r);l.push(m)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let a=0,l=s.length;a<l;a++){const c=s[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const l in r){const c=r[l];e.data.attributes[l]=c.toJSON(e.data)}const i={};let o=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let d=0,h=c.length;d<h;d++){const m=c[d];u.push(m.toJSON(e.data))}u.length>0&&(i[l]=u,o=!0)}o&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(t));const i=e.attributes;for(const c in i){const u=i[c];this.setAttribute(c,u.clone(t))}const o=e.morphAttributes;for(const c in o){const u=[],d=o[c];for(let h=0,m=d.length;h<m;h++)u.push(d[h].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let c=0,u=s.length;c<u;c++){const d=s[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const w2=new at,xa=new Nb,Mh=new kd,S2=new te,Ol=new te,kl=new te,Bl=new te,Ng=new te,Th=new te,Eh=new Ut,Ph=new Ut,Rh=new Ut,C2=new te,A2=new te,M2=new te,Ih=new te,Dh=new te;class yo extends cr{constructor(e=new tr,t=new gE){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,s=i.length;o<s;o++){const a=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}getVertexPosition(e,t){const r=this.geometry,i=r.attributes.position,o=r.morphAttributes.position,s=r.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(o&&a){Th.set(0,0,0);for(let l=0,c=o.length;l<c;l++){const u=a[l],d=o[l];u!==0&&(Ng.fromBufferAttribute(d,e),s?Th.addScaledVector(Ng,u):Th.addScaledVector(Ng.sub(t),u))}t.add(Th)}return t}raycast(e,t){const r=this.geometry,i=this.material,o=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),Mh.copy(r.boundingSphere),Mh.applyMatrix4(o),xa.copy(e.ray).recast(e.near),!(Mh.containsPoint(xa.origin)===!1&&(xa.intersectSphere(Mh,S2)===null||xa.origin.distanceToSquared(S2)>(e.far-e.near)**2))&&(w2.copy(o).invert(),xa.copy(e.ray).applyMatrix4(w2),!(r.boundingBox!==null&&xa.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,t,xa)))}_computeIntersections(e,t,r){let i;const o=this.geometry,s=this.material,a=o.index,l=o.attributes.position,c=o.attributes.uv,u=o.attributes.uv1,d=o.attributes.normal,h=o.groups,m=o.drawRange;if(a!==null)if(Array.isArray(s))for(let f=0,v=h.length;f<v;f++){const g=h[f],b=s[g.materialIndex],S=Math.max(g.start,m.start),p=Math.min(a.count,Math.min(g.start+g.count,m.start+m.count));for(let y=S,w=p;y<w;y+=3){const x=a.getX(y),_=a.getX(y+1),A=a.getX(y+2);i=Lh(this,b,e,r,c,u,d,x,_,A),i&&(i.faceIndex=Math.floor(y/3),i.face.materialIndex=g.materialIndex,t.push(i))}}else{const f=Math.max(0,m.start),v=Math.min(a.count,m.start+m.count);for(let g=f,b=v;g<b;g+=3){const S=a.getX(g),p=a.getX(g+1),y=a.getX(g+2);i=Lh(this,s,e,r,c,u,d,S,p,y),i&&(i.faceIndex=Math.floor(g/3),t.push(i))}}else if(l!==void 0)if(Array.isArray(s))for(let f=0,v=h.length;f<v;f++){const g=h[f],b=s[g.materialIndex],S=Math.max(g.start,m.start),p=Math.min(l.count,Math.min(g.start+g.count,m.start+m.count));for(let y=S,w=p;y<w;y+=3){const x=y,_=y+1,A=y+2;i=Lh(this,b,e,r,c,u,d,x,_,A),i&&(i.faceIndex=Math.floor(y/3),i.face.materialIndex=g.materialIndex,t.push(i))}}else{const f=Math.max(0,m.start),v=Math.min(l.count,m.start+m.count);for(let g=f,b=v;g<b;g+=3){const S=g,p=g+1,y=g+2;i=Lh(this,s,e,r,c,u,d,S,p,y),i&&(i.faceIndex=Math.floor(g/3),t.push(i))}}}}function VU(n,e,t,r,i,o,s,a){let l;if(e.side===Or?l=r.intersectTriangle(s,o,i,!0,a):l=r.intersectTriangle(i,o,s,e.side===ts,a),l===null)return null;Dh.copy(a),Dh.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(Dh);return c<t.near||c>t.far?null:{distance:c,point:Dh.clone(),object:n}}function Lh(n,e,t,r,i,o,s,a,l,c){n.getVertexPosition(a,Ol),n.getVertexPosition(l,kl),n.getVertexPosition(c,Bl);const u=VU(n,e,t,r,Ol,kl,Bl,Ih);if(u){i&&(Eh.fromBufferAttribute(i,a),Ph.fromBufferAttribute(i,l),Rh.fromBufferAttribute(i,c),u.uv=Vi.getInterpolation(Ih,Ol,kl,Bl,Eh,Ph,Rh,new Ut)),o&&(Eh.fromBufferAttribute(o,a),Ph.fromBufferAttribute(o,l),Rh.fromBufferAttribute(o,c),u.uv1=Vi.getInterpolation(Ih,Ol,kl,Bl,Eh,Ph,Rh,new Ut),u.uv2=u.uv1),s&&(C2.fromBufferAttribute(s,a),A2.fromBufferAttribute(s,l),M2.fromBufferAttribute(s,c),u.normal=Vi.getInterpolation(Ih,Ol,kl,Bl,C2,A2,M2,new te),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const d={a,b:l,c,normal:new te,materialIndex:0};Vi.getNormal(Ol,kl,Bl,d.normal),u.face=d}return u}class Hc extends tr{constructor(e=1,t=1,r=1,i=1,o=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:o,depthSegments:s};const a=this;i=Math.floor(i),o=Math.floor(o),s=Math.floor(s);const l=[],c=[],u=[],d=[];let h=0,m=0;f("z","y","x",-1,-1,r,t,e,s,o,0),f("z","y","x",1,-1,r,t,-e,s,o,1),f("x","z","y",1,1,e,r,t,i,s,2),f("x","z","y",1,-1,e,r,-t,i,s,3),f("x","y","z",1,-1,e,t,r,i,o,4),f("x","y","z",-1,-1,e,t,-r,i,o,5),this.setIndex(l),this.setAttribute("position",new ur(c,3)),this.setAttribute("normal",new ur(u,3)),this.setAttribute("uv",new ur(d,2));function f(v,g,b,S,p,y,w,x,_,A,C){const T=y/_,I=w/A,M=y/2,P=w/2,E=x/2,R=_+1,B=A+1;let L=0,F=0;const H=new te;for(let $=0;$<B;$++){const O=$*I-P;for(let k=0;k<R;k++){const X=k*T-M;H[v]=X*S,H[g]=O*p,H[b]=E,c.push(H.x,H.y,H.z),H[v]=0,H[g]=0,H[b]=x>0?1:-1,u.push(H.x,H.y,H.z),d.push(k/_),d.push(1-$/A),L+=1}}for(let $=0;$<A;$++)for(let O=0;O<_;O++){const k=h+O+R*$,X=h+O+R*($+1),ie=h+(O+1)+R*($+1),ne=h+(O+1)+R*$;l.push(k,X,ne),l.push(X,ie,ne),F+=6}a.addGroup(m,F,C),m+=F,h+=L}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ac(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function Dr(n){const e={};for(let t=0;t<n.length;t++){const r=Ac(n[t]);for(const i in r)e[i]=r[i]}return e}function GU(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function yE(n){return n.getRenderTarget()===null?n.outputColorSpace:fn.workingColorSpace}const Mf={clone:Ac,merge:Dr};var WU=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,jU=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Mi extends $c{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=WU,this.fragmentShader=jU,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ac(e.uniforms),this.uniformsGroups=GU(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const s=this.uniforms[i].value;s&&s.isTexture?t.uniforms[i]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[i]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[i]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[i]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[i]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[i]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[i]={type:"m4",value:s.toArray()}:t.uniforms[i]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class _E extends cr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new at,this.projectionMatrix=new at,this.projectionMatrixInverse=new at,this.coordinateSystem=Yo}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class qr extends _E{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Q1*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Af*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Q1*2*Math.atan(Math.tan(Af*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,o,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Af*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,o=-.5*i;const s=this.view;if(this.view!==null&&this.view.enabled){const l=s.fullWidth,c=s.fullHeight;o+=s.offsetX*i/l,t-=s.offsetY*r/c,i*=s.width/l,r*=s.height/c}const a=this.filmOffset;a!==0&&(o+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Nl=-90,zl=1;class qU extends cr{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new qr(Nl,zl,e,t);i.layers=this.layers,this.add(i);const o=new qr(Nl,zl,e,t);o.layers=this.layers,this.add(o);const s=new qr(Nl,zl,e,t);s.layers=this.layers,this.add(s);const a=new qr(Nl,zl,e,t);a.layers=this.layers,this.add(a);const l=new qr(Nl,zl,e,t);l.layers=this.layers,this.add(l);const c=new qr(Nl,zl,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,o,s,a,l]=t;for(const c of t)this.remove(c);if(e===Yo)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===hp)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,s,a,l,c,u]=this.children,d=e.getRenderTarget(),h=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const v=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,o),e.setRenderTarget(r,1,i),e.render(t,s),e.setRenderTarget(r,2,i),e.render(t,a),e.setRenderTarget(r,3,i),e.render(t,l),e.setRenderTarget(r,4,i),e.render(t,c),r.texture.generateMipmaps=v,e.setRenderTarget(r,5,i),e.render(t,u),e.setRenderTarget(d,h,m),e.xr.enabled=f,r.texture.needsPMREMUpdate=!0}}class xE extends kr{constructor(e,t,r,i,o,s,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:xc,super(e,t,r,i,o,s,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class XU extends xo{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];t.encoding!==void 0&&(Wu("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===ja?pr:Si),this.texture=new xE(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Cr}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Hc(5,5,5),o=new Mi({name:"CubemapFromEquirect",uniforms:Ac(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Or,blending:Jo});o.uniforms.tEquirect.value=t;const s=new yo(i,o),a=t.minFilter;return t.minFilter===md&&(t.minFilter=Cr),new qU(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,r,i){const o=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,r,i);e.setRenderTarget(o)}}const zg=new te,YU=new te,KU=new qt;class Ta{constructor(e=new te(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=zg.subVectors(r,t).cross(YU.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(zg),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?null:t.copy(e.start).addScaledVector(r,o)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||KU.getNormalMatrix(e),i=this.coplanarPoint(zg).applyMatrix4(e),o=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const wa=new kd,Fh=new te;class zb{constructor(e=new Ta,t=new Ta,r=new Ta,i=new Ta,o=new Ta,s=new Ta){this.planes=[e,t,r,i,o,s]}set(e,t,r,i,o,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(o),a[5].copy(s),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=Yo){const r=this.planes,i=e.elements,o=i[0],s=i[1],a=i[2],l=i[3],c=i[4],u=i[5],d=i[6],h=i[7],m=i[8],f=i[9],v=i[10],g=i[11],b=i[12],S=i[13],p=i[14],y=i[15];if(r[0].setComponents(l-o,h-c,g-m,y-b).normalize(),r[1].setComponents(l+o,h+c,g+m,y+b).normalize(),r[2].setComponents(l+s,h+u,g+f,y+S).normalize(),r[3].setComponents(l-s,h-u,g-f,y-S).normalize(),r[4].setComponents(l-a,h-d,g-v,y-p).normalize(),t===Yo)r[5].setComponents(l+a,h+d,g+v,y+p).normalize();else if(t===hp)r[5].setComponents(a,d,v,p).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),wa.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),wa.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(wa)}intersectsSprite(e){return wa.center.set(0,0,0),wa.radius=.7071067811865476,wa.applyMatrix4(e.matrixWorld),this.intersectsSphere(wa)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(Fh.x=i.normal.x>0?e.max.x:e.min.x,Fh.y=i.normal.y>0?e.max.y:e.min.y,Fh.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Fh)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function wE(){let n=null,e=!1,t=null,r=null;function i(o,s){t(o,s),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){n=o}}}function ZU(n,e){const t=e.isWebGL2,r=new WeakMap;function i(c,u){const d=c.array,h=c.usage,m=n.createBuffer();n.bindBuffer(u,m),n.bufferData(u,d,h),c.onUploadCallback();let f;if(d instanceof Float32Array)f=n.FLOAT;else if(d instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)f=n.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else f=n.UNSIGNED_SHORT;else if(d instanceof Int16Array)f=n.SHORT;else if(d instanceof Uint32Array)f=n.UNSIGNED_INT;else if(d instanceof Int32Array)f=n.INT;else if(d instanceof Int8Array)f=n.BYTE;else if(d instanceof Uint8Array)f=n.UNSIGNED_BYTE;else if(d instanceof Uint8ClampedArray)f=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:m,type:f,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}function o(c,u,d){const h=u.array,m=u.updateRange;n.bindBuffer(d,c),m.count===-1?n.bufferSubData(d,0,h):(t?n.bufferSubData(d,m.offset*h.BYTES_PER_ELEMENT,h,m.offset,m.count):n.bufferSubData(d,m.offset*h.BYTES_PER_ELEMENT,h.subarray(m.offset,m.offset+m.count)),m.count=-1),u.onUploadCallback()}function s(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=r.get(c);u&&(n.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){if(c.isGLBufferAttribute){const h=r.get(c);(!h||h.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const d=r.get(c);d===void 0?r.set(c,i(c,u)):d.version<c.version&&(o(d.buffer,c,u),d.version=c.version)}return{get:s,remove:a,update:l}}class cm extends tr{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const o=e/2,s=t/2,a=Math.floor(r),l=Math.floor(i),c=a+1,u=l+1,d=e/a,h=t/l,m=[],f=[],v=[],g=[];for(let b=0;b<u;b++){const S=b*h-s;for(let p=0;p<c;p++){const y=p*d-o;f.push(y,-S,0),v.push(0,0,1),g.push(p/a),g.push(1-b/l)}}for(let b=0;b<l;b++)for(let S=0;S<a;S++){const p=S+c*b,y=S+c*(b+1),w=S+1+c*(b+1),x=S+1+c*b;m.push(p,y,x),m.push(y,w,x)}this.setIndex(m),this.setAttribute("position",new ur(f,3)),this.setAttribute("normal",new ur(v,3)),this.setAttribute("uv",new ur(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cm(e.width,e.height,e.widthSegments,e.heightSegments)}}var JU=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,QU=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,e$=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,t$=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,n$=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,r$=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,i$=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,o$=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,s$=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,a$=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,l$=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,c$=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,u$=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,d$=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,h$=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,f$=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,p$=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,m$=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,g$=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,v$=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,b$=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,y$=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,_$=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,x$=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,w$=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,S$=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,C$=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,A$=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,M$="gl_FragColor = linearToOutputTexel( gl_FragColor );",T$=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,E$=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,P$=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,R$=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,I$=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,D$=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,L$=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,F$=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,O$=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,k$=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,B$=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,N$=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,z$=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,U$=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,$$=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,H$=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,V$=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,G$=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,W$=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,j$=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,q$=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,X$=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,Y$=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,K$=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Z$=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,J$=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,Q$=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,e9=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,t9=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,n9=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,r9=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,i9=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,o9=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,s9=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,a9=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,l9=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,c9=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,u9=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,d9=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,h9=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,f9=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,p9=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,m9=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,g9=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,v9=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,b9=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,y9=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,_9=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,x9=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,w9=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,S9=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,C9=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,A9=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,M9=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,T9=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,E9=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,P9=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,R9=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,I9=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,D9=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,L9=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,F9=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,O9=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,k9=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,B9=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,N9=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,z9=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,U9=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,$9=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,H9=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,V9=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,G9=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,W9=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,j9=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,q9=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,X9=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Y9=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,K9=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Z9=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,J9=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Q9=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,eH=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,tH=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,nH=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,rH=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,iH=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,oH=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,sH=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,aH=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,lH=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,cH=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,uH=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,dH=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,hH=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fH=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,pH=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mH=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,gH=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vH=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bH=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yH=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,_H=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xH=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,wH=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,SH=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,CH=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,AH=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,MH=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,TH=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,EH=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,jt={alphahash_fragment:JU,alphahash_pars_fragment:QU,alphamap_fragment:e$,alphamap_pars_fragment:t$,alphatest_fragment:n$,alphatest_pars_fragment:r$,aomap_fragment:i$,aomap_pars_fragment:o$,begin_vertex:s$,beginnormal_vertex:a$,bsdfs:l$,iridescence_fragment:c$,bumpmap_pars_fragment:u$,clipping_planes_fragment:d$,clipping_planes_pars_fragment:h$,clipping_planes_pars_vertex:f$,clipping_planes_vertex:p$,color_fragment:m$,color_pars_fragment:g$,color_pars_vertex:v$,color_vertex:b$,common:y$,cube_uv_reflection_fragment:_$,defaultnormal_vertex:x$,displacementmap_pars_vertex:w$,displacementmap_vertex:S$,emissivemap_fragment:C$,emissivemap_pars_fragment:A$,colorspace_fragment:M$,colorspace_pars_fragment:T$,envmap_fragment:E$,envmap_common_pars_fragment:P$,envmap_pars_fragment:R$,envmap_pars_vertex:I$,envmap_physical_pars_fragment:V$,envmap_vertex:D$,fog_vertex:L$,fog_pars_vertex:F$,fog_fragment:O$,fog_pars_fragment:k$,gradientmap_pars_fragment:B$,lightmap_fragment:N$,lightmap_pars_fragment:z$,lights_lambert_fragment:U$,lights_lambert_pars_fragment:$$,lights_pars_begin:H$,lights_toon_fragment:G$,lights_toon_pars_fragment:W$,lights_phong_fragment:j$,lights_phong_pars_fragment:q$,lights_physical_fragment:X$,lights_physical_pars_fragment:Y$,lights_fragment_begin:K$,lights_fragment_maps:Z$,lights_fragment_end:J$,logdepthbuf_fragment:Q$,logdepthbuf_pars_fragment:e9,logdepthbuf_pars_vertex:t9,logdepthbuf_vertex:n9,map_fragment:r9,map_pars_fragment:i9,map_particle_fragment:o9,map_particle_pars_fragment:s9,metalnessmap_fragment:a9,metalnessmap_pars_fragment:l9,morphcolor_vertex:c9,morphnormal_vertex:u9,morphtarget_pars_vertex:d9,morphtarget_vertex:h9,normal_fragment_begin:f9,normal_fragment_maps:p9,normal_pars_fragment:m9,normal_pars_vertex:g9,normal_vertex:v9,normalmap_pars_fragment:b9,clearcoat_normal_fragment_begin:y9,clearcoat_normal_fragment_maps:_9,clearcoat_pars_fragment:x9,iridescence_pars_fragment:w9,opaque_fragment:S9,packing:C9,premultiplied_alpha_fragment:A9,project_vertex:M9,dithering_fragment:T9,dithering_pars_fragment:E9,roughnessmap_fragment:P9,roughnessmap_pars_fragment:R9,shadowmap_pars_fragment:I9,shadowmap_pars_vertex:D9,shadowmap_vertex:L9,shadowmask_pars_fragment:F9,skinbase_vertex:O9,skinning_pars_vertex:k9,skinning_vertex:B9,skinnormal_vertex:N9,specularmap_fragment:z9,specularmap_pars_fragment:U9,tonemapping_fragment:$9,tonemapping_pars_fragment:H9,transmission_fragment:V9,transmission_pars_fragment:G9,uv_pars_fragment:W9,uv_pars_vertex:j9,uv_vertex:q9,worldpos_vertex:X9,background_vert:Y9,background_frag:K9,backgroundCube_vert:Z9,backgroundCube_frag:J9,cube_vert:Q9,cube_frag:eH,depth_vert:tH,depth_frag:nH,distanceRGBA_vert:rH,distanceRGBA_frag:iH,equirect_vert:oH,equirect_frag:sH,linedashed_vert:aH,linedashed_frag:lH,meshbasic_vert:cH,meshbasic_frag:uH,meshlambert_vert:dH,meshlambert_frag:hH,meshmatcap_vert:fH,meshmatcap_frag:pH,meshnormal_vert:mH,meshnormal_frag:gH,meshphong_vert:vH,meshphong_frag:bH,meshphysical_vert:yH,meshphysical_frag:_H,meshtoon_vert:xH,meshtoon_frag:wH,points_vert:SH,points_frag:CH,shadow_vert:AH,shadow_frag:MH,sprite_vert:TH,sprite_frag:EH},ht={common:{diffuse:{value:new _t(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new qt},alphaMap:{value:null},alphaMapTransform:{value:new qt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new qt}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new qt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new qt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new qt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new qt},normalScale:{value:new Ut(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new qt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new qt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new qt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new qt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new _t(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new _t(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new qt},alphaTest:{value:0},uvTransform:{value:new qt}},sprite:{diffuse:{value:new _t(16777215)},opacity:{value:1},center:{value:new Ut(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new qt},alphaMap:{value:null},alphaMapTransform:{value:new qt},alphaTest:{value:0}}},po={basic:{uniforms:Dr([ht.common,ht.specularmap,ht.envmap,ht.aomap,ht.lightmap,ht.fog]),vertexShader:jt.meshbasic_vert,fragmentShader:jt.meshbasic_frag},lambert:{uniforms:Dr([ht.common,ht.specularmap,ht.envmap,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.fog,ht.lights,{emissive:{value:new _t(0)}}]),vertexShader:jt.meshlambert_vert,fragmentShader:jt.meshlambert_frag},phong:{uniforms:Dr([ht.common,ht.specularmap,ht.envmap,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.fog,ht.lights,{emissive:{value:new _t(0)},specular:{value:new _t(1118481)},shininess:{value:30}}]),vertexShader:jt.meshphong_vert,fragmentShader:jt.meshphong_frag},standard:{uniforms:Dr([ht.common,ht.envmap,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.roughnessmap,ht.metalnessmap,ht.fog,ht.lights,{emissive:{value:new _t(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:jt.meshphysical_vert,fragmentShader:jt.meshphysical_frag},toon:{uniforms:Dr([ht.common,ht.aomap,ht.lightmap,ht.emissivemap,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.gradientmap,ht.fog,ht.lights,{emissive:{value:new _t(0)}}]),vertexShader:jt.meshtoon_vert,fragmentShader:jt.meshtoon_frag},matcap:{uniforms:Dr([ht.common,ht.bumpmap,ht.normalmap,ht.displacementmap,ht.fog,{matcap:{value:null}}]),vertexShader:jt.meshmatcap_vert,fragmentShader:jt.meshmatcap_frag},points:{uniforms:Dr([ht.points,ht.fog]),vertexShader:jt.points_vert,fragmentShader:jt.points_frag},dashed:{uniforms:Dr([ht.common,ht.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:jt.linedashed_vert,fragmentShader:jt.linedashed_frag},depth:{uniforms:Dr([ht.common,ht.displacementmap]),vertexShader:jt.depth_vert,fragmentShader:jt.depth_frag},normal:{uniforms:Dr([ht.common,ht.bumpmap,ht.normalmap,ht.displacementmap,{opacity:{value:1}}]),vertexShader:jt.meshnormal_vert,fragmentShader:jt.meshnormal_frag},sprite:{uniforms:Dr([ht.sprite,ht.fog]),vertexShader:jt.sprite_vert,fragmentShader:jt.sprite_frag},background:{uniforms:{uvTransform:{value:new qt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:jt.background_vert,fragmentShader:jt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:jt.backgroundCube_vert,fragmentShader:jt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:jt.cube_vert,fragmentShader:jt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:jt.equirect_vert,fragmentShader:jt.equirect_frag},distanceRGBA:{uniforms:Dr([ht.common,ht.displacementmap,{referencePosition:{value:new te},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:jt.distanceRGBA_vert,fragmentShader:jt.distanceRGBA_frag},shadow:{uniforms:Dr([ht.lights,ht.fog,{color:{value:new _t(0)},opacity:{value:1}}]),vertexShader:jt.shadow_vert,fragmentShader:jt.shadow_frag}};po.physical={uniforms:Dr([po.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new qt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new qt},clearcoatNormalScale:{value:new Ut(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new qt},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new qt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new qt},sheen:{value:0},sheenColor:{value:new _t(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new qt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new qt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new qt},transmissionSamplerSize:{value:new Ut},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new qt},attenuationDistance:{value:0},attenuationColor:{value:new _t(0)},specularColor:{value:new _t(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new qt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new qt},anisotropyVector:{value:new Ut},anisotropyMap:{value:null},anisotropyMapTransform:{value:new qt}}]),vertexShader:jt.meshphysical_vert,fragmentShader:jt.meshphysical_frag};const Oh={r:0,b:0,g:0};function PH(n,e,t,r,i,o,s){const a=new _t(0);let l=o===!0?0:1,c,u,d=null,h=0,m=null;function f(g,b){let S=!1,p=b.isScene===!0?b.background:null;p&&p.isTexture&&(p=(b.backgroundBlurriness>0?t:e).get(p)),p===null?v(a,l):p&&p.isColor&&(v(p,1),S=!0);const y=n.xr.getEnvironmentBlendMode();y==="additive"?r.buffers.color.setClear(0,0,0,1,s):y==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,s),(n.autoClear||S)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),p&&(p.isCubeTexture||p.mapping===am)?(u===void 0&&(u=new yo(new Hc(1,1,1),new Mi({name:"BackgroundCubeMaterial",uniforms:Ac(po.backgroundCube.uniforms),vertexShader:po.backgroundCube.vertexShader,fragmentShader:po.backgroundCube.fragmentShader,side:Or,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(w,x,_){this.matrixWorld.copyPosition(_.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),u.material.uniforms.envMap.value=p,u.material.uniforms.flipEnvMap.value=p.isCubeTexture&&p.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=b.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,u.material.toneMapped=fn.getTransfer(p.colorSpace)!==Sn,(d!==p||h!==p.version||m!==n.toneMapping)&&(u.material.needsUpdate=!0,d=p,h=p.version,m=n.toneMapping),u.layers.enableAll(),g.unshift(u,u.geometry,u.material,0,0,null)):p&&p.isTexture&&(c===void 0&&(c=new yo(new cm(2,2),new Mi({name:"BackgroundMaterial",uniforms:Ac(po.background.uniforms),vertexShader:po.background.vertexShader,fragmentShader:po.background.fragmentShader,side:ts,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(c)),c.material.uniforms.t2D.value=p,c.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,c.material.toneMapped=fn.getTransfer(p.colorSpace)!==Sn,p.matrixAutoUpdate===!0&&p.updateMatrix(),c.material.uniforms.uvTransform.value.copy(p.matrix),(d!==p||h!==p.version||m!==n.toneMapping)&&(c.material.needsUpdate=!0,d=p,h=p.version,m=n.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}function v(g,b){g.getRGB(Oh,yE(n)),r.buffers.color.setClear(Oh.r,Oh.g,Oh.b,b,s)}return{getClearColor:function(){return a},setClearColor:function(g,b=1){a.set(g),l=b,v(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,v(a,l)},render:f}}function RH(n,e,t,r){const i=n.getParameter(n.MAX_VERTEX_ATTRIBS),o=r.isWebGL2?null:e.get("OES_vertex_array_object"),s=r.isWebGL2||o!==null,a={},l=g(null);let c=l,u=!1;function d(E,R,B,L,F){let H=!1;if(s){const $=v(L,B,R);c!==$&&(c=$,m(c.object)),H=b(E,L,B,F),H&&S(E,L,B,F)}else{const $=R.wireframe===!0;(c.geometry!==L.id||c.program!==B.id||c.wireframe!==$)&&(c.geometry=L.id,c.program=B.id,c.wireframe=$,H=!0)}F!==null&&t.update(F,n.ELEMENT_ARRAY_BUFFER),(H||u)&&(u=!1,A(E,R,B,L),F!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.get(F).buffer))}function h(){return r.isWebGL2?n.createVertexArray():o.createVertexArrayOES()}function m(E){return r.isWebGL2?n.bindVertexArray(E):o.bindVertexArrayOES(E)}function f(E){return r.isWebGL2?n.deleteVertexArray(E):o.deleteVertexArrayOES(E)}function v(E,R,B){const L=B.wireframe===!0;let F=a[E.id];F===void 0&&(F={},a[E.id]=F);let H=F[R.id];H===void 0&&(H={},F[R.id]=H);let $=H[L];return $===void 0&&($=g(h()),H[L]=$),$}function g(E){const R=[],B=[],L=[];for(let F=0;F<i;F++)R[F]=0,B[F]=0,L[F]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:R,enabledAttributes:B,attributeDivisors:L,object:E,attributes:{},index:null}}function b(E,R,B,L){const F=c.attributes,H=R.attributes;let $=0;const O=B.getAttributes();for(const k in O)if(O[k].location>=0){const ie=F[k];let ne=H[k];if(ne===void 0&&(k==="instanceMatrix"&&E.instanceMatrix&&(ne=E.instanceMatrix),k==="instanceColor"&&E.instanceColor&&(ne=E.instanceColor)),ie===void 0||ie.attribute!==ne||ne&&ie.data!==ne.data)return!0;$++}return c.attributesNum!==$||c.index!==L}function S(E,R,B,L){const F={},H=R.attributes;let $=0;const O=B.getAttributes();for(const k in O)if(O[k].location>=0){let ie=H[k];ie===void 0&&(k==="instanceMatrix"&&E.instanceMatrix&&(ie=E.instanceMatrix),k==="instanceColor"&&E.instanceColor&&(ie=E.instanceColor));const ne={};ne.attribute=ie,ie&&ie.data&&(ne.data=ie.data),F[k]=ne,$++}c.attributes=F,c.attributesNum=$,c.index=L}function p(){const E=c.newAttributes;for(let R=0,B=E.length;R<B;R++)E[R]=0}function y(E){w(E,0)}function w(E,R){const B=c.newAttributes,L=c.enabledAttributes,F=c.attributeDivisors;B[E]=1,L[E]===0&&(n.enableVertexAttribArray(E),L[E]=1),F[E]!==R&&((r.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](E,R),F[E]=R)}function x(){const E=c.newAttributes,R=c.enabledAttributes;for(let B=0,L=R.length;B<L;B++)R[B]!==E[B]&&(n.disableVertexAttribArray(B),R[B]=0)}function _(E,R,B,L,F,H,$){$===!0?n.vertexAttribIPointer(E,R,B,F,H):n.vertexAttribPointer(E,R,B,L,F,H)}function A(E,R,B,L){if(r.isWebGL2===!1&&(E.isInstancedMesh||L.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;p();const F=L.attributes,H=B.getAttributes(),$=R.defaultAttributeValues;for(const O in H){const k=H[O];if(k.location>=0){let X=F[O];if(X===void 0&&(O==="instanceMatrix"&&E.instanceMatrix&&(X=E.instanceMatrix),O==="instanceColor"&&E.instanceColor&&(X=E.instanceColor)),X!==void 0){const ie=X.normalized,ne=X.itemSize,Q=t.get(X);if(Q===void 0)continue;const ce=Q.buffer,Z=Q.type,re=Q.bytesPerElement,se=r.isWebGL2===!0&&(Z===n.INT||Z===n.UNSIGNED_INT||X.gpuType===rE);if(X.isInterleavedBufferAttribute){const fe=X.data,ue=fe.stride,U=X.offset;if(fe.isInstancedInterleavedBuffer){for(let K=0;K<k.locationSize;K++)w(k.location+K,fe.meshPerAttribute);E.isInstancedMesh!==!0&&L._maxInstanceCount===void 0&&(L._maxInstanceCount=fe.meshPerAttribute*fe.count)}else for(let K=0;K<k.locationSize;K++)y(k.location+K);n.bindBuffer(n.ARRAY_BUFFER,ce);for(let K=0;K<k.locationSize;K++)_(k.location+K,ne/k.locationSize,Z,ie,ue*re,(U+ne/k.locationSize*K)*re,se)}else{if(X.isInstancedBufferAttribute){for(let fe=0;fe<k.locationSize;fe++)w(k.location+fe,X.meshPerAttribute);E.isInstancedMesh!==!0&&L._maxInstanceCount===void 0&&(L._maxInstanceCount=X.meshPerAttribute*X.count)}else for(let fe=0;fe<k.locationSize;fe++)y(k.location+fe);n.bindBuffer(n.ARRAY_BUFFER,ce);for(let fe=0;fe<k.locationSize;fe++)_(k.location+fe,ne/k.locationSize,Z,ie,ne*re,ne/k.locationSize*fe*re,se)}}else if($!==void 0){const ie=$[O];if(ie!==void 0)switch(ie.length){case 2:n.vertexAttrib2fv(k.location,ie);break;case 3:n.vertexAttrib3fv(k.location,ie);break;case 4:n.vertexAttrib4fv(k.location,ie);break;default:n.vertexAttrib1fv(k.location,ie)}}}}x()}function C(){M();for(const E in a){const R=a[E];for(const B in R){const L=R[B];for(const F in L)f(L[F].object),delete L[F];delete R[B]}delete a[E]}}function T(E){if(a[E.id]===void 0)return;const R=a[E.id];for(const B in R){const L=R[B];for(const F in L)f(L[F].object),delete L[F];delete R[B]}delete a[E.id]}function I(E){for(const R in a){const B=a[R];if(B[E.id]===void 0)continue;const L=B[E.id];for(const F in L)f(L[F].object),delete L[F];delete B[E.id]}}function M(){P(),u=!0,c!==l&&(c=l,m(c.object))}function P(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:d,reset:M,resetDefaultState:P,dispose:C,releaseStatesOfGeometry:T,releaseStatesOfProgram:I,initAttributes:p,enableAttribute:y,disableUnusedAttributes:x}}function IH(n,e,t,r){const i=r.isWebGL2;let o;function s(c){o=c}function a(c,u){n.drawArrays(o,c,u),t.update(u,o,1)}function l(c,u,d){if(d===0)return;let h,m;if(i)h=n,m="drawArraysInstanced";else if(h=e.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",h===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}h[m](o,c,u,d),t.update(u,o,d)}this.setMode=s,this.render=a,this.renderInstances=l}function DH(n,e,t){let r;function i(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const _=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(_.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(_){if(_==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";_="mediump"}return _==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s=typeof WebGL2RenderingContext<"u"&&n.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const l=o(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=s||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,d=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),h=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=n.getParameter(n.MAX_TEXTURE_SIZE),f=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),v=n.getParameter(n.MAX_VERTEX_ATTRIBS),g=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),b=n.getParameter(n.MAX_VARYING_VECTORS),S=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),p=h>0,y=s||e.has("OES_texture_float"),w=p&&y,x=s?n.getParameter(n.MAX_SAMPLES):0;return{isWebGL2:s,drawBuffers:c,getMaxAnisotropy:i,getMaxPrecision:o,precision:a,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:h,maxTextureSize:m,maxCubemapSize:f,maxAttributes:v,maxVertexUniforms:g,maxVaryings:b,maxFragmentUniforms:S,vertexTextures:p,floatFragmentTextures:y,floatVertexTextures:w,maxSamples:x}}function LH(n){const e=this;let t=null,r=0,i=!1,o=!1;const s=new Ta,a=new qt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h){const m=d.length!==0||h||r!==0||i;return i=h,r=d.length,m},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(d,h){t=u(d,h,0)},this.setState=function(d,h,m){const f=d.clippingPlanes,v=d.clipIntersection,g=d.clipShadows,b=n.get(d);if(!i||f===null||f.length===0||o&&!g)o?u(null):c();else{const S=o?0:r,p=S*4;let y=b.clippingState||null;l.value=y,y=u(f,h,p,m);for(let w=0;w!==p;++w)y[w]=t[w];b.clippingState=y,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=S}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(d,h,m,f){const v=d!==null?d.length:0;let g=null;if(v!==0){if(g=l.value,f!==!0||g===null){const b=m+v*4,S=h.matrixWorldInverse;a.getNormalMatrix(S),(g===null||g.length<b)&&(g=new Float32Array(b));for(let p=0,y=m;p!==v;++p,y+=4)s.copy(d[p]).applyMatrix4(S,a),s.normal.toArray(g,y),g[y+3]=s.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,g}}function FH(n){let e=new WeakMap;function t(s,a){return a===X1?s.mapping=xc:a===Y1&&(s.mapping=wc),s}function r(s){if(s&&s.isTexture&&s.isRenderTargetTexture===!1){const a=s.mapping;if(a===X1||a===Y1)if(e.has(s)){const l=e.get(s).texture;return t(l,s.mapping)}else{const l=s.image;if(l&&l.height>0){const c=new XU(l.height/2);return c.fromEquirectangularTexture(n,s),e.set(s,c),s.addEventListener("dispose",i),t(c.texture,s.mapping)}else return null}}return s}function i(s){const a=s.target;a.removeEventListener("dispose",i);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function o(){e=new WeakMap}return{get:r,dispose:o}}class gd extends _E{constructor(e=-1,t=1,r=1,i=-1,o=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=o,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,o,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let o=r-e,s=r+e,a=i+t,l=i-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=c*this.view.offsetX,s=o+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(o,s,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Ql=4,T2=[.125,.215,.35,.446,.526,.582],La=20,Ug=new gd,E2=new _t;let $g=null,Hg=0,Vg=0;const Ea=(1+Math.sqrt(5))/2,Ul=1/Ea,P2=[new te(1,1,1),new te(-1,1,1),new te(1,1,-1),new te(-1,1,-1),new te(0,Ea,Ul),new te(0,Ea,-Ul),new te(Ul,0,Ea),new te(-Ul,0,Ea),new te(Ea,Ul,0),new te(-Ea,Ul,0)];class R2{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){$g=this._renderer.getRenderTarget(),Hg=this._renderer.getActiveCubeFace(),Vg=this._renderer.getActiveMipmapLevel(),this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,r,i,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=L2(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=D2(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget($g,Hg,Vg),e.scissorTest=!1,kh(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===xc||e.mapping===wc?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),$g=this._renderer.getRenderTarget(),Hg=this._renderer.getActiveCubeFace(),Vg=this._renderer.getActiveMipmapLevel();const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:Cr,minFilter:Cr,generateMipmaps:!1,type:nl,format:Xr,colorSpace:ns,depthBuffer:!1},i=I2(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=I2(e,t,r);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=OH(o)),this._blurMaterial=kH(o,e,t)}return i}_compileMaterial(e){const t=new yo(this._lodPlanes[0],e);this._renderer.compile(t,Ug)}_sceneToCubeUV(e,t,r,i){const a=new qr(90,1,t,r),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,h=u.toneMapping;u.getClearColor(E2),u.toneMapping=zs,u.autoClear=!1;const m=new gE({name:"PMREM.Background",side:Or,depthWrite:!1,depthTest:!1}),f=new yo(new Hc,m);let v=!1;const g=e.background;g?g.isColor&&(m.color.copy(g),e.background=null,v=!0):(m.color.copy(E2),v=!0);for(let b=0;b<6;b++){const S=b%3;S===0?(a.up.set(0,l[b],0),a.lookAt(c[b],0,0)):S===1?(a.up.set(0,0,l[b]),a.lookAt(0,c[b],0)):(a.up.set(0,l[b],0),a.lookAt(0,0,c[b]));const p=this._cubeSize;kh(i,S*p,b>2?p:0,p,p),u.setRenderTarget(i),v&&u.render(f,a),u.render(e,a)}f.geometry.dispose(),f.material.dispose(),u.toneMapping=h,u.autoClear=d,e.background=g}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===xc||e.mapping===wc;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=L2()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=D2());const o=i?this._cubemapMaterial:this._equirectMaterial,s=new yo(this._lodPlanes[0],o),a=o.uniforms;a.envMap.value=e;const l=this._cubeSize;kh(t,0,0,3*l,2*l),r.setRenderTarget(t),r.render(s,Ug)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const o=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),s=P2[(i-1)%P2.length];this._blur(e,i-1,i,o,s)}t.autoClear=r}_blur(e,t,r,i,o){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,r,i,"latitudinal",o),this._halfBlur(s,e,r,r,i,"longitudinal",o)}_halfBlur(e,t,r,i,o,s,a){const l=this._renderer,c=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,d=new yo(this._lodPlanes[i],c),h=c.uniforms,m=this._sizeLods[r]-1,f=isFinite(o)?Math.PI/(2*m):2*Math.PI/(2*La-1),v=o/f,g=isFinite(o)?1+Math.floor(u*v):La;g>La&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${La}`);const b=[];let S=0;for(let _=0;_<La;++_){const A=_/v,C=Math.exp(-A*A/2);b.push(C),_===0?S+=C:_<g&&(S+=2*C)}for(let _=0;_<b.length;_++)b[_]=b[_]/S;h.envMap.value=e.texture,h.samples.value=g,h.weights.value=b,h.latitudinal.value=s==="latitudinal",a&&(h.poleAxis.value=a);const{_lodMax:p}=this;h.dTheta.value=f,h.mipInt.value=p-r;const y=this._sizeLods[i],w=3*y*(i>p-Ql?i-p+Ql:0),x=4*(this._cubeSize-y);kh(t,w,x,3*y,2*y),l.setRenderTarget(t),l.render(d,Ug)}}function OH(n){const e=[],t=[],r=[];let i=n;const o=n-Ql+1+T2.length;for(let s=0;s<o;s++){const a=Math.pow(2,i);t.push(a);let l=1/a;s>n-Ql?l=T2[s-n+Ql-1]:s===0&&(l=0),r.push(l);const c=1/(a-2),u=-c,d=1+c,h=[u,u,d,u,d,d,u,u,d,d,u,d],m=6,f=6,v=3,g=2,b=1,S=new Float32Array(v*f*m),p=new Float32Array(g*f*m),y=new Float32Array(b*f*m);for(let x=0;x<m;x++){const _=x%3*2/3-1,A=x>2?0:-1,C=[_,A,0,_+2/3,A,0,_+2/3,A+1,0,_,A,0,_+2/3,A+1,0,_,A+1,0];S.set(C,v*f*x),p.set(h,g*f*x);const T=[x,x,x,x,x,x];y.set(T,b*f*x)}const w=new tr;w.setAttribute("position",new Wn(S,v)),w.setAttribute("uv",new Wn(p,g)),w.setAttribute("faceIndex",new Wn(y,b)),e.push(w),i>Ql&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}function I2(n,e,t){const r=new xo(n,e,t);return r.texture.mapping=am,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function kh(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function kH(n,e,t){const r=new Float32Array(La),i=new te(0,1,0);return new Mi({name:"SphericalGaussianBlur",defines:{n:La,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:Ub(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Jo,depthTest:!1,depthWrite:!1})}function D2(){return new Mi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Ub(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Jo,depthTest:!1,depthWrite:!1})}function L2(){return new Mi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Ub(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Jo,depthTest:!1,depthWrite:!1})}function Ub(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function BH(n){let e=new WeakMap,t=null;function r(a){if(a&&a.isTexture){const l=a.mapping,c=l===X1||l===Y1,u=l===xc||l===wc;if(c||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let d=e.get(a);return t===null&&(t=new R2(n)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}else{if(e.has(a))return e.get(a).texture;{const d=a.image;if(c&&d&&d.height>0||u&&d&&i(d)){t===null&&(t=new R2(n));const h=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,h),a.addEventListener("dispose",o),h.texture}else return null}}}return a}function i(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function o(a){const l=a.target;l.removeEventListener("dispose",o);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function s(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:s}}function NH(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(r){r.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(r){const i=t(r);return i===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function zH(n,e,t,r){const i={},o=new WeakMap;function s(d){const h=d.target;h.index!==null&&e.remove(h.index);for(const f in h.attributes)e.remove(h.attributes[f]);for(const f in h.morphAttributes){const v=h.morphAttributes[f];for(let g=0,b=v.length;g<b;g++)e.remove(v[g])}h.removeEventListener("dispose",s),delete i[h.id];const m=o.get(h);m&&(e.remove(m),o.delete(h)),r.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,t.memory.geometries--}function a(d,h){return i[h.id]===!0||(h.addEventListener("dispose",s),i[h.id]=!0,t.memory.geometries++),h}function l(d){const h=d.attributes;for(const f in h)e.update(h[f],n.ARRAY_BUFFER);const m=d.morphAttributes;for(const f in m){const v=m[f];for(let g=0,b=v.length;g<b;g++)e.update(v[g],n.ARRAY_BUFFER)}}function c(d){const h=[],m=d.index,f=d.attributes.position;let v=0;if(m!==null){const S=m.array;v=m.version;for(let p=0,y=S.length;p<y;p+=3){const w=S[p+0],x=S[p+1],_=S[p+2];h.push(w,x,x,_,_,w)}}else if(f!==void 0){const S=f.array;v=f.version;for(let p=0,y=S.length/3-1;p<y;p+=3){const w=p+0,x=p+1,_=p+2;h.push(w,x,x,_,_,w)}}else return;const g=new(uE(h)?bE:vE)(h,1);g.version=v;const b=o.get(d);b&&e.remove(b),o.set(d,g)}function u(d){const h=o.get(d);if(h){const m=d.index;m!==null&&h.version<m.version&&c(d)}else c(d);return o.get(d)}return{get:a,update:l,getWireframeAttribute:u}}function UH(n,e,t,r){const i=r.isWebGL2;let o;function s(h){o=h}let a,l;function c(h){a=h.type,l=h.bytesPerElement}function u(h,m){n.drawElements(o,m,a,h*l),t.update(m,o,1)}function d(h,m,f){if(f===0)return;let v,g;if(i)v=n,g="drawElementsInstanced";else if(v=e.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[g](o,m,a,h*l,f),t.update(m,o,f)}this.setMode=s,this.setIndex=c,this.render=u,this.renderInstances=d}function $H(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(o,s,a){switch(t.calls++,s){case n.TRIANGLES:t.triangles+=a*(o/3);break;case n.LINES:t.lines+=a*(o/2);break;case n.LINE_STRIP:t.lines+=a*(o-1);break;case n.LINE_LOOP:t.lines+=a*o;break;case n.POINTS:t.points+=a*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}function HH(n,e){return n[0]-e[0]}function VH(n,e){return Math.abs(e[1])-Math.abs(n[1])}function GH(n,e,t){const r={},i=new Float32Array(8),o=new WeakMap,s=new lr,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,u,d){const h=c.morphTargetInfluences;if(e.isWebGL2===!0){const f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,v=f!==void 0?f.length:0;let g=o.get(u);if(g===void 0||g.count!==v){let R=function(){P.dispose(),o.delete(u),u.removeEventListener("dispose",R)};var m=R;g!==void 0&&g.texture.dispose();const p=u.morphAttributes.position!==void 0,y=u.morphAttributes.normal!==void 0,w=u.morphAttributes.color!==void 0,x=u.morphAttributes.position||[],_=u.morphAttributes.normal||[],A=u.morphAttributes.color||[];let C=0;p===!0&&(C=1),y===!0&&(C=2),w===!0&&(C=3);let T=u.attributes.position.count*C,I=1;T>e.maxTextureSize&&(I=Math.ceil(T/e.maxTextureSize),T=e.maxTextureSize);const M=new Float32Array(T*I*4*v),P=new fE(M,T,I,v);P.type=qi,P.needsUpdate=!0;const E=C*4;for(let B=0;B<v;B++){const L=x[B],F=_[B],H=A[B],$=T*I*4*B;for(let O=0;O<L.count;O++){const k=O*E;p===!0&&(s.fromBufferAttribute(L,O),M[$+k+0]=s.x,M[$+k+1]=s.y,M[$+k+2]=s.z,M[$+k+3]=0),y===!0&&(s.fromBufferAttribute(F,O),M[$+k+4]=s.x,M[$+k+5]=s.y,M[$+k+6]=s.z,M[$+k+7]=0),w===!0&&(s.fromBufferAttribute(H,O),M[$+k+8]=s.x,M[$+k+9]=s.y,M[$+k+10]=s.z,M[$+k+11]=H.itemSize===4?s.w:1)}}g={count:v,texture:P,size:new Ut(T,I)},o.set(u,g),u.addEventListener("dispose",R)}let b=0;for(let p=0;p<h.length;p++)b+=h[p];const S=u.morphTargetsRelative?1:1-b;d.getUniforms().setValue(n,"morphTargetBaseInfluence",S),d.getUniforms().setValue(n,"morphTargetInfluences",h),d.getUniforms().setValue(n,"morphTargetsTexture",g.texture,t),d.getUniforms().setValue(n,"morphTargetsTextureSize",g.size)}else{const f=h===void 0?0:h.length;let v=r[u.id];if(v===void 0||v.length!==f){v=[];for(let y=0;y<f;y++)v[y]=[y,0];r[u.id]=v}for(let y=0;y<f;y++){const w=v[y];w[0]=y,w[1]=h[y]}v.sort(VH);for(let y=0;y<8;y++)y<f&&v[y][1]?(a[y][0]=v[y][0],a[y][1]=v[y][1]):(a[y][0]=Number.MAX_SAFE_INTEGER,a[y][1]=0);a.sort(HH);const g=u.morphAttributes.position,b=u.morphAttributes.normal;let S=0;for(let y=0;y<8;y++){const w=a[y],x=w[0],_=w[1];x!==Number.MAX_SAFE_INTEGER&&_?(g&&u.getAttribute("morphTarget"+y)!==g[x]&&u.setAttribute("morphTarget"+y,g[x]),b&&u.getAttribute("morphNormal"+y)!==b[x]&&u.setAttribute("morphNormal"+y,b[x]),i[y]=_,S+=_):(g&&u.hasAttribute("morphTarget"+y)===!0&&u.deleteAttribute("morphTarget"+y),b&&u.hasAttribute("morphNormal"+y)===!0&&u.deleteAttribute("morphNormal"+y),i[y]=0)}const p=u.morphTargetsRelative?1:1-S;d.getUniforms().setValue(n,"morphTargetBaseInfluence",p),d.getUniforms().setValue(n,"morphTargetInfluences",i)}}return{update:l}}function WH(n,e,t,r){let i=new WeakMap;function o(l){const c=r.render.frame,u=l.geometry,d=e.get(l,u);if(i.get(d)!==c&&(e.update(d),i.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),i.get(l)!==c&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),i.set(l,c))),l.isSkinnedMesh){const h=l.skeleton;i.get(h)!==c&&(h.update(),i.set(h,c))}return d}function s(){i=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:o,dispose:s}}const SE=new kr,CE=new fE,AE=new DU,ME=new xE,F2=[],O2=[],k2=new Float32Array(16),B2=new Float32Array(9),N2=new Float32Array(4);function Vc(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let o=F2[i];if(o===void 0&&(o=new Float32Array(i),F2[i]=o),e!==0){r.toArray(o,0);for(let s=1,a=0;s!==e;++s)a+=t,n[s].toArray(o,a)}return o}function rr(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function ir(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function um(n,e){let t=O2[e];t===void 0&&(t=new Int32Array(e),O2[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function jH(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function qH(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(rr(t,e))return;n.uniform2fv(this.addr,e),ir(t,e)}}function XH(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(rr(t,e))return;n.uniform3fv(this.addr,e),ir(t,e)}}function YH(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(rr(t,e))return;n.uniform4fv(this.addr,e),ir(t,e)}}function KH(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(rr(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),ir(t,e)}else{if(rr(t,r))return;N2.set(r),n.uniformMatrix2fv(this.addr,!1,N2),ir(t,r)}}function ZH(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(rr(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),ir(t,e)}else{if(rr(t,r))return;B2.set(r),n.uniformMatrix3fv(this.addr,!1,B2),ir(t,r)}}function JH(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(rr(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),ir(t,e)}else{if(rr(t,r))return;k2.set(r),n.uniformMatrix4fv(this.addr,!1,k2),ir(t,r)}}function QH(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function e7(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(rr(t,e))return;n.uniform2iv(this.addr,e),ir(t,e)}}function t7(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(rr(t,e))return;n.uniform3iv(this.addr,e),ir(t,e)}}function n7(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(rr(t,e))return;n.uniform4iv(this.addr,e),ir(t,e)}}function r7(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function i7(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(rr(t,e))return;n.uniform2uiv(this.addr,e),ir(t,e)}}function o7(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(rr(t,e))return;n.uniform3uiv(this.addr,e),ir(t,e)}}function s7(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(rr(t,e))return;n.uniform4uiv(this.addr,e),ir(t,e)}}function a7(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2D(e||SE,i)}function l7(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||AE,i)}function c7(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||ME,i)}function u7(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||CE,i)}function d7(n){switch(n){case 5126:return jH;case 35664:return qH;case 35665:return XH;case 35666:return YH;case 35674:return KH;case 35675:return ZH;case 35676:return JH;case 5124:case 35670:return QH;case 35667:case 35671:return e7;case 35668:case 35672:return t7;case 35669:case 35673:return n7;case 5125:return r7;case 36294:return i7;case 36295:return o7;case 36296:return s7;case 35678:case 36198:case 36298:case 36306:case 35682:return a7;case 35679:case 36299:case 36307:return l7;case 35680:case 36300:case 36308:case 36293:return c7;case 36289:case 36303:case 36311:case 36292:return u7}}function h7(n,e){n.uniform1fv(this.addr,e)}function f7(n,e){const t=Vc(e,this.size,2);n.uniform2fv(this.addr,t)}function p7(n,e){const t=Vc(e,this.size,3);n.uniform3fv(this.addr,t)}function m7(n,e){const t=Vc(e,this.size,4);n.uniform4fv(this.addr,t)}function g7(n,e){const t=Vc(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function v7(n,e){const t=Vc(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function b7(n,e){const t=Vc(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function y7(n,e){n.uniform1iv(this.addr,e)}function _7(n,e){n.uniform2iv(this.addr,e)}function x7(n,e){n.uniform3iv(this.addr,e)}function w7(n,e){n.uniform4iv(this.addr,e)}function S7(n,e){n.uniform1uiv(this.addr,e)}function C7(n,e){n.uniform2uiv(this.addr,e)}function A7(n,e){n.uniform3uiv(this.addr,e)}function M7(n,e){n.uniform4uiv(this.addr,e)}function T7(n,e,t){const r=this.cache,i=e.length,o=um(t,i);rr(r,o)||(n.uniform1iv(this.addr,o),ir(r,o));for(let s=0;s!==i;++s)t.setTexture2D(e[s]||SE,o[s])}function E7(n,e,t){const r=this.cache,i=e.length,o=um(t,i);rr(r,o)||(n.uniform1iv(this.addr,o),ir(r,o));for(let s=0;s!==i;++s)t.setTexture3D(e[s]||AE,o[s])}function P7(n,e,t){const r=this.cache,i=e.length,o=um(t,i);rr(r,o)||(n.uniform1iv(this.addr,o),ir(r,o));for(let s=0;s!==i;++s)t.setTextureCube(e[s]||ME,o[s])}function R7(n,e,t){const r=this.cache,i=e.length,o=um(t,i);rr(r,o)||(n.uniform1iv(this.addr,o),ir(r,o));for(let s=0;s!==i;++s)t.setTexture2DArray(e[s]||CE,o[s])}function I7(n){switch(n){case 5126:return h7;case 35664:return f7;case 35665:return p7;case 35666:return m7;case 35674:return g7;case 35675:return v7;case 35676:return b7;case 5124:case 35670:return y7;case 35667:case 35671:return _7;case 35668:case 35672:return x7;case 35669:case 35673:return w7;case 5125:return S7;case 36294:return C7;case 36295:return A7;case 36296:return M7;case 35678:case 36198:case 36298:case 36306:case 35682:return T7;case 35679:case 36299:case 36307:return E7;case 35680:case 36300:case 36308:case 36293:return P7;case 36289:case 36303:case 36311:case 36292:return R7}}class D7{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=d7(t.type)}}class L7{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=I7(t.type)}}class F7{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let o=0,s=i.length;o!==s;++o){const a=i[o];a.setValue(e,t[a.id],r)}}}const Gg=/(\w+)(\])?(\[|\.)?/g;function z2(n,e){n.seq.push(e),n.map[e.id]=e}function O7(n,e,t){const r=n.name,i=r.length;for(Gg.lastIndex=0;;){const o=Gg.exec(r),s=Gg.lastIndex;let a=o[1];const l=o[2]==="]",c=o[3];if(l&&(a=a|0),c===void 0||c==="["&&s+2===i){z2(t,c===void 0?new D7(a,n,e):new L7(a,n,e));break}else{let d=t.map[a];d===void 0&&(d=new F7(a),z2(t,d)),t=d}}}class Tf{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const o=e.getActiveUniform(t,i),s=e.getUniformLocation(t,o.name);O7(o,s,this)}}setValue(e,t,r,i){const o=this.map[t];o!==void 0&&o.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let o=0,s=t.length;o!==s;++o){const a=t[o],l=r[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,o=e.length;i!==o;++i){const s=e[i];s.id in t&&r.push(s)}return r}}function U2(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}const k7=37297;let B7=0;function N7(n,e){const t=n.split(`
`),r=[],i=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let s=i;s<o;s++){const a=s+1;r.push(`${a===e?">":" "} ${a}: ${t[s]}`)}return r.join(`
`)}function z7(n){const e=fn.getPrimaries(fn.workingColorSpace),t=fn.getPrimaries(n);let r;switch(e===t?r="":e===dp&&t===up?r="LinearDisplayP3ToLinearSRGB":e===up&&t===dp&&(r="LinearSRGBToLinearDisplayP3"),n){case ns:case lm:return[r,"LinearTransferOETF"];case pr:case Bb:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[r,"LinearTransferOETF"]}}function $2(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),i=n.getShaderInfoLog(e).trim();if(r&&i==="")return"";const o=/ERROR: 0:(\d+)/.exec(i);if(o){const s=parseInt(o[1]);return t.toUpperCase()+`

`+i+`

`+N7(n.getShaderSource(e),s)}else return i}function U7(n,e){const t=z7(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function $7(n,e){let t;switch(e){case Q8:t="Linear";break;case eU:t="Reinhard";break;case tU:t="OptimizedCineon";break;case nU:t="ACESFilmic";break;case rU:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function H7(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.normalMapTangentSpace||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Su).join(`
`)}function V7(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function G7(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const o=n.getActiveAttrib(e,i),s=o.name;let a=1;o.type===n.FLOAT_MAT2&&(a=2),o.type===n.FLOAT_MAT3&&(a=3),o.type===n.FLOAT_MAT4&&(a=4),t[s]={type:o.type,location:n.getAttribLocation(e,s),locationSize:a}}return t}function Su(n){return n!==""}function H2(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function V2(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const W7=/^[ \t]*#include +<([\w\d./]+)>/gm;function tv(n){return n.replace(W7,q7)}const j7=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function q7(n,e){let t=jt[e];if(t===void 0){const r=j7.get(e);if(r!==void 0)t=jt[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return tv(t)}const X7=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function G2(n){return n.replace(X7,Y7)}function Y7(n,e,t,r){let i="";for(let o=parseInt(e);o<parseInt(t);o++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function W2(n){let e="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function K7(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===eE?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===T8?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Go&&(e="SHADOWMAP_TYPE_VSM"),e}function Z7(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case xc:case wc:e="ENVMAP_TYPE_CUBE";break;case am:e="ENVMAP_TYPE_CUBE_UV";break}return e}function J7(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case wc:e="ENVMAP_MODE_REFRACTION";break}return e}function Q7(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case tE:e="ENVMAP_BLENDING_MULTIPLY";break;case Z8:e="ENVMAP_BLENDING_MIX";break;case J8:e="ENVMAP_BLENDING_ADD";break}return e}function eV(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:r,maxMip:t}}function tV(n,e,t,r){const i=n.getContext(),o=t.defines;let s=t.vertexShader,a=t.fragmentShader;const l=K7(t),c=Z7(t),u=J7(t),d=Q7(t),h=eV(t),m=t.isWebGL2?"":H7(t),f=V7(o),v=i.createProgram();let g,b,S=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f].filter(Su).join(`
`),g.length>0&&(g+=`
`),b=[m,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f].filter(Su).join(`
`),b.length>0&&(b+=`
`)):(g=[W2(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Su).join(`
`),b=[m,W2(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==zs?"#define TONE_MAPPING":"",t.toneMapping!==zs?jt.tonemapping_pars_fragment:"",t.toneMapping!==zs?$7("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",jt.colorspace_pars_fragment,U7("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Su).join(`
`)),s=tv(s),s=H2(s,t),s=V2(s,t),a=tv(a),a=H2(a,t),a=V2(a,t),s=G2(s),a=G2(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(S=`#version 300 es
`,g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,b=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===c2?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===c2?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+b);const p=S+g+s,y=S+b+a,w=U2(i,i.VERTEX_SHADER,p),x=U2(i,i.FRAGMENT_SHADER,y);i.attachShader(v,w),i.attachShader(v,x),t.index0AttributeName!==void 0?i.bindAttribLocation(v,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(v,0,"position"),i.linkProgram(v);function _(I){if(n.debug.checkShaderErrors){const M=i.getProgramInfoLog(v).trim(),P=i.getShaderInfoLog(w).trim(),E=i.getShaderInfoLog(x).trim();let R=!0,B=!0;if(i.getProgramParameter(v,i.LINK_STATUS)===!1)if(R=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(i,v,w,x);else{const L=$2(i,w,"vertex"),F=$2(i,x,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(v,i.VALIDATE_STATUS)+`

Program Info Log: `+M+`
`+L+`
`+F)}else M!==""?console.warn("THREE.WebGLProgram: Program Info Log:",M):(P===""||E==="")&&(B=!1);B&&(I.diagnostics={runnable:R,programLog:M,vertexShader:{log:P,prefix:g},fragmentShader:{log:E,prefix:b}})}i.deleteShader(w),i.deleteShader(x),A=new Tf(i,v),C=G7(i,v)}let A;this.getUniforms=function(){return A===void 0&&_(this),A};let C;this.getAttributes=function(){return C===void 0&&_(this),C};let T=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return T===!1&&(T=i.getProgramParameter(v,k7)),T},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(v),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=B7++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=w,this.fragmentShader=x,this}let nV=0;class rV{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),o=this._getShaderStage(r),s=this._getShaderCacheForMaterial(e);return s.has(i)===!1&&(s.add(i),i.usedTimes++),s.has(o)===!1&&(s.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new iV(e),t.set(e,r)),r}}class iV{constructor(e){this.id=nV++,this.code=e,this.usedTimes=0}}function oV(n,e,t,r,i,o,s){const a=new pE,l=new rV,c=[],u=i.isWebGL2,d=i.logarithmicDepthBuffer,h=i.vertexTextures;let m=i.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(C){return C===0?"uv":`uv${C}`}function g(C,T,I,M,P){const E=M.fog,R=P.geometry,B=C.isMeshStandardMaterial?M.environment:null,L=(C.isMeshStandardMaterial?t:e).get(C.envMap||B),F=L&&L.mapping===am?L.image.height:null,H=f[C.type];C.precision!==null&&(m=i.getMaxPrecision(C.precision),m!==C.precision&&console.warn("THREE.WebGLProgram.getParameters:",C.precision,"not supported, using",m,"instead."));const $=R.morphAttributes.position||R.morphAttributes.normal||R.morphAttributes.color,O=$!==void 0?$.length:0;let k=0;R.morphAttributes.position!==void 0&&(k=1),R.morphAttributes.normal!==void 0&&(k=2),R.morphAttributes.color!==void 0&&(k=3);let X,ie,ne,Q;if(H){const St=po[H];X=St.vertexShader,ie=St.fragmentShader}else X=C.vertexShader,ie=C.fragmentShader,l.update(C),ne=l.getVertexShaderID(C),Q=l.getFragmentShaderID(C);const ce=n.getRenderTarget(),Z=P.isInstancedMesh===!0,re=!!C.map,se=!!C.matcap,fe=!!L,ue=!!C.aoMap,U=!!C.lightMap,K=!!C.bumpMap,be=!!C.normalMap,me=!!C.displacementMap,le=!!C.emissiveMap,xe=!!C.metalnessMap,pe=!!C.roughnessMap,ye=C.anisotropy>0,Me=C.clearcoat>0,Ce=C.iridescence>0,z=C.sheen>0,D=C.transmission>0,q=ye&&!!C.anisotropyMap,_e=Me&&!!C.clearcoatMap,ve=Me&&!!C.clearcoatNormalMap,Re=Me&&!!C.clearcoatRoughnessMap,ze=Ce&&!!C.iridescenceMap,Le=Ce&&!!C.iridescenceThicknessMap,Ve=z&&!!C.sheenColorMap,Ze=z&&!!C.sheenRoughnessMap,ut=!!C.specularMap,Ne=!!C.specularColorMap,ct=!!C.specularIntensityMap,he=D&&!!C.transmissionMap,Ae=D&&!!C.thicknessMap,Fe=!!C.gradientMap,ke=!!C.alphaMap,We=C.alphaTest>0,ee=!!C.alphaHash,Ie=!!C.extensions,Se=!!R.attributes.uv1,Ee=!!R.attributes.uv2,Ge=!!R.attributes.uv3;let ft=zs;return C.toneMapped&&(ce===null||ce.isXRRenderTarget===!0)&&(ft=n.toneMapping),{isWebGL2:u,shaderID:H,shaderType:C.type,shaderName:C.name,vertexShader:X,fragmentShader:ie,defines:C.defines,customVertexShaderID:ne,customFragmentShaderID:Q,isRawShaderMaterial:C.isRawShaderMaterial===!0,glslVersion:C.glslVersion,precision:m,instancing:Z,instancingColor:Z&&P.instanceColor!==null,supportsVertexTextures:h,outputColorSpace:ce===null?n.outputColorSpace:ce.isXRRenderTarget===!0?ce.texture.colorSpace:ns,map:re,matcap:se,envMap:fe,envMapMode:fe&&L.mapping,envMapCubeUVHeight:F,aoMap:ue,lightMap:U,bumpMap:K,normalMap:be,displacementMap:h&&me,emissiveMap:le,normalMapObjectSpace:be&&C.normalMapType===vU,normalMapTangentSpace:be&&C.normalMapType===gU,metalnessMap:xe,roughnessMap:pe,anisotropy:ye,anisotropyMap:q,clearcoat:Me,clearcoatMap:_e,clearcoatNormalMap:ve,clearcoatRoughnessMap:Re,iridescence:Ce,iridescenceMap:ze,iridescenceThicknessMap:Le,sheen:z,sheenColorMap:Ve,sheenRoughnessMap:Ze,specularMap:ut,specularColorMap:Ne,specularIntensityMap:ct,transmission:D,transmissionMap:he,thicknessMap:Ae,gradientMap:Fe,opaque:C.transparent===!1&&C.blending===Qo,alphaMap:ke,alphaTest:We,alphaHash:ee,combine:C.combine,mapUv:re&&v(C.map.channel),aoMapUv:ue&&v(C.aoMap.channel),lightMapUv:U&&v(C.lightMap.channel),bumpMapUv:K&&v(C.bumpMap.channel),normalMapUv:be&&v(C.normalMap.channel),displacementMapUv:me&&v(C.displacementMap.channel),emissiveMapUv:le&&v(C.emissiveMap.channel),metalnessMapUv:xe&&v(C.metalnessMap.channel),roughnessMapUv:pe&&v(C.roughnessMap.channel),anisotropyMapUv:q&&v(C.anisotropyMap.channel),clearcoatMapUv:_e&&v(C.clearcoatMap.channel),clearcoatNormalMapUv:ve&&v(C.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Re&&v(C.clearcoatRoughnessMap.channel),iridescenceMapUv:ze&&v(C.iridescenceMap.channel),iridescenceThicknessMapUv:Le&&v(C.iridescenceThicknessMap.channel),sheenColorMapUv:Ve&&v(C.sheenColorMap.channel),sheenRoughnessMapUv:Ze&&v(C.sheenRoughnessMap.channel),specularMapUv:ut&&v(C.specularMap.channel),specularColorMapUv:Ne&&v(C.specularColorMap.channel),specularIntensityMapUv:ct&&v(C.specularIntensityMap.channel),transmissionMapUv:he&&v(C.transmissionMap.channel),thicknessMapUv:Ae&&v(C.thicknessMap.channel),alphaMapUv:ke&&v(C.alphaMap.channel),vertexTangents:!!R.attributes.tangent&&(be||ye),vertexColors:C.vertexColors,vertexAlphas:C.vertexColors===!0&&!!R.attributes.color&&R.attributes.color.itemSize===4,vertexUv1s:Se,vertexUv2s:Ee,vertexUv3s:Ge,pointsUvs:P.isPoints===!0&&!!R.attributes.uv&&(re||ke),fog:!!E,useFog:C.fog===!0,fogExp2:E&&E.isFogExp2,flatShading:C.flatShading===!0,sizeAttenuation:C.sizeAttenuation===!0,logarithmicDepthBuffer:d,skinning:P.isSkinnedMesh===!0,morphTargets:R.morphAttributes.position!==void 0,morphNormals:R.morphAttributes.normal!==void 0,morphColors:R.morphAttributes.color!==void 0,morphTargetsCount:O,morphTextureStride:k,numDirLights:T.directional.length,numPointLights:T.point.length,numSpotLights:T.spot.length,numSpotLightMaps:T.spotLightMap.length,numRectAreaLights:T.rectArea.length,numHemiLights:T.hemi.length,numDirLightShadows:T.directionalShadowMap.length,numPointLightShadows:T.pointShadowMap.length,numSpotLightShadows:T.spotShadowMap.length,numSpotLightShadowsWithMaps:T.numSpotLightShadowsWithMaps,numLightProbes:T.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:C.dithering,shadowMapEnabled:n.shadowMap.enabled&&I.length>0,shadowMapType:n.shadowMap.type,toneMapping:ft,useLegacyLights:n._useLegacyLights,decodeVideoTexture:re&&C.map.isVideoTexture===!0&&fn.getTransfer(C.map.colorSpace)===Sn,premultipliedAlpha:C.premultipliedAlpha,doubleSided:C.side===go,flipSided:C.side===Or,useDepthPacking:C.depthPacking>=0,depthPacking:C.depthPacking||0,index0AttributeName:C.index0AttributeName,extensionDerivatives:Ie&&C.extensions.derivatives===!0,extensionFragDepth:Ie&&C.extensions.fragDepth===!0,extensionDrawBuffers:Ie&&C.extensions.drawBuffers===!0,extensionShaderTextureLOD:Ie&&C.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:C.customProgramCacheKey()}}function b(C){const T=[];if(C.shaderID?T.push(C.shaderID):(T.push(C.customVertexShaderID),T.push(C.customFragmentShaderID)),C.defines!==void 0)for(const I in C.defines)T.push(I),T.push(C.defines[I]);return C.isRawShaderMaterial===!1&&(S(T,C),p(T,C),T.push(n.outputColorSpace)),T.push(C.customProgramCacheKey),T.join()}function S(C,T){C.push(T.precision),C.push(T.outputColorSpace),C.push(T.envMapMode),C.push(T.envMapCubeUVHeight),C.push(T.mapUv),C.push(T.alphaMapUv),C.push(T.lightMapUv),C.push(T.aoMapUv),C.push(T.bumpMapUv),C.push(T.normalMapUv),C.push(T.displacementMapUv),C.push(T.emissiveMapUv),C.push(T.metalnessMapUv),C.push(T.roughnessMapUv),C.push(T.anisotropyMapUv),C.push(T.clearcoatMapUv),C.push(T.clearcoatNormalMapUv),C.push(T.clearcoatRoughnessMapUv),C.push(T.iridescenceMapUv),C.push(T.iridescenceThicknessMapUv),C.push(T.sheenColorMapUv),C.push(T.sheenRoughnessMapUv),C.push(T.specularMapUv),C.push(T.specularColorMapUv),C.push(T.specularIntensityMapUv),C.push(T.transmissionMapUv),C.push(T.thicknessMapUv),C.push(T.combine),C.push(T.fogExp2),C.push(T.sizeAttenuation),C.push(T.morphTargetsCount),C.push(T.morphAttributeCount),C.push(T.numDirLights),C.push(T.numPointLights),C.push(T.numSpotLights),C.push(T.numSpotLightMaps),C.push(T.numHemiLights),C.push(T.numRectAreaLights),C.push(T.numDirLightShadows),C.push(T.numPointLightShadows),C.push(T.numSpotLightShadows),C.push(T.numSpotLightShadowsWithMaps),C.push(T.numLightProbes),C.push(T.shadowMapType),C.push(T.toneMapping),C.push(T.numClippingPlanes),C.push(T.numClipIntersection),C.push(T.depthPacking)}function p(C,T){a.disableAll(),T.isWebGL2&&a.enable(0),T.supportsVertexTextures&&a.enable(1),T.instancing&&a.enable(2),T.instancingColor&&a.enable(3),T.matcap&&a.enable(4),T.envMap&&a.enable(5),T.normalMapObjectSpace&&a.enable(6),T.normalMapTangentSpace&&a.enable(7),T.clearcoat&&a.enable(8),T.iridescence&&a.enable(9),T.alphaTest&&a.enable(10),T.vertexColors&&a.enable(11),T.vertexAlphas&&a.enable(12),T.vertexUv1s&&a.enable(13),T.vertexUv2s&&a.enable(14),T.vertexUv3s&&a.enable(15),T.vertexTangents&&a.enable(16),T.anisotropy&&a.enable(17),T.alphaHash&&a.enable(18),C.push(a.mask),a.disableAll(),T.fog&&a.enable(0),T.useFog&&a.enable(1),T.flatShading&&a.enable(2),T.logarithmicDepthBuffer&&a.enable(3),T.skinning&&a.enable(4),T.morphTargets&&a.enable(5),T.morphNormals&&a.enable(6),T.morphColors&&a.enable(7),T.premultipliedAlpha&&a.enable(8),T.shadowMapEnabled&&a.enable(9),T.useLegacyLights&&a.enable(10),T.doubleSided&&a.enable(11),T.flipSided&&a.enable(12),T.useDepthPacking&&a.enable(13),T.dithering&&a.enable(14),T.transmission&&a.enable(15),T.sheen&&a.enable(16),T.opaque&&a.enable(17),T.pointsUvs&&a.enable(18),T.decodeVideoTexture&&a.enable(19),C.push(a.mask)}function y(C){const T=f[C.type];let I;if(T){const M=po[T];I=Mf.clone(M.uniforms)}else I=C.uniforms;return I}function w(C,T){let I;for(let M=0,P=c.length;M<P;M++){const E=c[M];if(E.cacheKey===T){I=E,++I.usedTimes;break}}return I===void 0&&(I=new tV(n,T,C,o),c.push(I)),I}function x(C){if(--C.usedTimes===0){const T=c.indexOf(C);c[T]=c[c.length-1],c.pop(),C.destroy()}}function _(C){l.remove(C)}function A(){l.dispose()}return{getParameters:g,getProgramCacheKey:b,getUniforms:y,acquireProgram:w,releaseProgram:x,releaseShaderCache:_,programs:c,dispose:A}}function sV(){let n=new WeakMap;function e(o){let s=n.get(o);return s===void 0&&(s={},n.set(o,s)),s}function t(o){n.delete(o)}function r(o,s,a){n.get(o)[s]=a}function i(){n=new WeakMap}return{get:e,remove:t,update:r,dispose:i}}function aV(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function j2(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function q2(){const n=[];let e=0;const t=[],r=[],i=[];function o(){e=0,t.length=0,r.length=0,i.length=0}function s(d,h,m,f,v,g){let b=n[e];return b===void 0?(b={id:d.id,object:d,geometry:h,material:m,groupOrder:f,renderOrder:d.renderOrder,z:v,group:g},n[e]=b):(b.id=d.id,b.object=d,b.geometry=h,b.material=m,b.groupOrder=f,b.renderOrder=d.renderOrder,b.z=v,b.group=g),e++,b}function a(d,h,m,f,v,g){const b=s(d,h,m,f,v,g);m.transmission>0?r.push(b):m.transparent===!0?i.push(b):t.push(b)}function l(d,h,m,f,v,g){const b=s(d,h,m,f,v,g);m.transmission>0?r.unshift(b):m.transparent===!0?i.unshift(b):t.unshift(b)}function c(d,h){t.length>1&&t.sort(d||aV),r.length>1&&r.sort(h||j2),i.length>1&&i.sort(h||j2)}function u(){for(let d=e,h=n.length;d<h;d++){const m=n[d];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:t,transmissive:r,transparent:i,init:o,push:a,unshift:l,finish:u,sort:c}}function lV(){let n=new WeakMap;function e(r,i){const o=n.get(r);let s;return o===void 0?(s=new q2,n.set(r,[s])):i>=o.length?(s=new q2,o.push(s)):s=o[i],s}function t(){n=new WeakMap}return{get:e,dispose:t}}function cV(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new te,color:new _t};break;case"SpotLight":t={position:new te,direction:new te,color:new _t,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new te,color:new _t,distance:0,decay:0};break;case"HemisphereLight":t={direction:new te,skyColor:new _t,groundColor:new _t};break;case"RectAreaLight":t={color:new _t,position:new te,halfWidth:new te,halfHeight:new te};break}return n[e.id]=t,t}}}function uV(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ut};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ut};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ut,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let dV=0;function hV(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function fV(n,e){const t=new cV,r=uV(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)i.probe.push(new te);const o=new te,s=new at,a=new at;function l(u,d){let h=0,m=0,f=0;for(let M=0;M<9;M++)i.probe[M].set(0,0,0);let v=0,g=0,b=0,S=0,p=0,y=0,w=0,x=0,_=0,A=0,C=0;u.sort(hV);const T=d===!0?Math.PI:1;for(let M=0,P=u.length;M<P;M++){const E=u[M],R=E.color,B=E.intensity,L=E.distance,F=E.shadow&&E.shadow.map?E.shadow.map.texture:null;if(E.isAmbientLight)h+=R.r*B*T,m+=R.g*B*T,f+=R.b*B*T;else if(E.isLightProbe){for(let H=0;H<9;H++)i.probe[H].addScaledVector(E.sh.coefficients[H],B);C++}else if(E.isDirectionalLight){const H=t.get(E);if(H.color.copy(E.color).multiplyScalar(E.intensity*T),E.castShadow){const $=E.shadow,O=r.get(E);O.shadowBias=$.bias,O.shadowNormalBias=$.normalBias,O.shadowRadius=$.radius,O.shadowMapSize=$.mapSize,i.directionalShadow[v]=O,i.directionalShadowMap[v]=F,i.directionalShadowMatrix[v]=E.shadow.matrix,y++}i.directional[v]=H,v++}else if(E.isSpotLight){const H=t.get(E);H.position.setFromMatrixPosition(E.matrixWorld),H.color.copy(R).multiplyScalar(B*T),H.distance=L,H.coneCos=Math.cos(E.angle),H.penumbraCos=Math.cos(E.angle*(1-E.penumbra)),H.decay=E.decay,i.spot[b]=H;const $=E.shadow;if(E.map&&(i.spotLightMap[_]=E.map,_++,$.updateMatrices(E),E.castShadow&&A++),i.spotLightMatrix[b]=$.matrix,E.castShadow){const O=r.get(E);O.shadowBias=$.bias,O.shadowNormalBias=$.normalBias,O.shadowRadius=$.radius,O.shadowMapSize=$.mapSize,i.spotShadow[b]=O,i.spotShadowMap[b]=F,x++}b++}else if(E.isRectAreaLight){const H=t.get(E);H.color.copy(R).multiplyScalar(B),H.halfWidth.set(E.width*.5,0,0),H.halfHeight.set(0,E.height*.5,0),i.rectArea[S]=H,S++}else if(E.isPointLight){const H=t.get(E);if(H.color.copy(E.color).multiplyScalar(E.intensity*T),H.distance=E.distance,H.decay=E.decay,E.castShadow){const $=E.shadow,O=r.get(E);O.shadowBias=$.bias,O.shadowNormalBias=$.normalBias,O.shadowRadius=$.radius,O.shadowMapSize=$.mapSize,O.shadowCameraNear=$.camera.near,O.shadowCameraFar=$.camera.far,i.pointShadow[g]=O,i.pointShadowMap[g]=F,i.pointShadowMatrix[g]=E.shadow.matrix,w++}i.point[g]=H,g++}else if(E.isHemisphereLight){const H=t.get(E);H.skyColor.copy(E.color).multiplyScalar(B*T),H.groundColor.copy(E.groundColor).multiplyScalar(B*T),i.hemi[p]=H,p++}}S>0&&(e.isWebGL2||n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=ht.LTC_FLOAT_1,i.rectAreaLTC2=ht.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=ht.LTC_HALF_1,i.rectAreaLTC2=ht.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=h,i.ambient[1]=m,i.ambient[2]=f;const I=i.hash;(I.directionalLength!==v||I.pointLength!==g||I.spotLength!==b||I.rectAreaLength!==S||I.hemiLength!==p||I.numDirectionalShadows!==y||I.numPointShadows!==w||I.numSpotShadows!==x||I.numSpotMaps!==_||I.numLightProbes!==C)&&(i.directional.length=v,i.spot.length=b,i.rectArea.length=S,i.point.length=g,i.hemi.length=p,i.directionalShadow.length=y,i.directionalShadowMap.length=y,i.pointShadow.length=w,i.pointShadowMap.length=w,i.spotShadow.length=x,i.spotShadowMap.length=x,i.directionalShadowMatrix.length=y,i.pointShadowMatrix.length=w,i.spotLightMatrix.length=x+_-A,i.spotLightMap.length=_,i.numSpotLightShadowsWithMaps=A,i.numLightProbes=C,I.directionalLength=v,I.pointLength=g,I.spotLength=b,I.rectAreaLength=S,I.hemiLength=p,I.numDirectionalShadows=y,I.numPointShadows=w,I.numSpotShadows=x,I.numSpotMaps=_,I.numLightProbes=C,i.version=dV++)}function c(u,d){let h=0,m=0,f=0,v=0,g=0;const b=d.matrixWorldInverse;for(let S=0,p=u.length;S<p;S++){const y=u[S];if(y.isDirectionalLight){const w=i.directional[h];w.direction.setFromMatrixPosition(y.matrixWorld),o.setFromMatrixPosition(y.target.matrixWorld),w.direction.sub(o),w.direction.transformDirection(b),h++}else if(y.isSpotLight){const w=i.spot[f];w.position.setFromMatrixPosition(y.matrixWorld),w.position.applyMatrix4(b),w.direction.setFromMatrixPosition(y.matrixWorld),o.setFromMatrixPosition(y.target.matrixWorld),w.direction.sub(o),w.direction.transformDirection(b),f++}else if(y.isRectAreaLight){const w=i.rectArea[v];w.position.setFromMatrixPosition(y.matrixWorld),w.position.applyMatrix4(b),a.identity(),s.copy(y.matrixWorld),s.premultiply(b),a.extractRotation(s),w.halfWidth.set(y.width*.5,0,0),w.halfHeight.set(0,y.height*.5,0),w.halfWidth.applyMatrix4(a),w.halfHeight.applyMatrix4(a),v++}else if(y.isPointLight){const w=i.point[m];w.position.setFromMatrixPosition(y.matrixWorld),w.position.applyMatrix4(b),m++}else if(y.isHemisphereLight){const w=i.hemi[g];w.direction.setFromMatrixPosition(y.matrixWorld),w.direction.transformDirection(b),g++}}}return{setup:l,setupView:c,state:i}}function X2(n,e){const t=new fV(n,e),r=[],i=[];function o(){r.length=0,i.length=0}function s(d){r.push(d)}function a(d){i.push(d)}function l(d){t.setup(r,d)}function c(d){t.setupView(r,d)}return{init:o,state:{lightsArray:r,shadowsArray:i,lights:t},setupLights:l,setupLightsView:c,pushLight:s,pushShadow:a}}function pV(n,e){let t=new WeakMap;function r(o,s=0){const a=t.get(o);let l;return a===void 0?(l=new X2(n,e),t.set(o,[l])):s>=a.length?(l=new X2(n,e),a.push(l)):l=a[s],l}function i(){t=new WeakMap}return{get:r,dispose:i}}class mV extends $c{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=pU,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class gV extends $c{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const vV=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,bV=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function yV(n,e,t){let r=new zb;const i=new Ut,o=new Ut,s=new lr,a=new mV({depthPacking:mU}),l=new gV,c={},u=t.maxTextureSize,d={[ts]:Or,[Or]:ts,[go]:go},h=new Mi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ut},radius:{value:4}},vertexShader:vV,fragmentShader:bV}),m=h.clone();m.defines.HORIZONTAL_PASS=1;const f=new tr;f.setAttribute("position",new Wn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new yo(f,h),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=eE;let b=this.type;this.render=function(w,x,_){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||w.length===0)return;const A=n.getRenderTarget(),C=n.getActiveCubeFace(),T=n.getActiveMipmapLevel(),I=n.state;I.setBlending(Jo),I.buffers.color.setClear(1,1,1,1),I.buffers.depth.setTest(!0),I.setScissorTest(!1);const M=b!==Go&&this.type===Go,P=b===Go&&this.type!==Go;for(let E=0,R=w.length;E<R;E++){const B=w[E],L=B.shadow;if(L===void 0){console.warn("THREE.WebGLShadowMap:",B,"has no shadow.");continue}if(L.autoUpdate===!1&&L.needsUpdate===!1)continue;i.copy(L.mapSize);const F=L.getFrameExtents();if(i.multiply(F),o.copy(L.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(o.x=Math.floor(u/F.x),i.x=o.x*F.x,L.mapSize.x=o.x),i.y>u&&(o.y=Math.floor(u/F.y),i.y=o.y*F.y,L.mapSize.y=o.y)),L.map===null||M===!0||P===!0){const $=this.type!==Go?{minFilter:gn,magFilter:gn}:{};L.map!==null&&L.map.dispose(),L.map=new xo(i.x,i.y,$),L.map.texture.name=B.name+".shadowMap",L.camera.updateProjectionMatrix()}n.setRenderTarget(L.map),n.clear();const H=L.getViewportCount();for(let $=0;$<H;$++){const O=L.getViewport($);s.set(o.x*O.x,o.y*O.y,o.x*O.z,o.y*O.w),I.viewport(s),L.updateMatrices(B,$),r=L.getFrustum(),y(x,_,L.camera,B,this.type)}L.isPointLightShadow!==!0&&this.type===Go&&S(L,_),L.needsUpdate=!1}b=this.type,g.needsUpdate=!1,n.setRenderTarget(A,C,T)};function S(w,x){const _=e.update(v);h.defines.VSM_SAMPLES!==w.blurSamples&&(h.defines.VSM_SAMPLES=w.blurSamples,m.defines.VSM_SAMPLES=w.blurSamples,h.needsUpdate=!0,m.needsUpdate=!0),w.mapPass===null&&(w.mapPass=new xo(i.x,i.y)),h.uniforms.shadow_pass.value=w.map.texture,h.uniforms.resolution.value=w.mapSize,h.uniforms.radius.value=w.radius,n.setRenderTarget(w.mapPass),n.clear(),n.renderBufferDirect(x,null,_,h,v,null),m.uniforms.shadow_pass.value=w.mapPass.texture,m.uniforms.resolution.value=w.mapSize,m.uniforms.radius.value=w.radius,n.setRenderTarget(w.map),n.clear(),n.renderBufferDirect(x,null,_,m,v,null)}function p(w,x,_,A){let C=null;const T=_.isPointLight===!0?w.customDistanceMaterial:w.customDepthMaterial;if(T!==void 0)C=T;else if(C=_.isPointLight===!0?l:a,n.localClippingEnabled&&x.clipShadows===!0&&Array.isArray(x.clippingPlanes)&&x.clippingPlanes.length!==0||x.displacementMap&&x.displacementScale!==0||x.alphaMap&&x.alphaTest>0||x.map&&x.alphaTest>0){const I=C.uuid,M=x.uuid;let P=c[I];P===void 0&&(P={},c[I]=P);let E=P[M];E===void 0&&(E=C.clone(),P[M]=E),C=E}if(C.visible=x.visible,C.wireframe=x.wireframe,A===Go?C.side=x.shadowSide!==null?x.shadowSide:x.side:C.side=x.shadowSide!==null?x.shadowSide:d[x.side],C.alphaMap=x.alphaMap,C.alphaTest=x.alphaTest,C.map=x.map,C.clipShadows=x.clipShadows,C.clippingPlanes=x.clippingPlanes,C.clipIntersection=x.clipIntersection,C.displacementMap=x.displacementMap,C.displacementScale=x.displacementScale,C.displacementBias=x.displacementBias,C.wireframeLinewidth=x.wireframeLinewidth,C.linewidth=x.linewidth,_.isPointLight===!0&&C.isMeshDistanceMaterial===!0){const I=n.properties.get(C);I.light=_}return C}function y(w,x,_,A,C){if(w.visible===!1)return;if(w.layers.test(x.layers)&&(w.isMesh||w.isLine||w.isPoints)&&(w.castShadow||w.receiveShadow&&C===Go)&&(!w.frustumCulled||r.intersectsObject(w))){w.modelViewMatrix.multiplyMatrices(_.matrixWorldInverse,w.matrixWorld);const M=e.update(w),P=w.material;if(Array.isArray(P)){const E=M.groups;for(let R=0,B=E.length;R<B;R++){const L=E[R],F=P[L.materialIndex];if(F&&F.visible){const H=p(w,F,A,C);n.renderBufferDirect(_,null,M,H,w,L)}}}else if(P.visible){const E=p(w,P,A,C);n.renderBufferDirect(_,null,M,E,w,null)}}const I=w.children;for(let M=0,P=I.length;M<P;M++)y(I[M],x,_,A,C)}}function _V(n,e,t){const r=t.isWebGL2;function i(){let ee=!1;const Ie=new lr;let Se=null;const Ee=new lr(0,0,0,0);return{setMask:function(Ge){Se!==Ge&&!ee&&(n.colorMask(Ge,Ge,Ge,Ge),Se=Ge)},setLocked:function(Ge){ee=Ge},setClear:function(Ge,ft,Rt,St,N){N===!0&&(Ge*=St,ft*=St,Rt*=St),Ie.set(Ge,ft,Rt,St),Ee.equals(Ie)===!1&&(n.clearColor(Ge,ft,Rt,St),Ee.copy(Ie))},reset:function(){ee=!1,Se=null,Ee.set(-1,0,0,0)}}}function o(){let ee=!1,Ie=null,Se=null,Ee=null;return{setTest:function(Ge){Ge?re(n.DEPTH_TEST):se(n.DEPTH_TEST)},setMask:function(Ge){Ie!==Ge&&!ee&&(n.depthMask(Ge),Ie=Ge)},setFunc:function(Ge){if(Se!==Ge){switch(Ge){case G8:n.depthFunc(n.NEVER);break;case W8:n.depthFunc(n.ALWAYS);break;case j8:n.depthFunc(n.LESS);break;case lp:n.depthFunc(n.LEQUAL);break;case q8:n.depthFunc(n.EQUAL);break;case X8:n.depthFunc(n.GEQUAL);break;case Y8:n.depthFunc(n.GREATER);break;case K8:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}Se=Ge}},setLocked:function(Ge){ee=Ge},setClear:function(Ge){Ee!==Ge&&(n.clearDepth(Ge),Ee=Ge)},reset:function(){ee=!1,Ie=null,Se=null,Ee=null}}}function s(){let ee=!1,Ie=null,Se=null,Ee=null,Ge=null,ft=null,Rt=null,St=null,N=null;return{setTest:function(j){ee||(j?re(n.STENCIL_TEST):se(n.STENCIL_TEST))},setMask:function(j){Ie!==j&&!ee&&(n.stencilMask(j),Ie=j)},setFunc:function(j,Y,oe){(Se!==j||Ee!==Y||Ge!==oe)&&(n.stencilFunc(j,Y,oe),Se=j,Ee=Y,Ge=oe)},setOp:function(j,Y,oe){(ft!==j||Rt!==Y||St!==oe)&&(n.stencilOp(j,Y,oe),ft=j,Rt=Y,St=oe)},setLocked:function(j){ee=j},setClear:function(j){N!==j&&(n.clearStencil(j),N=j)},reset:function(){ee=!1,Ie=null,Se=null,Ee=null,Ge=null,ft=null,Rt=null,St=null,N=null}}}const a=new i,l=new o,c=new s,u=new WeakMap,d=new WeakMap;let h={},m={},f=new WeakMap,v=[],g=null,b=!1,S=null,p=null,y=null,w=null,x=null,_=null,A=null,C=new _t(0,0,0),T=0,I=!1,M=null,P=null,E=null,R=null,B=null;const L=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let F=!1,H=0;const $=n.getParameter(n.VERSION);$.indexOf("WebGL")!==-1?(H=parseFloat(/^WebGL (\d)/.exec($)[1]),F=H>=1):$.indexOf("OpenGL ES")!==-1&&(H=parseFloat(/^OpenGL ES (\d)/.exec($)[1]),F=H>=2);let O=null,k={};const X=n.getParameter(n.SCISSOR_BOX),ie=n.getParameter(n.VIEWPORT),ne=new lr().fromArray(X),Q=new lr().fromArray(ie);function ce(ee,Ie,Se,Ee){const Ge=new Uint8Array(4),ft=n.createTexture();n.bindTexture(ee,ft),n.texParameteri(ee,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(ee,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Rt=0;Rt<Se;Rt++)r&&(ee===n.TEXTURE_3D||ee===n.TEXTURE_2D_ARRAY)?n.texImage3D(Ie,0,n.RGBA,1,1,Ee,0,n.RGBA,n.UNSIGNED_BYTE,Ge):n.texImage2D(Ie+Rt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Ge);return ft}const Z={};Z[n.TEXTURE_2D]=ce(n.TEXTURE_2D,n.TEXTURE_2D,1),Z[n.TEXTURE_CUBE_MAP]=ce(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(Z[n.TEXTURE_2D_ARRAY]=ce(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Z[n.TEXTURE_3D]=ce(n.TEXTURE_3D,n.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),re(n.DEPTH_TEST),l.setFunc(lp),xe(!1),pe(Ix),re(n.CULL_FACE),me(Jo);function re(ee){h[ee]!==!0&&(n.enable(ee),h[ee]=!0)}function se(ee){h[ee]!==!1&&(n.disable(ee),h[ee]=!1)}function fe(ee,Ie){return m[ee]!==Ie?(n.bindFramebuffer(ee,Ie),m[ee]=Ie,r&&(ee===n.DRAW_FRAMEBUFFER&&(m[n.FRAMEBUFFER]=Ie),ee===n.FRAMEBUFFER&&(m[n.DRAW_FRAMEBUFFER]=Ie)),!0):!1}function ue(ee,Ie){let Se=v,Ee=!1;if(ee)if(Se=f.get(Ie),Se===void 0&&(Se=[],f.set(Ie,Se)),ee.isWebGLMultipleRenderTargets){const Ge=ee.texture;if(Se.length!==Ge.length||Se[0]!==n.COLOR_ATTACHMENT0){for(let ft=0,Rt=Ge.length;ft<Rt;ft++)Se[ft]=n.COLOR_ATTACHMENT0+ft;Se.length=Ge.length,Ee=!0}}else Se[0]!==n.COLOR_ATTACHMENT0&&(Se[0]=n.COLOR_ATTACHMENT0,Ee=!0);else Se[0]!==n.BACK&&(Se[0]=n.BACK,Ee=!0);Ee&&(t.isWebGL2?n.drawBuffers(Se):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Se))}function U(ee){return g!==ee?(n.useProgram(ee),g=ee,!0):!1}const K={[Da]:n.FUNC_ADD,[P8]:n.FUNC_SUBTRACT,[R8]:n.FUNC_REVERSE_SUBTRACT};if(r)K[Fx]=n.MIN,K[Ox]=n.MAX;else{const ee=e.get("EXT_blend_minmax");ee!==null&&(K[Fx]=ee.MIN_EXT,K[Ox]=ee.MAX_EXT)}const be={[I8]:n.ZERO,[D8]:n.ONE,[L8]:n.SRC_COLOR,[j1]:n.SRC_ALPHA,[z8]:n.SRC_ALPHA_SATURATE,[B8]:n.DST_COLOR,[O8]:n.DST_ALPHA,[F8]:n.ONE_MINUS_SRC_COLOR,[q1]:n.ONE_MINUS_SRC_ALPHA,[N8]:n.ONE_MINUS_DST_COLOR,[k8]:n.ONE_MINUS_DST_ALPHA,[U8]:n.CONSTANT_COLOR,[$8]:n.ONE_MINUS_CONSTANT_COLOR,[H8]:n.CONSTANT_ALPHA,[V8]:n.ONE_MINUS_CONSTANT_ALPHA};function me(ee,Ie,Se,Ee,Ge,ft,Rt,St,N,j){if(ee===Jo){b===!0&&(se(n.BLEND),b=!1);return}if(b===!1&&(re(n.BLEND),b=!0),ee!==E8){if(ee!==S||j!==I){if((p!==Da||x!==Da)&&(n.blendEquation(n.FUNC_ADD),p=Da,x=Da),j)switch(ee){case Qo:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case W1:n.blendFunc(n.ONE,n.ONE);break;case Dx:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Lx:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}else switch(ee){case Qo:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case W1:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case Dx:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Lx:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}y=null,w=null,_=null,A=null,C.set(0,0,0),T=0,S=ee,I=j}return}Ge=Ge||Ie,ft=ft||Se,Rt=Rt||Ee,(Ie!==p||Ge!==x)&&(n.blendEquationSeparate(K[Ie],K[Ge]),p=Ie,x=Ge),(Se!==y||Ee!==w||ft!==_||Rt!==A)&&(n.blendFuncSeparate(be[Se],be[Ee],be[ft],be[Rt]),y=Se,w=Ee,_=ft,A=Rt),(St.equals(C)===!1||N!==T)&&(n.blendColor(St.r,St.g,St.b,N),C.copy(St),T=N),S=ee,I=!1}function le(ee,Ie){ee.side===go?se(n.CULL_FACE):re(n.CULL_FACE);let Se=ee.side===Or;Ie&&(Se=!Se),xe(Se),ee.blending===Qo&&ee.transparent===!1?me(Jo):me(ee.blending,ee.blendEquation,ee.blendSrc,ee.blendDst,ee.blendEquationAlpha,ee.blendSrcAlpha,ee.blendDstAlpha,ee.blendColor,ee.blendAlpha,ee.premultipliedAlpha),l.setFunc(ee.depthFunc),l.setTest(ee.depthTest),l.setMask(ee.depthWrite),a.setMask(ee.colorWrite);const Ee=ee.stencilWrite;c.setTest(Ee),Ee&&(c.setMask(ee.stencilWriteMask),c.setFunc(ee.stencilFunc,ee.stencilRef,ee.stencilFuncMask),c.setOp(ee.stencilFail,ee.stencilZFail,ee.stencilZPass)),Me(ee.polygonOffset,ee.polygonOffsetFactor,ee.polygonOffsetUnits),ee.alphaToCoverage===!0?re(n.SAMPLE_ALPHA_TO_COVERAGE):se(n.SAMPLE_ALPHA_TO_COVERAGE)}function xe(ee){M!==ee&&(ee?n.frontFace(n.CW):n.frontFace(n.CCW),M=ee)}function pe(ee){ee!==A8?(re(n.CULL_FACE),ee!==P&&(ee===Ix?n.cullFace(n.BACK):ee===M8?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):se(n.CULL_FACE),P=ee}function ye(ee){ee!==E&&(F&&n.lineWidth(ee),E=ee)}function Me(ee,Ie,Se){ee?(re(n.POLYGON_OFFSET_FILL),(R!==Ie||B!==Se)&&(n.polygonOffset(Ie,Se),R=Ie,B=Se)):se(n.POLYGON_OFFSET_FILL)}function Ce(ee){ee?re(n.SCISSOR_TEST):se(n.SCISSOR_TEST)}function z(ee){ee===void 0&&(ee=n.TEXTURE0+L-1),O!==ee&&(n.activeTexture(ee),O=ee)}function D(ee,Ie,Se){Se===void 0&&(O===null?Se=n.TEXTURE0+L-1:Se=O);let Ee=k[Se];Ee===void 0&&(Ee={type:void 0,texture:void 0},k[Se]=Ee),(Ee.type!==ee||Ee.texture!==Ie)&&(O!==Se&&(n.activeTexture(Se),O=Se),n.bindTexture(ee,Ie||Z[ee]),Ee.type=ee,Ee.texture=Ie)}function q(){const ee=k[O];ee!==void 0&&ee.type!==void 0&&(n.bindTexture(ee.type,null),ee.type=void 0,ee.texture=void 0)}function _e(){try{n.compressedTexImage2D.apply(n,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function ve(){try{n.compressedTexImage3D.apply(n,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Re(){try{n.texSubImage2D.apply(n,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function ze(){try{n.texSubImage3D.apply(n,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Le(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ve(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ze(){try{n.texStorage2D.apply(n,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function ut(){try{n.texStorage3D.apply(n,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ne(){try{n.texImage2D.apply(n,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function ct(){try{n.texImage3D.apply(n,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function he(ee){ne.equals(ee)===!1&&(n.scissor(ee.x,ee.y,ee.z,ee.w),ne.copy(ee))}function Ae(ee){Q.equals(ee)===!1&&(n.viewport(ee.x,ee.y,ee.z,ee.w),Q.copy(ee))}function Fe(ee,Ie){let Se=d.get(Ie);Se===void 0&&(Se=new WeakMap,d.set(Ie,Se));let Ee=Se.get(ee);Ee===void 0&&(Ee=n.getUniformBlockIndex(Ie,ee.name),Se.set(ee,Ee))}function ke(ee,Ie){const Ee=d.get(Ie).get(ee);u.get(Ie)!==Ee&&(n.uniformBlockBinding(Ie,Ee,ee.__bindingPointIndex),u.set(Ie,Ee))}function We(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),r===!0&&(n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),h={},O=null,k={},m={},f=new WeakMap,v=[],g=null,b=!1,S=null,p=null,y=null,w=null,x=null,_=null,A=null,C=new _t(0,0,0),T=0,I=!1,M=null,P=null,E=null,R=null,B=null,ne.set(0,0,n.canvas.width,n.canvas.height),Q.set(0,0,n.canvas.width,n.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:re,disable:se,bindFramebuffer:fe,drawBuffers:ue,useProgram:U,setBlending:me,setMaterial:le,setFlipSided:xe,setCullFace:pe,setLineWidth:ye,setPolygonOffset:Me,setScissorTest:Ce,activeTexture:z,bindTexture:D,unbindTexture:q,compressedTexImage2D:_e,compressedTexImage3D:ve,texImage2D:Ne,texImage3D:ct,updateUBOMapping:Fe,uniformBlockBinding:ke,texStorage2D:Ze,texStorage3D:ut,texSubImage2D:Re,texSubImage3D:ze,compressedTexSubImage2D:Le,compressedTexSubImage3D:Ve,scissor:he,viewport:Ae,reset:We}}function xV(n,e,t,r,i,o,s){const a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,d=i.maxSamples,h=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,m=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let v;const g=new WeakMap;let b=!1;try{b=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function S(z,D){return b?new OffscreenCanvas(z,D):fp("canvas")}function p(z,D,q,_e){let ve=1;if((z.width>_e||z.height>_e)&&(ve=_e/Math.max(z.width,z.height)),ve<1||D===!0)if(typeof HTMLImageElement<"u"&&z instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&z instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&z instanceof ImageBitmap){const Re=D?ev:Math.floor,ze=Re(ve*z.width),Le=Re(ve*z.height);v===void 0&&(v=S(ze,Le));const Ve=q?S(ze,Le):v;return Ve.width=ze,Ve.height=Le,Ve.getContext("2d").drawImage(z,0,0,ze,Le),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+z.width+"x"+z.height+") to ("+ze+"x"+Le+")."),Ve}else return"data"in z&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+z.width+"x"+z.height+")."),z;return z}function y(z){return u2(z.width)&&u2(z.height)}function w(z){return a?!1:z.wrapS!==Wi||z.wrapT!==Wi||z.minFilter!==gn&&z.minFilter!==Cr}function x(z,D){return z.generateMipmaps&&D&&z.minFilter!==gn&&z.minFilter!==Cr}function _(z){n.generateMipmap(z)}function A(z,D,q,_e,ve=!1){if(a===!1)return D;if(z!==null){if(n[z]!==void 0)return n[z];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+z+"'")}let Re=D;if(D===n.RED&&(q===n.FLOAT&&(Re=n.R32F),q===n.HALF_FLOAT&&(Re=n.R16F),q===n.UNSIGNED_BYTE&&(Re=n.R8)),D===n.RED_INTEGER&&(q===n.UNSIGNED_BYTE&&(Re=n.R8UI),q===n.UNSIGNED_SHORT&&(Re=n.R16UI),q===n.UNSIGNED_INT&&(Re=n.R32UI),q===n.BYTE&&(Re=n.R8I),q===n.SHORT&&(Re=n.R16I),q===n.INT&&(Re=n.R32I)),D===n.RG&&(q===n.FLOAT&&(Re=n.RG32F),q===n.HALF_FLOAT&&(Re=n.RG16F),q===n.UNSIGNED_BYTE&&(Re=n.RG8)),D===n.RGBA){const ze=ve?cp:fn.getTransfer(_e);q===n.FLOAT&&(Re=n.RGBA32F),q===n.HALF_FLOAT&&(Re=n.RGBA16F),q===n.UNSIGNED_BYTE&&(Re=ze===Sn?n.SRGB8_ALPHA8:n.RGBA8),q===n.UNSIGNED_SHORT_4_4_4_4&&(Re=n.RGBA4),q===n.UNSIGNED_SHORT_5_5_5_1&&(Re=n.RGB5_A1)}return(Re===n.R16F||Re===n.R32F||Re===n.RG16F||Re===n.RG32F||Re===n.RGBA16F||Re===n.RGBA32F)&&e.get("EXT_color_buffer_float"),Re}function C(z,D,q){return x(z,q)===!0||z.isFramebufferTexture&&z.minFilter!==gn&&z.minFilter!==Cr?Math.log2(Math.max(D.width,D.height))+1:z.mipmaps!==void 0&&z.mipmaps.length>0?z.mipmaps.length:z.isCompressedTexture&&Array.isArray(z.image)?D.mipmaps.length:1}function T(z){return z===gn||z===kx||z===gg?n.NEAREST:n.LINEAR}function I(z){const D=z.target;D.removeEventListener("dispose",I),P(D),D.isVideoTexture&&f.delete(D)}function M(z){const D=z.target;D.removeEventListener("dispose",M),R(D)}function P(z){const D=r.get(z);if(D.__webglInit===void 0)return;const q=z.source,_e=g.get(q);if(_e){const ve=_e[D.__cacheKey];ve.usedTimes--,ve.usedTimes===0&&E(z),Object.keys(_e).length===0&&g.delete(q)}r.remove(z)}function E(z){const D=r.get(z);n.deleteTexture(D.__webglTexture);const q=z.source,_e=g.get(q);delete _e[D.__cacheKey],s.memory.textures--}function R(z){const D=z.texture,q=r.get(z),_e=r.get(D);if(_e.__webglTexture!==void 0&&(n.deleteTexture(_e.__webglTexture),s.memory.textures--),z.depthTexture&&z.depthTexture.dispose(),z.isWebGLCubeRenderTarget)for(let ve=0;ve<6;ve++){if(Array.isArray(q.__webglFramebuffer[ve]))for(let Re=0;Re<q.__webglFramebuffer[ve].length;Re++)n.deleteFramebuffer(q.__webglFramebuffer[ve][Re]);else n.deleteFramebuffer(q.__webglFramebuffer[ve]);q.__webglDepthbuffer&&n.deleteRenderbuffer(q.__webglDepthbuffer[ve])}else{if(Array.isArray(q.__webglFramebuffer))for(let ve=0;ve<q.__webglFramebuffer.length;ve++)n.deleteFramebuffer(q.__webglFramebuffer[ve]);else n.deleteFramebuffer(q.__webglFramebuffer);if(q.__webglDepthbuffer&&n.deleteRenderbuffer(q.__webglDepthbuffer),q.__webglMultisampledFramebuffer&&n.deleteFramebuffer(q.__webglMultisampledFramebuffer),q.__webglColorRenderbuffer)for(let ve=0;ve<q.__webglColorRenderbuffer.length;ve++)q.__webglColorRenderbuffer[ve]&&n.deleteRenderbuffer(q.__webglColorRenderbuffer[ve]);q.__webglDepthRenderbuffer&&n.deleteRenderbuffer(q.__webglDepthRenderbuffer)}if(z.isWebGLMultipleRenderTargets)for(let ve=0,Re=D.length;ve<Re;ve++){const ze=r.get(D[ve]);ze.__webglTexture&&(n.deleteTexture(ze.__webglTexture),s.memory.textures--),r.remove(D[ve])}r.remove(D),r.remove(z)}let B=0;function L(){B=0}function F(){const z=B;return z>=l&&console.warn("THREE.WebGLTextures: Trying to use "+z+" texture units while this GPU supports only "+l),B+=1,z}function H(z){const D=[];return D.push(z.wrapS),D.push(z.wrapT),D.push(z.wrapR||0),D.push(z.magFilter),D.push(z.minFilter),D.push(z.anisotropy),D.push(z.internalFormat),D.push(z.format),D.push(z.type),D.push(z.generateMipmaps),D.push(z.premultiplyAlpha),D.push(z.flipY),D.push(z.unpackAlignment),D.push(z.colorSpace),D.join()}function $(z,D){const q=r.get(z);if(z.isVideoTexture&&Me(z),z.isRenderTargetTexture===!1&&z.version>0&&q.__version!==z.version){const _e=z.image;if(_e===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(_e.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{re(q,z,D);return}}t.bindTexture(n.TEXTURE_2D,q.__webglTexture,n.TEXTURE0+D)}function O(z,D){const q=r.get(z);if(z.version>0&&q.__version!==z.version){re(q,z,D);return}t.bindTexture(n.TEXTURE_2D_ARRAY,q.__webglTexture,n.TEXTURE0+D)}function k(z,D){const q=r.get(z);if(z.version>0&&q.__version!==z.version){re(q,z,D);return}t.bindTexture(n.TEXTURE_3D,q.__webglTexture,n.TEXTURE0+D)}function X(z,D){const q=r.get(z);if(z.version>0&&q.__version!==z.version){se(q,z,D);return}t.bindTexture(n.TEXTURE_CUBE_MAP,q.__webglTexture,n.TEXTURE0+D)}const ie={[K1]:n.REPEAT,[Wi]:n.CLAMP_TO_EDGE,[Z1]:n.MIRRORED_REPEAT},ne={[gn]:n.NEAREST,[kx]:n.NEAREST_MIPMAP_NEAREST,[gg]:n.NEAREST_MIPMAP_LINEAR,[Cr]:n.LINEAR,[iU]:n.LINEAR_MIPMAP_NEAREST,[md]:n.LINEAR_MIPMAP_LINEAR},Q={[bU]:n.NEVER,[AU]:n.ALWAYS,[yU]:n.LESS,[xU]:n.LEQUAL,[_U]:n.EQUAL,[CU]:n.GEQUAL,[wU]:n.GREATER,[SU]:n.NOTEQUAL};function ce(z,D,q){if(q?(n.texParameteri(z,n.TEXTURE_WRAP_S,ie[D.wrapS]),n.texParameteri(z,n.TEXTURE_WRAP_T,ie[D.wrapT]),(z===n.TEXTURE_3D||z===n.TEXTURE_2D_ARRAY)&&n.texParameteri(z,n.TEXTURE_WRAP_R,ie[D.wrapR]),n.texParameteri(z,n.TEXTURE_MAG_FILTER,ne[D.magFilter]),n.texParameteri(z,n.TEXTURE_MIN_FILTER,ne[D.minFilter])):(n.texParameteri(z,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(z,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),(z===n.TEXTURE_3D||z===n.TEXTURE_2D_ARRAY)&&n.texParameteri(z,n.TEXTURE_WRAP_R,n.CLAMP_TO_EDGE),(D.wrapS!==Wi||D.wrapT!==Wi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(z,n.TEXTURE_MAG_FILTER,T(D.magFilter)),n.texParameteri(z,n.TEXTURE_MIN_FILTER,T(D.minFilter)),D.minFilter!==gn&&D.minFilter!==Cr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),D.compareFunction&&(n.texParameteri(z,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(z,n.TEXTURE_COMPARE_FUNC,Q[D.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const _e=e.get("EXT_texture_filter_anisotropic");if(D.magFilter===gn||D.minFilter!==gg&&D.minFilter!==md||D.type===qi&&e.has("OES_texture_float_linear")===!1||a===!1&&D.type===nl&&e.has("OES_texture_half_float_linear")===!1)return;(D.anisotropy>1||r.get(D).__currentAnisotropy)&&(n.texParameterf(z,_e.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(D.anisotropy,i.getMaxAnisotropy())),r.get(D).__currentAnisotropy=D.anisotropy)}}function Z(z,D){let q=!1;z.__webglInit===void 0&&(z.__webglInit=!0,D.addEventListener("dispose",I));const _e=D.source;let ve=g.get(_e);ve===void 0&&(ve={},g.set(_e,ve));const Re=H(D);if(Re!==z.__cacheKey){ve[Re]===void 0&&(ve[Re]={texture:n.createTexture(),usedTimes:0},s.memory.textures++,q=!0),ve[Re].usedTimes++;const ze=ve[z.__cacheKey];ze!==void 0&&(ve[z.__cacheKey].usedTimes--,ze.usedTimes===0&&E(D)),z.__cacheKey=Re,z.__webglTexture=ve[Re].texture}return q}function re(z,D,q){let _e=n.TEXTURE_2D;(D.isDataArrayTexture||D.isCompressedArrayTexture)&&(_e=n.TEXTURE_2D_ARRAY),D.isData3DTexture&&(_e=n.TEXTURE_3D);const ve=Z(z,D),Re=D.source;t.bindTexture(_e,z.__webglTexture,n.TEXTURE0+q);const ze=r.get(Re);if(Re.version!==ze.__version||ve===!0){t.activeTexture(n.TEXTURE0+q);const Le=fn.getPrimaries(fn.workingColorSpace),Ve=D.colorSpace===Si?null:fn.getPrimaries(D.colorSpace),Ze=D.colorSpace===Si||Le===Ve?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,D.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,D.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,D.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ze);const ut=w(D)&&y(D.image)===!1;let Ne=p(D.image,ut,!1,u);Ne=Ce(D,Ne);const ct=y(Ne)||a,he=o.convert(D.format,D.colorSpace);let Ae=o.convert(D.type),Fe=A(D.internalFormat,he,Ae,D.colorSpace,D.isVideoTexture);ce(_e,D,ct);let ke;const We=D.mipmaps,ee=a&&D.isVideoTexture!==!0,Ie=ze.__version===void 0||ve===!0,Se=C(D,Ne,ct);if(D.isDepthTexture)Fe=n.DEPTH_COMPONENT,a?D.type===qi?Fe=n.DEPTH_COMPONENT32F:D.type===Os?Fe=n.DEPTH_COMPONENT24:D.type===Ga?Fe=n.DEPTH24_STENCIL8:Fe=n.DEPTH_COMPONENT16:D.type===qi&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),D.format===Wa&&Fe===n.DEPTH_COMPONENT&&D.type!==kb&&D.type!==Os&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),D.type=Os,Ae=o.convert(D.type)),D.format===Sc&&Fe===n.DEPTH_COMPONENT&&(Fe=n.DEPTH_STENCIL,D.type!==Ga&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),D.type=Ga,Ae=o.convert(D.type))),Ie&&(ee?t.texStorage2D(n.TEXTURE_2D,1,Fe,Ne.width,Ne.height):t.texImage2D(n.TEXTURE_2D,0,Fe,Ne.width,Ne.height,0,he,Ae,null));else if(D.isDataTexture)if(We.length>0&&ct){ee&&Ie&&t.texStorage2D(n.TEXTURE_2D,Se,Fe,We[0].width,We[0].height);for(let Ee=0,Ge=We.length;Ee<Ge;Ee++)ke=We[Ee],ee?t.texSubImage2D(n.TEXTURE_2D,Ee,0,0,ke.width,ke.height,he,Ae,ke.data):t.texImage2D(n.TEXTURE_2D,Ee,Fe,ke.width,ke.height,0,he,Ae,ke.data);D.generateMipmaps=!1}else ee?(Ie&&t.texStorage2D(n.TEXTURE_2D,Se,Fe,Ne.width,Ne.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ne.width,Ne.height,he,Ae,Ne.data)):t.texImage2D(n.TEXTURE_2D,0,Fe,Ne.width,Ne.height,0,he,Ae,Ne.data);else if(D.isCompressedTexture)if(D.isCompressedArrayTexture){ee&&Ie&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Se,Fe,We[0].width,We[0].height,Ne.depth);for(let Ee=0,Ge=We.length;Ee<Ge;Ee++)ke=We[Ee],D.format!==Xr?he!==null?ee?t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Ee,0,0,0,ke.width,ke.height,Ne.depth,he,ke.data,0,0):t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Ee,Fe,ke.width,ke.height,Ne.depth,0,ke.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ee?t.texSubImage3D(n.TEXTURE_2D_ARRAY,Ee,0,0,0,ke.width,ke.height,Ne.depth,he,Ae,ke.data):t.texImage3D(n.TEXTURE_2D_ARRAY,Ee,Fe,ke.width,ke.height,Ne.depth,0,he,Ae,ke.data)}else{ee&&Ie&&t.texStorage2D(n.TEXTURE_2D,Se,Fe,We[0].width,We[0].height);for(let Ee=0,Ge=We.length;Ee<Ge;Ee++)ke=We[Ee],D.format!==Xr?he!==null?ee?t.compressedTexSubImage2D(n.TEXTURE_2D,Ee,0,0,ke.width,ke.height,he,ke.data):t.compressedTexImage2D(n.TEXTURE_2D,Ee,Fe,ke.width,ke.height,0,ke.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ee?t.texSubImage2D(n.TEXTURE_2D,Ee,0,0,ke.width,ke.height,he,Ae,ke.data):t.texImage2D(n.TEXTURE_2D,Ee,Fe,ke.width,ke.height,0,he,Ae,ke.data)}else if(D.isDataArrayTexture)ee?(Ie&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Se,Fe,Ne.width,Ne.height,Ne.depth),t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Ne.width,Ne.height,Ne.depth,he,Ae,Ne.data)):t.texImage3D(n.TEXTURE_2D_ARRAY,0,Fe,Ne.width,Ne.height,Ne.depth,0,he,Ae,Ne.data);else if(D.isData3DTexture)ee?(Ie&&t.texStorage3D(n.TEXTURE_3D,Se,Fe,Ne.width,Ne.height,Ne.depth),t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Ne.width,Ne.height,Ne.depth,he,Ae,Ne.data)):t.texImage3D(n.TEXTURE_3D,0,Fe,Ne.width,Ne.height,Ne.depth,0,he,Ae,Ne.data);else if(D.isFramebufferTexture){if(Ie)if(ee)t.texStorage2D(n.TEXTURE_2D,Se,Fe,Ne.width,Ne.height);else{let Ee=Ne.width,Ge=Ne.height;for(let ft=0;ft<Se;ft++)t.texImage2D(n.TEXTURE_2D,ft,Fe,Ee,Ge,0,he,Ae,null),Ee>>=1,Ge>>=1}}else if(We.length>0&&ct){ee&&Ie&&t.texStorage2D(n.TEXTURE_2D,Se,Fe,We[0].width,We[0].height);for(let Ee=0,Ge=We.length;Ee<Ge;Ee++)ke=We[Ee],ee?t.texSubImage2D(n.TEXTURE_2D,Ee,0,0,he,Ae,ke):t.texImage2D(n.TEXTURE_2D,Ee,Fe,he,Ae,ke);D.generateMipmaps=!1}else ee?(Ie&&t.texStorage2D(n.TEXTURE_2D,Se,Fe,Ne.width,Ne.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,he,Ae,Ne)):t.texImage2D(n.TEXTURE_2D,0,Fe,he,Ae,Ne);x(D,ct)&&_(_e),ze.__version=Re.version,D.onUpdate&&D.onUpdate(D)}z.__version=D.version}function se(z,D,q){if(D.image.length!==6)return;const _e=Z(z,D),ve=D.source;t.bindTexture(n.TEXTURE_CUBE_MAP,z.__webglTexture,n.TEXTURE0+q);const Re=r.get(ve);if(ve.version!==Re.__version||_e===!0){t.activeTexture(n.TEXTURE0+q);const ze=fn.getPrimaries(fn.workingColorSpace),Le=D.colorSpace===Si?null:fn.getPrimaries(D.colorSpace),Ve=D.colorSpace===Si||ze===Le?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,D.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,D.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,D.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ve);const Ze=D.isCompressedTexture||D.image[0].isCompressedTexture,ut=D.image[0]&&D.image[0].isDataTexture,Ne=[];for(let Ee=0;Ee<6;Ee++)!Ze&&!ut?Ne[Ee]=p(D.image[Ee],!1,!0,c):Ne[Ee]=ut?D.image[Ee].image:D.image[Ee],Ne[Ee]=Ce(D,Ne[Ee]);const ct=Ne[0],he=y(ct)||a,Ae=o.convert(D.format,D.colorSpace),Fe=o.convert(D.type),ke=A(D.internalFormat,Ae,Fe,D.colorSpace),We=a&&D.isVideoTexture!==!0,ee=Re.__version===void 0||_e===!0;let Ie=C(D,ct,he);ce(n.TEXTURE_CUBE_MAP,D,he);let Se;if(Ze){We&&ee&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Ie,ke,ct.width,ct.height);for(let Ee=0;Ee<6;Ee++){Se=Ne[Ee].mipmaps;for(let Ge=0;Ge<Se.length;Ge++){const ft=Se[Ge];D.format!==Xr?Ae!==null?We?t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ge,0,0,ft.width,ft.height,Ae,ft.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ge,ke,ft.width,ft.height,0,ft.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):We?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ge,0,0,ft.width,ft.height,Ae,Fe,ft.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ge,ke,ft.width,ft.height,0,Ae,Fe,ft.data)}}}else{Se=D.mipmaps,We&&ee&&(Se.length>0&&Ie++,t.texStorage2D(n.TEXTURE_CUBE_MAP,Ie,ke,Ne[0].width,Ne[0].height));for(let Ee=0;Ee<6;Ee++)if(ut){We?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,0,0,Ne[Ee].width,Ne[Ee].height,Ae,Fe,Ne[Ee].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,ke,Ne[Ee].width,Ne[Ee].height,0,Ae,Fe,Ne[Ee].data);for(let Ge=0;Ge<Se.length;Ge++){const Rt=Se[Ge].image[Ee].image;We?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ge+1,0,0,Rt.width,Rt.height,Ae,Fe,Rt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ge+1,ke,Rt.width,Rt.height,0,Ae,Fe,Rt.data)}}else{We?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,0,0,Ae,Fe,Ne[Ee]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,ke,Ae,Fe,Ne[Ee]);for(let Ge=0;Ge<Se.length;Ge++){const ft=Se[Ge];We?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ge+1,0,0,Ae,Fe,ft.image[Ee]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ge+1,ke,Ae,Fe,ft.image[Ee])}}}x(D,he)&&_(n.TEXTURE_CUBE_MAP),Re.__version=ve.version,D.onUpdate&&D.onUpdate(D)}z.__version=D.version}function fe(z,D,q,_e,ve,Re){const ze=o.convert(q.format,q.colorSpace),Le=o.convert(q.type),Ve=A(q.internalFormat,ze,Le,q.colorSpace);if(!r.get(D).__hasExternalTextures){const ut=Math.max(1,D.width>>Re),Ne=Math.max(1,D.height>>Re);ve===n.TEXTURE_3D||ve===n.TEXTURE_2D_ARRAY?t.texImage3D(ve,Re,Ve,ut,Ne,D.depth,0,ze,Le,null):t.texImage2D(ve,Re,Ve,ut,Ne,0,ze,Le,null)}t.bindFramebuffer(n.FRAMEBUFFER,z),ye(D)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,_e,ve,r.get(q).__webglTexture,0,pe(D)):(ve===n.TEXTURE_2D||ve>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&ve<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,_e,ve,r.get(q).__webglTexture,Re),t.bindFramebuffer(n.FRAMEBUFFER,null)}function ue(z,D,q){if(n.bindRenderbuffer(n.RENDERBUFFER,z),D.depthBuffer&&!D.stencilBuffer){let _e=a===!0?n.DEPTH_COMPONENT24:n.DEPTH_COMPONENT16;if(q||ye(D)){const ve=D.depthTexture;ve&&ve.isDepthTexture&&(ve.type===qi?_e=n.DEPTH_COMPONENT32F:ve.type===Os&&(_e=n.DEPTH_COMPONENT24));const Re=pe(D);ye(D)?h.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Re,_e,D.width,D.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,Re,_e,D.width,D.height)}else n.renderbufferStorage(n.RENDERBUFFER,_e,D.width,D.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,z)}else if(D.depthBuffer&&D.stencilBuffer){const _e=pe(D);q&&ye(D)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,_e,n.DEPTH24_STENCIL8,D.width,D.height):ye(D)?h.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,_e,n.DEPTH24_STENCIL8,D.width,D.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,D.width,D.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,z)}else{const _e=D.isWebGLMultipleRenderTargets===!0?D.texture:[D.texture];for(let ve=0;ve<_e.length;ve++){const Re=_e[ve],ze=o.convert(Re.format,Re.colorSpace),Le=o.convert(Re.type),Ve=A(Re.internalFormat,ze,Le,Re.colorSpace),Ze=pe(D);q&&ye(D)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Ze,Ve,D.width,D.height):ye(D)?h.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Ze,Ve,D.width,D.height):n.renderbufferStorage(n.RENDERBUFFER,Ve,D.width,D.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function U(z,D){if(D&&D.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,z),!(D.depthTexture&&D.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(D.depthTexture).__webglTexture||D.depthTexture.image.width!==D.width||D.depthTexture.image.height!==D.height)&&(D.depthTexture.image.width=D.width,D.depthTexture.image.height=D.height,D.depthTexture.needsUpdate=!0),$(D.depthTexture,0);const _e=r.get(D.depthTexture).__webglTexture,ve=pe(D);if(D.depthTexture.format===Wa)ye(D)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,_e,0,ve):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,_e,0);else if(D.depthTexture.format===Sc)ye(D)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,_e,0,ve):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,_e,0);else throw new Error("Unknown depthTexture format")}function K(z){const D=r.get(z),q=z.isWebGLCubeRenderTarget===!0;if(z.depthTexture&&!D.__autoAllocateDepthBuffer){if(q)throw new Error("target.depthTexture not supported in Cube render targets");U(D.__webglFramebuffer,z)}else if(q){D.__webglDepthbuffer=[];for(let _e=0;_e<6;_e++)t.bindFramebuffer(n.FRAMEBUFFER,D.__webglFramebuffer[_e]),D.__webglDepthbuffer[_e]=n.createRenderbuffer(),ue(D.__webglDepthbuffer[_e],z,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,D.__webglFramebuffer),D.__webglDepthbuffer=n.createRenderbuffer(),ue(D.__webglDepthbuffer,z,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function be(z,D,q){const _e=r.get(z);D!==void 0&&fe(_e.__webglFramebuffer,z,z.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),q!==void 0&&K(z)}function me(z){const D=z.texture,q=r.get(z),_e=r.get(D);z.addEventListener("dispose",M),z.isWebGLMultipleRenderTargets!==!0&&(_e.__webglTexture===void 0&&(_e.__webglTexture=n.createTexture()),_e.__version=D.version,s.memory.textures++);const ve=z.isWebGLCubeRenderTarget===!0,Re=z.isWebGLMultipleRenderTargets===!0,ze=y(z)||a;if(ve){q.__webglFramebuffer=[];for(let Le=0;Le<6;Le++)if(a&&D.mipmaps&&D.mipmaps.length>0){q.__webglFramebuffer[Le]=[];for(let Ve=0;Ve<D.mipmaps.length;Ve++)q.__webglFramebuffer[Le][Ve]=n.createFramebuffer()}else q.__webglFramebuffer[Le]=n.createFramebuffer()}else{if(a&&D.mipmaps&&D.mipmaps.length>0){q.__webglFramebuffer=[];for(let Le=0;Le<D.mipmaps.length;Le++)q.__webglFramebuffer[Le]=n.createFramebuffer()}else q.__webglFramebuffer=n.createFramebuffer();if(Re)if(i.drawBuffers){const Le=z.texture;for(let Ve=0,Ze=Le.length;Ve<Ze;Ve++){const ut=r.get(Le[Ve]);ut.__webglTexture===void 0&&(ut.__webglTexture=n.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&z.samples>0&&ye(z)===!1){const Le=Re?D:[D];q.__webglMultisampledFramebuffer=n.createFramebuffer(),q.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,q.__webglMultisampledFramebuffer);for(let Ve=0;Ve<Le.length;Ve++){const Ze=Le[Ve];q.__webglColorRenderbuffer[Ve]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,q.__webglColorRenderbuffer[Ve]);const ut=o.convert(Ze.format,Ze.colorSpace),Ne=o.convert(Ze.type),ct=A(Ze.internalFormat,ut,Ne,Ze.colorSpace,z.isXRRenderTarget===!0),he=pe(z);n.renderbufferStorageMultisample(n.RENDERBUFFER,he,ct,z.width,z.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ve,n.RENDERBUFFER,q.__webglColorRenderbuffer[Ve])}n.bindRenderbuffer(n.RENDERBUFFER,null),z.depthBuffer&&(q.__webglDepthRenderbuffer=n.createRenderbuffer(),ue(q.__webglDepthRenderbuffer,z,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(ve){t.bindTexture(n.TEXTURE_CUBE_MAP,_e.__webglTexture),ce(n.TEXTURE_CUBE_MAP,D,ze);for(let Le=0;Le<6;Le++)if(a&&D.mipmaps&&D.mipmaps.length>0)for(let Ve=0;Ve<D.mipmaps.length;Ve++)fe(q.__webglFramebuffer[Le][Ve],z,D,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Le,Ve);else fe(q.__webglFramebuffer[Le],z,D,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0);x(D,ze)&&_(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Re){const Le=z.texture;for(let Ve=0,Ze=Le.length;Ve<Ze;Ve++){const ut=Le[Ve],Ne=r.get(ut);t.bindTexture(n.TEXTURE_2D,Ne.__webglTexture),ce(n.TEXTURE_2D,ut,ze),fe(q.__webglFramebuffer,z,ut,n.COLOR_ATTACHMENT0+Ve,n.TEXTURE_2D,0),x(ut,ze)&&_(n.TEXTURE_2D)}t.unbindTexture()}else{let Le=n.TEXTURE_2D;if((z.isWebGL3DRenderTarget||z.isWebGLArrayRenderTarget)&&(a?Le=z.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Le,_e.__webglTexture),ce(Le,D,ze),a&&D.mipmaps&&D.mipmaps.length>0)for(let Ve=0;Ve<D.mipmaps.length;Ve++)fe(q.__webglFramebuffer[Ve],z,D,n.COLOR_ATTACHMENT0,Le,Ve);else fe(q.__webglFramebuffer,z,D,n.COLOR_ATTACHMENT0,Le,0);x(D,ze)&&_(Le),t.unbindTexture()}z.depthBuffer&&K(z)}function le(z){const D=y(z)||a,q=z.isWebGLMultipleRenderTargets===!0?z.texture:[z.texture];for(let _e=0,ve=q.length;_e<ve;_e++){const Re=q[_e];if(x(Re,D)){const ze=z.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,Le=r.get(Re).__webglTexture;t.bindTexture(ze,Le),_(ze),t.unbindTexture()}}}function xe(z){if(a&&z.samples>0&&ye(z)===!1){const D=z.isWebGLMultipleRenderTargets?z.texture:[z.texture],q=z.width,_e=z.height;let ve=n.COLOR_BUFFER_BIT;const Re=[],ze=z.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Le=r.get(z),Ve=z.isWebGLMultipleRenderTargets===!0;if(Ve)for(let Ze=0;Ze<D.length;Ze++)t.bindFramebuffer(n.FRAMEBUFFER,Le.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ze,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Le.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ze,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Le.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Le.__webglFramebuffer);for(let Ze=0;Ze<D.length;Ze++){Re.push(n.COLOR_ATTACHMENT0+Ze),z.depthBuffer&&Re.push(ze);const ut=Le.__ignoreDepthValues!==void 0?Le.__ignoreDepthValues:!1;if(ut===!1&&(z.depthBuffer&&(ve|=n.DEPTH_BUFFER_BIT),z.stencilBuffer&&(ve|=n.STENCIL_BUFFER_BIT)),Ve&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Le.__webglColorRenderbuffer[Ze]),ut===!0&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[ze]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[ze])),Ve){const Ne=r.get(D[Ze]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Ne,0)}n.blitFramebuffer(0,0,q,_e,0,0,q,_e,ve,n.NEAREST),m&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Re)}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Ve)for(let Ze=0;Ze<D.length;Ze++){t.bindFramebuffer(n.FRAMEBUFFER,Le.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ze,n.RENDERBUFFER,Le.__webglColorRenderbuffer[Ze]);const ut=r.get(D[Ze]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Le.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ze,n.TEXTURE_2D,ut,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Le.__webglMultisampledFramebuffer)}}function pe(z){return Math.min(d,z.samples)}function ye(z){const D=r.get(z);return a&&z.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&D.__useRenderToTexture!==!1}function Me(z){const D=s.render.frame;f.get(z)!==D&&(f.set(z,D),z.update())}function Ce(z,D){const q=z.colorSpace,_e=z.format,ve=z.type;return z.isCompressedTexture===!0||z.isVideoTexture===!0||z.format===J1||q!==ns&&q!==Si&&(fn.getTransfer(q)===Sn?a===!1?e.has("EXT_sRGB")===!0&&_e===Xr?(z.format=J1,z.minFilter=Cr,z.generateMipmaps=!1):D=dE.sRGBToLinear(D):(_e!==Xr||ve!==Zi)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",q)),D}this.allocateTextureUnit=F,this.resetTextureUnits=L,this.setTexture2D=$,this.setTexture2DArray=O,this.setTexture3D=k,this.setTextureCube=X,this.rebindTextures=be,this.setupRenderTarget=me,this.updateRenderTargetMipmap=le,this.updateMultisampleRenderTarget=xe,this.setupDepthRenderbuffer=K,this.setupFrameBufferTexture=fe,this.useMultisampledRTT=ye}function wV(n,e,t){const r=t.isWebGL2;function i(o,s=Si){let a;const l=fn.getTransfer(s);if(o===Zi)return n.UNSIGNED_BYTE;if(o===iE)return n.UNSIGNED_SHORT_4_4_4_4;if(o===oE)return n.UNSIGNED_SHORT_5_5_5_1;if(o===oU)return n.BYTE;if(o===sU)return n.SHORT;if(o===kb)return n.UNSIGNED_SHORT;if(o===rE)return n.INT;if(o===Os)return n.UNSIGNED_INT;if(o===qi)return n.FLOAT;if(o===nl)return r?n.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(o===aU)return n.ALPHA;if(o===Xr)return n.RGBA;if(o===lU)return n.LUMINANCE;if(o===cU)return n.LUMINANCE_ALPHA;if(o===Wa)return n.DEPTH_COMPONENT;if(o===Sc)return n.DEPTH_STENCIL;if(o===J1)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(o===uU)return n.RED;if(o===sE)return n.RED_INTEGER;if(o===dU)return n.RG;if(o===aE)return n.RG_INTEGER;if(o===lE)return n.RGBA_INTEGER;if(o===vg||o===bg||o===yg||o===_g)if(l===Sn)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(o===vg)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(o===bg)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(o===yg)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(o===_g)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(o===vg)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===bg)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===yg)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===_g)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===Bx||o===Nx||o===zx||o===Ux)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(o===Bx)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===Nx)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===zx)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===Ux)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===hU)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(o===$x||o===Hx)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(o===$x)return l===Sn?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(o===Hx)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(o===Vx||o===Gx||o===Wx||o===jx||o===qx||o===Xx||o===Yx||o===Kx||o===Zx||o===Jx||o===Qx||o===e2||o===t2||o===n2)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(o===Vx)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(o===Gx)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(o===Wx)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(o===jx)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(o===qx)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(o===Xx)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(o===Yx)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(o===Kx)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(o===Zx)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(o===Jx)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(o===Qx)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(o===e2)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(o===t2)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(o===n2)return l===Sn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(o===xg||o===r2||o===i2)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(o===xg)return l===Sn?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(o===r2)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(o===i2)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(o===fU||o===o2||o===s2||o===a2)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(o===xg)return a.COMPRESSED_RED_RGTC1_EXT;if(o===o2)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(o===s2)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(o===a2)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return o===Ga?r?n.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):n[o]!==void 0?n[o]:null}return{convert:i}}class SV extends qr{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class mn extends cr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const CV={type:"move"};class Wg{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new mn,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new mn,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new te,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new te),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new mn,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new te,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new te),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,o=null,s=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){s=!0;for(const v of e.hand.values()){const g=t.getJointPose(v,r),b=this._getHandJoint(c,v);g!==null&&(b.matrix.fromArray(g.transform.matrix),b.matrix.decompose(b.position,b.rotation,b.scale),b.matrixWorldNeedsUpdate=!0,b.jointRadius=g.radius),b.visible=g!==null}const u=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],h=u.position.distanceTo(d.position),m=.02,f=.005;c.inputState.pinching&&h>m+f?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&h<=m-f&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,r),o!==null&&(l.matrix.fromArray(o.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,o.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(o.linearVelocity)):l.hasLinearVelocity=!1,o.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(o.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&o!==null&&(i=o),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(CV)))}return a!==null&&(a.visible=i!==null),l!==null&&(l.visible=o!==null),c!==null&&(c.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new mn;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class AV extends kr{constructor(e,t,r,i,o,s,a,l,c,u){if(u=u!==void 0?u:Wa,u!==Wa&&u!==Sc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===Wa&&(r=Os),r===void 0&&u===Sc&&(r=Ga),super(null,i,o,s,a,l,u,r,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:gn,this.minFilter=l!==void 0?l:gn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class MV extends Uc{constructor(e,t){super();const r=this;let i=null,o=1,s=null,a="local-floor",l=1,c=null,u=null,d=null,h=null,m=null,f=null;const v=t.getContextAttributes();let g=null,b=null;const S=[],p=[],y=new qr;y.layers.enable(1),y.viewport=new lr;const w=new qr;w.layers.enable(2),w.viewport=new lr;const x=[y,w],_=new SV;_.layers.enable(1),_.layers.enable(2);let A=null,C=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(O){let k=S[O];return k===void 0&&(k=new Wg,S[O]=k),k.getTargetRaySpace()},this.getControllerGrip=function(O){let k=S[O];return k===void 0&&(k=new Wg,S[O]=k),k.getGripSpace()},this.getHand=function(O){let k=S[O];return k===void 0&&(k=new Wg,S[O]=k),k.getHandSpace()};function T(O){const k=p.indexOf(O.inputSource);if(k===-1)return;const X=S[k];X!==void 0&&(X.update(O.inputSource,O.frame,c||s),X.dispatchEvent({type:O.type,data:O.inputSource}))}function I(){i.removeEventListener("select",T),i.removeEventListener("selectstart",T),i.removeEventListener("selectend",T),i.removeEventListener("squeeze",T),i.removeEventListener("squeezestart",T),i.removeEventListener("squeezeend",T),i.removeEventListener("end",I),i.removeEventListener("inputsourceschange",M);for(let O=0;O<S.length;O++){const k=p[O];k!==null&&(p[O]=null,S[O].disconnect(k))}A=null,C=null,e.setRenderTarget(g),m=null,h=null,d=null,i=null,b=null,$.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(O){o=O,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(O){a=O,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||s},this.setReferenceSpace=function(O){c=O},this.getBaseLayer=function(){return h!==null?h:m},this.getBinding=function(){return d},this.getFrame=function(){return f},this.getSession=function(){return i},this.setSession=async function(O){if(i=O,i!==null){if(g=e.getRenderTarget(),i.addEventListener("select",T),i.addEventListener("selectstart",T),i.addEventListener("selectend",T),i.addEventListener("squeeze",T),i.addEventListener("squeezestart",T),i.addEventListener("squeezeend",T),i.addEventListener("end",I),i.addEventListener("inputsourceschange",M),v.xrCompatible!==!0&&await t.makeXRCompatible(),i.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const k={antialias:i.renderState.layers===void 0?v.antialias:!0,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:o};m=new XRWebGLLayer(i,t,k),i.updateRenderState({baseLayer:m}),b=new xo(m.framebufferWidth,m.framebufferHeight,{format:Xr,type:Zi,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil})}else{let k=null,X=null,ie=null;v.depth&&(ie=v.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,k=v.stencil?Sc:Wa,X=v.stencil?Ga:Os);const ne={colorFormat:t.RGBA8,depthFormat:ie,scaleFactor:o};d=new XRWebGLBinding(i,t),h=d.createProjectionLayer(ne),i.updateRenderState({layers:[h]}),b=new xo(h.textureWidth,h.textureHeight,{format:Xr,type:Zi,depthTexture:new AV(h.textureWidth,h.textureHeight,X,void 0,void 0,void 0,void 0,void 0,void 0,k),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0});const Q=e.properties.get(b);Q.__ignoreDepthValues=h.ignoreDepthValues}b.isXRRenderTarget=!0,this.setFoveation(l),c=null,s=await i.requestReferenceSpace(a),$.setContext(i),$.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode};function M(O){for(let k=0;k<O.removed.length;k++){const X=O.removed[k],ie=p.indexOf(X);ie>=0&&(p[ie]=null,S[ie].disconnect(X))}for(let k=0;k<O.added.length;k++){const X=O.added[k];let ie=p.indexOf(X);if(ie===-1){for(let Q=0;Q<S.length;Q++)if(Q>=p.length){p.push(X),ie=Q;break}else if(p[Q]===null){p[Q]=X,ie=Q;break}if(ie===-1)break}const ne=S[ie];ne&&ne.connect(X)}}const P=new te,E=new te;function R(O,k,X){P.setFromMatrixPosition(k.matrixWorld),E.setFromMatrixPosition(X.matrixWorld);const ie=P.distanceTo(E),ne=k.projectionMatrix.elements,Q=X.projectionMatrix.elements,ce=ne[14]/(ne[10]-1),Z=ne[14]/(ne[10]+1),re=(ne[9]+1)/ne[5],se=(ne[9]-1)/ne[5],fe=(ne[8]-1)/ne[0],ue=(Q[8]+1)/Q[0],U=ce*fe,K=ce*ue,be=ie/(-fe+ue),me=be*-fe;k.matrixWorld.decompose(O.position,O.quaternion,O.scale),O.translateX(me),O.translateZ(be),O.matrixWorld.compose(O.position,O.quaternion,O.scale),O.matrixWorldInverse.copy(O.matrixWorld).invert();const le=ce+be,xe=Z+be,pe=U-me,ye=K+(ie-me),Me=re*Z/xe*le,Ce=se*Z/xe*le;O.projectionMatrix.makePerspective(pe,ye,Me,Ce,le,xe),O.projectionMatrixInverse.copy(O.projectionMatrix).invert()}function B(O,k){k===null?O.matrixWorld.copy(O.matrix):O.matrixWorld.multiplyMatrices(k.matrixWorld,O.matrix),O.matrixWorldInverse.copy(O.matrixWorld).invert()}this.updateCamera=function(O){if(i===null)return;_.near=w.near=y.near=O.near,_.far=w.far=y.far=O.far,(A!==_.near||C!==_.far)&&(i.updateRenderState({depthNear:_.near,depthFar:_.far}),A=_.near,C=_.far);const k=O.parent,X=_.cameras;B(_,k);for(let ie=0;ie<X.length;ie++)B(X[ie],k);X.length===2?R(_,y,w):_.projectionMatrix.copy(y.projectionMatrix),L(O,_,k)};function L(O,k,X){X===null?O.matrix.copy(k.matrixWorld):(O.matrix.copy(X.matrixWorld),O.matrix.invert(),O.matrix.multiply(k.matrixWorld)),O.matrix.decompose(O.position,O.quaternion,O.scale),O.updateMatrixWorld(!0),O.projectionMatrix.copy(k.projectionMatrix),O.projectionMatrixInverse.copy(k.projectionMatrixInverse),O.isPerspectiveCamera&&(O.fov=Q1*2*Math.atan(1/O.projectionMatrix.elements[5]),O.zoom=1)}this.getCamera=function(){return _},this.getFoveation=function(){if(!(h===null&&m===null))return l},this.setFoveation=function(O){l=O,h!==null&&(h.fixedFoveation=O),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=O)};let F=null;function H(O,k){if(u=k.getViewerPose(c||s),f=k,u!==null){const X=u.views;m!==null&&(e.setRenderTargetFramebuffer(b,m.framebuffer),e.setRenderTarget(b));let ie=!1;X.length!==_.cameras.length&&(_.cameras.length=0,ie=!0);for(let ne=0;ne<X.length;ne++){const Q=X[ne];let ce=null;if(m!==null)ce=m.getViewport(Q);else{const re=d.getViewSubImage(h,Q);ce=re.viewport,ne===0&&(e.setRenderTargetTextures(b,re.colorTexture,h.ignoreDepthValues?void 0:re.depthStencilTexture),e.setRenderTarget(b))}let Z=x[ne];Z===void 0&&(Z=new qr,Z.layers.enable(ne),Z.viewport=new lr,x[ne]=Z),Z.matrix.fromArray(Q.transform.matrix),Z.matrix.decompose(Z.position,Z.quaternion,Z.scale),Z.projectionMatrix.fromArray(Q.projectionMatrix),Z.projectionMatrixInverse.copy(Z.projectionMatrix).invert(),Z.viewport.set(ce.x,ce.y,ce.width,ce.height),ne===0&&(_.matrix.copy(Z.matrix),_.matrix.decompose(_.position,_.quaternion,_.scale)),ie===!0&&_.cameras.push(Z)}}for(let X=0;X<S.length;X++){const ie=p[X],ne=S[X];ie!==null&&ne!==void 0&&ne.update(ie,k,c||s)}F&&F(O,k),k.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:k}),f=null}const $=new wE;$.setAnimationLoop(H),this.setAnimationLoop=function(O){F=O},this.dispose=function(){}}}function TV(n,e){function t(g,b){g.matrixAutoUpdate===!0&&g.updateMatrix(),b.value.copy(g.matrix)}function r(g,b){b.color.getRGB(g.fogColor.value,yE(n)),b.isFog?(g.fogNear.value=b.near,g.fogFar.value=b.far):b.isFogExp2&&(g.fogDensity.value=b.density)}function i(g,b,S,p,y){b.isMeshBasicMaterial||b.isMeshLambertMaterial?o(g,b):b.isMeshToonMaterial?(o(g,b),d(g,b)):b.isMeshPhongMaterial?(o(g,b),u(g,b)):b.isMeshStandardMaterial?(o(g,b),h(g,b),b.isMeshPhysicalMaterial&&m(g,b,y)):b.isMeshMatcapMaterial?(o(g,b),f(g,b)):b.isMeshDepthMaterial?o(g,b):b.isMeshDistanceMaterial?(o(g,b),v(g,b)):b.isMeshNormalMaterial?o(g,b):b.isLineBasicMaterial?(s(g,b),b.isLineDashedMaterial&&a(g,b)):b.isPointsMaterial?l(g,b,S,p):b.isSpriteMaterial?c(g,b):b.isShadowMaterial?(g.color.value.copy(b.color),g.opacity.value=b.opacity):b.isShaderMaterial&&(b.uniformsNeedUpdate=!1)}function o(g,b){g.opacity.value=b.opacity,b.color&&g.diffuse.value.copy(b.color),b.emissive&&g.emissive.value.copy(b.emissive).multiplyScalar(b.emissiveIntensity),b.map&&(g.map.value=b.map,t(b.map,g.mapTransform)),b.alphaMap&&(g.alphaMap.value=b.alphaMap,t(b.alphaMap,g.alphaMapTransform)),b.bumpMap&&(g.bumpMap.value=b.bumpMap,t(b.bumpMap,g.bumpMapTransform),g.bumpScale.value=b.bumpScale,b.side===Or&&(g.bumpScale.value*=-1)),b.normalMap&&(g.normalMap.value=b.normalMap,t(b.normalMap,g.normalMapTransform),g.normalScale.value.copy(b.normalScale),b.side===Or&&g.normalScale.value.negate()),b.displacementMap&&(g.displacementMap.value=b.displacementMap,t(b.displacementMap,g.displacementMapTransform),g.displacementScale.value=b.displacementScale,g.displacementBias.value=b.displacementBias),b.emissiveMap&&(g.emissiveMap.value=b.emissiveMap,t(b.emissiveMap,g.emissiveMapTransform)),b.specularMap&&(g.specularMap.value=b.specularMap,t(b.specularMap,g.specularMapTransform)),b.alphaTest>0&&(g.alphaTest.value=b.alphaTest);const S=e.get(b).envMap;if(S&&(g.envMap.value=S,g.flipEnvMap.value=S.isCubeTexture&&S.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=b.reflectivity,g.ior.value=b.ior,g.refractionRatio.value=b.refractionRatio),b.lightMap){g.lightMap.value=b.lightMap;const p=n._useLegacyLights===!0?Math.PI:1;g.lightMapIntensity.value=b.lightMapIntensity*p,t(b.lightMap,g.lightMapTransform)}b.aoMap&&(g.aoMap.value=b.aoMap,g.aoMapIntensity.value=b.aoMapIntensity,t(b.aoMap,g.aoMapTransform))}function s(g,b){g.diffuse.value.copy(b.color),g.opacity.value=b.opacity,b.map&&(g.map.value=b.map,t(b.map,g.mapTransform))}function a(g,b){g.dashSize.value=b.dashSize,g.totalSize.value=b.dashSize+b.gapSize,g.scale.value=b.scale}function l(g,b,S,p){g.diffuse.value.copy(b.color),g.opacity.value=b.opacity,g.size.value=b.size*S,g.scale.value=p*.5,b.map&&(g.map.value=b.map,t(b.map,g.uvTransform)),b.alphaMap&&(g.alphaMap.value=b.alphaMap,t(b.alphaMap,g.alphaMapTransform)),b.alphaTest>0&&(g.alphaTest.value=b.alphaTest)}function c(g,b){g.diffuse.value.copy(b.color),g.opacity.value=b.opacity,g.rotation.value=b.rotation,b.map&&(g.map.value=b.map,t(b.map,g.mapTransform)),b.alphaMap&&(g.alphaMap.value=b.alphaMap,t(b.alphaMap,g.alphaMapTransform)),b.alphaTest>0&&(g.alphaTest.value=b.alphaTest)}function u(g,b){g.specular.value.copy(b.specular),g.shininess.value=Math.max(b.shininess,1e-4)}function d(g,b){b.gradientMap&&(g.gradientMap.value=b.gradientMap)}function h(g,b){g.metalness.value=b.metalness,b.metalnessMap&&(g.metalnessMap.value=b.metalnessMap,t(b.metalnessMap,g.metalnessMapTransform)),g.roughness.value=b.roughness,b.roughnessMap&&(g.roughnessMap.value=b.roughnessMap,t(b.roughnessMap,g.roughnessMapTransform)),e.get(b).envMap&&(g.envMapIntensity.value=b.envMapIntensity)}function m(g,b,S){g.ior.value=b.ior,b.sheen>0&&(g.sheenColor.value.copy(b.sheenColor).multiplyScalar(b.sheen),g.sheenRoughness.value=b.sheenRoughness,b.sheenColorMap&&(g.sheenColorMap.value=b.sheenColorMap,t(b.sheenColorMap,g.sheenColorMapTransform)),b.sheenRoughnessMap&&(g.sheenRoughnessMap.value=b.sheenRoughnessMap,t(b.sheenRoughnessMap,g.sheenRoughnessMapTransform))),b.clearcoat>0&&(g.clearcoat.value=b.clearcoat,g.clearcoatRoughness.value=b.clearcoatRoughness,b.clearcoatMap&&(g.clearcoatMap.value=b.clearcoatMap,t(b.clearcoatMap,g.clearcoatMapTransform)),b.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=b.clearcoatRoughnessMap,t(b.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),b.clearcoatNormalMap&&(g.clearcoatNormalMap.value=b.clearcoatNormalMap,t(b.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(b.clearcoatNormalScale),b.side===Or&&g.clearcoatNormalScale.value.negate())),b.iridescence>0&&(g.iridescence.value=b.iridescence,g.iridescenceIOR.value=b.iridescenceIOR,g.iridescenceThicknessMinimum.value=b.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=b.iridescenceThicknessRange[1],b.iridescenceMap&&(g.iridescenceMap.value=b.iridescenceMap,t(b.iridescenceMap,g.iridescenceMapTransform)),b.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=b.iridescenceThicknessMap,t(b.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),b.transmission>0&&(g.transmission.value=b.transmission,g.transmissionSamplerMap.value=S.texture,g.transmissionSamplerSize.value.set(S.width,S.height),b.transmissionMap&&(g.transmissionMap.value=b.transmissionMap,t(b.transmissionMap,g.transmissionMapTransform)),g.thickness.value=b.thickness,b.thicknessMap&&(g.thicknessMap.value=b.thicknessMap,t(b.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=b.attenuationDistance,g.attenuationColor.value.copy(b.attenuationColor)),b.anisotropy>0&&(g.anisotropyVector.value.set(b.anisotropy*Math.cos(b.anisotropyRotation),b.anisotropy*Math.sin(b.anisotropyRotation)),b.anisotropyMap&&(g.anisotropyMap.value=b.anisotropyMap,t(b.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=b.specularIntensity,g.specularColor.value.copy(b.specularColor),b.specularColorMap&&(g.specularColorMap.value=b.specularColorMap,t(b.specularColorMap,g.specularColorMapTransform)),b.specularIntensityMap&&(g.specularIntensityMap.value=b.specularIntensityMap,t(b.specularIntensityMap,g.specularIntensityMapTransform))}function f(g,b){b.matcap&&(g.matcap.value=b.matcap)}function v(g,b){const S=e.get(b).light;g.referencePosition.value.setFromMatrixPosition(S.matrixWorld),g.nearDistance.value=S.shadow.camera.near,g.farDistance.value=S.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function EV(n,e,t,r){let i={},o={},s=[];const a=t.isWebGL2?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(S,p){const y=p.program;r.uniformBlockBinding(S,y)}function c(S,p){let y=i[S.id];y===void 0&&(f(S),y=u(S),i[S.id]=y,S.addEventListener("dispose",g));const w=p.program;r.updateUBOMapping(S,w);const x=e.render.frame;o[S.id]!==x&&(h(S),o[S.id]=x)}function u(S){const p=d();S.__bindingPointIndex=p;const y=n.createBuffer(),w=S.__size,x=S.usage;return n.bindBuffer(n.UNIFORM_BUFFER,y),n.bufferData(n.UNIFORM_BUFFER,w,x),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,p,y),y}function d(){for(let S=0;S<a;S++)if(s.indexOf(S)===-1)return s.push(S),S;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function h(S){const p=i[S.id],y=S.uniforms,w=S.__cache;n.bindBuffer(n.UNIFORM_BUFFER,p);for(let x=0,_=y.length;x<_;x++){const A=y[x];if(m(A,x,w)===!0){const C=A.__offset,T=Array.isArray(A.value)?A.value:[A.value];let I=0;for(let M=0;M<T.length;M++){const P=T[M],E=v(P);typeof P=="number"?(A.__data[0]=P,n.bufferSubData(n.UNIFORM_BUFFER,C+I,A.__data)):P.isMatrix3?(A.__data[0]=P.elements[0],A.__data[1]=P.elements[1],A.__data[2]=P.elements[2],A.__data[3]=P.elements[0],A.__data[4]=P.elements[3],A.__data[5]=P.elements[4],A.__data[6]=P.elements[5],A.__data[7]=P.elements[0],A.__data[8]=P.elements[6],A.__data[9]=P.elements[7],A.__data[10]=P.elements[8],A.__data[11]=P.elements[0]):(P.toArray(A.__data,I),I+=E.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,C,A.__data)}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function m(S,p,y){const w=S.value;if(y[p]===void 0){if(typeof w=="number")y[p]=w;else{const x=Array.isArray(w)?w:[w],_=[];for(let A=0;A<x.length;A++)_.push(x[A].clone());y[p]=_}return!0}else if(typeof w=="number"){if(y[p]!==w)return y[p]=w,!0}else{const x=Array.isArray(y[p])?y[p]:[y[p]],_=Array.isArray(w)?w:[w];for(let A=0;A<x.length;A++){const C=x[A];if(C.equals(_[A])===!1)return C.copy(_[A]),!0}}return!1}function f(S){const p=S.uniforms;let y=0;const w=16;let x=0;for(let _=0,A=p.length;_<A;_++){const C=p[_],T={boundary:0,storage:0},I=Array.isArray(C.value)?C.value:[C.value];for(let M=0,P=I.length;M<P;M++){const E=I[M],R=v(E);T.boundary+=R.boundary,T.storage+=R.storage}if(C.__data=new Float32Array(T.storage/Float32Array.BYTES_PER_ELEMENT),C.__offset=y,_>0){x=y%w;const M=w-x;x!==0&&M-T.boundary<0&&(y+=w-x,C.__offset=y)}y+=T.storage}return x=y%w,x>0&&(y+=w-x),S.__size=y,S.__cache={},this}function v(S){const p={boundary:0,storage:0};return typeof S=="number"?(p.boundary=4,p.storage=4):S.isVector2?(p.boundary=8,p.storage=8):S.isVector3||S.isColor?(p.boundary=16,p.storage=12):S.isVector4?(p.boundary=16,p.storage=16):S.isMatrix3?(p.boundary=48,p.storage=48):S.isMatrix4?(p.boundary=64,p.storage=64):S.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",S),p}function g(S){const p=S.target;p.removeEventListener("dispose",g);const y=s.indexOf(p.__bindingPointIndex);s.splice(y,1),n.deleteBuffer(i[p.id]),delete i[p.id],delete o[p.id]}function b(){for(const S in i)n.deleteBuffer(i[S]);s=[],i={},o={}}return{bind:l,update:c,dispose:b}}class TE{constructor(e={}){const{canvas:t=TU(),context:r=null,depth:i=!0,stencil:o=!0,alpha:s=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1}=e;this.isWebGLRenderer=!0;let h;r!==null?h=r.getContextAttributes().alpha:h=s;const m=new Uint32Array(4),f=new Int32Array(4);let v=null,g=null;const b=[],S=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=pr,this._useLegacyLights=!1,this.toneMapping=zs,this.toneMappingExposure=1;const p=this;let y=!1,w=0,x=0,_=null,A=-1,C=null;const T=new lr,I=new lr;let M=null;const P=new _t(0);let E=0,R=t.width,B=t.height,L=1,F=null,H=null;const $=new lr(0,0,R,B),O=new lr(0,0,R,B);let k=!1;const X=new zb;let ie=!1,ne=!1,Q=null;const ce=new at,Z=new Ut,re=new te,se={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function fe(){return _===null?L:1}let ue=r;function U(J,Pe){for(let Oe=0;Oe<J.length;Oe++){const De=J[Oe],$e=t.getContext(De,Pe);if($e!==null)return $e}return null}try{const J={alpha:!0,depth:i,stencil:o,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Ob}`),t.addEventListener("webglcontextlost",We,!1),t.addEventListener("webglcontextrestored",ee,!1),t.addEventListener("webglcontextcreationerror",Ie,!1),ue===null){const Pe=["webgl2","webgl","experimental-webgl"];if(p.isWebGL1Renderer===!0&&Pe.shift(),ue=U(Pe,J),ue===null)throw U(Pe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&ue instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),ue.getShaderPrecisionFormat===void 0&&(ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(J){throw console.error("THREE.WebGLRenderer: "+J.message),J}let K,be,me,le,xe,pe,ye,Me,Ce,z,D,q,_e,ve,Re,ze,Le,Ve,Ze,ut,Ne,ct,he,Ae;function Fe(){K=new NH(ue),be=new DH(ue,K,e),K.init(be),ct=new wV(ue,K,be),me=new _V(ue,K,be),le=new $H(ue),xe=new sV,pe=new xV(ue,K,me,xe,be,ct,le),ye=new FH(p),Me=new BH(p),Ce=new ZU(ue,be),he=new RH(ue,K,Ce,be),z=new zH(ue,Ce,le,he),D=new WH(ue,z,Ce,le),Ze=new GH(ue,be,pe),ze=new LH(xe),q=new oV(p,ye,Me,K,be,he,ze),_e=new TV(p,xe),ve=new lV,Re=new pV(K,be),Ve=new PH(p,ye,Me,me,D,h,l),Le=new yV(p,D,be),Ae=new EV(ue,le,be,me),ut=new IH(ue,K,le,be),Ne=new UH(ue,K,le,be),le.programs=q.programs,p.capabilities=be,p.extensions=K,p.properties=xe,p.renderLists=ve,p.shadowMap=Le,p.state=me,p.info=le}Fe();const ke=new MV(p,ue);this.xr=ke,this.getContext=function(){return ue},this.getContextAttributes=function(){return ue.getContextAttributes()},this.forceContextLoss=function(){const J=K.get("WEBGL_lose_context");J&&J.loseContext()},this.forceContextRestore=function(){const J=K.get("WEBGL_lose_context");J&&J.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(J){J!==void 0&&(L=J,this.setSize(R,B,!1))},this.getSize=function(J){return J.set(R,B)},this.setSize=function(J,Pe,Oe=!0){if(ke.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}R=J,B=Pe,t.width=Math.floor(J*L),t.height=Math.floor(Pe*L),Oe===!0&&(t.style.width=J+"px",t.style.height=Pe+"px"),this.setViewport(0,0,J,Pe)},this.getDrawingBufferSize=function(J){return J.set(R*L,B*L).floor()},this.setDrawingBufferSize=function(J,Pe,Oe){R=J,B=Pe,L=Oe,t.width=Math.floor(J*Oe),t.height=Math.floor(Pe*Oe),this.setViewport(0,0,J,Pe)},this.getCurrentViewport=function(J){return J.copy(T)},this.getViewport=function(J){return J.copy($)},this.setViewport=function(J,Pe,Oe,De){J.isVector4?$.set(J.x,J.y,J.z,J.w):$.set(J,Pe,Oe,De),me.viewport(T.copy($).multiplyScalar(L).floor())},this.getScissor=function(J){return J.copy(O)},this.setScissor=function(J,Pe,Oe,De){J.isVector4?O.set(J.x,J.y,J.z,J.w):O.set(J,Pe,Oe,De),me.scissor(I.copy(O).multiplyScalar(L).floor())},this.getScissorTest=function(){return k},this.setScissorTest=function(J){me.setScissorTest(k=J)},this.setOpaqueSort=function(J){F=J},this.setTransparentSort=function(J){H=J},this.getClearColor=function(J){return J.copy(Ve.getClearColor())},this.setClearColor=function(){Ve.setClearColor.apply(Ve,arguments)},this.getClearAlpha=function(){return Ve.getClearAlpha()},this.setClearAlpha=function(){Ve.setClearAlpha.apply(Ve,arguments)},this.clear=function(J=!0,Pe=!0,Oe=!0){let De=0;if(J){let $e=!1;if(_!==null){const it=_.texture.format;$e=it===lE||it===aE||it===sE}if($e){const it=_.texture.type,mt=it===Zi||it===Os||it===kb||it===Ga||it===iE||it===oE,bt=Ve.getClearColor(),lt=Ve.getClearAlpha(),Ue=bt.r,nt=bt.g,dt=bt.b;mt?(m[0]=Ue,m[1]=nt,m[2]=dt,m[3]=lt,ue.clearBufferuiv(ue.COLOR,0,m)):(f[0]=Ue,f[1]=nt,f[2]=dt,f[3]=lt,ue.clearBufferiv(ue.COLOR,0,f))}else De|=ue.COLOR_BUFFER_BIT}Pe&&(De|=ue.DEPTH_BUFFER_BIT),Oe&&(De|=ue.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ue.clear(De)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",We,!1),t.removeEventListener("webglcontextrestored",ee,!1),t.removeEventListener("webglcontextcreationerror",Ie,!1),ve.dispose(),Re.dispose(),xe.dispose(),ye.dispose(),Me.dispose(),D.dispose(),he.dispose(),Ae.dispose(),q.dispose(),ke.dispose(),ke.removeEventListener("sessionstart",N),ke.removeEventListener("sessionend",j),Q&&(Q.dispose(),Q=null),Y.stop()};function We(J){J.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function ee(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const J=le.autoReset,Pe=Le.enabled,Oe=Le.autoUpdate,De=Le.needsUpdate,$e=Le.type;Fe(),le.autoReset=J,Le.enabled=Pe,Le.autoUpdate=Oe,Le.needsUpdate=De,Le.type=$e}function Ie(J){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",J.statusMessage)}function Se(J){const Pe=J.target;Pe.removeEventListener("dispose",Se),Ee(Pe)}function Ee(J){Ge(J),xe.remove(J)}function Ge(J){const Pe=xe.get(J).programs;Pe!==void 0&&(Pe.forEach(function(Oe){q.releaseProgram(Oe)}),J.isShaderMaterial&&q.releaseShaderCache(J))}this.renderBufferDirect=function(J,Pe,Oe,De,$e,it){Pe===null&&(Pe=se);const mt=$e.isMesh&&$e.matrixWorld.determinant()<0,bt=vt(J,Pe,Oe,De,$e);me.setMaterial(De,mt);let lt=Oe.index,Ue=1;if(De.wireframe===!0){if(lt=z.getWireframeAttribute(Oe),lt===void 0)return;Ue=2}const nt=Oe.drawRange,dt=Oe.attributes.position;let Ct=nt.start*Ue,yt=(nt.start+nt.count)*Ue;it!==null&&(Ct=Math.max(Ct,it.start*Ue),yt=Math.min(yt,(it.start+it.count)*Ue)),lt!==null?(Ct=Math.max(Ct,0),yt=Math.min(yt,lt.count)):dt!=null&&(Ct=Math.max(Ct,0),yt=Math.min(yt,dt.count));const At=yt-Ct;if(At<0||At===1/0)return;he.setup($e,De,bt,Oe,lt);let Dt,Tt=ut;if(lt!==null&&(Dt=Ce.get(lt),Tt=Ne,Tt.setIndex(Dt)),$e.isMesh)De.wireframe===!0?(me.setLineWidth(De.wireframeLinewidth*fe()),Tt.setMode(ue.LINES)):Tt.setMode(ue.TRIANGLES);else if($e.isLine){let Mt=De.linewidth;Mt===void 0&&(Mt=1),me.setLineWidth(Mt*fe()),$e.isLineSegments?Tt.setMode(ue.LINES):$e.isLineLoop?Tt.setMode(ue.LINE_LOOP):Tt.setMode(ue.LINE_STRIP)}else $e.isPoints?Tt.setMode(ue.POINTS):$e.isSprite&&Tt.setMode(ue.TRIANGLES);if($e.isInstancedMesh)Tt.renderInstances(Ct,At,$e.count);else if(Oe.isInstancedBufferGeometry){const Mt=Oe._maxInstanceCount!==void 0?Oe._maxInstanceCount:1/0,kt=Math.min(Oe.instanceCount,Mt);Tt.renderInstances(Ct,At,kt)}else Tt.render(Ct,At)};function ft(J,Pe,Oe){J.transparent===!0&&J.side===go&&J.forceSinglePass===!1?(J.side=Or,J.needsUpdate=!0,He(J,Pe,Oe),J.side=ts,J.needsUpdate=!0,He(J,Pe,Oe),J.side=go):He(J,Pe,Oe)}this.compile=function(J,Pe,Oe=null){Oe===null&&(Oe=J),g=Re.get(Oe),g.init(),S.push(g),Oe.traverseVisible(function($e){$e.isLight&&$e.layers.test(Pe.layers)&&(g.pushLight($e),$e.castShadow&&g.pushShadow($e))}),J!==Oe&&J.traverseVisible(function($e){$e.isLight&&$e.layers.test(Pe.layers)&&(g.pushLight($e),$e.castShadow&&g.pushShadow($e))}),g.setupLights(p._useLegacyLights);const De=new Set;return J.traverse(function($e){const it=$e.material;if(it)if(Array.isArray(it))for(let mt=0;mt<it.length;mt++){const bt=it[mt];ft(bt,Oe,$e),De.add(bt)}else ft(it,Oe,$e),De.add(it)}),S.pop(),g=null,De},this.compileAsync=function(J,Pe,Oe=null){const De=this.compile(J,Pe,Oe);return new Promise($e=>{function it(){if(De.forEach(function(mt){xe.get(mt).currentProgram.isReady()&&De.delete(mt)}),De.size===0){$e(J);return}setTimeout(it,10)}K.get("KHR_parallel_shader_compile")!==null?it():setTimeout(it,10)})};let Rt=null;function St(J){Rt&&Rt(J)}function N(){Y.stop()}function j(){Y.start()}const Y=new wE;Y.setAnimationLoop(St),typeof self<"u"&&Y.setContext(self),this.setAnimationLoop=function(J){Rt=J,ke.setAnimationLoop(J),J===null?Y.stop():Y.start()},ke.addEventListener("sessionstart",N),ke.addEventListener("sessionend",j),this.render=function(J,Pe){if(Pe!==void 0&&Pe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(y===!0)return;J.matrixWorldAutoUpdate===!0&&J.updateMatrixWorld(),Pe.parent===null&&Pe.matrixWorldAutoUpdate===!0&&Pe.updateMatrixWorld(),ke.enabled===!0&&ke.isPresenting===!0&&(ke.cameraAutoUpdate===!0&&ke.updateCamera(Pe),Pe=ke.getCamera()),J.isScene===!0&&J.onBeforeRender(p,J,Pe,_),g=Re.get(J,S.length),g.init(),S.push(g),ce.multiplyMatrices(Pe.projectionMatrix,Pe.matrixWorldInverse),X.setFromProjectionMatrix(ce),ne=this.localClippingEnabled,ie=ze.init(this.clippingPlanes,ne),v=ve.get(J,b.length),v.init(),b.push(v),oe(J,Pe,0,p.sortObjects),v.finish(),p.sortObjects===!0&&v.sort(F,H),this.info.render.frame++,ie===!0&&ze.beginShadows();const Oe=g.state.shadowsArray;if(Le.render(Oe,J,Pe),ie===!0&&ze.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ve.render(v,J),g.setupLights(p._useLegacyLights),Pe.isArrayCamera){const De=Pe.cameras;for(let $e=0,it=De.length;$e<it;$e++){const mt=De[$e];de(v,J,mt,mt.viewport)}}else de(v,J,Pe);_!==null&&(pe.updateMultisampleRenderTarget(_),pe.updateRenderTargetMipmap(_)),J.isScene===!0&&J.onAfterRender(p,J,Pe),he.resetDefaultState(),A=-1,C=null,S.pop(),S.length>0?g=S[S.length-1]:g=null,b.pop(),b.length>0?v=b[b.length-1]:v=null};function oe(J,Pe,Oe,De){if(J.visible===!1)return;if(J.layers.test(Pe.layers)){if(J.isGroup)Oe=J.renderOrder;else if(J.isLOD)J.autoUpdate===!0&&J.update(Pe);else if(J.isLight)g.pushLight(J),J.castShadow&&g.pushShadow(J);else if(J.isSprite){if(!J.frustumCulled||X.intersectsSprite(J)){De&&re.setFromMatrixPosition(J.matrixWorld).applyMatrix4(ce);const mt=D.update(J),bt=J.material;bt.visible&&v.push(J,mt,bt,Oe,re.z,null)}}else if((J.isMesh||J.isLine||J.isPoints)&&(!J.frustumCulled||X.intersectsObject(J))){const mt=D.update(J),bt=J.material;if(De&&(J.boundingSphere!==void 0?(J.boundingSphere===null&&J.computeBoundingSphere(),re.copy(J.boundingSphere.center)):(mt.boundingSphere===null&&mt.computeBoundingSphere(),re.copy(mt.boundingSphere.center)),re.applyMatrix4(J.matrixWorld).applyMatrix4(ce)),Array.isArray(bt)){const lt=mt.groups;for(let Ue=0,nt=lt.length;Ue<nt;Ue++){const dt=lt[Ue],Ct=bt[dt.materialIndex];Ct&&Ct.visible&&v.push(J,mt,Ct,Oe,re.z,dt)}}else bt.visible&&v.push(J,mt,bt,Oe,re.z,null)}}const it=J.children;for(let mt=0,bt=it.length;mt<bt;mt++)oe(it[mt],Pe,Oe,De)}function de(J,Pe,Oe,De){const $e=J.opaque,it=J.transmissive,mt=J.transparent;g.setupLightsView(Oe),ie===!0&&ze.setGlobalState(p.clippingPlanes,Oe),it.length>0&&G($e,it,Pe,Oe),De&&me.viewport(T.copy(De)),$e.length>0&&ae($e,Pe,Oe),it.length>0&&ae(it,Pe,Oe),mt.length>0&&ae(mt,Pe,Oe),me.buffers.depth.setTest(!0),me.buffers.depth.setMask(!0),me.buffers.color.setMask(!0),me.setPolygonOffset(!1)}function G(J,Pe,Oe,De){if((Oe.isScene===!0?Oe.overrideMaterial:null)!==null)return;const it=be.isWebGL2;Q===null&&(Q=new xo(1,1,{generateMipmaps:!0,type:K.has("EXT_color_buffer_half_float")?nl:Zi,minFilter:md,samples:it?4:0})),p.getDrawingBufferSize(Z),it?Q.setSize(Z.x,Z.y):Q.setSize(ev(Z.x),ev(Z.y));const mt=p.getRenderTarget();p.setRenderTarget(Q),p.getClearColor(P),E=p.getClearAlpha(),E<1&&p.setClearColor(16777215,.5),p.clear();const bt=p.toneMapping;p.toneMapping=zs,ae(J,Oe,De),pe.updateMultisampleRenderTarget(Q),pe.updateRenderTargetMipmap(Q);let lt=!1;for(let Ue=0,nt=Pe.length;Ue<nt;Ue++){const dt=Pe[Ue],Ct=dt.object,yt=dt.geometry,At=dt.material,Dt=dt.group;if(At.side===go&&Ct.layers.test(De.layers)){const Tt=At.side;At.side=Or,At.needsUpdate=!0,we(Ct,Oe,De,yt,At,Dt),At.side=Tt,At.needsUpdate=!0,lt=!0}}lt===!0&&(pe.updateMultisampleRenderTarget(Q),pe.updateRenderTargetMipmap(Q)),p.setRenderTarget(mt),p.setClearColor(P,E),p.toneMapping=bt}function ae(J,Pe,Oe){const De=Pe.isScene===!0?Pe.overrideMaterial:null;for(let $e=0,it=J.length;$e<it;$e++){const mt=J[$e],bt=mt.object,lt=mt.geometry,Ue=De===null?mt.material:De,nt=mt.group;bt.layers.test(Oe.layers)&&we(bt,Pe,Oe,lt,Ue,nt)}}function we(J,Pe,Oe,De,$e,it){J.onBeforeRender(p,Pe,Oe,De,$e,it),J.modelViewMatrix.multiplyMatrices(Oe.matrixWorldInverse,J.matrixWorld),J.normalMatrix.getNormalMatrix(J.modelViewMatrix),$e.onBeforeRender(p,Pe,Oe,De,J,it),$e.transparent===!0&&$e.side===go&&$e.forceSinglePass===!1?($e.side=Or,$e.needsUpdate=!0,p.renderBufferDirect(Oe,Pe,De,$e,J,it),$e.side=ts,$e.needsUpdate=!0,p.renderBufferDirect(Oe,Pe,De,$e,J,it),$e.side=go):p.renderBufferDirect(Oe,Pe,De,$e,J,it),J.onAfterRender(p,Pe,Oe,De,$e,it)}function He(J,Pe,Oe){Pe.isScene!==!0&&(Pe=se);const De=xe.get(J),$e=g.state.lights,it=g.state.shadowsArray,mt=$e.state.version,bt=q.getParameters(J,$e.state,it,Pe,Oe),lt=q.getProgramCacheKey(bt);let Ue=De.programs;De.environment=J.isMeshStandardMaterial?Pe.environment:null,De.fog=Pe.fog,De.envMap=(J.isMeshStandardMaterial?Me:ye).get(J.envMap||De.environment),Ue===void 0&&(J.addEventListener("dispose",Se),Ue=new Map,De.programs=Ue);let nt=Ue.get(lt);if(nt!==void 0){if(De.currentProgram===nt&&De.lightsStateVersion===mt)return Qe(J,bt),nt}else bt.uniforms=q.getUniforms(J),J.onBuild(Oe,bt,p),J.onBeforeCompile(bt,p),nt=q.acquireProgram(bt,lt),Ue.set(lt,nt),De.uniforms=bt.uniforms;const dt=De.uniforms;return(!J.isShaderMaterial&&!J.isRawShaderMaterial||J.clipping===!0)&&(dt.clippingPlanes=ze.uniform),Qe(J,bt),De.needsLights=et(J),De.lightsStateVersion=mt,De.needsLights&&(dt.ambientLightColor.value=$e.state.ambient,dt.lightProbe.value=$e.state.probe,dt.directionalLights.value=$e.state.directional,dt.directionalLightShadows.value=$e.state.directionalShadow,dt.spotLights.value=$e.state.spot,dt.spotLightShadows.value=$e.state.spotShadow,dt.rectAreaLights.value=$e.state.rectArea,dt.ltc_1.value=$e.state.rectAreaLTC1,dt.ltc_2.value=$e.state.rectAreaLTC2,dt.pointLights.value=$e.state.point,dt.pointLightShadows.value=$e.state.pointShadow,dt.hemisphereLights.value=$e.state.hemi,dt.directionalShadowMap.value=$e.state.directionalShadowMap,dt.directionalShadowMatrix.value=$e.state.directionalShadowMatrix,dt.spotShadowMap.value=$e.state.spotShadowMap,dt.spotLightMatrix.value=$e.state.spotLightMatrix,dt.spotLightMap.value=$e.state.spotLightMap,dt.pointShadowMap.value=$e.state.pointShadowMap,dt.pointShadowMatrix.value=$e.state.pointShadowMatrix),De.currentProgram=nt,De.uniformsList=null,nt}function qe(J){if(J.uniformsList===null){const Pe=J.currentProgram.getUniforms();J.uniformsList=Tf.seqWithValue(Pe.seq,J.uniforms)}return J.uniformsList}function Qe(J,Pe){const Oe=xe.get(J);Oe.outputColorSpace=Pe.outputColorSpace,Oe.instancing=Pe.instancing,Oe.instancingColor=Pe.instancingColor,Oe.skinning=Pe.skinning,Oe.morphTargets=Pe.morphTargets,Oe.morphNormals=Pe.morphNormals,Oe.morphColors=Pe.morphColors,Oe.morphTargetsCount=Pe.morphTargetsCount,Oe.numClippingPlanes=Pe.numClippingPlanes,Oe.numIntersection=Pe.numClipIntersection,Oe.vertexAlphas=Pe.vertexAlphas,Oe.vertexTangents=Pe.vertexTangents,Oe.toneMapping=Pe.toneMapping}function vt(J,Pe,Oe,De,$e){Pe.isScene!==!0&&(Pe=se),pe.resetTextureUnits();const it=Pe.fog,mt=De.isMeshStandardMaterial?Pe.environment:null,bt=_===null?p.outputColorSpace:_.isXRRenderTarget===!0?_.texture.colorSpace:ns,lt=(De.isMeshStandardMaterial?Me:ye).get(De.envMap||mt),Ue=De.vertexColors===!0&&!!Oe.attributes.color&&Oe.attributes.color.itemSize===4,nt=!!Oe.attributes.tangent&&(!!De.normalMap||De.anisotropy>0),dt=!!Oe.morphAttributes.position,Ct=!!Oe.morphAttributes.normal,yt=!!Oe.morphAttributes.color;let At=zs;De.toneMapped&&(_===null||_.isXRRenderTarget===!0)&&(At=p.toneMapping);const Dt=Oe.morphAttributes.position||Oe.morphAttributes.normal||Oe.morphAttributes.color,Tt=Dt!==void 0?Dt.length:0,Mt=xe.get(De),kt=g.state.lights;if(ie===!0&&(ne===!0||J!==C)){const Hn=J===C&&De.id===A;ze.setState(De,J,Hn)}let $t=!1;De.version===Mt.__version?(Mt.needsLights&&Mt.lightsStateVersion!==kt.state.version||Mt.outputColorSpace!==bt||$e.isInstancedMesh&&Mt.instancing===!1||!$e.isInstancedMesh&&Mt.instancing===!0||$e.isSkinnedMesh&&Mt.skinning===!1||!$e.isSkinnedMesh&&Mt.skinning===!0||$e.isInstancedMesh&&Mt.instancingColor===!0&&$e.instanceColor===null||$e.isInstancedMesh&&Mt.instancingColor===!1&&$e.instanceColor!==null||Mt.envMap!==lt||De.fog===!0&&Mt.fog!==it||Mt.numClippingPlanes!==void 0&&(Mt.numClippingPlanes!==ze.numPlanes||Mt.numIntersection!==ze.numIntersection)||Mt.vertexAlphas!==Ue||Mt.vertexTangents!==nt||Mt.morphTargets!==dt||Mt.morphNormals!==Ct||Mt.morphColors!==yt||Mt.toneMapping!==At||be.isWebGL2===!0&&Mt.morphTargetsCount!==Tt)&&($t=!0):($t=!0,Mt.__version=De.version);let Ur=Mt.currentProgram;$t===!0&&(Ur=He(De,Pe,$e));let Pi=!1,Ri=!1,Ii=!1;const Fn=Ur.getUniforms(),Pr=Mt.uniforms;if(me.useProgram(Ur.program)&&(Pi=!0,Ri=!0,Ii=!0),De.id!==A&&(A=De.id,Ri=!0),Pi||C!==J){Fn.setValue(ue,"projectionMatrix",J.projectionMatrix),Fn.setValue(ue,"viewMatrix",J.matrixWorldInverse);const Hn=Fn.map.cameraPosition;Hn!==void 0&&Hn.setValue(ue,re.setFromMatrixPosition(J.matrixWorld)),be.logarithmicDepthBuffer&&Fn.setValue(ue,"logDepthBufFC",2/(Math.log(J.far+1)/Math.LN2)),(De.isMeshPhongMaterial||De.isMeshToonMaterial||De.isMeshLambertMaterial||De.isMeshBasicMaterial||De.isMeshStandardMaterial||De.isShaderMaterial)&&Fn.setValue(ue,"isOrthographic",J.isOrthographicCamera===!0),C!==J&&(C=J,Ri=!0,Ii=!0)}if($e.isSkinnedMesh){Fn.setOptional(ue,$e,"bindMatrix"),Fn.setOptional(ue,$e,"bindMatrixInverse");const Hn=$e.skeleton;Hn&&(be.floatVertexTextures?(Hn.boneTexture===null&&Hn.computeBoneTexture(),Fn.setValue(ue,"boneTexture",Hn.boneTexture,pe),Fn.setValue(ue,"boneTextureSize",Hn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Di=Oe.morphAttributes;if((Di.position!==void 0||Di.normal!==void 0||Di.color!==void 0&&be.isWebGL2===!0)&&Ze.update($e,Oe,Ur),(Ri||Mt.receiveShadow!==$e.receiveShadow)&&(Mt.receiveShadow=$e.receiveShadow,Fn.setValue(ue,"receiveShadow",$e.receiveShadow)),De.isMeshGouraudMaterial&&De.envMap!==null&&(Pr.envMap.value=lt,Pr.flipEnvMap.value=lt.isCubeTexture&&lt.isRenderTargetTexture===!1?-1:1),Ri&&(Fn.setValue(ue,"toneMappingExposure",p.toneMappingExposure),Mt.needsLights&&ot(Pr,Ii),it&&De.fog===!0&&_e.refreshFogUniforms(Pr,it),_e.refreshMaterialUniforms(Pr,De,L,B,Q),Tf.upload(ue,qe(Mt),Pr,pe)),De.isShaderMaterial&&De.uniformsNeedUpdate===!0&&(Tf.upload(ue,qe(Mt),Pr,pe),De.uniformsNeedUpdate=!1),De.isSpriteMaterial&&Fn.setValue(ue,"center",$e.center),Fn.setValue(ue,"modelViewMatrix",$e.modelViewMatrix),Fn.setValue(ue,"normalMatrix",$e.normalMatrix),Fn.setValue(ue,"modelMatrix",$e.matrixWorld),De.isShaderMaterial||De.isRawShaderMaterial){const Hn=De.uniformsGroups;for(let Li=0,yl=Hn.length;Li<yl;Li++)if(be.isWebGL2){const to=Hn[Li];Ae.update(to,Ur),Ae.bind(to,Ur)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Ur}function ot(J,Pe){J.ambientLightColor.needsUpdate=Pe,J.lightProbe.needsUpdate=Pe,J.directionalLights.needsUpdate=Pe,J.directionalLightShadows.needsUpdate=Pe,J.pointLights.needsUpdate=Pe,J.pointLightShadows.needsUpdate=Pe,J.spotLights.needsUpdate=Pe,J.spotLightShadows.needsUpdate=Pe,J.rectAreaLights.needsUpdate=Pe,J.hemisphereLights.needsUpdate=Pe}function et(J){return J.isMeshLambertMaterial||J.isMeshToonMaterial||J.isMeshPhongMaterial||J.isMeshStandardMaterial||J.isShadowMaterial||J.isShaderMaterial&&J.lights===!0}this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(J,Pe,Oe){xe.get(J.texture).__webglTexture=Pe,xe.get(J.depthTexture).__webglTexture=Oe;const De=xe.get(J);De.__hasExternalTextures=!0,De.__hasExternalTextures&&(De.__autoAllocateDepthBuffer=Oe===void 0,De.__autoAllocateDepthBuffer||K.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),De.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(J,Pe){const Oe=xe.get(J);Oe.__webglFramebuffer=Pe,Oe.__useDefaultFramebuffer=Pe===void 0},this.setRenderTarget=function(J,Pe=0,Oe=0){_=J,w=Pe,x=Oe;let De=!0,$e=null,it=!1,mt=!1;if(J){const lt=xe.get(J);lt.__useDefaultFramebuffer!==void 0?(me.bindFramebuffer(ue.FRAMEBUFFER,null),De=!1):lt.__webglFramebuffer===void 0?pe.setupRenderTarget(J):lt.__hasExternalTextures&&pe.rebindTextures(J,xe.get(J.texture).__webglTexture,xe.get(J.depthTexture).__webglTexture);const Ue=J.texture;(Ue.isData3DTexture||Ue.isDataArrayTexture||Ue.isCompressedArrayTexture)&&(mt=!0);const nt=xe.get(J).__webglFramebuffer;J.isWebGLCubeRenderTarget?(Array.isArray(nt[Pe])?$e=nt[Pe][Oe]:$e=nt[Pe],it=!0):be.isWebGL2&&J.samples>0&&pe.useMultisampledRTT(J)===!1?$e=xe.get(J).__webglMultisampledFramebuffer:Array.isArray(nt)?$e=nt[Oe]:$e=nt,T.copy(J.viewport),I.copy(J.scissor),M=J.scissorTest}else T.copy($).multiplyScalar(L).floor(),I.copy(O).multiplyScalar(L).floor(),M=k;if(me.bindFramebuffer(ue.FRAMEBUFFER,$e)&&be.drawBuffers&&De&&me.drawBuffers(J,$e),me.viewport(T),me.scissor(I),me.setScissorTest(M),it){const lt=xe.get(J.texture);ue.framebufferTexture2D(ue.FRAMEBUFFER,ue.COLOR_ATTACHMENT0,ue.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,lt.__webglTexture,Oe)}else if(mt){const lt=xe.get(J.texture),Ue=Pe||0;ue.framebufferTextureLayer(ue.FRAMEBUFFER,ue.COLOR_ATTACHMENT0,lt.__webglTexture,Oe||0,Ue)}A=-1},this.readRenderTargetPixels=function(J,Pe,Oe,De,$e,it,mt){if(!(J&&J.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let bt=xe.get(J).__webglFramebuffer;if(J.isWebGLCubeRenderTarget&&mt!==void 0&&(bt=bt[mt]),bt){me.bindFramebuffer(ue.FRAMEBUFFER,bt);try{const lt=J.texture,Ue=lt.format,nt=lt.type;if(Ue!==Xr&&ct.convert(Ue)!==ue.getParameter(ue.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const dt=nt===nl&&(K.has("EXT_color_buffer_half_float")||be.isWebGL2&&K.has("EXT_color_buffer_float"));if(nt!==Zi&&ct.convert(nt)!==ue.getParameter(ue.IMPLEMENTATION_COLOR_READ_TYPE)&&!(nt===qi&&(be.isWebGL2||K.has("OES_texture_float")||K.has("WEBGL_color_buffer_float")))&&!dt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Pe>=0&&Pe<=J.width-De&&Oe>=0&&Oe<=J.height-$e&&ue.readPixels(Pe,Oe,De,$e,ct.convert(Ue),ct.convert(nt),it)}finally{const lt=_!==null?xe.get(_).__webglFramebuffer:null;me.bindFramebuffer(ue.FRAMEBUFFER,lt)}}},this.copyFramebufferToTexture=function(J,Pe,Oe=0){const De=Math.pow(2,-Oe),$e=Math.floor(Pe.image.width*De),it=Math.floor(Pe.image.height*De);pe.setTexture2D(Pe,0),ue.copyTexSubImage2D(ue.TEXTURE_2D,Oe,0,0,J.x,J.y,$e,it),me.unbindTexture()},this.copyTextureToTexture=function(J,Pe,Oe,De=0){const $e=Pe.image.width,it=Pe.image.height,mt=ct.convert(Oe.format),bt=ct.convert(Oe.type);pe.setTexture2D(Oe,0),ue.pixelStorei(ue.UNPACK_FLIP_Y_WEBGL,Oe.flipY),ue.pixelStorei(ue.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Oe.premultiplyAlpha),ue.pixelStorei(ue.UNPACK_ALIGNMENT,Oe.unpackAlignment),Pe.isDataTexture?ue.texSubImage2D(ue.TEXTURE_2D,De,J.x,J.y,$e,it,mt,bt,Pe.image.data):Pe.isCompressedTexture?ue.compressedTexSubImage2D(ue.TEXTURE_2D,De,J.x,J.y,Pe.mipmaps[0].width,Pe.mipmaps[0].height,mt,Pe.mipmaps[0].data):ue.texSubImage2D(ue.TEXTURE_2D,De,J.x,J.y,mt,bt,Pe.image),De===0&&Oe.generateMipmaps&&ue.generateMipmap(ue.TEXTURE_2D),me.unbindTexture()},this.copyTextureToTexture3D=function(J,Pe,Oe,De,$e=0){if(p.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const it=J.max.x-J.min.x+1,mt=J.max.y-J.min.y+1,bt=J.max.z-J.min.z+1,lt=ct.convert(De.format),Ue=ct.convert(De.type);let nt;if(De.isData3DTexture)pe.setTexture3D(De,0),nt=ue.TEXTURE_3D;else if(De.isDataArrayTexture)pe.setTexture2DArray(De,0),nt=ue.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ue.pixelStorei(ue.UNPACK_FLIP_Y_WEBGL,De.flipY),ue.pixelStorei(ue.UNPACK_PREMULTIPLY_ALPHA_WEBGL,De.premultiplyAlpha),ue.pixelStorei(ue.UNPACK_ALIGNMENT,De.unpackAlignment);const dt=ue.getParameter(ue.UNPACK_ROW_LENGTH),Ct=ue.getParameter(ue.UNPACK_IMAGE_HEIGHT),yt=ue.getParameter(ue.UNPACK_SKIP_PIXELS),At=ue.getParameter(ue.UNPACK_SKIP_ROWS),Dt=ue.getParameter(ue.UNPACK_SKIP_IMAGES),Tt=Oe.isCompressedTexture?Oe.mipmaps[0]:Oe.image;ue.pixelStorei(ue.UNPACK_ROW_LENGTH,Tt.width),ue.pixelStorei(ue.UNPACK_IMAGE_HEIGHT,Tt.height),ue.pixelStorei(ue.UNPACK_SKIP_PIXELS,J.min.x),ue.pixelStorei(ue.UNPACK_SKIP_ROWS,J.min.y),ue.pixelStorei(ue.UNPACK_SKIP_IMAGES,J.min.z),Oe.isDataTexture||Oe.isData3DTexture?ue.texSubImage3D(nt,$e,Pe.x,Pe.y,Pe.z,it,mt,bt,lt,Ue,Tt.data):Oe.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ue.compressedTexSubImage3D(nt,$e,Pe.x,Pe.y,Pe.z,it,mt,bt,lt,Tt.data)):ue.texSubImage3D(nt,$e,Pe.x,Pe.y,Pe.z,it,mt,bt,lt,Ue,Tt),ue.pixelStorei(ue.UNPACK_ROW_LENGTH,dt),ue.pixelStorei(ue.UNPACK_IMAGE_HEIGHT,Ct),ue.pixelStorei(ue.UNPACK_SKIP_PIXELS,yt),ue.pixelStorei(ue.UNPACK_SKIP_ROWS,At),ue.pixelStorei(ue.UNPACK_SKIP_IMAGES,Dt),$e===0&&De.generateMipmaps&&ue.generateMipmap(nt),me.unbindTexture()},this.initTexture=function(J){J.isCubeTexture?pe.setTextureCube(J,0):J.isData3DTexture?pe.setTexture3D(J,0):J.isDataArrayTexture||J.isCompressedArrayTexture?pe.setTexture2DArray(J,0):pe.setTexture2D(J,0),me.unbindTexture()},this.resetState=function(){w=0,x=0,_=null,me.reset(),he.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Yo}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Bb?"display-p3":"srgb",t.unpackColorSpace=fn.workingColorSpace===lm?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===pr?ja:cE}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===ja?pr:ns}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class PV extends TE{}PV.prototype.isWebGL1Renderer=!0;class $b{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new _t(e),this.near=t,this.far=r}clone(){return new $b(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Y2 extends cr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class nv extends kr{constructor(e=null,t=1,r=1,i,o,s,a,l,c=gn,u=gn,d,h){super(null,s,a,l,c,u,i,o,d,h),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class RV extends $c{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new _t(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const K2=new te,Z2=new te,J2=new at,jg=new Nb,Bh=new kd;class IV extends cr{constructor(e=new tr,t=new RV){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[0];for(let i=1,o=t.count;i<o;i++)K2.fromBufferAttribute(t,i-1),Z2.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=K2.distanceTo(Z2);e.setAttribute("lineDistance",new ur(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,o=e.params.Line.threshold,s=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),Bh.copy(r.boundingSphere),Bh.applyMatrix4(i),Bh.radius+=o,e.ray.intersectsSphere(Bh)===!1)return;J2.copy(i).invert(),jg.copy(e.ray).applyMatrix4(J2);const a=o/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new te,u=new te,d=new te,h=new te,m=this.isLineSegments?2:1,f=r.index,g=r.attributes.position;if(f!==null){const b=Math.max(0,s.start),S=Math.min(f.count,s.start+s.count);for(let p=b,y=S-1;p<y;p+=m){const w=f.getX(p),x=f.getX(p+1);if(c.fromBufferAttribute(g,w),u.fromBufferAttribute(g,x),jg.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);const A=e.ray.origin.distanceTo(h);A<e.near||A>e.far||t.push({distance:A,point:d.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this})}}else{const b=Math.max(0,s.start),S=Math.min(g.count,s.start+s.count);for(let p=b,y=S-1;p<y;p+=m){if(c.fromBufferAttribute(g,p),u.fromBufferAttribute(g,p+1),jg.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);const x=e.ray.origin.distanceTo(h);x<e.near||x>e.far||t.push({distance:x,point:d.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,s=i.length;o<s;o++){const a=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}}const Q2=new te,ew=new te;class rv extends IV{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[];for(let i=0,o=t.count;i<o;i+=2)Q2.fromBufferAttribute(t,i),ew.fromBufferAttribute(t,i+1),r[i]=i===0?0:r[i-1],r[i+1]=r[i]+Q2.distanceTo(ew);e.setAttribute("lineDistance",new ur(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class DV extends $c{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new _t(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const tw=new at,iv=new Nb,Nh=new kd,zh=new te;class EE extends cr{constructor(e=new tr,t=new DV){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,o=e.params.Points.threshold,s=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),Nh.copy(r.boundingSphere),Nh.applyMatrix4(i),Nh.radius+=o,e.ray.intersectsSphere(Nh)===!1)return;tw.copy(i).invert(),iv.copy(e.ray).applyMatrix4(tw);const a=o/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=r.index,d=r.attributes.position;if(c!==null){const h=Math.max(0,s.start),m=Math.min(c.count,s.start+s.count);for(let f=h,v=m;f<v;f++){const g=c.getX(f);zh.fromBufferAttribute(d,g),nw(zh,g,l,i,e,t,this)}}else{const h=Math.max(0,s.start),m=Math.min(d.count,s.start+s.count);for(let f=h,v=m;f<v;f++)zh.fromBufferAttribute(d,f),nw(zh,f,l,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,s=i.length;o<s;o++){const a=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}}function nw(n,e,t,r,i,o,s){const a=iv.distanceSqToPoint(n);if(a<t){const l=new te;iv.closestPointToPoint(n,l),l.applyMatrix4(r);const c=i.ray.origin.distanceTo(l);if(c<i.near||c>i.far)return;o.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:s})}}class LV extends kr{constructor(e,t,r,i,o,s,a,l,c){super(e,t,r,i,o,s,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class dm extends tr{constructor(e=1,t=1,r=1,i=32,o=1,s=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:o,openEnded:s,thetaStart:a,thetaLength:l};const c=this;i=Math.floor(i),o=Math.floor(o);const u=[],d=[],h=[],m=[];let f=0;const v=[],g=r/2;let b=0;S(),s===!1&&(e>0&&p(!0),t>0&&p(!1)),this.setIndex(u),this.setAttribute("position",new ur(d,3)),this.setAttribute("normal",new ur(h,3)),this.setAttribute("uv",new ur(m,2));function S(){const y=new te,w=new te;let x=0;const _=(t-e)/r;for(let A=0;A<=o;A++){const C=[],T=A/o,I=T*(t-e)+e;for(let M=0;M<=i;M++){const P=M/i,E=P*l+a,R=Math.sin(E),B=Math.cos(E);w.x=I*R,w.y=-T*r+g,w.z=I*B,d.push(w.x,w.y,w.z),y.set(R,_,B).normalize(),h.push(y.x,y.y,y.z),m.push(P,1-T),C.push(f++)}v.push(C)}for(let A=0;A<i;A++)for(let C=0;C<o;C++){const T=v[C][A],I=v[C+1][A],M=v[C+1][A+1],P=v[C][A+1];u.push(T,I,P),u.push(I,M,P),x+=6}c.addGroup(b,x,0),b+=x}function p(y){const w=f,x=new Ut,_=new te;let A=0;const C=y===!0?e:t,T=y===!0?1:-1;for(let M=1;M<=i;M++)d.push(0,g*T,0),h.push(0,T,0),m.push(.5,.5),f++;const I=f;for(let M=0;M<=i;M++){const E=M/i*l+a,R=Math.cos(E),B=Math.sin(E);_.x=C*B,_.y=g*T,_.z=C*R,d.push(_.x,_.y,_.z),h.push(0,T,0),x.x=R*.5+.5,x.y=B*.5*T+.5,m.push(x.x,x.y),f++}for(let M=0;M<i;M++){const P=w+M,E=I+M;y===!0?u.push(E,E+1,P):u.push(E+1,E,P),A+=3}c.addGroup(b,A,y===!0?1:2),b+=A}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dm(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Hb extends dm{constructor(e=1,t=1,r=32,i=1,o=!1,s=0,a=Math.PI*2){super(0,e,t,r,i,o,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a}}static fromJSON(e){return new Hb(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Bd extends tr{constructor(e=[],t=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i};const o=[],s=[];a(i),c(r),u(),this.setAttribute("position",new ur(o,3)),this.setAttribute("normal",new ur(o.slice(),3)),this.setAttribute("uv",new ur(s,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(S){const p=new te,y=new te,w=new te;for(let x=0;x<t.length;x+=3)m(t[x+0],p),m(t[x+1],y),m(t[x+2],w),l(p,y,w,S)}function l(S,p,y,w){const x=w+1,_=[];for(let A=0;A<=x;A++){_[A]=[];const C=S.clone().lerp(y,A/x),T=p.clone().lerp(y,A/x),I=x-A;for(let M=0;M<=I;M++)M===0&&A===x?_[A][M]=C:_[A][M]=C.clone().lerp(T,M/I)}for(let A=0;A<x;A++)for(let C=0;C<2*(x-A)-1;C++){const T=Math.floor(C/2);C%2===0?(h(_[A][T+1]),h(_[A+1][T]),h(_[A][T])):(h(_[A][T+1]),h(_[A+1][T+1]),h(_[A+1][T]))}}function c(S){const p=new te;for(let y=0;y<o.length;y+=3)p.x=o[y+0],p.y=o[y+1],p.z=o[y+2],p.normalize().multiplyScalar(S),o[y+0]=p.x,o[y+1]=p.y,o[y+2]=p.z}function u(){const S=new te;for(let p=0;p<o.length;p+=3){S.x=o[p+0],S.y=o[p+1],S.z=o[p+2];const y=g(S)/2/Math.PI+.5,w=b(S)/Math.PI+.5;s.push(y,1-w)}f(),d()}function d(){for(let S=0;S<s.length;S+=6){const p=s[S+0],y=s[S+2],w=s[S+4],x=Math.max(p,y,w),_=Math.min(p,y,w);x>.9&&_<.1&&(p<.2&&(s[S+0]+=1),y<.2&&(s[S+2]+=1),w<.2&&(s[S+4]+=1))}}function h(S){o.push(S.x,S.y,S.z)}function m(S,p){const y=S*3;p.x=e[y+0],p.y=e[y+1],p.z=e[y+2]}function f(){const S=new te,p=new te,y=new te,w=new te,x=new Ut,_=new Ut,A=new Ut;for(let C=0,T=0;C<o.length;C+=9,T+=6){S.set(o[C+0],o[C+1],o[C+2]),p.set(o[C+3],o[C+4],o[C+5]),y.set(o[C+6],o[C+7],o[C+8]),x.set(s[T+0],s[T+1]),_.set(s[T+2],s[T+3]),A.set(s[T+4],s[T+5]),w.copy(S).add(p).add(y).divideScalar(3);const I=g(w);v(x,T+0,S,I),v(_,T+2,p,I),v(A,T+4,y,I)}}function v(S,p,y,w){w<0&&S.x===1&&(s[p]=S.x-1),y.x===0&&y.z===0&&(s[p]=w/2/Math.PI+.5)}function g(S){return Math.atan2(S.z,-S.x)}function b(S){return Math.atan2(-S.y,Math.sqrt(S.x*S.x+S.z*S.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Bd(e.vertices,e.indices,e.radius,e.details)}}class hm extends Bd{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,o,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new hm(e.radius,e.detail)}}class Vb extends Bd{constructor(e=1,t=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Vb(e.radius,e.detail)}}class Gb extends Bd{constructor(e=1,t=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Gb(e.radius,e.detail)}}class Wb extends tr{constructor(e=1,t=.4,r=12,i=48,o=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:o},r=Math.floor(r),i=Math.floor(i);const s=[],a=[],l=[],c=[],u=new te,d=new te,h=new te;for(let m=0;m<=r;m++)for(let f=0;f<=i;f++){const v=f/i*o,g=m/r*Math.PI*2;d.x=(e+t*Math.cos(g))*Math.cos(v),d.y=(e+t*Math.cos(g))*Math.sin(v),d.z=t*Math.sin(g),a.push(d.x,d.y,d.z),u.x=e*Math.cos(v),u.y=e*Math.sin(v),h.subVectors(d,u).normalize(),l.push(h.x,h.y,h.z),c.push(f/i),c.push(m/r)}for(let m=1;m<=r;m++)for(let f=1;f<=i;f++){const v=(i+1)*m+f-1,g=(i+1)*(m-1)+f-1,b=(i+1)*(m-1)+f,S=(i+1)*m+f;s.push(v,g,S),s.push(g,b,S)}this.setIndex(s),this.setAttribute("position",new ur(a,3)),this.setAttribute("normal",new ur(l,3)),this.setAttribute("uv",new ur(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wb(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class PE extends cr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new _t(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}const qg=new at,rw=new te,iw=new te;class FV{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ut(512,512),this.map=null,this.mapPass=null,this.matrix=new at,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new zb,this._frameExtents=new Ut(1,1),this._viewportCount=1,this._viewports=[new lr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;rw.setFromMatrixPosition(e.matrixWorld),t.position.copy(rw),iw.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(iw),t.updateMatrixWorld(),qg.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(qg),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(qg)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class OV extends FV{constructor(){super(new gd(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class kV extends PE{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(cr.DEFAULT_UP),this.updateMatrix(),this.target=new cr,this.shadow=new OV}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class BV extends PE{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}const ow=new at,sw=new at,Sa=new at;class NV{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new qr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new qr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Sa.copy(e.projectionMatrix);const i=t.eyeSep/2,o=i*t.near/t.focus,s=t.near*Math.tan(Af*t.fov*.5)/t.zoom;let a,l;sw.elements[12]=-i,ow.elements[12]=i,a=-s*t.aspect+o,l=s*t.aspect+o,Sa.elements[0]=2*t.near/(l-a),Sa.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(Sa),a=-s*t.aspect-o,l=s*t.aspect-o,Sa.elements[0]=2*t.near/(l-a),Sa.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(Sa)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(sw),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(ow)}}class pp{constructor(e){this.value=e}clone(){return new pp(this.value.clone===void 0?this.value:this.value.clone())}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ob}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ob);var mp={exports:{}};mp.exports;(function(n,e){/**
 * @license
 *
 * chroma.js - JavaScript library for color conversions
 * 
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */(function(){var t,r,i,o,s,a,l,c,u,d,h,m,f,v,g,b,S,p,y,w,x,_,A,C,T,I,M,P,E,R,B,L,F,H,$,O,k,X,ie,ne,Q,ce,Z,re,se,fe,ue,U,K,be,me,le,xe,pe,ye,Me,Ce,z,D,q,_e,ve,Re,ze,Le,Ve,Ze,ut,Ne,ct,he,Ae,Fe,ke,We,ee,Ie,Se,Ee,Ge,ft,Rt,St=[].slice;Se=function(){var N,j,Y,oe,de;for(N={},de="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),oe=0,j=de.length;oe<j;oe++)Y=de[oe],N["[object "+Y+"]"]=Y.toLowerCase();return function(G){var ae;return ae=Object.prototype.toString.call(G),N[ae]||"object"}}(),ue=function(N,j,Y){return j==null&&(j=0),Y==null&&(Y=1),N<j&&(N=j),N>Y&&(N=Y),N},Ee=function(N){return N.length>=3?Array.prototype.slice.call(N):N[0]},x=function(N){var j,Y;for(N._clipped=!1,N._unclipped=N.slice(0),j=Y=0;Y<3;j=++Y)j<3?((N[j]<0||N[j]>255)&&(N._clipped=!0),N[j]<0&&(N[j]=0),N[j]>255&&(N[j]=255)):j===3&&(N[j]<0&&(N[j]=0),N[j]>1&&(N[j]=1));return N._clipped||delete N._unclipped,N},o=Math.PI,Fe=Math.round,A=Math.cos,P=Math.floor,Me=Math.pow,U=Math.log,We=Math.sin,ee=Math.sqrt,v=Math.atan2,me=Math.max,f=Math.abs,l=o*2,s=o/3,r=o/180,a=180/o,w=function(){return arguments[0]instanceof t?arguments[0]:function(N,j,Y){Y.prototype=N.prototype;var oe=new Y,de=N.apply(oe,j);return Object(de)===de?de:oe}(t,arguments,function(){})},w.default=w,m=[],n!==null&&n.exports!=null&&(n.exports=w),Ae=e!==null?e:this,Ae.chroma=w,w.version="1.4.1",h={},u=[],d=!1,t=function(){function N(){var j,Y,oe,de,G,ae,we,He,qe;for(ae=this,Y=[],He=0,de=arguments.length;He<de;He++)j=arguments[He],j!=null&&Y.push(j);if(Y.length>1&&(we=Y[Y.length-1]),h[we]!=null)ae._rgb=x(h[we](Ee(Y.slice(0,-1))));else{for(d||(u=u.sort(function(Qe,vt){return vt.p-Qe.p}),d=!0),qe=0,G=u.length;qe<G&&(oe=u[qe],we=oe.test.apply(oe,Y),!we);qe++);we&&(ae._rgb=x(h[we].apply(h,Y)))}ae._rgb==null&&console.warn("unknown format: "+Y),ae._rgb==null&&(ae._rgb=[0,0,0]),ae._rgb.length===3&&ae._rgb.push(1)}return N.prototype.toString=function(){return this.hex()},N}(),w._input=h;/**
	ColorBrewer colors for chroma.js

	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
	Pennsylvania State University.

	Licensed under the Apache License, Version 2.0 (the "License"); 
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at	
	http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software distributed
	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
	CONDITIONS OF ANY KIND, either express or implied. See the License for the
	specific language governing permissions and limitations under the License.

    @preserve
 */w.brewer=p={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var N,j;j=[];for(N in p)j.push(p[N.toLowerCase()]=p[N]);return j}(),Ge={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},w.colors=Ge,ce=function(){var N,j,Y,oe,de,G,ae,we,He;return j=Ee(arguments),de=j[0],N=j[1],Y=j[2],we=(de+16)/116,ae=isNaN(N)?we:we+N/500,He=isNaN(Y)?we:we-Y/200,we=i.Yn*Z(we),ae=i.Xn*Z(ae),He=i.Zn*Z(He),G=Rt(3.2404542*ae-1.5371385*we-.4985314*He),oe=Rt(-.969266*ae+1.8760108*we+.041556*He),Y=Rt(.0556434*ae-.2040259*we+1.0572252*He),[G,oe,Y,j.length>3?j[3]:1]},Rt=function(N){return 255*(N<=.00304?12.92*N:1.055*Me(N,1/2.4)-.055)},Z=function(N){return N>i.t1?N*N*N:i.t2*(N-i.t0)},i={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},ze=function(){var N,j,Y,oe,de,G,ae,we;return oe=Ee(arguments),Y=oe[0],j=oe[1],N=oe[2],de=Ne(Y,j,N),G=de[0],ae=de[1],we=de[2],[116*ae-16,500*(G-ae),200*(ae-we)]},ct=function(N){return(N/=255)<=.04045?N/12.92:Me((N+.055)/1.055,2.4)},ft=function(N){return N>i.t3?Me(N,1/3):N/i.t2+i.t0},Ne=function(){var N,j,Y,oe,de,G,ae;return oe=Ee(arguments),Y=oe[0],j=oe[1],N=oe[2],Y=ct(Y),j=ct(j),N=ct(N),de=ft((.4124564*Y+.3575761*j+.1804375*N)/i.Xn),G=ft((.2126729*Y+.7151522*j+.072175*N)/i.Yn),ae=ft((.0193339*Y+.119192*j+.9503041*N)/i.Zn),[de,G,ae]},w.lab=function(){return function(N,j,Y){Y.prototype=N.prototype;var oe=new Y,de=N.apply(oe,j);return Object(de)===de?de:oe}(t,St.call(arguments).concat(["lab"]),function(){})},h.lab=ce,t.prototype.lab=function(){return ze(this._rgb)},g=function(N){var j,Y,oe,de,G,ae,we,He,qe,Qe,vt;return N=function(){var ot,et,J;for(J=[],et=0,ot=N.length;et<ot;et++)de=N[et],J.push(w(de));return J}(),N.length===2?(qe=function(){var ot,et,J;for(J=[],et=0,ot=N.length;et<ot;et++)de=N[et],J.push(de.lab());return J}(),G=qe[0],ae=qe[1],j=function(ot){var et,J;return J=function(){var Pe,Oe;for(Oe=[],et=Pe=0;Pe<=2;et=++Pe)Oe.push(G[et]+ot*(ae[et]-G[et]));return Oe}(),w.lab.apply(w,J)}):N.length===3?(Qe=function(){var ot,et,J;for(J=[],et=0,ot=N.length;et<ot;et++)de=N[et],J.push(de.lab());return J}(),G=Qe[0],ae=Qe[1],we=Qe[2],j=function(ot){var et,J;return J=function(){var Pe,Oe;for(Oe=[],et=Pe=0;Pe<=2;et=++Pe)Oe.push((1-ot)*(1-ot)*G[et]+2*(1-ot)*ot*ae[et]+ot*ot*we[et]);return Oe}(),w.lab.apply(w,J)}):N.length===4?(vt=function(){var ot,et,J;for(J=[],et=0,ot=N.length;et<ot;et++)de=N[et],J.push(de.lab());return J}(),G=vt[0],ae=vt[1],we=vt[2],He=vt[3],j=function(ot){var et,J;return J=function(){var Pe,Oe;for(Oe=[],et=Pe=0;Pe<=2;et=++Pe)Oe.push((1-ot)*(1-ot)*(1-ot)*G[et]+3*(1-ot)*(1-ot)*ot*ae[et]+3*(1-ot)*ot*ot*we[et]+ot*ot*ot*He[et]);return Oe}(),w.lab.apply(w,J)}):N.length===5&&(Y=g(N.slice(0,3)),oe=g(N.slice(2,5)),j=function(ot){return ot<.5?Y(ot*2):oe((ot-.5)*2)}),j},w.bezier=function(N){var j;return j=g(N),j.scale=function(){return w.scale(j)},j},w.cubehelix=function(N,j,Y,oe,de){var G,ae,we;return N==null&&(N=300),j==null&&(j=-1.5),Y==null&&(Y=1),oe==null&&(oe=1),de==null&&(de=[0,1]),G=0,Se(de)==="array"?ae=de[1]-de[0]:(ae=0,de=[de,de]),we=function(He){var qe,Qe,vt,ot,et,J,Pe,Oe,De;return qe=l*((N+120)/360+j*He),Pe=Me(de[0]+ae*He,oe),J=G!==0?Y[0]+He*G:Y,Qe=J*Pe*(1-Pe)/2,ot=A(qe),De=We(qe),Oe=Pe+Qe*(-.14861*ot+1.78277*De),et=Pe+Qe*(-.29227*ot-.90649*De),vt=Pe+Qe*(1.97294*ot),w(x([Oe*255,et*255,vt*255,1]))},we.start=function(He){return He==null?N:(N=He,we)},we.rotations=function(He){return He==null?j:(j=He,we)},we.gamma=function(He){return He==null?oe:(oe=He,we)},we.hue=function(He){return He==null?Y:(Y=He,Se(Y)==="array"?(G=Y[1]-Y[0],G===0&&(Y=Y[1])):G=0,we)},we.lightness=function(He){return He==null?de:(Se(He)==="array"?(de=He,ae=He[1]-He[0]):(de=[He,He],ae=0),we)},we.scale=function(){return w.scale(we)},we.hue(Y),we},w.random=function(){var N,j,Y;for(j="0123456789abcdef",N="#",Y=0;Y<6;++Y)N+=j.charAt(P(Math.random()*16));return new t(N)},m=[],$=function(N,j,Y,oe){var de,G,ae,we;for(Y==null&&(Y=.5),oe==null&&(oe="rgb"),Se(N)!=="object"&&(N=w(N)),Se(j)!=="object"&&(j=w(j)),ae=0,G=m.length;ae<G;ae++)if(de=m[ae],oe===de[0]){we=de[1](N,j,Y,oe);break}if(we==null)throw"color mode "+oe+" is not supported";return we.alpha(N.alpha()+Y*(j.alpha()-N.alpha()))},w.interpolate=$,t.prototype.interpolate=function(N,j,Y){return $(this,N,j,Y)},w.mix=$,t.prototype.mix=t.prototype.interpolate,h.rgb=function(){var N,j,Y,oe;j=Ee(arguments),Y=[];for(N in j)oe=j[N],Y.push(oe);return Y},w.rgb=function(){return function(N,j,Y){Y.prototype=N.prototype;var oe=new Y,de=N.apply(oe,j);return Object(de)===de?de:oe}(t,St.call(arguments).concat(["rgb"]),function(){})},t.prototype.rgb=function(N){return N==null&&(N=!0),N?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},t.prototype.rgba=function(N){return N==null&&(N=!0),N?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},u.push({p:3,test:function(N){var j;if(j=Ee(arguments),Se(j)==="array"&&j.length===3||j.length===4&&Se(j[3])==="number"&&j[3]>=0&&j[3]<=1)return"rgb"}}),h.lrgb=h.rgb,X=function(N,j,Y,oe){var de,G;return de=N._rgb,G=j._rgb,new t(ee(Me(de[0],2)*(1-Y)+Me(G[0],2)*Y),ee(Me(de[1],2)*(1-Y)+Me(G[1],2)*Y),ee(Me(de[2],2)*(1-Y)+Me(G[2],2)*Y),oe)},c=function(N){var j,Y,oe,de,G,ae;for(Y=1/N.length,ae=[0,0,0,0],de=0,oe=N.length;de<oe;de++)j=N[de],G=j._rgb,ae[0]+=Me(G[0],2)*Y,ae[1]+=Me(G[1],2)*Y,ae[2]+=Me(G[2],2)*Y,ae[3]+=G[3]*Y;return ae[0]=ee(ae[0]),ae[1]=ee(ae[1]),ae[2]=ee(ae[2]),ae[3]>1&&(ae[3]=1),new t(x(ae))},m.push(["lrgb",X]),w.average=function(N,j){var Y,oe,de,G,ae,we,He,qe,Qe,vt,ot,et,J;if(j==null&&(j="rgb"),Qe=N.length,N=N.map(function(Pe){return w(Pe)}),He=N.splice(0,1)[0],j==="lrgb")return c(N);et=He.get(j),G=[],ae=0,we=0;for(qe in et)et[qe]=et[qe]||0,G.push(isNaN(et[qe])?0:1),j.charAt(qe)==="h"&&!isNaN(et[qe])&&(Y=et[qe]/180*o,ae+=A(Y),we+=We(Y));for(oe=He.alpha(),ot=0,vt=N.length;ot<vt;ot++){de=N[ot],J=de.get(j),oe+=de.alpha();for(qe in et)isNaN(J[qe])||(G[qe]+=1,j.charAt(qe)==="h"?(Y=J[qe]/180*o,ae+=A(Y),we+=We(Y)):et[qe]+=J[qe])}for(qe in et)if(j.charAt(qe)==="h"){for(Y=v(we/G[qe],ae/G[qe])/o*180;Y<0;)Y+=360;for(;Y>=360;)Y-=360;et[qe]=Y}else et[qe]=et[qe]/G[qe];return w(et,j).alpha(oe/Qe)},R=function(N){var j,Y,oe,de,G,ae;if(N.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(N.length===4||N.length===7)&&(N=N.substr(1)),N.length===3&&(N=N.split(""),N=N[0]+N[0]+N[1]+N[1]+N[2]+N[2]),ae=parseInt(N,16),de=ae>>16,oe=ae>>8&255,Y=ae&255,[de,oe,Y,1];if(N.match(/^#?([A-Fa-f0-9]{8})$/))return N.length===9&&(N=N.substr(1)),ae=parseInt(N,16),de=ae>>24&255,oe=ae>>16&255,Y=ae>>8&255,j=Fe((ae&255)/255*100)/100,[de,oe,Y,j];if(h.css!=null&&(G=h.css(N)))return G;throw"unknown color: "+N},q=function(N,j){var Y,oe,de,G,ae,we,He;return j==null&&(j="auto"),ae=N[0],de=N[1],oe=N[2],Y=N[3],j==="auto"&&(j=Y<1?"rgba":"rgb"),ae=Math.round(ae),de=Math.round(de),oe=Math.round(oe),He=ae<<16|de<<8|oe,we="000000"+He.toString(16),we=we.substr(we.length-6),G="0"+Fe(Y*255).toString(16),G=G.substr(G.length-2),"#"+function(){switch(j.toLowerCase()){case"rgba":return we+G;case"argb":return G+we;default:return we}}()},h.hex=function(N){return R(N)},w.hex=function(){return function(N,j,Y){Y.prototype=N.prototype;var oe=new Y,de=N.apply(oe,j);return Object(de)===de?de:oe}(t,St.call(arguments).concat(["hex"]),function(){})},t.prototype.hex=function(N){return N==null&&(N="auto"),q(this._rgb,N)},u.push({p:4,test:function(N){if(arguments.length===1&&Se(N)==="string")return"hex"}}),F=function(){var N,j,Y,oe,de,G,ae,we,He,qe,Qe,vt,ot,et;if(N=Ee(arguments),de=N[0],Qe=N[1],ae=N[2],Qe===0)He=oe=j=ae*255;else{for(et=[0,0,0],Y=[0,0,0],ot=ae<.5?ae*(1+Qe):ae+Qe-ae*Qe,vt=2*ae-ot,de/=360,et[0]=de+1/3,et[1]=de,et[2]=de-1/3,G=we=0;we<=2;G=++we)et[G]<0&&(et[G]+=1),et[G]>1&&(et[G]-=1),6*et[G]<1?Y[G]=vt+(ot-vt)*6*et[G]:2*et[G]<1?Y[G]=ot:3*et[G]<2?Y[G]=vt+(ot-vt)*(2/3-et[G])*6:Y[G]=vt;qe=[Fe(Y[0]*255),Fe(Y[1]*255),Fe(Y[2]*255)],He=qe[0],oe=qe[1],j=qe[2]}return N.length>3?[He,oe,j,N[3]]:[He,oe,j]},ve=function(N,j,Y){var oe,de,G,ae,we;return N!==void 0&&N.length>=3&&(ae=N,N=ae[0],j=ae[1],Y=ae[2]),N/=255,j/=255,Y/=255,G=Math.min(N,j,Y),me=Math.max(N,j,Y),de=(me+G)/2,me===G?(we=0,oe=Number.NaN):we=de<.5?(me-G)/(me+G):(me-G)/(2-me-G),N===me?oe=(j-Y)/(me-G):j===me?oe=2+(Y-N)/(me-G):Y===me&&(oe=4+(N-j)/(me-G)),oe*=60,oe<0&&(oe+=360),[oe,we,de]},w.hsl=function(){return function(N,j,Y){Y.prototype=N.prototype;var oe=new Y,de=N.apply(oe,j);return Object(de)===de?de:oe}(t,St.call(arguments).concat(["hsl"]),function(){})},h.hsl=F,t.prototype.hsl=function(){return ve(this._rgb)},H=function(){var N,j,Y,oe,de,G,ae,we,He,qe,Qe,vt,ot,et,J,Pe,Oe,De;if(N=Ee(arguments),de=N[0],Pe=N[1],De=N[2],De*=255,Pe===0)He=oe=j=De;else switch(de===360&&(de=0),de>360&&(de-=360),de<0&&(de+=360),de/=60,G=P(de),Y=de-G,ae=De*(1-Pe),we=De*(1-Pe*Y),Oe=De*(1-Pe*(1-Y)),G){case 0:qe=[De,Oe,ae],He=qe[0],oe=qe[1],j=qe[2];break;case 1:Qe=[we,De,ae],He=Qe[0],oe=Qe[1],j=Qe[2];break;case 2:vt=[ae,De,Oe],He=vt[0],oe=vt[1],j=vt[2];break;case 3:ot=[ae,we,De],He=ot[0],oe=ot[1],j=ot[2];break;case 4:et=[Oe,ae,De],He=et[0],oe=et[1],j=et[2];break;case 5:J=[De,ae,we],He=J[0],oe=J[1],j=J[2]}return[He,oe,j,N.length>3?N[3]:1]},Re=function(){var N,j,Y,oe,de,G,ae,we,He;return ae=Ee(arguments),G=ae[0],Y=ae[1],N=ae[2],de=Math.min(G,Y,N),me=Math.max(G,Y,N),j=me-de,He=me/255,me===0?(oe=Number.NaN,we=0):(we=j/me,G===me&&(oe=(Y-N)/j),Y===me&&(oe=2+(N-G)/j),N===me&&(oe=4+(G-Y)/j),oe*=60,oe<0&&(oe+=360)),[oe,we,He]},w.hsv=function(){return function(N,j,Y){Y.prototype=N.prototype;var oe=new Y,de=N.apply(oe,j);return Object(de)===de?de:oe}(t,St.call(arguments).concat(["hsv"]),function(){})},h.hsv=H,t.prototype.hsv=function(){return Re(this._rgb)},pe=function(N){var j,Y,oe;return Se(N)==="number"&&N>=0&&N<=16777215?(oe=N>>16,Y=N>>8&255,j=N&255,[oe,Y,j,1]):(console.warn("unknown num color: "+N),[0,0,0,1])},Ze=function(){var N,j,Y,oe;return oe=Ee(arguments),Y=oe[0],j=oe[1],N=oe[2],(Y<<16)+(j<<8)+N},w.num=function(N){return new t(N,"num")},t.prototype.num=function(N){return N==null&&(N="rgb"),Ze(this._rgb,N)},h.num=pe,u.push({p:1,test:function(N){if(arguments.length===1&&Se(N)==="number"&&N>=0&&N<=16777215)return"num"}}),E=function(){var N,j,Y,oe,de,G,ae,we,He,qe,Qe,vt,ot,et,J,Pe,Oe,De,$e,it;if(Y=Ee(arguments),we=Y[0],de=Y[1],j=Y[2],de=de/100,ae=ae/100*255,N=de*255,de===0)vt=ae=oe=j;else switch(we===360&&(we=0),we>360&&(we-=360),we<0&&(we+=360),we/=60,He=P(we),G=we-He,qe=j*(1-de),Qe=qe+N*(1-G),$e=qe+N*G,it=qe+N,He){case 0:ot=[it,$e,qe],vt=ot[0],ae=ot[1],oe=ot[2];break;case 1:et=[Qe,it,qe],vt=et[0],ae=et[1],oe=et[2];break;case 2:J=[qe,it,$e],vt=J[0],ae=J[1],oe=J[2];break;case 3:Pe=[qe,Qe,it],vt=Pe[0],ae=Pe[1],oe=Pe[2];break;case 4:Oe=[$e,qe,it],vt=Oe[0],ae=Oe[1],oe=Oe[2];break;case 5:De=[it,qe,Qe],vt=De[0],ae=De[1],oe=De[2]}return[vt,ae,oe,Y.length>3?Y[3]:1]},D=function(){var N,j,Y,oe,de,G,ae,we,He;return He=Ee(arguments),we=He[0],de=He[1],j=He[2],ae=Math.min(we,de,j),me=Math.max(we,de,j),oe=me-ae,Y=oe*100/255,N=ae/(255-oe)*100,oe===0?G=Number.NaN:(we===me&&(G=(de-j)/oe),de===me&&(G=2+(j-we)/oe),j===me&&(G=4+(we-de)/oe),G*=60,G<0&&(G+=360)),[G,Y,N]},w.hcg=function(){return function(N,j,Y){Y.prototype=N.prototype;var oe=new Y,de=N.apply(oe,j);return Object(de)===de?de:oe}(t,St.call(arguments).concat(["hcg"]),function(){})},h.hcg=E,t.prototype.hcg=function(){return D(this._rgb)},C=function(N){var j,Y,oe,de,G,ae,we,He;if(N=N.toLowerCase(),w.colors!=null&&w.colors[N])return R(w.colors[N]);if(G=N.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(we=G.slice(1,4),de=ae=0;ae<=2;de=++ae)we[de]=+we[de];we[3]=1}else if(G=N.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(we=G.slice(1,5),de=He=0;He<=3;de=++He)we[de]=+we[de];else if(G=N.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(we=G.slice(1,4),de=j=0;j<=2;de=++j)we[de]=Fe(we[de]*2.55);we[3]=1}else if(G=N.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(we=G.slice(1,5),de=Y=0;Y<=2;de=++Y)we[de]=Fe(we[de]*2.55);we[3]=+we[3]}else(G=N.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(oe=G.slice(1,4),oe[1]*=.01,oe[2]*=.01,we=F(oe),we[3]=1):(G=N.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(oe=G.slice(1,4),oe[1]*=.01,oe[2]*=.01,we=F(oe),we[3]=+G[4]);return we},z=function(N){var j;if(j=N[3]<1?"rgba":"rgb",j==="rgb")return j+"("+N.slice(0,3).map(Fe).join(",")+")";if(j==="rgba")return j+"("+N.slice(0,3).map(Fe).join(",")+","+N[3]+")"},he=function(N){return Fe(N*100)/100},L=function(N,j){var Y;return Y=j<1?"hsla":"hsl",N[0]=he(N[0]||0),N[1]=he(N[1]*100)+"%",N[2]=he(N[2]*100)+"%",Y==="hsla"&&(N[3]=j),Y+"("+N.join(",")+")"},h.css=function(N){return C(N)},w.css=function(){return function(N,j,Y){Y.prototype=N.prototype;var oe=new Y,de=N.apply(oe,j);return Object(de)===de?de:oe}(t,St.call(arguments).concat(["css"]),function(){})},t.prototype.css=function(N){if(N==null&&(N="rgb"),N.slice(0,3)==="rgb")return z(this._rgb);if(N.slice(0,3)==="hsl")return L(this.hsl(),this.alpha())},h.named=function(N){return R(Ge[N])},u.push({p:5,test:function(N){if(arguments.length===1&&Ge[N]!=null)return"named"}}),t.prototype.name=function(N){var j,Y;arguments.length&&(Ge[N]&&(this._rgb=R(Ge[N])),this._rgb[3]=1),j=this.hex("rgb");for(Y in Ge)if(j===Ge[Y])return Y;return j},re=function(){var N,j,Y,oe;return oe=Ee(arguments),Y=oe[0],N=oe[1],j=oe[2],j=j*r,[Y,A(j)*N,We(j)*N]},se=function(){var N,j,Y,oe,de,G,ae,we,He,qe,Qe;return Y=Ee(arguments),we=Y[0],de=Y[1],ae=Y[2],qe=re(we,de,ae),N=qe[0],j=qe[1],oe=qe[2],Qe=ce(N,j,oe),He=Qe[0],G=Qe[1],oe=Qe[2],[He,G,oe,Y.length>3?Y[3]:1]},Q=function(){var N,j,Y,oe,de,G;return G=Ee(arguments),de=G[0],N=G[1],j=G[2],Y=ee(N*N+j*j),oe=(v(j,N)*a+360)%360,Fe(Y*1e4)===0&&(oe=Number.NaN),[de,Y,oe]},Le=function(){var N,j,Y,oe,de,G,ae;return G=Ee(arguments),de=G[0],Y=G[1],j=G[2],ae=ze(de,Y,j),oe=ae[0],N=ae[1],j=ae[2],Q(oe,N,j)},w.lch=function(){var N;return N=Ee(arguments),new t(N,"lch")},w.hcl=function(){var N;return N=Ee(arguments),new t(N,"hcl")},h.lch=se,h.hcl=function(){var N,j,Y,oe;return oe=Ee(arguments),j=oe[0],N=oe[1],Y=oe[2],se([Y,N,j])},t.prototype.lch=function(){return Le(this._rgb)},t.prototype.hcl=function(){return Le(this._rgb).reverse()},Ce=function(N){var j,Y,oe,de,G,ae,we,He,qe;return N==null&&(N="rgb"),He=Ee(arguments),we=He[0],de=He[1],j=He[2],we=we/255,de=de/255,j=j/255,G=1-Math.max(we,Math.max(de,j)),oe=G<1?1/(1-G):0,Y=(1-we-G)*oe,ae=(1-de-G)*oe,qe=(1-j-G)*oe,[Y,ae,qe,G]},_=function(){var N,j,Y,oe,de,G,ae,we,He;return j=Ee(arguments),oe=j[0],ae=j[1],He=j[2],G=j[3],N=j.length>4?j[4]:1,G===1?[0,0,0,N]:(we=oe>=1?0:255*(1-oe)*(1-G),de=ae>=1?0:255*(1-ae)*(1-G),Y=He>=1?0:255*(1-He)*(1-G),[we,de,Y,N])},h.cmyk=function(){return _(Ee(arguments))},w.cmyk=function(){return function(N,j,Y){Y.prototype=N.prototype;var oe=new Y,de=N.apply(oe,j);return Object(de)===de?de:oe}(t,St.call(arguments).concat(["cmyk"]),function(){})},t.prototype.cmyk=function(){return Ce(this._rgb)},h.gl=function(){var N,j,Y,oe,de;for(oe=(function(){var G,ae;G=Ee(arguments),ae=[];for(j in G)de=G[j],ae.push(de);return ae}).apply(this,arguments),N=Y=0;Y<=2;N=++Y)oe[N]*=255;return oe},w.gl=function(){return function(N,j,Y){Y.prototype=N.prototype;var oe=new Y,de=N.apply(oe,j);return Object(de)===de?de:oe}(t,St.call(arguments).concat(["gl"]),function(){})},t.prototype.gl=function(){var N;return N=this._rgb,[N[0]/255,N[1]/255,N[2]/255,N[3]]},Ve=function(N,j,Y){var oe;return oe=Ee(arguments),N=oe[0],j=oe[1],Y=oe[2],N=K(N),j=K(j),Y=K(Y),.2126*N+.7152*j+.0722*Y},K=function(N){return N/=255,N<=.03928?N/12.92:Me((N+.055)/1.055,2.4)},ne=function(N,j,Y,oe){var de,G;return de=N._rgb,G=j._rgb,new t(de[0]+Y*(G[0]-de[0]),de[1]+Y*(G[1]-de[1]),de[2]+Y*(G[2]-de[2]),oe)},m.push(["rgb",ne]),t.prototype.luminance=function(N,j){var Y,oe,de,G,ae;return j==null&&(j="rgb"),arguments.length?(G=this._rgb,N===0?G=[0,0,0,this._rgb[3]]:N===1?G=[255,255,255,this[3]]:(Y=Ve(this._rgb),oe=1e-7,de=20,ae=function(we,He){var qe,Qe;return Qe=we.interpolate(He,.5,j),qe=Qe.luminance(),Math.abs(N-qe)<oe||!de--?Qe:qe>N?ae(we,Qe):ae(Qe,He)},Y>N?G=ae(w("black"),this).rgba():G=ae(this,w("white")).rgba()),w(G).alpha(this.alpha())):Ve(this._rgb)},Ie=function(N){var j,Y,oe,de;return de=N/100,de<66?(oe=255,Y=-155.25485562709179-.44596950469579133*(Y=de-2)+104.49216199393888*U(Y),j=de<20?0:-254.76935184120902+.8274096064007395*(j=de-10)+115.67994401066147*U(j)):(oe=351.97690566805693+.114206453784165*(oe=de-55)-40.25366309332127*U(oe),Y=325.4494125711974+.07943456536662342*(Y=de-50)-28.0852963507957*U(Y),j=255),[oe,Y,j]},ut=function(){var N,j,Y,oe,de,G,ae,we;for(G=Ee(arguments),de=G[0],G[1],N=G[2],oe=1e3,Y=4e4,j=.4;Y-oe>j;)we=(Y+oe)*.5,ae=Ie(we),ae[2]/ae[0]>=N/de?Y=we:oe=we;return Fe(we)},w.temperature=w.kelvin=function(){return function(N,j,Y){Y.prototype=N.prototype;var oe=new Y,de=N.apply(oe,j);return Object(de)===de?de:oe}(t,St.call(arguments).concat(["temperature"]),function(){})},h.temperature=h.kelvin=h.K=Ie,t.prototype.temperature=function(){return ut(this._rgb)},t.prototype.kelvin=t.prototype.temperature,w.contrast=function(N,j){var Y,oe,de,G;return((de=Se(N))==="string"||de==="number")&&(N=new t(N)),((G=Se(j))==="string"||G==="number")&&(j=new t(j)),Y=N.luminance(),oe=j.luminance(),Y>oe?(Y+.05)/(oe+.05):(oe+.05)/(Y+.05)},w.distance=function(N,j,Y){var oe,de,G,ae,we,He,qe;Y==null&&(Y="lab"),((we=Se(N))==="string"||we==="number")&&(N=new t(N)),((He=Se(j))==="string"||He==="number")&&(j=new t(j)),G=N.get(Y),ae=j.get(Y),qe=0;for(de in G)oe=(G[de]||0)-(ae[de]||0),qe+=oe*oe;return Math.sqrt(qe)},w.deltaE=function(N,j,Y,oe){var de,G,ae,we,He,qe,Qe,vt,ot,et,J,Pe,Oe,De,$e,it,mt,bt,lt,Ue,nt,dt,Ct,yt,At,Dt,Tt;for(Y==null&&(Y=1),oe==null&&(oe=1),((mt=Se(N))==="string"||mt==="number")&&(N=new t(N)),((bt=Se(j))==="string"||bt==="number")&&(j=new t(j)),lt=N.lab(),de=lt[0],ae=lt[1],He=lt[2],Ue=j.lab(),G=Ue[0],we=Ue[1],qe=Ue[2],Qe=ee(ae*ae+He*He),vt=ee(we*we+qe*qe),Ct=de<16?.511:.040975*de/(1+.01765*de),nt=.0638*Qe/(1+.0131*Qe)+.638,it=Qe<1e-6?0:v(He,ae)*180/o;it<0;)it+=360;for(;it>=360;)it-=360;return yt=it>=164&&it<=345?.56+f(.2*A(o*(it+168)/180)):.36+f(.4*A(o*(it+35)/180)),ot=Qe*Qe*Qe*Qe,$e=ee(ot/(ot+1900)),dt=nt*($e*yt+1-$e),De=de-G,Oe=Qe-vt,J=ae-we,Pe=He-qe,et=J*J+Pe*Pe-Oe*Oe,At=De/(Y*Ct),Dt=Oe/(oe*nt),Tt=dt,ee(At*At+Dt*Dt+et/(Tt*Tt))},t.prototype.get=function(N){var j,Y,oe,de,G,ae;return oe=this,G=N.split("."),de=G[0],j=G[1],ae=oe[de](),j?(Y=de.indexOf(j),Y>-1?ae[Y]:console.warn("unknown channel "+j+" in mode "+de)):ae},t.prototype.set=function(N,j){var Y,oe,de,G,ae,we;if(de=this,ae=N.split("."),G=ae[0],Y=ae[1],Y)if(we=de[G](),oe=G.indexOf(Y),oe>-1)if(Se(j)==="string")switch(j.charAt(0)){case"+":we[oe]+=+j;break;case"-":we[oe]+=+j;break;case"*":we[oe]*=+j.substr(1);break;case"/":we[oe]/=+j.substr(1);break;default:we[oe]=+j}else we[oe]=j;else console.warn("unknown channel "+Y+" in mode "+G);else we=j;return w(we,G).alpha(de.alpha())},t.prototype.clipped=function(){return this._rgb._clipped||!1},t.prototype.alpha=function(N){return arguments.length?w.rgb([this._rgb[0],this._rgb[1],this._rgb[2],N]):this._rgb[3]},t.prototype.darken=function(N){var j,Y;return N==null&&(N=1),Y=this,j=Y.lab(),j[0]-=i.Kn*N,w.lab(j).alpha(Y.alpha())},t.prototype.brighten=function(N){return N==null&&(N=1),this.darken(-N)},t.prototype.darker=t.prototype.darken,t.prototype.brighter=t.prototype.brighten,t.prototype.saturate=function(N){var j,Y;return N==null&&(N=1),Y=this,j=Y.lch(),j[1]+=N*i.Kn,j[1]<0&&(j[1]=0),w.lch(j).alpha(Y.alpha())},t.prototype.desaturate=function(N){return N==null&&(N=1),this.saturate(-N)},t.prototype.premultiply=function(){var N,j;return j=this.rgb(),N=this.alpha(),w(j[0]*N,j[1]*N,j[2]*N,N)},b=function(N,j,Y){if(!b[Y])throw"unknown blend mode "+Y;return b[Y](N,j)},S=function(N){return function(j,Y){var oe,de;return oe=w(Y).rgb(),de=w(j).rgb(),w(N(oe,de),"rgb")}},M=function(N){return function(j,Y){var oe,de,G;for(G=[],oe=de=0;de<=3;oe=++de)G[oe]=N(j[oe],Y[oe]);return G}},xe=function(N,j){return N},le=function(N,j){return N*j/255},T=function(N,j){return N>j?j:N},fe=function(N,j){return N>j?N:j},ke=function(N,j){return 255*(1-(1-N/255)*(1-j/255))},ye=function(N,j){return j<128?2*N*j/255:255*(1-2*(1-N/255)*(1-j/255))},y=function(N,j){return 255*(1-(1-j/255)/(N/255))},I=function(N,j){return N===255||(N=255*(j/255)/(1-N/255),N>255)?255:N},b.normal=S(M(xe)),b.multiply=S(M(le)),b.screen=S(M(ke)),b.overlay=S(M(ye)),b.darken=S(M(T)),b.lighten=S(M(fe)),b.dodge=S(M(I)),b.burn=S(M(y)),w.blend=b,w.analyze=function(N){var j,Y,oe,de;for(oe={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},Y=0,j=N.length;Y<j;Y++)de=N[Y],de!=null&&!isNaN(de)&&(oe.values.push(de),oe.sum+=de,de<oe.min&&(oe.min=de),de>oe.max&&(oe.max=de),oe.count+=1);return oe.domain=[oe.min,oe.max],oe.limits=function(G,ae){return w.limits(oe,G,ae)},oe},w.scale=function(N,j){var Y,oe,de,G,ae,we,He,qe,Qe,vt,ot,et,J,Pe,Oe,De,$e,it,mt,bt,lt;return Qe="rgb",vt=w("#ccc"),Pe=0,ae=[0,1],J=[],et=[0,0],Y=!1,de=[],ot=!1,qe=0,He=1,G=!1,oe={},Oe=!0,we=1,bt=function(Ue){var nt,dt,Ct,yt,At,Dt;if(Ue==null&&(Ue=["#fff","#000"]),Ue!=null&&Se(Ue)==="string"&&w.brewer!=null&&(Ue=w.brewer[Ue]||w.brewer[Ue.toLowerCase()]||Ue),Se(Ue)==="array"){for(Ue.length===1&&(Ue=[Ue[0],Ue[0]]),Ue=Ue.slice(0),nt=Ct=0,yt=Ue.length-1;0<=yt?Ct<=yt:Ct>=yt;nt=0<=yt?++Ct:--Ct)dt=Ue[nt],Se(dt)==="string"&&(Ue[nt]=w(dt));for(J.length=0,nt=Dt=0,At=Ue.length-1;0<=At?Dt<=At:Dt>=At;nt=0<=At?++Dt:--Dt)J.push(nt/(Ue.length-1))}return mt(),de=Ue},$e=function(Ue){var nt,dt;if(Y!=null){for(dt=Y.length-1,nt=0;nt<dt&&Ue>=Y[nt];)nt++;return nt-1}return 0},lt=function(Ue){return Ue},it=function(Ue,nt){var dt,Ct,yt,At,Dt,Tt,Mt,kt;if(nt==null&&(nt=!1),isNaN(Ue)||Ue===null)return vt;if(nt?kt=Ue:Y&&Y.length>2?(dt=$e(Ue),kt=dt/(Y.length-2)):He!==qe?kt=(Ue-qe)/(He-qe):kt=1,nt||(kt=lt(kt)),we!==1&&(kt=Me(kt,we)),kt=et[0]+kt*(1-et[0]-et[1]),kt=Math.min(1,Math.max(0,kt)),At=Math.floor(kt*1e4),Oe&&oe[At])Ct=oe[At];else{if(Se(de)==="array")for(yt=Dt=0,Mt=J.length-1;0<=Mt?Dt<=Mt:Dt>=Mt;yt=0<=Mt?++Dt:--Dt){if(Tt=J[yt],kt<=Tt){Ct=de[yt];break}if(kt>=Tt&&yt===J.length-1){Ct=de[yt];break}if(kt>Tt&&kt<J[yt+1]){kt=(kt-Tt)/(J[yt+1]-Tt),Ct=w.interpolate(de[yt],de[yt+1],kt,Qe);break}}else Se(de)==="function"&&(Ct=de(kt));Oe&&(oe[At]=Ct)}return Ct},mt=function(){return oe={}},bt(N),De=function(Ue){var nt;return nt=w(it(Ue)),ot&&nt[ot]?nt[ot]():nt},De.classes=function(Ue){var nt;return Ue!=null?(Se(Ue)==="array"?(Y=Ue,ae=[Ue[0],Ue[Ue.length-1]]):(nt=w.analyze(ae),Ue===0?Y=[nt.min,nt.max]:Y=w.limits(nt,"e",Ue)),De):Y},De.domain=function(Ue){var nt,dt,Ct,yt,At,Dt,Tt;if(!arguments.length)return ae;if(qe=Ue[0],He=Ue[Ue.length-1],J=[],Ct=de.length,Ue.length===Ct&&qe!==He)for(At=0,yt=Ue.length;At<yt;At++)dt=Ue[At],J.push((dt-qe)/(He-qe));else for(nt=Tt=0,Dt=Ct-1;0<=Dt?Tt<=Dt:Tt>=Dt;nt=0<=Dt?++Tt:--Tt)J.push(nt/(Ct-1));return ae=[qe,He],De},De.mode=function(Ue){return arguments.length?(Qe=Ue,mt(),De):Qe},De.range=function(Ue,nt){return bt(Ue,nt),De},De.out=function(Ue){return ot=Ue,De},De.spread=function(Ue){return arguments.length?(Pe=Ue,De):Pe},De.correctLightness=function(Ue){return Ue==null&&(Ue=!0),G=Ue,mt(),G?lt=function(nt){var dt,Ct,yt,At,Dt,Tt,Mt,kt,$t;for(dt=it(0,!0).lab()[0],Ct=it(1,!0).lab()[0],Mt=dt>Ct,yt=it(nt,!0).lab()[0],Dt=dt+(Ct-dt)*nt,At=yt-Dt,kt=0,$t=1,Tt=20;Math.abs(At)>.01&&Tt-- >0;)(function(){return Mt&&(At*=-1),At<0?(kt=nt,nt+=($t-nt)*.5):($t=nt,nt+=(kt-nt)*.5),yt=it(nt,!0).lab()[0],At=yt-Dt})();return nt}:lt=function(nt){return nt},De},De.padding=function(Ue){return Ue!=null?(Se(Ue)==="number"&&(Ue=[Ue,Ue]),et=Ue,De):et},De.colors=function(Ue,nt){var dt,Ct,yt,At,Dt,Tt,Mt,kt;if(arguments.length<2&&(nt="hex"),Dt=[],arguments.length===0)Dt=de.slice(0);else if(Ue===1)Dt=[De(.5)];else if(Ue>1)Ct=ae[0],dt=ae[1]-Ct,Dt=(function(){Tt=[];for(var $t=0;0<=Ue?$t<Ue:$t>Ue;0<=Ue?$t++:$t--)Tt.push($t);return Tt}).apply(this).map(function($t){return De(Ct+$t/(Ue-1)*dt)});else{if(N=[],Mt=[],Y&&Y.length>2)for(yt=kt=1,At=Y.length;1<=At?kt<At:kt>At;yt=1<=At?++kt:--kt)Mt.push((Y[yt-1]+Y[yt])*.5);else Mt=ae;Dt=Mt.map(function($t){return De($t)})}return w[nt]&&(Dt=Dt.map(function($t){return $t[nt]()})),Dt},De.cache=function(Ue){return Ue!=null?(Oe=Ue,De):Oe},De.gamma=function(Ue){return Ue!=null?(we=Ue,De):we},De.nodata=function(Ue){return Ue!=null?(vt=w(Ue),De):vt},De},w.scales==null&&(w.scales={}),w.scales.cool=function(){return w.scale([w.hsl(180,1,.9),w.hsl(250,.7,.4)])},w.scales.hot=function(){return w.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},w.analyze=function(N,j,Y){var oe,de,G,ae,we,He,qe;if(we={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},Y==null&&(Y=function(){return!0}),oe=function(Qe){Qe!=null&&!isNaN(Qe)&&(we.values.push(Qe),we.sum+=Qe,Qe<we.min&&(we.min=Qe),Qe>we.max&&(we.max=Qe),we.count+=1)},qe=function(Qe,vt){if(Y(Qe,vt))return j!=null&&Se(j)==="function"?oe(j(Qe)):j!=null&&Se(j)==="string"||Se(j)==="number"?oe(Qe[j]):oe(Qe)},Se(N)==="array")for(ae=0,G=N.length;ae<G;ae++)He=N[ae],qe(He);else for(de in N)He=N[de],qe(He,de);return we.domain=[we.min,we.max],we.limits=function(Qe,vt){return w.limits(we,Qe,vt)},we},w.limits=function(N,j,Y){var oe,de,G,ae,we,He,qe,Qe,vt,ot,et,J,Pe,Oe,De,$e,it,mt,bt,lt,Ue,nt,dt,Ct,yt,At,Dt,Tt,Mt,kt,$t,Ur,Pi,Ri,Ii,Fn,Pr,Di,Hn,Li,yl,to,aa,la,ca,ua,da,ha,fa,pa,no,_l,_y,ro,Kc;if(j==null&&(j="equal"),Y==null&&(Y=7),Se(N)==="array"&&(N=w.analyze(N)),yt=N.min,me=N.max,N.sum,ro=N.values.sort(function(Im,Dm){return Im-Dm}),Y===1)return[yt,me];if(dt=[],j.substr(0,1)==="c"&&(dt.push(yt),dt.push(me)),j.substr(0,1)==="e"){for(dt.push(yt),lt=$t=1,Ii=Y-1;1<=Ii?$t<=Ii:$t>=Ii;lt=1<=Ii?++$t:--$t)dt.push(yt+lt/Y*(me-yt));dt.push(me)}else if(j.substr(0,1)==="l"){if(yt<=0)throw"Logarithmic scales are only possible for values > 0";for(At=Math.LOG10E*U(yt),Ct=Math.LOG10E*U(me),dt.push(yt),lt=Kc=1,Fn=Y-1;1<=Fn?Kc<=Fn:Kc>=Fn;lt=1<=Fn?++Kc:--Kc)dt.push(Me(10,At+lt/Y*(Ct-At)));dt.push(me)}else if(j.substr(0,1)==="q"){for(dt.push(yt),lt=oe=1,to=Y-1;1<=to?oe<=to:oe>=to;lt=1<=to?++oe:--oe)Ur=(ro.length-1)*lt/Y,Pi=P(Ur),Pi===Ur?dt.push(ro[Pi]):(Ri=Ur-Pi,dt.push(ro[Pi]*(1-Ri)+ro[Pi+1]*Ri));dt.push(me)}else if(j.substr(0,1)==="k"){for(Tt=ro.length,Oe=new Array(Tt),mt=new Array(Y),pa=!0,Mt=0,$e=null,$e=[],$e.push(yt),lt=de=1,aa=Y-1;1<=aa?de<=aa:de>=aa;lt=1<=aa?++de:--de)$e.push(yt+lt/Y*(me-yt));for($e.push(me);pa;){for(Ue=G=0,la=Y-1;0<=la?G<=la:G>=la;Ue=0<=la?++G:--G)mt[Ue]=0;for(lt=ae=0,ca=Tt-1;0<=ca?ae<=ca:ae>=ca;lt=0<=ca?++ae:--ae){for(_y=ro[lt],Dt=Number.MAX_VALUE,Ue=we=0,ua=Y-1;0<=ua?we<=ua:we>=ua;Ue=0<=ua?++we:--we)bt=f($e[Ue]-_y),bt<Dt&&(Dt=bt,De=Ue);mt[De]++,Oe[lt]=De}for(kt=new Array(Y),Ue=He=0,da=Y-1;0<=da?He<=da:He>=da;Ue=0<=da?++He:--He)kt[Ue]=null;for(lt=qe=0,ha=Tt-1;0<=ha?qe<=ha:qe>=ha;lt=0<=ha?++qe:--qe)it=Oe[lt],kt[it]===null?kt[it]=ro[lt]:kt[it]+=ro[lt];for(Ue=Qe=0,fa=Y-1;0<=fa?Qe<=fa:Qe>=fa;Ue=0<=fa?++Qe:--Qe)kt[Ue]*=1/mt[Ue];for(pa=!1,Ue=vt=0,Pr=Y-1;0<=Pr?vt<=Pr:vt>=Pr;Ue=0<=Pr?++vt:--vt)if(kt[Ue]!==$e[lt]){pa=!0;break}$e=kt,Mt++,Mt>200&&(pa=!1)}for(nt={},Ue=ot=0,Di=Y-1;0<=Di?ot<=Di:ot>=Di;Ue=0<=Di?++ot:--ot)nt[Ue]=[];for(lt=et=0,Hn=Tt-1;0<=Hn?et<=Hn:et>=Hn;lt=0<=Hn?++et:--et)it=Oe[lt],nt[it].push(ro[lt]);for(no=[],Ue=J=0,Li=Y-1;0<=Li?J<=Li:J>=Li;Ue=0<=Li?++J:--J)no.push(nt[Ue][0]),no.push(nt[Ue][nt[Ue].length-1]);for(no=no.sort(function(Im,Dm){return Im-Dm}),dt.push(no[0]),lt=Pe=1,yl=no.length-1;Pe<=yl;lt=Pe+=2)_l=no[lt],!isNaN(_l)&&dt.indexOf(_l)===-1&&dt.push(_l)}return dt},B=function(N,j,Y){var oe,de,G,ae;return oe=Ee(arguments),N=oe[0],j=oe[1],Y=oe[2],isNaN(N)&&(N=0),N/=360,N<1/3?(de=(1-j)/3,ae=(1+j*A(l*N)/A(s-l*N))/3,G=1-(de+ae)):N<2/3?(N-=1/3,ae=(1-j)/3,G=(1+j*A(l*N)/A(s-l*N))/3,de=1-(ae+G)):(N-=2/3,G=(1-j)/3,de=(1+j*A(l*N)/A(s-l*N))/3,ae=1-(G+de)),ae=ue(Y*ae*3),G=ue(Y*G*3),de=ue(Y*de*3),[ae*255,G*255,de*255,oe.length>3?oe[3]:1]},_e=function(){var N,j,Y,oe,de,G,ae,we;return ae=Ee(arguments),G=ae[0],j=ae[1],N=ae[2],l=Math.PI*2,G/=255,j/=255,N/=255,de=Math.min(G,j,N),oe=(G+j+N)/3,we=1-de/oe,we===0?Y=0:(Y=(G-j+(G-N))/2,Y/=Math.sqrt((G-j)*(G-j)+(G-N)*(j-N)),Y=Math.acos(Y),N>j&&(Y=l-Y),Y/=l),[Y*360,we,oe]},w.hsi=function(){return function(N,j,Y){Y.prototype=N.prototype;var oe=new Y,de=N.apply(oe,j);return Object(de)===de?de:oe}(t,St.call(arguments).concat(["hsi"]),function(){})},h.hsi=B,t.prototype.hsi=function(){return _e(this._rgb)},O=function(N,j,Y,oe){var de,G,ae,we,He,qe,Qe,vt,ot,et,J,Pe;return oe==="hsl"?(J=N.hsl(),Pe=j.hsl()):oe==="hsv"?(J=N.hsv(),Pe=j.hsv()):oe==="hcg"?(J=N.hcg(),Pe=j.hcg()):oe==="hsi"?(J=N.hsi(),Pe=j.hsi()):(oe==="lch"||oe==="hcl")&&(oe="hcl",J=N.hcl(),Pe=j.hcl()),oe.substr(0,1)==="h"&&(ae=J[0],ot=J[1],qe=J[2],we=Pe[0],et=Pe[1],Qe=Pe[2]),!isNaN(ae)&&!isNaN(we)?(we>ae&&we-ae>180?de=we-(ae+360):we<ae&&ae-we>180?de=we+360-ae:de=we-ae,G=ae+Y*de):isNaN(ae)?isNaN(we)?G=Number.NaN:(G=we,(qe===1||qe===0)&&oe!=="hsv"&&(vt=et)):(G=ae,(Qe===1||Qe===0)&&oe!=="hsv"&&(vt=ot)),vt==null&&(vt=ot+Y*(et-ot)),He=qe+Y*(Qe-qe),w[oe](G,vt,He)},m=m.concat(function(){var N,j,Y,oe;for(Y=["hsv","hsl","hsi","hcl","lch","hcg"],oe=[],j=0,N=Y.length;j<N;j++)be=Y[j],oe.push([be,O]);return oe}()),ie=function(N,j,Y,oe){var de,G;return de=N.num(),G=j.num(),w.num(de+(G-de)*Y,"num")},m.push(["num",ie]),k=function(N,j,Y,oe){var de,G;return de=N.lab(),G=j.lab(),new t(de[0]+Y*(G[0]-de[0]),de[1]+Y*(G[1]-de[1]),de[2]+Y*(G[2]-de[2]),oe)},m.push(["lab",k])}).call(QT)})(mp,mp.exports);var zV=mp.exports,RE={exports:{}};(function(n){/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */(function(e){function t(s,a,l,c,u){this._listener=a,this._isOnce=l,this.context=c,this._signal=s,this._priority=u||0}t.prototype={active:!0,params:null,execute:function(s){var a,l;return this.active&&this._listener&&(l=this.params?this.params.concat(s):s,a=this._listener.apply(this.context,l),this._isOnce&&this.detach()),a},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};function r(s,a){if(typeof s!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",a))}function i(){this._bindings=[],this._prevParams=null;var s=this;this.dispatch=function(){i.prototype.dispatch.apply(s,arguments)}}i.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(s,a,l,c){var u=this._indexOfListener(s,l),d;if(u!==-1){if(d=this._bindings[u],d.isOnce()!==a)throw new Error("You cannot add"+(a?"":"Once")+"() then add"+(a?"Once":"")+"() the same listener without removing the relationship first.")}else d=new t(this,s,a,l,c),this._addBinding(d);return this.memorize&&this._prevParams&&d.execute(this._prevParams),d},_addBinding:function(s){var a=this._bindings.length;do--a;while(this._bindings[a]&&s._priority<=this._bindings[a]._priority);this._bindings.splice(a+1,0,s)},_indexOfListener:function(s,a){for(var l=this._bindings.length,c;l--;)if(c=this._bindings[l],c._listener===s&&c.context===a)return l;return-1},has:function(s,a){return this._indexOfListener(s,a)!==-1},add:function(s,a,l){return r(s,"add"),this._registerListener(s,!1,a,l)},addOnce:function(s,a,l){return r(s,"addOnce"),this._registerListener(s,!0,a,l)},remove:function(s,a){r(s,"remove");var l=this._indexOfListener(s,a);return l!==-1&&(this._bindings[l]._destroy(),this._bindings.splice(l,1)),s},removeAll:function(){for(var s=this._bindings.length;s--;)this._bindings[s]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(s){if(this.active){var a=Array.prototype.slice.call(arguments),l=this._bindings.length,c;if(this.memorize&&(this._prevParams=a),!!l){c=this._bindings.slice(),this._shouldPropagate=!0;do l--;while(c[l]&&this._shouldPropagate&&c[l].execute(a)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var o=i;o.Signal=i,n.exports?n.exports=o:e.signals=o})(QT)})(RE);var Ft=RE.exports,IE={};(function(n){(function(){var e={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function t(a){return i(s(a),arguments)}function r(a,l){return t.apply(null,[a].concat(l||[]))}function i(a,l){var c=1,u=a.length,d,h="",m,f,v,g,b,S,p,y;for(m=0;m<u;m++)if(typeof a[m]=="string")h+=a[m];else if(typeof a[m]=="object"){if(v=a[m],v.keys)for(d=l[c],f=0;f<v.keys.length;f++){if(d==null)throw new Error(t('[sprintf] Cannot access property "%s" of undefined value "%s"',v.keys[f],v.keys[f-1]));d=d[v.keys[f]]}else v.param_no?d=l[v.param_no]:d=l[c++];if(e.not_type.test(v.type)&&e.not_primitive.test(v.type)&&d instanceof Function&&(d=d()),e.numeric_arg.test(v.type)&&typeof d!="number"&&isNaN(d))throw new TypeError(t("[sprintf] expecting number but found %T",d));switch(e.number.test(v.type)&&(p=d>=0),v.type){case"b":d=parseInt(d,10).toString(2);break;case"c":d=String.fromCharCode(parseInt(d,10));break;case"d":case"i":d=parseInt(d,10);break;case"j":d=JSON.stringify(d,null,v.width?parseInt(v.width):0);break;case"e":d=v.precision?parseFloat(d).toExponential(v.precision):parseFloat(d).toExponential();break;case"f":d=v.precision?parseFloat(d).toFixed(v.precision):parseFloat(d);break;case"g":d=v.precision?String(Number(d.toPrecision(v.precision))):parseFloat(d);break;case"o":d=(parseInt(d,10)>>>0).toString(8);break;case"s":d=String(d),d=v.precision?d.substring(0,v.precision):d;break;case"t":d=String(!!d),d=v.precision?d.substring(0,v.precision):d;break;case"T":d=Object.prototype.toString.call(d).slice(8,-1).toLowerCase(),d=v.precision?d.substring(0,v.precision):d;break;case"u":d=parseInt(d,10)>>>0;break;case"v":d=d.valueOf(),d=v.precision?d.substring(0,v.precision):d;break;case"x":d=(parseInt(d,10)>>>0).toString(16);break;case"X":d=(parseInt(d,10)>>>0).toString(16).toUpperCase();break}e.json.test(v.type)?h+=d:(e.number.test(v.type)&&(!p||v.sign)?(y=p?"+":"-",d=d.toString().replace(e.sign,"")):y="",b=v.pad_char?v.pad_char==="0"?"0":v.pad_char.charAt(1):" ",S=v.width-(y+d).length,g=v.width&&S>0?b.repeat(S):"",h+=v.align?y+d+g:b==="0"?y+g+d:g+y+d)}return h}var o=Object.create(null);function s(a){if(o[a])return o[a];for(var l=a,c,u=[],d=0;l;){if((c=e.text.exec(l))!==null)u.push(c[0]);else if((c=e.modulo.exec(l))!==null)u.push("%");else if((c=e.placeholder.exec(l))!==null){if(c[2]){d|=1;var h=[],m=c[2],f=[];if((f=e.key.exec(m))!==null)for(h.push(f[1]);(m=m.substring(f[0].length))!=="";)if((f=e.key_access.exec(m))!==null)h.push(f[1]);else if((f=e.index_access.exec(m))!==null)h.push(f[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");c[2]=h}else d|=2;if(d===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");u.push({placeholder:c[0],param_no:c[1],keys:c[2],sign:c[3],pad_char:c[4],align:c[5],width:c[6],precision:c[7],type:c[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");l=l.substring(c[0].length)}return o[a]=u}n.sprintf=t,n.vsprintf=r,typeof window<"u"&&(window.sprintf=t,window.vsprintf=r)})()})(IE);var UV={};function $V(n){if(typeof window>"u")return;const e=new RegExp(`${n}=([^&#=]*)`).exec(window.location.search);return e?decodeURIComponent(e[1]):void 0}function W(n,e){return n!==void 0?n:e}function hi(n,e){const t=Object.assign({},n);for(const r in e)n[r]===void 0&&(t[r]=e[r]);return t}function DE(n,e){for(const t in e){const r=e[t];r!==void 0&&(n[t]=r)}return n}function HV(){if(typeof window>"u")return!1;const n=window.navigator.userAgent;return/Opera|OPR/.test(n)?"Opera":/Chrome/i.test(n)?"Chrome":/Firefox/i.test(n)?"Firefox":/Mobile(\/.*)? Safari/i.test(n)?"Mobile Safari":/MSIE/i.test(n)?"Internet Explorer":!!/Safari/i.test(n)&&"Safari"}function VV(n,e){return n<e?-1:n>e?1:0}function Pa(n,e,t=VV){let r=0,i=n.length-1;for(;r<=i;){const o=r+i>>1,s=t(e,n[o]);if(s>0)r=o+1;else{if(!(s<0))return o;i=o-1}}return-r-1}function jb(n,e,t){const r=function(o,s){let a=o.length-1;if(o[a]<s)return-1;let l=0;for(;l<=a;){const c=l+a>>1;o[c]>=s?a=c-1:l=c+1}return a+1}(n,e),i=function(o,s){if(o[0]>s)return-1;let a=0,l=o.length-1;for(;a<=l;){const c=a+l>>1;o[c]>s?l=c-1:a=c+1}return a-1}(n,t);return r===-1||i===-1||r>i?0:i-r+1}function qb(n){return n.sort().filter(function(e,t,r){return t===0||e!==r[t-1]})}function vd(n){if(n.length>28672){const t=[];for(let r=0;r<n.length;r+=28672)t.push(String.fromCharCode.apply(null,n.subarray(r,r+28672)));return t.join("")}return String.fromCharCode.apply(null,n)}function LE(n,e){switch(n){case"int8":return new Int8Array(e);case"int16":return new Int16Array(e);case"int32":return new Int32Array(e);case"uint8":return new Uint8Array(e);case"uint16":return new Uint16Array(e);case"uint32":return new Uint32Array(e);case"float32":return new Float32Array(e);default:throw new Error("arrayType unknown: "+n)}}function To(n,e){return new(e>65535?Uint32Array:Uint16Array)(n)}function Gc(n){return n.buffer&&n.buffer instanceof ArrayBuffer?n.buffer:n}function fm(n,e){return n===void 0?n=new e:Array.isArray(n)&&(n=new e().fromArray(n)),n}function qa(n){return fm(n,te)}function Cu(n){return fm(n,at)}function ov(n){return fm(n,Br)}function Xg(n){return e=n,t=Float32Array,e instanceof t?e:new t(e);var e,t}function aw(n){return W(n,"").toString().toLowerCase()}class ia{constructor(e){this.name=e,this._dict={}}add(e,t){this._dict[aw(e)]=t}get(e){return this._dict[aw(e)]}get names(){return Object.keys(this._dict)}}function kn(n){return .01745*n}const GV="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Uh=new Array(36);function Xb(){let n,e=0;for(let t=0;t<36;t++)t===8||t===13||t===18||t===23?Uh[t]="-":t===14?Uh[t]="4":(e<=2&&(e=33554432+16777216*Math.random()|0),n=15&e,e>>=4,Uh[t]=GV[t===19?3&n|8:n]);return Uh.join("")}function sv(n,e,t){return Math.max(e,Math.min(t,n))}function wi(n,e,t){return n+(e-n)*t}function Xo(n,e,t,r,i,o){const s=(t-n)*o,a=(r-e)*o,l=i*i;return(2*e-2*t+s+a)*(i*l)+(-3*e+3*t-2*s-a)*l+s*i+e}function Nd(n,e,t){var r;return r=function(i,o,s){return(i-o)/(s-o)}(t,n,e),(t=sv(r,0,1))*t*(3-2*t)}var FE="sRGB";const WV={scale:"uniform",mode:"hcl",domain:[0,1],value:16777215,reverse:!1},Ef=new _t;function an(n,e,t){const r=t.value;return t.value=function(i,o){let s=r.bind(this,i,o)();return FE=="linear"?(Ef.set(s),Ef.convertSRGBToLinear(),Ef.getHex()):s},t}class hn{constructor(e={}){this.parameters=hi(e,WV),typeof this.parameters.value=="string"&&(this.parameters.value=Ef.set(this.parameters.value).getHex()),this.parameters.structure&&(this.atomProxy=this.parameters.structure.getAtomProxy())}getScale(e={}){const t=hi(e,this.parameters);return t.scale==="rainbow"?t.scale=["red","orange","yellow","green","blue"]:t.scale==="rwb"&&(t.scale=["red","white","blue"]),t.reverse&&(t.domain=t.domain.slice().reverse()),zV.scale(t.scale).mode(t.mode).domain(t.domain).out("num")}colorToArray(e,t=[],r=0){return t[r]=(e>>16&255)/255,t[r+1]=(e>>8&255)/255,t[r+2]=(255&e)/255,t}atomColorToArray(e,t,r){return this.colorToArray(this.atomColor?this.atomColor(e):0,t,r)}bondColor(e,t){return this.atomProxy&&this.atomColor?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):0}bondColorToArray(e,t,r,i){return this.colorToArray(this.bondColor(e,t),r,i)}volumeColorToArray(e,t,r){return this.colorToArray(this.volumeColor?this.volumeColor(e):0,t,r)}positionColorToArray(e,t,r){return this.colorToArray(this.positionColor?this.positionColor(e):0,t,r)}}var wt;(function(n){n[n.PROTEIN=1]="PROTEIN",n[n.NUCLEIC=2]="NUCLEIC",n[n.RNA=3]="RNA",n[n.DNA=4]="DNA",n[n.POLYMER=5]="POLYMER",n[n.WATER=6]="WATER",n[n.HELIX=7]="HELIX",n[n.SHEET=8]="SHEET",n[n.TURN=9]="TURN",n[n.BACKBONE=10]="BACKBONE",n[n.SIDECHAIN=11]="SIDECHAIN",n[n.ALL=12]="ALL",n[n.HETERO=13]="HETERO",n[n.ION=14]="ION",n[n.SACCHARIDE=15]="SACCHARIDE",n[n.SUGAR=15]="SUGAR",n[n.BONDED=16]="BONDED",n[n.RING=17]="RING",n[n.AROMATICRING=18]="AROMATICRING",n[n.METAL=19]="METAL",n[n.POLARH=20]="POLARH",n[n.NONE=21]="NONE"})(wt||(wt={}));const lw=["*","","ALL"],jV=["NONE"],Yb=[wt.BACKBONE,wt.SIDECHAIN,wt.BONDED,wt.RING,wt.AROMATICRING,wt.METAL,wt.POLARH],OE=[wt.POLYMER,wt.WATER],qV=["ALA","GLY","SER"],XV=["CYS","SER","THR"],YV=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],KV=["PHE","TRP","TYR","HIS"],ZV=["ASN","GLN"],JV=["ASP","GLU"],QV=["ARG","HIS","LYS"],eG=["ARG","ASP","GLU","HIS","LYS"],tG=["ASN","ARG","ASP","CYS","GLY","GLN","GLU","HIS","LYS","SER","THR","TYR"],nG=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],rG=["HIS","PHE","PRO","TRP","TYR"],iG=["ALA","GLY","ILE","LEU","VAL"];function oG(n,e){if(e.atomname===void 0&&e.element===void 0&&e.altloc===void 0&&e.atomindex===void 0&&e.keyword===void 0&&e.inscode===void 0&&e.resname===void 0&&e.sstruc===void 0&&e.resno===void 0&&e.chainname===void 0&&e.model===void 0)return-1;if(e.keyword!==void 0&&(e.keyword===wt.BACKBONE&&!n.isBackbone()||e.keyword===wt.SIDECHAIN&&!n.isSidechain()||e.keyword===wt.BONDED&&!n.isBonded()||e.keyword===wt.RING&&!n.isRing()||e.keyword===wt.AROMATICRING&&!n.isAromatic()||e.keyword===wt.HETERO&&!n.isHetero()||e.keyword===wt.PROTEIN&&!n.isProtein()||e.keyword===wt.NUCLEIC&&!n.isNucleic()||e.keyword===wt.RNA&&!n.isRna()||e.keyword===wt.DNA&&!n.isDna()||e.keyword===wt.POLYMER&&!n.isPolymer()||e.keyword===wt.WATER&&!n.isWater()||e.keyword===wt.HELIX&&!n.isHelix()||e.keyword===wt.SHEET&&!n.isSheet()||e.keyword===wt.TURN&&!n.isTurn()||e.keyword===wt.ION&&!n.isIon()||e.keyword===wt.SACCHARIDE&&!n.isSaccharide()||e.keyword===wt.METAL&&!n.isMetal()||e.keyword===wt.POLARH&&!n.isPolarHydrogen())||e.atomname!==void 0&&e.atomname!==n.atomname||e.element!==void 0&&e.element!==n.element||e.altloc!==void 0&&e.altloc!==n.altloc||e.atomindex!==void 0&&Pa(e.atomindex,n.index)<0)return!1;if(e.resname!==void 0){if(Array.isArray(e.resname)){if(!e.resname.includes(n.resname))return!1}else if(e.resname!==n.resname)return!1}if(e.sstruc!==void 0&&e.sstruc!==n.sstruc)return!1;if(e.resno!==void 0){if(Array.isArray(e.resno)&&e.resno.length===2){if(e.resno[0]>n.resno||e.resno[1]<n.resno)return!1}else if(e.resno!==n.resno)return!1}return(e.inscode===void 0||e.inscode===n.inscode)&&(e.chainname===void 0||e.chainname===n.chainname)&&(e.model===void 0||e.model===n.modelIndex)}function sG(n,e){if(e.resname===void 0&&e.resno===void 0&&e.inscode===void 0&&e.sstruc===void 0&&e.model===void 0&&e.chainname===void 0&&e.atomindex===void 0&&(e.keyword===void 0||Yb.includes(e.keyword)))return-1;if(e.keyword!==void 0&&(e.keyword===wt.HETERO&&!n.isHetero()||e.keyword===wt.PROTEIN&&!n.isProtein()||e.keyword===wt.NUCLEIC&&!n.isNucleic()||e.keyword===wt.RNA&&!n.isRna()||e.keyword===wt.DNA&&!n.isDna()||e.keyword===wt.POLYMER&&!n.isPolymer()||e.keyword===wt.WATER&&!n.isWater()||e.keyword===wt.HELIX&&!n.isHelix()||e.keyword===wt.SHEET&&!n.isSheet()||e.keyword===wt.TURN&&!n.isTurn()||e.keyword===wt.ION&&!n.isIon()||e.keyword===wt.SACCHARIDE&&!n.isSaccharide())||e.atomindex!==void 0&&jb(e.atomindex,n.atomOffset,n.atomEnd)===0)return!1;if(e.resname!==void 0){if(Array.isArray(e.resname)){if(!e.resname.includes(n.resname))return!1}else if(e.resname!==n.resname)return!1}if(e.sstruc!==void 0&&e.sstruc!==n.sstruc)return!1;if(e.resno!==void 0){if(Array.isArray(e.resno)&&e.resno.length===2){if(e.resno[0]>n.resno||e.resno[1]<n.resno)return!1}else if(e.resno!==n.resno)return!1}return(e.inscode===void 0||e.inscode===n.inscode)&&(e.chainname===void 0||e.chainname===n.chainname)&&(e.model===void 0||e.model===n.modelIndex)}function aG(n,e){return e.chainname!==void 0||e.model!==void 0||e.atomindex!==void 0||e.keyword!==void 0&&OE.includes(e.keyword)&&n.entity?e.keyword!==void 0&&(e.keyword===wt.POLYMER&&!n.entity.isPolymer()||e.keyword===wt.WATER&&!n.entity.isWater())?!1:(e.atomindex===void 0||jb(e.atomindex,n.atomOffset,n.atomEnd)!==0)&&(e.chainname===void 0||e.chainname===n.chainname)&&(e.model===void 0||e.model===n.modelIndex):-1}function lG(n,e){return e.model===void 0&&e.atomindex===void 0?-1:(e.atomindex===void 0||jb(e.atomindex,n.atomOffset,n.atomEnd)!==0)&&(e.model===void 0||e.model===n.index)}function zd(n,e){if(n===null||n.error||!n.rules||n.rules.length===0)return!1;const t=n.rules.length,r=!n.negate,i=!!n.negate,o=[];for(let s=0;s<t;++s){const a=n.rules[s];a.hasOwnProperty("operator")&&(o[s]=zd(a,e))}return function(s){const a=n.operator==="AND";let l=!1;for(let c=0;c<t;++c){const u=n.rules[c];let d;if(u.hasOwnProperty("operator")){const h=o[c];if(d=h!==!1?h(s):-1,d===-1){l=!0;continue}if(d===!0){if(a)continue;return r}if(a)return i}else{if(u.keyword===wt.ALL){if(a)continue;return r}if(u.keyword===wt.NONE){if(a)continue;return i}if(d=e(s,u),d!==-1){if(d===!0){if(a)continue;return r}if(a)return i}else l=!0}}return l?-1:a?r:i}}function Ud(n,e){if(n.error||!n.rules||n.rules.length===0)return n;const t=n.rules.length,r={operator:n.operator,rules:[]};n.hasOwnProperty("negate")&&(r.negate=n.negate);for(let i=0;i<t;++i){const o=n.rules[i];if(o.hasOwnProperty("operator")){const s=Ud(o,e);s!==null&&r.rules.push(s)}else e(o)||r.rules.push(o)}return r.rules.length>0?n:null}function cw(n,e=!1){let t=n;return e&&(t=Ud(n,function(r){return r.keyword!==void 0&&!Yb.includes(r.keyword)||r.model!==void 0||r.chainname!==void 0||r.resname!==void 0||r.resno!==void 0||r.sstruc!==void 0})),zd(t,oG)}function uw(n,e=!1){let t=n;return e&&(t=Ud(n,function(r){return!(r.keyword===void 0||!Yb.includes(r.keyword))||r.model!==void 0||r.chainname!==void 0||r.atomname!==void 0||r.element!==void 0||r.altloc!==void 0})),zd(t,sG)}function dw(n,e=!1){let t=n;return e&&(t=Ud(n,function(r){return r.keyword!==void 0&&!OE.includes(r.keyword)||r.resname!==void 0||r.resno!==void 0||r.atomname!==void 0||r.element!==void 0||r.altloc!==void 0||r.sstruc!==void 0||r.inscode!==void 0})),zd(t,aG)}function hw(n,e=!1){let t=n;return e&&(t=Ud(n,function(r){return r.keyword!==void 0||r.chainname!==void 0||r.resname!==void 0||r.resno!==void 0||r.atomname!==void 0||r.element!==void 0||r.altloc!==void 0||r.sstruc!==void 0||r.inscode!==void 0})),zd(t,lG)}class yn{constructor(e){this.signals={stringChanged:new Ft.Signal},this.setString(e)}get type(){return"selection"}setString(e,t){if(e===void 0&&(e=this.string||""),e===this.string)return;try{this.selection=function(i){let o={operator:void 0,rules:[]};if(!i)return o;let s,a,l=o;const c=[];(i=i.replace(/\(/g," ( ").replace(/\)/g," ) ").trim()).charAt(0)==="("&&i.substr(-1)===")"&&(i=i.slice(1,-1).trim());const u=i.split(/\s+/),d=v=>{s={operator:v,rules:[]},l===void 0?(l=s,o=s):(l.rules.push(s),c.push(l),l=s)},h=function(v){a=l,l=c.pop(),l===void 0&&(d(v),m(a))},m=function(v){l.rules.push(v)};let f=!1;for(let v=0;v<u.length;++v){const g=u[v],b=g.toUpperCase();if(g==="("){f=!1,d();continue}if(g===")"){h(),l.negate&&h();continue}if(f>0)if(b==="NOT")f=1;else if(f===1)f=2;else{if(f!==2)throw new Error("something went wrong with 'not'");f=!1,h()}if(b==="AND"){if(l.operator==="OR"){const A=l.rules.pop();d("AND"),m(A)}else l.operator="AND";continue}if(b==="OR"){l.operator==="AND"?h("OR"):l.operator="OR";continue}if(g.toUpperCase()==="NOT"){f=1,d(),l.negate=!0;continue}if(+b!=+b){const A=wt[b];if(A!==void 0){m({keyword:A});continue}}if(b==="HYDROGEN"){m({operator:"OR",rules:[{element:"H"},{element:"D"}]});continue}if(b==="SMALL"){m({resname:qV});continue}if(b==="NUCLEOPHILIC"){m({resname:XV});continue}if(b==="HYDROPHOBIC"){m({resname:YV});continue}if(b==="AROMATIC"){m({resname:KV});continue}if(b==="AMIDE"){m({resname:ZV});continue}if(b==="ACIDIC"){m({resname:JV});continue}if(b==="BASIC"){m({resname:QV});continue}if(b==="CHARGED"){m({resname:eG});continue}if(b==="POLAR"){m({resname:tG});continue}if(b==="NONPOLAR"){m({resname:nG});continue}if(b==="CYCLIC"){m({resname:rG});continue}if(b==="ALIPHATIC"){m({resname:iG});continue}if(b==="SIDECHAINATTACHED"){m({operator:"OR",rules:[{keyword:wt.SIDECHAIN},{operator:"AND",negate:!1,rules:[{keyword:wt.PROTEIN},{operator:"OR",negate:!1,rules:[{atomname:"CA"},{atomname:"BB"}]}]},{operator:"AND",negate:!1,rules:[{resname:"PRO"},{atomname:"N"}]},{operator:"AND",negate:!1,rules:[{keyword:wt.NUCLEIC},{operator:"OR",negate:!0,rules:[{atomname:"P"},{atomname:"OP1"},{atomname:"OP2"},{atomname:"O3'"},{atomname:"O3*"},{atomname:"HO3'"},{atomname:"O5'"},{atomname:"O5*"},{atomname:"HO5'"},{atomname:"C5'"},{atomname:"C5*"},{atomname:"H5'"},{atomname:"H5''"}]}]}]});continue}if(b==="APOLARH"){m({operator:"AND",negate:!1,rules:[{element:"H"},{negate:!0,operator:void 0,rules:[{keyword:wt.POLARH}]}]});continue}if(b==="LIGAND"){m({operator:"AND",rules:[{operator:"OR",rules:[{operator:"AND",rules:[{keyword:wt.HETERO},{negate:!0,operator:void 0,rules:[{keyword:wt.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{keyword:wt.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{operator:"OR",rules:[{keyword:wt.WATER},{keyword:wt.ION}]}]}]});continue}if(lw.indexOf(b)!==-1){m({keyword:wt.ALL});continue}if(g.charAt(0)==="@"){const A=g.substr(1).split(",").map(C=>parseInt(C));A.sort(function(C,T){return C-T}),m({atomindex:A});continue}if(g.charAt(0)==="#"){console.error("# for element selection deprecated, use _"),m({element:b.substr(1)});continue}if(g.charAt(0)==="_"){m({element:b.substr(1)});continue}if(g[0]==="["&&g[g.length-1]==="]"){const A=b.substr(1,g.length-2).split(","),C=A.length>1?A:A[0];m({resname:C});continue}if(g.length>=1&&g.length<=4&&g[0]!=="^"&&g[0]!==":"&&g[0]!=="."&&g[0]!=="%"&&g[0]!=="/"&&isNaN(parseInt(g))){m({resname:b});continue}const S={operator:"AND",rules:[]},p=g.split("/");if(p.length>1&&p[1]){if(isNaN(parseInt(p[1])))throw new Error("model must be an integer");S.rules.push({model:parseInt(p[1])})}const y=p[0].split("%");y.length>1&&S.rules.push({altloc:y[1]});const w=y[0].split(".");if(w.length>1&&w[1]){if(w[1].length>4)throw new Error("atomname must be one to four characters");S.rules.push({atomname:w[1].substring(0,4).toUpperCase()})}const x=w[0].split(":");x.length>1&&x[1]&&S.rules.push({chainname:x[1]});const _=x[0].split("^");if(_.length>1&&S.rules.push({inscode:_[1]}),_[0]){let A,C;_[0][0]==="-"&&(_[0]=_[0].substr(1),A=!0),_[0].includes("--")&&(_[0]=_[0].replace("--","-"),C=!0);let T=_[0].split("-");if(T.length===1){let I=parseInt(T[0]);if(isNaN(I))throw new Error("resi must be an integer");A&&(I*=-1),S.rules.push({resno:I})}else{if(T.length!==2)throw new Error("resi range must contain one '-'");{const I=T.map(M=>parseInt(M));A&&(I[0]*=-1),C&&(I[1]*=-1),S.rules.push({resno:[I[0],I[1]]})}}}if(S.rules.length===1)m(S.rules[0]);else{if(!(S.rules.length>1))throw new Error("empty selection chunk");m(S)}}return o.operator===void 0&&o.rules.length===1&&o.rules[0].hasOwnProperty("operator")&&(o=o.rules[0]),o}(e)}catch(i){this.selection={error:i.message}}const r=this.selection;this.string=e,this.test=cw(r),this.residueTest=uw(r),this.chainTest=dw(r),this.modelTest=hw(r),this.atomOnlyTest=cw(r,!0),this.residueOnlyTest=uw(r,!0),this.chainOnlyTest=dw(r,!0),this.modelOnlyTest=hw(r,!0),t||this.signals.stringChanged.dispatch(this.string)}isAllSelection(){return lw.includes(this.string.toUpperCase())}isNoneSelection(){return jV.includes(this.string.toUpperCase())}}class cG extends hn{constructor(e){super(e),this.colormakerList=[],this.selectionList=[],(e.dataList||[]).forEach(t=>{const[r,i,o={}]=t;Xt.hasScheme(r)?Object.assign(o,{scheme:r,structure:this.parameters.structure}):Object.assign(o,{scheme:"uniform",value:new _t(r).getHex()}),this.colormakerList.push(Xt.getScheme(o)),this.selectionList.push(new yn(i))})}atomColor(e){for(let t=0,r=this.selectionList.length;t<r;++t){const i=this.selectionList[t].test;if(i&&i(e))return this.colormakerList[t].atomColor(e)}return 16777215}}const uG={"":"",OrRd:"[S] Orange-Red",PuBu:"[S] Purple-Blue",BuPu:"[S] Blue-Purple",Oranges:"[S] Oranges",BuGn:"[S] Blue-Green",YlOrBr:"[S] Yellow-Orange-Brown",YlGn:"[S] Yellow-Green",Reds:"[S] Reds",RdPu:"[S] Red-Purple",Greens:"[S] Greens",YlGnBu:"[S] Yellow-Green-Blue",Purples:"[S] Purples",GnBu:"[S] Green-Blue",Greys:"[S] Greys",YlOrRd:"[S] Yellow-Orange-Red",PuRd:"[S] Purple-Red",Blues:"[S] Blues",PuBuGn:"[S] Purple-Blue-Green",Viridis:"[D] Viridis",Spectral:"[D] Spectral",RdYlGn:"[D] Red-Yellow-Green",RdBu:"[D] Red-Blue",PiYG:"[D] Pink-Yellowgreen",PRGn:"[D] Purplered-Green",RdYlBu:"[D] Red-Yellow-Blue",BrBG:"[D] Brown-Bluegreen",RdGy:"[D] Red-Grey",PuOr:"[D] Purple-Orange",Set1:"[Q] Set1",Set2:"[Q] Set2",Set3:"[Q] Set3",Dark2:"[Q] Dark2",Paired:"[Q] Paired",Pastel1:"[Q] Pastel1",Pastel2:"[Q] Pastel2",Accent:"[Q] Accent",rainbow:"[?] Rainbow",rwb:"[?] Red-White-Blue"},dG={"":"",rgb:"Red Green Blue",hsv:"Hue Saturation Value",hsl:"Hue Saturation Lightness",hsi:"Hue Saturation Intensity",lab:"CIE L*a*b*",hcl:"Hue Chroma Lightness"};function kE(n){const e=n;return n.forEach(function(t){t.__deps&&Array.prototype.push.apply(e,kE(t.__deps))}),e}function hG(n){return qb(kE(n)).map(function(e){return e.toString()}).join(`


`)}function fG(n){const e=n.data.__name,t=n.data.__postId;if(e===void 0)console.error("message __name undefined");else if(self.func===void 0)console.error("worker func undefined",e);else{const r=function(i,o){i=i||{},t!==void 0&&(i.__postId=t);try{self.postMessage(i,o)}catch(s){console.error("self.postMessage:",s),self.postMessage(i)}};self.func(n,r)}}function pG(n,e){let t=`'use strict';

`+hG(e);return t+=`


self.func = `+n.toString()+";",t+=`


self.onmessage = `+fG.toString()+";",new Blob([t],{type:"application/javascript"})}const BE=HV();let NE=!1;try{const n=Object.defineProperty({},"passive",{get:function(){NE=!0}});window.addEventListener("test",e=>{},n)}catch{}const zE=typeof window<"u"&&window.orientation!==void 0;let uo=!1;function fw(n){uo=n}let wo=!1;function pw(n){wo=n}const Be={log:Function.prototype.bind.call(console.log,console),info:Function.prototype.bind.call(console.info,console),warn:Function.prototype.bind.call(console.warn,console),error:Function.prototype.bind.call(console.error,console),time:Function.prototype.bind.call(console.time,console),timeEnd:Function.prototype.bind.call(console.timeEnd,console)};let uu={color:"green",labelColor:8421504,labelAttachment:"bottom-center",labelSize:.7,labelZOffset:.5,labelYOffset:.1,labelBorder:!0,labelBorderColor:13882323,labelBorderWidth:.25,lineOpacity:.8,linewidth:5,opacity:.6,labelUnit:"angstrom",arcVisible:!0,planeVisible:!1},Xe=!!(Yg=$V("debug"))&&(typeof Yg!="string"||/^1|true|t|yes|y$/i.test(Yg));var Yg;const mG=["ngl","js"],ju=new class{constructor(){this.activeWorkerCount=0,this._funcDict={},this._depsDict={},this._blobDict={}}add(n,e,t){this._funcDict[n]=e,this._depsDict[n]=t}get(n){return this._blobDict[n]||(this._blobDict[n]=pG(this._funcDict[n],this._depsDict[n])),this._blobDict[n]}},Xt=new class{constructor(){this.schemes={},this.userSchemes={}}getScheme(n){const e=((n||{}).scheme||"").toLowerCase();let t;return t=e in this.schemes?this.schemes[e]:e in this.userSchemes?this.userSchemes[e]:hn,new t(n)}getSchemes(){const n={};return Object.keys(this.schemes).forEach(function(e){n[e]=e}),Object.keys(this.userSchemes).forEach(function(e){n[e]=e.split("|")[1]}),n}getScales(){return uG}getModes(){return dG}add(n,e){n=n.toLowerCase(),this.schemes[n]=e}addScheme(n,e){return function(t){return t instanceof hn}(n)||(n=this._createScheme(n)),this._addUserScheme(n,e)}_addUserScheme(n,e){e=e||"";const t=`${Xb()}|${e}`.toLowerCase();return this.userSchemes[t]=n,t}removeScheme(n){n=n.toLowerCase(),delete this.userSchemes[n]}_createScheme(n){return class extends hn{constructor(e){super(e),n.call(this,e)}}}addSelectionScheme(n,e){return this._addUserScheme(class extends cG{constructor(t){super(Object.assign({dataList:n},t))}},e)}hasScheme(n){return(n=n.toLowerCase())in this.schemes||n in this.userSchemes}},Us=new ia("datasource"),xn=new ia("representatation"),It=new class extends ia{constructor(){super("parser")}__hasObjName(n,e){const t=this.get(n);return t&&t.prototype.__objName===e}isTrajectory(n){return this.__hasObjName(n,"frames")}isStructure(n){return this.__hasObjName(n,"structure")}isVolume(n){return this.__hasObjName(n,"volume")}isSurface(n){return this.__hasObjName(n,"surface")}isBinary(n){const e=this.get(n);return e&&e.prototype.isBinary}isXml(n){const e=this.get(n);return e&&e.prototype.isXml}isJson(n){const e=this.get(n);return e&&e.prototype.isJson}getTrajectoryExtensions(){return this.names.filter(n=>this.isTrajectory(n))}getStructureExtensions(){return this.names.filter(n=>this.isStructure(n))}getVolumeExtensions(){return this.names.filter(n=>this.isVolume(n))}getSurfaceExtensions(){return this.names.filter(n=>this.isSurface(n))}},Qt=new ia("shader"),Kb=new ia("decompressor"),Mc=new ia("component"),pi=new ia("buffer"),_i=new ia("picker");let Kg;class UE{constructor(e,t={}){this.chunkSize=10485760,this.newline=`
`,this.__pointer=0,this.__partialLine="",this.compressed=W(t.compressed,!1),this.binary=W(t.binary,!1),this.json=W(t.json,!1),this.xml=W(t.xml,!1),this.src=e}isBinary(){return this.binary||this.compressed}read(){return this._read().then(e=>{const t=this.compressed?Kb.get(this.compressed):void 0;return this.compressed&&t?this.data=t(e):((this.binary||this.compressed)&&e instanceof ArrayBuffer&&(e=new Uint8Array(e)),this.data=e),this.data})}_chunk(e,t){return t=Math.min(this.data.length,t),e===0&&this.data.length===t?this.data:this.isBinary()?this.data.subarray(e,t):this.data.substring(e,t)}chunk(e){const t=e+this.chunkSize;return this._chunk(e,t)}peekLines(e){const t=this.data,r=t.length,i=this.isBinary()?this.newline.charCodeAt(0):this.newline;let o,s=0;for(o=0;o<r&&(t[o]===i&&++s,s!==e);++o);const a=this._chunk(0,o+1);return this.chunkToLines(a,"",o>r).lines}chunkCount(){return Math.floor(this.data.length/this.chunkSize)+1}asText(){return this.isBinary()?vd(this.data):this.data}chunkToLines(e,t,r){const i=this.newline;if(!this.isBinary()&&e.length===this.data.length)return{lines:e.split(i),partialLine:""};let o=[];const s=this.isBinary()?vd(e):e,a=s.lastIndexOf(i);if(a===-1)t+=s;else{const l=t+s.substr(0,a);o=o.concat(l.split(i)),t=a===s.length-i.length?"":s.substr(a+i.length)}return r&&t!==""&&o.push(t),{lines:o,partialLine:t}}nextChunk(){const e=this.__pointer;if(!(e>this.data.length))return this.__pointer+=this.chunkSize,this.chunk(e)}nextChunkOfLines(){const e=this.nextChunk();if(e===void 0)return;const t=this.__pointer>this.data.length,r=this.chunkToLines(e,this.__partialLine,t);return this.__partialLine=r.partialLine,r.lines}eachChunk(e){const t=this.chunkSize,r=this.data.length,i=this.chunkCount();for(let o=0;o<r;o+=t)e(this.chunk(o),Math.round(o/t),i)}eachChunkOfLines(e){this.eachChunk((t,r,i)=>{const o=r===i+1,s=this.chunkToLines(t,this.__partialLine,o);this.__partialLine=s.partialLine,e(s.lines,r,i)})}dispose(){delete this.src}}class gG extends UE{_read(){return new Promise((e,t)=>{const r=this.src,i=new FileReader;i.onload=o=>{o.target&&e(o.target.result)},i.onerror=o=>t(o),this.binary||this.compressed?i.readAsArrayBuffer(r):i.readAsText(r)})}}class vG extends UE{_read(){return new Promise((e,t)=>{const r=this.src,i=new XMLHttpRequest;i.open("GET",r,!0),i.addEventListener("load",()=>{if(i.status===200||i.status===304||i.status===0)try{e(i.response)}catch(o){t(o)}else t(i.statusText)},!1),i.addEventListener("error",o=>t("network error"),!1),this.isBinary()?i.responseType="arraybuffer":this.json?i.responseType="json":this.xml?i.responseType="document":i.responseType="text",i.send()})}}class $E{constructor(e,t={}){this.parameters=hi(t,{ext:"",compressed:!1,binary:It.isBinary(t.ext||""),name:"",dir:"",path:"",protocol:""});const r={compressed:this.parameters.compressed,binary:this.parameters.binary,json:It.isJson(this.parameters.ext),xml:It.isXml(this.parameters.ext)};typeof File<"u"&&e instanceof File||typeof Blob<"u"&&e instanceof Blob?this.streamer=new gG(e,r):this.streamer=new vG(e,r)}}class bG extends $E{constructor(e,t={}){super(e,t),this.parserParams={voxelSize:t.voxelSize,firstModelOnly:t.firstModelOnly,asTrajectory:t.asTrajectory,cAlphaOnly:t.cAlphaOnly,delimiter:t.delimiter,comment:t.comment,columnNames:t.columnNames,inferBonds:t.inferBonds,name:this.parameters.name,path:this.parameters.path}}load(){return new(It.get(this.parameters.ext))(this.streamer,this.parserParams).parse()}}class yG{constructor(e,t,r){this.name=t,this.path=r,this.signals={elementAdded:new Ft.Signal,elementRemoved:new Ft.Signal,nameChanged:new Ft.Signal},this.type="Script",this.dir=r.substring(0,r.lastIndexOf("/")+1);try{this.fn=new Function("stage","__name","__path","__dir",e)}catch(i){Be.error("Script compilation failed",i),this.fn=function(){}}}run(e){return new Promise((t,r)=>{try{this.fn.apply(null,[e,this.name,this.path,this.dir]),t()}catch(i){Be.error("Script.fn",i),r(i)}})}}class _G extends $E{load(){return this.streamer.read().then(()=>new yG(this.streamer.asText(),this.parameters.name,this.parameters.path))}}function Kr(n){const e=Kb.names;let t,r,i="";t=n instanceof File?n.name:n instanceof Blob?"":n;const o=t.lastIndexOf("?"),s=o!==-1?t.substring(o):"";t=t.substring(0,o===-1?t.length:o);const a=t.replace(/^.*[\\/]/,"");let l=a.substring(0,a.lastIndexOf("."));const c=a.split(".");let u=c.length>1?(c.pop()||"").toLowerCase():"";const d=t.match(/^(.+):\/\/(.+)$/);d&&(i=d[1].toLowerCase(),t=d[2]||"");const h=t.substring(0,t.lastIndexOf("/")+1);if(e.includes(u)){r=u;const m=t.length-u.length-1;u=(t.substr(0,m).split(".").pop()||"").toLowerCase();const f=l.length-u.length-1;l=l.substr(0,f)}else r=!1;return{path:t,name:a,ext:u,base:l,dir:h,compressed:r,protocol:i,query:s,src:n}}function xG(n){let e=Kr(n);const t=Us.get(e.protocol);return t&&(e=Kr(t.getUrl(e.src)),!e.ext&&t.getExt&&(e.ext=t.getExt(n))),e}function mw(n,e={}){const t=Object.assign(xG(n),e);let r;return It.names.includes(t.ext)?r=new bG(t.src,t):mG.includes(t.ext)&&(r=new _G(t.src,t)),r?r.load():Promise.reject(new Error(`autoLoad: ext '${t.ext}' unknown`))}const Zg=[];class wG{constructor(e,t={}){this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;let r=!1;e===void 0&&(e=8192),typeof e=="number"?e=new ArrayBuffer(e):r=!0;const i=t.offset?t.offset>>>0:0;let o=e.byteLength-i,s=i;e instanceof ArrayBuffer||(e.byteLength!==e.buffer.byteLength&&(s=e.byteOffset+i),e=e.buffer),this._lastWrittenByte=r?o:0,this.buffer=e,this.length=o,this.byteLength=o,this.byteOffset=s,this._data=new DataView(this.buffer,s,o)}available(e){return e===void 0&&(e=1),this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e){return e===void 0&&(e=1),this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e){if(e===void 0&&(e=1),!this.available(e)){const t=2*(this.offset+e),r=new Uint8Array(t);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){e===void 0&&(e=1);for(var t=new Uint8Array(e),r=0;r<e;r++)t[r]=this.readByte();return t}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){Zg.length=e;for(var t=0;t<e;t++)Zg[t]=this.readChar();return Zg.join("")}writeBoolean(e=!1){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(var t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(var t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}class HE{constructor(){this.count=0,this.signals={countChanged:new Ft.Signal}}clear(){this.change(-this.count)}change(e){this.count+=e,this.signals.countChanged.dispatch(e,this.count),this.count<0&&Be.warn("Counter.count below zero",this.count)}increment(){this.change(1)}decrement(){this.change(-1)}listen(e){this.change(e.count),e.signals.countChanged.add(this.change,this)}unlisten(e){const t=e.signals.countChanged;t.has(this.change,this)&&t.remove(this.change,this)}onZeroOnce(e,t){if(this.count===0)e.call(t);else{const r=()=>{this.count===0&&(this.signals.countChanged.remove(r,this),e.call(t))};this.signals.countChanged.add(r,this)}}dispose(){this.clear(),this.signals.countChanged.dispose()}}Qt.add("shader/BasicLine.vert",`void main(){
#include begin_vertex
#include project_vertex
}`),Qt.add("shader/BasicLine.frag",`uniform vec3 uColor;
#include common
#include fog_pars_fragment
void main(){
gl_FragColor = vec4( uColor, 1.0 );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
}`),Qt.add("shader/Quad.vert",`varying vec2 vUv;
void main() {
vUv = uv;
gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`),Qt.add("shader/Quad.frag",`varying vec2 vUv;
uniform sampler2D tForeground;
uniform float scale;
void main() {
vec4 foreground = texture2D( tForeground, vUv );
gl_FragColor = foreground * scale;
}`);class SG{constructor(){this.signals={updated:new Ft.Signal},this.maxDuration=-1/0,this.minDuration=1/0,this.avgDuration=14,this.lastDuration=1/0,this.prevFpsTime=0,this.lastFps=1/0,this.lastFrames=1,this.frames=0,this.count=0,this.begin()}update(){this.startTime=this.end(),this.currentTime=this.startTime,this.signals.updated.dispatch()}begin(){this.startTime=window.performance.now(),this.lastFrames=this.frames}end(){const e=window.performance.now();return this.count+=1,this.frames+=1,this.lastDuration=e-this.startTime,this.minDuration=Math.min(this.minDuration,this.lastDuration),this.maxDuration=Math.max(this.maxDuration,this.lastDuration),this.avgDuration-=this.avgDuration/30,this.avgDuration+=this.lastDuration/30,e>this.prevFpsTime+1e3&&(this.lastFps=this.frames,this.prevFpsTime=e,this.frames=0),e}}Qt.add("shader/chunk/fog_fragment.glsl",`#ifdef USE_FOG
float depth = length( vViewPosition );
#ifdef FOG_EXP2
float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );
#else
float fogFactor = smoothstep( fogNear, fogFar, depth );
#endif
gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`),Qt.add("shader/chunk/interior_fragment.glsl",`if( gl_FrontFacing == false ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}`),Qt.add("shader/chunk/matrix_scale.glsl",`float matrixScale( in mat4 m ){
vec4 r = m[ 0 ];
return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );
}`),Qt.add("shader/chunk/nearclip_vertex.glsl",`#ifdef NEAR_CLIP
if( vViewPosition.z < clipNear - 5.0 )
gl_Position.z = 2.0 * gl_Position.w;
#endif`),Qt.add("shader/chunk/nearclip_fragment.glsl",`#ifdef NEAR_CLIP
if( vViewPosition.z < clipNear )
discard;
#endif`),Qt.add("shader/chunk/opaque_back_fragment.glsl",`#ifdef OPAQUE_BACK
#ifdef FLIP_SIDED
if( gl_FrontFacing == true ){
gl_FragColor.a = 1.0;
}
#else
if( gl_FrontFacing == false ){
gl_FragColor.a = 1.0;
}
#endif
#endif`),Qt.add("shader/chunk/radiusclip_vertex.glsl",`#ifdef RADIUS_CLIP
if( distance( vViewPosition, vClipCenter ) > clipRadius + 5.0 )
gl_Position.z = 2.0 * gl_Position.w;
#endif`),Qt.add("shader/chunk/radiusclip_fragment.glsl",`#ifdef RADIUS_CLIP
if( distance( vViewPosition, vClipCenter ) > clipRadius )
discard;
#endif`),Qt.add("shader/chunk/unpack_color.glsl",`vec3 unpackColor(float f) {
vec3 color;
color.r = floor(f / 256.0 / 256.0);
color.g = floor((f - color.r * 256.0 * 256.0) / 256.0);
color.b = floor(f - color.r * 256.0 * 256.0 - color.g * 256.0);
return color / 255.0;
}`);const CG=/^(?!\/\/)\s*#include\s+(\S+)/gim,Jg={};function Au(n,e={}){let t=n+"|";for(const r in e)t+=r+":"+e[r];if(!Jg[t]){const r=function(o){if(o===void 0)return"";const s=[];for(const a in o){const l=o[a];l&&s.push(`#define ${a} ${l}`)}return s.join(`
`)+`
`}(e);let i=Qt.get(`shader/${n}`);if(!i)throw new Error(`empty shader, '${n}'`);i=i.replace(CG,function(o,s){const a=`shader/chunk/${s}.glsl`,l=Qt.get(a)||jt[s];if(!l)throw new Error(`empty chunk, '${s}'`);return l}),Jg[t]=r+i}return Jg[t]}if(typeof WebGLRenderingContext<"u"){const n=WebGLRenderingContext.prototype,e=n.getShaderParameter;n.getShaderParameter=function(){return!Xe||e.apply(this,arguments)};const t=n.getShaderInfoLog;n.getShaderInfoLog=function(){return Xe?t.apply(this,arguments):""};const r=n.getProgramParameter;n.getProgramParameter=function(o,s){return!Xe&&s===n.LINK_STATUS||r.apply(this,arguments)};const i=n.getProgramInfoLog;n.getProgramInfoLog=function(){return Xe?i.apply(this,arguments):""}}const VE=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];VE.forEach(n=>{n.forEach(e=>{e[0]*=.0625,e[1]*=.0625})});class AG{constructor(e,t,r,i){this.canvas=document.createElement("canvas"),this._viewer=r,this._factor=W(i.factor,2),this._antialias=W(i.antialias,!1),this._onProgress=i.onProgress,this._onFinish=i.onFinish,this._antialias&&(this._factor*=2),this._n=this._factor*this._factor,this._width=this._viewer.width,this._height=this._viewer.height,this._antialias?(this.canvas.width=this._width*this._factor/2,this.canvas.height=this._height*this._factor/2):(this.canvas.width=this._width*this._factor,this.canvas.height=this._height*this._factor),this._ctx=this.canvas.getContext("2d"),this._viewerSampleLevel=r.sampleLevel,this._viewer.setSampling(-1)}_renderTile(e){const t=this._viewer,r=this._width,i=this._height,o=this._factor,s=e%o*r,a=Math.floor(e/o)*i;if(t.camera.setViewOffset(r*o,i*o,s,a,r,i),t.render(),this._antialias){const l=Math.round((s+r)/2)-Math.round(s/2),c=Math.round((a+i)/2)-Math.round(a/2);this._ctx.drawImage(t.renderer.domElement,Math.round(s/2),Math.round(a/2),l,c)}else this._ctx.drawImage(t.renderer.domElement,Math.floor(s),Math.floor(a),Math.ceil(r),Math.ceil(i));typeof this._onProgress=="function"&&this._onProgress(e+1,this._n,!1)}_finalize(){this._viewer.setSampling(this._viewerSampleLevel),this._viewer.camera.view=null,typeof this._onFinish=="function"&&this._onFinish(this._n+1,this._n,!1)}render(){for(let e=0;e<=this._n;++e)e===this._n?this._finalize():this._renderTile(e)}renderAsync(){let e=0;const t=this._n,r=()=>{e===t?this._finalize():this._renderTile(e),e+=1};for(let i=0;i<=t;++i)setTimeout(r,0)}}const Qg=2*Math.PI,GE=180/Math.PI;function e0(n,e,t=1,r=0,i){const o=i?i.length:n.length/t;let s=0,a=0;if(i)for(let l=0;l<o;++l){const c=(n[i[l]*t+r]+e)%e/e*Qg-Math.PI;s+=Math.cos(c),a+=Math.sin(c)}else for(let l=r;l<o;l+=t){const c=(n[l]+e)%e/e*Qg-Math.PI;s+=Math.cos(c),a+=Math.sin(c)}return s/=o,a/=o,(Math.atan2(a,s)+Math.PI)/Qg*e}function So(n,e,t,r=0){const i=n.length,o=t||new Float32Array(i);for(let s=0;s<i;s+=3)o[r+s+0]=(n[s+0]+e[s+0])/2,o[r+s+1]=(n[s+1]+e[s+1])/2,o[r+s+2]=(n[s+2]+e[s+2])/2;return o}function pm(n,e){const t=n.length,r=new Float32Array(t);for(let i=0;i<t;i+=3)r[i+0]=e[i+0]-n[i+0],r[i+1]=e[i+1]-n[i+1],r[i+2]=e[i+2]-n[i+2];return r}function fi(n,e,t){const r=t||new Float32Array(n);for(let i=0;i<n;++i)r[i]=e;return r}function un(n,e,t,r,i){const o=i||new Float32Array(3*n);for(let s=0;s<n;++s){const a=3*s;o[a+0]=e,o[a+1]=t,o[a+2]=r}return o}function Wc(n){const e=new Float32Array(n);for(let t=0;t<n;++t)e[t]=t;return e}function av(n,e,t=0,r){const i=r||new Float32Array(n*e);for(let o=0;o<n;++o){const s=t+o*e;for(let a=0;a<e;++a)i[s+a]=o}return i}function t0(n,e){const t=n.length,r=new Float32Array(t*e);for(let i=0;i<t;++i){const o=i*e,s=n[i];for(let a=0;a<e;++a)r[o+a]=s}return r}function Kn(n,e,t,r,i){for(let o=0;o<i;++o)e[r+o]=n[t+o]}function gw(n,e,t,r){Kn(n,n,e,t,r)}function Pf(n){let e=-1/0;for(let t=0,r=n.length;t<r;++t)n[t]>e&&(e=n[t]);return e}function Rf(n){let e=1/0;for(let t=0,r=n.length;t<r;++t)n[t]<e&&(e=n[t]);return e}function Zb(n,e=1,t=0){const r=n.length;let i=0;for(let o=t;o<r;o+=e)i+=n[o];return i}function If(n,e=1,t=0){return Zb(n,e,t)/(n.length/e)}const MG={trim:!1,factor:1,antialias:!1,transparent:!1,onProgress:void 0};function TG(n,e={}){const{trim:t,factor:r,antialias:i,transparent:o}=hi(e,MG),s=n.renderer,a=n.camera,l=s.getClearAlpha(),c=s.getClearColor(new _t);function u(m=!1){let f=r;i&&(f*=2),m&&(f=1/f),n.scene.traverse(function(v){const g=v.material;g&&g.linewidth&&(g.linewidth*=f),g&&g.uniforms&&g.uniforms.size&&g.uniforms.size.__seen===void 0&&(g.uniforms.size.value*=f,g.uniforms.size.__seen=!0),g&&g.uniforms&&g.uniforms.linewidth&&g.uniforms.linewidth.__seen===void 0&&(g.uniforms.linewidth.value*=f,g.uniforms.linewidth.__seen=!0)}),n.scene.traverse(function(v){const g=v.material;g&&g.uniforms&&g.uniforms.size&&delete g.uniforms.size.__seen,g&&g.uniforms&&g.uniforms.linewidth&&delete g.uniforms.linewidth.__seen})}function d(m){if(t){const f=c;return function(v,g,b,S,p){const y=v.height,w=v.width,x=v.getContext("2d").getImageData(0,0,w,y).data;let _,A,C,T;for(C=!1,A=0;A<y;A++){for(_=0;_<w;_++)if(T=4*(A*w+_),x[T]!==g||x[T+1]!==b||x[T+2]!==S||x[T+3]!==p){C=!0;break}if(C)break}const I=A;for(C=!1,_=0;_<w;_++){for(A=0;A<y;A++)if(T=4*(A*w+_),x[T]!==g||x[T+1]!==b||x[T+2]!==S||x[T+3]!==p){C=!0;break}if(C)break}const M=_;for(C=!1,A=y-1;A>=0;A--){for(_=w-1;_>=0;_--)if(T=4*(A*w+_),x[T]!==g||x[T+1]!==b||x[T+2]!==S||x[T+3]!==p){C=!0;break}if(C)break}const P=A;for(C=!1,_=w-1;_>=0;_--){for(A=y-1;A>=0;A--)if(T=4*(A*w+_),x[T]!==g||x[T+1]!==b||x[T+2]!==S||x[T+3]!==p){C=!0;break}if(C)break}const E=_,R=document.createElement("canvas");return R.width=E-M,R.height=P-I,R.getContext("2d").drawImage(v,M,I,R.width,R.height,0,0,R.width,R.height),R}(m,o?0:255*f.r,o?0:255*f.g,o?0:255*f.b,o?0:255)}return m}function h(m,f,v){typeof e.onProgress=="function"&&e.onProgress(m,f,v)}return new Promise(function(m,f){const v=new AG(s,a,n,{factor:r,antialias:i,onProgress:h,onFinish:function(g,b){d(v.canvas).toBlob(function(S){s.setClearAlpha(l),u(!0),n.requestRender(),h(b,b,!0),S?m(S):f("error creating image")},"image/png")}});s.setClearAlpha(o?0:1),u(),v.renderAsync()})}const n0=new te,vw=new at,bw=new at,yw=new Ut,gp=new at,vp=new at;function r0(n,e){gp.copy(e.projectionMatrix).invert(),vp.copy(e.projectionMatrix).transpose(),n.traverse(function(t){const r=t.material;if(!r)return;const i=r.uniforms;i&&(i.projectionMatrixInverse&&i.projectionMatrixInverse.value.copy(gp),i.projectionMatrixTranspose&&i.projectionMatrixTranspose.value.copy(vp))})}function _w(n,e,t){const r=n.createShader(t);return r?(n.shaderSource(r,e),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)?r:(console.log(`error compiling shader ${r}: ${n.getShaderInfoLog(r)}`),n.deleteShader(r),null)):void console.log(`error creating WebGL shader ${t}`)}function i0(n,e){const t=n.getExtension(e);return t||console.log(`extension '${e}' not available`),t}const EG=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function $h(n){const e=document.createElement("canvas");e.width=16,e.height=16,e.style.width="16px",e.style.height="16px";const t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return console.log(`error creating webgl context for ${n}`),!1;if(!(t instanceof WebGLRenderingContext))return console.log("Got unexpected type for WebGL rendering context"),!1;i0(t,"OES_texture_float"),i0(t,"OES_texture_half_float"),i0(t,"WEBGL_color_buffer_float");const r=_w(t,`
attribute vec4 a_position;

void main() {
  gl_Position = a_position;
}`,t.VERTEX_SHADER),i=_w(t,`
precision mediump float;
uniform vec4 u_color;
uniform sampler2D u_texture;

void main() {
  gl_FragColor = texture2D(u_texture, vec2(0.5, 0.5)) * u_color;
}`,t.FRAGMENT_SHADER);if(!r||!i)return!1;const o=function(f,v,g,b){const S=f.createProgram();return S?(v.forEach(p=>f.attachShader(S,p)),f.linkProgram(S),f.getProgramParameter(S,f.LINK_STATUS)?S:(console.log(`error linking program: ${f.getProgramInfoLog(S)}`),f.deleteProgram(S),null)):void console.log("error creating WebGL program")}(t,[r,i]);if(!o)return console.log("error creating WebGL program"),!1;t.useProgram(o);const s=t.getAttribLocation(o,"a_position"),a=t.getUniformLocation(o,"u_color");if(!a)return console.log("error getting 'u_color' uniform location"),!1;const l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,EG,t.STATIC_DRAW),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0);const c=t.createTexture(),u=new Uint8Array([255,255,255,255]);t.bindTexture(t.TEXTURE_2D,c),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,u);const d=t.createTexture();t.bindTexture(t.TEXTURE_2D,d),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,n,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const h=t.createFramebuffer();if(t.bindFramebuffer(t.FRAMEBUFFER,h),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,d,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)return console.log(`error creating framebuffer for ${n}`),!1;t.bindTexture(t.TEXTURE_2D,c),t.uniform4fv(a,[0,10,20,1]),t.drawArrays(t.TRIANGLES,0,6),t.bindTexture(t.TEXTURE_2D,d),t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(1,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.uniform4fv(a,[0,.1,.05,1]),t.drawArrays(t.TRIANGLES,0,6);const m=new Uint8Array(4);if(t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,m),m[0]!==0||m[1]<248||m[2]<248||m[3]<254)return console.log(`not able to actually render to ${n} texture`),!1;if(n===t.FLOAT){t.bindFramebuffer(t.FRAMEBUFFER,h);const f=new Float32Array(4);t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,f);const v=t.getError();if(v)return console.log(`error reading pixels as float: '${function(g,b){switch(b){case g.NO_ERROR:return"no error";case g.INVALID_ENUM:return"invalid enum";case g.INVALID_VALUE:return"invalid value";case g.INVALID_OPERATION:return"invalid operation";case g.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case g.OUT_OF_MEMORY:return"out of memory";case g.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}(t,v)}'`),!1}return!0}const PG=new Float32Array(100),RG=new Uint8Array(100),xw=[12,7,13,17,11,6,8,18,16,2,14,22,10,1,3,9,19,23,21,15,5,0,4,24,20],Hh=new at;function IG(n,e,t,r,i){const o=i.uniforms,s=[];if(o&&(o.objectId&&(o.objectId.value=uo?this.id:this.id/255,s.push("objectId")),(o.modelViewMatrixInverse||o.modelViewMatrixInverseTranspose||o.modelViewProjectionMatrix||o.modelViewProjectionMatrixInverse)&&this.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,this.matrixWorld),o.modelViewMatrixInverse&&(o.modelViewMatrixInverse.value.copy(this.modelViewMatrix).invert(),s.push("modelViewMatrixInverse")),o.modelViewMatrixInverseTranspose&&(o.modelViewMatrixInverse?o.modelViewMatrixInverseTranspose.value.copy(o.modelViewMatrixInverse.value).transpose():o.modelViewMatrixInverseTranspose.value.copy(this.modelViewMatrix).invert().transpose(),s.push("modelViewMatrixInverseTranspose")),o.modelViewProjectionMatrix&&(o.modelViewProjectionMatrix.value.multiplyMatrices(t.projectionMatrix,this.modelViewMatrix),s.push("modelViewProjectionMatrix")),o.modelViewProjectionMatrixInverse&&(o.modelViewProjectionMatrix?(Hh.copy(o.modelViewProjectionMatrix.value),o.modelViewProjectionMatrixInverse.value.copy(Hh.invert())):(Hh.multiplyMatrices(t.projectionMatrix,this.modelViewMatrix),o.modelViewProjectionMatrixInverse.value.copy(Hh.invert())),s.push("modelViewProjectionMatrixInverse")),s.length)){const a=n.properties.get(i);if(a.program){const l=n.getContext(),c=a.program;l.useProgram(c.program);const u=c.getUniforms();s.forEach(function(d){u.setValue(l,d,o[d].value)})}}}class DG{constructor(e){if(this.boundingBox=new Nn,this.boundingBoxSize=new te,this.boundingBoxLength=0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this.distVector=new te,this.signals={ticked:new Ft.Signal,rendered:new Ft.Signal},typeof e=="string"){const t=document.getElementById(e);this.container=t===null?document.createElement("div"):t}else e instanceof HTMLElement?this.container=e:this.container=document.createElement("div");if(this.container===document.body)this.width=window.innerWidth||1,this.height=window.innerHeight||1;else{const t=this.container.getBoundingClientRect();this.width=t.width||1,this.height=t.height||1,this.container.style.overflow="hidden"}this.wrapper=document.createElement("div"),this.wrapper.style.position="relative",this.container.appendChild(this.wrapper),this._initParams(),this._initStats(),this._initCamera(),this._initScene(),this._initRenderer()!==!1?(this._initHelper(),this.setBackground(),this.setFog(),this.animate=this.animate.bind(this)):Be.error("Viewer: could not initialize renderer")}_initParams(){this.parameters={fogColor:new _t(0),fogNear:50,fogFar:100,backgroundColor:new _t(0),cameraType:"perspective",cameraFov:40,cameraEyeSep:.3,cameraZ:-80,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",lightColor:new _t(14540253),lightIntensity:1.2,ambientColor:new _t(14540253),ambientIntensity:.3,sampleLevel:0,outputColorSpace:"srgb-linear"}}_initCamera(){const e=new te(0,0,0),{width:t,height:r}=this;this.perspectiveCamera=new qr(this.parameters.cameraFov,t/r),this.perspectiveCamera.position.z=this.parameters.cameraZ,this.perspectiveCamera.lookAt(e),this.orthographicCamera=new gd(t/-2,t/2,r/2,r/-2),this.orthographicCamera.position.z=this.parameters.cameraZ,this.orthographicCamera.lookAt(e),this.stereoCamera=new NV,this.stereoCamera.aspect=.5,this.stereoCamera.eyeSep=this.parameters.cameraEyeSep;const i=this.parameters.cameraType;if(i==="orthographic")this.camera=this.orthographicCamera;else{if(i!=="perspective"&&i!=="stereo")throw new Error(`Unknown cameraType '${i}'`);this.camera=this.perspectiveCamera}this.camera.updateProjectionMatrix()}_initStats(){this.stats=new SG}_initScene(){this.scene||(this.scene=new Y2,this.scene.name="scene"),this.rotationGroup=new mn,this.rotationGroup.name="rotationGroup",this.scene.add(this.rotationGroup),this.translationGroup=new mn,this.translationGroup.name="translationGroup",this.rotationGroup.add(this.translationGroup),this.modelGroup=new mn,this.modelGroup.name="modelGroup",this.translationGroup.add(this.modelGroup),this.pickingGroup=new mn,this.pickingGroup.name="pickingGroup",this.translationGroup.add(this.pickingGroup),this.backgroundGroup=new mn,this.backgroundGroup.name="backgroundGroup",this.translationGroup.add(this.backgroundGroup),this.helperGroup=new mn,this.helperGroup.name="helperGroup",this.translationGroup.add(this.helperGroup),this.scene.fog=new $b(this.parameters.fogColor.getHex()),this.directionalLight=new kV(this.parameters.lightColor.getHex(),this.parameters.lightIntensity),this.scene.add(this.directionalLight),this.ambientLight=new BV(this.parameters.ambientColor.getHex(),this.parameters.ambientIntensity),this.scene.add(this.ambientLight)}_initRenderer(){const e=window.devicePixelRatio,{width:t,height:r}=this;try{this.renderer=new TE({preserveDrawingBuffer:!0,alpha:!0,antialias:!0})}catch{return this.wrapper.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100%;"><p style="padding:15px;text-align:center;">Your browser/graphics card does not seem to support <a target="_blank" href="https://en.wikipedia.org/wiki/WebGL">WebGL</a>.<br/><br/>Find out how to get it <a target="_blank" href="http://get.webgl.org/">here</a>.</p></div>',!1}this.renderer.setPixelRatio(e),this.renderer.setSize(t,r),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,this.renderer.outputColorSpace=this.parameters.outputColorSpace,this.renderer.useLegacyLights=!0;const i=this.renderer.getContext();this.renderer.capabilities.isWebGL2?(pw(!0),fw(this.renderer.extensions.get("EXT_color_buffer_float")),this.supportsHalfFloat=!0):(pw(this.renderer.extensions.get("EXT_frag_depth")),this.renderer.extensions.get("OES_element_index_uint"),fw(this.renderer.extensions.get("OES_texture_float")&&this.renderer.extensions.get("WEBGL_color_buffer_float")||this.renderer.extensions.get("OES_texture_float")&&$h(i.FLOAT)),this.renderer.extensions.get("OES_texture_float"),this.supportsHalfFloat=this.renderer.extensions.get("OES_texture_half_float")&&$h(36193)),this.wrapper.appendChild(this.renderer.domElement);const o=t*e,s=r*e;Xe&&console.log(JSON.stringify({Browser:BE,OES_texture_float:!!this.renderer.extensions.get("OES_texture_float"),OES_texture_half_float:!!this.renderer.extensions.get("OES_texture_half_float"),WEBGL_color_buffer_float:!!this.renderer.extensions.get("WEBGL_color_buffer_float"),"testTextureSupport Float":$h(i.FLOAT),"testTextureSupport HalfFloat":$h(36193),"this.supportsHalfFloat":this.supportsHalfFloat,SupportsReadPixelsFloat:uo},null,2)),this.pickingTarget=new xo(o,s,{minFilter:gn,magFilter:gn,stencilBuffer:!1,format:Xr,type:uo?qi:Zi}),this.pickingTarget.texture.generateMipmaps=!1,this.pickingTarget.texture.colorSpace=this.parameters.outputColorSpace,this.renderer.setRenderTarget(this.pickingTarget),this.renderer.clear(),this.renderer.setRenderTarget(null),this.sampleTarget=new xo(o,s,{minFilter:Cr,magFilter:Cr,format:Xr,type:this.supportsHalfFloat?nl:uo?qi:Zi}),this.sampleTarget.texture.colorSpace=this.parameters.outputColorSpace,this.holdTarget=new xo(o,s,{minFilter:gn,magFilter:gn,format:Xr,type:this.supportsHalfFloat?nl:uo?qi:Zi}),this.holdTarget.texture.colorSpace=this.parameters.outputColorSpace,this.compositeUniforms={tForeground:new pp(this.sampleTarget.texture),scale:new pp(1)},this.compositeMaterial=new Mi({uniforms:this.compositeUniforms,vertexShader:Au("Quad.vert"),fragmentShader:Au("Quad.frag"),premultipliedAlpha:!0,transparent:!0,blending:W1,depthTest:!1,depthWrite:!1}),this.compositeCamera=new gd(-1,1,1,-1,0,1),this.compositeScene=new Y2,this.compositeScene.name="compositeScene",this.compositeScene.add(new yo(new cm(2,2),this.compositeMaterial))}_initHelper(){const e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),t=new Float32Array(24),r=new tr;r.setIndex(new Wn(e,1)),r.setAttribute("position",new Wn(t,3));const i=new Mi({uniforms:{uColor:{value:new _t("skyblue")}},vertexShader:Au("BasicLine.vert"),fragmentShader:Au("BasicLine.frag")});this.boundingBoxMesh=new rv(r,i),this.helperGroup.add(this.boundingBoxMesh)}updateHelper(){const e=this.boundingBoxMesh.geometry.attributes.position,t=e.array,{min:r,max:i}=this.boundingBox;t[0]=i.x,t[1]=i.y,t[2]=i.z,t[3]=r.x,t[4]=i.y,t[5]=i.z,t[6]=r.x,t[7]=r.y,t[8]=i.z,t[9]=i.x,t[10]=r.y,t[11]=i.z,t[12]=i.x,t[13]=i.y,t[14]=r.z,t[15]=r.x,t[16]=i.y,t[17]=r.z,t[18]=r.x,t[19]=r.y,t[20]=r.z,t[21]=i.x,t[22]=r.y,t[23]=r.z,e.needsUpdate=!0,this.boundingBox.isEmpty()||this.boundingBoxMesh.geometry.computeBoundingSphere()}get cameraDistance(){return Math.abs(this.camera.position.z)}set cameraDistance(e){this.camera.position.z=-e}add(e,t){t?t.forEach(r=>this.addBuffer(e,r)):this.addBuffer(e),e.group.name="meshGroup",e.wireframeGroup.name="wireframeGroup",e.parameters.background?(this.backgroundGroup.add(e.group),this.backgroundGroup.add(e.wireframeGroup)):(this.modelGroup.add(e.group),this.modelGroup.add(e.wireframeGroup)),e.pickable&&this.pickingGroup.add(e.pickingGroup),Xe&&this.updateHelper()}addBuffer(e,t){function r(s){s instanceof mn?s.children.forEach(r):(s.userData.buffer=e,s.userData.instance=t,s.onBeforeRender=IG)}const i=e.getMesh();t&&i.applyMatrix4(t.matrix),r(i),e.group.add(i);const o=e.getWireframeMesh();if(t&&(o.matrix.copy(i.matrix),o.position.copy(i.position),o.quaternion.copy(i.quaternion),o.scale.copy(i.scale)),r(o),e.wireframeGroup.add(o),e.pickable){const s=e.getPickingMesh();t&&(s.matrix.copy(i.matrix),s.position.copy(i.position),s.quaternion.copy(i.quaternion),s.scale.copy(i.scale)),r(s),e.pickingGroup.add(s)}t?this._updateBoundingBox(e.geometry,e.matrix,t.matrix):this._updateBoundingBox(e.geometry,e.matrix)}remove(e){this.translationGroup.children.forEach(function(t){t.remove(e.group),t.remove(e.wireframeGroup)}),e.pickable&&this.pickingGroup.remove(e.pickingGroup),this.updateBoundingBox(),Xe&&this.updateHelper()}_updateBoundingBox(e,t,r){const i=this.boundingBox;function o(a,l,c){a.boundingBox==null&&a.computeBoundingBox();const u=a.boundingBox.clone();l&&u.applyMatrix4(l),c&&u.applyMatrix4(c),u.min.equals(u.max)&&u.expandByScalar(5),i.union(u)}function s(a){if(a.geometry!==void 0){let l,c;a.userData.buffer&&(l=a.userData.buffer.matrix),a.userData.instance&&(c=a.userData.instance.matrix),o(a.geometry,l,c)}}e?o(e,t,r):(i.makeEmpty(),this.modelGroup.traverse(s),this.backgroundGroup.traverse(s)),i.getSize(this.boundingBoxSize),this.boundingBoxLength=this.boundingBoxSize.length()}updateBoundingBox(){this._updateBoundingBox(),Xe&&this.updateHelper()}getPickingPixels(){const{width:e,height:t}=this,r=e*t*4,i=uo?new Float32Array(r):new Uint8Array(r);return this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,0,0,e,t,i),i}getImage(e){return new Promise(t=>{if(e){const{width:r,height:i}=this,o=r*i*4;let s=this.getPickingPixels();if(uo){const u=new Uint8Array(o);for(let d=0;d<o;++d)u[d]=Math.round(255*s[d]);s=u}const a=document.createElement("canvas");a.width=r,a.height=i;const l=a.getContext("2d"),c=l.getImageData(0,0,r,i);c.data.set(s),l.putImageData(c,0,0),a.toBlob(t,"image/png")}else this.renderer.domElement.toBlob(t,"image/png")})}makeImage(e={}){return TG(this,e)}setLight(e,t,r,i){const o=this.parameters;e!==void 0&&o.lightColor.set(e),t!==void 0&&(o.lightIntensity=t),r!==void 0&&o.ambientColor.set(r),i!==void 0&&(o.ambientIntensity=i),this.requestRender()}setFog(e,t,r){const i=this.parameters;e!==void 0&&i.fogColor.set(e),t!==void 0&&(i.fogNear=t),r!==void 0&&(i.fogFar=r),this.requestRender()}setBackground(e){const t=this.parameters;e&&t.backgroundColor.set(e),this.setFog(t.backgroundColor),this.renderer.setClearColor(t.backgroundColor,0),this.renderer.domElement.style.backgroundColor=t.backgroundColor.getStyle(),this.requestRender()}setSampling(e){e!==void 0&&(this.parameters.sampleLevel=e,this.sampleLevel=e),this.requestRender()}setOutputEncoding(e){this.parameters.outputColorSpace=e,this.renderer.outputColorSpace=e,this.pickingTarget.texture.colorSpace=e,this.sampleTarget.texture.colorSpace=e,this.holdTarget.texture.colorSpace=e}setColorWorkflow(e){if(e!="srgb-linear"&&e!="srgb")throw new Error(`setColorWorkflow: invalid color workflow ${e}`);FE=e=="srgb-linear"?"linear":"sRGB",this.setOutputEncoding(e=="srgb-linear"?"srgb":"srgb-linear"),this.requestRender()}setCamera(e,t,r){const i=this.parameters;if(e&&(i.cameraType=e),t&&(i.cameraFov=t),r&&(i.cameraEyeSep=r),i.cameraType==="orthographic")this.camera!==this.orthographicCamera&&(this.camera=this.orthographicCamera,this.camera.position.copy(this.perspectiveCamera.position),this.camera.up.copy(this.perspectiveCamera.up),this.updateZoom());else{if(i.cameraType!=="perspective"&&i.cameraType!=="stereo")throw new Error(`Unknown cameraType '${i.cameraType}'`);this.camera!==this.perspectiveCamera&&(this.camera=this.perspectiveCamera,this.camera.position.copy(this.orthographicCamera.position),this.camera.up.copy(this.orthographicCamera.up))}this.perspectiveCamera.fov=i.cameraFov,this.stereoCamera.eyeSep=i.cameraEyeSep,this.camera.updateProjectionMatrix(),this.requestRender()}setClip(e,t,r,i,o){const s=this.parameters;e!==void 0&&(s.clipNear=e),t!==void 0&&(s.clipFar=t),r!==void 0&&(s.clipDist=r),i!==void 0&&(s.clipMode=i),o!==void 0&&(s.clipScale=o),this.requestRender()}setSize(e,t){this.width=e||1,this.height=t||1,this.perspectiveCamera.aspect=this.width/this.height,this.orthographicCamera.left=-this.width/2,this.orthographicCamera.right=this.width/2,this.orthographicCamera.top=this.height/2,this.orthographicCamera.bottom=-this.height/2,this.camera.updateProjectionMatrix();const r=window.devicePixelRatio;this.renderer.setPixelRatio(r),this.renderer.setSize(e,t);const i=this.width*r,o=this.height*r;this.pickingTarget.setSize(i,o),this.sampleTarget.setSize(i,o),this.holdTarget.setSize(i,o),this.requestRender()}handleResize(){if(this.container===document.body)this.setSize(window.innerWidth,window.innerHeight);else{const e=this.container.getBoundingClientRect();this.setSize(e.width,e.height)}}updateInfo(e){const{memory:t,render:r}=this.info;if(e)t.programs=0,t.geometries=0,t.textures=0,r.calls=0,r.vertices=0,r.points=0;else{const i=this.renderer.info,o=i.memory,s=i.render;t.geometries=o.geometries,t.textures=o.textures,r.calls+=s.calls,r.faces+=s.triangles,r.points+=s.points}}animate(){if(this.signals.ticked.dispatch(this.stats),window.performance.now()-this.stats.startTime>500&&!this.isStill&&this.sampleLevel<3&&this.sampleLevel!==-1){const e=this.sampleLevel;this.sampleLevel=3,this.renderPending=!0,this.render(),this.isStill=!0,this.sampleLevel=e,Xe&&Be.log("rendered still frame")}this.frameRequest=window.requestAnimationFrame(this.animate)}pick(e,t){if(this.parameters.cameraType==="stereo")return{pid:0,instance:void 0,picker:void 0};e*=window.devicePixelRatio,t*=window.devicePixelRatio,e=Math.max(e-2,0),t=Math.max(t-2,0);let r,i,o=0;const s=uo?PG:RG;this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,e,t,5,5,s);for(let a=0;a<xw.length;a++){const l=4*xw[a],c=Math.round(s[l+3]),u=this.pickingGroup.getObjectById(c);u&&(r=u.userData.instance,i=u.userData.buffer.picking,o=uo?Math.round(255*s[l])<<16&16711680|Math.round(255*s[l+1])<<8&65280|255&Math.round(255*s[l+2]):s[l]<<16|s[l+1]<<8|s[l+2])}return{pid:o,instance:r,picker:i}}requestRender(){this.renderPending||(window.performance.now()-this.stats.startTime>22&&(this.stats.begin(),this.isStill=!1),this.renderPending=!0,window.requestAnimationFrame(()=>{this.render(),this.stats.update()}))}updateZoom(){const e=kn(this.perspectiveCamera.fov),t=2*Math.tan(e/2)*this.cameraDistance;this.orthographicCamera.zoom=this.height/t}absoluteToRelative(e){return 50*(1-e/this.bRadius)}relativeToAbsolute(e){return this.bRadius*(1-e/50)}__updateClipping(){const e=this.parameters;this.bRadius=Math.max(10,.5*this.boundingBoxLength),isFinite(this.bRadius)||(this.bRadius=50),this.camera.getWorldPosition(this.distVector),this.cDist=this.distVector.length(),this.cDist||(this.cameraDistance=Math.abs(e.cameraZ),this.cDist=Math.abs(e.cameraZ));const t=this.scene.fog;if(t.color.set(e.fogColor),e.clipMode==="camera")this.camera.near=e.clipNear,this.camera.far=e.clipFar,t.near=e.fogNear,t.far=e.fogFar;else if(e.clipScale==="absolute")this.camera.near=this.cDist-e.clipNear,this.camera.far=this.cDist+e.clipFar,t.near=this.cDist-e.fogNear,t.far=this.cDist+e.fogFar;else{const r=(50-e.clipNear)/50,i=-(50-e.clipFar)/50;this.camera.near=this.cDist-this.bRadius*r,this.camera.far=this.cDist+this.bRadius*i;const o=(50-e.fogNear)/50,s=-(50-e.fogFar)/50;t.near=this.cDist-this.bRadius*o,t.far=this.cDist+this.bRadius*s}e.clipMode!=="camera"&&(this.camera.type==="PerspectiveCamera"?(this.camera.near=Math.max(.1,e.clipDist,this.camera.near),this.camera.far=Math.max(1,this.camera.far),t.near=Math.max(.1,t.near),t.far=Math.max(1,t.far)):this.camera.type==="OrthographicCamera"&&e.clipDist>0&&(this.camera.near=Math.max(e.clipDist,this.camera.near)))}__updateCamera(){const e=this.camera;e.updateMatrix(),e.updateMatrixWorld(!0),e.updateProjectionMatrix(),function(t,r,i,o,s){let a=new Ut;i.getSize(a);const l=a.height,c=i.getPixelRatio(),u=r.type==="OrthographicCamera";yw.set(a.width,a.height),gp.copy(r.projectionMatrix).invert(),vp.copy(r.projectionMatrix).transpose(),t.traverse(function(d){const h=d.material;if(!h)return;const m=h.uniforms;if(m){if(h.clipNear){const f=(50-h.clipNear)/50,v=o-s*f;m.clipNear.value=v}m.canvasHeight&&(m.canvasHeight.value=l),m.resolution&&m.resolution.value.copy(yw),m.pixelRatio&&(m.pixelRatio.value=c),m.projectionMatrixInverse&&m.projectionMatrixInverse.value.copy(gp),m.projectionMatrixTranspose&&m.projectionMatrixTranspose.value.copy(vp),m.ortho&&(m.ortho.value=u)}})}(this.scene,e,this.renderer,this.cDist,this.bRadius),function(t,r){t.traverseVisible(function(i){if(!(i instanceof EE&&i.userData.buffer.parameters.sortParticles))return;const o=i.geometry.attributes,s=o.position.count;if(s===0)return;let a,l,c,u,d,h,m,f;vw.multiplyMatrices(r.matrixWorldInverse,i.matrixWorld),bw.multiplyMatrices(r.projectionMatrix,vw),i.userData.sortData?(a=i.userData.sortData,c=a.__zArray,l=a.__sortArray,u=a.__cmpFn):(c=new Float32Array(s),l=new Uint32Array(s),u=function(v,g){const b=c[v],S=c[g];return b>S?1:b<S?-1:0},a={__zArray:c,__sortArray:l,__cmpFn:u},i.userData.sortData=a);for(let v=0;v<s;++v)n0.fromArray(o.position.array,3*v),n0.applyMatrix4(bw),c[v]=-n0.z,l[v]=v;(function(v,g,b=0,S){g=g||function(I,M){return I>M?1:I<M?-1:0};const p=[];let y,w,x,_=-1,A=b,C=S=(S||v.length)-1;function T(I,M){const P=v[I];v[I]=v[M],v[M]=P}for(;;)if(C-A<=25){for(let I=A+1;I<=C;++I){for(y=v[I],w=I-1;w>=A&&g(v[w],y)>0;)v[w+1]=v[w],--w;v[w+1]=y}if(_===-1)break;C=p[_--],A=p[_--]}else{for(w=A+1,x=C,T(A+C>>1,w),g(v[A],v[C])>0&&T(A,C),g(v[w],v[C])>0&&T(w,C),g(v[A],v[w])>0&&T(A,w),y=v[w];;){do w++;while(g(v[w],y)<0);do x--;while(g(v[x],y)>0);if(x<w)break;T(w,x)}v[A+1]=v[x],v[x]=y,C-w+1>=x-A?(p[++_]=w,p[++_]=C,C=x-1):(p[++_]=A,p[++_]=x-1,A=w)}})(l,u);for(let v in o){const g=o[v],b=g.array,S=g.itemSize;a[v]||(a[v]=new Float32Array(S*s)),f=a[v],a[v]=b;for(let p=0;p<s;++p){d=l[p];for(let y=0;y<S;++y)h=d*S+y,m=p*S+y,f[m]=b[h]}o[v].array=f,o[v].needsUpdate=!0}})}(this.scene,e)}__setVisibility(e,t,r,i){this.modelGroup.visible=e,this.pickingGroup.visible=t,this.backgroundGroup.visible=r,this.helperGroup.visible=i}__updateLights(){this.directionalLight.color.set(this.parameters.lightColor),this.directionalLight.intensity=this.parameters.lightIntensity,this.distVector.copy(this.camera.position).setLength(100*this.boundingBoxLength),this.directionalLight.position.copy(this.camera.position).add(this.distVector),this.ambientLight.color.set(this.parameters.ambientColor),this.ambientLight.intensity=this.parameters.ambientIntensity}__renderPickingGroup(e){this.renderer.setRenderTarget(this.pickingTarget||null),this.renderer.clear(),this.__setVisibility(!1,!0,!1,!1),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()}__renderModelGroup(e,t){this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.__setVisibility(!1,!1,!0,!1),this.renderer.render(this.scene,e),this.renderer.clear(!1,!0,!0),this.updateInfo(),this.__setVisibility(!0,!1,!1,Xe),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()}__renderSuperSample(e,t){const r=VE[Math.max(0,Math.min(this.sampleLevel,5))],i=1/r.length;this.compositeUniforms.tForeground.value=this.sampleTarget.texture;let o=this.sampleTarget.width;const s=this.sampleTarget.height;this.parameters.cameraType==="stereo"&&(o/=2);for(let a=0;a<r.length;++a){const l=r[a];e.setViewOffset(o,s,l[0],l[1],o,s),e.updateProjectionMatrix(),r0(this.scene,e);let c=i;c+=.03125*((a+.5)/r.length-.5),this.compositeUniforms.scale.value=c,this.__renderModelGroup(e,this.sampleTarget),this.renderer.setRenderTarget(this.holdTarget),a===0&&this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}this.compositeUniforms.scale.value=1,this.compositeUniforms.tForeground.value=this.holdTarget.texture,e.clearViewOffset(),this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}__renderStereo(e=!1,t){const r=this.stereoCamera;r.update(this.perspectiveCamera);const i=this.renderer;let o=new Ut;i.getSize(o),i.setScissorTest(!0),i.setScissor(0,0,o.width/2,o.height),i.setViewport(0,0,o.width/2,o.height),r0(this.scene,r.cameraL),this.__render(e,r.cameraL),i.setScissor(o.width/2,0,o.width/2,o.height),i.setViewport(o.width/2,0,o.width/2,o.height),r0(this.scene,r.cameraR),this.__render(e,r.cameraR),i.setScissorTest(!1),i.setViewport(0,0,o.width,o.height)}__render(e=!1,t,r){e?this.lastRenderedPicking||this.__renderPickingGroup(t):this.sampleLevel>0&&this.parameters.cameraType!=="stereo"?this.__renderSuperSample(t,r):this.__renderModelGroup(t,r)}render(e=!1,t){if(this.rendering)Be.warn("'tried to call 'render' from within 'render'");else{this.rendering=!0;try{this.__updateClipping(),this.__updateCamera(),this.__updateLights(),this.updateInfo(!0),this.parameters.cameraType==="stereo"?this.__renderStereo(e,t):this.__render(e,this.camera,t),this.lastRenderedPicking=e}finally{this.rendering=!1,this.renderPending=!1}this.signals.rendered.dispatch()}}clear(){Be.log("scene cleared"),this.scene.remove(this.rotationGroup),this._initScene(),this.renderer.clear()}dispose(){this.renderer.dispose(),window.cancelAnimationFrame(this.frameRequest)}}function ww(n){const e=n.touches[0].pageX-n.touches[1].pageX,t=n.touches[0].pageY-n.touches[1].pageY;return Math.sqrt(e*e+t*t)}class LG{constructor(e,t={}){this.domElement=e,this.signals={moved:new Ft.Signal,scrolled:new Ft.Signal,dragged:new Ft.Signal,dropped:new Ft.Signal,clicked:new Ft.Signal,hovered:new Ft.Signal,doubleClicked:new Ft.Signal},this.position=new Ut,this.prevPosition=new Ut,this.down=new Ut,this.canvasPosition=new Ut,this.prevClickCP=new Ut,this.moving=!1,this.hovering=!0,this.scrolled=!1,this.lastMoved=1/0,this.which=0,this.buttons=0,this.pressed=!1,this.altKey=!1,this.ctrlKey=!1,this.metaKey=!1,this.shiftKey=!1,this.domElement.style.touchAction="none",this.hoverTimeout=W(t.hoverTimeout,50),this.handleScroll=W(t.handleScroll,!0),this.doubleClickSpeed=W(t.doubleClickSpeed,500),this._listen=this._listen.bind(this),this._onMousewheel=this._onMousewheel.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMousedown=this._onMousedown.bind(this),this._onMouseup=this._onMouseup.bind(this),this._onContextmenu=this._onContextmenu.bind(this),this._onTouchstart=this._onTouchstart.bind(this),this._onTouchend=this._onTouchend.bind(this),this._onTouchmove=this._onTouchmove.bind(this),this._listen();const r={passive:!1};document.addEventListener("mousewheel",this._onMousewheel,r),document.addEventListener("wheel",this._onMousewheel,r),document.addEventListener("MozMousePixelScroll",this._onMousewheel,r),document.addEventListener("mousemove",this._onMousemove,r),document.addEventListener("mousedown",this._onMousedown,r),document.addEventListener("mouseup",this._onMouseup,r),document.addEventListener("contextmenu",this._onContextmenu,r),document.addEventListener("touchstart",this._onTouchstart,r),document.addEventListener("touchend",this._onTouchend,r),document.addEventListener("touchmove",this._onTouchmove,r)}get key(){let e=0;return this.altKey&&(e+=1),this.ctrlKey&&(e+=2),this.metaKey&&(e+=4),this.shiftKey&&(e+=8),e}setParameters(e={}){this.hoverTimeout=W(e.hoverTimeout,this.hoverTimeout)}_listen(){const e=window.performance.now(),t=this.canvasPosition;this.doubleClickPending&&e-this.lastClicked>this.doubleClickSpeed&&(this.doubleClickPending=!1),e-this.lastMoved>this.hoverTimeout&&(this.moving=!1),(this.scrolled||!this.moving&&!this.hovering)&&(this.scrolled=!1,this.hoverTimeout!==-1&&this.overElement&&(this.hovering=!0,this.signals.hovered.dispatch(t.x,t.y))),this.frameRequest=window.requestAnimationFrame(this._listen)}_onMousewheel(e){if(e.target!==this.domElement||!this.handleScroll)return;e.preventDefault(),this._setKeys(e);let t=0;"deltaY"in e&&"deltaMode"in e&&e.deltaY!==void 0&&e.deltaMode!==void 0?t=e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?.025*-e.deltaY:e.deltaMode===WheelEvent.DOM_DELTA_LINE?-e.deltaY*(2.5/3):2.5*-e.deltaY:"deltaY"in e&&!("detail"in e)?t=.025*-e.deltaY:e.wheelDelta!==void 0?t=.025*-e.wheelDelta:e.wheelDeltaY!==void 0?t=.025*-e.wheelDeltaY:e.detail!==void 0&&(t=-e.detail/3),this.signals.scrolled.dispatch(t),setTimeout(()=>{this.scrolled=!0},this.hoverTimeout)}_onMousemove(e){e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,this._setKeys(e),this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.clientX,e.clientY),this._setCanvasPosition(e);const t=this.prevPosition.x-this.position.x,r=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,r),this.pressed&&this.signals.dragged.dispatch(t,r)}_onMousedown(e){e.target===this.domElement&&(e.preventDefault(),this._setKeys(e),this.moving=!1,this.hovering=!1,this.down.set(e.clientX,e.clientY),this.position.set(e.clientX,e.clientY),this.which=e.which,this.buttons=function(t){if(typeof t=="object"){if("buttons"in t)return t.buttons;if("which"in t){const r=t.which;if(r===2)return 4;if(r===3)return 2;if(r>0)return 1<<r-1}else if("button"in t){const r=t.button;if(r===1)return 4;if(r===2)return 2;if(r>=0)return 1<<r}}return 0}(e),this.pressed=!0,this._setCanvasPosition(e))}_onMouseup(e){e.target===this.domElement&&e.preventDefault(),this._setKeys(e);const t=this.canvasPosition;this._distance()<4&&(this.lastClicked=window.performance.now(),this.doubleClickPending&&this.prevClickCP.distanceTo(t)<4&&(this.signals.doubleClicked.dispatch(t.x,t.y),this.doubleClickPending=!1),this.signals.clicked.dispatch(t.x,t.y),this.doubleClickPending=!0,this.prevClickCP.copy(t)),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onContextmenu(e){e.target===this.domElement&&e.preventDefault()}_onTouchstart(e){if(e.target===this.domElement)switch(e.preventDefault(),this.pressed=!0,e.touches.length){case 1:this.moving=!1,this.hovering=!1,this.down.set(e.touches[0].pageX,e.touches[0].pageY),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);break;case 2:this.down.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.lastTouchDistance=ww(e)}}_onTouchend(e){e.target===this.domElement&&e.preventDefault(),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onTouchmove(e){switch(e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,e.touches.length){case 1:{this._setKeys(e),this.which=1,this.buttons=1,this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);const t=this.prevPosition.x-this.position.x,r=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,r),this.pressed&&this.signals.dragged.dispatch(t,r);break}case 2:{const t=ww(e),r=t-this.lastTouchDistance;if(this.lastTouchDistance=t,this.prevPosition.copy(this.position),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),Math.abs(r)>2&&this.handleScroll&&this.position.distanceTo(this.prevPosition)<2)this.which=0,this.buttons=0,this.signals.scrolled.dispatch(r/2);else{this.which=3,this.buttons=2;const i=this.prevPosition.x-this.position.x,o=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(i,o),this.pressed&&this.signals.dragged.dispatch(i,o)}}}}_distance(){return this.position.distanceTo(this.down)}_setCanvasPosition(e){const t=this.domElement.getBoundingClientRect();let r,i;"clientX"in e&&"clientY"in e?(r=e.clientX-t.left,i=e.clientY-t.top):(r=e.offsetX,i=e.offsetY),this.canvasPosition.set(r,t.height-i)}_setKeys(e){this.altKey=e.altKey,this.ctrlKey=e.ctrlKey,this.metaKey=e.metaKey,this.shiftKey=e.shiftKey}dispose(){document.removeEventListener("mousewheel",this._onMousewheel),document.removeEventListener("wheel",this._onMousewheel),document.removeEventListener("MozMousePixelScroll",this._onMousewheel),document.removeEventListener("mousemove",this._onMousemove),document.removeEventListener("mousedown",this._onMousedown),document.removeEventListener("mouseup",this._onMouseup),document.removeEventListener("contextmenu",this._onContextmenu),document.removeEventListener("touchstart",this._onTouchstart),document.removeEventListener("touchend",this._onTouchend),document.removeEventListener("touchmove",this._onTouchmove),window.cancelAnimationFrame(this.frameRequest)}}const o0=new at,s0=new at,Sw=new at,ii=new at,Cw=new at,bi=new te,du=new Br,Aw=new Br,ws=new at,Ca=new te,Vh=new te;class FG{constructor(e,t={}){this.stage=e,this.rotateSpeed=W(t.rotateSpeed,2),this.zoomSpeed=W(t.zoomSpeed,1.2),this.panSpeed=W(t.panSpeed,1),this.viewer=e.viewer,this.mouse=e.mouseObserver,this.controls=e.viewerControls}get component(){return this.stage.transformComponent}get atom(){return this.stage.transformAtom}_setPanVector(e,t,r=0){const i=this.controls.getCanvasScaleFactor(r);Ca.set(e,t,0),Ca.multiplyScalar(this.panSpeed*i)}_getRotateXY(e,t){return[this.rotateSpeed*-e*.01,this.rotateSpeed*t*.01]}_getCameraRotation(e){return e.extractRotation(this.viewer.camera.matrixWorld),e.multiply(s0.makeRotationY(Math.PI)),e}_transformPanVector(){this.component&&(ws.extractRotation(this.component.transform),ws.premultiply(this.viewer.rotationGroup.matrix),ws.invert(),ws.multiply(this._getCameraRotation(ii)),Ca.applyMatrix4(ws))}zoom(e){this.controls.zoom(this.zoomSpeed*e*.02)}pan(e,t){this._setPanVector(e,t),ws.copy(this.viewer.rotationGroup.matrix).invert(),ws.multiply(this._getCameraRotation(ii)),Ca.applyMatrix4(ws),this.controls.translate(Ca)}panComponent(e,t){this.component&&(this._setPanVector(e,t),this._transformPanVector(),this.component.position.add(Ca),this.component.updateMatrix())}panAtom(e,t){this.atom&&this.component&&(this.atom.positionToVector3(Vh),Vh.add(this.viewer.translationGroup.position),Vh.applyMatrix4(this.viewer.rotationGroup.matrix),this._setPanVector(e,t,Vh.z),this._transformPanVector(),this.atom.positionAdd(Ca),this.component.updateRepresentations({position:!0}))}rotate(e,t){const[r,i]=this._getRotateXY(e,t);this._getCameraRotation(ii),bi.set(1,0,0),bi.applyMatrix4(ii),du.setFromAxisAngle(bi,i),bi.set(0,1,0),bi.applyMatrix4(ii),Aw.setFromAxisAngle(bi,r),du.multiply(Aw),ii.makeRotationFromQuaternion(du),this.controls.applyMatrix(ii)}zRotate(e,t){const r=this.rotateSpeed*((-e+t)/-2)*.01;Sw.makeRotationZ(r),this.controls.applyMatrix(Sw)}rotateComponent(e,t){if(!this.component)return;const[r,i]=this._getRotateXY(e,t);this._getCameraRotation(Cw),ii.extractRotation(this.component.transform),ii.premultiply(this.viewer.rotationGroup.matrix),ii.invert(),ii.premultiply(Cw),bi.set(1,0,0),bi.applyMatrix4(ii),o0.makeRotationAxis(bi,i),bi.set(0,1,0),bi.applyMatrix4(ii),s0.makeRotationAxis(bi,r),o0.multiply(s0),du.setFromRotationMatrix(o0),this.component.quaternion.premultiply(du),this.component.quaternion.normalize(),this.component.updateMatrix()}}const $l=new te;class OG{constructor(e,t){this.stage=t,this.pid=e.pid,this.picker=e.picker,this.instance=e.instance,this.stage=t,this.controls=t.viewerControls,this.mouse=t.mouseObserver}get type(){return this.picker.type}get altKey(){return this.mouse.altKey}get ctrlKey(){return this.mouse.ctrlKey}get metaKey(){return this.mouse.metaKey}get shiftKey(){return this.mouse.shiftKey}get canvasPosition(){return this.mouse.canvasPosition}get component(){return this.stage.getComponentsByObject(this.picker.data).list[0]}get object(){return this.picker.getObject(this.pid)}get position(){return this.picker.getPosition(this.pid,this.instance,this.component)}get closestBondAtom(){if(this.type!=="bond"||!this.bond)return;const e=this.bond,t=this.controls,r=this.canvasPosition,i=e.atom1.positionToVector3(),o=e.atom2.positionToVector3();i.applyMatrix4(this.component.matrix),o.applyMatrix4(this.component.matrix);const s=t.getPositionOnCanvas(i),a=t.getPositionOnCanvas(o);return c=s,u=a,(l=r).distanceTo(c)<l.distanceTo(u)?e.atom1:e.atom2;var l,c,u}get closeAtom(){const e=this.canvasPosition,t=this.closestBondAtom;if(!t)return;const r=t.positionToVector3().applyMatrix4(this.component.matrix),i=this.controls.getPositionOnCanvas(r);t.positionToVector3($l),this.instance&&$l.applyMatrix4(this.instance.matrix),$l.applyMatrix4(this.component.matrix);const o=this.controls.viewer;$l.add(o.translationGroup.position),$l.applyMatrix4(o.rotationGroup.matrix);const s=this.controls.getCanvasScaleFactor($l.z),a=this.component.getMaxRepresentationRadius(t.index);return e.distanceTo(i)<=a/s?t:void 0}get arrow(){return this._objectIfType("arrow")}get atom(){return this._objectIfType("atom")}get axes(){return this._objectIfType("axes")}get bond(){return this._objectIfType("bond")}get box(){return this._objectIfType("box")}get cone(){return this._objectIfType("cone")}get clash(){return this._objectIfType("clash")}get contact(){return this._objectIfType("contact")}get cylinder(){return this._objectIfType("cylinder")}get distance(){return this._objectIfType("distance")}get ellipsoid(){return this._objectIfType("ellipsoid")}get octahedron(){return this._objectIfType("octahedron")}get point(){return this._objectIfType("point")}get mesh(){return this._objectIfType("mesh")}get slice(){return this._objectIfType("slice")}get sphere(){return this._objectIfType("sphere")}get tetrahedron(){return this._objectIfType("tetrahedron")}get torus(){return this._objectIfType("torus")}get surface(){return this._objectIfType("surface")}get unitcell(){return this._objectIfType("unitcell")}get unknown(){return this._objectIfType("unknown")}get volume(){return this._objectIfType("volume")}get wideline(){return this._objectIfType("wideline")}_objectIfType(e){return this.type===e?this.object:void 0}getLabel(){const e=this.atom||this.closeAtom;let t="nothing";return this.arrow?t=this.arrow.name:e?t=`atom: ${e.qualifiedName()} (${e.structure.name})`:this.axes?t="axes":this.bond?t=`bond: ${this.bond.atom1.qualifiedName()} - ${this.bond.atom2.qualifiedName()} (${this.bond.structure.name})`:this.box?t=this.box.name:this.cone?t=this.cone.name:this.clash?t=`clash: ${this.clash.clash.sele1} - ${this.clash.clash.sele2}`:this.contact?t=`${this.contact.type}: ${this.contact.atom1.qualifiedName()} - ${this.contact.atom2.qualifiedName()} (${this.contact.atom1.structure.name})`:this.cylinder?t=this.cylinder.name:this.distance?t=`distance: ${this.distance.atom1.qualifiedName()} - ${this.distance.atom2.qualifiedName()} (${this.distance.structure.name})`:this.ellipsoid?t=this.ellipsoid.name:this.octahedron?t=this.octahedron.name:this.point?t=this.point.name:this.mesh?t=`mesh: ${this.mesh.name||this.mesh.serial} (${this.mesh.shape.name})`:this.slice?t=`slice: ${this.slice.value.toPrecision(3)} (${this.slice.volume.name})`:this.sphere?t=this.sphere.name:this.surface?t=`surface: ${this.surface.surface.name}`:this.tetrahedron?t=this.tetrahedron.name:this.torus?t=this.torus.name:this.unitcell?t=`unitcell: ${this.unitcell.unitcell.spacegroup} (${this.unitcell.structure.name})`:this.unknown?t="unknown":this.volume?t=`volume: ${this.volume.value.toPrecision(3)} (${this.volume.volume.name})`:this.wideline&&(t=this.wideline.name),t}}class kG{constructor(e){this.stage=e,this.viewer=e.viewer}pick(e,t){const r=this.viewer.pick(e,t);if(r.picker&&r.picker.type!=="ignore"&&r.pid!==void 0){const i=r.picker.array;if(!(i&&r.pid>=i.length))return new OG(r,this.stage);console.error("pid >= picker.array.length")}}}const Mw=new Br,Tw=new te,Ew=new te,a0=new te,BG=new te,Pw=new at,Rw=new te,Iw=new at;class NG{constructor(e){this.stage=e,this.signals={changed:new Ft.Signal},this.viewer=e.viewer}get position(){return this.viewer.translationGroup.position}get rotation(){return this.viewer.rotationGroup.quaternion}changed(){this.viewer.requestRender(),this.signals.changed.dispatch()}getPositionOnCanvas(e,t){const r=fm(t,Ut),i=this.viewer;return a0.copy(e).add(i.translationGroup.position).applyMatrix4(i.rotationGroup.matrix).project(i.camera),r.set((a0.x+1)*i.width/2,(a0.y+1)*i.height/2)}getCanvasScaleFactor(e=0){const t=this.viewer.camera;if(t instanceof gd)return 1/t.zoom;{e=Math.abs(e),e+=this.getCameraDistance();const r=kn(t.fov);return 2*e*Math.tan(r/2)/this.viewer.height}}getOrientation(e){const t=Cu(e);t.copy(this.viewer.rotationGroup.matrix);const r=this.getCameraDistance();return t.scale(BG.set(r,r,r)),t.setPosition(this.viewer.translationGroup.position),t}orient(e){Cu(e).decompose(Tw,Mw,Ew);const t=this.viewer;t.rotationGroup.setRotationFromQuaternion(Mw),t.translationGroup.position.copy(Tw),t.cameraDistance=Ew.z,t.updateZoom(),this.changed()}translate(e){this.viewer.translationGroup.position.add(qa(e)),this.changed()}center(e){this.viewer.translationGroup.position.copy(qa(e)).negate(),this.changed()}zoom(e){this.distance(this.getCameraDistance()*(1-e))}getCameraDistance(){return this.viewer.cameraDistance}distance(e){this.viewer.cameraDistance=Math.max(Math.abs(e),.2),this.viewer.updateZoom(),this.changed()}spin(e,t){Pw.copy(this.viewer.rotationGroup.matrix).invert(),Rw.copy(qa(e)).applyMatrix4(Pw),this.viewer.rotationGroup.rotateOnAxis(Rw,t),this.changed()}rotate(e){this.viewer.rotationGroup.setRotationFromQuaternion(ov(e)),this.changed()}align(e){Iw.copy(Cu(e)).invert(),this.viewer.rotationGroup.setRotationFromMatrix(Iw),this.changed()}applyMatrix(e){this.viewer.rotationGroup.applyMatrix4(Cu(e)),this.changed()}}class ml{constructor(e,t,...r){this.pausedTime=-1,this.elapsedDuration=0,this.pausedDuration=0,this.ignoreGlobalToggle=!1,this._paused=!1,this._resolveList=[],this.duration=W(e,1e3),this.controls=t,this.startTime=window.performance.now(),this._init(...r)}get done(){return this.alpha===1}get paused(){return this._paused}tick(e){if(!this._paused)return this.elapsedDuration=e.currentTime-this.startTime-this.pausedDuration,this.duration===0?this.alpha=1:this.alpha=Nd(0,1,this.elapsedDuration/this.duration),this._tick(e),this.done&&this._resolveList.forEach(t=>t()),this.done}pause(e){e&&(this._hold=!0),this.pausedTime===-1&&(this.pausedTime=window.performance.now()),this._paused=!0}resume(e){!e&&this._hold||(this.pausedDuration+=window.performance.now()-this.pausedTime,this._paused=!1,this._hold=!1,this.pausedTime=-1)}toggle(){this._paused?this.resume():this.pause()}then(e){let t;return t=this.done?Promise.resolve():new Promise(r=>this._resolveList.push(r)),t.then(e)}}class Dw extends ml{constructor(e,t,...r){super(W(e,1/0),t,...r)}_init(e,t){Array.isArray(e)?this.axis=new te().fromArray(e):this.axis=W(e,new te(0,1,0)),this.angle=W(t,.01)}_tick(e){this.axis&&this.angle&&this.controls.spin(this.axis,this.angle*e.lastDuration/16)}}class Lw extends ml{constructor(e,t,...r){super(W(e,1/0),t,...r),this.angleSum=0,this.direction=1}_init(e,t,r){Array.isArray(e)?this.axis=new te().fromArray(e):this.axis=W(e,new te(0,1,0)),this.angleStep=W(t,.01),this.angleEnd=W(r,.2)}_tick(e){if(!this.axis||!this.angleStep||!this.angleEnd)return;const t=Nd(0,1,Math.abs(this.angleSum)/this.angleEnd),r=this.angleStep*this.direction*(1.1-t);this.controls.spin(this.axis,r*e.lastDuration/16),this.angleSum+=this.angleStep,this.angleSum>=this.angleEnd&&(this.direction*=-1,this.angleSum=-this.angleEnd)}}class Fw extends ml{_init(e,t){this.moveFrom=qa(W(e,new te)),this.moveTo=qa(W(t,new te))}_tick(){this.controls.position.lerpVectors(this.moveFrom,this.moveTo,this.alpha).negate(),this.controls.changed()}}class zG extends ml{_init(e,t){this.zoomFrom=e,this.zoomTo=t}_tick(){this.controls.distance(wi(this.zoomFrom,this.zoomTo,this.alpha))}}class UG extends ml{constructor(){super(...arguments),this._currentRotation=new Br}_init(e,t){this.rotateFrom=ov(e),this.rotateTo=ov(t),this._currentRotation=new Br}_tick(){this._currentRotation.copy(this.rotateFrom).slerp(this.rotateTo,this.alpha),this.controls.rotate(this._currentRotation)}}class $G extends ml{_init(e,t,r){this.valueFrom=e,this.valueTo=t,this.callback=r}_tick(){this.callback(wi(this.valueFrom,this.valueTo,this.alpha))}}class HG extends ml{_init(e){this.callback=e}_tick(){this.alpha===1&&this.callback()}}class Ow{constructor(e=[]){this._resolveList=[],this._list=e}get done(){return this._list.every(e=>e.done)}then(e){let t;return t=this.done?Promise.resolve():new Promise(r=>{this._resolveList.push(r),this._list.forEach(i=>{i.then(()=>{this._resolveList.forEach(o=>{o()}),this._resolveList.length=0})})}),t.then(e)}}class VG{constructor(e){this.stage=e,this.animationList=[],this.finishedList=[],this.viewer=e.viewer,this.controls=e.viewerControls}get paused(){return this.animationList.every(e=>e.paused)}add(e){return e.duration===0?e.tick(this.viewer.stats):this.animationList.push(e),e}remove(e){const t=this.animationList,r=t.indexOf(e);r>-1&&t.splice(r,1)}run(e){const t=this.finishedList,r=this.animationList,i=r.length;for(let s=0;s<i;++s){const a=r[s];a.tick(e)&&t.push(a)}const o=t.length;if(o){for(let s=0;s<o;++s)this.remove(t[s]);t.length=0}}spin(e,t,r){return this.add(new Dw(r,this.controls,e,t))}rock(e,t,r,i){return this.add(new Lw(i,this.controls,e,t,r))}rotate(e,t){const r=this.viewer.rotationGroup.quaternion.clone();return this.add(new UG(t,this.controls,r,e))}move(e,t){const r=this.controls.position.clone().negate();return this.add(new Fw(t,this.controls,r,e))}zoom(e,t){const r=this.viewer.camera.position.z;return this.add(new zG(t,this.controls,r,e))}zoomMove(e,t,r){return new Ow([this.move(e,r),this.zoom(t,r)])}orient(e,t){const r=new te,i=new Br,o=new te;return Cu(e).decompose(r,i,o),new Ow([this.move(r.negate(),t),this.rotate(i,t),this.zoom(-o.x,t)])}value(e,t,r,i){return this.add(new $G(i,this.controls,e,t,r))}timeout(e,t){return this.add(new HG(t,this.controls,e))}spinComponent(e,t,r,i){return this.add(new Dw(i,e.controls,t,r))}rockComponent(e,t,r,i,o){return this.add(new Lw(o,e.controls,t,r,i))}moveComponent(e,t,r){const i=e.controls.position.clone().negate();return this.add(new Fw(r,e.controls,i,t))}pause(){this.animationList.forEach(e=>e.pause())}resume(){this.animationList.forEach(e=>e.resume())}toggle(){this.paused?this.resume():this.pause()}clear(){this.animationList.length=0}dispose(){this.clear()}}class GG{constructor(e,t){if(this.fn=e,this.queue=[],this.pending=!1,this.next=this.next.bind(this),t){for(let r=0,i=t.length;r<i;++r)this.queue.push(t[r]);this.next()}}run(e){this.fn(e,this.next)}next(){const e=this.queue.shift();e!==void 0?(this.pending=!0,setTimeout(()=>this.run(e))):this.pending=!1}push(e){this.queue.push(e),this.pending||this.next()}kill(){this.queue.length=0}length(){return this.queue.length}}class $d{constructor(e,t,r){this.type="",this.parameters={lazy:{type:"boolean"},clipNear:{type:"range",step:1,max:100,min:0,buffer:!0},clipRadius:{type:"number",precision:1,max:1e3,min:0,buffer:!0},clipCenter:{type:"vector3",precision:1,buffer:!0},flatShaded:{type:"boolean",buffer:!0},opacity:{type:"range",step:.01,max:1,min:0,buffer:!0},depthWrite:{type:"boolean",buffer:!0},side:{type:"select",buffer:!0,options:{front:"front",back:"back",double:"double"}},wireframe:{type:"boolean",buffer:!0},colorData:{type:"hidden",update:"color"},colorScheme:{type:"select",update:"color",options:{}},colorScale:{type:"select",update:"color",options:Xt.getScales()},colorReverse:{type:"boolean",update:"color"},colorValue:{type:"color",update:"color"},colorDomain:{type:"hidden",update:"color"},colorMode:{type:"select",update:"color",options:Xt.getModes()},roughness:{type:"range",step:.01,max:1,min:0,buffer:!0},metalness:{type:"range",step:.01,max:1,min:0,buffer:!0},diffuse:{type:"color",buffer:!0},diffuseInterior:{type:"boolean",buffer:!0},useInteriorColor:{type:"boolean",buffer:!0},interiorColor:{type:"color",buffer:!0},interiorDarkening:{type:"range",step:.01,max:1,min:0,buffer:!0},matrix:{type:"hidden",buffer:!0},disablePicking:{type:"boolean",rebuild:!0}},this.viewer=t,this.tasks=new HE,this.queue=new GG(this.make.bind(this)),this.bufferList=[],this.parameters.colorScheme&&(this.parameters.colorScheme.options=Xt.getSchemes()),this.toBePrepared=!1}init(e){const t=e||{};this.clipNear=W(t.clipNear,0),this.clipRadius=W(t.clipRadius,0),this.clipCenter=W(t.clipCenter,new te),this.flatShaded=W(t.flatShaded,!1),this.side=W(t.side,"double"),this.opacity=W(t.opacity,1),this.depthWrite=W(t.depthWrite,!0),this.wireframe=W(t.wireframe,!1),this.setColor(t.color,t),this.colorData=W(t.colorData,void 0),this.colorScheme=W(t.colorScheme,"uniform"),this.colorScale=W(t.colorScale,""),this.colorReverse=W(t.colorReverse,!1),this.colorValue=W(t.colorValue,9474192),this.colorDomain=W(t.colorDomain,void 0),this.colorMode=W(t.colorMode,"hcl"),this.visible=W(t.visible,!0),this.quality=W(t.quality,void 0),this.roughness=W(t.roughness,.4),this.metalness=W(t.metalness,0),this.diffuse=W(t.diffuse,16777215),this.diffuseInterior=W(t.diffuseInterior,!1),this.useInteriorColor=W(t.useInteriorColor,!1),this.interiorColor=W(t.interiorColor,2236962),this.interiorDarkening=W(t.interiorDarkening,0),this.lazy=W(t.lazy,!1),this.lazyProps={build:!1,bufferParams:{},what:{}},this.matrix=W(t.matrix,new at),this.disablePicking=W(t.disablePicking,!1);const r=this.parameters;r.sphereDetail===!0&&(r.sphereDetail={type:"integer",max:3,min:0,rebuild:"impostor"}),r.radialSegments===!0&&(r.radialSegments={type:"integer",max:25,min:5,rebuild:"impostor"}),r.openEnded===!0&&(r.openEnded={type:"boolean",rebuild:"impostor",buffer:!0}),r.disableImpostor===!0&&(r.disableImpostor={type:"boolean",rebuild:!0}),t.quality==="low"?(r.sphereDetail&&(this.sphereDetail=0),r.radialSegments&&(this.radialSegments=5)):t.quality==="medium"?(r.sphereDetail&&(this.sphereDetail=1),r.radialSegments&&(this.radialSegments=10)):t.quality==="high"?(r.sphereDetail&&(this.sphereDetail=2),r.radialSegments&&(this.radialSegments=20)):(r.sphereDetail&&(this.sphereDetail=W(t.sphereDetail,1)),r.radialSegments&&(this.radialSegments=W(t.radialSegments,10))),r.openEnded&&(this.openEnded=W(t.openEnded,!0)),r.disableImpostor&&(this.disableImpostor=W(t.disableImpostor,!1))}getColorParams(e){return Object.assign({data:this.colorData,scheme:this.colorScheme,scale:this.colorScale,reverse:this.colorReverse,value:this.colorValue,domain:this.colorDomain,mode:this.colorMode,colorSpace:this.colorSpace},e)}getBufferParams(e={}){return Object.assign({clipNear:this.clipNear,clipRadius:this.clipRadius,clipCenter:this.clipCenter,flatShaded:this.flatShaded,opacity:this.opacity,depthWrite:this.depthWrite,side:this.side,wireframe:this.wireframe,roughness:this.roughness,metalness:this.metalness,diffuse:this.diffuse,diffuseInterior:this.diffuseInterior,useInteriorColor:this.useInteriorColor,interiorColor:this.interiorColor,interiorDarkening:this.interiorDarkening,matrix:this.matrix,disablePicking:this.disablePicking},e)}setColor(e,t){const r=Object.keys(Xt.getSchemes());if(typeof e=="string"&&r.includes(e.toLowerCase()))t?t.colorScheme=e:this.setParameters({colorScheme:e});else if(e!==void 0){let i=new _t(e).getHex();t?(t.colorScheme="uniform",t.colorValue=i):this.setParameters({colorScheme:"uniform",colorValue:i})}return this}prepare(e){}create(){}update(e){this.build()}build(e){if(!this.lazy||this.visible&&this.opacity){if(!this.toBePrepared)return this.tasks.increment(),void this.make();this.queue.length()>0?(this.tasks.change(1-this.queue.length()),this.queue.kill()):this.tasks.increment(),this.queue.push(e||!1)}else this.lazyProps.build=!0}make(e,t){Xe&&Be.time("Representation.make "+this.type);const r=()=>{e?(this.update(e),this.viewer.requestRender(),this.tasks.decrement(),t&&t()):(this.clear(),this.create(),this.manualAttach||this.disposed||(Xe&&Be.time("Representation.attach "+this.type),this.attach(()=>{Xe&&Be.timeEnd("Representation.attach "+this.type),this.tasks.decrement(),t&&t()}))),Xe&&Be.timeEnd("Representation.make "+this.type)};this.toBePrepared?this.prepare(r):r()}attach(e){this.setVisibility(this.visible),e()}setVisibility(e,t){if(this.visible=e,this.visible&&this.opacity){const r=this.lazyProps,i=r.bufferParams,o=r.what;if(r.build)return r.build=!1,this.build(),this;(Object.keys(i).length||Object.keys(o).length)&&(r.bufferParams={},r.what={},this.updateParameters(i,o))}return this.bufferList.forEach(function(r){r.setVisibility(e)}),t||this.viewer.requestRender(),this}setParameters(e,t={},r=!1){const i=e||{},o=this.parameters,s={};this.opacity||i.opacity===void 0||(this.lazyProps.build?(this.lazyProps.build=!1,r=!0):(Object.assign(s,this.lazyProps.bufferParams),Object.assign(t,this.lazyProps.what),this.lazyProps.bufferParams={},this.lazyProps.what={})),this.setColor(i.color,i);for(let a in i)i[a]!==void 0&&o[a]!=null&&(o[a].int&&(i[a]=parseInt(i[a])),o[a].float&&(i[a]=parseFloat(i[a])),i[a]!==this[a]||i[a].equals&&!i[a].equals(this[a]))&&(this[a]&&this[a].copy&&i[a].copy?this[a].copy(i[a]):this[a]&&this[a].set?this[a].set(i[a]):this[a]=i[a],o[a].buffer&&(o[a].buffer===!0?s[a]=i[a]:s[o[a].buffer]=i[a]),o[a].update&&(t[o[a].update]=!0),!o[a].rebuild||o[a].rebuild==="impostor"&&wo&&!this.disableImpostor||(r=!0));return r?this.build():this.updateParameters(s,t),this}updateParameters(e={},t){if(this.lazy&&(!this.visible||!this.opacity)&&e.hasOwnProperty("opacity")===!1)return Object.assign(this.lazyProps.bufferParams,e),void Object.assign(this.lazyProps.what,t);this.bufferList.forEach(function(r){r.setParameters(e)}),Object.keys(t).length&&this.update(t),this.viewer.requestRender()}getParameters(){const e={lazy:this.lazy,visible:this.visible,quality:this.quality};return Object.keys(this.parameters).forEach(t=>{this.parameters[t]!==null&&(e[t]=this[t])}),e}clear(){this.bufferList.forEach(e=>{this.viewer.remove(e),e.dispose()}),this.bufferList.length=0,this.viewer.requestRender()}dispose(){this.disposed=!0,this.queue.kill(),this.tasks.dispose(),this.clear()}}class WE{constructor(e){this.pending=0,this.postCount=0,this.onmessageDict={},this.onerrorDict={},this.name=e,this.blobUrl=window.URL.createObjectURL(ju.get(e)),this.worker=new Worker(this.blobUrl),ju.activeWorkerCount+=1,this.worker.onmessage=t=>{this.pending-=1;const r=t.data.__postId;Xe&&Be.timeEnd("Worker.postMessage "+e+" #"+r);const i=this.onmessageDict[r];i&&i.call(this.worker,t),delete this.onmessageDict[r],delete this.onerrorDict[r]},this.worker.onerror=t=>{if(this.pending-=1,t.data){const r=t.data.__postId,i=this.onerrorDict[r];i?i.call(this.worker,t):Be.error("Worker.onerror",r,e,t),delete this.onmessageDict[r],delete this.onerrorDict[r]}else Be.error("Worker.onerror",e,t)}}post(e={},t,r,i){this.onmessageDict[this.postCount]=r,this.onerrorDict[this.postCount]=i,e.__name=this.name,e.__postId=this.postCount,e.__debug=Xe,Xe&&Be.time(`Worker.postMessage ${this.name} #${this.postCount}`);try{this.worker.postMessage(e,t)}catch(o){Be.error("worker.post:",o),this.worker.postMessage(e)}return this.pending+=1,this.postCount+=1,this}terminate(){this.worker?(this.worker.terminate(),window.URL.revokeObjectURL(this.blobUrl),ju.activeWorkerCount-=1):Be.log("no worker to terminate")}}class lv{constructor(e,t=2){this.pool=[],this.count=0,this.maxCount=Math.min(8,t),this.name=e}post(e={},t,r,i){const o=this.getNextWorker();return o?o.post(e,t,r,i):console.error("unable to get worker from pool"),this}terminate(){this.pool.forEach(function(e){e.terminate()})}getNextWorker(){let e,t=1/0;for(let r=0;r<this.maxCount;++r){if(r>=this.count){e=new WE(this.name),this.pool.push(e),this.count+=1;break}const i=this.pool[r];if(i.pending===0){e=i;break}i.pending<t&&(t=i.pending,e=i)}return e}}function cv(n){const e=n.length,t=e/3;let r=0,i=0,o=0;for(let s=0;s<e;s+=3)r+=n[s+0],i+=n[s+1],o+=n[s+2];return new te(r/t,i/t,o/t)}function Xa(n,e,t){return t?n.sub(t).projectOnVector(e).add(t):n.projectOnVector(e),n}function bd(n){let e=1/0,t=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,l=n.length;a<l;a+=3){const c=n[a],u=n[a+1],d=n[a+2];c<e&&(e=c),u<t&&(t=u),d<r&&(r=d),c>i&&(i=c),u>o&&(o=u),d>s&&(s=d)}return[Lt([e,t,r]),Lt([i,o,s])]}function mm(n,e){for(let t=0,r=e.length;t<r;t+=3){const i=e[t],o=e[t+1],s=e[t+2];e[t]=n[0]*i+n[4]*o+n[8]*s+n[12],e[t+1]=n[1]*i+n[5]*o+n[9]*s+n[13],e[t+2]=n[2]*i+n[6]*o+n[10]*s+n[14]}}function Jb(n,e){for(let t=0,r=e.length;t<r;t+=3){const i=e[t],o=e[t+1],s=e[t+2];e[t]=n[0]*i+n[3]*o+n[6]*s,e[t+1]=n[1]*i+n[4]*o+n[7]*s,e[t+2]=n[2]*i+n[5]*o+n[8]*s}}function jE(n){for(let e=0,t=n.length;e<t;e+=3){const r=n[e],i=n[e+1],o=n[e+2],s=r*r+i*i+o*o;if(s>0){const a=1/Math.sqrt(s);n[e]=r*a,n[e+1]=i*a,n[e+2]=o*a}}}function Lt(n){return new Float32Array(n||3)}function Zr(n,e,t){const r=e[0],i=e[1],o=e[2],s=t[0],a=t[1],l=t[2];n[0]=i*l-o*a,n[1]=o*s-r*l,n[2]=r*a-i*s}function Gr(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function In(n,e,t){n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2]}function Gi(n,e,t){n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2]}function Fr(n,e,t=0){n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2]}function Bt(n,e,t=0){e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2]}function qE(n){return n[0]*n[0]+n[1]*n[1]+n[2]*n[2]}function $s(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])}function ec(n,e,t){dn(n,e,1/t)}function dn(n,e,t){n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t}function On(n,e){const t=qE(e);t==0?(n[0]=e[0],n[1]=e[1],n[2]=e[2]):dn(n,e,1/Math.sqrt(t))}function XE(n,e,t){n[0]=e[0]-t,n[1]=e[1]-t,n[2]=e[2]-t}function Df(n,e,t){n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t}function uv(n,e){n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n[2]=Math.floor(e[2])}function Mu(n,e){n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n[2]=Math.ceil(e[2])}function gm(n,e){n[0]=-e[0],n[1]=-e[1],n[2]=-e[2]}function WG(n,e){const t=n[0],r=n[1],i=n[2],o=e[0],s=e[1],a=e[2],l=r*a-i*s,c=i*o-t*a,u=t*s-r*o,d=Math.sqrt(l*l+c*c+u*u),h=t*o+r*s+i*a;return Math.atan2(d,h)}function jG(n,e=9){const t=Math.floor(e/2),r=n.position1.length/3,i=3*(t*r),o=1/e,s=pm(n.position1,n.position2),a=new Float32Array(i),l=new Float32Array(i),c=new te;for(let m=0;m<r;++m){const f=3*m;c.set(s[f],s[f+1],s[f+2]);const v=n.position1[f],g=n.position1[f+1],b=n.position1[f+2];for(let S=0;S<t;++S){const p=t*f+3*S,y=o*(2*S+1),w=o*(2*S+2);a[p]=v+c.x*y,a[p+1]=g+c.y*y,a[p+2]=b+c.z*y,l[p]=v+c.x*w,l[p+1]=g+c.y*w,l[p+2]=b+c.z*w}}const u=So(a,l),d=function(m,f){const v=m.length/3,g=new Float32Array(v*f*3);for(let b=0;b<v;++b){const S=3*b,p=b*f*3,y=m[S+0],w=m[S+1],x=m[S+2];for(let _=0;_<f;++_){const A=p+3*_;g[A+0]=y,g[A+1]=w,g[A+2]=x}}return g}(n.color,t),h={position:u,position1:a,position2:l,color:d,color2:d};return n.radius&&(h.radius=t0(n.radius,t)),n.picking&&n.picking.array&&(n.picking.array=t0(n.picking.array,t),h.picking=n.picking),n.primitiveId&&(h.primitiveId=t0(n.primitiveId,t)),h}function YE(n,e=.1){const t=pm(n.position1,n.position2),r=[],i=[],o=[],s=n.radius?[]:void 0,a=n.picking?[]:void 0,l=n.primitiveId?[]:void 0,c=new te,u=n.position1.length/3;let d=0;for(let b=0;b<u;++b){const S=3*b;c.set(t[S],t[S+1],t[S+2]);const p=c.length()/e,y=Math.floor(p/2),w=1/p,x=n.position1[S],_=n.position1[S+1],A=n.position1[S+2];for(let C=0;C<y;++C){const T=3*d+3*C,I=w*(2*C+1),M=w*(2*C+2);r[T]=x+c.x*I,r[T+1]=_+c.y*I,r[T+2]=A+c.z*I,i[T]=x+c.x*M,i[T+1]=_+c.y*M,i[T+2]=A+c.z*M,n.color&&(o[T]=n.color[S],o[T+1]=n.color[S+1],o[T+2]=n.color[S+2]),s&&(s[d+C]=n.radius[b]),a&&(n.picking.array?a[d+C]=n.picking.array[b]:a[d+C]=b),l&&(l[d+C]=n.primitiveId[b])}d+=y}const h=new Float32Array(r),m=new Float32Array(i),f=So(h,m),v=new Float32Array(o),g={position:f,position1:h,position2:m,color:v,color2:v};return s&&(g.radius=new Float32Array(s)),a&&n.picking&&(n.picking.array=new Float32Array(a),g.picking=n.picking),l&&(g.primitiveId=new Float32Array(l)),g}function dv(n,e=.1){const t=pm(n.position1,n.position2),r=[],i=[],o=[],s=n.radius?[]:void 0,a=n.picking?[]:void 0,l=n.primitiveId?[]:void 0,c=new te,u=n.position1.length/3;let d=e,h=!0,m=0,f=0,v=0;for(let w=0;w<u;++w){const x=3*w,_=n.position1[x],A=n.position1[x+1],C=n.position1[x+2];c.set(t[x],t[x+1],t[x+2]);const T=c.length();h&&(r[f]=_,r[f+1]=A,r[f+2]=C);let I=d;const M=1/T;for(;I<T;){const P=h?i:r;P[f]=_+c.x*I*M,P[f+1]=A+c.y*I*M,P[f+2]=C+c.z*I*M,h&&(m++,f=3*m),h=!h,d=e,I+=e}h&&(i[f]=n.position2[x],i[f+1]=n.position2[x+1],i[f+2]=n.position2[x+2],m++,f=3*m),d=I-T;for(let P=v;P<m;P++){if(n.color){const E=3*P;o[E]=n.color[x],o[E+1]=n.color[x+1],o[E+2]=n.color[x+2]}s&&(s[P]=n.radius[w]),a&&(n.picking.array?a[P]=n.picking.array[w]:a[P]=w),l&&(l[P]=n.primitiveId[w])}v=m}if(!h&&u>0){const w=3*m;i[w]=n.position2[3*u-3],i[w+1]=n.position2[3*u-2],i[w+1]=n.position2[3*u-1]}const g=new Float32Array(r),b=new Float32Array(i),S=So(g,b),p=new Float32Array(o),y={position:S,position1:g,position2:b,color:p,color2:p};return s&&(y.radius=new Float32Array(s)),a&&n.picking&&(n.picking.array=new Float32Array(a),y.picking=n.picking),l&&(y.primitiveId=new Float32Array(l)),y}lv.prototype.constructor=lv,bd.__deps=[Lt],ec.__deps=[dn],On.__deps=[dn,qE];const Ks=new te;class Zs{static get Picker(){return _i.get(this.type)}static get Buffer(){return pi.get(this.type)}static getShapeKey(e){return this.type+e[0].toUpperCase()+e.substr(1)}static expandBoundingBox(e,t){}static valueToShape(e,t,r){const i=e._primitiveData[this.getShapeKey(t)];switch(this.fields[t]){case"v3":case"c":(function(o,s){o.toArray!==void 0?o=o.toArray():o.x!==void 0?o=[o.x,o.y,o.z]:o.r!==void 0&&(o=[o.r,o.g,o.b]),s.push.apply(s,o)})(r,i);break;default:i.push(r)}}static objectToShape(e,t){Object.keys(this.fields).forEach(r=>{this.valueToShape(e,r,t[r])}),this.valueToShape(e,"name",t.name),this.expandBoundingBox(e.boundingBox,t)}static valueFromShape(e,t,r){const i=e._primitiveData[this.getShapeKey(r)];switch(this.fields[r]){case"v3":return new te().fromArray(i,3*t);case"c":return new _t().fromArray(i,3*t);default:return i[t]}}static objectFromShape(e,t){let r=this.valueFromShape(e,t,"name");r===void 0&&(r=`${this.type}: ${t} (${e.name})`);const i={shape:e,name:r};return Object.keys(this.fields).forEach(o=>{i[o]=this.valueFromShape(e,t,o)}),i}static arrayFromShape(e,t){const r=e._primitiveData[this.getShapeKey(t)];return this.fields[t]==="s"?r:new Float32Array(r)}static dataFromShape(e){const t={};return this.Picker&&(t.picking=new this.Picker(e)),Object.keys(this.fields).forEach(r=>{t[r]=this.arrayFromShape(e,r)}),t}static bufferFromShape(e,t){return new this.Buffer(this.dataFromShape(e),t)}}Zs.type="",Zs.fields={};class Tc extends Zs{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Ks.fromArray(t.position))}}Tc.type="sphere",Tc.fields={position:"v3",color:"c",radius:"f"};class rl extends Zs{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Ks.fromArray(t.position))}}rl.type="box",rl.fields={position:"v3",color:"c",size:"f",heightAxis:"v3",depthAxis:"v3"};class vm extends rl{}vm.type="octahedron";class bm extends rl{}bm.type="tetrahedron";class il extends Zs{static positionFromShape(e,t){const r=this.valueFromShape(e,t,"position1"),i=this.valueFromShape(e,t,"position2");return r.add(i).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(Ks.fromArray(t.position1)),e.expandByPoint(Ks.fromArray(t.position2))}static bufferFromShape(e,t={}){let r=this.dataFromShape(e);return this.type==="cylinder"&&t.dashedCylinder&&(r=YE(r)),new this.Buffer(r,t)}}il.type="cylinder",il.fields={position1:"v3",position2:"v3",color:"c",radius:"f"};class ym extends il{}ym.type="arrow";class _m extends il{}_m.type="cone";class Ec extends Tc{}Ec.type="ellipsoid",Ec.fields={position:"v3",color:"c",radius:"f",majorAxis:"v3",minorAxis:"v3"};class xm extends Ec{}xm.type="torus";class bp extends Zs{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Ks.fromArray(t.position))}}bp.type="text",bp.fields={position:"v3",color:"c",size:"f",text:"s"};class yd extends Zs{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Ks.fromArray(t.position))}}yd.type="point",yd.fields={position:"v3",color:"c"};class _d extends Zs{static positionFromShape(e,t){const r=this.valueFromShape(e,t,"position1"),i=this.valueFromShape(e,t,"position2");return r.add(i).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(Ks.fromArray(t.position1)),e.expandByPoint(Ks.fromArray(t.position2))}}_d.type="wideline",_d.fields={position1:"v3",position2:"v3",color:"c"};class xd{constructor(e,t){this.exp=3;const r=t||function(g){const{x:b,y:S,z:p}=g,y=new Nn,w=b.length,{min:x,max:_}=y;for(let A=0;A<w;A++)x.x=Math.min(b[A],x.x),x.y=Math.min(S[A],x.y),x.z=Math.min(p[A],x.z),_.x=Math.max(b[A],_.x),_.y=Math.max(S[A],_.y),_.z=Math.max(p[A],_.z);return y}(e);this.minX=r.min.x,this.minY=r.min.y,this.minZ=r.min.z,this.boundX=1+(r.max.x-this.minX>>this.exp),this.boundY=1+(r.max.y-this.minY>>this.exp),this.boundZ=1+(r.max.z-this.minZ>>this.exp);const i=this.boundX*this.boundY*this.boundZ,o=e.count!==void 0?e.count:e.x.length,s=e.x,a=e.y,l=e.z;let c=0;const u=new Uint32Array(i),d=new Int32Array(o);for(let g=0;g<o;++g){const b=s[g]-this.minX>>this.exp,S=a[g]-this.minY>>this.exp,p=l[g]-this.minZ>>this.exp,y=(b*this.boundY+S)*this.boundZ+p;(u[y]+=1)===1&&(c+=1),d[g]=y}const h=new Uint16Array(c);for(let g=0,b=0;g<i;++g){const S=u[g];S>0&&(u[g]=b+1,h[b]=S,b+=1)}const m=new Uint32Array(c);for(let g=1;g<c;++g)m[g]+=m[g-1]+h[g-1];const f=new Uint16Array(c),v=new Int32Array(o);for(let g=0;g<o;++g){const b=u[d[g]];if(b>0){const S=b-1;v[m[S]+f[S]]=g,f[S]+=1}}this.grid=u,this.bucketCount=h,this.bucketOffset=m,this.bucketArray=v,this.xArray=s,this.yArray=a,this.zArray=l}within(e,t,r,i){const o=[];return this.eachWithin(e,t,r,i,s=>o.push(s)),o}eachWithin(e,t,r,i,o){const s=i*i,a=Math.max(0,e-i-this.minX>>this.exp),l=Math.max(0,t-i-this.minY>>this.exp),c=Math.max(0,r-i-this.minZ>>this.exp),u=Math.min(this.boundX,1+(e+i-this.minX>>this.exp)),d=Math.min(this.boundY,1+(t+i-this.minY>>this.exp)),h=Math.min(this.boundZ,1+(r+i-this.minZ>>this.exp));for(let m=a;m<u;++m)for(let f=l;f<d;++f)for(let v=c;v<h;++v){const g=(m*this.boundY+f)*this.boundZ+v,b=this.grid[g];if(b>0){const S=b-1,p=this.bucketOffset[S],y=p+this.bucketCount[S];for(let w=p;w<y;++w){const x=this.bucketArray[w],_=this.xArray[x]-e,A=this.yArray[x]-t,C=this.zArray[x]-r,T=_*_+A*A+C*C;T<=s&&o(x,T)}}}}}class jc{constructor(e=0){this._fields=this._defaultFields,this._init(0)}get _defaultFields(){return[]}_init(e){this.length=e,this.count=0;for(let t=0,r=this._fields.length;t<r;++t){const[i,o,s]=this._fields[t];this._initField(i,o,s)}}_initField(e,t,r){this[e]=LE(r,this.length*t)}addField(e,t,r){this._fields.push([e,t,r]),this._initField(e,t,r)}resize(e){this.length=Math.round(e||0),this.count=Math.min(this.count,this.length);for(let t=0,r=this._fields.length;t<r;++t){const i=this._fields[t][0],o=this._fields[t][1],s=this.length*o,a=new this[i].constructor(s);this[i].length>s?a.set(this[i].subarray(0,s)):a.set(this[i]),this[i]=a}}growIfFull(){if(this.count>=this.length){const e=Math.round(1.5*this.length);this.resize(Math.max(256,e))}}copyFrom(e,t,r,i){for(let o=0,s=this._fields.length;o<s;++o){const a=this._fields[o][0],l=this._fields[o][1],c=this[a],u=e[a];for(let d=0;d<i;++d){const h=l*(t+d),m=l*(r+d);for(let f=0;f<l;++f)c[h+f]=u[m+f]}}}copyWithin(e,t,r){for(let i=0,o=this._fields.length;i<o;++i){const s=this._fields[i][0],a=this._fields[i][1],l=this[s];for(let c=0;c<r;++c){const u=a*(e+c),d=a*(t+c);for(let h=0;h<a;++h)l[u+h]=l[d+h]}}}sort(e){Be.time("Store.sort");const t=this,r=new this.constructor(1);(function i(o,s){if(o<s){let c=Math.floor((o+s)/2),u=o,d=s;do{for(;e(u,c)<0;)u+=1;for(;e(d,c)>0;)d-=1;u<=d&&(u===c?c=d:d===c&&(c=u),(a=u)!==(l=d)&&(r.copyFrom(t,0,a,1),t.copyWithin(a,l,1),t.copyFrom(r,l,0,1)),u+=1,d-=1)}while(u<=d);i(o,d),i(u,s)}var a,l})(0,this.count-1),Be.timeEnd("Store.sort")}clear(){this.count=0}dispose(){for(let e=0,t=this._fields.length;e<t;++e)delete this[this._fields[e][0]]}}class qG extends jc{get _defaultFields(){return[["index1",1,"int32"],["index2",1,"int32"],["type",1,"int8"]]}addContact(e,t,r){this.growIfFull();const i=this.count;e<t?(this.index1[i]=e,this.index2[i]=t):(this.index2[i]=e,this.index1[i]=t),r&&(this.type[i]=r),this.count+=1}}function Gh(n){return 16843009*((n=(858993459&(n-=n>>>1&1431655765))+(n>>>2&858993459))+(n>>>4)&252645135)>>>24}class Qn{constructor(e,t){this.length=e,this._words=new Uint32Array(e+32>>>5),t===!0&&this.setAll()}get(e){return!!(this._words[e>>>5]&1<<e)}set(e){this._words[e>>>5]|=1<<e}clear(e){this._words[e>>>5]&=~(1<<e)}flip(e){this._words[e>>>5]^=1<<e}_assignRange(e,t,r){if(t<e)return;const i=this._words,o=r===!0?4294967295:0,s=e>>>5,a=t>>>5;for(let u=s+1;u<a;++u)i[u]=o;const l=s<<5,c=a<<5;if(r===!0)if(t-e<32)for(let u=e,d=t+1;u<d;++u)i[u>>>5]|=1<<u;else{for(let u=e,d=l+32;u<d;++u)i[u>>>5]|=1<<u;for(let u=c,d=t+1;u<d;++u)i[u>>>5]|=1<<u}else if(t-e<32)for(let u=e,d=t+1;u<d;++u)i[u>>>5]&=~(1<<u);else{for(let u=e,d=l+32;u<d;++u)i[u>>>5]&=~(1<<u);for(let u=c,d=t+1;u<d;++u)i[u>>>5]&=~(1<<u)}return this}setRange(e,t){return this._assignRange(e,t,!0)}clearRange(e,t){return this._assignRange(e,t,!1)}setBits(...e){const t=this._words,r=e.length;for(let i=0;i<r;++i){const o=e[i];t[o>>>5]|=1<<o}return this}clearBits(...e){const t=this._words,r=e.length;for(let i=0;i<r;++i){const o=e[i];t[o>>>5]&=~(1<<o)}return this}setAll(){return this._assignRange(0,this.length-1,!0)}clearAll(){return this._assignRange(0,this.length-1,!1)}flipAll(){const e=this._words.length,t=this._words,r=32-this.length%32;for(let i=0;i<e-1;++i)t[i]=~t[i];return t[e-1]=~(t[e-1]<<r)>>>r,this}_isRangeValue(e,t,r){if(t<e)return;const i=this._words,o=r===!0?4294967295:0,s=e>>>5,a=t>>>5;for(let l=s+1;l<a;++l)if(i[l]!==o)return!1;if(t-e<32){for(let l=e,c=t+1;l<c;++l)if(!!(i[l>>>5]&1<<l)!==r)return!1}else{const l=a<<5;for(let c=e,u=(s<<5)+32;c<u;++c)if(!!(i[c>>>5]&1<<c)!==r)return!1;for(let c=l,u=t+1;c<u;++c)if(!!(i[c>>>5]&1<<c)!==r)return!1}return!0}isRangeSet(e,t){return this._isRangeValue(e,t,!0)}isRangeClear(e,t){return this._isRangeValue(e,t,!1)}isAllSet(){return this._isRangeValue(0,this.length-1,!0)}isAllClear(){return this._isRangeValue(0,this.length-1,!1)}isSet(...e){const t=this._words,r=e.length;for(let i=0;i<r;++i){const o=e[i];if(!(t[o>>>5]&1<<o))return!1}return!0}isClear(...e){const t=this._words,r=e.length;for(let i=0;i<r;++i){const o=e[i];if(t[o>>>5]&1<<o)return!1}return!0}isEqualTo(e){const t=this._words,r=e._words,i=Math.min(t.length,r.length);for(let o=0;o<i;++o)if(t[o]!==r[o])return!1;return!0}getSize(){const e=this._words.length,t=this._words;let r=0;for(let i=0;i<e;++i)r+=Gh(t[i]);return r}difference(e){const t=this._words,r=e._words,i=Math.min(t.length,r.length);for(let o=0;o<i;++o)t[o]=t[o]&~r[o];for(let o=t.length;o<i;++o)t[o]=0;return this}union(e){const t=this._words,r=e._words,i=Math.min(t.length,r.length);for(let o=0;o<i;++o)t[o]|=r[o];for(let o=t.length;o<i;++o)t[o]=0;return this}intersection(e){const t=this._words,r=e._words,i=Math.min(t.length,r.length);for(let o=0;o<i;++o)t[o]&=r[o];for(let o=t.length;o<i;++o)t[o]=0;return this}intersects(e){const t=this._words,r=e._words,i=Math.min(t.length,r.length);for(let o=0;o<i;++o)if(t[o]&r[o])return!0;return!1}getIntersectionSize(e){const t=this._words,r=e._words,i=Math.min(t.length,r.length);let o=0;for(let s=0;s<i;++s)o+=Gh(t[s]&r[s]);return o}makeIntersection(e){const t=this._words,r=e._words,i=Math.min(t.length,r.length),o=new Uint32Array(i),s=Object.create(Qn.prototype);s._words=o,s.length=Math.min(this.length,e.length);for(let a=0;a<i;++a)o[a]=t[a]&r[a];return s}forEach(e){const t=this._words.length,r=this._words;let i=0;for(let o=0;o<t;++o){let s=r[o];for(;s!==0;){const a=s&-s;e((o<<5)+Gh(a-1),i),s^=a,++i}}}toArray(){const e=this._words,t=new Array(this.getSize()),r=this._words.length;let i=0;for(let o=0;o<r;++o){let s=e[o];for(;s!==0;){const a=s&-s;t[i++]=(o<<5)+Gh(a-1),s^=a}}return t}toString(){return"{"+this.toArray().join(",")+"}"}toSeleString(){const e=this.toArray().join(",");return e?"@"+e:"NONE"}clone(){const e=Object.create(Qn.prototype);return e.length=this.length,e._words=new Uint32Array(this._words),e}}function KE(n){const{edgeCount:e,nodeCount:t,nodeArray1:r,nodeArray2:i}=n,o=new Uint8Array(t),s=new Int32Array(t);for(let c=0;c<e;++c)o[r[c]]+=1,o[i[c]]+=1;for(let c=1;c<t;++c)s[c]+=s[c-1]+o[c-1];const a=2*e,l=new Int32Array(a);for(let c=0;c<a;++c)l[c]=-1;for(let c=0;c<e;++c){const u=r[c],d=i[c];let h=s[u];for(;l[h]!==-1&&h<a;)h+=1;l[h]=c;let m=s[d];for(;l[m]!==-1&&m<a;)m+=1;l[m]=c}return{countArray:o,offsetArray:s,indexArray:l}}function sr(n=0,e=0){return{type:n,group:e,x:0,y:0,z:0,atomSet:[]}}function Vn(n,e){n.x+=e.x,n.y+=e.y,n.z+=e.z,n.atomSet.push(e.index)}function Gn(n,e){const t=e.atomSet.length;if(t>0){const{types:r,groups:i,centers:o,atomSets:s}=n;r.push(e.type),i.push(e.group),o.x.push(e.x/t),o.y.push(e.y/t),o.z.push(e.z/t),s.push(e.atomSet)}}const ol=0,XG=["D-BETA-PEPTIDE, C-GAMMA LINKING","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-PEPTIDE COOH CARBOXY TERMINUS","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE LINKING","PEPTIDE LINKING","PEPTIDE-LIKE"],YG=["RNA OH 3 PRIME TERMINUS","RNA OH 5 PRIME TERMINUS","RNA LINKING"],KG=["DNA OH 3 PRIME TERMINUS","DNA OH 5 PRIME TERMINUS","DNA LINKING","L-DNA LINKING","L-RNA LINKING"],ZE=["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","SACCHARIDE"],ZG=["NON-POLYMER"].concat(["OTHER"],ZE),JE=["h","g","i"],QE=["e","b"],eP=["s","t","l",""],tP={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109,DS:110,RG:111,CN:112,NH:113,FL:114,MC:115,LV:116,TS:117,OG:118},JG={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:2,114:2,115:2,116:2,117:2,118:2},QG={1:.31,2:.28,3:1.28,4:.96,5:.84,6:.76,7:.71,8:.66,9:.57,10:.58,11:1.66,12:1.41,13:1.21,14:1.11,15:1.07,16:1.05,17:1.02,18:1.06,19:2.03,20:1.76,21:1.7,22:1.6,23:1.53,24:1.39,25:1.39,26:1.32,27:1.26,28:1.24,29:1.32,30:1.22,31:1.22,32:1.2,33:1.19,34:1.2,35:1.2,36:1.16,37:2.2,38:1.95,39:1.9,40:1.75,41:1.64,42:1.54,43:1.47,44:1.46,45:1.42,46:1.39,47:1.45,48:1.44,49:1.42,50:1.39,51:1.39,52:1.38,53:1.39,54:1.4,55:2.44,56:2.15,57:2.07,58:2.04,59:2.03,60:2.01,61:1.99,62:1.98,63:1.98,64:1.96,65:1.94,66:1.92,67:1.92,68:1.89,69:1.9,70:1.87,71:1.87,72:1.75,73:1.7,74:1.62,75:1.51,76:1.44,77:1.41,78:1.36,79:1.36,80:1.32,81:1.45,82:1.46,83:1.48,84:1.4,85:1.5,86:1.5,87:2.6,88:2.21,89:2.15,90:2.06,91:2,92:1.96,93:1.9,94:1.87,95:1.8,96:1.69,97:1.6,98:1.6,99:1.6,100:1.6,101:1.6,102:1.6,103:1.6,104:1.6,105:1.6,106:1.6,107:1.6,108:1.6,109:1.6,110:1.6,111:1.6,112:1.6,113:1.6,114:1.6,115:1.6,116:1.6,117:1.6,118:1.6},kw={1:[1],2:[0],3:[1],4:[2],5:[3],6:[4],7:[3],8:[2],9:[1],10:[0],11:[1],12:[2],13:[6],14:[6],15:[3,5,7],16:[2,4,6],17:[1],18:[0],19:[1],20:[2],31:[3],32:[4],33:[3,5],34:[2,4,6],35:[1],36:[0],37:[1],38:[2],49:[3],50:[4],51:[3,5],52:[2],53:[1,2,5],54:[0,2],55:[1],56:[2],81:[3],82:[4],83:[3],84:[2],85:[1],86:[0],87:[1],88:[2]},eW={1:1,2:2,3:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:1,12:2,13:3,14:4,15:5,16:6,17:7,18:8,19:1,20:2,21:3,22:4,23:5,24:6,25:7,26:8,27:9,28:10,29:11,30:2,31:3,32:4,33:5,34:6,35:7,36:8,37:1,38:2,39:3,40:4,41:5,42:6,43:7,44:8,45:9,46:10,47:11,48:2,49:3,50:4,51:5,52:6,53:7,54:8,55:1,56:2,57:3,58:4,59:3,60:4,61:5,62:6,63:7,64:8,65:9,66:10,67:11,68:12,69:13,70:14,71:15,72:4,73:5,74:6,75:7,76:8,77:9,78:10,79:11,80:2,81:3,82:4,83:5,84:6,85:7,86:8,87:1,88:2,89:3,90:4,91:3,92:4,93:5,94:6,95:7,96:8,97:9,98:10,99:11,100:12,101:13,102:14,103:15,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:3,114:4,115:5,116:6,117:7,118:8},Bw={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53]},tW=[0,0,0],yp={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O"},hc=Object.keys(yp),nP=["A","C","T","G","U","I"],rP=["DA","DC","DT","DG","DU","DI"],nW=["A","G","I","DA","DG","DI"],qu=nP.concat(rP),_p=["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP3","TIP4","SPC"],rW=["118","119","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","543","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MLT","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NCO","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","OHX"],iW=["045","0AT","0BD","0MK","0NZ","0TS","0V4","0XY","0YT","10M","147","149","14T","15L","16G","18T","18Y","1AR","1BW","1GL","1GN","1JB","1LL","1NA","1S3","26M","26Q","26R","26V","26W","26Y","27C","289","291","293","2DG","2F8","2FG","2FL","2FP","2GL","2M4","2M5","32O","34V","3CM","3DO","3DY","3FM","3LR","3MF","3MG","3SA","3ZW","46D","46M","46Z","48Z","4CQ","4GC","4NN","50A","5DI","5GF","5MM","5RP","5SA","5SP","64K","6PG","6SA","7JZ","7SA","A1Q","A2G","AAB","AAL","AAO","ABC","ABD","ABE","ABF","ABL","ACG","ACI","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AHR","AIG","ALL","ALX","AMU","AOG","AOS","ARA","ARB","ARE","ARI","ASG","ASO","AXP","AXR","B0D","B16","B2G","B4G","B6D","B8D","B9D","BBK","BCD","BDG","BDP","BDR","BEM","BFP","BGC","BGL","BGP","BGS","BHG","BMA","BMX","BNG","BNX","BOG","BRI","BXF","BXP","BXX","BXY","C3X","C4X","C5X","CAP","CBI","CBK","CBS","CDR","CEG","CGF","CHO","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D6G","DAF","DAG","DDA","DDB","DDL","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGS","DIG","DLF","DLG","DMU","DNO","DOM","DP5","DQQ","DQR","DR2","DR3","DR4","DRI","DSR","DT6","DVC","E4P","E5G","EAG","EBG","EBQ","EGA","EJT","EPG","ERE","ERI","F1P","F1X","F6P","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FIX","FMO","FRU","FSI","FU4","FUB","FUC","FUD","FUL","FXP","G16","G1P","G2F","G3I","G4D","G4S","G6D","G6P","G6S","GAC","GAD","GAL","GC1","GC4","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GCX","GE1","GFG","GFP","GIV","GL0","GL2","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GMH","GN1","GNX","GP1","GP4","GPH","GPM","GQ1","GQ2","GQ4","GS1","GS4","GSA","GSD","GTE","GTH","GTK","GTR","GTZ","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUP","GUZ","GYP","GYV","H2P","HDL","HMS","HS2","HSD","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","IAB","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IMK","IN1","IPT","ISL","KBG","KD2","KDA","KDM","KDO","KFN","KO1","KO2","KTU","L6S","LAG","LAI","LAK","LAO","LAT","LB2","LBT","LCN","LDY","LGC","LGU","LM2","LMT","LMU","LOG","LOX","LPK","LSM","LTM","LVZ","LXB","LXZ","M1F","M3M","M6P","M8C","MA1","MA2","MA3","MAB","MAG","MAL","MAN","MAT","MAV","MAW","MBG","MCU","MDA","MDM","MDP","MFA","MFB","MFU","MG5","MGA","MGL","MLB","MMA","MMN","MN0","MRP","MTT","MUG","MVP","MXY","N1L","N9S","NAA","NAG","NBG","NDG","NED","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGL","NGS","NGY","NHF","NM6","NM9","NTF","NTO","NTP","NXD","NYT","OPG","OPM","ORP","OX2","P3M","P53","P6P","PA5","PNA","PNG","PNW","PRP","PSJ","PSV","PTQ","QDK","QPS","QV4","R1P","R1X","R2B","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RIB","RIP","RNS","RNT","ROB","ROR","RPA","RST","RUB","RUU","RZM","S6P","S7P","SA0","SCR","SDD","SF6","SF9","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHG","SI3","SIO","SOE","SOL","SSG","SUC","SUP","SUS","T6P","T6T","TAG","TCB","TDG","TGK","TGY","TH1","TIA","TM5","TM6","TM9","TMR","TMX","TOA","TOC","TRE","TYV","UCD","UDC","VG1","X0X","X1X","X2F","X4S","X5S","X6X","XBP","XDN","XDP","XIF","XIM","XLF","XLS","XMM","XUL","XXR","XYP","XYS","YO5","Z3Q","Z6J","Z9M","ZDC","ZDM"],oW=["CA","C","N","O","O1","O2","OC1","OC2","OX1","OXT","OT1","OT2","H","H1","H2","H3","HA","HN","BB"],iP=["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"],Tu={1:{trace:"CA",direction1:"C",direction2:["O","OC1","O1","OX1","OXT","OT1","OT2"],backboneStart:"N",backboneEnd:"C"},2:{trace:["C4'","C4*"],direction1:["C1'","C1*"],direction2:["C3'","C3*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},3:{trace:["C3'","C3*"],direction1:["C2'","C2*"],direction2:["O4'","O4*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},4:{trace:["CA","BB"],backboneStart:["CA","BB"],backboneEnd:["CA","BB"]},5:{trace:["C4'","C4*","P"],backboneStart:["C4'","C4*","P"],backboneEnd:["C4'","C4*","P"]},6:{trace:["C3'","C3*","C2'","P"],backboneStart:["C3'","C3*","C2'","P"],backboneEnd:["C3'","C3*","C2'","P"]}};Tu[ol]={};const Nw={HD:"H",HS:"H",A:"C",NA:"N",NS:"N",OA:"O",OS:"O",SA:"S",G0:"C",G1:"C",G2:"C",G3:"C",CG0:"C",CG1:"C",CG2:"C",CG3:"C",W:"O"};function Wh(n){switch(n){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}const zw=new Map([[2,kn(180)],[3,kn(120)],[4,kn(109.4721)],[6,kn(90)]]);function jh(n,e){let t=[];const r=new te,i=new te;return r.subVectors(e,n),n.eachBondedAtom(o=>{o.number!==1&&(i.subVectors(o,n),t.push(r.angleTo(i)))}),t}function Uw(n,e){const t=n.clone(),r=new te;r.subVectors(e,n);const i=[new te,new te];let o=0;if(n.eachBondedAtom(a=>{o>1||a.number!==1&&(t.index=a.index,i[o++].subVectors(a,n))}),o===1&&t.eachBondedAtom(a=>{o>1||a.number!==1&&a.index!==n.index&&i[o++].subVectors(a,n)}),o!==2)return;const s=i[0].cross(i[1]);return Math.abs(Math.PI/2-s.angleTo(r))}function sW(n,e){const t=n.structure,r=t.atomCount,i=new Int8Array(r),o=new Int8Array(r),s=new Int8Array(r),a=new Int8Array(r);return t.eachAtom(l=>{const c=l.index,[u,d,h,m]=function(f,v){const g=f.bondToElementCount(1);let b=f.formalCharge||0;const S=v.assignCharge==="always"||v.assignCharge==="auto"&&b===0,p=v.assignH==="always"||v.assignH==="auto"&&g===0,y=f.bondCount,w=function(T){let I=0;return T.eachBond(M=>I+=M.bondOrder),I}(f),x=function(T){const I=T.structure.getBondProxy(),M=T.number,P=M===8||M===7;if(P&&T.bondCount===4)return!1;let E=!1;return T.eachBond(R=>{if(R.bondOrder>1)E=!0;else if(P){const B=R.getOtherAtom(T);B.eachBond(L=>{if(L.bondOrder>1){const F=B.number;if((F===15||F===16)&&L.getOtherAtom(B).number===8)return;E=!0}},I)}}),E}(f),_=w-y>0;let A=0,C=8;switch(f.number){case 1:S&&(y===0?(b=1,C=0):y===1&&(b=0,C=1));break;case 6:S&&(b=0),p&&(A=Math.max(0,4-w-Math.abs(b))),C=Wh(y+A+Math.max(0,-b));break;case 7:if(S)if(p)if(x&&w<4)b=y-g==1&&w-g==2?1:0;else{let T=!1;f.eachBondedAtom(I=>{(I.number===16||I.isMetal())&&(T=!0)}),b=T?0:1}else b=w-3;p&&(A=Math.max(0,3-w+b)),C=Wh(x&&!_?y+A-b:y+A+1-b);break;case 8:S&&(p||(b=w-2),w===1&&f.eachBondedAtom(T=>{T.eachBond(I=>{const M=I.getOtherAtom(T);M.index!==f.index&&M.number===8&&I.bondOrder===2&&(b=-1)})})),p&&(A=Math.max(0,2-w+b)),C=Wh(x&&!_?y+A-b+1:y+A-b+2);break;case 16:S&&(p||(b=w<=3&&!f.bondToElementCount(8)?w-2:0)),p&&w<2&&(A=Math.max(0,2-w+b)),w<=3&&(C=Wh(y+A-b+2));break;case 9:case 17:case 35:case 53:case 85:S&&(b=w-1);break;case 3:case 11:case 19:case 37:case 55:case 87:S&&(b=1-w);break;case 4:case 12:case 20:case 38:case 56:case 88:S&&(b=2-w);break;default:console.warn("Requested charge, protonation for an unhandled element",f.element)}return[b,A,A+g,C]}(l,e);i[c]=u,o[c]=d,s[c]=h,a[c]=m}),{charge:i,implicitH:o,totalH:s,idealGeometry:a}}function Kl(n){if(n["@valenceModel"])return n["@valenceModel"];const e=sW(n,{assignCharge:"auto",assignH:"auto"});return n["@valenceModel"]=e,e}function $w(n){return n.number===15&&n.bondToElementCount(8)===n.bondCount}const aW=["ARG","HIS","LYS"],lW=["GLU","ASP"];function cW(n,e){return n===2&&e===1||n===1&&e===2}function uW(n,e){return n===3&&e===3}function dW(n,e){return n===3&&e===1||n===1&&e===3}function Hw(n){return n.resname==="HIS"&&n.number==7&&n.isRing()}function hW(n,e){return n===5&&e===4||n===4&&e===5}function fW(n,e){return n===9&&e===5||n===5&&e===9}const pW=[3,11,19,37,55,12,20,38,56,13,31,49,81,21,50,82,83,51,80];function mW(n,e){return n===12?e===11||e===12:n===13?e===10:void 0}const gW=[17,35,53,85],vW=[7,8,16],bW=[6,7,15,16],yW=kn(180),_W=kn(120);function Vw(n,e,t){return!oP(n,e,t)&&(n.modelIndex!==e.modelIndex||n.altloc&&e.altloc&&n.altloc!==e.altloc)}const En={maxHydrophobicDist:4,maxHbondDist:3.5,maxHbondSulfurDist:4.1,maxHbondAccAngle:45,maxHbondDonAngle:45,maxHbondAccPlaneAngle:90,maxHbondDonPlaneAngle:30,maxPiStackingDist:5.5,maxPiStackingOffset:2,maxPiStackingAngle:30,maxCationPiDist:6,maxCationPiOffset:2,maxIonicDist:5,maxHalogenBondDist:4,maxHalogenBondAngle:30,maxMetalDist:3,refineSaltBridges:!0,masterModelIndex:-1,lineOfSightDistFactor:1};function oP(n,e,t){return n.modelIndex===t&&e.modelIndex!==t||e.modelIndex===t&&n.modelIndex!==t}function hu(n,e,t){return!oP(n,e,t)&&(n.modelIndex!==e.modelIndex||n.residueIndex===e.residueIndex||n.altloc&&e.altloc&&n.altloc!==e.altloc)}function xW(n){const e={types:[],groups:[],centers:{x:[],y:[],z:[]},atomSets:[]};return Xe&&Be.time("calculateFeatures"),function(t,r){const{charge:i}=Kl(t.data),o={};t.eachResidue(s=>{if(aW.includes(s.resname)){const a=sr(1);s.eachAtom(l=>{l.number===7&&l.isSidechain()&&Vn(a,l)}),Gn(r,a)}else hc.includes(s.resname)||s.isNucleic()||(s.eachAtom(a=>{let l=!1;const c=sr(1);(function(u){let d=0;return u.number===6&&u.bondCount===3&&u.bondToElementCount(7)===3&&u.eachBondedAtom(h=>{h.bondCount-h.bondToElementCount(1)==1&&++d}),d===2})(a)?(c.group=8,l=!0):function(u){let d=0;return u.number===6&&u.bondCount===3&&u.bondToElementCount(7)===2&&u.bondToElementCount(6)===1&&u.eachBondedAtom(h=>{h.bondCount-h.bondToElementCount(1)==1&&++d}),d===2}(a)&&(c.group=9,l=!0),l&&(a.eachBondedAtom(u=>{u.number===7&&(o[u.index]=!0,Vn(c,u))}),Gn(r,c))}),s.eachAtom(a=>{const l=sr(1);i[a.index]>0&&(o[a.index]||(Vn(l,a),Gn(r,l)))}))})}(n,e),function(t,r){const{charge:i}=Kl(t.data),o={};t.eachResidue(s=>{if(lW.includes(s.resname)){const a=sr(2);s.eachAtom(l=>{l.number===8&&l.isSidechain()&&Vn(a,l)}),Gn(r,a)}else if(qu.includes(s.resname)){const a=sr(2);s.eachAtom(l=>{$w(l)&&(a.group=6,l.eachBondedAtom(c=>{c.number===8&&Vn(a,c)}),Gn(r,a))})}else hc.includes(s.resname)||qu.includes(s.resname)||(s.eachAtom(a=>{let l=!1;const c=sr(2);(function(u){return u.number===16&&u.bondToElementCount(8)===3})(a)?(c.group=4,l=!0):$w(a)?(c.group=6,l=!0):function(u){return u.number===16&&u.bondToElementCount(8)===4}(a)?(c.group=5,l=!0):function(u){let d=0;return u.number===6&&u.bondToElementCount(8)===2&&u.bondToElementCount(6)===1&&u.eachBondedAtom(h=>{h.number===8&&h.bondCount-h.bondToElementCount(1)==1&&++d}),d===2}(a)&&(c.group=10,l=!0),l&&(a.eachBondedAtom(u=>{u.number===8&&(o[u.index]=!0,Vn(c,u))}),Gn(r,c))}),s.eachAtom(a=>{const l=sr(2);i[a.index]<0&&(o[a.index]||(Vn(l,a),Gn(r,l)))}))})}(n,e),function(t,r){const i=t.getAtomProxy();t.eachResidue(o=>{const s=o.getAromaticRings();if(s){const a=o.atomOffset;s.forEach(l=>{const c=sr(3);l.forEach(u=>{i.index=u+a,Vn(c,i)}),Gn(r,c)})}})}(n,e),function(t,r){const{charge:i,implicitH:o,idealGeometry:s}=Kl(t.data);t.eachAtom(a=>{const l=sr(5),c=a.number;if(c===8)Vn(l,a),Gn(r,l);else if(c===7){if(Hw(a))Vn(l,a),Gn(r,l);else if(i[a.index]<1){const u=a.bondCount+o[a.index],d=s[a.index];(d===4&&u<4||d===3&&u<3||d===2&&u<2)&&(Vn(l,a),Gn(r,l))}}else c===16&&(a.resname!=="CYS"&&a.resname!=="MET"&&a.formalCharge!==-1||(Vn(l,a),Gn(r,l)))})}(n,e),function(t,r){const{totalH:i}=Kl(t.data);t.eachAtom(o=>{const s=sr(4),a=o.number;(Hw(o)||i[o.index]>0&&(a===7||a===8||a===16))&&(Vn(s,o),Gn(r,s))})}(n,e),function(t,r){const{totalH:i}=Kl(t.data);t.eachAtom(o=>{if(o.number===6&&i[o.index]>0&&(o.bondToElementCount(7)>0||o.bondToElementCount(8)>0||function(s){if(!s.isAromatic())return!1;const a=s.residueType.getRings();if(!a)return!1;let l=!1;return a.rings.forEach(c=>{l||c.some(u=>s.index-s.residueAtomOffset===u)&&(l=c.some(u=>{const d=s.residueType.atomTypeIdList[u],h=s.atomMap.get(d).number;return h===7||h===8}))}),l}(o))){const s=sr(9);Vn(s,o),Gn(r,s)}})}(n,e),function(t,r){t.eachAtom(i=>{let o=!1,s=!1;const a=hc.includes(i.resname),l=qu.includes(i.resname);if(a||l?a?i.number===8?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(i.resname)&&i.isSidechain()||i.isBackbone())&&(o=!0,s=!0):i.number===16&&i.resname==="CYS"?(o=!0,s=!0):i.number===7&&i.resname==="HIS"&&i.isSidechain()&&(o=!0):l&&(i.number===8&&i.isBackbone()?(o=!0,s=!0):["N3","N4","N7"].includes(i.atomname)?o=!0:["O2","O4","O6"].includes(i.atomname)&&(o=!0,s=!0)):i.isHalogen()||i.number===8||i.number===16?(o=!0,s=!0):i.number===7&&(o=!0),o){const c=sr(11);Vn(c,i),Gn(r,c)}if(s){const c=sr(10);Vn(c,i),Gn(r,c)}})}(n,e),function(t,r){t.eachAtom(i=>{if(i.isTransitionMetal()||i.number===30||i.number===48){const o=sr(12);Vn(o,i),Gn(r,o)}else if(pW.includes(i.number)){const o=sr(13);Vn(o,i),Gn(r,o)}})}(n,e),function(t,r){t.eachAtom(i=>{const o=sr(8);let s=!1;i.number===6?(s=!0,i.eachBondedAtom(a=>{const l=a.number;l!==6&&l!==1&&(s=!1)})):i.number===9&&(s=!0),s&&(Vn(o,i),Gn(r,o))})}(n,e),function(t,r){t.eachAtom(i=>{if(vW.includes(i.number)){let o=!1;if(i.eachBondedAtom(s=>{bW.includes(s.number)&&(o=!0)}),o){const s=sr(7);Vn(s,i),Gn(r,s)}}})}(n,e),function(t,r){t.eachAtom(i=>{if(gW.includes(i.number)&&i.bondToElementCount(6)===1){const o=sr(6);Vn(o,i),Gn(r,o)}})}(n,e),Xe&&Be.timeEnd("calculateFeatures"),e}function wW(n,e=En){const t=function(i){const{types:o,centers:s}=i;return{features:i,spatialHash:new xd(s),contactStore:new qG,featureSet:new Qn(o.length,!1)}}(xW(n));Xe&&Be.time("calculateContacts"),function(i,o,s={}){const a=W(s.maxIonicDist,En.maxIonicDist),l=W(s.maxPiStackingDist,En.maxPiStackingDist),c=W(s.maxPiStackingOffset,En.maxPiStackingOffset),u=W(s.maxPiStackingAngle,En.maxPiStackingAngle),d=W(s.maxCationPiDist,En.maxCationPiDist),h=W(s.maxCationPiOffset,En.maxCationPiOffset),m=W(s.masterModelIndex,En.masterModelIndex),f=Math.max(a+2,l,d),v=l*l,g=d*d,{features:b,spatialHash:S,contactStore:p,featureSet:y}=o,{types:w,centers:x,atomSets:_}=b,{x:A,y:C,z:T}=x,I=w.length,M=i.atomStore.x,P=i.atomStore.y,E=i.atomStore.z,R=i.getAtomProxy(),B=i.getAtomProxy(),L=function(Z,re,se){const fe=Z.length,ue=re.length;for(let U=0;U<fe;++U){R.index=Z[U];for(let K=0;K<ue;++K)if(B.index=re[K],R.distanceTo(B)<=se)return!0}return!1},F=new te,H=new te,$=new te,O=new te,k=new te,X=new te,ie=new te,ne=function(Z,re){F.set(M[Z[0]],P[Z[0]],E[Z[0]]),H.set(M[Z[1]],P[Z[1]],E[Z[1]]),$.set(M[Z[2]],P[Z[2]],E[Z[2]]),O.subVectors(F,H),k.subVectors(F,$),re.crossVectors(O,k)},Q=function(Z,re,se){return F.set(A[Z],C[Z],T[Z]),H.set(A[re],C[re],T[re]),F.sub(H).projectOnPlane(se).add(H).distanceTo(H)},ce=function(Z,re,se){y.setBits(Z,re),p.addContact(Z,re,se)};for(let Z=0;Z<I;++Z)S.eachWithin(A[Z],C[Z],T[Z],f,(re,se)=>{if(re<=Z||(R.index=_[Z][0],B.index=_[re][0],hu(R,B,m)))return;const fe=w[Z],ue=w[re];if(cW(fe,ue))L(_[Z],_[re],a)&&ce(Z,re,1);else if(uW(fe,ue)){if(se<=v){ne(_[Z],X),ne(_[re],ie);const U=57.29578*X.angleTo(ie);Math.min(Q(Z,re,ie),Q(re,Z,X))<=c&&(U<=u||U>=180-u||U<=u+90&&U>=90-u)&&ce(Z,re,3)}}else if(dW(fe,ue)&&se<=g){const[U,K]=fe===3?[Z,re]:[re,Z];ne(_[U],X),Q(K,U,X)<=h&&ce(U,K,2)}})}(n,t,e),function(i,o,s={}){const a=W(s.maxHbondDist,En.maxHbondDist),l=W(s.maxHbondSulfurDist,En.maxHbondSulfurDist),c=kn(W(s.maxHbondAccAngle,En.maxHbondAccAngle)),u=kn(W(s.maxHbondDonAngle,En.maxHbondDonAngle)),d=kn(W(s.maxHbondAccPlaneAngle,En.maxHbondAccPlaneAngle)),h=kn(W(s.maxHbondDonPlaneAngle,En.maxHbondDonPlaneAngle)),m=W(s.masterModelIndex,En.masterModelIndex),f=Math.max(a,l),v=a*a,{features:g,spatialHash:b,contactStore:S,featureSet:p}=o,{types:y,centers:w,atomSets:x}=g,{x:_,y:A,z:C}=w,T=y.length,{idealGeometry:I}=Kl(i.data),M=i.getAtomProxy(),P=i.getAtomProxy();for(let E=0;E<T;++E)b.eachWithin(_[E],A[E],C[E],f,(R,B)=>{if(R<=E)return;const L=y[E],F=y[R],H=fW(L,F);if(!H&&!hW(L,F))return;const[$,O]=F===5?[E,R]:[R,E];if(M.index=x[$][0],P.index=x[O][0],P.index===M.index||hu(M,P,m)||M.number!==16&&P.number!==16&&B>v||M.connectedTo(P))return;const k=jh(M,P),X=zw.get(I[M.index])||kn(120);if(k.some(re=>Math.abs(X-re)>u))return;if(I[M.index]===3){const re=Uw(M,P);if(re!==void 0&&re>h)return}const ie=jh(P,M),ne=zw.get(I[P.index])||kn(120);if(ie.some(re=>ne-re>c))return;if(I[P.index]===3){const re=Uw(P,M);if(re!==void 0&&re>d)return}p.setBits($,O);const Q=H?8:function(re,se){return re.isWater()&&se.isWater()}(ce=M,Z=P)?9:function(re,se){return re.isBackbone()&&se.isBackbone()}(ce,Z)?10:4;var ce,Z;S.addContact($,O,Q)})}(n,t,e),function(i,o,s={}){const a=W(s.maxMetalDist,En.maxMetalDist),l=W(s.masterModelIndex,En.masterModelIndex),{features:c,spatialHash:u,contactStore:d,featureSet:h}=o,{types:m,centers:f,atomSets:v}=c,{x:g,y:b,z:S}=f,p=m.length,y=i.getAtomProxy(),w=i.getAtomProxy();for(let x=0;x<p;++x)u.eachWithin(g[x],b[x],S[x],a,(_,A)=>{if(_<=x||(y.index=v[x][0],w.index=v[_][0],hu(y,w,l)))return;const C=y.isMetal(),T=w.isMetal();if(!C&&!T)return;const[I,M]=C?[m[x],m[_]]:[m[_],m[x]];mW(I,M)&&(h.setBits(x,_),d.addContact(x,_,7))})}(n,t,e),function(i,o,s={}){const a=W(s.maxHydrophobicDist,En.maxHydrophobicDist),l=W(s.masterModelIndex,En.masterModelIndex),{features:c,spatialHash:u,contactStore:d,featureSet:h}=o,{types:m,centers:f,atomSets:v}=c,{x:g,y:b,z:S}=f,p=m.length,y=i.getAtomProxy(),w=i.getAtomProxy();for(let x=0;x<p;++x)u.eachWithin(g[x],b[x],S[x],a,(_,A)=>{var C,T;_<=x||(y.index=v[x][0],w.index=v[_][0],hu(y,w,l)||y.number===9&&w.number===9||y.connectedTo(w)||(C=m[x],T=m[_],C===8&&T===8&&(h.setBits(x,_),d.addContact(x,_,6))))})}(n,t,e),function(i,o,s={}){const a=W(s.maxHalogenBondDist,En.maxHalogenBondDist),l=kn(W(s.maxHalogenBondAngle,En.maxHalogenBondAngle)),c=W(s.masterModelIndex,En.masterModelIndex),{features:u,spatialHash:d,contactStore:h,featureSet:m}=o,{types:f,centers:v,atomSets:g}=u,{x:b,y:S,z:p}=v,y=f.length,w=i.getAtomProxy(),x=i.getAtomProxy();for(let _=0;_<y;++_)d.eachWithin(b[_],S[_],p[_],a,(A,C)=>{if(A<=_||(w.index=g[_][0],x.index=g[A][0],hu(w,x,c))||(T=f[_],I=f[A],!(T===7&&I===6||T===6&&I===7)))return;var T,I;const[M,P]=f[_]===6?[w,x]:[x,w],E=jh(M,P);if(E.length!==1||yW-E[0]>l)return;const R=jh(P,M);R.length!==0&&(R.some(B=>_W-B>l)||(m.setBits(_,A),h.addContact(_,A,5)))})}(n,t,e);const r=function(i){const{index1:o,index2:s,count:a}=i.contactStore,l=KE({nodeArray1:o,nodeArray2:s,edgeCount:a,nodeCount:i.featureSet.length}),c=new Qn(i.contactStore.count,!0);return Object.assign({adjacencyList:l,contactSet:c},i)}(t);return function(i,o,s={}){Xe&&Be.time("refineLineOfSight");const a=W(s.lineOfSightDistFactor,En.lineOfSightDistFactor),l=W(s.masterModelIndex,En.masterModelIndex),c=i.spatialHash,{contactSet:u,contactStore:d,features:h}=o,{index1:m,index2:f}=d,{centers:v,atomSets:g}=h,{x:b,y:S,z:p}=v,y=i.getAtomProxy(),w=i.getAtomProxy(),x=i.getAtomProxy(),_=new te,A=new te,C=3*a,T=a*a;u.forEach(I=>{_.set(b[m[I]],S[m[I]],p[m[I]]),A.set(b[f[I]],S[f[I]],p[f[I]]);const M=(_.x+A.x)/2,P=(_.y+A.y)/2,E=(_.z+A.z)/2,R=g[m[I]],B=g[f[I]];y.index=R[0],w.index=B[0],c.eachWithin(M,P,E,C,(L,F)=>{x.index=L,x.number!==1&&x.vdw*x.vdw*T>F&&!Vw(y,x,l)&&!Vw(w,x,l)&&!R.includes(L)&&!B.includes(L)&&_.distanceToSquared(x)>1&&A.distanceToSquared(x)>1&&(u.clear(I),Xe&&Be.log("removing",y.qualifiedName(),w.qualifiedName(),"because",x.qualifiedName()))})}),Xe&&Be.timeEnd("refineLineOfSight")}(n,r,e),function(i,o){const{contactSet:s,contactStore:a,features:l}=o,{type:c,index1:u,index2:d}=a,{atomSets:h}=l,m=i.getAtomProxy(),f=i.getAtomProxy(),v={},g=function(b,S,p){const[y,w]=v[p]||[1/0,-1];b<y?(w!==-1&&s.clear(w),v[p]=[b,S]):s.clear(S)};s.forEach(b=>{if(c[b]!==6)return;m.index=h[u[b]][0],f.index=h[d[b]][0];const S=m.distanceTo(f);g(S,b,`${m.index}|${f.residueIndex}`),g(S,b,`${f.index}|${m.residueIndex}`)})}(n,r),e.refineSaltBridges&&function(i,o){const{contactSet:s,contactStore:a,features:l}=o,{type:c,index1:u,index2:d}=a,{atomSets:h}=l,m={},f=function(v,g){m[v]||(m[v]=[]),m[v].push(g)};s.forEach(v=>{c[v]===1&&(h[u[v]].forEach(g=>f(g,v)),h[d[v]].forEach(g=>f(g,v)))}),s.forEach(v=>{if(!function(p){return p===4||p===9||p===10}(c[v]))return;const g=m[h[u[v]][0]],b=m[h[d[v]][0]];if(!g||!b)return;const S=g.length;for(let p=0;p<S;++p)if(b.includes(g[p]))return void s.clear(v)})}(0,r),function(i,o){const{contactSet:s,contactStore:a,features:l}=o,{type:c,index1:u,index2:d}=a,{atomSets:h}=l,m={},f=function(v,g){m[v]||(m[v]=[]),m[v].push(g)};s.forEach(v=>{c[v]===3&&(h[u[v]].forEach(g=>f(g,v)),h[d[v]].forEach(g=>f(g,v)))}),s.forEach(v=>{if(c[v]!==6&&c[v]!==2)return;const g=m[h[u[v]][0]],b=m[h[d[v]][0]];if(!g||!b)return;const S=g.length;for(let p=0;p<S;++p)if(b.includes(g[p]))return void s.clear(v)})}(0,r),function(i,o){const{contactSet:s,contactStore:a,features:l}=o,{type:c,index1:u,index2:d}=a,{atomSets:h}=l,m={},f=function(v,g){m[v]||(m[v]=[]),m[v].push(g)};s.forEach(v=>{c[v]===1&&(h[u[v]].forEach(g=>f(g,v)),h[d[v]].forEach(g=>f(g,v)))}),s.forEach(v=>{if(c[v]!==7)return;const g=m[h[u[v]][0]],b=m[h[d[v]][0]];if(!g||!b)return;const S=g.length;for(let p=0;p<S;++p)if(b.includes(g[p]))return void s.clear(g[p])})}(0,r),Xe&&Be.timeEnd("calculateContacts"),r}function SW(n){switch(n){case 4:case 9:case 10:return"hydrogen bond";case 6:return"hydrophobic contact";case 5:return"halogen bond";case 1:return"ionic interaction";case 7:return"metal coordination";case 2:return"cation-pi interaction";case 3:return"pi-pi stacking";case 8:return"weak hydrogen bond";default:return"unknown contact"}}const CW={hydrogenBond:!0,hydrophobic:!0,halogenBond:!0,ionicInteraction:!0,metalCoordination:!0,cationPi:!0,piStacking:!0,weakHydrogenBond:!0,waterHydrogenBond:!0,backboneHydrogenBond:!0,radius:1,filterSele:""},No=new _t;function AW(n,e,t){const r=hi(t,CW),i=[];r.hydrogenBond&&i.push(4),r.hydrophobic&&i.push(6),r.halogenBond&&i.push(5),r.ionicInteraction&&i.push(1),r.metalCoordination&&i.push(7),r.cationPi&&i.push(2),r.piStacking&&i.push(3),r.weakHydrogenBond&&i.push(8),r.waterHydrogenBond&&i.push(9),r.backboneHydrogenBond&&i.push(10);const{features:o,contactSet:s,contactStore:a}=n,{centers:l,atomSets:c}=o,{x:u,y:d,z:h}=l,{index1:m,index2:f,type:v}=a,g=[],b=[],S=[],p=[],y=[];let w;return r.filterSele&&(w=Array.isArray(r.filterSele)?r.filterSele.map(x=>e.getAtomSet(new yn(x))):e.getAtomSet(new yn(r.filterSele))),s.forEach(x=>{const _=v[x];if(!i.includes(_))return;if(w){const T=c[m[x]][0],I=c[f[x]][0];if(Array.isArray(w)){if(!(w[0].isSet(T)&&w[1].isSet(I)||w[1].isSet(T)&&w[0].isSet(I)))return}else if(!w.isSet(T)&&!w.isSet(I))return}const A=m[x],C=f[x];g.push(u[A],d[A],h[A]),b.push(u[C],d[C],h[C]),S.push(...function(T){switch(T){case 4:case 9:case 10:return No.setHex(2851770).toArray();case 6:return No.setHex(8421504).toArray();case 5:return No.setHex(4259775).toArray();case 1:return No.setHex(15779860).toArray();case 7:return No.setHex(9191577).toArray();case 2:return No.setHex(16744448).toArray();case 3:return No.setHex(9220966).toArray();case 8:return No.setHex(12967404).toArray();default:return No.setHex(13421772).toArray()}}(_)),p.push(r.radius),y.push(x)}),{position1:new Float32Array(g),position2:new Float32Array(b),color:new Float32Array(S),color2:new Float32Array(S),radius:new Float32Array(p),picking:new TW(y,n,e)}}class Ro{constructor(e){this.array=e}get type(){return""}get data(){return{}}getIndex(e){return this.array?this.array[e]:e}getObject(e){return{}}_applyTransformations(e,t,r){return t&&e.applyMatrix4(t.matrix),r&&e.applyMatrix4(r.matrix),e}_getPosition(e){return new te}getPosition(e,t,r){return this._applyTransformations(this._getPosition(e),t,r)}}class xi extends Ro{constructor(e){super(),this.shape=e}get primitive(){}get data(){return this.shape}get type(){return this.primitive.type}getObject(e){return this.primitive.objectFromShape(this.shape,this.getIndex(e))}_getPosition(e){return this.primitive.positionFromShape(this.shape,this.getIndex(e))}}class gl extends Ro{constructor(e,t){super(e),this.structure=t}get type(){return"atom"}get data(){return this.structure}getObject(e){return this.structure.getAtomProxy(this.getIndex(e))}_getPosition(e){return new te().copy(this.getObject(e))}}class MW extends Ro{constructor(e){super(),this.axes=e}get type(){return"axes"}get data(){return this.axes}getObject(){return{axes:this.axes}}_getPosition(){return this.axes.center.clone()}}class sP extends Ro{constructor(e,t,r){super(e),this.structure=t,this.bondStore=r||t.bondStore}get type(){return"bond"}get data(){return this.structure}getObject(e){const t=this.structure.getBondProxy(this.getIndex(e));return t.bondStore=this.bondStore,t}_getPosition(e){const t=this.getObject(e);return new te().copy(t.atom1).add(t.atom2).multiplyScalar(.5)}}class TW extends Ro{constructor(e,t,r){super(e),this.contacts=t,this.structure=r}get type(){return"contact"}get data(){return this.contacts}getObject(e){const t=this.getIndex(e),{features:r,contactStore:i}=this.contacts,{centers:o,atomSets:s}=r,{x:a,y:l,z:c}=o,{index1:u,index2:d,type:h}=i,m=u[t],f=d[t];return{center1:new te(a[m],l[m],c[m]),center2:new te(a[f],l[f],c[f]),atom1:this.structure.getAtomProxy(s[m][0]),atom2:this.structure.getAtomProxy(s[f][0]),type:SW(h[t])}}_getPosition(e){const{center1:t,center2:r}=this.getObject(e);return new te().addVectors(t,r).multiplyScalar(.5)}}class EW extends Ro{constructor(e,t,r){super(e),this.validation=t,this.structure=r}get type(){return"clash"}get data(){return this.validation}getObject(e){const t=this.validation,r=this.getIndex(e);return{validation:t,index:r,clash:t.clashArray[r]}}_getAtomProxyFromSele(e){const t=new yn(e),r=this.structure.getAtomIndices(t)[0];return this.structure.getAtomProxy(r)}_getPosition(e){const t=this.getObject(e).clash,r=this._getAtomProxyFromSele(t.sele1),i=this._getAtomProxyFromSele(t.sele2);return new te().copy(r).add(i).multiplyScalar(.5)}}class PW extends sP{get type(){return"distance"}}class RW extends Ro{get type(){return"ignore"}}class IW extends xi{constructor(e,t){super(e),this.mesh=t}get type(){return"mesh"}getObject(){const e=this.mesh;return{shape:this.shape,name:e.name,serial:e.serial}}_getPosition(){return this.__position||(this.__position=cv(this.mesh.position)),this.__position}}class DW extends Ro{constructor(e,t){super(e),this.surface=t}get type(){return"surface"}get data(){return this.surface}getObject(e){return{surface:this.surface,index:this.getIndex(e)}}_getPosition(){return this.surface.center.clone()}}class LW extends Ro{constructor(e,t){super(),this.unitcell=e,this.structure=t}get type(){return"unitcell"}get data(){return this.unitcell}getObject(){return{unitcell:this.unitcell,structure:this.structure}}_getPosition(){return this.unitcell.getCenter(this.structure)}}class aP extends Ro{constructor(e,t){super(e),this.volume=t}get type(){return"volume"}get data(){return this.volume}getObject(e){const t=this.volume,r=this.getIndex(e);return{volume:t,index:r,value:t.data[r]}}_getPosition(e){const t=this.volume.position,r=this.getIndex(e);return new te(t[3*r],t[3*r+1],t[3*r+2])}}class FW extends aP{get type(){return"slice"}}function lP(){return new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0])}function cP(){return new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1])}function Qb(n,e,t,r,i){var o,s,a,l,c,u,d,h=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]],m=0,f=!1,v=!1,g=!1,b=!1,S=-1,p=e*t*r,y=e,w=e*t,x=new Int32Array(12),_=[],A=[],C=[],T=[],I=lP(),M=cP();function P(O,k,X){return O+(k-O)*X}function E(O,k,X){return w*(X=(X+d)%r)+y*(k=(k+u)%t)+(O=(O+c)%e)}function R(O,k,X,ie,ne,Q,ce){var Z=3*O;if(s[Z]<0){var re=(m-Q)/(ce-Q),se=o,fe=3*a;if(_[fe]=X+re,_[fe+1]=ie,_[fe+2]=ne,!f){var ue=3*O;A[fe]=S*P(se[ue],se[ue+3],re),A[fe+1]=S*P(se[ue+1],se[ue+4],re),A[fe+2]=S*P(se[ue+2],se[ue+5],re)}i&&(T[a]=i[O+Math.round(re)]),s[Z]=a,x[k]=a,a+=1}else x[k]=s[Z]}function B(O,k,X,ie,ne,Q,ce){var Z=3*O+1;if(s[Z]<0){var re=(m-Q)/(ce-Q),se=o,fe=3*a;if(_[fe]=X,_[fe+1]=ie+re,_[fe+2]=ne,!f){var ue=3*O,U=ue+3*y;A[fe]=S*P(se[ue],se[U],re),A[fe+1]=S*P(se[ue+1],se[U+1],re),A[fe+2]=S*P(se[ue+2],se[U+2],re)}i&&(T[a]=i[O+Math.round(re)*y]),s[Z]=a,x[k]=a,a+=1}else x[k]=s[Z]}function L(O,k,X,ie,ne,Q,ce){var Z=3*O+2;if(s[Z]<0){var re=(m-Q)/(ce-Q),se=o,fe=3*a;if(_[fe]=X,_[fe+1]=ie,_[fe+2]=ne+re,!f){var ue=3*O,U=ue+3*w;A[fe]=S*P(se[ue],se[U],re),A[fe+1]=S*P(se[ue+1],se[U+1],re),A[fe+2]=S*P(se[ue+2],se[U+2],re)}i&&(T[a]=i[O+Math.round(re)*w]),s[Z]=a,x[k]=a,a+=1}else x[k]=s[Z]}function F(O){var k=3*O;o[k]===0&&(o[k]=n[(O-1+p)%p]-n[(O+1)%p],o[k+1]=n[(O-y+p)%p]-n[(O+y)%p],o[k+2]=n[(O-w+p)%p]-n[(O+w)%p])}function H(O,k,X,ie,ne){var Q,ce,Z,re,se,fe,ue;g?(ie=E(O,k,X),Q=E(O+1,k,X),ce=E(O,k+1,X),Z=E(O,k,X+1),re=E(O+1,k+1,X),se=E(O+1,k,X+1),fe=E(O,k+1,X+1),ue=E(O+1,k+1,X+1)):(Q=ie+1,re=(ce=ie+y)+1,se=(Z=ie+w)+1,ue=(fe=ce+w)+1);var U=0,K=n[ie],be=n[Q],me=n[ce],le=n[re],xe=n[Z],pe=n[se],ye=n[fe],Me=n[ue];K<m&&(U|=1),be<m&&(U|=2),me<m&&(U|=8),le<m&&(U|=4),xe<m&&(U|=16),pe<m&&(U|=32),ye<m&&(U|=128),Me<m&&(U|=64);var Ce=I[U];if(Ce===0)return 0;var z=O+1,D=k+1,q=X+1;1&Ce&&(f||(F(ie),F(Q)),R(ie,0,O,k,X,K,be)),2&Ce&&(f||(F(Q),F(re)),B(Q,1,z,k,X,be,le)),4&Ce&&(f||(F(ce),F(re)),R(ce,2,O,D,X,me,le)),8&Ce&&(f||(F(ie),F(ce)),B(ie,3,O,k,X,K,me)),16&Ce&&(f||(F(Z),F(se)),R(Z,4,O,k,q,xe,pe)),32&Ce&&(f||(F(se),F(ue)),B(se,5,z,k,q,pe,Me)),64&Ce&&(f||(F(fe),F(ue)),R(fe,6,O,D,q,ye,Me)),128&Ce&&(f||(F(Z),F(fe)),B(Z,7,O,k,q,xe,ye)),256&Ce&&(f||(F(ie),F(Z)),L(ie,8,O,k,X,K,xe)),512&Ce&&(f||(F(Q),F(se)),L(Q,9,z,k,X,be,pe)),1024&Ce&&(f||(F(re),F(ue)),L(re,10,z,D,X,le,Me)),2048&Ce&&(f||(F(ce),F(fe)),L(ce,11,O,D,X,me,ye));for(var _e,ve,Re,ze=U<<4,Le=0;M[ze+Le]!==-1;)_e=M[ze+Le],ve=M[ze+Le+1],Re=M[ze+Le+2],v?(h[_e][ve]&ne&&(C[l++]=x[_e],C[l++]=x[ve]),h[ve][Re]&ne&&(C[l++]=x[ve],C[l++]=x[Re]),h[_e][Re]&ne&&(C[l++]=x[_e],C[l++]=x[Re])):(C[l++]=x[b?_e:ve],C[l++]=x[b?ve:_e],C[l++]=x[Re]),Le+=3}function $(O,k,X,ie,ne,Q){let ce,Z,re,se,fe,ue,U,K,be,me,le,xe,pe;if(O=O!==void 0?O:0,k=k!==void 0?k:0,X=X!==void 0?X:0,ie=ie!==void 0?ie:e-1,ne=ne!==void 0?ne:t-1,Q=Q!==void 0?Q:r-1,g||(f?(O=Math.max(0,O),k=Math.max(0,k),X=Math.max(0,X),ie=Math.min(e-1,ie),ne=Math.min(t-1,ne),Q=Math.min(r-1,Q)):(O=Math.max(1,O),k=Math.max(1,k),X=Math.max(1,X),ie=Math.min(e-2,ie),ne=Math.min(t-2,ne),Q=Math.min(r-2,Q))),g)for(K=O-2,be=k-2,me=X-2,le=ie+2,xe=ne+2,pe=Q+2,fe=me;fe<pe;++fe)for(se=be;se<xe;++se)for(re=K;re<le;++re)Z=3*E(re,se,fe),s[Z]=-1,s[Z+1]=-1,s[Z+2]=-1;else for(K=Math.max(0,O-2),be=Math.max(0,k-2),me=Math.max(0,X-2),le=Math.min(e,ie+2),xe=Math.min(t,ne+2),pe=Math.min(r,Q+2),fe=me;fe<pe;++fe)for(U=w*fe,se=be;se<xe;++se)for(ue=U+y*se,re=K;re<le;++re)ce=3*(ue+re),s[ce]=-1,s[ce+1]=-1,s[ce+2]=-1;if(!g){var ye,Me=O,Ce=k,z=X,D=ie,q=ne,_e=Q;for(ye=!1,fe=X;fe<Q;++fe){for(se=k;se<ne;++se){for(re=O;re<ie;++re)if(ce=e*t*fe+e*se+re,n[ce]>=m){z=fe,ye=!0;break}if(ye)break}if(ye)break}for(ye=!1,se=k;se<ne;++se){for(fe=z;fe<Q;++fe){for(re=O;re<ie;++re)if(ce=e*t*fe+e*se+re,n[ce]>=m){Ce=se,ye=!0;break}if(ye)break}if(ye)break}for(ye=!1,re=O;re<ie;++re){for(se=Ce;se<ne;++se){for(fe=z;fe<Q;++fe)if(ce=e*t*fe+e*se+re,n[ce]>=m){Me=re,ye=!0;break}if(ye)break}if(ye)break}for(ye=!1,fe=Q;fe>=X;--fe){for(se=ne;se>=k;--se){for(re=ie;re>=O;--re)if(ce=e*t*fe+e*se+re,n[ce]>=m){_e=fe,ye=!0;break}if(ye)break}if(ye)break}for(ye=!1,se=ne;se>=k;--se){for(fe=_e;fe>=X;--fe){for(re=ie;re>=O;--re)if(ce=e*t*fe+e*se+re,n[ce]>=m){q=se,ye=!0;break}if(ye)break}if(ye)break}for(ye=!1,re=ie;re>=O;--re){for(se=q;se>=k;--se){for(fe=_e;fe>=X;--fe)if(ce=e*t*fe+e*se+re,n[ce]>=m){D=re,ye=!0;break}if(ye)break}if(ye)break}f?(O=Math.max(0,Me-1),k=Math.max(0,Ce-1),X=Math.max(0,z-1),ie=Math.min(e-1,D+1),ne=Math.min(t-1,q+1),Q=Math.min(r-1,_e+1)):(O=Math.max(1,Me-1),k=Math.max(1,Ce-1),X=Math.max(1,z-1),ie=Math.min(e-2,D+1),ne=Math.min(t-2,q+1),Q=Math.min(r-2,_e+1))}var ve=15;for(fe=X;fe<Q;++fe,ve&=-5)for(U=w*fe,ve|=2,se=k;se<ne;++se,ve&=-3)for(ue=U+y*se,ve|=1,re=O;re<ie;++re,ve&=-2)ce=ue+re,H(re,se,fe,ce,ve)}this.triangulate=function(O,k,X,ie,ne){b=(m=O)<0,v=ie,g=ne,(f=k||v)||(S=m>0?-1:1,o||(o=new Float32Array(3*p)));var Q=3*p;if(s&&s.length===Q||(s=new Int32Array(Q)),a=0,l=0,X!==void 0){var ce=X[0].map(Math.round),Z=X[1].map(Math.round);c=e*Math.ceil(Math.abs(ce[0])/e),u=t*Math.ceil(Math.abs(ce[1])/t),d=r*Math.ceil(Math.abs(ce[2])/r),$(ce[0],ce[1],ce[2],Z[0],Z[1],Z[2])}else c=u=d=0,$();return _.length=3*a,f||(A.length=3*a),C.length=l,i&&(T.length=a),{position:new Float32Array(_),normal:f?void 0:new Float32Array(A),index:To(C,_.length/3),atomindex:i?new Int32Array(T):void 0,contour:v}}}_i.add("arrow",class extends xi{get primitive(){return ym}}),_i.add("box",class extends xi{get primitive(){return rl}}),_i.add("cone",class extends xi{get primitive(){return _m}}),_i.add("cylinder",class extends xi{get primitive(){return il}}),_i.add("ellipsoid",class extends xi{get primitive(){return Ec}}),_i.add("octahedron",class extends xi{get primitive(){return vm}}),_i.add("sphere",class extends xi{get primitive(){return Tc}}),_i.add("tetrahedron",class extends xi{get primitive(){return bm}}),_i.add("torus",class extends xi{get primitive(){return xm}}),_i.add("point",class extends xi{get primitive(){return yd}}),_i.add("wideline",class extends xi{get primitive(){return _d}}),Object.assign(Qb,{__deps:[lP,cP,To]});class sn{constructor(e,t){this.cols=e,this.rows=t,this.size=this.cols*this.rows,this.data=new Float32Array(this.size)}copyTo(e){e.data.set(this.data)}}function ji(n,e){let t=0,r=0;const i=e.rows,o=e.cols;let s=0,a=0,l=0;const c=e.data,u=n.data;for(;t<i;a+=1,s+=o,t++)for(l=a,r=0;r<o;l+=i,r++)u[l]=c[s+r]}function Lf(n,e,t){let r=0,i=0,o=0,s=0,a=0,l=0,c=0;const u=e.cols,d=e.rows,h=t.rows,m=e.data,f=t.data,v=n.data;let g=0;for(;r<d;s+=u,r++)for(l=0,i=0;i<h;c++,i++){for(a=s,g=0,o=0;o<u;a++,l++,o++)g+=m[a]*f[l];v[c]=g}}function l0(n,e,t){const r=n.data,i=e.data,o=t.data,s=i[0],a=i[1],l=i[2],c=i[3],u=i[4],d=i[5],h=i[6],m=i[7],f=i[8],v=o[0],g=o[1],b=o[2],S=o[3],p=o[4],y=o[5],w=o[6],x=o[7],_=o[8];r[0]=s*v+a*S+l*w,r[1]=s*g+a*p+l*x,r[2]=s*b+a*y+l*_,r[3]=c*v+u*S+d*w,r[4]=c*g+u*p+d*x,r[5]=c*b+u*y+d*_,r[6]=h*v+m*S+f*w,r[7]=h*g+m*p+f*x,r[8]=h*b+m*y+f*_}function hv(n){const e=n.rows,t=n.cols,r=n.data,i=new Array(t);for(let o=0;o<t;++o)i[o]=0;for(let o=0,s=0;o<e;++o)for(let a=0;a<t;++a,++s)i[a]+=r[s];for(let o=0;o<t;++o)i[o]/=e;return i}function fv(n,e){const t=n.rows,r=n.cols,i=n.data;for(let o=0,s=0;o<t;++o)for(let a=0;a<r;++a,++s)i[s]-=e[a]}function c0(n,e,t,r){r=n[e],n[e]=n[t],n[t]=r}function OW(n,e){return(n=Math.abs(n))>(e=Math.abs(e))?(e/=n,n*Math.sqrt(1+e*e)):e>0?(n/=e,e*Math.sqrt(1+n*n)):0}const kW=1192092896e-16,BW=1e-37;function uP(n,e,t,r){let i=0,o=0;const s=n.rows,a=n.cols;let l=s,c=a;l<c&&(i=1,o=l,l=c,c=o);const u=new sn(l,l),d=new sn(1,c),h=new sn(c,c);if(i===0)ji(u,n);else{for(o=0;o<a*s;o++)u.data[o]=n.data[o];for(;o<c*l;o++)u.data[o]=0}if(function(m,f,v,g,b,S,p,y){const w=2*kW,x=BW;let _=0,A=0,C=0,T=0;const I=Math.max(S,30);let M=0,P=0,E=0,R=0,B=0,L=0,F=0,H=0,$=0,O=0,k=0,X=0,ie=0,ne=0,Q=0,ce=0,Z=0,re=4660,se=0,fe=0,ue=0;const U=new Float64Array(p<<3);for(;_<p;_++){for(C=0,k=0;C<S;C++)H=m[_*f+C],k+=H*H;if(U[_]=k,g){for(C=0;C<p;C++)g[_*b+C]=0;g[_*b+_]=1}}for(;T<I;T++){for(B=0,_=0;_<p-1;_++)for(A=_+1;A<p;A++){for(M=_*f|0,P=A*f|0,Q=U[_],ce=0,Z=U[A],C=2,ce+=m[M]*m[P],ce+=m[M+1]*m[P+1];C<S;C++)ce+=m[M+C]*m[P+C];if(!(Math.abs(ce)<=w*Math.sqrt(Q*Z))){for(ce*=2,X=Q-Z,ie=OW(ce,X),X<0?(ne=.5*(ie-X),F=Math.sqrt(ne/ie),L=ce/(ie*F*2)):(L=Math.sqrt((ie+X)/(2*ie)),F=ce/(ie*L*2)),Q=0,Z=0,C=2,$=L*m[M]+F*m[P],O=-F*m[M]+L*m[P],m[M]=$,m[P]=O,Q+=$*$,Z+=O*O,$=L*m[M+1]+F*m[P+1],O=-F*m[M+1]+L*m[P+1],m[M+1]=$,m[P+1]=O,Q+=$*$,Z+=O*O;C<S;C++)$=L*m[M+C]+F*m[P+C],O=-F*m[M+C]+L*m[P+C],m[M+C]=$,m[P+C]=O,Q+=$*$,Z+=O*O;if(U[_]=Q,U[A]=Z,B=1,g)for(E=_*b|0,R=A*b|0,C=2,$=L*g[E]+F*g[R],O=-F*g[E]+L*g[R],g[E]=$,g[R]=O,$=L*g[E+1]+F*g[R+1],O=-F*g[E+1]+L*g[R+1],g[E+1]=$,g[R+1]=O;C<p;C++)$=L*g[E+C]+F*g[R+C],O=-F*g[E+C]+L*g[R+C],g[E+C]=$,g[R+C]=O}}if(B===0)break}for(_=0;_<p;_++){for(C=0,k=0;C<S;C++)H=m[_*f+C],k+=H*H;U[_]=Math.sqrt(k)}for(_=0;_<p-1;_++){for(A=_,C=_+1;C<p;C++)U[A]<U[C]&&(A=C);if(_!==A&&(c0(U,_,A,k),g)){for(C=0;C<S;C++)c0(m,_*f+C,A*f+C,H);for(C=0;C<p;C++)c0(g,_*b+C,A*b+C,H)}}for(_=0;_<p;_++)v[_]=U[_];if(g)for(_=0;_<y;_++){for(k=_<p?U[_]:0;k<=x;){for(fe=1/S,C=0;C<S;C++)re=214013*re+2531011,se=256&re>>16?fe:-fe,m[_*f+C]=se;for(T=0;T<2;T++)for(A=0;A<_;A++){for(k=0,C=0;C<S;C++)k+=m[_*f+C]*m[A*f+C];for(ue=0,C=0;C<S;C++)H=m[_*f+C]-k*m[A*f+C],m[_*f+C]=H,ue+=Math.abs(H);for(ue=ue?1/ue:0,C=0;C<S;C++)m[_*f+C]*=ue}for(k=0,C=0;C<S;C++)H=m[_*f+C],k+=H*H;k=Math.sqrt(k)}for(F=1/k,C=0;C<S;C++)m[_*f+C]*=F}}(u.data,l,d.data,h.data,c,l,c,l),e){for(o=0;o<c;o++)e.data[o]=d.data[o];for(;o<a;o++)e.data[o]=0}i===0?(t&&ji(t,u),r&&ji(r,h)):(t&&ji(t,h),r&&ji(r,u))}function Eu(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function fc(n,e,t,r,i,o,s,a,l,c,u,d,h,m,f,v,g){n[0]=e,n[4]=t,n[8]=r,n[12]=i,n[1]=o,n[5]=s,n[9]=a,n[13]=l,n[2]=c,n[6]=u,n[10]=d,n[14]=h,n[3]=m,n[7]=f,n[11]=v,n[15]=g}function Ff(n,e,t){const r=e[0],i=e[4],o=e[8],s=e[12],a=e[1],l=e[5],c=e[9],u=e[13],d=e[2],h=e[6],m=e[10],f=e[14],v=e[3],g=e[7],b=e[11],S=e[15],p=t[0],y=t[4],w=t[8],x=t[12],_=t[1],A=t[5],C=t[9],T=t[13],I=t[2],M=t[6],P=t[10],E=t[14],R=t[3],B=t[7],L=t[11],F=t[15];n[0]=r*p+i*_+o*I+s*R,n[4]=r*y+i*A+o*M+s*B,n[8]=r*w+i*C+o*P+s*L,n[12]=r*x+i*T+o*E+s*F,n[1]=a*p+l*_+c*I+u*R,n[5]=a*y+l*A+c*M+u*B,n[9]=a*w+l*C+c*P+u*L,n[13]=a*x+l*T+c*E+u*F,n[2]=d*p+h*_+m*I+f*R,n[6]=d*y+h*A+m*M+f*B,n[10]=d*w+h*C+m*P+f*L,n[14]=d*x+h*T+m*E+f*F,n[3]=v*p+g*_+b*I+S*R,n[7]=v*y+g*A+b*M+S*B,n[11]=v*w+g*C+b*P+S*L,n[15]=v*x+g*T+b*E+S*F}function pv(n,e,t,r){fc(n,e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1)}function mv(n,e,t,r){fc(n,1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1)}function gv(n,e){const t=Math.cos(e),r=Math.sin(e);fc(n,t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1)}function dP(){return new Float32Array([1,0,0,0,1,0,0,0,1])}function ey(n,e){const t=Lt([e[0],e[1],e[2]]),r=Lt([e[4],e[5],e[6]]),i=Lt([e[8],e[9],e[10]]),o=Lt();Zr(o,r,i),n[0]=o[0],n[1]=o[1],n[2]=o[2],Zr(o,i,t),n[3]=o[0],n[4]=o[1],n[5]=o[2],Zr(o,t,r),n[6]=o[0],n[7]=o[1],n[8]=o[2]}function ty(n,e,t,r){t=t||1,r=r||!0;const i=n.length/3,o=e.length/3;let s;r&&(s=new Float32Array(3*i));const a=new Float32Array(3*i);let l;const c=new Array(20);for(l=0;l<20;++l)c[l]=new Uint32Array(i);for(l=0;l<i;++l)c[0][l]=0;let u,d,h;for(l=0;l<o;++l){var m=3*l,f=3*l+1,v=3*l+2;for(h=!0,u=0,d=c[0][e[m]];u<d;++u)if(e[f]===c[u+1][e[m]]){h=!1;break}for(h&&(c[0][e[m]]++,c[c[0][e[m]]][e[m]]=e[f]),h=!0,u=0,d=c[0][e[m]];u<d;++u)if(e[v]===c[u+1][e[m]]){h=!1;break}for(h&&(c[0][e[m]]++,c[c[0][e[m]]][e[m]]=e[v]),h=!0,u=0,d=c[0][e[f]];u<d;++u)if(e[m]===c[u+1][e[f]]){h=!1;break}for(h&&(c[0][e[f]]++,c[c[0][e[f]]][e[f]]=e[m]),h=!0,u=0,d=c[0][e[f]];u<d;++u)if(e[v]===c[u+1][e[f]]){h=!1;break}for(h&&(c[0][e[f]]++,c[c[0][e[f]]][e[f]]=e[v]),h=!0,u=0;u<c[0][e[v]];++u)if(e[m]===c[u+1][e[v]]){h=!1;break}for(h&&(c[0][e[v]]++,c[c[0][e[v]]][e[v]]=e[m]),h=!0,u=0,d=c[0][e[v]];u<d;++u)if(e[f]===c[u+1][e[v]]){h=!1;break}h&&(c[0][e[v]]++,c[c[0][e[v]]][e[v]]=e[f])}for(var g,b,S,p,y,w=.5,x=.75/4.5,_=0;_<t;++_){for(l=0;l<i;++l)if(g=3*l,(S=c[0][l])<3)a[g]=n[g],a[g+1]=n[g+1],a[g+2]=n[g+2];else if(S===3||S===4){for(a[g]=0,a[g+1]=0,a[g+2]=0,u=0;u<S;++u)b=3*c[u+1][l],a[g]+=n[b],a[g+1]+=n[b+1],a[g+2]+=n[b+2];a[g]+=w*n[g],a[g+1]+=w*n[g+1],a[g+2]+=w*n[g+2],y=w+S,a[g]/=y,a[g+1]/=y,a[g+2]/=y}else{for(a[g]=0,a[g+1]=0,a[g+2]=0,u=0;u<S;++u)b=3*c[u+1][l],a[g]+=n[b],a[g+1]+=n[b+1],a[g+2]+=n[b+2];a[g]+=1*n[g],a[g+1]+=1*n[g+1],a[g+2]+=1*n[g+2],p=1+S,a[g]/=p,a[g+1]/=p,a[g+2]/=p}if(n.set(a),r){wd(n,e,s);var A=3*i;for(g=0;g<A;g+=3)n[g]+=-1*x*s[g],n[g+1]+=-1*x*s[g+1],n[g+2]+=-1*x*s[g+2]}}}function wd(n,e,t){var r,i;if(t===void 0)t=new Float32Array(n.length);else for(r=0,i=t.length;r<i;r++)t[r]=0;var o=new Float32Array(3),s=new Float32Array(3),a=new Float32Array(3),l=new Float32Array(3),c=new Float32Array(3);if(e)for(r=0,i=e.length;r<i;r+=3){var u=3*e[r],d=3*e[r+1],h=3*e[r+2];Fr(o,n,u),Fr(s,n,d),Fr(a,n,h),In(l,a,s),In(c,o,s),Zr(l,l,c),t[u]+=l[0],t[u+1]+=l[1],t[u+2]+=l[2],t[d]+=l[0],t[d+1]+=l[1],t[d+2]+=l[2],t[h]+=l[0],t[h+1]+=l[1],t[h+2]+=l[2]}else for(r=0,i=n.length;r<i;r+=9)Fr(o,n,r),Fr(s,n,r+3),Fr(a,n,r+6),In(l,a,s),In(c,o,s),Zr(l,l,c),t[r]=l[0],t[r+1]=l[1],t[r+2]=l[2],t[r+3]=l[0],t[r+4]=l[1],t[r+5]=l[2],t[r+6]=l[0],t[r+7]=l[1],t[r+8]=l[2];return jE(t),t}function hP(n){for(var e={},t=0,r=n.length;t<r;++t)e[n[t]]=!0;return e}function Sd(n,e,t,r,i){var o=1/r*3;XE(n,n,i+(o+=t)),Df(e,e,i+o),dn(n,n,r),uv(n,n),ec(n,n,r),dn(e,e,r),Mu(e,e),ec(e,e,r);var s=new Float32Array(3);In(s,e,n),dn(s,s,r),Mu(s,s),Df(s,s,1);var a=256*Math.pow(10,6),l=s[0]*s[1]*s[2]*3;a<=l&&(dn(n,n,r*=Math.pow(a/l,1/3)),uv(n,n),ec(n,n,r),dn(e,e,r),Mu(e,e),ec(e,e,r),In(s,e,n),dn(s,s,r),Mu(s,s),Df(s,s,1));var c=new Float32Array(n);gm(c,c);var u=Eu(),d=Eu();gv(d,kn(90)),Ff(u,u,d);var h=Eu();pv(h,-1/r,1/r,1/r),Ff(u,u,h);var m=Eu();return mv(m,-r*c[2],-r*c[1],-r*c[0]),Ff(u,u,m),{dim:s,tran:c,matrix:u,scaleFactor:r}}pv.__deps=[fc],mv.__deps=[fc],gv.__deps=[fc],ey.__deps=[Lt,Zr],Object.assign(ty,{__deps:[wd]}),Object.assign(wd,{__deps:[In,Zr,Fr,jE]}),Object.assign(Sd,{__deps:[kn,XE,Df,ec,dn,uv,Mu,In,gm,Eu,Ff,mv,pv,gv]});class wm{constructor(e,t,r){this.name=e||"",this.path=t||"",this.info={},this.center=new te,this.boundingBox=new Nn,r instanceof tr||r instanceof mn?this.fromGeometry(r):r&&(this.set(r.position,r.index,r.normal,r.color,r.atomindex,r.contour),this.boundingBox.setFromArray(r.position),this.boundingBox.getCenter(this.center))}get type(){return"Surface"}set(e,t,r,i,o,s=!1){this.position=e,this.index=t,this.normal=r,this.color=i,this.atomindex=o,this.size=e.length/3,this.contour=s}fromGeometry(e){let t,r,i,o;if(Xe&&Be.time("GeometrySurface.fromGeometry"),t=e instanceof tr?e:e[0],t.boundingBox||t.computeBoundingBox(),this.boundingBox.copy(t.boundingBox),this.boundingBox.getCenter(this.center),t instanceof tr){const s=t.attributes,a=!!s.normal&&s.normal.array;(!a||a[0]===0&&a[1]===0&&a[2]===0)&&t.computeVertexNormals(),r=s.position.array,i=s.index?s.index.array:null,o=s.normal.array}this.set(r,i,o,void 0,void 0),Xe&&Be.timeEnd("GeometrySurface.setGeometry")}getPosition(){return this.position}getColor(e){const t=e||{};t.surface=this;const r=this.size,i=new Float32Array(3*r),o=Xt.getScheme(t);if(o.volumeColor||t.scheme==="random")for(let a=0;a<r;++a)o.volumeColorToArray(a,i,3*a);else if(o.positionColor){const a=new te,l=this.position;for(let c=0;c<r;++c){var s=3*c;a.set(l[s],l[s+1],l[s+2]),o.positionColorToArray(a,i,s)}}else if(o.atomColor&&this.atomindex){const a=t.structure.getAtomProxy(),l=this.atomindex;for(let c=0;c<r;++c)a.index=l[c],o.atomColorToArray(a,i,3*c)}else{const a=new _t(t.value);un(r,a.r,a.g,a.b,i)}return i}getPicking(e){return this.atomindex&&e?new gl(this.atomindex,e):new DW(Wc(this.size),this)}getNormal(){return this.normal}getSize(e,t){return fi(this.size,e*t)}getIndex(){return this.index}getFilteredIndex(e,t){if(e&&this.atomindex){const r=new yn(e),i=t.getAtomSet(r),o=[],s=this.atomindex,a=this.index,l=a.length,c=this.contour?2:3;let u=0;for(let d=0;d<l;d+=c){let h=!0;for(let m=0;m<c;m++){const f=s[a[d+m]];if(!i.get(f)){h=!1;break}}if(h)for(let m=0;m<c;m++,u++)o[u]=a[d+m]}return To(o,this.position.length/3)}return this.index}getAtomindex(){return this.atomindex}dispose(){}}function Hs(n,e,t,r,i){var o=new Qb(n,e,t,r,i);this.getSurface=function(s,a,l,c,u,d=!1){const h=o.triangulate(s,a,l,u,d);if(a&&!u&&(ty(h.position,h.index,a,!0),h.normal=wd(h.position,h.index)),c&&(mm(c,h.position),h.normal)){const m=dP();ey(m,c),Jb(m,h.normal)}return h}}Object.assign(Hs,{__deps:[ty,wd,Qb,mm,Jb,dP,ey]}),ju.add("surf",function(n,e){const t=n.data.args,r=n.data.params;if(t&&(self.volsurf=new Hs(t[0],t[1],t[2],t[3],t[4])),r){const i=self.volsurf.getSurface(r.isolevel,r.smooth,r.box,r.matrix,r.contour,r.wrap),o=[i.position.buffer,i.index.buffer];i.normal&&o.push(i.normal.buffer),i.atomindex&&o.push(i.atomindex.buffer),e({sd:i,p:r},o)}},[Hs]);class Wr{constructor(e,t,r,i,o,s,a){this.name=e,this.path=t,this.matrix=new at,this.normalMatrix=new qt,this.inverseMatrix=new at,this.center=new te,this.boundingBox=new Nn,this.setData(r,i,o,s,a)}get type(){return"Volume"}setData(e,t,r,i,o){this.nx=t||1,this.ny=r||1,this.nz=i||1,this.data=e||new Float32Array(1),this.setAtomindex(o),delete this._position,delete this._min,delete this._max,delete this._mean,delete this._rms,this.worker&&this.worker.terminate()}setStats(e,t,r,i){this._min=e,this._max=t,this._mean=r,this._rms=i}setMatrix(e){this.matrix.copy(e);const t=this.boundingBox,r=this.center,i=this.nx-1,o=this.ny-1,s=this.nz-1;t.makeEmpty(),t.expandByPoint(r.set(i,o,s)),t.expandByPoint(r.set(i,o,0)),t.expandByPoint(r.set(i,0,s)),t.expandByPoint(r.set(i,0,0)),t.expandByPoint(r.set(0,o,s)),t.expandByPoint(r.set(0,0,s)),t.expandByPoint(r.set(0,o,0)),t.expandByPoint(r.set(0,0,0)),t.applyMatrix4(this.matrix),t.getCenter(this.center);const a=this.matrix.elements,l=new te(a[0],a[1],a[2]),c=new te(a[4],a[5],a[6]),u=new te(a[8],a[9],a[10]),d=new te,h=this.normalMatrix.elements;d.crossVectors(c,u),h[0]=d.x,h[1]=d.y,h[2]=d.z,d.crossVectors(u,l),h[3]=d.x,h[4]=d.y,h[5]=d.z,d.crossVectors(l,c),h[6]=d.x,h[7]=d.y,h[8]=d.z,this.inverseMatrix.copy(this.matrix).invert()}setAtomindex(e){this.atomindex=e}getBox(e,t,r){return r||(r=new Nn),r.set(e,e),r.expandByScalar(t),r.applyMatrix4(this.inverseMatrix),r.min.round(),r.max.round(),r}_getBox(e,t){if(!e||!t)return;this.__box||(this.__box=new Nn);const r=this.getBox(e,t,this.__box);return[r.min.toArray(),r.max.toArray()]}_makeSurface(e,t,r){const i=this.name+"@"+t.toPrecision(2),o=new wm(i,"",e);return o.info.isolevel=t,o.info.smooth=r,o.info.volume=this,o}getSurface(e,t,r,i,o,s=!1){e=isNaN(e)?this.getValueForSigma(2):e,t=W(t,0),this.volsurf===void 0&&(this.volsurf=new Hs(this.data,this.nx,this.ny,this.nz,this.atomindex));const a=this._getBox(r,i),l=this.volsurf.getSurface(e,t,a,this.matrix.elements,o,s);return this._makeSurface(l,e,t)}getSurfaceWorker(e,t,r,i,o,s,a){if(e=isNaN(e)?this.getValueForSigma(2):e,t=t||0,window.hasOwnProperty("Worker")){this.workerPool===void 0&&(this.workerPool=new lv("surf",2));const l={},c=this.workerPool.getNextWorker();c.postCount===0&&Object.assign(l,{args:[this.data,this.nx,this.ny,this.nz,this.atomindex]}),Object.assign(l,{params:{isolevel:e,smooth:t,box:this._getBox(r,i),matrix:this.matrix.elements,contour:o,wrap:s}}),c.post(l,void 0,u=>{const d=u.data.sd,h=u.data.p;a(this._makeSurface(d,h.isolevel,h.smooth))},u=>{console.warn("Volume.getSurfaceWorker error - trying without worker",u);const d=this.getSurface(e,t,r,i,o,s);a(d)})}else{const l=this.getSurface(e,t,r,i,o,s);a(l)}}getValueForSigma(e){return this.mean+W(e,2)*this.rms}getSigmaForValue(e){return(W(e,0)-this.mean)/this.rms}get position(){if(!this._position){const e=this.nz,t=this.ny,r=this.nx,i=new Float32Array(r*t*e*3);let o=0;for(let s=0;s<e;++s)for(let a=0;a<t;++a)for(let l=0;l<r;++l)i[o+0]=l,i[o+1]=a,i[o+2]=s,o+=3;mm(this.matrix.elements,i),this._position=i}return this._position}getDataAtomindex(){return this.atomindex}getDataPosition(){return this.position}getDataColor(e){const t=e||{};t.volume=this,t.scale=t.scale||"Spectral",t.domain=t.domain||[this.min,this.max];const r=Xt.getScheme(t),i=this.position.length/3,o=new Float32Array(3*i);for(let s=0;s<i;++s)r.volumeColorToArray(s,o,3*s);return o}getDataPicking(){const e=Wc(this.position.length/3);return new aP(e,this)}getDataSize(e,t){const r=this.data,i=this.position.length/3;let o;switch(e){case"value":case"deviation":o=new Float32Array(r);break;case"abs-value":o=new Float32Array(r);for(let s=0;s<i;++s)o[s]=Math.abs(o[s]);break;case"value-min":{o=new Float32Array(r);const s=this.min;for(let a=0;a<i;++a)o[a]-=s;break}default:o=fi(i,e)}if(t!==1)for(let s=0;s<i;++s)o[s]*=t;return o}get min(){return this._min===void 0&&(this._min=Rf(this.data)),this._min}get max(){return this._max===void 0&&(this._max=Pf(this.data)),this._max}get sum(){return this._sum===void 0&&(this._sum=Zb(this.data)),this._sum}get mean(){return this._mean===void 0&&(this._mean=If(this.data)),this._mean}get rms(){return this._rms===void 0&&(this._rms=function(e){const t=e.length;let r=0;for(let i=0;i<t;++i){const o=e[i];r+=o*o}return Math.sqrt(r/t)}(this.data)),this._rms}clone(){const e=new Wr(this.name,this.path,this.data,this.nx,this.ny,this.nz,this.atomindex);return e.matrix.copy(this.matrix),e.header=Object.assign({},this.header),e}dispose(){this.workerPool&&this.workerPool.terminate()}}function Gw(n){return n==="front"?ts:n==="back"?Or:go}Qt.add("shader/Mesh.vert",`#define STANDARD
uniform float clipNear;
uniform vec3 clipCenter;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#elif defined( NOLIGHT )
varying vec3 vColor;
#else
#include color_pars_vertex
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#endif
#include common
void main(){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#elif defined( NOLIGHT )
vColor = color;
#else
#include color_vertex
#include beginnormal_vertex
#include defaultnormal_vertex
#ifndef FLAT_SHADED
vNormal = normalize( transformedNormal );
#endif
#endif
#include begin_vertex
#include project_vertex
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),Qt.add("shader/Mesh.frag",`#define STANDARD
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
#elif defined( NOLIGHT )
varying vec3 vColor;
#else
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#elif defined( NOLIGHT )
gl_FragColor = vec4( vColor, opacity );
#else
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
#include normal_fragment_begin
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
#include interior_fragment
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#include opaque_back_fragment
#endif
}`);const Ww={f:1,v2:2,v3:3,c:3};function u0(n,e){n.matrix.copy(e),n.matrix.decompose(n.position,n.quaternion,n.scale),n.matrixWorldNeedsUpdate=!0}const zr={opaqueBack:!1,side:"double",opacity:1,depthWrite:!0,clipNear:0,clipRadius:0,clipCenter:new te,flatShaded:!1,wireframe:!1,roughness:.4,metalness:0,diffuse:16777215,diffuseInterior:!1,useInteriorColor:!1,interiorColor:14540253,interiorDarkening:0,forceTransparent:!1,matrix:new at,disablePicking:!1,sortParticles:!1,background:!1},vl={opaqueBack:{updateShader:!0},side:{updateShader:!0,property:!0},opacity:{uniform:!0},depthWrite:{property:!0},clipNear:{updateShader:!0,property:!0},clipRadius:{updateShader:!0,uniform:!0},clipCenter:{uniform:!0},flatShaded:{updateShader:!0},background:{updateShader:!0},wireframe:{updateVisibility:!0},roughness:{uniform:!0},metalness:{uniform:!0},diffuse:{uniform:!0},diffuseInterior:{updateShader:!0},useInteriorColor:{updateShader:!0},interiorColor:{uniform:!0},interiorDarkening:{uniform:!0},matrix:{}};class Eo{constructor(e,t={}){this.parameterTypes=vl,this.geometry=new tr,this.indexVersion=0,this.wireframeIndexVersion=-1,this.group=new mn,this.wireframeGroup=new mn,this.pickingGroup=new mn,this.vertexShader="",this.fragmentShader="",this.isImpostor=!1,this.isText=!1,this.isSurface=!1,this.isPoint=!1,this.isLine=!1,this.dynamic=!0,this.visible=!0,this.wireframeIndexCount=0,this.parameters=hi(t,this.defaultParameters),this.uniforms=Mf.merge([ht.common,{fogColor:{value:new _t(0)},fogNear:{value:0},fogFar:{value:0},opacity:{value:this.parameters.opacity},clipNear:{value:0},clipRadius:{value:this.parameters.clipRadius},clipCenter:{value:this.parameters.clipCenter}},{emissive:{value:new _t(0)},roughness:{value:this.parameters.roughness},metalness:{value:this.parameters.metalness},interiorColor:{value:new _t(this.parameters.interiorColor)},interiorDarkening:{value:this.parameters.interiorDarkening}},ht.lights]),this.uniforms.diffuse.value.set(this.parameters.diffuse),this.pickingUniforms={clipNear:{value:0},objectId:{value:0},opacity:{value:this.parameters.opacity}};const r=e.position||e.position1;this._positionDataSize=r?r.length/3:0,e.primitiveId||(e.primitiveId=Wc(this._positionDataSize)),this.addAttributes({position:{type:"v3",value:e.position},color:{type:"c",value:e.color},primitiveId:{type:"f",value:e.primitiveId}}),t.matrix&&(this.matrix=t.matrix),e.index&&this.initIndex(e.index),this.picking=e.picking,this.makeWireframeGeometry()}get defaultParameters(){return zr}set matrix(e){this.setMatrix(e)}get matrix(){return this.group.matrix.clone()}get transparent(){return this.parameters.opacity<1||this.parameters.forceTransparent}get size(){return this._positionDataSize}get attributeSize(){return this.size}get pickable(){return!!this.picking&&!this.parameters.disablePicking}setMatrix(e){u0(this.group,e),u0(this.wireframeGroup,e),u0(this.pickingGroup,e)}initIndex(e){this.geometry.setIndex(new Wn(e,1));const t=this.geometry.getIndex();t?t.setUsage(this.dynamic?Al:Is):Be.error("Index is null")}makeMaterial(){const e=Gw(this.parameters.side),t=new Mi({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!0,fog:!0,side:e});t.vertexColors=!0,t.extensions.derivatives=!0,t.extensions.fragDepth=this.isImpostor;const r=new Mi({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!1,fog:!0,side:e});r.vertexColors=!0;const i=new Mi({uniforms:this.pickingUniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:!1,depthWrite:this.parameters.depthWrite,lights:!1,fog:!1,side:e,blending:Jo});i.vertexColors=!0,i.extensions.fragDepth=this.isImpostor,t.clipNear=this.parameters.clipNear,r.clipNear=this.parameters.clipNear,i.clipNear=this.parameters.clipNear,this.material=t,this.wireframeMaterial=r,this.pickingMaterial=i,this.updateShader()}makeWireframeGeometry(){this.makeWireframeIndex();const e=this.geometry,t=this.wireframeIndex,r=new tr;r.attributes=e.attributes,t&&(r.setIndex(new Wn(t,1).setUsage(this.dynamic?Al:Is)),r.setDrawRange(0,this.wireframeIndexCount)),this.wireframeGeometry=r}makeWireframeIndex(){const e=[];function t(o,s){if(o>s){const l=o;o=s,s=l}const a=e[o];return a===void 0?(e[o]=[s],!0):!a.includes(s)&&(a.push(s),!0)}const r=this.geometry,i=r.index;if(this.parameters.wireframe)if(i){const o=i.array;let s,a=o.length;r.drawRange.count!==1/0&&(a=r.drawRange.count),this.wireframeIndex&&this.wireframeIndex.length>2*a?s=this.wireframeIndex:s=To(2*a,r.attributes.position.count);let l=0;e.length=0;for(let c=0;c<a;c+=3){const u=o[c+0],d=o[c+1],h=o[c+2];t(u,d)&&(s[l+0]=u,s[l+1]=d,l+=2),t(d,h)&&(s[l+0]=d,s[l+1]=h,l+=2),t(h,u)&&(s[l+0]=h,s[l+1]=u,l+=2)}this.wireframeIndex=s,this.wireframeIndexCount=l,this.wireframeIndexVersion=this.indexVersion}else{const o=r.attributes.position.count;let s;s=this.wireframeIndex&&this.wireframeIndex.length>2*o?this.wireframeIndex:To(2*o,o);for(let a=0,l=0;a<o;a+=3)s[l+0]=a,s[l+1]=a+1,s[l+2]=a+1,s[l+3]=a+2,s[l+4]=a+2,s[l+5]=a,l+=6;this.wireframeIndex=s,this.wireframeIndexCount=2*o,this.wireframeIndexVersion=this.indexVersion}else this.wireframeIndex=new Uint16Array(0),this.wireframeIndexCount=0}updateWireframeIndex(){if(this.wireframeGeometry&&this.wireframeIndex){if(this.wireframeGeometry.setDrawRange(0,1/0),this.wireframeIndexVersion<this.indexVersion&&this.makeWireframeIndex(),this.wireframeGeometry.index&&this.wireframeIndex.length>this.wireframeGeometry.index.array.length)this.wireframeGeometry.setIndex(new Wn(this.wireframeIndex,1).setUsage(this.dynamic?Al:Is));else{const e=this.wireframeGeometry.getIndex();if(!e)return void Be.error("Index is null");e.set(this.wireframeIndex),e.needsUpdate=this.wireframeIndexCount>0,e.updateRange.count=this.wireframeIndexCount}this.wireframeGeometry.setDrawRange(0,this.wireframeIndexCount)}}getRenderOrder(){let e=0;return this.isText?e=1:this.transparent&&(e=this.isSurface?3:2),e}_getMesh(e){this.material||this.makeMaterial();const t=this.geometry,r=this[e];let i;return i=this.isLine?new rv(t,r):this.isPoint?new EE(t,r):new yo(t,r),i.frustumCulled=!1,i.renderOrder=this.getRenderOrder(),i}getMesh(){return this._getMesh("material")}getWireframeMesh(){let e;return this.material||this.makeMaterial(),this.wireframeGeometry||this.makeWireframeGeometry(),e=new rv(this.wireframeGeometry,this.wireframeMaterial),e.frustumCulled=!1,e.renderOrder=this.getRenderOrder(),e}getPickingMesh(){return this._getMesh("pickingMaterial")}getShader(e,t){return Au(e,this.getDefines(t))}getVertexShader(e){return this.getShader(this.vertexShader,e)}getFragmentShader(e){return this.getShader(this.fragmentShader,e)}getDefines(e){const t={};return this.parameters.clipNear&&(t.NEAR_CLIP=1),this.parameters.clipRadius&&(t.RADIUS_CLIP=1),e==="picking"?t.PICKING=1:((e==="background"||this.parameters.background)&&(t.NOLIGHT=1),this.parameters.flatShaded&&(t.FLAT_SHADED=1),this.parameters.opaqueBack&&(t.OPAQUE_BACK=1),this.parameters.diffuseInterior&&(t.DIFFUSE_INTERIOR=1),this.parameters.useInteriorColor&&(t.USE_INTERIOR_COLOR=1)),t}getParameters(){return this.parameters}addUniforms(e){this.uniforms=Mf.merge([this.uniforms,e]),this.pickingUniforms=Mf.merge([this.pickingUniforms,e])}addAttributes(e){for(let t in e){let r;const i=e[t],o=this.attributeSize*Ww[i.type];i.value?(o!==i.value.length&&Be.error("attribute value has wrong length",t),r=i.value):r=LE("float32",o),this.geometry.setAttribute(t,new Wn(r,Ww[i.type]).setUsage(this.dynamic?Al:Is))}}updateRenderOrder(){const e=this.getRenderOrder();function t(r){r.renderOrder=e}this.group.children.forEach(t),this.pickingGroup&&this.pickingGroup.children.forEach(t)}updateShader(){const e=this.material,t=this.wireframeMaterial,r=this.pickingMaterial;e.vertexShader=this.getVertexShader(),e.fragmentShader=this.getFragmentShader(),e.needsUpdate=!0,t.vertexShader=this.getShader("Line.vert"),t.fragmentShader=this.getShader("Line.frag"),t.needsUpdate=!0,r.vertexShader=this.getVertexShader("picking"),r.fragmentShader=this.getFragmentShader("picking"),r.needsUpdate=!0}setParameters(e){const t=e,r=this.parameterTypes,i=this.parameters,o={},s={};let a=!1,l=!1;for(const c in t){const u=t[c];u!==void 0&&(i[c]=u,r[c]!==void 0&&(r[c].property&&(r[c].property!==!0?o[r[c].property]=u:o[c]=u),r[c].uniform&&(r[c].uniform!==!0?s[r[c].uniform]=u:s[c]=u),r[c].updateShader&&(a=!0),r[c].updateVisibility&&(l=!0),this.dynamic&&c==="wireframe"&&u===!0&&this.updateWireframeIndex(),c==="forceTransparent"&&(o.transparent=this.transparent),c==="matrix"&&(this.matrix=u)))}this.setProperties(o),this.setUniforms(s),a&&this.updateShader(),l&&this.setVisibility(this.visible)}setAttributes(e){const t=this.geometry,r=t.attributes;for(const i in e){if(i==="picking")continue;const o=e[i],s=o.length;if(i==="index"){const a=t.getIndex();if(!a){Be.error("Index is null");continue}t.setDrawRange(0,1/0),s>a.array.length?t.setIndex(new Wn(o,1).setUsage(this.dynamic?Al:Is)):(a.set(o),a.needsUpdate=s>0,a.updateRange.count=s,t.setDrawRange(0,s)),this.indexVersion++,this.parameters.wireframe&&this.updateWireframeIndex()}else{const a=r[i];s>a.array.length?t.setAttribute(i,new Wn(o,a.itemSize).setUsage(this.dynamic?Al:Is)):(r[i].set(o),r[i].needsUpdate=s>0,r[i].updateRange.count=s)}}}setUniforms(e){if(!e)return;const t=this.material.uniforms,r=this.wireframeMaterial.uniforms,i=this.pickingMaterial.uniforms;for(let o in e)o==="opacity"&&this.setProperties({transparent:this.transparent}),t[o]!==void 0&&(t[o].value.isVector3?t[o].value.copy(e[o]):t[o].value.set?t[o].value.set(e[o]):t[o].value=e[o]),r[o]!==void 0&&(r[o].value.isVector3?r[o].value.copy(e[o]):r[o].value.set?r[o].value.set(e[o]):r[o].value=e[o]),i[o]!==void 0&&(i[o].value.isVector3?i[o].value.copy(e[o]):i[o].value.set?i[o].value.set(e[o]):i[o].value=e[o])}setProperties(e){if(!e)return;const t=this.material,r=this.wireframeMaterial,i=this.pickingMaterial;for(const o in e){const s=o;let a=e[s];s==="transparent"?this.updateRenderOrder():s==="side"&&(a=Gw(a)),t[s]=a,r[s]=a,i[s]=a}t.needsUpdate=!0,r.needsUpdate=!0,i.needsUpdate=!0}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.material&&this.material.dispose(),this.wireframeMaterial&&this.wireframeMaterial.dispose(),this.pickingMaterial&&this.pickingMaterial.dispose(),this.geometry.dispose(),this.wireframeGeometry&&this.wireframeGeometry.dispose()}toJSON(){var e={};for(var t in this)t!=="group"&&t!=="wireframeGroup"&&t!="pickingGroup"&&t!=="picking"&&(e[t]=this[t]);return e}}class rs extends Eo{constructor(e,t={}){super(e,t),this.vertexShader="Mesh.vert",this.fragmentShader="Mesh.frag",this.addAttributes({normal:{type:"v3",value:e.normal}}),e.normal===void 0&&this.geometry.computeVertexNormals()}}class fP extends rs{constructor(){super(...arguments),this.isSurface=!0}}function qh(n){n.visible=!0}function jw(n){n.visible=!1}class pP{constructor(e){this.group=new mn,this.wireframeGroup=new mn,this.pickingGroup=new mn,this.frontMeshes=[],this.backMeshes=[],this.size=e.size,this.side=e.parameters.side,this.visible=e.visible,this.geometry=e.geometry,this.picking=e.picking,this.group=new mn,this.wireframeGroup=new mn,this.pickingGroup=new mn,this.matrix=e.matrix;const t=e,r=new e.constructor({position:new Float32Array(0)});t.makeMaterial(),r.makeMaterial(),r.picking=e.picking,r.geometry=e.geometry,r.wireframeGeometry=e.wireframeGeometry,r.setParameters(e.getParameters()),r.updateShader(),t.setParameters({side:"front"}),r.setParameters({side:"back",opacity:r.parameters.opacity}),this.buffer=e,this.frontBuffer=t,this.backBuffer=r}set matrix(e){Eo.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking&&!this.parameters.disablePicking}get parameters(){return this.buffer.parameters}getParameters(){const e=Object.assign({},this.buffer.parameters);return e.side=this.side,e}getMesh(e){let t,r;return e?(r=this.backBuffer.getPickingMesh(),t=this.frontBuffer.getPickingMesh()):(r=this.backBuffer.getMesh(),t=this.frontBuffer.getMesh()),this.frontMeshes.push(t),this.backMeshes.push(r),this.setParameters({side:this.side}),new mn().add(r,t)}getWireframeMesh(){return this.buffer.getWireframeMesh()}getPickingMesh(){return this.getMesh(!0)}setAttributes(e){this.buffer.setAttributes(e)}setParameters(e){(e=Object.assign({},e)).side==="front"?(this.frontMeshes.forEach(qh),this.backMeshes.forEach(jw)):e.side==="back"?(this.frontMeshes.forEach(jw),this.backMeshes.forEach(qh)):e.side==="double"&&(this.frontMeshes.forEach(qh),this.backMeshes.forEach(qh)),e.side!==void 0&&(this.side=e.side),delete e.side,e.matrix!==void 0&&(this.matrix=e.matrix),delete e.matrix,this.frontBuffer.setParameters(e),e.wireframe!==void 0&&(this.wireframe=e.wireframe,this.setVisibility(this.visible)),delete e.wireframe,this.backBuffer.setParameters(e)}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.frontBuffer.dispose(),this.backBuffer.dispose()}toJSON(){var e={};for(var t in this)["side","size","visible","matrix","parameters"].includes(t)&&(e[t]=this[t]);return e}}Qt.add("shader/Line.vert",`uniform float clipNear;
uniform vec3 clipCenter;
varying vec3 vViewPosition;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#include color_pars_vertex
void main(){
#include color_vertex
#include begin_vertex
#include project_vertex
vViewPosition = -mvPosition.xyz;
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),Qt.add("shader/Line.frag",`uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
varying vec3 vViewPosition;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#include common
#include color_pars_fragment
#include fog_pars_fragment
void main(){
#include nearclip_fragment
#include radiusclip_fragment
gl_FragColor = vec4( vColor, opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
}`);class mP extends Eo{constructor(){super(...arguments),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag"}}class vv extends $d{constructor(e,t,r){super(e,t,r),this.type="surface",this.parameters=Object.assign({isolevelType:{type:"select",options:{value:"value",sigma:"sigma"}},isolevel:{type:"number",precision:2,max:1e3,min:-1e3},negateIsolevel:{type:"boolean"},isolevelScroll:{type:"boolean"},smooth:{type:"integer",precision:1,max:10,min:0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},boxSize:{type:"integer",precision:1,max:100,min:0},colorVolume:{type:"hidden"},contour:{type:"boolean",rebuild:!0},useWorker:{type:"boolean",rebuild:!0},wrap:{type:"boolean",rebuild:!0}},this.parameters),e instanceof Wr?(this.surface=void 0,this.volume=e):(this.surface=e,this.volume=void 0),this.boxCenter=new te,this.__boxCenter=new te,this.box=new Nn,this.__box=new Nn,this._position=new te,this.inverseMatrix=new at,this.setBox=function(){this._position.copy(t.translationGroup.position).negate(),this._position.applyMatrix4(this.inverseMatrix),this._position.equals(this.boxCenter)||this.setParameters({boxCenter:this._position})},this.toBePrepared=!0,this.viewer.signals.ticked.add(this.setBox,this),this.init(r)}init(e){const t=e||{};t.colorScheme=W(t.colorScheme,"uniform"),t.colorValue=W(t.colorValue,14540253),this.isolevelType=W(t.isolevelType,"sigma"),this.isolevel=W(t.isolevel,2),this.negateIsolevel=W(t.negateIsolevel,!1),this.isolevelScroll=W(t.isolevelScroll,!1),this.smooth=W(t.smooth,0),this.background=W(t.background,!1),this.opaqueBack=W(t.opaqueBack,!0),this.boxSize=W(t.boxSize,0),this.colorVolume=W(t.colorVolume,void 0),this.contour=W(t.contour,!1),this.useWorker=W(t.useWorker,!0),this.wrap=W(t.wrap,!1),super.init(t),this.inverseMatrix.copy(this.matrix).invert(),this.build()}attach(e){this.bufferList.forEach(t=>{this.viewer.add(t)}),this.setVisibility(this.visible),e()}prepare(e){if(this.volume){let t;if(t=this.isolevelType==="sigma"?this.volume.getValueForSigma(this.isolevel):this.isolevel,this.negateIsolevel&&(t*=-1),!this.surface||this.__isolevel!==t||this.__smooth!==this.smooth||this.__contour!==this.contour||this.__wrap!==this.wrap||this.__boxSize!==this.boxSize||this.boxSize>0&&!this.__boxCenter.equals(this.boxCenter)){this.__isolevel=t,this.__smooth=this.smooth,this.__contour=this.contour,this.__wrap=this.wrap,this.__boxSize=this.boxSize,this.__boxCenter.copy(this.boxCenter),this.__box.copy(this.box);const r=i=>{this.surface=i,e()};this.useWorker?this.volume.getSurfaceWorker(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap,r):r(this.volume.getSurface(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap))}else e()}else e()}create(){const e={position:this.surface.getPosition(),color:this.surface.getColor(this.getColorParams()),index:this.surface.getIndex()};let t;if(this.contour)t=new mP(e,this.getBufferParams({wireframe:!1}));else{Object.assign(e,{normal:this.surface.getNormal(),picking:this.surface.getPicking()});const r=new fP(e,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));t=new pP(r)}this.bufferList.push(t)}update(e){if(this.bufferList.length===0)return;const t={};(e=e||{}).position&&(t.position=this.surface.getPosition()),e.color&&(t.color=this.surface.getColor(this.getColorParams())),e.index&&(t.index=this.surface.getIndex()),e.normal&&(t.normal=this.surface.getNormal()),this.bufferList.forEach(function(r){r.setAttributes(t)})}setParameters(e,t,r){return e&&e.isolevelType!==void 0&&this.volume&&(this.isolevelType==="value"&&e.isolevelType==="sigma"?this.isolevel=this.volume.getSigmaForValue(this.isolevel):this.isolevelType==="sigma"&&e.isolevelType==="value"&&(this.isolevel=this.volume.getValueForSigma(this.isolevel)),this.isolevelType=e.isolevelType),e&&e.boxCenter&&(this.boxCenter.copy(e.boxCenter),delete e.boxCenter),e&&e.wireframe&&(e.contour||e.contour===void 0&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,r),e.matrix&&this.inverseMatrix.copy(e.matrix).invert(),this.volume&&this.volume.getBox(this.boxCenter,this.boxSize,this.box),e&&e.colorVolume!==void 0&&t&&(t.color=!0),this.surface&&(e.isolevel!==void 0||e.negateIsolevel!==void 0||e.smooth!==void 0||e.wrap!==void 0||e.boxSize!==void 0||this.boxSize>0&&!this.__box.equals(this.box))&&this.build({position:!0,color:!0,index:!0,normal:!this.contour}),this}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}dispose(){this.viewer.signals.ticked.remove(this.setBox,this),super.dispose()}}class Yt{static zoomScroll(e,t){e.trackballControls.zoom(t)}static clipNearScroll(e,t){const r=e.getParameters();e.setParameters({clipNear:r.clipNear+t/10})}static focusScroll(e,t){const r=e.getFocus(),i=Math.sign(t)*function(o,s,a){if(o>s)return o;const l=o/s;return((2*a-s)*l+(2*s-3*a))*l*l+a}((100-r)/10,5,.2);e.setFocus(r+i)}static zoomFocusScroll(e,t){e.trackballControls.zoom(t);const r=e.viewer.camera.position.z;e.setFocus(100-Math.abs(r/8))}static isolevelScroll(e,t){const r=Math.sign(t)/10;e.eachRepresentation((i,o)=>{if(i.repr instanceof vv){const s=i.getParameters();s.isolevelScroll&&i.setParameters({isolevel:s.isolevel+r})}})}static panDrag(e,t,r){e.trackballControls.pan(t,r)}static rotateDrag(e,t,r){e.trackballControls.rotate(t,r)}static zRotateDrag(e,t,r){e.trackballControls.zRotate(t,r)}static zoomDrag(e,t,r){e.trackballControls.zoom((t+r)/-2)}static zoomFocusDrag(e,t,r){e.trackballControls.zoom((t+r)/-2);const i=e.viewer.camera.position.z;e.setFocus(100-Math.abs(i/8))}static panComponentDrag(e,t,r){e.trackballControls.panComponent(t,r)}static panAtomDrag(e,t,r){e.trackballControls.panAtom(t,r)}static rotateComponentDrag(e,t,r){e.trackballControls.rotateComponent(t,r)}static movePick(e,t){t&&e.animationControls.move(t.position.clone())}static tooltipPick(e,t){const r=e.tooltip;if(e.getParameters().tooltip&&t){const i=t.mouse.position;r.innerText=t.getLabel(),r.style.bottom=window.innerHeight-i.y+3+"px",r.style.left=i.x+3+"px",r.style.display="block"}else r.style.display="none"}static measurePick(e,t){if(t&&(t.atom||t.bond)){const r=t.atom||t.closestBondAtom;t.component.measurePick(r)}else e.measureClear()}}const gP={default:[["scroll",Yt.zoomScroll],["scroll-shift",Yt.focusScroll],["scroll-ctrl",Yt.isolevelScroll],["scroll-shift-ctrl",Yt.zoomFocusScroll],["drag-left",Yt.rotateDrag],["drag-right",Yt.panDrag],["drag-ctrl-left",Yt.panDrag],["drag-ctrl-right",Yt.zRotateDrag],["drag-shift-left",Yt.zoomDrag],["drag-middle",Yt.zoomFocusDrag],["drag-ctrl-shift-right",Yt.panComponentDrag],["drag-ctrl-shift-left",Yt.rotateComponentDrag],["clickPick-right",Yt.measurePick],["clickPick-ctrl-left",Yt.measurePick],["clickPick-middle",Yt.movePick],["clickPick-left",Yt.movePick],["hoverPick",Yt.tooltipPick]],pymol:[["drag-left",Yt.rotateDrag],["drag-middle",Yt.panDrag],["drag-right",Yt.zoomDrag],["scroll",Yt.focusScroll],["drag-shift-right",Yt.focusScroll],["clickPick-ctrl+shift-middle",Yt.movePick],["hoverPick",Yt.tooltipPick]],coot:[["scroll",Yt.isolevelScroll],["drag-left",Yt.rotateDrag],["drag-middle",Yt.panDrag],["drag-ctrl-left",Yt.panDrag],["drag-right",Yt.zoomFocusDrag],["drag-ctrl-right",Yt.focusScroll],["clickPick-middle",Yt.movePick],["hoverPick",Yt.tooltipPick]],astexviewer:[["drag-left",Yt.rotateDrag],["drag-ctrl-left",Yt.panDrag],["drag-shift-left",Yt.zoomDrag],["scroll",Yt.focusScroll],["clickPick-middle",Yt.movePick],["hoverPick",Yt.tooltipPick]]};function qw(n){const e=n.split(/[-+]/);let t="";e.includes("scroll")&&(t="scroll"),e.includes("drag")&&(t="drag"),e.includes("click")&&(t="click"),e.includes("doubleClick")&&(t="doubleClick"),e.includes("hover")&&(t="hover"),e.includes("clickPick")&&(t="clickPick"),e.includes("hoverPick")&&(t="hoverPick");let r=0;e.includes("alt")&&(r+=1),e.includes("ctrl")&&(r+=2),e.includes("meta")&&(r+=4),e.includes("shift")&&(r+=8);let i=0;return e.includes("left")&&(i+=1),e.includes("right")&&(i+=2),e.includes("middle")&&(i+=4),[t,r,i]}class NW{constructor(e,t={}){this.stage=e,this.actionList=[],this.mouse=e.mouseObserver,this.disabled=t.disabled||!1,this.preset(t.preset||"default")}run(e,...t){if(this.disabled)return;const r=this.mouse.key||0,i=this.mouse.buttons||0;this.actionList.forEach(o=>{o.type===e&&o.key===r&&o.button===i&&o.callback(this.stage,...t)})}add(e,t){const[r,i,o]=qw(e);this.actionList.push({type:r,key:i,button:o,callback:t})}remove(e,t){const r=e.includes("*"),[i,o,s]=qw(e),a=this.actionList.filter(function(l){return!((l.type===i||r&&i==="")&&(l.key===o||r&&o===0)&&(l.button===s||r&&s===0)&&(l.callback===t||t===void 0))});this.actionList=a}preset(e){this.clear(),(gP[e]||[]).forEach(t=>this.add(t[0],t[1]))}clear(){this.actionList.length=0}}class fu{static autoView(e){e.autoView(1e3)}static toggleAnimations(e){e.animationControls.toggle()}static toggleRock(e){e.toggleRock()}static toggleSpin(e){e.toggleSpin()}static toggleAntialiasing(e){const t=e.getParameters();e.setParameters({sampleLevel:t.sampleLevel===-1?0:-1})}}const zW={default:[["i",fu.toggleSpin],["k",fu.toggleRock],["p",fu.toggleAnimations],["a",fu.toggleAntialiasing],["r",fu.autoView]]};class UW{constructor(e,t={}){this.stage=e,this.actionList=[],this.disabled=t.disabled||!1,this.preset(t.preset||"default")}run(e){this.disabled||this.actionList.forEach(t=>{t.key===e&&t.callback(this.stage)})}add(e,t){this.actionList.push({key:e,callback:t})}remove(e,t){const r=this.actionList.filter(function(i){return!(i.key===e&&(i.callback===t||t===void 0))});this.actionList=r}preset(e){this.clear(),(zW[e]||[]).forEach(t=>this.add(t[0],t[1]))}clear(){this.actionList.length=0}}class $W{constructor(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this)}_onClick(e,t){const r=this.stage.pickingControls.pick(e,t);this.stage.signals.clicked.dispatch(r),this.controls.run("clickPick",r)}_onHover(e,t){const r=this.stage.pickingControls.pick(e,t);r&&this.mouse.down.equals(this.mouse.position)&&(this.stage.transformComponent=r.component,this.stage.transformAtom=r.atom),this.stage.signals.hovered.dispatch(r),this.controls.run("hoverPick",r)}dispose(){this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class HW{constructor(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.moved.add(this._onMove,this),this.mouse.signals.scrolled.add(this._onScroll,this),this.mouse.signals.dragged.add(this._onDrag,this),this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this),this.mouse.signals.doubleClicked.add(this._onDblclick,this)}_onMove(){this.stage.tooltip.style.display="none"}_onScroll(e){this.controls.run("scroll",e)}_onDrag(e,t){this.controls.run("drag",e,t)}_onClick(e,t){this.controls.run("click",e,t)}_onDblclick(e,t){this.controls.run("doubleClick",e,t)}_onHover(e,t){this.controls.run("hover",e,t)}dispose(){this.mouse.signals.moved.remove(this._onMove,this),this.mouse.signals.scrolled.remove(this._onScroll,this),this.mouse.signals.dragged.remove(this._onDrag,this),this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class VW{constructor(e){this.stage=e,this.viewer=e.viewer,this.animationControls=e.animationControls,this.viewer.signals.ticked.add(this._onTick,this)}_onTick(e){this.animationControls.run(e)}dispose(){this.viewer.signals.ticked.remove(this._onTick,this)}}const Xw=!!NE&&{passive:!0};class GW{constructor(e){this.stage=e,this.stage=e,this.controls=e.keyControls,this.domElement=e.viewer.renderer.domElement,this.domElement.setAttribute("tabIndex","-1"),this.domElement.style.outline="none",this._focusDomElement=this._focusDomElement.bind(this),this._onKeydown=this._onKeydown.bind(this),this._onKeyup=this._onKeyup.bind(this),this._onKeypress=this._onKeypress.bind(this),this.domElement.addEventListener("mousedown",this._focusDomElement),this.domElement.addEventListener("touchstart",this._focusDomElement,Xw),this.domElement.addEventListener("keydown",this._onKeydown),this.domElement.addEventListener("keyup",this._onKeyup),this.domElement.addEventListener("keypress",this._onKeypress)}_onKeydown(){}_onKeyup(){}_onKeypress(e){let t;t="key"in KeyboardEvent.prototype?e.key:String.fromCharCode(e.which||e.keyCode),this.controls.run(t)}_focusDomElement(){this.domElement.focus()}dispose(){this.domElement.removeEventListener("mousedown",this._focusDomElement),this.domElement.removeEventListener("touchstart",this._focusDomElement,Xw),this.domElement.removeEventListener("keydown",this._onKeypress),this.domElement.removeEventListener("keyup",this._onKeypress),this.domElement.removeEventListener("keypress",this._onKeypress)}}class WW{constructor(e,t,r,i={}){this.component=e,this.position=t,this.offsetX=W(i.offsetX,0),this.offsetY=W(i.offsetY,0),this.visible=W(i.visible,!0),this.stage=e.stage,this.viewer=e.stage.viewer,this._viewerPosition=new te,this._updateViewerPosition(),this._canvasPosition=new Ut,this._cameraPosition=new te,this.element=document.createElement("div"),Object.assign(this.element.style,{display:"block",position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",left:"-10000px"}),this.viewer.wrapper.appendChild(this.element),this.setContent(r),this.updateVisibility(),this.viewer.signals.rendered.add(this._update,this),this.component.signals.matrixChanged.add(this._updateViewerPosition,this)}setContent(e){const t=this.element.style.display;if(t==="none"&&(this.element.style.left="-10000px",this.element.style.display="block"),e instanceof HTMLElement)this.element.appendChild(e);else{const r=document.createElement("div");r.innerText=e,Object.assign(r.style,{backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.element.appendChild(r)}this._clientRect=this.element.getBoundingClientRect(),t==="none"&&(this.element.style.display=t)}setVisibility(e){this.visible=e,this.updateVisibility()}getVisibility(){return this.visible&&this.component.parameters.visible}updateVisibility(){this.element.style.display=this.getVisibility()?"block":"none"}_updateViewerPosition(){this._viewerPosition.copy(this.position).applyMatrix4(this.component.matrix)}_update(){if(!this.getVisibility())return;const e=this.element.style,t=this._canvasPosition,r=this._viewerPosition,i=this._clientRect;if(this._cameraPosition.copy(r).add(this.viewer.translationGroup.position).applyMatrix4(this.viewer.rotationGroup.matrix).sub(this.viewer.camera.position),this._cameraPosition.z<0)return void(e.display="none");e.display="block";const o=this._cameraPosition.length(),s=this.viewer.scene.fog;e.opacity=(1-Nd(s.near,s.far,o)).toString(),e.zIndex=Math.round(100*(s.far-o)).toString(),this.stage.viewerControls.getPositionOnCanvas(r,t),e.bottom=this.offsetX+t.y+i.height/2+"px",e.left=this.offsetY+t.x-i.width/2+"px"}dispose(){this.viewer.wrapper.removeChild(this.element),this.viewer.signals.ticked.remove(this._update,this),this.component.signals.matrixChanged.remove(this._updateViewerPosition,this)}}const Ss=new at,Xh=new te,Yw=new Br;class jW{constructor(e){this.component=e,this.signals={changed:new Ft.Signal},this.stage=e.stage,this.viewer=e.stage.viewer}get position(){return this.component.position}get rotation(){return this.component.quaternion}changed(){this.component.updateMatrix(),this.viewer.requestRender(),this.signals.changed.dispatch()}spin(e,t){Ss.copy(this.viewer.rotationGroup.matrix).invert(),Xh.copy(qa(e)).applyMatrix4(Ss),Ss.extractRotation(this.component.transform),Ss.premultiply(this.viewer.rotationGroup.matrix),Ss.invert(),Xh.copy(qa(e)),Xh.applyMatrix4(Ss),Ss.makeRotationAxis(Xh,t),Yw.setFromRotationMatrix(Ss),this.component.quaternion.premultiply(Yw),this.changed()}}const vP={"":"",vdw:"by vdW radius",covalent:"by covalent radius",sstruc:"by secondary structure",bfactor:"by bfactor",size:"size",data:"data",explicit:"explicit"};class is{constructor(e={}){this.max=10,this.type=W(e.type,"size"),this.scale=W(e.scale,1),this.size=W(e.size,1),this.data=W(e.data,{})}atomRadius(e){let t;switch(this.type){case"vdw":t=e.vdw;break;case"covalent":t=e.covalent;break;case"bfactor":t=e.bfactor||1;break;case"sstruc":const r=e.sstruc;t=r==="h"||r==="g"||r==="i"||r==="e"||r==="b"?.25:iP.includes(e.atomname)?.4:.1;break;case"data":t=W(this.data[e.index],1);break;case"explicit":t=e.radius,t===null&&(t=this.size);break;default:t=this.size}return Math.min(t*this.scale,this.max)}}is.types=vP;const qW=new te(-1,-1,-1),XW=new at;class bP{constructor(e){const t=e.rows,r=t/3,i=new sn(t,3),o=new sn(3,3),s=new sn(1,3),a=new sn(3,3),l=new sn(3,3),c=hv(e);fv(e,c),ji(i,e),Lf(o,i,i),uP(o,s,a,l);const u=new te(c[0],c[1],c[2]),d=new te(a.data[0],a.data[3],a.data[6]),h=new te(a.data[1],a.data[4],a.data[7]),m=new te(a.data[2],a.data[5],a.data[8]),f=d.clone().multiplyScalar(Math.sqrt(s.data[0]/r)),v=h.clone().multiplyScalar(Math.sqrt(s.data[1]/r)),g=m.clone().multiplyScalar(Math.sqrt(s.data[2]/r));this.begA=u.clone().sub(f),this.endA=u.clone().add(f),this.begB=u.clone().sub(v),this.endB=u.clone().add(v),this.begC=u.clone().sub(g),this.endC=u.clone().add(g),this.center=u,this.vecA=f,this.vecB=v,this.vecC=g,this.normVecA=d,this.normVecB=h,this.normVecC=m}getBasisMatrix(e=new at){const t=e;return t.makeBasis(this.normVecB,this.normVecA,this.normVecC),t.determinant()<0&&t.scale(qW),t}getRotationQuaternion(e=new Br){const t=e;return t.setFromRotationMatrix(this.getBasisMatrix(XW)),t.invert()}getProjectedScaleForAtoms(e){let t=-1/0,r=-1/0,i=-1/0,o=-1/0,s=-1/0,a=-1/0;const l=new te,c=new te,u=this.center,d=this.normVecA,h=this.normVecB,m=this.normVecC;return e.eachAtom(function(f){Xa(l.copy(f),d,u);const v=c.subVectors(l,u).normalize().dot(d),g=l.distanceTo(u);v>0?g>t&&(t=g):g>r&&(r=g),Xa(l.copy(f),h,u);const b=c.subVectors(l,u).normalize().dot(h),S=l.distanceTo(u);b>0?S>i&&(i=S):S>o&&(o=S),Xa(l.copy(f),m,u);const p=c.subVectors(l,u).normalize().dot(m),y=l.distanceTo(u);p>0?y>s&&(s=y):y>a&&(a=y)}),{d1a:t,d2a:i,d3a:s,d1b:-r,d2b:-o,d3b:-a}}}class jo{constructor(e,t,r,i){this.volume=e,this.setFilter(t,r,i)}get header(){return this.volume.header}get matrix(){return this.volume.matrix}get normalMatrix(){return this.volume.normalMatrix}get inverseMatrix(){return this.volume.inverseMatrix}get center(){return this.volume.center}get boundingBox(){return this.volume.boundingBox}get min(){return this.volume.min}get max(){return this.volume.max}get mean(){return this.volume.mean}get rms(){return this.volume.rms}_getFilterHash(e,t,r){return JSON.stringify([e,t,r])}setFilter(e,t,r){isNaN(e)&&this.header&&(e=this.header.DMEAN+2*this.header.ARMS),e=e===void 0||isNaN(e)?-1/0:e,t=W(t,1/0),r=W(r,!1);const i=this.volume.data,o=this.volume.position,s=this.volume.atomindex,a=this._getFilterHash(e,t,r);if(a!==this._filterHash){if(e===-1/0&&t===1/0)this.data=i,this.position=o,this.atomindex=s;else{const l=i.length;this._dataBuffer||(this._dataBuffer=new ArrayBuffer(4*l),this._positionBuffer=new ArrayBuffer(3*l*4),s&&(this._atomindexBuffer=new ArrayBuffer(4*l)));const c=new Float32Array(this._dataBuffer),u=new Float32Array(this._positionBuffer);let d;s&&(d=new Uint32Array(this._atomindexBuffer));let h=0;for(let m=0;m<l;++m){const f=3*m,v=i[m];if(!r&&v>=e&&v<=t||r&&(v<e||v>t)){const g=3*h;c[h]=v,u[g+0]=o[f+0],u[g+1]=o[f+1],u[g+2]=o[f+2],s&&d&&(d[h]=s[m]),h+=1}}this.data=new Float32Array(this._dataBuffer,0,h),this.position=new Float32Array(this._positionBuffer,0,3*h),s&&(this.atomindex=new Int32Array(this._atomindexBuffer,0,h))}this._filterHash=a}}}jo.prototype.getValueForSigma=Wr.prototype.getValueForSigma,jo.prototype.getSigmaForValue=Wr.prototype.getSigmaForValue,jo.prototype.getDataAtomindex=Wr.prototype.getDataAtomindex,jo.prototype.getDataPosition=Wr.prototype.getDataPosition,jo.prototype.getDataColor=Wr.prototype.getDataColor,jo.prototype.getDataPicking=Wr.prototype.getDataPicking,jo.prototype.getDataSize=Wr.prototype.getDataSize;class YW{constructor(e,t){const r=KE({nodeArray1:e.atomIndex1,nodeArray2:e.atomIndex2,edgeCount:e.count,nodeCount:t});this.countArray=r.countArray,this.offsetArray=r.offsetArray,this.indexArray=r.indexArray}}class Of extends jc{get _defaultFields(){return[["atomIndex1",1,"int32"],["atomIndex2",1,"int32"],["bondOrder",1,"int8"]]}addBond(e,t,r){this.growIfFull();const i=this.count,o=e.index,s=t.index;o<s?(this.atomIndex1[i]=o,this.atomIndex2[i]=s):(this.atomIndex2[i]=o,this.atomIndex1[i]=s),r&&(this.bondOrder[i]=r),this.count+=1}addBondIfConnected(e,t,r){return!!e.connectedTo(t)&&(this.addBond(e,t,r),!0)}}class KW extends jc{get _defaultFields(){return[["residueIndex",1,"uint32"],["atomTypeId",1,"uint16"],["x",1,"float32"],["y",1,"float32"],["z",1,"float32"],["serial",1,"int32"],["bfactor",1,"float32"],["altloc",1,"uint8"],["occupancy",1,"float32"]]}setAltloc(e,t){this.altloc[e]=t.charCodeAt(0)}getAltloc(e){const t=this.altloc[e];return t?String.fromCharCode(t):""}}class ZW extends jc{get _defaultFields(){return[["chainIndex",1,"uint32"],["atomOffset",1,"uint32"],["atomCount",1,"uint32"],["residueTypeId",1,"uint16"],["resno",1,"int32"],["sstruc",1,"uint8"],["inscode",1,"uint8"]]}setSstruc(e,t){this.sstruc[e]=t.charCodeAt(0)}getSstruc(e){const t=this.sstruc[e];return t?String.fromCharCode(t):""}setInscode(e,t){this.inscode[e]=t.charCodeAt(0)}getInscode(e){const t=this.inscode[e];return t?String.fromCharCode(t):""}}class JW extends jc{get _defaultFields(){return[["entityIndex",1,"uint16"],["modelIndex",1,"uint16"],["residueOffset",1,"uint32"],["residueCount",1,"uint32"],["chainname",4,"uint8"],["chainid",4,"uint8"]]}setChainname(e,t){const r=4*e;this.chainname[r]=t.charCodeAt(0),this.chainname[r+1]=t.charCodeAt(1),this.chainname[r+2]=t.charCodeAt(2),this.chainname[r+3]=t.charCodeAt(3)}getChainname(e){let t="";for(let r=0;r<4;++r){const i=this.chainname[4*e+r];if(!i)break;t+=String.fromCharCode(i)}return t}setChainid(e,t){const r=4*e;this.chainid[r]=t.charCodeAt(0),this.chainid[r+1]=t.charCodeAt(1),this.chainid[r+2]=t.charCodeAt(2),this.chainid[r+3]=t.charCodeAt(3)}getChainid(e){let t="";for(let r=0;r<4;++r){const i=this.chainid[4*e+r];if(!i)break;t+=String.fromCharCode(i)}return t}}class QW extends jc{get _defaultFields(){return[["chainOffset",1,"uint32"],["chainCount",1,"uint32"]]}}class xp{constructor(e){this.polymer=e,this.size=e.residueCount}getCenterIterator(e=0){const t=this.getPosition().center,r=t.length/3;let i=0,o=-1;const s=[new te,new te,new te,new te];return{size:r,next:function(){const a=this.get(o);return o+=1,a},get:function(a){a=Math.min(r-1,Math.max(0,a));const l=s[i%4],c=3*a;if(l.fromArray(t,c),e){const u=Math.min(e,a,r-a-1);for(let d=1;d<=u;++d){const h=3*d,m=(u+1-d)/(u+1);l.x+=m*t[c-h+0]+m*t[c+h+0],l.y+=m*t[c-h+1]+m*t[c+h+1],l.z+=m*t[c-h+2]+m*t[c+h+2]}l.x/=u+1,l.y/=u+1,l.z/=u+1}return i+=1,l},reset:function(){i=0,o=-1}}}getColor(e){const t=this.polymer,r=t.structure,i=t.residueCount,o=t.residueIndexStart,s=new Float32Array(3*i),a=e||{};a.structure=r;const l=Xt.getScheme(a),c=r.getResidueProxy(),u=r.getAtomProxy();for(let d=0;d<i;++d)c.index=o+d,u.index=c.traceAtomIndex,l.atomColorToArray(u,s,3*d);return{color:s}}getPicking(){const e=this.polymer,t=e.structure,r=e.residueCount,i=e.residueIndexStart,o=new Float32Array(r),s=t.getResidueProxy();for(let a=0;a<r;++a)s.index=i+a,o[a]=s.traceAtomIndex;return{picking:new gl(o,t)}}getSize(e){const t=this.polymer,r=t.structure,i=t.residueCount,o=t.residueIndexStart,s=new Float32Array(i),a=new is(e),l=r.getResidueProxy(),c=r.getAtomProxy();for(let u=0;u<i;++u)l.index=o+u,c.index=l.traceAtomIndex,s[u]=a.atomRadius(c);return{size:s}}getPosition(){const e=this.polymer,t=e.structure,r=e.residueCount,i=r-3,o=new Float32Array(3*r),s=new Float32Array(3*r),a=new Float32Array(r),l=new Float32Array(r),c=new Float32Array(r),u=new Float32Array(r),d=new Float32Array(3*r),h=new te,m=new te,f=new te,v=new te,g=new te,b=new te,S=new te,p=new te,y=new te,w=new te,x=new te,_=new te(0,0,0),A="trace",C=t.getAtomProxy(),T=t.getAtomProxy(e.getAtomIndexByType(0,A)),I=t.getAtomProxy(e.getAtomIndexByType(1,A)),M=t.getAtomProxy(e.getAtomIndexByType(2,A));for(let F=0;F<i;++F){C.index=T.index,T.index=I.index,I.index=M.index,M.index=e.getAtomIndexByType(F+3,A);const H=3*F;h.subVectors(T,C),m.subVectors(I,T),f.subVectors(M,I),v.subVectors(h,m),g.subVectors(m,f),y.crossVectors(v,g).normalize(),y.toArray(s,H),F>0&&(a[F]=y.angleTo(w));const $=Math.cos(v.angleTo(g));u[F]=180/Math.PI*Math.acos($);const O=v.length(),k=g.length();l[F]=Math.sqrt(k*O)/Math.max(2,2*(1-$)),c[F]=Math.abs(m.dot(y)),b.copy(v).multiplyScalar(l[F]/O),S.copy(g).multiplyScalar(l[F]/k),b.subVectors(T,b),S.subVectors(I,S),b.toArray(o,H+3),S.toArray(o,H+6),x.subVectors(C,_),x.toArray(d,H),w.copy(y),_.copy(b)}b.fromArray(o,3),S.fromArray(o,6),y.subVectors(b,S).normalize(),C.index=e.getAtomIndexByType(0,A),_.copy(C),p.copy(C),Xa(p,y,b),p.toArray(o,0),x.subVectors(_,b),x.toArray(d,0),b.fromArray(o,3*r-6),S.fromArray(o,3*r-9),y.subVectors(b,S).normalize(),C.index=e.getAtomIndexByType(r-1,A),_.copy(C),p.copy(C),Xa(p,y,b),p.toArray(o,3*r-3);for(let F=r-3;F<r;++F)b.fromArray(o,3*F),C.index=e.getAtomIndexByType(F,A),_.copy(C),x.subVectors(_,b),x.toArray(d,3*F);const P=new Float32Array(r),E=new Float32Array(r),R=new Float32Array(r),B=new Float32Array(r);P[1]=l[0],E[1]=u[0],R[1]=l[0];for(let F=2;F<r-2;++F)P[F]=.5*(l[F-2]+l[F-1]),E[F]=.5*(u[F-2]+u[F-1]),R[F]=.5*(c[F-2]+c[F-1]),b.fromArray(s,3*(F-2)),S.fromArray(s,3*(F-1)),B[F]=180/Math.PI*Math.acos(Math.cos(b.angleTo(S)));P[r-2]=l[r-4],E[r-2]=u[r-4],R[r-2]=c[r-4];const L=new Float32Array(3*r);Kn(s,L,0,0,3),Kn(s,L,0,3,3);for(let F=2;F<r-2;++F)b.fromArray(s,3*(F-2)),S.fromArray(s,3*(F-1)),y.addVectors(S,b).multiplyScalar(.5).normalize(),y.toArray(L,3*F);return Kn(s,L,3*r-12,3*r-6,3),Kn(s,L,3*r-12,3*r-3,3),{center:o,axis:L,bending:B,radius:P,rise:R,twist:E,resdir:d}}}class yP{constructor(e){this.polymer=e,this.helixorient=new xp(e),this.position=this.helixorient.getPosition()}getAxis(e,t,r,i,o){e=e||30,t=t||2.5,r=r!==void 0&&r;const s=this.polymer,a=s.structure,l=s.residueCount,c=s.residueIndexStart,u=this.position,d=i||{};d.structure=a;const h=Xt.getScheme(d),m=new is(o);let f=0,v=0;const g=[],b=[],S=[],p=[],y=[],w=[],x=[],_=[],A=[];let C,T,I=new Float32Array(3*l),M=new Float32Array(3*l);const P=new te,E=new te,R=a.getResidueProxy(),B=a.getResidueProxy(),L=a.getAtomProxy(),F=new te,H=new te;let $=!1;for(let k=0;k<l;++k)if(R.index=c+k,F.fromArray(u.center,3*k),k===l-1?$=!0:(B.index=c+k+1,H.fromArray(u.center,3*k+3),(r&&R.sstruc!==B.sstruc||F.distanceTo(H)>t||u.bending[k]>e)&&($=!0)),$){if(k-f<4){f=k,$=!1;continue}L.index=R.traceAtomIndex,I=u.axis.subarray(3*f+3,3*k),M=u.center.subarray(3*f,3*k+3),C=cv(I).normalize(),T=cv(M),P.fromArray(M),Xa(P,C,T),E.fromArray(M,M.length-3),Xa(E,C,T),C.subVectors(E,P),C.toArray(g,v),T.toArray(b,v),P.toArray(S,v),E.toArray(p,v),h.atomColorToArray(L,y,v),w.push(L.index),x.push(m.atomRadius(L)),_.push(c+f),A.push(c+k+1-f),v+=3,f=k,$=!1}const O=new Float32Array(w);return{axis:new Float32Array(g),center:new Float32Array(b),begin:new Float32Array(S),end:new Float32Array(p),color:new Float32Array(y),picking:new gl(O,a),size:new Float32Array(x),residueOffset:_,residueCount:A}}}class ej{constructor(e){this.scoreFunction=e,this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.bubbleUp(this.content.length-1)}pop(){const e=this.content[0],t=this.content.pop();return t&&this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e}peek(){return this.content[0]}remove(e){const t=this.content.length;for(let r=0;r<t;r++)if(this.content[r]===e){const i=this.content.pop();return void(i&&r!==t-1&&(this.content[r]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.bubbleUp(r):this.sinkDown(r)))}throw new Error("Node not found.")}size(){return this.content.length}bubbleUp(e){const t=this.content[e];for(;e>0;){const r=Math.floor((e+1)/2)-1,i=this.content[r];if(!(this.scoreFunction(t)<this.scoreFunction(i)))break;this.content[r]=t,this.content[e]=i,e=r}}sinkDown(e){const t=this.content.length,r=this.content[e],i=this.scoreFunction(r);let o=0,s=0;for(;;){const a=2*(e+1),l=a-1;let c=null;if(l<t){const u=this.content[l];o=this.scoreFunction(u),o<i&&(c=l)}if(a<t){const u=this.content[a];s=this.scoreFunction(u),s<(c===null?i:o)&&(c=a)}if(c===null)break;this.content[e]=this.content[c],this.content[c]=r,e=c}}}/**
 * Kdtree
 * @class
 * @author Alexander Rose <alexander.rose@weirdbyte.de>, 2016
 * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013
 * @author I4DS http://www.fhnw.ch/i4ds, 2013
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 * @description
 * k-d Tree for typed arrays of 3d points (e.g. for Float32Array), in-place
 * provides fast nearest neighbour search
 *
 * Based on https://github.com/ubilabs/kd-tree-javascript by Ubilabs
 *
 * Further information (including mathematical properties)
 * http://en.wikipedia.org/wiki/Binary_tree
 * http://en.wikipedia.org/wiki/K-d_tree
 *
 * @example
 * points: [x, y, z, x, y, z, x, y, z, ...]
 * metric: function(a, b){
 *    return Math.pow(a[0]-b[0], 2) + Math.pow(a[1]-b[1], 2) + Math.pow(a[2]-b[2], 2);
 * }
 *
 * @param {Float32Array} points - points
 * @param {Function} metric - metric
 */class tj{constructor(e,t){this.points=e,this.metric=t,this.maxDepth=0,this.currentNode=0;const r=e.length/3,i=new Uint32Array(r);for(let o=0;o<r;++o)i[o]=o;this.indices=i,this.nodes=new Int32Array(4*r),this.rootIndex=this.buildTree(0,-1,0,r)}buildTree(e,t,r,i){e>this.maxDepth&&(this.maxDepth=e);const o=i-r;if(o===0)return-1;const s=4*this.currentNode,a=this.nodes;if(this.currentNode+=1,o===1)return a[s]=r,a[s+1]=-1,a[s+2]=-1,a[s+3]=t,s;const l=this.indices,c=this.points,u=r+Math.floor(o/2),d=e%3;let h,m,f,v,g,b=r,S=i-1;for(;S>b;){for(f=b+S>>1,v=c[3*l[f]+d],m=l[f],l[f]=l[S],l[S]=m,g=b,h=b;h<S;++h)c[3*l[h]+d]<v&&(m=l[g],l[g]=l[h],l[h]=m,++g);if(m=l[S],l[S]=l[g],l[g]=m,f=g,u===f)break;u<f?S=f-1:b=f+1}return a[s]=u,a[s+1]=this.buildTree(e+1,s,r,u),a[s+2]=this.buildTree(e+1,s,u+1,i),a[s+3]=t,s}getNodeDepth(e){const t=this.nodes[e+3];return t===-1?0:this.getNodeDepth(t)+1}nearest(e,t,r){const i=new ej(u=>-u[1]),o=this.nodes,s=this.points,a=this.indices,l=u=>{let d,h;const m=this.getNodeDepth(u)%3,f=3*a[o[u]],v=[s[f+0],s[f+1],s[f+2]],g=this.metric(e,v);function b(x,_){i.push([x,_]),i.size()>t&&i.pop()}const S=o[u+1],p=o[u+2];if(p===-1&&S===-1)return void((i.size()<t||g<i.peek()[1])&&g<=r&&b(u,g));d=p===-1?S:S===-1?p:e[m]<=s[f+m]?S:p,l(d),(i.size()<t||g<i.peek()[1])&&g<=r&&b(u,g);const y=[];for(let x=0;x<3;x+=1)y[x]=x===m?e[x]:s[f+x];const w=this.metric(y,v);(i.size()<t||Math.abs(w)<i.peek()[1])&&Math.abs(w)<=r&&(h=d===S?p:S,h!==-1&&l(h))};l(this.rootIndex);const c=[];for(let u=0,d=Math.min(i.size(),t);u<d;u+=1)c.push(i.content[u]);return c}verify(e,t=0){let r=1;if(e===void 0&&(e=this.rootIndex),e===-1)throw new Error("node is null");const i=t%3,o=this.nodes,s=this.points,a=this.indices,l=o[e+1],c=o[e+2];if(l!==-1){if(s[3*a[o[l]]+i]>s[3*a[o[e]]+i])throw new Error("left child is > parent!");r+=this.verify(l,t+1)}if(c!==-1){if(s[3*a[o[c]]+i]<s[3*a[o[e]]+i])throw new Error("right child is < parent!");r+=this.verify(c,t+1)}return r}}class Sm{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get bondHash(){return this.structure.bondHash}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainIndex(){return this.residueStore.chainIndex[this.residueIndex]}get residue(){return console.warn("residue - might be expensive"),this.structure.getResidueProxy(this.residueIndex)}get residueIndex(){return this.atomStore.residueIndex[this.index]}set residueIndex(e){this.atomStore.residueIndex[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.residueIndex)}get inscode(){return this.residueStore.getInscode(this.residueIndex)}get resno(){return this.residueStore.resno[this.residueIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.residueIndex])}get atomType(){return this.atomMap.get(this.atomStore.atomTypeId[this.index])}get residueAtomOffset(){return this.residueStore.atomOffset[this.residueIndex]}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get atomname(){return this.atomType.atomname}get number(){return this.atomType.number}get element(){return this.atomType.element}get vdw(){return this.atomType.vdw}get covalent(){return this.atomType.covalent}get x(){return this.atomStore.x[this.index]}set x(e){this.atomStore.x[this.index]=e}get y(){return this.atomStore.y[this.index]}set y(e){this.atomStore.y[this.index]=e}get z(){return this.atomStore.z[this.index]}set z(e){this.atomStore.z[this.index]=e}get serial(){return this.atomStore.serial[this.index]}set serial(e){this.atomStore.serial[this.index]=e}get bfactor(){return this.atomStore.bfactor[this.index]}set bfactor(e){this.atomStore.bfactor[this.index]=e}get occupancy(){return this.atomStore.occupancy[this.index]}set occupancy(e){this.atomStore.occupancy[this.index]=e}get altloc(){return this.atomStore.getAltloc(this.index)}set altloc(e){this.atomStore.setAltloc(this.index,e)}get partialCharge(){return this.atomStore.partialCharge?this.atomStore.partialCharge[this.index]:null}set partialCharge(e){this.atomStore.partialCharge&&(this.atomStore.partialCharge[this.index]=e)}get radius(){return this.atomStore.radius?this.atomStore.radius[this.index]:null}set radius(e){this.atomStore.radius&&(this.atomStore.radius[this.index]=e)}get formalCharge(){return this.atomStore.formalCharge?this.atomStore.formalCharge[this.index]:null}set formalCharge(e){this.atomStore.formalCharge&&(this.atomStore.formalCharge[this.index]=e)}get aromatic(){return this.atomStore.aromatic?this.atomStore.aromatic[this.index]:this.residueType.isAromatic(this)?1:0}set aromatic(e){this.atomStore.aromatic&&(this.atomStore.aromatic[this.index]=e)}get bondCount(){return this.bondHash.countArray[this.index]}eachBond(e,t){t=t||this.structure._bp;const r=this.index,i=this.bondHash,o=i.indexArray,s=i.countArray[r],a=i.offsetArray[r];for(let l=0;l<s;++l)t.index=o[a+l],e(t)}eachBondedAtom(e,t){const r=t||this.structure._ap,i=this.index;this.eachBond(function(o){r.index=i!==o.atomIndex1?o.atomIndex1:o.atomIndex2,e(r)}),this.index=i}hasBondTo(e){let t=!1;return this.eachBondedAtom(function(r){e.index===r.index&&(t=!0)}),t}bondToElementCount(e){let t=0;const r=this.index;return this.eachBondedAtom(function(i){i.number===e&&(t+=1)}),this.index=r,t}hasBondToElement(e){return this.bondToElementCount(e)>0}isBackbone(){const e=this.residueType.backboneIndexList;return e.length>0&&e.includes(this.index-this.residueAtomOffset)}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return e===3||e===4||e===5}}isSidechain(){return this.isPolymer()&&!this.isBackbone()}isCg(){const e=this.residueType.backboneType;return e===4||e===5||e===6}isTrace(){return this.index===this.residueType.traceAtomIndex+this.residueAtomOffset}isHetero(){return this.residueType.hetero===1}isProtein(){return this.residueType.moleculeType===3}isNucleic(){const e=this.residueType.moleculeType;return e===4||e===5}isRna(){return this.residueType.moleculeType===4}isDna(){return this.residueType.moleculeType===5}isWater(){return this.residueType.moleculeType===1}isIon(){return this.residueType.moleculeType===2}isSaccharide(){return this.residueType.moleculeType===6}isHelix(){return JE.includes(this.sstruc)}isSheet(){return QE.includes(this.sstruc)}isTurn(){return eP.includes(this.sstruc)&&this.isProtein()}isBonded(){return this.bondHash.countArray[this.index]!==0}isRing(){return this.residueType.getRings().atomRings[this.index-this.residueAtomOffset]!==void 0}isAromatic(){return this.aromatic===1}isPolarHydrogen(){let e=!1;return this.number!==1||(e=!this.hasBondToElement(6)),e}isMetal(){return this.atomType.isMetal()}isNonmetal(){return this.atomType.isNonmetal()}isMetalloid(){return this.atomType.isMetalloid()}isHalogen(){return this.atomType.isHalogen()}isDiatomicNonmetal(){return this.atomType.isDiatomicNonmetal()}isPolyatomicNonmetal(){return this.atomType.isPolyatomicNonmetal()}isAlkaliMetal(){return this.atomType.isAlkaliMetal()}isAlkalineEarthMetal(){return this.atomType.isAlkalineEarthMetal()}isNobleGas(){return this.atomType.isNobleGas()}isTransitionMetal(){return this.atomType.isTransitionMetal()}isPostTransitionMetal(){return this.atomType.isPostTransitionMetal()}isLanthanide(){return this.atomType.isLanthanide()}isActinide(){return this.atomType.isActinide()}getDefaultValence(){return this.atomType.getDefaultValence()}getValenceList(){return this.atomType.getValenceList()}getOuterShellElectronCount(){return this.atomType.getOuterShellElectronCount()}distanceTo(e){const t=this.atomStore,r=e.atomStore,i=this.index,o=e.index,s=t.x[i]-r.x[o],a=t.y[i]-r.y[o],l=t.z[i]-r.z[o],c=s*s+a*a+l*l;return Math.sqrt(c)}connectedTo(e){const t=this.atomStore,r=e.atomStore,i=this.index,o=e.index;if(t.altloc&&r.altloc){const m=t.altloc[i],f=r.altloc[o];if(m!==0&&f!==0&&m!==32&&f!==32&&m!==f)return!1}const s=t.x[i]-r.x[o],a=t.y[i]-r.y[o],l=t.z[i]-r.z[o],c=s*s+a*a+l*l;if(c<48&&this.isCg())return!0;if(isNaN(c))return!1;const u=this.covalent+e.covalent,d=u+.3,h=u-.5;return c<d*d&&c>h*h}positionFromArray(e,t=0){return this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this}positionToArray(e=[],t=0){const r=this.index,i=this.atomStore;return e[t+0]=i.x[r],e[t+1]=i.y[r],e[t+2]=i.z[r],e}positionToVector3(e){return e===void 0&&(e=new te),e.x=this.x,e.y=this.y,e.z=this.z,e}positionFromVector3(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}positionAdd(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}positionSub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}getResidueBonds(e=!1){const t=this.residueAtomOffset,r=this.index-this.residueAtomOffset,i=this.residueType.getBonds(),o=i.atomIndices1,s=i.atomIndices2;let a,l,c,u;for(e||(u=[]),a=o.indexOf(r);a!==-1;){if(c=s[a]+t,!u)return c;u.push(c),a=o.indexOf(r,a+1)}for(l=s.indexOf(r);l!==-1;){if(c=o[l]+t,!u)return c;u.push(c),l=s.indexOf(r,l+1)}return u}qualifiedName(e=!1){var t="";return this.resname&&!e&&(t+="["+this.resname+"]"),this.resno!==void 0&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chainname&&(t+=":"+this.chainname),this.atomname&&(t+="."+this.atomname),this.altloc&&(t+="%"+this.altloc),this.structure.modelStore.count>1&&(t+="/"+this.modelIndex),t}clone(){return new Sm(this.structure,this.index)}toObject(){return{index:this.index,residueIndex:this.residueIndex,resname:this.resname,x:this.x,y:this.y,z:this.z,element:this.element,chainname:this.chainname,resno:this.resno,serial:this.serial,vdw:this.vdw,covalent:this.covalent,hetero:this.hetero,bfactor:this.bfactor,altloc:this.altloc,atomname:this.atomname,modelIndex:this.modelIndex}}}function _P(n,e){const t=n[0]-e[0],r=n[1]-e[1],i=n[2]-e[2];return t*t+r*r+i*i}function nj(n,e){return Math.sqrt(_P(n,e))}const d0=new Float32Array(3);class rj{constructor(e,t=!1){Xe&&Be.time("Kdtree build");const r=t?_P:nj,i=new Float32Array(3*e.atomCount),o=new Uint32Array(e.atomCount);let s=0;e.eachAtom(function(a){i[s+0]=a.x,i[s+1]=a.y,i[s+2]=a.z,o[s/3]=a.index,s+=3}),this.atomIndices=o,this.points=i,this.kdtree=new tj(i,r),Xe&&Be.timeEnd("Kdtree build")}nearest(e,t,r){e instanceof te?e.toArray(d0):e instanceof Sm&&e.positionToArray(d0);const i=this.kdtree.nearest(d0,t,r),o=this.kdtree.indices,s=this.kdtree.nodes,a=this.atomIndices,l=[];for(let c=0,u=i.length;c<u;++c){const d=i[c],h=d[0],m=d[1];l.push({index:a[o[s[h]]],distance:m})}return l}}const ij={" ":"X","!":"Y","#":"Z",$:"-X","%":"-Y","&":"-Z","'":"Y+1/2","(":"1/2+X",")":"1/2+Y","*":"1/2-X","+":"1/2+Z",",":"1/2-Y","-":"1/2-Z",".":"X+1/2","/":"Z+1/2",0:"-X+1/2",1:"-Y+1/2",2:"-Z+1/2",3:"1/4+X",4:"1/4-Y",5:"1/4+Z",6:"1/4-X",7:"1/4+Y",8:"3/4-Y",9:"3/4+Z",":":"3/4+Y",";":"3/4+X","<":"3/4-X","=":"1/4-Z",">":"3/4-Z","?":"X-Y","@":"Y-X",A:"Z+1/3",B:"Z+2/3",C:"X+2/3",D:"Y+1/3",E:"-Y+2/3",F:"X-Y+1/3",G:"Y-X+2/3",H:"-X+1/3",I:"X+1/3",J:"Y+2/3",K:"-Y+1/3",L:"X-Y+2/3",M:"Y-X+1/3",N:"-X+2/3",O:"2/3+X",P:"1/3+Y",Q:"1/3+Z",R:"2/3-Y",S:"1/3+X-Y",T:"2/3+Y-X",U:"1/3-X",V:"2/3-X",W:"1/3-Y",X:"1/3-Z",Y:"2/3+Y",Z:"1/3+Y-X","[":"2/3+X-Y","]":"1/3+X","^":"2/3+Z",_:"2/3-Z","`":"5/6+Z",a:"1/6+Z",b:"5/6-Z",c:"1/6-Z",d:"Z+5/6",e:"Z+1/6",f:"Z+1/4",g:"+Y"},oj={"P 1":" !#","P -1":" !#$%&","P 1 2 1":" !#$!&","P 1 21 1":" !#$'&","C 1 2 1":" !#$!&()#*)&","P 1 m 1":" !# %#","P 1 c 1":" !# %+","C 1 m 1":" !# %#()#(,#","C 1 c 1":" !# %+()#(,+","P 1 2/m 1":" !# %#$!&$%&","P 1 21/m 1":" !#$)&$%& ,#","C 1 2/m 1":" !# %#$!&$%&()#(,#*)&*,&","P 1 2/c 1":" !#$!-$%& %+","P 1 21/c 1":" !#$%&$)- ,+","C 1 2/c 1":" !#$!-$%& %+()#*)-*,&(,+","P 2 2 2":" !#$%#$!& %&","P 2 2 21":" !#$%+$!- %&","P 21 21 2":" !#$%#*)&(,&","P 21 21 21":" !#*%+$)-(,&","C 2 2 21":" !#$%+$!- %&()#*,+*)-(,&","C 2 2 2":" !#$%#$!& %&()#*,#*)&(,&","F 2 2 2":" !#$%#$!& %& )+$,+$)- ,-(!+*%+*!-(%-()#*,#*)&(,&","I 2 2 2":" !#$%# %&$!&.'/01/.120'2","I 21 21 21":" !#*%+$)-(,&()+$,#*!& %-","P m m 2":" !#$%# %#$!#","P m c 21":" !#$%+ %+$!#","P c c 2":" !#$%# %+$!+","P m a 2":" !#$%#(%#*!#","P c a 21":" !#$%+(%#*!+","P n c 2":" !#$%# ,+$)+","P m n 21":" !#*%+(%+$!#","P b a 2":" !#$%#(,#*)#","P n a 21":" !#$%+(,#*)+","P n n 2":" !#$%#(,+*)+","C m m 2":" !#$%# %#$!#()#*,#(,#*)#","C m c 21":" !#$%+ %+$!#()#*,+(,+*)#","C c c 2":" !#$%# %+$!+()#*,#(,+*)+","A m m 2":" !#$%# %#$!# )+$,+ ,+$)+","A b m 2":" !#$%# ,#$)# )+$,+ %+$!+","A m a 2":" !#$%#(%#*!# )+$,+(,+*)+","A b a 2":" !#$%#(,#*)# )+$,+(%+*!+","F m m 2":" !#$%# %#$!# )+$,+ ,+$)+(!+*%+(%+*!+()#*,#(,#*)#","F d d 2":" !#$%#345675 )+$,+3896:9(!+*%+;49<79()#*,#;85<:5","I m m 2":" !#$%# %#$!#()+*,+(,+*)+","I b a 2":" !#$%#(,#*)#()+*,+ %+$!+","I m a 2":" !#$%#(%#*!#()+*,+ ,+$)+","P 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#","P 2/n 2/n 2/n":" !#$%#$!& %&*,-()-(,+*)+","P 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+","P 2/b 2/a 2/n":" !#$%#$!& %&*,&()&(,#*)#","P 21/m 2/m 2/a":" !#*%#$!&(%&$%&(!& %#*!#","P 2/n 21/n 2/a":" !#*%#*)- ,-$%&(!&(,+$)+","P 2/m 2/n 21/a":" !#*%+*!- %&$%&(!-(%+$!#","P 21/c 2/c 2/a":" !#*%#$!-(%-$%&(!& %+*!+","P 21/b 21/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#","P 21/c 21/c 2/n":" !#*,#$)-(%-$%&()& ,+*!+","P 2/b 21/c 21/m":" !#$%+$)- ,&$%& !- ,+$)#","P 21/n 21/n 2/m":" !#$%#*)-(,-$%& !&(,+*)+","P 21/m 21/m 2/n":" !#$%#*'&.,&*,&.'& %#$!#","P 21/b 2/c 21/n":" !#*,+$!-(,&$%&()- %+*)#","P 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#","P 21/n 21/m 21/a":" !#0%/$'&.12$%&.!2 1#0'/","C 2/m 2/c 21/m":" !#$%+$!- %&$%& !- %+$!#()#*,+*)-(,&*,&()-(,+*)#","C 2/m 2/c 21/a":" !#$,+$)- %&$%& )- ,+$!#()#*%+*!-(,&*,&(!-(%+*)#","C 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()#*,#*)&(,&*,&()&(,#*)#","C 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+()#*,#*)-(,-*,&()&(,+*)+","C 2/m 2/m 2/a":" !#$,#$)& %&$%& )& ,#$!#()#*%#*!&(,&*,&(!&(%#*)#","C 2/c 2/c 2/a":" !#*,#$!&(,&$,-(!- ,+*!+()#$%#*)& %&*%- )-(%+$)+","F 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!# )+$,+$)- ,-$,- )- ,+$)+(!+*%+*!-(%-*%-(!-(%+*!+()#*,#*)&(,&*,&()&(,#*)#","F 2/d 2/d 2/d":" !#$%#$!& %&64=37=345675 )+$,+$)- ,-68>3:>3896:9(!+*%+*!-(%-<4>;7>;49<79()#*,#*)&(,&<8=;:=;85<:5","I 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()+*,+*)-(,-*,-()-(,+*)+","I 2/b 2/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#()+*,+$!- %-*,-()- %+$!+","I 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#()+$,#*!& %-*,- )&(%#$!+","I 21/m 21/m 21/a":" !#$,#$)& %&$%& )& ,#$!#()+*%+*!-(,-*,-(!-(%+*)+","P 4":" !#$%#% #!$#","P 41":" !#$%+% 5!$9","P 42":" !#$%#% +!$+","P 43":" !#$%+% 9!$5","I 4":" !#$%#% #!$#()+*,+,(+)*+","I 41":" !#*,+%(5)$9()+$%#, 9!*5","P -4":" !#$%#!$&% &","I -4":" !#$%#!$&% &()+*,+)*-,(-","P 4/m":" !#$%#% #!$#$%& !&!$&% &","P 42/m":" !#$%#% +!$+$%& !&!$-% -","P 4/n":" !#$%#,(#)*#*,&()&!$&% &","P 42/n":" !#$%#,(+)*+*,-()-!$&% &","I 4/m":" !#$%#% #!$#$%& !&!$&% &()+*,+,(+)*+*,-()-)*-,(-","I 41/a":" !#*,+%(5)$9$,=(!>!$&,(-()+$%#, 9!*5*%> )=)*-% &","P 4 2 2":" !#$%#% #!$#$!& %&! &%$&","P 4 21 2":" !#$%#,(#)*#*)&(,&! &%$&","P 41 2 2":" !#$%+% 5!$9$!& %-! >%$=","P 41 21 2":" !#$%+,(5)*9*)=(,>! &%$-","P 42 2 2":" !#$%#% +!$+$!& %&! -%$-","P 42 21 2":" !#$%#,(+)*+*)-(,-! &%$&","P 43 2 2":" !#$%+% 9!$5$!& %-! =%$>","P 43 21 2":" !#$%+,(9)*5*)>(,=! &%$-","I 4 2 2":" !#$%#% #!$#$!& %&! &%$&()+*,+,(+)*+*)-(,-)(-,*-","I 41 2 2":" !#*,+%(5)$9*!> ,=)(-%$&()+$%#, 9!*5$)=(%>! &,*-","P 4 m m":" !#$%#% #!$# %#$!#%$#! #","P 4 b m":" !#$%#% #!$#(,#*)#,*#)(#","P 42 c m":" !#$%#% +!$+ %+$!+%$#! #","P 42 n m":" !#$%#,(+)*+(,+*)+%$#! #","P 4 c c":" !#$%#% #!$# %+$!+%$+! +","P 4 n c":" !#$%#% #!$#(,+*)+,*+)(+","P 42 m c":" !#$%#% +!$+ %#$!#%$+! +","P 42 b c":" !#$%#% +!$+(,#*)#,*+)(+","I 4 m m":" !#$%#% #!$# %#$!#%$#! #()+*,+,(+)*+(,+*)+,*+)(+","I 4 c m":" !#$%#% #!$# %+$!+%$+! +()+*,+,(+)*+(,#*)#,*#)(#","I 41 m d":" !#*,+%(5)$9 %#*)+%*5) 9()+$%#, 9!*5(,+$!#,$9!(5","I 41 c d":" !#*,+%(5)$9 %+*)#%*9) 5()+$%#, 9!*5(,#$!+,$5!(9","P -4 2 m":" !#$%#% &!$&$!& %&%$#! #","P -4 2 c":" !#$%#% &!$&$!- %-%$+! +","P -4 21 m":" !#$%#% &!$&*)&(,&,*#)(#","P -4 21 c":" !#$%#% &!$&*)-(,-,*+)(+","P -4 m 2":" !#$%#!$&% & %#$!#! &%$&","P -4 c 2":" !#$%#% &!$& %+$!+! -%$-","P -4 b 2":" !#$%#% &!$&(,#*)#)(&,*&","P -4 n 2":" !#$%#% &!$&(,+*)+)(-,*-","I -4 m 2":" !#$%#% &!$& %#$!#! &%$&()+*,+,(-)*-(,+*)+)(-,*-","I -4 c 2":" !#$%#% &!$& %+$!+! -%$-()+*,+,(-)*-(,#*)#)(&,*&","I -4 2 m":" !#$%#% &!$&$!& %&%$#! #()+*,+,(-)*-*)-(,-,*+)(+","I -4 2 d":" !#$%#% &!$&*!>(%>,$9) 9()+*,+,(-)*-$)= ,=%*5!(5","P 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #","P 4/m 2/c 2/c":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +","P 4/n 2/b 2/m":" !#$%#% #!$#$!& %&! &%$&*,&()&)*&,(&(,#*)#,*#)(#","P 4/n 2/n 2/c":" !#$%#% #!$#$!& %&! &%$&*,-()-)*-,(-(,+*)+,*+)(+","P 4/m 21/b 2/m":" !#$%#% #!$#*)&(,&)(&,*&$%& !&!$&% &(,#*)#,*#)(#","P 4/m 21/n 2/c":" !#$%#% #!$#*)-(,-)(-,*-$%& !&!$&% &(,+*)+,*+)(+","P 4/n 21/m 2/m":" !#$%#,(#)*#*)&(,&! &%$&*,&()&!$&% & %#$!#,*#)(#","P 4/n 2/c 2/c":" !#$%#,(#)*#*)-(,-! -%$-*,&()&!$&% & %+$!+,*+)(+","P 42/m 2/m 2/c":" !#$%#% +!$+$!& %&! -%$-$%& !&!$-% - %#$!#%$+! +","P 42/m 2/c 2/m":" !#$%#% +!$+$!- %-! &%$&$%& !&!$-% - %+$!+%$#! #","P 42/n 2/b 2/c":" !#$%#,(+)*+$!- %-)(&,*&*,-()-!$&% &(,#*)#%$+! +","P 42/n 2/n 2/m":" !#$%#,(+)*+$!& %&)(-,*-*,-()-!$&% &(,+*)+%$#! #","P 42/m 21/b 2/c":" !#$%#% +!$+*)&(,&)(-,*-$%& !&!$-% -(,#*)#,*+)(+","P 42/m 21/n 2/m":" !#$%#,./'*/*'-.,-! &%$&$%& !&'*-,.-.,/*'/%$#! #","P 42/n 21/m 2/c":" !#$%#,(+)*+*)-(,-! &%$&*,-()-!$&% & %#$!#,*+)(+","P 42/n 21/c 2/m":" !#$%#,(+)*+*)&(,&! -%$-*,-()-!$&% & %+$!+,*#)(#","I 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #()+*,+,(+)*+*)-(,-)(-,*-*,-()-)*-,(-(,+*)+,*+)(+","I 4/m 2/c 2/m":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +()+*,+,(+)*+*)&(,&)(&,*&*,-()-)*-,(-(,#*)#,*#)(#","I 41/a 2/m 2/d":" !#*,+%(5)$9*!> ,=)(-%$&$,=(!>!$&,(-(,+$!#,$9!(5()+$%#, 9!*5$)=(%>! &,*-*%> )=)*-% & %#*)+%*5) 9","I 41/a 2/c 2/d":" !#*,+%(5)$9*!= ,>)(&%$-$,=(!>!$&,(-(,#$!+,$5!(9()+$%#, 9!*5$)>(%=! -,*&*%> )=)*-% & %+*)#%*9) 5","P 3":" !#%?#@$#","P 31":" !#%?A@$B","P 32":" !#%?B@$A","H 3":" !#%?#@$#CDAEFAGHAIJBKLBMNB","R 3":" !## !!# ","P -3":" !#%?#@$#$%&!@&? &","H -3":" !#%?#@$#$%&!@&? &OPQRSQTUQVWXYZX[]X]Y^W[^ZV^UR_PT_SO_","R -3":" !## !!# $%&&$%%&$","P 3 1 2":" !#%?#@$#%$&@!& ?&","P 3 2 1":" !#%?#@$#! &?%&$@&","P 31 1 2":" !#%?Q@$^%$_@!X ?&","P 31 2 1":" !#%?A@$B! &?%_$@X","P 32 1 2":" !#%?^@$Q%$X@!_ ?&","P 32 2 1":" !#%?B@$A! &?%X$@_","H 3 2":" !#%?#@$#! &?%&$@&OPQRSQTUQY]X[WXVZX]Y^W[^ZV^PO_SR_UT_","R 3 2":" !## !!# %$&$&%&%$","P 3 m 1":" !#%?#@$#%$#@!# ?#","P 3 1 m":" !#%?#@$#! #?%#$@#","P 3 c 1":" !#%?#@$#%$+@!+ ?+","P 3 1 c":" !#%?#@$#! +?%+$@+","H 3 m":" !#%?#@$#%$#@!# ?#OPQRSQTUQRUQTPQOSQ]Y^W[^ZV^WV^ZY^][^","R 3 m":" !## !!# ! # #!#! ","H 3 c":" !#%?#@$#%$+@!+ ?+OPQRSQTUQRU`TP`OS`]Y^W[^ZV^WVaZYa][a","R 3 c":" !## !!# '././'/'.","P -3 1 2/m":" !#%?#@$#%$&@!& ?&$%&!@&? &! #?%#$@#","P -3 1 2/c":" !#%?#@$#%$-@!- ?-$%&!@&? &! +?%+$@+","P -3 2/m 1":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#","P -3 2/c 1":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+","H -3 2/m":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#OPQRSQTUQY]X[WXVZXVWXYZX[]XRUQTPQOSQ]Y^W[^ZV^PO_SR_UT_UR_PT_SO_WV^ZY^][^","R -3 2/m":" !## !!# %$&$&%&%$$%&&$%%&$! # #!#! ","H -3 2/c":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+OPQRSQTUQY]b[WbVZbVWXYZX[]XRU`TP`OS`]Y^W[^ZV^POcSRcUTcUR_PT_SO_WVaZYa][a","R -3 2/c":" !## !!# 102021210$%&&$%%&$'././'/'.","P 6":" !#%?#@$#$%#!@#? #","P 61":" !#%?A@$B$%/!@d? e","P 65":" !#%?B@$A$%/!@e? d","P 62":" !#%?^@$Q$%#!@^? Q","P 64":" !#%?Q@$^$%#!@Q? ^","P 63":" !#%?#@$#$%+!@+? +","P -6":" !#%?#@$# !&%?&@$&","P 6/m":" !#%?#@$#$%#!@#? #$%&!@&? & !&%?&@$&","P 63/m":" !#%?#@$#$%+!@+? +$%&!@&? & !-%?-@$-","P 6 2 2":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&","P 61 2 2":" !#%?Q@$^$%+!@`? a! X?%&$@_%$b@!- ?c","P 65 2 2":" !#%?^@$Q$%+!@a? `! _?%&$@X%$c@!- ?b","P 62 2 2":" !#%?^@$Q$%#!@^? Q! _?%&$@X%$_@!& ?X","P 64 2 2":" !#%?Q@$^$%#!@Q? ^! X?%&$@_%$X@!& ?_","P 63 2 2":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-","P 6 m m":" !#%?#@$#$%#!@#? #%$#@!# ?#! #?%#$@#","P 6 c c":" !#%?#@$#$%#!@#? #%$+@!+ ?+! +?%+$@+","P 63 c m":" !#%?#@$#$%+!@+? +%$+@!+ ?+! #?%#$@#","P 63 m c":" !#%?#@$#$%+!@+? +%$#@!# ?#! +?%+$@+","P -6 m 2":" !#%?#@$# !&%?&@$&%$#@!# ?#%$&@!& ?&","P -6 c 2":" !#%?#@$# !-%?-@$-%$+@!+ ?+%$&@!& ?&","P -6 2 m":" !#%?#@$# !&%?&@$&! &?%&$@&! #?%#$@#","P -6 2 c":" !#%?#@$# !-%?-@$-! &?%&$@&! +?%+$@+","P 6/m 2/m 2/m":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&$%&!@&? & !&@$&%?&%$#@!# ?#! #?%#$@#","P 6/m 2/c 2/c":" !#%?#@$#$%#!@#? #! -?%-$@-%$-@!- ?-$%&!@&? & !&@$&%?&%$+@!+ ?+! +?%+$@+","P 63/m 2/c 2/m":" !#%?#@$#$%+!@+? +! -?%-$@-%$&@!& ?&$%&!@&? & !-@$-%?-%$+@!+ ?+! #?%#$@#","P 63/m 2/m 2/c":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-$%&!@&? & !-@$-%?-%$#@!# ?#! +?%+$@+","P 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ","F 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%&  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ","I 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(","P 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(","I 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- ","P 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$","P 2/n -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& *,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","F 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-($,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- *,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$","F 2/d -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& 64=37=345675=64=375345674=67=3453756 )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(68>3:>3896:9=<8=;:5;85<:4><7>;49;79<(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(<4>;7>;49<79>68>3:93896:8=<:=;85;:5<()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- <8=;:=;8f<:f><4>;79;49<78>6:>3893:96","I 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","P 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*","I 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*()+$,#*g& %-+()#$,&*!- %)+(,#$!&*%- *,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$","P 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$","P 42 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","F 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$","F 41 3 2":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46 )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<(!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86","I 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","P 43 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7;>46=:<5839398<5:6=4;>75:<983>7;=46","P 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<","I 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46","P -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ","F -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&%  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(+%*+!*-%(- +)$+,$-) -,#)(#,*&)*&,((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() +,$+)$-, -(#)*#,*&)(&,+!(+%*-!*-%(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(#,*#)*&,(&(+!*+%*-!(-%+) +,$-)$-, ","I -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","P -4 3 n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","F -4 3 c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() #,$#)$&, &(#!*#%*&!(&%+! +%$-!$-% (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(#%*#!*&%(& +!$+%$-! -%#) #,$&)$&, ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! +%$+!$-% - #)$#,$&) &,#!(#%*&!*&%(","I -4 3 d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7354<9:6>8;=357<946>:;=857394<>:6=8;()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- :;98657<=43>;9:658<=73>49:;586=7<>43","P 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","P 4/n -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/m -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/n -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","F 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#!  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*%*+!(+%(-!*-$-) -, +)$+,&,(&)*#,*#)((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%**%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*,$+) +, -)$-*&)(&,(#)*#,-%(-!*+%*+!(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$*,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$,*#)(#,(&)*&*-!(-%(+!*+%-, -)$+,$+) ","F 4/m -3 2/c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() &,$&)$#, #(#%*#!*&%(&!+!$+% -! -%$$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*,$#) #, &)$&*&!(&%(#!*#%-% -!$+%$+! (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(&%*&!*#%(# +%$+!$-% -!#)$#, &) &,$*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*%*#!(#%(&!*&$-! -% +!$+%&, &)$#,$#) ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! -%$-!$+% + #,$#)$&, &)#!*#%(&!(&%**,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$%$+! +% -!$-$&) &, #)$#,&%(&!*#%*#!(","F 41/d -3 2/m":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=4664=3:>;85<79=64>3:5;89<74=6:>385;79<,$+! #%(-)*&*&)(-% #!$+,-%(&)*+,$#!  )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<68>37=;49<:5=<8>;753496:4><:=;893756,*#!(+% &)$-*-!(&, +)$#%-, &!$+%*#)((!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<<4>;:=389675>68=379;45<:8=<7>;453:96%$#) +,(&!*-$&! -,(#)*+%&% -)$#,*+!(()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86<8=;7>3456:9><4=;:9385678>67=349;:5<%*+)(#, -!$&$-) &%(+!*#,&,(-!*#%$+) ","F 41/d -3 2/c":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46<8>;7=3496:5><8=;793456:8><7=;493:56%*#)(+, &!$-$-! &,(+)*#%&, -!$#%*+)( )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<<4=;:>385679>64=3:9;85<78=67>345;:9<%$+) #,(-!*&$&) -%(#!*+,&%(-)*#,$+! (!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<68=37>;45<:9=<4>;:5389674>6:=389;75<,*+!(#% -)$&*-)(&% +!$#,-,(&!*+%$#) ()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>8664>3:=;89<75=68>375;49<:4=<:>;853796,$#! +%(&)*-*&!(-, #)$+%-% &)$+,*#!(","I 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","I 41/a -3 2/d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<$%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*4<97358;=:6>6>:;=8357<94=8;>:694<573()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46*,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$865:;943>7<=<=73>4;9:658>43=7<5869:;","P 1 1 2":" !#$%#","P 1 1 21":" !#$%+","B 1 1 2":" !#$%#(g+*%+","A 1 2 1":" !#$!& )+$)-","C 1 21 1":" !#$)&()#*!&","I 1 2 1":" !#$!&.'/0'2","I 1 21 1":" !#$)&.'/0!-","P 1 1 m":" !# !&","P 1 1 b":" !# )&","B 1 1 m":" !# !&(!+(!-","B 1 1 b":" !# )&(!+()-","P 1 1 2/m":" !# !&$%#$%&","P 1 1 21/m":" !#$%+$%& !-","B 1 1 2/m":" !# !&$%#$%&(!+(!-*%+*%-","P 1 1 2/b":" !#$,#$%& )&","P 1 1 21/b":" !#$%&$,+ )-","B 1 1 2/b":" !#$,#$%& )&(!+*,+*%-()-","P 21 2 2":" !#$!&(%&*%#","P 2 21 2":" !# ,&$)&$%#","P 21 21 2 (a)":" !#*,#.%&$'&","P 21 2 21":" !#$!&(%-*%+","P 2 21 21":" !# %&$)-$,+","C 2 2 21a)":" !#*%+(,&$)-()#$,+ %&*!-","C 2 2 2a":" !#*,#.%&$'&()#$%# ,&*!&","F 2 2 2a":" !#*,#.%&$'& '/*%/.12$!2.!/$,/ %20'2.'#$%# 1&0!&","I 2 2 2a":" !#*,#.%&$'&()+$%+*!- ,-","P 21/m 21/m 2/n a":" !#*,#$)&(%&$%&.'& ,#*!#","P 42 21 2a":" !#*,#%.+'$+$'&.%&! -,*-","I 2 3a":" !#*,#.%&$'&!# ,- '&$%/$# !-*!/$%&.%()+$%+ ,-*!-)+(%&(!-*,#*+()&$)#*,- ,"},sj=/^[1-9]$/;function xP(n){let e="";return n.length>0&&(e=":"+qb(n).join(" OR :")),new yn(e)}class Js{constructor(e=""){this.name=e,this.partList=[]}get type(){return"Assembly"}addPart(e,t){const r=new aj(e,t);return this.partList.push(r),r}getAtomCount(e){return this.partList.reduce((t,r)=>t+r.getAtomCount(e),0)}getResidueCount(e){return this.partList.reduce((t,r)=>t+r.getResidueCount(e),0)}getInstanceCount(){let e=0;return this.partList.forEach(function(t){e+=t.matrixList.length}),e}isIdentity(e){if(this.partList.length!==1)return!1;const t=this.partList[0];if(t.matrixList.length!==1||!new at().equals(t.matrixList[0]))return!1;let r=[];return e.eachChain(function(i){r.push(i.chainname)}),r=qb(r),t.chainList.length===r.length}getBoundingBox(e){const t=new Nn;return this.partList.forEach(function(r){const i=r.getBoundingBox(e);t.expandByPoint(i.min),t.expandByPoint(i.max)}),t}getCenter(e){return this.getBoundingBox(e).getCenter(new te)}getSelection(){let e=[];return this.partList.forEach(function(t){e=e.concat(t.chainList)}),xP(e)}}class aj{constructor(e=[],t=[]){this.matrixList=e,this.chainList=t}get type(){return"AssemblyPart"}_getCount(e,t){let r=0;return e.eachChain(i=>{(this.chainList.length===0||this.chainList.includes(i.chainname))&&(r+=i[t])}),this.matrixList.length*r}getAtomCount(e){return this._getCount(e,"atomCount")}getResidueCount(e){return this._getCount(e,"residueCount")}getBoundingBox(e){const t=new Nn,r=new Nn,i=this.getSelection(),o=e.getBoundingBox(i);return this.matrixList.forEach(function(s){r.copy(o).applyMatrix4(s),t.expandByPoint(r.min),t.expandByPoint(r.max)}),t}getSelection(){return xP(this.chainList)}getView(e){const t=this.getSelection();return t?e.getView(t):e}getInstanceList(){const e=[];for(let t=0,r=this.matrixList.length;t<r;++t)e.push({id:t+1,name:t,matrix:this.matrixList[t]});return e}}class lj{constructor(e){this.structure=e,this.currentModelindex=null,this.currentChainid=null,this.currentResname=null,this.currentResno=null,this.currentInscode=void 0,this.currentHetero=null,this.previousResname="",this.previousHetero=null,this.ai=-1,this.ri=-1,this.ci=-1,this.mi=-1}addResidueType(e){var t,r;const i=this.structure.atomStore,o=this.structure.residueStore,s=this.structure.residueMap,a=(t=this.structure.chemCompMap)===null||t===void 0?void 0:t.dict[this.previousResname],l=o.atomCount[e],c=o.atomOffset[e],u=new Array(l);for(let m=0;m<l;++m)u[m]=i.atomTypeId[c+m];const d=a==null?void 0:a.chemCompType,h=a?(r=this.structure.chemCompMap)===null||r===void 0?void 0:r.getBonds(this.previousResname,u):void 0;o.residueTypeId[e]=s.add(this.previousResname,u,this.previousHetero,d,h)}addAtom(e,t,r,i,o,s,a,l){const c=this.structure.atomStore,u=this.structure.residueStore,d=this.structure.chainStore,h=this.structure.modelStore;let m=!1,f=!1,v=!1;this.currentModelindex!==e?(m=!0,f=!0,v=!0,this.mi+=1,this.ci+=1,this.ri+=1):this.currentChainid!==r?(f=!0,v=!0,this.ci+=1,this.ri+=1):this.currentResno===o&&this.currentResname===i&&this.currentInscode===l||(v=!0,this.ri+=1),this.ai+=1,m&&(h.growIfFull(),h.chainOffset[this.mi]=this.ci,h.chainCount[this.mi]=0,h.count+=1,d.modelIndex[this.ci]=this.mi),f&&(d.growIfFull(),d.setChainname(this.ci,t),d.setChainid(this.ci,r),d.residueOffset[this.ci]=this.ri,d.residueCount[this.ci]=0,d.count+=1,d.modelIndex[this.ci]=this.mi,h.chainCount[this.mi]+=1,u.chainIndex[this.ri]=this.ci),v&&(this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>0&&this.addResidueType(this.ri-1),u.growIfFull(),u.resno[this.ri]=o,a!==void 0&&(u.sstruc[this.ri]=a.charCodeAt(0)),l!==void 0&&(u.inscode[this.ri]=l.charCodeAt(0)),u.atomOffset[this.ri]=this.ai,u.atomCount[this.ri]=0,u.count+=1,u.chainIndex[this.ri]=this.ci,d.residueCount[this.ci]+=1),c.count+=1,c.residueIndex[this.ai]=this.ri,u.atomCount[this.ri]+=1,this.currentModelindex=e,this.currentChainid=r,this.currentResname=i,this.currentResno=o,this.currentInscode=l,this.currentHetero=s}finalize(){this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>-1&&this.addResidueType(this.ri)}}function wP(n,e){if(!e)return;Xe&&Be.time("assignSecondaryStructure");const t=[];n.eachModel(function(c){c.eachChain(function(u){t.push(u.chainname)})});const r=t.slice().sort(),i=[];r.forEach(function(c){i.push(t.indexOf(c))});const o=e.helices.filter(function(c){return Pa(r,c[0])>=0});o.sort(function(c,u){const d=c[0],h=u[0],m=c[1],f=u[1];if(d===h)return m===f?0:m<f?-1:1;{const v=Pa(r,d),g=Pa(r,h);return i[v]<i[g]?-1:1}});const s=n.residueStore;n.eachModel(function(c){let u=0;const d=o.length;if(d===0)return;let h=o[u],m=!1,f=!1;c.eachChain(function(v){let g=!1;if(v.chainname===h[0]){const b=v.residueCount,S=v.residueOffset,p=S+b;for(let y=S;y<p;++y)if(s.resno[y]===h[1]&&s.getInscode(y)===h[2]&&(m=!0),m&&(s.sstruc[y]=h[6],s.resno[y]===h[4]&&s.getInscode(y)===h[5]&&(m=!1,u+=1,u<d?(y=S-1,h=o[u],g=v.chainname!==h[0]):f=!0)),g||f)return}})});const a=e.sheets.filter(function(c){return Pa(r,c[0])>=0});a.sort(function(c,u){const d=c[0],h=u[0];if(d===h)return 0;const m=Pa(r,d),f=Pa(r,h);return i[m]<i[f]?-1:1});const l=101;n.eachModel(function(c){let u=0;const d=a.length;if(d===0)return;let h=a[u],m=!1,f=!1;c.eachChain(function(v){let g=!1;if(v.chainname===h[0]){const b=v.residueCount,S=v.residueOffset,p=S+b;for(let y=S;y<p;++y)if(s.resno[y]===h[1]&&s.getInscode(y)===h[2]&&(m=!0),m&&(s.sstruc[y]=l,s.resno[y]===h[4]&&s.getInscode(y)===h[5]&&(m=!1,u+=1,u<d?(y=S-1,h=a[u],g=v.chainname!==h[0]):f=!0)),g||f)return}})}),Xe&&Be.timeEnd("assignSecondaryStructure")}const Cm=function(){const n=function(r,i,o,s){const a=r.structure,l=r.residueIndexStart,c=a.getResidueProxy(),u=a.getResidueProxy(),d=a.getAtomProxy(),h=a.getAtomProxy();for(let m=Math.max(0,i-2);m<=i;++m)for(let f=2;f<5;++f){if(m+f>=r.residueCount)continue;c.index=l+m,u.index=l+m+f,d.index=c.traceAtomIndex,h.index=u.traceAtomIndex;const v=d.distanceTo(h);if(Math.abs(v-o[f-2])>s)return!1}return!0},e=function(r,i){return n(r,i,[5.45,5.18,6.37],2.1)},t=function(r,i){return n(r,i,[6.1,10.4,13],1.42)};return function(r){Xe&&Be.time("calculateSecondaryStructure"),r.eachPolymer(function(i){if(i.residueCount<4)return;if(i.isCg())(function(a){const l=a.residueStore,c=a.residueIndexStart,u=new yP(a).position,d=new te,h=new te;for(let m=0,f=a.residueCount;m<f;++m){d.fromArray(u.center,3*m),h.fromArray(u.center,3*m+3);const v=d.distanceTo(h);v<2&&v>1&&u.bending[m]<20&&(l.sstruc[c+m]=104,l.sstruc[c+m+1]=104)}})(i);else{if(!i.isProtein())return;(function(a){const l=a.residueStore,c=a.residueIndexStart;for(let u=0,d=a.residueCount;u<d;++u){let h="c";e(a,u)?h="h":t(a,u)&&(h="e"),l.sstruc[c+u]=h.charCodeAt(0)}})(i)}let o,s=0;i.eachResidue(function(a){a.sstruc===o?s+=1:(s===1&&(a.index-=1,a.sstruc="c"),s=1,o=a.sstruc)})}),Xe&&Be.timeEnd("calculateSecondaryStructure")}}(),h0="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function Cd(n){const e=h0.length;let t=n,r=0,i=h0[t%e];for(;t>=e;)t=Math.floor(t/e),i+=h0[t%e],r+=1;return r>=5&&Be.warn("chainname overflow"),i}function Am(n,e=!1){Xe&&Be.time("calculateChainnames");let t=!0;if(n.eachChain(function(r){r.chainname&&(t=!1)}),t){const r=n.modelStore,i=n.chainStore,o=n.residueStore,s=function(v,g,b,S){const p=i.count;for(let y=0;y<S;++y)o.chainIndex[b+y]=p;i.growIfFull(),i.modelIndex[p]=v,i.setChainname(p,g),i.setChainid(p,g),i.residueOffset[p]=b,i.residueCount[p]=S,i.count+=1,r.chainCount[v]+=1},a=n.getAtomProxy(),l=n.getAtomProxy();let c=0,u=0,d=0,h=0;const m=[];o.count===1?m.push({mIndex:0,chainname:"A",rStart:0,rCount:1}):n.eachResidueN(2,function(v,g){let b=!1;const S=v.backboneType,p=g.backboneType,y=ol;h=v.index,v.modelIndex!==g.modelIndex||v.moleculeType!==g.moleculeType?b=!0:S!==y&&S===p&&(a.index=v.backboneEndAtomIndex,l.index=g.backboneStartAtomIndex,b=e?!a.hasBondTo(l):!a.connectedTo(l)),b||g.index!==o.count-1||(b=!0,h=g.index),b&&(m.push({mIndex:u,chainname:Cd(c),rStart:d,rCount:h-d+1}),c+=1,v.modelIndex!==g.modelIndex&&(c=0,u+=1),g.index===o.count-1&&h!==g.index&&m.push({mIndex:u,chainname:Cd(c),rStart:o.count-1,rCount:1}),d=g.index,h=g.index)}),i.count=0,r.chainCount.fill(0,0,r.count),r.chainOffset.fill(0,0,r.count),m.forEach(function(v){s(v.mIndex,v.chainname,v.rStart,v.rCount)});let f=0;n.eachModel(function(v){r.chainOffset[v.index]=f,f+=r.chainCount[v.index]})}Xe&&Be.timeEnd("calculateChainnames")}function wp(n,e="all"){e!=="none"&&(Xe&&Be.time("calculateBonds"),qc(n,!1,e),Xc(n),Xe&&Be.timeEnd("calculateBonds"))}const cj={"HIS|CD2|CG":2,"HIS|CE1|ND1":2,"ARG|CZ|NH2":2,"PHE|CE1|CZ":2,"PHE|CD2|CE2":2,"PHE|CD1|CG":2,"TRP|CD1|CG":2,"TRP|CD2|CE2":2,"TRP|CE3|CZ3":2,"TRP|CH2|CZ2":2,"ASN|CG|OD1":2,"GLN|CD|OE1":2,"TYR|CD1|CG":2,"TYR|CD2|CE2":2,"TYR|CE1|CZ":2,"ASP|CG|OD1":2,"GLU|CD|OE1":2,"G|C8|N7":2,"G|C4|C5":2,"G|C2|N3":2,"G|C6|O6":2,"C|C4|N3":2,"C|C5|C6":2,"C|C2|O2":2,"A|C2|N3":2,"A|C6|N1":2,"A|C4|C5":2,"A|C8|N7":2,"U|C5|C6":2,"U|C2|O2":2,"U|C4|O4":2,"DG|C8|N7":2,"DG|C4|C5":2,"DG|C2|N3":2,"DG|C6|O6":2,"DC|C4|N3":2,"DC|C5|C6":2,"DC|C2|O2":2,"DA|C2|N3":2,"DA|C6|N1":2,"DA|C4|C5":2,"DA|C8|N7":2,"DT|C5|C6":2,"DT|C2|O2":2,"DT|C4|O4":2};function Kw(n,e,t){return[e,t]=e<t?[e,t]:[t,e],hc.includes(n)&&e==="C"&&t==="O"||qu.includes(n)&&e==="OP1"&&t==="P"?2:cj[`${n}|${e}|${t}`]||1}function qc(n,e=!1,t="all"){Xe&&Be.time("calculateBondsWithin");const r=n.bondStore,i=n.rungBondStore,o=n.getAtomSet(!1),s=n.getAtomProxy(),a=n.getAtomProxy(),l=n.getBondProxy(),c=e?null:function(d){Xe&&Be.time("calculateAtomBondMap");var h=[];return d.eachBond(function(m){var f=m.atomIndex1,v=m.atomIndex2;h[f]===void 0&&(h[f]=[]),h[f][v]=m.index}),Xe&&Be.timeEnd("calculateAtomBondMap"),h}(n);let u;e||t!=="auto"||(u=new Set,c.forEach((d,h)=>{u.add(h),d.forEach(m=>{u.add(m)})})),n.eachResidue(function(d){if(!e&&c){const f=d.atomCount,v=d.atomOffset;if(f>500)return void Be.warn("more than 500 atoms, skip residue for auto-bonding",d.qualifiedName());if(t==="auto"&&d.hetero){for(let w=d.atomOffset;w<d.atomEnd;w++)if(u.has(w))return}const g=d.getBonds(),b=g.atomIndices1,S=g.atomIndices2,p=g.bondOrders,y=b.length;for(let w=0;w<y;++w){const x=b[w],_=S[w],A=x+v,C=_+v,T=c[A];T!==void 0&&T[C]!==void 0?(l.index=T[C],p[d.residueType.getBondIndex(x,_)]=l.bondOrder):(s.index=A,a.index=C,r.addBond(s,a,p[w]))}}const h=d.residueType.traceAtomIndex,m=d.residueType.rungEndAtomIndex;h!==-1&&m!==-1&&(s.index=d.traceAtomIndex,a.index=d.rungEndAtomIndex,i.addBond(s,a),o.set(s.index),o.set(a.index))}),n.atomSetDict.rung=o,Xe&&Be.timeEnd("calculateBondsWithin")}function Xc(n,e=!1,t=!1){Xe&&Be.time("calculateBondsBetween");const r=n.bondStore,i=n.backboneBondStore,o=n.getAtomSet(!1),s=n.getAtomProxy(),a=n.getAtomProxy();function l(d,h){const m=d.backboneType,f=h.backboneType;if(m!==ol&&m===f){s.index=d.backboneEndAtomIndex,a.index=h.backboneStartAtomIndex;let v=!1,g=!1;t&&s.hasBondTo(a)?(v=!1,g=!0):s.connectedTo(a)&&(v=!e,g=!0),v&&r.addBond(s,a,1),g&&(s.index=d.traceAtomIndex,a.index=h.traceAtomIndex,i.addBond(s,a),o.set(s.index),o.set(a.index))}}i.count===0&&i.resize(n.residueStore.count),n.eachResidueN(2,l);const c=n.getResidueProxy(),u=n.getResidueProxy();if(n.eachChain(function(d){d.residueCount!==0&&(c.index=d.residueOffset,u.index=d.residueOffset+d.residueCount-1,l(u,c))}),n.atomSetDict.backbone=o,!e){Xe&&Be.time("calculateBondsBetween inter");const d=n.spatialHash;n.eachResidue(function(h){h.backboneType!==ol||h.isWater()||h.eachAtom(function(m){m.isMetal()||d.eachWithin(m.x,m.y,m.z,4,function(f){a.index=f,m.modelIndex!==a.modelIndex||m.residueIndex===a.residueIndex||a.isMetal()||r.addBondIfConnected(m,a,1)})})}),Xe&&Be.timeEnd("calculateBondsBetween inter")}Xe&&Be.timeEnd("calculateBondsBetween")}function Sp(n){if(!n.unitcell)return;Xe&&Be.time("buildUnitcellAssembly");const e=n.unitcell,t=n.center.clone().applyMatrix4(e.cartToFrac),r=t.clone().floor(),i=function(f){const v=oj[f],g={};if(v===void 0)return console.warn(`spacegroup '${f}' not found in symop library`),g;const b=[];for(let S=0,p=v.length;S<p;S+=3){const y=[];for(let w=0;w<3;++w)y.push(ij[v[S+w]]);b.push(y)}return b.forEach(function(S){let p=0;const y=new at().set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),w=y.elements;g[S.toString()]=y,S.forEach(function(x){let _=!1,A=!1;for(let C=0,T=x.length;C<T;++C){const I=x[C];if(I==="-")_=!0;else if(I==="+")_=!1;else if(I==="/")A=!0;else if(I==="X")w[0+p]=_?-1:1;else if(I==="Y")w[4+p]=_?-1:1;else if(I==="Z")w[8+p]=_?-1:1;else if(sj.test(I)){const M=parseInt(I);A?w[12+p]/=M:w[12+p]=M}else Be.warn(`getSymmetryOperations: unknown token '${I}'`)}p+=1})}),g}(e.spacegroup),o=new te,s=new te;function a(f){const v=[];return Object.keys(i).forEach(function(g){const b=i[g].clone();o.copy(t).applyMatrix4(b).floor(),s.setFromMatrixPosition(b),s.sub(o),s.add(r),f&&s.add(f),b.setPosition(s),b.multiplyMatrices(e.fracToCart,b),b.multiply(e.cartToFrac),v.push(b)}),v}const l=new Js("UNITCELL"),c=a(),u=[];if(n.biomolDict.NCS){u.push(new at,...n.biomolDict.NCS.partList[0].matrixList);const f=[];c.forEach(v=>{u.forEach(g=>{f.push(v.clone().multiply(g))})}),l.addPart(f)}else l.addPart(c);const d=new te,h=new Js("SUPERCELL"),m=Array.prototype.concat.call(a(d.set(1,0,0)),a(d.set(0,1,0)),a(d.set(0,0,1)),a(d.set(-1,0,0)),a(d.set(0,-1,0)),a(d.set(0,0,-1)),a(d.set(1,1,0)),a(d.set(1,0,1)),a(d.set(0,1,1)),a(d.set(-1,-1,0)),a(d.set(-1,0,-1)),a(d.set(0,-1,-1)),a(d.set(1,-1,-1)),a(d.set(1,1,-1)),a(d.set(1,-1,1)),a(d.set(-1,1,1)),a(d.set(-1,-1,1)),a(d.set(-1,1,-1)),a(d.set(0,1,-1)),a(d.set(0,-1,1)),a(d.set(1,0,-1)),a(d.set(-1,0,1)),a(d.set(1,-1,0)),a(d.set(-1,1,0)),a(),a(d.set(1,1,1)),a(d.set(-1,-1,-1)));if(n.biomolDict.NCS){const f=[];m.forEach(function(v){u.forEach(function(g){f.push(v.clone().multiply(g))})}),h.addPart(f)}else h.addPart(m);n.biomolDict.UNITCELL=l,n.biomolDict.SUPERCELL=h,Xe&&Be.timeEnd("buildUnitcellAssembly")}const Zw=["H","C","O","N","S","P"],uj=["NA","CL","FE"];function ny(n){let e=n.toUpperCase(),t=0,r=0;for(let o=0;o<e.length;o++)if(e.charCodeAt(o)<65){if(r>0)break;++t}else r=o+1;(t>0||r<e.length)&&(e=e.substring(t,r));const i=e.length;if(i===0)return"";if(i===1)return e;if(i===2){if(uj.indexOf(e)!==-1)return e;if(Zw.indexOf(e[0])!==-1)return e[0];if(e in tP)return e}return i>=3&&Zw.indexOf(e[0])!==-1?e[0]:""}function sl(n){const e=n.bondHash,t=e.countArray,r=e.offsetArray,i=e.indexArray,o=n.getBondProxy();n.eachResidue(function(s){const a=s.residueType;if(a.bonds!==void 0)return;var l=s.atomOffset,c=[],u=[],d=[],h={};const m=l+s.atomCount;s.eachAtom(function(f){const v=f.index,g=r[v];for(let b=0,S=t[v];b<S;++b){o.index=i[g+b];let p=o.atomIndex1;if(p<l||p>=m)continue;let y=o.atomIndex2;if(y<l||y>=m)continue;if(p>y){const x=y;y=p,p=x}const w=p+"|"+y;h[w]===void 0&&(h[w]=!0,c.push(p-l),u.push(y-l),d.push(o.bondOrder))}}),a.bonds={atomIndices1:c,atomIndices2:u,bondOrders:d}})}const dj=[3,11,19,37,55,87],hj=[4,12,20,38,56,88],fj=[6,15,16,34],pj=[1,7,8,9,17,35,53],mj=[2,10,18,36,54,86],gj=[13,30,31,48,49,50,80,81,82,83,84,85,112],vj=[5,14,32,33,51,52,85],bj=[9,17,35,53,85];class yj{constructor(e,t,r){this.structure=e,this.atomname=t,r=r||ny(t),this.element=r,this.number=tP[r]||0,this.vdw=JG[this.number]||2,this.covalent=QG[this.number]||1.6}getDefaultValence(){const e=kw[this.number];return e?e[0]:-1}getValenceList(){return kw[this.number]||[]}getOuterShellElectronCount(){return eW[this.number]||2}isMetal(){return this.isAlkaliMetal()||this.isAlkalineEarthMetal()||this.isLanthanide()||this.isActinide()||this.isTransitionMetal()||this.isPostTransitionMetal()}isNonmetal(){return this.isDiatomicNonmetal()||this.isPolyatomicNonmetal()||this.isNobleGas()}isMetalloid(){return vj.includes(this.number)}isHalogen(){return bj.includes(this.number)}isDiatomicNonmetal(){return pj.includes(this.number)}isPolyatomicNonmetal(){return fj.includes(this.number)}isAlkaliMetal(){return dj.includes(this.number)}isAlkalineEarthMetal(){return hj.includes(this.number)}isNobleGas(){return mj.includes(this.number)}isTransitionMetal(){const e=this.number;return e>=21&&e<=29||e>=39&&e<=47||e>=72&&e<=79||e>=104&&e<=108}isPostTransitionMetal(){return gj.includes(this.number)}isLanthanide(){return this.number>=57&&this.number<=71}isActinide(){return this.number>=89&&this.number<=103}}class _j{constructor(e){this.structure=e,this.dict={},this.list=[],this.structure=e}add(e,t){const r=function(o,s){return o+"|"+s}(e=e.toUpperCase(),t=t?t.toUpperCase():ny(e));let i=this.dict[r];if(i===void 0){const o=new yj(this.structure,e,t);i=this.list.length,this.dict[r]=i,this.list.push(o)}return i}get(e){return this.list[e]}}class xj{constructor(e,t,r,i,o,s){this.structure=e,this.bondReferenceAtomIndices=[],this.resname=t,this.atomTypeIdList=r,this.hetero=i?1:0,this.chemCompType=o,this.bonds=s,this.atomCount=r.length,this.moleculeType=this.getMoleculeType(),this.backboneType=this.getBackboneType(0),this.backboneEndType=this.getBackboneType(-1),this.backboneStartType=this.getBackboneType(1),this.backboneIndexList=this.getBackboneIndexList();const a=Tu[this.backboneType],l=Tu[this.backboneStartType],c=Tu[this.backboneEndType],u=this.getAtomIndexByName(a.trace);this.traceAtomIndex=W(u,-1);const d=this.getAtomIndexByName(a.direction1);this.direction1AtomIndex=W(d,-1);const h=this.getAtomIndexByName(a.direction2);this.direction2AtomIndex=W(h,-1);const m=this.getAtomIndexByName(l.backboneStart);this.backboneStartAtomIndex=W(m,-1);const f=this.getAtomIndexByName(c.backboneEnd);let v;this.backboneEndAtomIndex=W(f,-1),v=nW.includes(t)?this.getAtomIndexByName("N1"):this.getAtomIndexByName("N3"),this.rungEndAtomIndex=W(v,-1)}getBackboneIndexList(){const e=[];let t;switch(this.moleculeType){case 3:t=oW;break;case 4:case 5:t=iP;break;default:return e}const r=this.structure.atomMap,i=this.atomTypeIdList;for(let o=0,s=this.atomCount;o<s;++o){const a=r.get(i[o]);t.includes(a.atomname)&&e.push(o)}return e}getMoleculeType(){return this.isProtein()?3:this.isRna()?4:this.isDna()?5:this.isWater()?1:this.isIon()?2:this.isSaccharide()?6:0}getBackboneType(e){return this.hasProteinBackbone(e)?1:this.hasRnaBackbone(e)?2:this.hasDnaBackbone(e)?3:this.hasCgProteinBackbone(e)?4:this.hasCgRnaBackbone(e)?5:this.hasCgDnaBackbone(e)?6:ol}isProtein(){return this.chemCompType?XG.includes(this.chemCompType):this.hasAtomWithName("CA","C","N")||hc.includes(this.resname)}isCg(){const e=this.backboneType;return e===4||e===5||e===6}isNucleic(){return this.isRna()||this.isDna()}isRna(){return this.chemCompType?YG.includes(this.chemCompType):this.hetero!==1&&(this.hasAtomWithName(["P","O3'","O3*"],["C4'","C4*"],["O2'","O2*","F2'","F2*"])||nP.includes(this.resname)&&this.hasAtomWithName(["O2'","O2*","F2'","F2*"]))}isDna(){return this.chemCompType?KG.includes(this.chemCompType):this.hetero!==1&&(this.hasAtomWithName(["P","O3'","O3*"],["C3'","C3*"])&&!this.hasAtomWithName(["O2'","O2*","F2'","F2*"])||rP.includes(this.resname))}isHetero(){return this.hetero===1}isIon(){return rW.includes(this.resname)}isWater(){return _p.includes(this.resname)}isSaccharide(){return this.chemCompType?ZE.includes(this.chemCompType):iW.includes(this.resname)}isStandardAminoacid(){return hc.includes(this.resname)}isStandardBase(){return qu.includes(this.resname)}hasBackboneAtoms(e,t){const r=Tu[t];return e===-1?this.hasAtomWithName(r.trace,r.backboneEnd,r.direction1,r.direction2):e===0?this.hasAtomWithName(r.trace,r.direction1,r.direction2):e===1?this.hasAtomWithName(r.trace,r.backboneStart,r.direction1,r.direction2):this.hasAtomWithName(r.trace,r.backboneStart,r.backboneEnd,r.direction1,r.direction2)}hasProteinBackbone(e){return this.isProtein()&&this.hasBackboneAtoms(e,1)}hasRnaBackbone(e){return this.isRna()&&this.hasBackboneAtoms(e,2)}hasDnaBackbone(e){return this.isDna()&&this.hasBackboneAtoms(e,3)}hasCgProteinBackbone(e){return this.atomCount<7&&this.isProtein()&&this.hasBackboneAtoms(e,4)}hasCgRnaBackbone(e){return this.atomCount<11&&this.isRna()&&this.hasBackboneAtoms(e,5)}hasCgDnaBackbone(e){return this.atomCount<11&&this.isDna()&&this.hasBackboneAtoms(e,6)}hasBackbone(e){return this.hasProteinBackbone(e)||this.hasRnaBackbone(e)||this.hasDnaBackbone(e)||this.hasCgProteinBackbone(e)||this.hasCgRnaBackbone(e)||this.hasCgDnaBackbone(e)}getAtomIndexByName(e){const t=this.atomCount,r=this.structure.atomMap,i=this.atomTypeIdList;if(Array.isArray(e))for(let o=0;o<t;++o){const s=i[o];if(e.includes(r.get(s).atomname))return o}else for(let o=0;o<t;++o){const s=i[o];if(e===r.get(s).atomname)return o}}hasAtomWithName(...e){const t=e.length;for(let r=0;r<t;++r)if(e[r]!==void 0&&this.getAtomIndexByName(e[r])===void 0)return!1;return!0}getBonds(e){return this.bonds===void 0&&(this.bonds=function(t){const r=t.structure,i=r.getAtomProxy(),o=r.getAtomProxy(),s=t.atomCount,a=t.atomOffset,l=a+s-1,c=[],u=[],d=[];if(s>500)Xe&&Be.warn("more than 500 atoms, skip residue for auto-bonding",t.qualifiedName());else if(s>50){const h=new rj(t,!0),m=t.isCg()?1.2:2.3;for(let f=a;f<l;++f){i.index=f;const v=i.covalent+m+.3,g=h.nearest(i,1/0,v*v),b=g.length;for(let S=0;S<b;++S)o.index=g[S].index,i.index<o.index&&i.connectedTo(o)&&(c.push(i.index-a),u.push(o.index-a),d.push(Kw(i.resname,i.atomname,o.atomname)))}}else for(let h=a;h<l;++h){i.index=h;for(let m=h+1;m<=l;++m)o.index=m,i.connectedTo(o)&&(c.push(h-a),u.push(m-a),d.push(Kw(i.resname,i.atomname,o.atomname)))}return{atomIndices1:c,atomIndices2:u,bondOrders:d}}(e)),this.bonds}getRings(){return this.rings===void 0&&this.calculateRings(),this.rings}getBondGraph(){return this.bondGraph===void 0&&this.calculateBondGraph(),this.bondGraph}getAromatic(e){return this.aromaticAtoms===void 0&&this.calculateAromatic(this.structure.getResidueProxy(e.residueIndex)),this.aromaticAtoms}getAromaticRings(e){return this.aromaticRings===void 0&&this.calculateAromatic(e),this.aromaticRings}calculateBondGraph(){const e=this.bondGraph={},t=this.getBonds(),r=t.atomIndices1.length,i=t.atomIndices1,o=t.atomIndices2;for(let s=0;s<r;++s){const a=i[s],l=o[s];(e[a]=e[a]||[]).push(l),(e[l]=e[l]||[]).push(a)}}calculateRings(){const e=function(t,r){const i={count:r,visited:new Int32Array(r),queue:new Int32Array(r),pred:new Int32Array(r),left:new Int32Array(Xu),right:new Int32Array(Xu),color:new Int32Array(r),currentColor:0,rings:[],atomRings:[],bonds:t};for(let o=0;o<r;o++)i.visited[o]=-1,i.pred[o]=-1;return i}(this.getBondGraph(),this.atomCount);for(let t=0;t<e.count;t++)e.visited[t]>=0||Aj(e,t);this.rings={atomRings:e.atomRings,rings:e.rings}}isAromatic(e){return this.aromaticAtoms=this.getAromatic(e),this.aromaticAtoms[e.index-e.residueAtomOffset]===1}calculateAromatic(e){const t=this.aromaticAtoms=new Uint8Array(this.atomCount),r=this.getRings().rings,i=r.map(s=>function(a){if(a.some(d=>!wj.includes(d.number)))return!1;let l=0;const c=new sn(3,a.length),u=c.data;return a.forEach(d=>{u[l+0]=d.x,u[l+1]=d.y,u[l+2]=d.z,l+=3}),new bP(c).vecC.length()<Sj}(s.map(a=>this.structure.getAtomProxy(a+e.atomOffset)))),o=this.aromaticRings=[];r.forEach((s,a)=>{i[a]&&(o.push(s),s.forEach(l=>t[l]=1))})}assignBondReferenceAtomIndices(){const e=this.getBondGraph(),t=this.getRings(),r=t.atomRings,i=t.rings,o=this.bonds,s=o.atomIndices1,a=o.atomIndices2,l=o.bondOrders,c=this.bondReferenceAtomIndices,u=o.atomIndices1.length;c.length=0;for(let d=0;d<u;++d){if(l[d]<=1)continue;let h;const m=s[d],f=a[d],v=r[m],g=r[f];if(v&&g){for(let b=0;b<v.length;b++)if(g.indexOf(v[b])!==-1){h=i[v[b]];break}}if(e[m].length>1)for(let b=0;b<e[m].length;++b){const S=e[m][b];if(S!==f&&(h===void 0||h.indexOf(S)!==-1)){c[d]=S;break}}else if(e[f].length>1)for(let b=0;b<e[f].length;++b){const S=e[f][b];if(S!==m&&(h===void 0||h.indexOf(S)!==-1)){c[d]=S;break}}}}getBondIndex(e,t){const r=this.bonds,i=r.atomIndices1,o=r.atomIndices2;let s=i.indexOf(e),a=o.indexOf(t);const l=a;for(;s!==-1;){for(;a!==-1;){if(s===a)return s;a=o.indexOf(t,a+1)}s=i.indexOf(e,s+1),a=l}}getBondReferenceAtomIndex(e,t){const r=this.getBondIndex(e,t);if(r!==void 0)return this.bondReferenceAtomIndices.length===0&&this.assignBondReferenceAtomIndices(),this.bondReferenceAtomIndices[r]}}const wj=[5,6,7,8,14,15,16,32,33,50,51,83],Sj=.05;function Cj(n,e,t){if(t<e)return;const{pred:r,color:i,left:o,right:s}=n,a=++n.currentColor;let l=e;for(let b=0;b<Xu&&(i[l]=a,l=r[l],!(l<0));b++);let c=0,u=0,d=!1,h=0;l=t;for(let b=0;b<Xu;b++){if(i[l]===a){h=l,d=!0;break}if(s[u++]=l,l=r[l],l<0)break}if(!d)return;l=e;for(let b=0;b<Xu&&(o[c++]=l,h!==l)&&(l=r[l],!(l<0));b++);const m=c+u,f=new Array(m);let v=0;for(let b=0;b<c;b++)f[v++]=o[b];for(let b=u-1;b>=0;b--)f[v++]=s[b];const g=n.rings.length;for(let b=0;b<m;++b){const S=f[b];n.atomRings[S]?n.atomRings[S].push(g):n.atomRings[S]=[g]}n.rings.push(f)}function Aj(n,e){const{bonds:t,visited:r,queue:i,pred:o}=n;r[e]=1,i[0]=e;let s=0,a=1;for(;s<a;){const l=i[s++],c=0;if(t[l]===void 0)continue;const u=t[l].length;for(let d=c;d<u;d++){const h=t[l][d];r[h]>0?o[h]!==l&&o[l]!==h&&Cj(n,l,h):(r[h]=1,i[a++]=h,o[h]=l)}}}const Xu=4;class Mj{constructor(e){this.structure=e,this.dict={},this.list=[]}add(e,t,r,i="",o){const s=function(l,c,u,d=""){return l+"|"+c.join(",")+"|"+(u?1:0)+"|"+d}(e=e.toUpperCase(),t,r,i);let a=this.dict[s];if(a===void 0){const l=new xj(this.structure,e,t,r,i,o);a=this.list.length,this.dict[s]=a,this.list.push(l)}return a}get(e){return this.list[e]}}class ry{constructor(e,t=0){this.structure=e,this.index=t,this.bondStore=e.bondStore,this._v12=new te,this._v13=new te,this._ap1=this.structure.getAtomProxy(),this._ap2=this.structure.getAtomProxy(),this._ap3=this.structure.getAtomProxy()}get atom1(){return this.structure.getAtomProxy(this.atomIndex1)}get atom2(){return this.structure.getAtomProxy(this.atomIndex2)}get atomIndex1(){return this.bondStore.atomIndex1[this.index]}set atomIndex1(e){this.bondStore.atomIndex1[this.index]=e}get atomIndex2(){return this.bondStore.atomIndex2[this.index]}set atomIndex2(e){this.bondStore.atomIndex2[this.index]=e}get bondOrder(){return this.bondStore.bondOrder[this.index]}set bondOrder(e){this.bondStore.bondOrder[this.index]=e}getOtherAtomIndex(e){return e===this.atomIndex1?this.atomIndex2:this.atomIndex1}getOtherAtom(e){return this.structure.getAtomProxy(this.getOtherAtomIndex(e.index))}getReferenceAtomIndex(){const e=this._ap1,t=this._ap2;if(e.index=this.atomIndex1,t.index=this.atomIndex2,e.residueIndex!==t.residueIndex)return;const r=e.index-e.residueAtomOffset,i=t.index-t.residueAtomOffset,o=e.residueType.getBondReferenceAtomIndex(r,i);if(o!==void 0)return o+e.residueAtomOffset;console.warn("No reference atom found",e.index,t.index)}calculateShiftDir(e=new te){const t=this._ap1,r=this._ap2,i=this._ap3,o=this._v12,s=this._v13;t.index=this.atomIndex1,r.index=this.atomIndex2;const a=this.getReferenceAtomIndex();o.subVectors(t,r).normalize(),a!==void 0?(i.index=a,s.subVectors(t,i)):s.copy(t),s.normalize();let l=o.dot(s);return 1-Math.abs(l)<1e-5&&(s.set(1,0,0),l=o.dot(s),1-Math.abs(l)<1e-5&&(s.set(0,1,0),l=o.dot(s))),e.copy(s.sub(o.multiplyScalar(l))).normalize()}qualifiedName(){return this.atomIndex1+"="+this.atomIndex2}clone(){return new ry(this.structure,this.index)}toObject(){return{atomIndex1:this.atomIndex1,atomIndex2:this.atomIndex2,bondOrder:this.bondOrder}}}class iy{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get chain(){return this.structure.getChainProxy(this.chainIndex)}get chainIndex(){return this.residueStore.chainIndex[this.index]}set chainIndex(e){this.residueStore.chainIndex[this.index]=e}get atomOffset(){return this.residueStore.atomOffset[this.index]}set atomOffset(e){this.residueStore.atomOffset[this.index]=e}get atomCount(){return this.residueStore.atomCount[this.index]}set atomCount(e){this.residueStore.atomCount[this.index]=e}get atomEnd(){return this.atomOffset+this.atomCount-1}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get resno(){return this.residueStore.resno[this.index]}set resno(e){this.residueStore.resno[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.index)}set sstruc(e){this.residueStore.setSstruc(this.index,e)}get inscode(){return this.residueStore.getInscode(this.index)}set inscode(e){this.residueStore.setInscode(this.index,e)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.index])}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get moleculeType(){return this.residueType.moleculeType}get backboneType(){return this.residueType.backboneType}get backboneStartType(){return this.residueType.backboneStartType}get backboneEndType(){return this.residueType.backboneEndType}get traceAtomIndex(){return this.residueType.traceAtomIndex+this.atomOffset}get direction1AtomIndex(){return this.residueType.direction1AtomIndex+this.atomOffset}get direction2AtomIndex(){return this.residueType.direction2AtomIndex+this.atomOffset}get backboneStartAtomIndex(){return this.residueType.backboneStartAtomIndex+this.atomOffset}get backboneEndAtomIndex(){return this.residueType.backboneEndAtomIndex+this.atomOffset}get rungEndAtomIndex(){return this.residueType.rungEndAtomIndex+this.atomOffset}get x(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.x[t];return e/this.atomCount}get y(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.y[t];return e/this.atomCount}get z(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.z[t];return e/this.atomCount}eachAtom(e,t){const r=this.atomCount,i=this.atomOffset,o=this.structure._ap,s=i+r;if(t&&t.atomOnlyTest){const a=t.atomOnlyTest;for(let l=i;l<s;++l)o.index=l,a(o)&&e(o)}else for(let a=i;a<s;++a)o.index=a,e(o)}positionToArray(e=[],t=0){return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}isProtein(){return this.residueType.moleculeType===3}isNucleic(){const e=this.residueType.moleculeType;return e===4||e===5}isRna(){return this.residueType.moleculeType===4}isDna(){return this.residueType.moleculeType===5}isCg(){const e=this.residueType.backboneType;return e===4||e===5||e===6}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return e===3||e===4||e===5}}isHetero(){return this.residueType.hetero===1}isWater(){return this.residueType.moleculeType===1}isIon(){return this.residueType.moleculeType===2}isSaccharide(){return this.residueType.moleculeType===6}isStandardAminoacid(){return this.residueType.isStandardAminoacid()}isStandardBase(){return this.residueType.isStandardBase()}isHelix(){return JE.includes(this.sstruc)}isSheet(){return QE.includes(this.sstruc)}isTurn(){return eP.includes(this.sstruc)&&this.isProtein()}getAtomType(e){return this.atomMap.get(this.atomStore.atomTypeId[e])}getResname1(){return yp[this.resname.toUpperCase()]||"X"}getBackboneType(e){switch(e){case-1:return this.residueType.backboneStartType;case 1:return this.residueType.backboneEndType;default:return this.residueType.backboneType}}getAtomIndexByName(e){let t=this.residueType.getAtomIndexByName(e);return t!==void 0&&(t+=this.atomOffset),t}hasAtomWithName(e){return this.residueType.hasAtomWithName(e)}getAtomnameList(){console.warn("getAtomnameList - might be expensive");const e=this.atomCount,t=this.atomOffset,r=new Array(e);for(let i=0;i<e;++i)r[i]=this.getAtomType(t+i).atomname;return r}connectedTo(e){const t=this.structure.getAtomProxy(this.backboneEndAtomIndex),r=this.structure.getAtomProxy(e.backboneStartAtomIndex);return!(!t||!r)&&t.connectedTo(r)}getNextConnectedResidue(){const e=this.chainStore.residueOffset[this.chainIndex],t=this.chainStore.residueCount[this.chainIndex],r=this.index+1;if(r<e+t){const i=this.structure.getResidueProxy(r);if(this.connectedTo(i))return i}else if(r===e+t){const i=this.structure.getResidueProxy(e);if(this.connectedTo(i))return i}}getPreviousConnectedResidue(e){const t=this.chainStore.residueOffset[this.chainIndex],r=this.index-1;if(r>=t){const i=W(e,this.structure.getResidueProxy());if(i.index=r,i.connectedTo(this))return i}else if(r===t-1){const i=this.chainStore.residueCount[this.chainIndex],o=W(e,this.structure.getResidueProxy());if(o.index=t+i-1,o.connectedTo(this))return o}}getBonds(){return this.residueType.getBonds(this)}getRings(){return this.residueType.getRings()}getAromaticRings(){return this.residueType.getAromaticRings(this)}qualifiedName(e=!1){let t="";return this.resname&&!e&&(t+="["+this.resname+"]"),this.resno!==void 0&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chain&&(t+=":"+this.chainname),t+="/"+this.modelIndex,t}clone(){return new iy(this.structure,this.index)}toObject(){return{index:this.index,chainIndex:this.chainIndex,atomOffset:this.atomOffset,atomCount:this.atomCount,resno:this.resno,resname:this.resname,sstruc:this.sstruc}}}class f0{constructor(e,t,r){this.structure=e,this.residueIndexStart=t,this.residueIndexEnd=r,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueCount=r-t+1;const i=this.structure.getResidueProxy(this.residueIndexStart),o=this.structure.getResidueProxy(this.residueIndexEnd);this.isPrevConnected=i.getPreviousConnectedResidue()!==void 0;const s=o.getNextConnectedResidue();this.isNextConnected=s!==void 0,this.isNextNextConnected=s!==void 0&&s.getNextConnectedResidue()!==void 0,this.isCyclic=o.connectedTo(i),this.__residueProxy=this.structure.getResidueProxy()}get chainIndex(){return this.residueStore.chainIndex[this.residueIndexStart]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}isProtein(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isProtein()}isCg(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isCg()}isNucleic(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isNucleic()}getMoleculeType(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.moleculeType}getBackboneType(e){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.getBackboneType(e)}getAtomIndexByType(e,t){this.isCyclic?e===-1?e=this.residueCount-1:e===this.residueCount&&(e=0):(e!==-1||this.isPrevConnected||(e+=1),e!==this.residueCount||this.isNextNextConnected||(e-=1));const r=this.__residueProxy;let i;switch(r.index=this.residueIndexStart+e,t){case"trace":i=r.traceAtomIndex;break;case"direction1":i=r.direction1AtomIndex;break;case"direction2":i=r.direction2AtomIndex;break;default:i=r.getAtomIndexByName(t)}return i}eachAtom(e,t){this.eachResidue(function(r){r.eachAtom(e,t)})}eachAtomN(e,t,r){const i=this.residueCount,o=new Array(e);for(let a=0;a<e;++a)o[a]=this.structure.getAtomProxy(this.getAtomIndexByType(a,r));t.apply(this,o);for(var s=e;s<i;++s){for(let a=1;a<e;++a)o[a-1].index=o[a].index;o[e-1].index=this.getAtomIndexByType(s,r),t.apply(this,o)}}eachResidue(e){const t=this.structure.getResidueProxy(),r=this.residueCount,i=this.residueIndexStart;for(let o=0;o<r;++o)t.index=i+o,e(t)}qualifiedName(){const e=this.structure.getResidueProxy(this.residueIndexStart),t=this.structure.getResidueProxy(this.residueIndexEnd);return e.qualifiedName()+" - "+t.qualifiedName()}}class oy{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get entity(){return this.structure.entityList[this.entityIndex]}get model(){return this.structure.getModelProxy(this.modelIndex)}get entityIndex(){return this.chainStore.entityIndex[this.index]}set entityIndex(e){this.chainStore.entityIndex[this.index]=e}get modelIndex(){return this.chainStore.modelIndex[this.index]}set modelIndex(e){this.chainStore.modelIndex[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.index]}set residueOffset(e){this.chainStore.residueOffset[this.index]=e}get residueCount(){return this.chainStore.residueCount[this.index]}set residueCount(e){this.chainStore.residueCount[this.index]=e}get residueEnd(){return this.residueOffset+this.residueCount-1}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get atomCount(){return this.residueCount===0?0:this.atomEnd-this.atomOffset+1}get chainname(){return this.chainStore.getChainname(this.index)}set chainname(e){this.chainStore.setChainname(this.index,e)}get chainid(){return this.chainStore.getChainid(this.index)}set chainid(e){this.chainStore.setChainid(this.index,e)}eachAtom(e,t){this.eachResidue(function(r){r.eachAtom(e,t)},t)}eachResidue(e,t){const r=this.residueCount,i=this.residueOffset,o=this.structure._rp,s=i+r;if(t&&t.test){const a=t.residueOnlyTest;if(a)for(let l=i;l<s;++l)o.index=l,a(o)&&e(o);else for(let l=i;l<s;++l)o.index=l,e(o)}else for(let a=i;a<s;++a)o.index=a,e(o)}eachResidueN(e,t){const r=this.residueCount,i=this.residueOffset,o=i+r;if(r<e)return;const s=new Array(e);for(let a=0;a<e;++a)s[a]=this.structure.getResidueProxy(i+a);t.apply(this,s);for(let a=i+e;a<o;++a){for(let l=0;l<e;++l)s[l].index+=1;t.apply(this,s)}}eachPolymer(e,t){let r=0,i=0;const o=t?t.residueOnlyTest:void 0,s=this.model.structure,a=this.residueCount,l=this.residueOffset,c=l+a,u=this.structure.getResidueProxy(),d=this.structure.getResidueProxy(l),h=this.structure.getAtomProxy(),m=this.structure.getAtomProxy();let f=!0;for(let v=l+1;v<c;++v){u.index=d.index,d.index=v;const g=f?u.backboneEndType:u.backboneType,b=d.backboneType;f&&(r=u.index,f=!1),i=d.index,g!==ol&&g===b?(h.index=u.backboneEndAtomIndex,m.index=d.backboneStartAtomIndex,h&&m&&h.connectedTo(m)&&(!o||o(u)&&o(d))||(u.index-r>1&&e(new f0(s,r,u.index)),r=i)):(g!==ol&&u.index-r>1&&e(new f0(s,r,u.index)),r=i)}i-r>1&&this.structure.getResidueProxy(r).backboneEndType&&e(new f0(s,r,i))}qualifiedName(){return":"+this.chainname+"/"+this.modelIndex}clone(){return new oy(this.structure,this.index)}toObject(){return{index:this.index,residueOffset:this.residueOffset,residueCount:this.residueCount,chainname:this.chainname}}}class sy{constructor(e,t=0){this.structure=e,this.index=t,this.modelStore=e.modelStore,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get chainOffset(){return this.modelStore.chainOffset[this.index]}set chainOffset(e){this.modelStore.chainOffset[this.index]=e}get chainCount(){return this.modelStore.chainCount[this.index]}set chainCount(e){this.modelStore.chainCount[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.chainOffset]}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get chainEnd(){return this.chainOffset+this.chainCount-1}get residueEnd(){return this.chainStore.residueOffset[this.chainEnd]+this.chainStore.residueCount[this.chainEnd]-1}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get residueCount(){return this.chainCount===0?0:this.residueEnd-this.residueOffset+1}get atomCount(){return this.residueCount===0?0:this.atomEnd-this.atomOffset+1}eachAtom(e,t){this.eachChain(function(r){r.eachAtom(e,t)},t)}eachResidue(e,t){this.eachChain(function(r){r.eachResidue(e,t)},t)}eachPolymer(e,t){if(t&&t.chainOnlyTest){const r=t.chainOnlyTest;this.eachChain(function(i){r(i)&&i.eachPolymer(e,t)})}else this.eachChain(function(r){r.eachPolymer(e,t)})}eachChain(e,t){const r=this.chainCount,i=this.chainOffset,o=this.structure._cp,s=i+r;if(t&&t.test){const a=t.chainOnlyTest;if(a)for(let l=i;l<s;++l)o.index=l,a(o)&&e(o);else for(let l=i;l<s;++l)o.index=l,e(o)}else for(let a=i;a<s;++a)o.index=a,e(o)}qualifiedName(){return"/"+this.index}clone(){return new sy(this.structure,this.index)}toObject(){return{index:this.index,chainOffset:this.chainOffset,chainCount:this.chainCount}}}class vo{constructor(e="",t=""){this.signals={refreshed:new Ft.Signal},this.init(e,t)}init(e,t){this.name=e,this.path=t,this.title="",this.id="",this.data={structure:this,"@spatialLookup":void 0,"@valenceModel":void 0},this.header={},this.extraData={},this.atomSetCache={},this.atomSetDict={},this.biomolDict={},this.entityList=[],this.unitcell=void 0,this.frames=[],this.boxes=[],this.validation=void 0,this.bondStore=new Of(0),this.backboneBondStore=new Of(0),this.rungBondStore=new Of(0),this.atomStore=new KW(0),this.residueStore=new ZW(0),this.chainStore=new JW(0),this.modelStore=new QW(0),this.atomMap=new _j(this),this.residueMap=new Mj(this),this.chemCompMap=void 0,this.bondHash=void 0,this.spatialHash=void 0,this.atomSet=void 0,this.bondSet=void 0,this.center=new te,this.boundingBox=new Nn,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy()}get type(){return"Structure"}finalizeAtoms(){this.atomSet=this.getAtomSet(),this.atomCount=this.atomStore.count,this.boundingBox=this.getBoundingBox(void 0,this.boundingBox),this.center=this.boundingBox.getCenter(new te),this.spatialHash=new xd(this.atomStore,this.boundingBox)}finalizeBonds(){this.bondSet=this.getBondSet(),this.bondCount=this.bondStore.count,this.bondHash=new YW(this.bondStore,this.atomStore.count),this.atomSetCache={},this.atomSetDict.rung||(this.atomSetDict.rung=this.getAtomSet(!1));for(let e in this.atomSetDict)this.atomSetCache["__"+e]=this.atomSetDict[e].clone()}getBondProxy(e){return new ry(this,e)}getAtomProxy(e){return new Sm(this,e)}getResidueProxy(e){return new iy(this,e)}getChainProxy(e){return new oy(this,e)}getModelProxy(e){return new sy(this,e)}getBondSet(){const e=this.bondStore.count,t=new Qn(e),r=this.atomSet;if(r)if(r.isAllSet())t.setAll();else if(r.isAllClear())t.clearAll();else{const i=this.getBondProxy();for(let o=0;o<e;++o)i.index=o,r.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getBackboneBondSet(){const e=this.backboneBondStore.count,t=new Qn(e),r=this.atomSetCache.__backbone;if(r){const i=this.getBondProxy();i.bondStore=this.backboneBondStore;for(let o=0;o<e;++o)i.index=o,r.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getRungBondSet(){const e=this.rungBondStore.count,t=new Qn(e),r=this.atomSetCache.__rung;if(r){const i=this.getBondProxy();i.bondStore=this.rungBondStore;for(let o=0;o<e;++o)i.index=o,r.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getAtomSet(e){const t=this.atomStore.count;if(e===void 0)return new Qn(t,!0);if(e instanceof Qn)return e;if(e===!0)return new Qn(t,!0);if(e&&e.test){const r=e.string;if(r in this.atomSetCache)return this.atomSetCache[r];if(r==="")return new Qn(t,!0);{const i=new Qn(t);return this.eachAtom(function(o){i.set(o.index)},e),this.atomSetCache[r]=i,i}}return e===!1?new Qn(t):new Qn(t,!0)}getAtomSetWithinSelection(e,t){const r=this.spatialHash,i=this.getAtomSet(!1),o=this.getAtomProxy();return r&&this.getAtomSet(e).forEach(function(s){o.index=s,r.within(o.x,o.y,o.z,t).forEach(function(a){i.set(a)})}),i}getAtomSetWithinPoint(e,t){const r=e,i=this.getAtomSet(!1);return this.spatialHash&&this.spatialHash.within(r.x,r.y,r.z,t).forEach(function(o){i.set(o)}),i}getAtomSetWithinVolume(e,t,r,i,o){const s=new jo(e,r,i,o),a=s.getDataPosition(),l=a.length,c=s.matrix.getMaxScaleOnAxis(),u=this.getAtomSet(!1);if(!this.spatialHash)return u;for(let d=0;d<l;d+=3)this.spatialHash.within(a[d],a[d+1],a[d+2],c).forEach(function(h){u.set(h)});return u}getAtomSetWithinGroup(e){const t=this.atomStore.residueIndex,r=this.getAtomSet(!1),i=this.getResidueProxy();return this.getAtomSet(e).forEach(function(o){i.index=t[o];for(let s=i.atomOffset;s<=i.atomEnd;++s)r.set(s)}),r}getSelection(){}getStructure(){return this}eachEntity(e,t){this.entityList.forEach(function(r){t!==void 0&&r.getEntityType()!==t||e(r)})}eachBond(e,t){const r=this.getBondProxy();let i;if(t&&t.test&&(i=this.getBondSet(),this.bondSet&&i.intersection(this.bondSet)),i)i.forEach(function(o){r.index=o,e(r)});else{const o=this.bondStore.count;for(let s=0;s<o;++s)r.index=s,e(r)}}eachAtom(e,t){if(t&&t.test)this.eachModel(function(r){r.eachAtom(e,t)},t);else{const r=this.atomStore.count,i=this.getAtomProxy();for(let o=0;o<r;++o)i.index=o,e(i)}}eachResidue(e,t){if(t&&t.test){const r=this.modelStore.count,i=this.getModelProxy(),o=t.modelOnlyTest;if(o)for(let s=0;s<r;++s)i.index=s,o(i)&&i.eachResidue(e,t);else for(let s=0;s<r;++s)i.index=s,i.eachResidue(e,t)}else{const r=this.residueStore.count,i=this.getResidueProxy();for(let o=0;o<r;++o)i.index=o,e(i)}}eachResidueN(e,t){const r=this.residueStore.count;if(r<e)return;const i=new Array(e);for(let o=0;o<e;++o)i[o]=this.getResidueProxy(o);t.apply(this,i);for(let o=e;o<r;++o){for(let s=0;s<e;++s)i[s].index+=1;t.apply(this,i)}}eachPolymer(e,t){if(t&&t.modelOnlyTest){const r=t.modelOnlyTest;this.eachModel(function(i){r(i)&&i.eachPolymer(e,t)})}else this.eachModel(function(r){r.eachPolymer(e,t)})}eachChain(e,t){if(t&&t.test)this.eachModel(function(r){r.eachChain(e,t)});else{const r=this.chainStore.count,i=this.getChainProxy();for(let o=0;o<r;++o)i.index=o,e(i)}}eachModel(e,t){const r=this.modelStore.count,i=this.getModelProxy();if(t&&t.test){const o=t.modelOnlyTest;if(o)for(let s=0;s<r;++s)i.index=s,o(i)&&e(i);else for(let s=0;s<r;++s)i.index=s,e(i)}else for(let o=0;o<r;++o)i.index=o,e(i)}getAtomData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const r=t.what,i=W(t.atomSet,this.atomSet);let o,s;const a={},l=this.getAtomProxy(),c=i.getSize();r&&!r.position||(a.position=new Float32Array(3*c)),r&&!r.color||!t.colorParams||(a.color=new Float32Array(3*c),s=Xt.getScheme(t.colorParams)),r&&!r.picking||(a.picking=new gl(new Float32Array(c),this.getStructure())),r&&!r.radius||(a.radius=new Float32Array(c),o=new is(t.radiusParams)),r&&!r.index||(a.index=new Uint32Array(c));const{position:u,color:d,picking:h,radius:m,index:f}=a;return i.forEach((v,g)=>{const b=3*g;l.index=v,u&&l.positionToArray(u,b),d&&s.atomColorToArray(l,d,b),h&&(h.array[g]=v),m&&(m[g]=o.atomRadius(l)),f&&(f[g]=v)}),a}getBondData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const r=t.what,i=W(t.bondSet,this.bondSet),o=W(t.multipleBond,"off"),s=o!=="off",a=o==="offset",l=W(t.bondScale,.4),c=W(t.bondSpacing,1);let u,d;const h={},m=this.getBondProxy();t.bondStore&&(m.bondStore=t.bondStore);const f=this.getAtomProxy(),v=this.getAtomProxy();let g;if(s){const F=m.bondStore.bondOrder;g=0,i.forEach(function(H){g+=F[H]})}else g=i.getSize();r&&!r.position||(h.position1=new Float32Array(3*g),h.position2=new Float32Array(3*g)),r&&!r.color||!t.colorParams||(h.color=new Float32Array(3*g),h.color2=new Float32Array(3*g),d=Xt.getScheme(t.colorParams)),r&&!r.picking||(h.picking=new sP(new Float32Array(g),this.getStructure(),t.bondStore)),(!r||r.radius||s&&r.position)&&(u=new is(t.radiusParams)),r&&!r.radius||(h.radius=new Float32Array(g),t.radius2&&(h.radius2=new Float32Array(g)));const{position1:b,position2:S,color:p,color2:y,picking:w,radius:x,radius2:_}=h;let A,C,T,I,M,P,E=0;const R=new te,B=new te,L=new te;return i.forEach(F=>{if(C=3*E,m.index=F,f.index=m.atomIndex1,v.index=m.atomIndex2,I=m.bondOrder,b)if(s&&I>1){const H=u.atomRadius(f);P=H*l/(.5*I),m.calculateShiftDir(L),a?(M=2*c*H,L.multiplyScalar(M),L.negate(),B.subVectors(v,f).multiplyScalar(Math.max(.1,M/1.88)),f.positionToArray(b,C),v.positionToArray(S,C),I>=2&&(R.addVectors(f,L).add(B).toArray(b,C+3),R.addVectors(v,L).sub(B).toArray(S,C+3),I>=3&&(R.subVectors(f,L).add(B).toArray(b,C+6),R.subVectors(v,L).sub(B).toArray(S,C+6)))):(M=(c-l)*H,L.multiplyScalar(M),I===2?(R.addVectors(f,L).toArray(b,C),R.subVectors(f,L).toArray(b,C+3),R.addVectors(v,L).toArray(S,C),R.subVectors(v,L).toArray(S,C+3)):I===3?(f.positionToArray(b,C),R.addVectors(f,L).toArray(b,C+3),R.subVectors(f,L).toArray(b,C+6),v.positionToArray(S,C),R.addVectors(v,L).toArray(S,C+3),R.subVectors(v,L).toArray(S,C+6)):(f.positionToArray(b,C),v.positionToArray(S,C)))}else f.positionToArray(b,C),v.positionToArray(S,C);if(p&&y&&(d.bondColorToArray(m,1,p,C),d.bondColorToArray(m,0,y,C),s&&I>1))for(A=1;A<I;++A)T=3*A+C,gw(p,C,T,3),gw(y,C,T,3);if(w&&w.array&&(w.array[E]=F,s&&I>1))for(A=1;A<I;++A)w.array[E+A]=F;if(x&&(x[E]=u.atomRadius(f),s&&I>1))for(P=x[E]*l/(a?1:.5*I),A=a?1:0;A<I;++A)x[E+A]=P;if(_&&(_[E]=u.atomRadius(v),s&&I>1))for(P=_[E]*l/(a?1:.5*I),A=a?1:0;A<I;++A)_[E+A]=P;E+=s?I:1}),h}getBackboneAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__backbone},e),this.getAtomData(e)}getBackboneBondData(e){return e=Object.assign({bondSet:this.getBackboneBondSet(),bondStore:this.backboneBondStore},e),this.getBondData(e)}getRungAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__rung},e),this.getAtomData(e)}getRungBondData(e){return e=Object.assign({bondSet:this.getRungBondSet(),bondStore:this.rungBondStore},e),this.getBondData(e)}getBoundingBox(e,t){Xe&&Be.time("getBoundingBox"),t=t||new Nn;let r=1/0,i=1/0,o=1/0,s=-1/0,a=-1/0,l=-1/0;return this.eachAtom(c=>{const u=c.x,d=c.y,h=c.z;u<r&&(r=u),d<i&&(i=d),h<o&&(o=h),u>s&&(s=u),d>a&&(a=d),h>l&&(l=h)},e),t.min.set(r,i,o),t.max.set(s,a,l),Xe&&Be.timeEnd("getBoundingBox"),t}getPrincipalAxes(e){Xe&&Be.time("getPrincipalAxes");let t=0;const r=new sn(3,this.atomCount),i=r.data;return this.eachAtom(o=>{i[t+0]=o.x,i[t+1]=o.y,i[t+2]=o.z,t+=3},e),Xe&&Be.timeEnd("getPrincipalAxes"),new bP(r)}atomCenter(e){return e?this.getBoundingBox(e).getCenter(new te):this.center.clone()}hasCoords(){if(this._hasCoords===void 0){const e=this.atomStore;this._hasCoords=Rf(e.x)!==0||Pf(e.x)!==0||Rf(e.y)!==0||Pf(e.y)!==0||Rf(e.z)!==0||Pf(e.z)!==0||e.count/this.modelStore.count==1}return this._hasCoords}getSequence(e){const t=[],r=this.getResidueProxy();return this.eachAtom(function(i){r.index=i.residueIndex,i.index===r.traceAtomIndex&&t.push(r.getResname1())},e),t}getAtomIndices(e){if(e&&e.string){const t=[];return this.eachAtom(function(r){t.push(r.index)},e),new Uint32Array(t)}{const t={what:{index:!0}};return this.getAtomData(t).index}}getChainnameCount(e){const t=new Set;return this.eachChain(function(r){r.residueCount&&t.add(r.chainname)},e),t.size}updatePosition(e,t=!0){let r=0;this.eachAtom(function(i){i.positionFromArray(e,r),r+=3},void 0),this._hasCoords=void 0,t&&this.refreshPosition()}refreshPosition(){this.getBoundingBox(void 0,this.boundingBox),this.boundingBox.getCenter(this.center),this.spatialHash=new xd(this.atomStore,this.boundingBox),this.signals.refreshed.dispatch(this)}dispose(){this.frames&&(this.frames.length=0),this.boxes&&(this.boxes.length=0),this.bondStore.dispose(),this.backboneBondStore.dispose(),this.rungBondStore.dispose(),this.atomStore.dispose(),this.residueStore.dispose(),this.chainStore.dispose(),this.modelStore.dispose(),delete this.bondSet,delete this.atomSet}}const Jw=new Nn,p0=[ym,rl,_m,il,Ec,vm,Tc,bm,bp,xm,yd,_d],Tj={aspectRatio:1.5,sphereDetail:2,radialSegments:50,disableImpostor:!1,openEnded:!1,dashedCylinder:!1,labelParams:{},pointSize:2,sizeAttenuation:!1,useTexture:!0,linewidth:2};class Ej{constructor(e="shape",t={}){this.boundingBox=new Nn,this.bufferList=[],this.meshCount=0,this._primitiveData={},this.name=e,this.parameters=hi(t,Tj),p0.forEach(r=>{Object.keys(r.fields).forEach(i=>{this._primitiveData[r.getShapeKey(i)]=[]}),this._primitiveData[r.getShapeKey("name")]=[]})}addBuffer(e){this.bufferList.push(e);const t=e.geometry;return t.boundingBox||t.computeBoundingBox(),this.boundingBox.union(t.boundingBox),this}addMesh(e,t,r,i,o){let s;e=Xg(e),t=Xg(t),Array.isArray(r)&&(r=To(r,e.length)),i&&(i=Xg(i)),s=i===void 0||i.length==0?{position:e,color:t,index:r}:{position:e,color:t,index:r,normal:i};const a=new IW(this,Object.assign({serial:this.meshCount,name:o},s)),l=new rs(Object.assign({picking:a},s));return this.bufferList.push(l),Jw.setFromArray(e),this.boundingBox.union(Jw),this.meshCount+=1,this}addSphere(e,t,r,i){return Tc.objectToShape(this,{position:e,color:t,radius:r,name:i}),this}addEllipsoid(e,t,r,i,o,s){return Ec.objectToShape(this,{position:e,color:t,radius:r,majorAxis:i,minorAxis:o,name:s}),this}addTorus(e,t,r,i,o,s){return xm.objectToShape(this,{position:e,color:t,radius:r,majorAxis:i,minorAxis:o,name:s}),this}addCylinder(e,t,r,i,o){return il.objectToShape(this,{position1:e,position2:t,color:r,radius:i,name:o}),this}addCone(e,t,r,i,o){return _m.objectToShape(this,{position1:e,position2:t,color:r,radius:i,name:o}),this}addArrow(e,t,r,i,o){return ym.objectToShape(this,{position1:e,position2:t,color:r,radius:i,name:o}),this}addBox(e,t,r,i,o,s){return rl.objectToShape(this,{position:e,color:t,size:r,heightAxis:i,depthAxis:o,name:s}),this}addOctahedron(e,t,r,i,o,s){return vm.objectToShape(this,{position:e,color:t,size:r,heightAxis:i,depthAxis:o,name:s}),this}addTetrahedron(e,t,r,i,o,s){return bm.objectToShape(this,{position:e,color:t,size:r,heightAxis:i,depthAxis:o,name:s}),this}addText(e,t,r,i){return bp.objectToShape(this,{position:e,color:t,size:r,text:i}),this}addPoint(e,t,r){return yd.objectToShape(this,{position:e,color:t,name:r}),this}addWideline(e,t,r,i,o){return this.parameters.linewidth=i,_d.objectToShape(this,{position1:e,position2:t,color:r,name:o}),this}addLabel(e,t,r,i){return console.warn("Shape.addLabel is deprecated, use .addText instead"),this.addText(e,t,r,i)}getBufferList(){const e=[];return p0.forEach(t=>{this._primitiveData[t.getShapeKey("color")].length&&e.push(t.bufferFromShape(this,this.parameters))}),this.bufferList.concat(e)}dispose(){this.bufferList.forEach(function(e){e.dispose()}),this.bufferList.length=0,p0.forEach(e=>{Object.keys(e.fields).forEach(t=>{this._primitiveData[e.getShapeKey(t)].length=0}),this._primitiveData[e.getShapeKey("name")].length=0})}get center(){return this._center||(this._center=this.boundingBox.getCenter(new te)),this._center}get type(){return"Shape"}}class Qw extends $d{constructor(e,t,r){Array.isArray(e)||(e=[e]),super(e,t,r),this.type="buffer",this.parameters=Object.assign({},this.parameters,{colorScheme:null,colorScale:null,colorValue:null,colorDomain:null,colorMode:null}),this.buffer=e,this.init(r)}init(e){super.init(e),this.build()}create(){this.bufferList.push.apply(this.bufferList,this.buffer)}attach(e){this.bufferList.forEach(t=>{this.viewer.add(t),t.setParameters(this.getBufferParams())}),this.setVisibility(this.visible),e()}}const Yh=new at,eS=new qt;class oa extends rs{constructor(e,t={},r){super(function(l,c){const u=c.attributes.position.array,d=c.index?c.index.array:void 0,h=l.position.length/3,m=u.length/3,f=h*m,v=new Float32Array(3*f),g=new Float32Array(3*f),b=new Float32Array(3*f);let S;return d&&(S=To(h*d.length,f)),{position:v,color:b,index:S,normal:g,primitiveId:l.primitiveId||av(h,m),picking:l.picking}}(e,r),t),this.updateNormals=!1;const i=r.attributes.position.array,o=r.attributes.normal.array,s=r.index?r.index.array:void 0;this.geoPosition=i,this.geoNormal=o,this.geoIndex=s,this.positionCount=e.position.length/3,this.geoPositionCount=i.length/3,this.transformedGeoPosition=new Float32Array(3*this.geoPositionCount),this.transformedGeoNormal=new Float32Array(3*this.geoPositionCount);const a=this.geometry.attributes;if(this.meshPosition=a.position.array,this.meshColor=a.color.array,this.meshNormal=a.normal.array,this.setAttributes(e),s){const l=this.geometry.getIndex();if(!l)return void Be.error("Index is null");this.meshIndex=l.array,this.makeIndex()}}setAttributes(e={},t=!1){const r=this.geometry.attributes;let i,o,s,a,l,c,u,d,h;const m=this.updateNormals;e.position&&(i=e.position,s=this.geoPosition,u=this.meshPosition,l=this.transformedGeoPosition,r.position.needsUpdate=!0,(m||t)&&(a=this.geoNormal,h=this.meshNormal,c=this.transformedGeoNormal,r.normal.needsUpdate=!0)),e.color&&(o=e.color,d=this.meshColor,r.color.needsUpdate=!0);const f=this.positionCount,v=this.geoPositionCount;for(let g=0;g<f;++g){let b,S;const p=g*v*3,y=3*g;if(i&&l&&u&&h&&s&&a&&(l.set(s),Yh.makeTranslation(i[y],i[y+1],i[y+2]),this.applyPositionTransform(Yh,g,y),mm(Yh.elements,l),u.set(l,p),m&&c?(c.set(a),eS.getNormalMatrix(Yh),Jb(eS.elements,c),h.set(c,p)):t&&h.set(a,p)),o&&d)for(b=0;b<v;++b)S=p+3*b,d[S]=o[y],d[S+1]=o[y+1],d[S+2]=o[y+2]}}makeIndex(){const e=this.geoIndex,t=this.meshIndex;if(!e)return;const r=this.positionCount,i=this.geoPositionCount,o=3*(e.length/3);for(let s=0;s<r;++s){const a=s*o,l=a+o;t.set(e,a);for(let c=a;c<l;++c)t[c]+=s*i}}}const tS=new te,SP=Object.assign({sphereDetail:1},zr);class Pj extends oa{constructor(e,t={}){super(e,t,new hm(1,W(t.sphereDetail,1))),this.setAttributes(e,!0)}get defaultParameters(){return SP}applyPositionTransform(e,t){const r=this._radius[t];tS.set(r,r,r),e.scale(tS)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}Qt.add("shader/SphereImpostor.vert",`uniform mat4 projectionMatrixInverse;
uniform float clipNear;
varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;
attribute vec2 mapping;
attribute float radius;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#endif
#include matrix_scale
const mat4 D = mat4(
1.0, 0.0, 0.0, 0.0,
0.0, 1.0, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
0.0, 0.0, 0.0, -1.0
);
mat4 transposeM( in mat4 inMatrix ) {
vec4 i0 = inMatrix[0];
vec4 i1 = inMatrix[1];
vec4 i2 = inMatrix[2];
vec4 i3 = inMatrix[3];
mat4 outMatrix = mat4(
vec4(i0.x, i1.x, i2.x, i3.x),
vec4(i0.y, i1.y, i2.y, i3.y),
vec4(i0.z, i1.z, i2.z, i3.z),
vec4(i0.w, i1.w, i2.w, i3.w)
);
return outMatrix;
}
void ComputePointSizeAndPositionInClipCoordSphere(){
vec2 xbc;
vec2 ybc;
mat4 T = mat4(
radius, 0.0, 0.0, 0.0,
0.0, radius, 0.0, 0.0,
0.0, 0.0, radius, 0.0,
position.x, position.y, position.z, 1.0
);
mat4 R = transposeM( projectionMatrix * modelViewMatrix * T );
float A = dot( R[ 3 ], D * R[ 3 ] );
float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );
float C = dot( R[ 0 ], D * R[ 0 ] );
xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;
A = dot( R[ 3 ], D * R[ 3 ] );
B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );
C = dot( R[ 1 ], D * R[ 1 ] );
ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
float sy = abs( ybc[ 0 ] - ybc[ 1 ] ) * 0.5;
gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );
gl_Position.xy -= mapping * vec2( sx, sy );
gl_Position.xy *= gl_Position.w;
}
void main(void){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
vRadius = radius * matrixScale( modelViewMatrix );
vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
mvPosition.z -= vRadius;
gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );
ComputePointSizeAndPositionInClipCoordSphere();
vRadiusSq = vRadius * vRadius;
vec4 vPoint4 = projectionMatrixInverse * gl_Position;
vPoint = vPoint4.xyz / vPoint4.w;
vPointViewPosition = -mvPosition.xyz / mvPosition.w;
}`),Qt.add("shader/SphereImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform mat4 projectionMatrix;
uniform float ortho;
varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool flag2 = false;
bool interior = false;
vec3 cameraPos;
vec3 cameraNormal;
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
float calcClip( vec3 cameraPos ){
return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
bool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){
vec3 cameraSpherePos = -vPointViewPosition;
cameraSpherePos.z += vRadius;
vec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );
vec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );
vec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );
float B = dot( rayDirection, cameraSphereDir );
float det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );
if( det < 0.0 ){
discard;
return false;
}
float sqrtDet = sqrt( det );
float posT = mix( B + sqrtDet, B + sqrtDet, ortho );
float negT = mix( B - sqrtDet, sqrtDet - B, ortho );
cameraPos = rayDirection * negT + rayOrigin;
#ifdef NEAR_CLIP
if( calcDepth( cameraPos ) <= 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
}else if( calcClip( cameraPos ) > 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
flag2 = true;
}
#else
if( calcDepth( cameraPos ) <= 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
}
#endif
cameraNormal = normalize( cameraPos - cameraSpherePos );
cameraNormal *= float(!interior) * 2.0 - 1.0;
return !interior;
}
void main(void){
bool flag = Impostor( cameraPos, cameraNormal );
#ifdef NEAR_CLIP
if( calcClip( cameraPos ) > 0.0 )
discard;
#endif
gl_FragDepthEXT = calcDepth( cameraPos );
if( !flag ){
#ifdef NEAR_CLIP
if( flag2 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );
}else if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
#else
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
#endif
}
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vNormal = cameraNormal;
vec3 vViewPosition = -cameraPos;
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
#include normal_fragment_begin
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);class ay extends Eo{constructor(e,t,r={}){super(t,r),this.index=To(this.indexSize,this.attributeSize),this.makeIndex(),this.initIndex(this.index),this.addAttributes({mapping:{type:e,value:null}}),this.setAttributes({primitiveId:Wc(this.size)})}get attributeSize(){return this.size*this.mappingSize}get indexSize(){return this.size*this.mappingIndicesSize}addAttributes(e){const t={};for(const r in e){const i=e[r];t[r]={type:i.type,value:null}}super.addAttributes(t)}getAttributeIndex(e){return 3*e*this.mappingSize}setAttributes(e){e&&!e.position&&e.position1&&e.position2&&(e.position=So(e.position1,e.position2));const t=this.size,r=this.mappingSize,i=this.geometry.attributes;let o,s,a,l,c,u,d;for(const h in e)if(h!=="index"&&h!=="picking"){s=e[h],o=i[h],a=o.itemSize,l=o.array;for(let m=0;m<t;++m){c=m*a,u=c*r;for(let f=0;f<r;++f){d=u+a*f;for(let v=0;v<a;++v)l[d+v]=s[c+v]}}o.needsUpdate=!0}}makeMapping(){const e=this.size,t=this.mapping,r=this.mappingSize,i=this.mappingItemSize,o=this.geometry.attributes.mapping.array;for(let s=0;s<e;s++)o.set(t,s*i*r)}makeIndex(){const e=this.size,t=this.mappingSize,r=this.mappingIndices,i=this.mappingIndicesSize,o=this.index;for(let s=0;s<e;s++){const a=s*i,l=s*t;o.set(r,a);for(let c=0;c<i;++c)o[a+c]+=l}}}const Rj=new Float32Array([-1,1,-1,-1,1,1,1,-1]),Ij=new Uint16Array([0,1,2,1,3,2]);class ly extends ay{constructor(e,t={}){super("v2",e,t)}get mapping(){return Rj}get mappingIndices(){return Ij}get mappingIndicesSize(){return 6}get mappingSize(){return 4}get mappingItemSize(){return 2}}class Dj extends ly{constructor(e,t={}){super(e,t),this.isImpostor=!0,this.vertexShader="SphereImpostor.vert",this.fragmentShader="SphereImpostor.frag",this.addUniforms({projectionMatrixInverse:{value:new at},ortho:{value:0}}),this.addAttributes({radius:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}}Object.assign({disableImpostor:!1},SP);const sa=class{constructor(n,e){return!wo||e&&e.disableImpostor?new Pj(n,e):new Dj(n,e)}};function Lj(n,e,t,r){const i=t-n,o=r-e;return Math.sqrt(i*i+o*o)}pi.add("sphere",sa),Qt.add("shader/Point.vert",`uniform float clipNear;
uniform float clipRadius;
uniform vec3 clipCenter;
uniform float size;
uniform float canvasHeight;
uniform float pixelRatio;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
varying vec3 vViewPosition;
#endif
#include common
void main(){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
#include begin_vertex
#include project_vertex
#ifdef USE_SIZEATTENUATION
gl_PointSize = size * pixelRatio * ( ( canvasHeight / 2.0 ) / -mvPosition.z );
#else
gl_PointSize = size * pixelRatio;
#endif
#ifndef PICKING
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
#include radiusclip_vertex
}`),Qt.add("shader/Point.frag",`uniform vec3 diffuse;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#ifdef USE_MAP
uniform sampler2D map;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include alphatest_pars_fragment
varying vec3 vViewPosition;
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
#ifdef USE_MAP
if( texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) ).a < 0.5 )
discard;
#endif
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, 1.0 );
#ifdef USE_MAP
diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );
#endif
#include color_fragment
#include alphatest_fragment
outgoingLight = diffuseColor.rgb;
gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Fj=Object.assign({pointSize:1,sizeAttenuation:!0,sortParticles:!1,alphaTest:.5,useTexture:!1,forceTransparent:!1,edgeBleach:0},zr),Oj=Object.assign({pointSize:{uniform:"size"},sizeAttenuation:{updateShader:!0},sortParticles:{},alphaTest:{uniform:!0},useTexture:{updateShader:!0},forceTransparent:{},edgeBleach:{uniform:!0}},vl);class cy extends Eo{constructor(e,t={}){super(e,t),this.parameterTypes=Oj,this.vertexShader="Point.vert",this.fragmentShader="Point.frag",this.isPoint=!0,this.addUniforms({size:{value:this.parameters.pointSize},canvasHeight:{value:1},pixelRatio:{value:1},map:{value:null},alphaTest:{value:this.parameters.alphaTest}})}get defaultParameters(){return Fj}makeMaterial(){super.makeMaterial(),this.makeTexture();const e=this.material,t=this.wireframeMaterial,r=this.pickingMaterial;e.uniforms.map.value=this.tex,e.needsUpdate=!0,t.uniforms.map.value=this.tex,t.needsUpdate=!0,r.uniforms.map.value=this.tex,r.needsUpdate=!0}makeTexture(){this.tex&&this.tex.dispose(),this.tex=function(e){const t=e||{},r=W(t.width,256),i=W(t.height,256),o=[r/2,i/2],s=Math.min(r/2,i/2),a=W(t.delta,1/(s+1))*s;let l=0,c=0;const u=new Uint8Array(r*i*4);for(let h=0,m=u.length;h<m;h+=4){const f=1-Nd(s-a,s,Lj(l,c,o[0],o[1]));u[h]=255*f,u[h+1]=255*f,u[h+2]=255*f,u[h+3]=255*f,++l===r&&(l=0,c++)}const d=new nv(u,r,i);return d.needsUpdate=!0,d}({delta:this.parameters.edgeBleach})}getDefines(e){const t=super.getDefines(e);return this.parameters.sizeAttenuation&&(t.USE_SIZEATTENUATION=1),this.parameters.useTexture&&(t.USE_MAP=1),this.parameters.alphaTest>0&&this.parameters.alphaTest<=1&&(t.USE_ALPHATEST=1),t}setUniforms(e){e&&e.edgeBleach!==void 0&&(this.makeTexture(),e.map=this.tex),super.setUniforms(e)}dispose(){super.dispose(),this.tex&&this.tex.dispose()}}pi.add("point",cy);class nS extends $d{constructor(e,t,r){super(e,t,r),this.type="dot",this.parameters=Object.assign({thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdOut:{type:"boolean",rebuild:!0},dotType:{type:"select",rebuild:!0,options:{"":"",sphere:"sphere",point:"point"}},radiusType:{type:"select",options:{"":"",value:"value","abs-value":"abs-value","value-min":"value-min",deviation:"deviation",size:"size"}},radius:{type:"number",precision:3,max:10,min:.001,property:"size"},scale:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,disableImpostor:!0,pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{colorScheme:{type:"select",update:"color",options:{"":"",value:"value",uniform:"uniform",random:"random"}}}),e instanceof Wr?(this.surface=void 0,this.volume=new jo(e)):(this.surface=e,this.volume=void 0),this.init(r)}init(e){var t=e||{};t.colorScheme=W(t.colorScheme,"uniform"),t.colorValue=W(t.colorValue,14540253),this.thresholdType=W(t.thresholdType,"sigma"),this.thresholdMin=W(t.thresholdMin,2),this.thresholdMax=W(t.thresholdMax,1/0),this.thresholdOut=W(t.thresholdOut,!1),this.dotType=W(t.dotType,"point"),this.radius=W(t.radius,.1),this.scale=W(t.scale,1),this.pointSize=W(t.pointSize,1),this.sizeAttenuation=W(t.sizeAttenuation,!0),this.sortParticles=W(t.sortParticles,!1),this.useTexture=W(t.useTexture,!1),this.alphaTest=W(t.alphaTest,.5),this.forceTransparent=W(t.forceTransparent,!1),this.edgeBleach=W(t.edgeBleach,0),super.init(t),this.build()}attach(e){this.bufferList.forEach(t=>{this.viewer.add(t)}),this.setVisibility(this.visible),e()}create(){var e={};if(this.volume){var t,r,i=this.volume;this.thresholdType==="sigma"?(t=i.getValueForSigma(this.thresholdMin),r=i.getValueForSigma(this.thresholdMax)):(t=this.thresholdMin,r=this.thresholdMax),i.setFilter(t,r,this.thresholdOut),Object.assign(e,{position:i.getDataPosition(),color:i.getDataColor(this.getColorParams())}),this.dotType==="sphere"&&Object.assign(e,{radius:i.getDataSize(this.radius,this.scale),picking:i.getDataPicking()})}else{var o=this.surface;Object.assign(e,{position:o.getPosition(),color:o.getColor(this.getColorParams())}),this.dotType==="sphere"&&Object.assign(e,{radius:o.getSize(this.radius,this.scale),picking:o.getPicking()})}this.dotType==="sphere"?this.dotBuffer=new sa(e,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!1})):this.dotBuffer=new cy(e,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach})),this.bufferList.push(this.dotBuffer)}update(e={}){if(this.bufferList.length===0)return;const t={};e.color&&(this.volume?Object.assign(t,{color:this.volume.getDataColor(this.getColorParams())}):Object.assign(t,{color:this.surface.getColor(this.getColorParams())})),this.dotType==="sphere"&&(e.radius||e.scale)&&(this.volume?Object.assign(t,{radius:this.volume.getDataSize(this.radius,this.scale)}):Object.assign(t,{radius:this.surface.getSize(this.radius,this.scale)})),this.dotBuffer.setAttributes(t)}setParameters(e,t={},r){return e&&e.thresholdType!==void 0&&this.volume instanceof Wr&&(this.thresholdType==="value"&&e.thresholdType==="sigma"?(this.thresholdMin=this.volume.getSigmaForValue(this.thresholdMin),this.thresholdMax=this.volume.getSigmaForValue(this.thresholdMax)):this.thresholdType==="sigma"&&e.thresholdType==="value"&&(this.thresholdMin=this.volume.getValueForSigma(this.thresholdMin),this.thresholdMax=this.volume.getValueForSigma(this.thresholdMax)),this.thresholdType=e.thresholdType),e&&e.radiusType!==void 0&&(e.radiusType==="radius"?this.radius=.1:this.radius=parseFloat(e.radiusType),t.radius=!0,this.dotType!=="sphere"||wo&&!this.disableImpostor||(r=!0)),e&&e.radius!==void 0&&(t.radius=!0,this.dotType!=="sphere"||wo&&!this.disableImpostor||(r=!0)),e&&e.scale!==void 0&&(t.scale=!0,this.dotType!=="sphere"||wo&&!this.disableImpostor||(r=!0)),super.setParameters(e,t,r),this}}Qt.add("shader/Image.vert",`uniform float clipRadius;
uniform vec3 clipCenter;
varying vec2 vUv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
void main() {
#include begin_vertex
#include project_vertex
vUv = uv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
}`),Qt.add("shader/Image.frag",`uniform sampler2D map;
uniform float opacity;
uniform vec2 mapSize;
uniform float clipNear;
uniform float clipRadius;
varying vec2 vUv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform sampler2D pickingMap;
uniform float objectId;
#else
#include fog_pars_fragment
#endif
#if defined( CUBIC_INTERPOLATION )
#if defined( CATMULROM_FILTER ) || defined( MITCHELL_FILTER )
#if defined( CATMULROM_FILTER )
const float B = 0.0;
const float C = 0.5;
#elif defined( MITCHELL_FILTER )
const float B = 0.333;
const float C = 0.333;
#endif
float applyFilter( float x ){
float f = x;
if( f < 0.0 ){
f = -f;
}
if( f < 1.0 ){
return ( ( 12.0 - 9.0 * B - 6.0 * C ) * ( f * f * f ) +
( -18.0 + 12.0 * B + 6.0 *C ) * ( f * f ) +
( 6.0 - 2.0 * B ) ) / 6.0;
}else if( f >= 1.0 && f < 2.0 ){
return ( ( -B - 6.0 * C ) * ( f * f * f )
+ ( 6.0 * B + 30.0 * C ) * ( f *f ) +
( - ( 12.0 * B ) - 48.0 * C ) * f +
8.0 * B + 24.0 * C ) / 6.0;
}else{
return 0.0;
}
}
#elif defined( BSPLINE_FILTER )
float applyFilter( float x ){
float f = x;
if( f < 0.0 ){
f = -f;
}
if( f >= 0.0 && f <= 1.0 ){
return ( 2.0 / 3.0 ) + ( 0.5 ) * ( f * f * f ) - ( f * f );
}else if( f > 1.0 && f <= 2.0 ){
return 1.0 / 6.0 * pow( ( 2.0 - f ), 3.0 );
}
return 1.0;
}
#else
float applyFilter( float x ){
return 1.0;
}
#endif
vec4 biCubic( sampler2D tex, vec2 texCoord ){
vec2 texelSize = 1.0 / mapSize;
texCoord -= texelSize / 2.0;
vec4 nSum = vec4( 0.0 );
float nDenom = 0.0;
vec2 cell = fract( texCoord * mapSize );
for( float m = -1.0; m <= 2.0; ++m ){
for( float n = -1.0; n <= 2.0; ++n ){
vec4 vecData = texture2D(
tex, texCoord + texelSize * vec2( m, n )
);
float c = applyFilter( m - cell.x ) * applyFilter( -n + cell.y );
nSum += vecData * c;
nDenom += c;
}
}
return nSum / nDenom;
}
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( CUBIC_INTERPOLATION )
gl_FragColor = biCubic( map, vUv );
#else
gl_FragColor = texture2D( map, vUv );
#endif
#if defined( PICKING )
if( gl_FragColor.a < 0.3 )
discard;
gl_FragColor = vec4( texture2D( pickingMap, vUv ).xyz, objectId );
#else
if( gl_FragColor.a < 0.01 )
discard;
gl_FragColor.a *= opacity;
#include fog_fragment
#endif
}`);const kj=new Uint16Array([0,1,2,1,3,2]),Bj=new Float32Array([0,1,0,0,1,1,1,0]),Nj=Object.assign({filter:"nearest",forceTransparent:!0},zr),zj=Object.assign({filter:{updateShader:!0,uniform:!0}},vl);class Uj extends Eo{constructor(e,t){super({position:e.position,index:kj,picking:e.picking},t),this.parameterTypes=zj,this.alwaysTransparent=!0,this.hasWireframe=!1,this.vertexShader="Image.vert",this.fragmentShader="Image.frag";const{imageData:r,width:i,height:o}=e,s=new nv(r,i,o);s.flipY=!0,this.tex=s;const a=r.length,l=new Uint8Array(a);for(let u=0;u<a;u+=4){const d=u/4;l[u]=d>>16&255,l[u+1]=d>>8&255,l[u+2]=255&d}const c=new nv(l,i,o);c.flipY=!0,c.minFilter=gn,c.magFilter=gn,this.pickingTex=c,this.addUniforms({map:{value:s},pickingMap:{value:c},mapSize:{value:new Ut(i,o)}}),this.geometry.setAttribute("uv",new Wn(Bj,2))}get defaultParameters(){return Nj}getDefines(e){const t=super.getDefines(e),r=this.parameters.filter;return r.startsWith("cubic")&&(t.CUBIC_INTERPOLATION=1,r.endsWith("bspline")?t.BSPLINE_FILTER=1:r.endsWith("catmulrom")?t.CATMULROM_FILTER=1:r.endsWith("mitchell")&&(t.MITCHELL_FILTER=1)),t}updateTexture(){const e=this.tex,t=this.parameters.filter;t.startsWith("cubic")?(e.minFilter=gn,e.magFilter=gn):t==="linear"?(e.minFilter=Cr,e.magFilter=Cr):(e.minFilter=gn,e.magFilter=gn),e.needsUpdate=!0,this.pickingTex.needsUpdate=!0}makeMaterial(){super.makeMaterial(),this.updateTexture();const e=this.material;e.uniforms.map.value=this.tex,e.blending=Qo,e.needsUpdate=!0;const t=this.wireframeMaterial;t.uniforms.map.value=this.tex,t.blending=Qo,t.needsUpdate=!0;const r=this.pickingMaterial;r.uniforms.map.value=this.tex,r.uniforms.pickingMap.value=this.pickingTex,r.blending=Qo,r.needsUpdate=!0}setUniforms(e){e&&e.filter!==void 0&&(this.updateTexture(),e.map=this.tex),super.setUniforms(e)}}class $j{constructor(e,t){const r=t||{};this.dimension=W(r.dimension,"x"),this.positionType=W(r.positionType,"percent"),this.position=W(r.position,30),this.thresholdType=W(r.thresholdType,"sigma"),this.thresholdMin=W(r.thresholdMin,-1/0),this.thresholdMax=W(r.thresholdMax,1/0),this.normalize=W(r.normalize,!1),this.volume=e}getPositionFromCoordinate(e){const t=this.dimension,r=this.volume,i=r.matrix,o=new te().setFromMatrixPosition(i)[t],s=new te().setFromMatrixScale(i)[t];let a;return a=t==="x"?r.nx:t==="y"?r.ny:r.nz,Math.round(((e-o)/(a/100)+1)/s)}getData(e){e=e||{};const t=this.volume,r=t.data,i=t.matrix;let o;function s($){return Math.round($/100*(o-1))}function a($,O,k,X){return 3*(k*t.ny*t.nx+O*t.nx+$)+X}o=this.positionType==="coordinate"?this.getPositionFromCoordinate(this.position):this.position;const l=new Float32Array(12),c=new te;let u,d,h,m,f,v=0,g=0,b=0,S=t.nx,p=t.ny,y=t.nz;function w($,O,k,X){c.set($,O,k).applyMatrix4(i).toArray(l,X)}this.dimension==="x"?(h=s(t.nx),m=t.ny-1,f=t.nz-1,u=t.nz,d=t.ny,v=h,S=v+1,w(h,0,0,0),w(h,m,0,3),w(h,0,f,6),w(h,m,f,9)):this.dimension==="y"?(h=t.nx-1,m=s(t.ny),f=t.nz-1,u=t.nz,d=t.nx,g=m,p=g+1,w(0,m,0,0),w(h,m,0,3),w(0,m,f,6),w(h,m,f,9)):this.dimension==="z"&&(h=t.nx-1,m=t.ny-1,f=s(t.nz),u=t.nx,d=t.ny,b=f,y=b+1,w(0,0,f,0),w(0,m,f,3),w(h,0,f,6),w(h,m,f,9));let x=0,_=0;const A=new Uint8Array(u*d*4),C=new Float32Array(u*d);let T,I;this.thresholdType==="sigma"?(T=t.getValueForSigma(this.thresholdMin),I=t.getValueForSigma(this.thresholdMax)):(T=this.thresholdMin,I=this.thresholdMax);const M=Object.assign({},e.colorParams,{volume:t});this.normalize&&(M.domain=[0,1]);const P=Xt.getScheme(M),E=new Float32Array(3),R=P.getScale();let B,L=0,F=0;if(this.normalize){L=1/0,B=-1/0;for(let $=g;$<p;++$)for(let O=v;O<S;++O)for(let k=b;k<y;++k){const X=r[a(O,$,k,0)/3];X<L&&(L=X),X>B&&(B=X)}F=B-L}for(let $=g;$<p;++$)for(let O=v;O<S;++O)for(let k=b;k<y;++k){const X=a(O,$,k,0)/3;let ie=r[X];this.normalize&&(ie=(ie-L)/F),P.colorToArray(R(ie),E),A[x]=Math.round(255*E[0]),A[x+1]=Math.round(255*E[1]),A[x+2]=Math.round(255*E[2]),A[x+3]=ie>T&&ie<I?255:0,C[_]=X,++_,x+=4}const H=new FW(C,t);return{position:l,imageData:A,width:u,height:d,picking:H}}}class Hj extends $d{constructor(e,t,r){super(e,t,r),this.type="slice",this.parameters=Object.assign({filter:{type:"select",buffer:!0,options:{nearest:"nearest",linear:"linear","cubic-bspline":"cubic-bspline","cubic-catmulrom":"cubic-catmulrom","cubic-mitchell":"cubic-mitchell"}},positionType:{type:"select",rebuild:!0,options:{percent:"percent",coordinate:"coordinate"}},position:{type:"range",step:.1,max:100,min:1,rebuild:!0},dimension:{type:"select",rebuild:!0,options:{x:"x",y:"y",z:"z"}},thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},normalize:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null,linewidth:null,colorScheme:null,roughness:null,metalness:null,diffuse:null}),this.volume=e,this.init(r)}init(e){const t=this.volume,r=e||{};r.colorDomain=W(r.colorDomain,[t.min,t.max]),r.colorScheme=W(r.colorScheme,"value"),r.colorScale=W(r.colorScale,"Spectral"),this.colorScheme="value",this.dimension=W(r.dimension,"x"),this.filter=W(r.filter,"cubic-bspline"),this.positionType=W(r.positionType,"percent"),this.position=W(r.position,30),this.thresholdType=W(r.thresholdType,"sigma"),this.thresholdMin=W(r.thresholdMin,-1/0),this.thresholdMax=W(r.thresholdMax,1/0),this.normalize=W(r.normalize,!1),super.init(r),this.build()}attach(e){this.bufferList.forEach(t=>{this.viewer.add(t)}),this.setVisibility(this.visible),e()}create(){const e=new $j(this.volume,{positionType:this.positionType,position:this.position,dimension:this.dimension,thresholdType:this.thresholdType,thresholdMin:this.thresholdMin,thresholdMax:this.thresholdMax,normalize:this.normalize}),t=new Uj(e.getData({colorParams:this.getColorParams()}),this.getBufferParams({filter:this.filter}));this.bufferList.push(t)}}function m0(n){Be.error(`makeRepresentation: representation type ${n} unknown`)}const uy={name:"some element",status:""};class CP{constructor(e,t={}){this.stage=e,this.signals={statusChanged:new Ft.Signal,nameChanged:new Ft.Signal,disposed:new Ft.Signal},this.parameters=hi(t,this.defaultParameters),this.uuid=Xb()}get defaultParameters(){return uy}get name(){return this.parameters.name}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}dispose(){this.signals.disposed.dispatch()}}const Vj=Object.assign({visible:!0},uy);class Gj extends CP{constructor(e,t,r={},i){super(e,Object.assign({name:t.type},r)),this.parent=i,this.signals=Object.assign({visibilityChanged:new Ft.Signal,parametersChanged:new Ft.Signal},this.signals),this.setRepresentation(t)}get defaultParameters(){return Vj}get visible(){return this.parameters.visible}get type(){return"representation"}getType(){return this.repr.type}setRepresentation(e){this._disposeRepresentation(),this.repr=e,this.stage.tasks.listen(this.repr.tasks),this.updateVisibility()}_disposeRepresentation(){this.repr&&(this.stage.tasks.unlisten(this.repr.tasks),this.repr.dispose())}dispose(){this.parent&&this.parent.hasRepresentation(this)?this.parent.removeRepresentation(this):(this._disposeRepresentation(),this.signals.disposed.dispatch())}setVisibility(e){return this.parameters.visible=e,this.updateVisibility(),this.signals.visibilityChanged.dispatch(this.parameters.visible),this}getVisibility(){return this.parent?this.parent.parameters.visible&&this.parameters.visible:this.parameters.visible}toggleVisibility(){return this.setVisibility(!this.parameters.visible)}updateVisibility(){this.repr.setVisibility(this.getVisibility())}update(e){return this.repr.update(e),this}build(e){return this.repr.build(e),this}setSelection(e){const t=this.repr;return t.setSelection&&t.setSelection(e),this}setParameters(e){return this.repr.setParameters(e),this.signals.parametersChanged.dispatch(this.repr.getParameters()),this}getParameters(){return this.repr.getParameters()}setColor(e){return this.repr.setColor(e),this}}const Hl=new at,Wj=new te,AP={name:"",status:"",visible:!0};class Mm{constructor(e,t,r={}){this.stage=e,this.object=t,this.signals={representationAdded:new Ft.Signal,representationRemoved:new Ft.Signal,visibilityChanged:new Ft.Signal,matrixChanged:new Ft.Signal,statusChanged:new Ft.Signal,nameChanged:new Ft.Signal,disposed:new Ft.Signal},this.reprList=[],this.annotationList=[],this.matrix=new at,this.position=new te,this.quaternion=new Br,this.scale=new te(1,1,1),this.transform=new at,this.parameters=hi(r,this.defaultParameters),this.uuid=Xb(),this.viewer=e.viewer,this.controls=new jW(this)}get defaultParameters(){return AP}get name(){return this.parameters.name}get status(){return this.parameters.status}get visible(){return this.parameters.visible}setPosition(e){return Array.isArray(e)?this.position.fromArray(e):this.position.copy(e),this.updateMatrix(),this}setRotation(e){if(Array.isArray(e))if(e.length===3){const t=new Cc().fromArray(e);this.quaternion.setFromEuler(t)}else this.quaternion.fromArray(e);else e instanceof Cc?this.quaternion.setFromEuler(e):this.quaternion.copy(e);return this.updateMatrix(),this}setScale(e){return this.scale.set(e,e,e),this.updateMatrix(),this}setTransform(e){return this.transform.copy(e),this.updateMatrix(),this}updateMatrix(){const e=this.getCenterUntransformed(Wj);this.matrix.makeTranslation(-e.x,-e.y,-e.z),Hl.makeRotationFromQuaternion(this.quaternion),this.matrix.premultiply(Hl),Hl.makeScale(this.scale.x,this.scale.y,this.scale.z),this.matrix.premultiply(Hl);const t=this.position;Hl.makeTranslation(t.x+e.x,t.y+e.y,t.z+e.z),this.matrix.premultiply(Hl),this.matrix.premultiply(this.transform),this.updateRepresentationMatrices(),this.stage.viewer.updateBoundingBox(),this.signals.matrixChanged.dispatch(this.matrix)}updateRepresentationMatrices(){this.reprList.forEach(e=>{e.setParameters({matrix:this.matrix})})}addAnnotation(e,t,r){const i=new WW(this,e,t,r);return this.annotationList.push(i),i}eachAnnotation(e){this.annotationList.slice().forEach(e)}removeAnnotation(e){const t=this.annotationList.indexOf(e);t!==-1&&(this.annotationList.splice(t,1),e.dispose())}removeAllAnnotations(){this.eachAnnotation(e=>e.dispose()),this.annotationList.length=0}_addRepresentation(e,t,r,i=!1){const o=r||{},s=this.stage.getParameters();o.matrix=this.matrix.clone(),o.quality=o.quality||s.quality,o.disableImpostor=W(o.disableImpostor,!s.impostor),o.useWorker=W(o.useWorker,s.workerDefault),o.visible=W(o.visible,!0);const a=Object.assign({},o,{visible:this.parameters.visible&&o.visible}),l=function(u,d,h,m){var f;if(Xe&&Be.time("makeRepresentation "+u),d instanceof vo){if(!(f=xn.get(u)))return void m0(u)}else if(d instanceof wm)if(u==="surface")f=vv;else{if(u!=="dot")return void m0(u);f=nS}else if(d instanceof Wr)if(u==="surface")f=vv;else if(u==="dot")f=nS;else{if(u!=="slice")return void m0(u);f=Hj}else if(d instanceof Ej)f=Qw,d=d.getBufferList();else{if(u!=="buffer")return void Be.error("makeRepresentation: object "+d+" unknown");f=Qw}const v=new f(d,h,m);return Xe&&Be.timeEnd("makeRepresentation "+u),v}(e,t,this.viewer,a),c=new Gj(this.stage,l,o,this);return i||(this.reprList.push(c),this.signals.representationAdded.dispatch(c)),c}addBufferRepresentation(e,t){return this._addRepresentation.call(this,"buffer",e,t)}hasRepresentation(e){return this.reprList.indexOf(e)!==-1}eachRepresentation(e){this.reprList.slice().forEach(e)}removeRepresentation(e){const t=this.reprList.indexOf(e);t!==-1&&(this.reprList.splice(t,1),e.dispose(),this.signals.representationRemoved.dispatch(e))}updateRepresentations(e){this.reprList.forEach(t=>t.update(e)),this.stage.viewer.requestRender()}removeAllRepresentations(){this.eachRepresentation(e=>e.dispose())}dispose(){this.removeAllAnnotations(),this.removeAllRepresentations(),this.reprList.length=0,this.signals.disposed.dispatch()}setVisibility(e){return this.parameters.visible=e,this.eachRepresentation(t=>t.updateVisibility()),this.eachAnnotation(t=>t.updateVisibility()),this.signals.visibilityChanged.dispatch(e),this}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}getBox(...e){return this.getBoxUntransformed(...e).clone().applyMatrix4(this.matrix)}getCenter(...e){return this.getCenterUntransformed(...e).clone().applyMatrix4(this.matrix)}getZoom(...e){return this.stage.getZoomForBox(this.getBox(...e))}getBoxUntransformed(...e){return new Nn}getCenterUntransformed(...e){return this.getBoxUntransformed().getCenter(new te)}autoView(e){this.stage.animationControls.zoomMove(this.getCenter(),this.getZoom(),W(e,0))}}class MP{constructor(e=[]){this.list=e;const t=e.length;for(let r=0;r<t;++r)e[r].signals.disposed.add(this._remove,this)}_remove(e){const t=this.list.indexOf(e);t!==-1&&this.list.splice(t,1)}get first(){return this.list.length>0?this.list[0]:void 0}forEach(e){return this.list.forEach(e),this}dispose(){return this.forEach(e=>e.dispose())}}class TP extends MP{setParameters(e){return this.forEach(t=>t.setParameters(e))}setVisibility(e){return this.forEach(t=>t.setVisibility(e))}setSelection(e){return this.forEach(t=>t.setSelection(e))}setColor(e){return this.forEach(t=>t.setColor(e))}update(e){return this.forEach(t=>t.update(e))}build(e){return this.forEach(t=>t.build(e))}dispose(e){return this.forEach(t=>t.dispose())}}const jj=Object.assign({defaultStep:1,defaultTimeout:50,defaultInterpolateType:"",defaultInterpolateStep:5,defaultMode:"loop",defaultDirection:"forward",initialFrame:0},uy);class qj extends CP{constructor(e,t,r={}){super(e,Object.assign({name:t.name},r)),this.trajectory=t,this.signals=Object.assign(this.signals,{frameChanged:new Ft.Signal,playerChanged:new Ft.Signal,countChanged:new Ft.Signal,parametersChanged:new Ft.Signal}),t.signals.frameChanged.add(i=>{this.signals.frameChanged.dispatch(i)}),t.signals.playerChanged.add(i=>{this.signals.playerChanged.dispatch(i)}),t.signals.countChanged.add(i=>{this.signals.countChanged.dispatch(i)}),r.initialFrame!==void 0&&this.setFrame(r.initialFrame)}get defaultParameters(){return jj}get type(){return"trajectory"}setFrame(e){this.trajectory.setFrame(e)}setParameters(e={}){this.trajectory.setParameters(e),this.signals.parametersChanged.dispatch(e)}dispose(){this.trajectory.dispose(),super.dispose()}}class EP{constructor(e,t){this.name=e,this.path=t,this.coordinates=[],this.boxes=[],this.times=[],this.timeOffset=0,this.deltaTime=1}get type(){return"Frames"}}class PP{constructor(e,t){let r,i;if(this.A=new sn(3,3),this.W=new sn(1,3),this.U=new sn(3,3),this.V=new sn(3,3),this.VH=new sn(3,3),this.R=new sn(3,3),this.tmp=new sn(3,3),this.c=new sn(3,3),e instanceof vo)r=e.atomCount;else{if(!(e instanceof Float32Array))return;r=e.length/3}if(t instanceof vo)i=t.atomCount;else{if(!(t instanceof Float32Array))return;i=t.length/3}const o=Math.min(r,i),s=new sn(3,o),a=new sn(3,o);this.coords1t=new sn(o,3),this.coords2t=new sn(o,3),this.transformationMatrix=new at,this.c.data.set([1,0,0,0,1,0,0,0,-1]),this.prepCoords(e,s,o,!1),this.prepCoords(t,a,o,!1),this._superpose(s,a)}_superpose(e,t){this.mean1=hv(e),this.mean2=hv(t),fv(e,this.mean1),fv(t,this.mean2),ji(this.coords1t,e),ji(this.coords2t,t),Lf(this.A,this.coords2t,this.coords1t),uP(this.A,this.W,this.U,this.V),function(h,m){const f=h.data,v=m.data,g=f[4],b=f[8],S=f[5],p=f[7],y=f[0],w=y*g,x=y*S,_=f[3],A=f[1],C=_*A,T=f[2],I=_*T,M=f[6],P=M*A,E=M*T,R=1/(w*b-x*p-C*b+I*p+P*S-E*g);v[0]=(g*b-S*p)*R,v[1]=-(A*b-T*p)*R,v[2]=-(-A*S+T*g)*R,v[3]=-(_*b-S*M)*R,v[4]=(y*b-E)*R,v[5]=-(x-I)*R,v[6]=-(-_*p+g*M)*R,v[7]=-(y*p-P)*R,v[8]=(w-C)*R}(this.V,this.VH),l0(this.R,this.U,this.VH),function(h){const m=h.data;return m[0]*m[4]*m[8]-m[0]*m[5]*m[7]-m[3]*m[1]*m[8]+m[3]*m[2]*m[7]+m[6]*m[1]*m[5]-m[6]*m[2]*m[4]}(this.R)<0&&(Xe&&Be.log("R not a right handed system"),l0(this.tmp,this.c,this.VH),l0(this.R,this.U,this.tmp));const r=new sn(4,4),i=new sn(4,4),o=new sn(4,4),s=new sn(4,4),a=new sn(4,4),l=new sn(4,4),c=this.R.data,u=this.mean1,d=this.mean2;s.data.set([1,0,0,-u[0],0,1,0,-u[1],0,0,1,-u[2],0,0,0,1]),a.data.set([c[0],c[1],c[2],0,c[3],c[4],c[5],0,c[6],c[7],c[8],0,0,0,0,1]),l.data.set([1,0,0,d[0],0,1,0,d[1],0,0,1,d[2],0,0,0,1]),ji(i,s),Lf(r,a,i),ji(o,r),Lf(i,l,o),ji(r,i),this.transformationMatrix.elements=r.data}prepCoords(e,t,r,i){let o=0;const s=t.data;let a=3,l=3*r;if(i&&(l=4*r,a=4),e instanceof vo)e.eachAtom(function(c){o<l&&(s[o+0]=c.x,s[o+1]=c.y,s[o+2]=c.z,i&&(s[o+3]=1),o+=a)});else if(e instanceof Float32Array)for(;o<l;o+=a)o<l&&(s[o]=e[o],s[o+1]=e[o+1],s[o+2]=e[o+2],i&&(s[o+3]=1));else Be.warn("prepCoords: input type unknown")}transform(e){let t;if(e instanceof vo)t=e.atomCount;else{if(!(e instanceof Float32Array))return;t=e.length/3}const r=new sn(4,t),i=new sn(t,4);this.prepCoords(e,r,t,!0);const o=this.transformationMatrix,s=o.determinant();if(!s)return s;const a=new sn(4,4);a.data=o.elements,function(u,d,h){let m=0,f=0,v=0,g=0,b=0,S=0,p=0,y=0;const w=d.cols,x=d.rows,_=h.cols,A=d.data,C=h.data,T=u.data;let I=0;for(;m<x;g+=w,m++)for(p=0,f=0;f<_;y++,p++,f++){for(S=p,b=g,I=0,v=0;v<w;b++,S+=_,v++)I+=A[b]*C[S];T[y]=I}}(i,r,a);let l=0;const c=i.data;if(e instanceof vo){e.eachAtom(function(h){h.x=c[l],h.y=c[l+1],h.z=c[l+2],l+=4});const u=new at;u.copy(o).invert();const d=e.biomolDict;for(let h in d)d.hasOwnProperty(h)&&d[h].partList.forEach(function(m){m.matrixList.forEach(function(f){f.premultiply(o),f.multiply(u)})})}else if(e instanceof Float32Array){const u=4*t;for(;l<u;l+=4)e[l]=c[l],e[l+1]=c[l+1],e[l+2]=c[l+2]}else Be.warn("transform: input type unknown");return this.transformationMatrix}}const Xj={step:1,timeout:50,start:0,end:0,interpolateType:"",interpolateStep:5,mode:"loop",direction:"forward"};class Yj{constructor(e,t={}){this.signals={startedRunning:new Ft.Signal,haltedRunning:new Ft.Signal},this._run=!1,this._previousTime=0,this._currentTime=0,this._currentStep=1,e.signals.playerChanged.add(i=>{i!==this&&this.pause()},this);const r=W(e.frameCount,1);this.traj=e,this.parameters=hi(t,Xj),this.parameters.end=Math.min(W(t.end,r-1),r-1),this.parameters.step=W(t.step,Math.ceil((r+1)/100)),this._currentFrame=this.parameters.start,this._direction=this.parameters.direction==="bounce"?"forward":this.parameters.direction,e.signals.countChanged.add(i=>{this.parameters.end=Math.min(W(this.parameters.end,i-1),i-1)},this),this._animate=this._animate.bind(this)}get isRunning(){return this._run}setParameters(e={}){DE(this.parameters,e),e.direction!==void 0&&this.parameters.direction!=="bounce"&&(this._direction=this.parameters.direction)}_animate(){if(!this._run)return;this._currentTime=window.performance.now();const e=this._currentTime-this._previousTime,t=this.parameters.interpolateType?this.parameters.interpolateStep:1,r=this.parameters.timeout/t,i=this.traj;if(i&&i.frameCount&&!i.inProgress&&e>=r)if(this.parameters.interpolateType)if(this._currentStep>this.parameters.interpolateStep&&(this._currentStep=1),this._currentStep===1&&(this._currentFrame=this._nextInterpolated()),i.hasFrame(this._currentFrame)){this._currentStep+=1;const o=this._currentStep/(this.parameters.interpolateStep+1),[s,a,l,c]=this._currentFrame;i.setFrameInterpolated(s,a,l,c,o,this.parameters.interpolateType),this._previousTime=this._currentTime}else i.loadFrame(this._currentFrame);else{const o=this._next();i.hasFrame(o)?(i.setFrame(o),this._previousTime=this._currentTime):i.loadFrame(o)}window.requestAnimationFrame(this._animate)}_next(){const e=this.parameters;let t;return t=this._direction==="forward"?this.traj.currentFrame+e.step:this.traj.currentFrame-e.step,(t>e.end||t<e.start)&&(e.direction==="bounce"&&(this._direction==="forward"?this._direction="backward":this._direction="forward"),e.mode==="once"?(this.pause(),t=e.direction==="forward"?e.end:e.direction==="backward"||this._direction==="forward"?e.start:e.end):this._direction==="forward"?(t=e.start,e.interpolateType&&(t=Math.min(e.end,t+e.step))):(t=e.end,e.interpolateType&&(t=Math.max(e.start,t-e.step)))),t}_nextInterpolated(){const e=this.parameters,t=this._next();let r,i,o;return this._direction==="forward"?(r=Math.max(e.start,t-e.step),i=Math.max(e.start,t-2*e.step),o=Math.max(e.start,t-3*e.step)):(r=Math.min(e.end,t+e.step),i=Math.min(e.end,t+2*e.step),o=Math.min(e.end,t+3*e.step)),[t,r,i,o]}toggle(){this._run?this.pause():this.play()}play(){if(!this._run){this.traj.player!==this&&this.traj.setPlayer(this),this._currentStep=1;const e=this.parameters,t=this.traj.currentFrame;let r=Math.ceil(t/e.step)*e.step;e.direction==="forward"&&t>=e.end?r=e.start:e.direction==="backward"&&t<=e.start&&(r=e.end),this.traj.setFrame(r),this._run=!0,this._animate(),this.signals.startedRunning.dispatch()}}pause(){this._run=!1,this.signals.haltedRunning.dispatch()}stop(){this.pause(),this.traj.setFrame(this.parameters.start)}}class Tm{constructor(e,t,r={}){this.signals={countChanged:new Ft.Signal,frameChanged:new Ft.Signal,playerChanged:new Ft.Signal},this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this._frameCount=0,this._currentFrame=-1,this._disposed=!1,this.deltaTime=W(r.deltaTime,0),this.timeOffset=W(r.timeOffset,0),this.centerPbc=W(r.centerPbc,!1),this.removePbc=W(r.removePbc,!1),this.removePeriodicity=W(r.removePeriodicity,!1),this.superpose=W(r.superpose,!1),this.name=e.replace(/^.*[\\/]/,""),this.trajPath=e,this.selection=new yn(W(r.sele,"backbone and not hydrogen")),this.selection.signals.stringChanged.add(()=>{this.selectionIndices=this.structure.getAtomIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)})}get frameCount(){return this._frameCount}get currentFrame(){return this._currentFrame}_init(e){this.setStructure(e),this._loadFrameCount(),this.setPlayer(new Yj(this))}_loadFrameCount(){}setStructure(e){this.structure=e,this.atomCount=e.atomCount,this.backboneIndices=this._getIndices(new yn("backbone and not hydrogen")),this._makeAtomIndices(),this._saveStructureCoords(),this.selectionIndices=this._getIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}_saveInitialCoords(){this.structure.hasCoords()?(this.initialCoords=new Float32Array(this.structureCoords),this._makeSuperposeCoords()):this.frameCache[0]?(this.initialCoords=new Float32Array(this.frameCache[0]),this._makeSuperposeCoords()):this.loadFrame(0,()=>this._saveInitialCoords())}_saveStructureCoords(){this.structureCoords=this.structure.getAtomData({what:{position:!0}}).position}setSelection(e){return this.selection.setString(e),this}_getIndices(e){let t=0;const r=e.test,i=[];return r&&this.structure.eachAtom(o=>{r(o)&&i.push(t),t+=1}),i}_makeSuperposeCoords(){const e=3*this.selectionIndices.length;this.coords1=new Float32Array(e),this.coords2=new Float32Array(e);const t=this.initialCoords,r=this.coords2;for(let i=0;i<e;i+=3){const o=3*this.selectionIndices[i/3];r[i+0]=t[o+0],r[i+1]=t[o+1],r[i+2]=t[o+2]}}_makeAtomIndices(){Be.error("Trajectory._makeAtomIndices not implemented")}_resetCache(){this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this.initialCoords=new Float32Array(0)}setParameters(e={}){let t=!1;e.centerPbc!==void 0&&e.centerPbc!==this.centerPbc&&(this.centerPbc=e.centerPbc,t=!0),e.removePeriodicity!==void 0&&e.removePeriodicity!==this.removePeriodicity&&(this.removePeriodicity=e.removePeriodicity,t=!0),e.removePbc!==void 0&&e.removePbc!==this.removePbc&&(this.removePbc=e.removePbc,t=!0),e.superpose!==void 0&&e.superpose!==this.superpose&&(this.superpose=e.superpose,t=!0),this.deltaTime=W(e.deltaTime,this.deltaTime),this.timeOffset=W(e.timeOffset,this.timeOffset),t&&(this._resetCache(),this.setFrame(this._currentFrame))}hasFrame(e){return Array.isArray(e)?e.every(t=>!!this.frameCache[t]):!!this.frameCache[e]}setFrame(e,t){return e===void 0||(this.inProgress=!0,e===-1||this.frameCache[e]?(this._updateStructure(e),t&&t()):this.loadFrame(e,()=>{this._updateStructure(e),t&&t()})),this}_interpolate(e,t,r,i,o,s){const a=this.frameCache;let l;l=s==="spline"?function(c,u,d,h,m){const f=c.length,v=new Float32Array(f);for(let g=0;g<f;g+=3){const b=g+1,S=g+2;v[g]=Xo(h[g],d[g],u[g],c[g],m,1),v[b]=Xo(h[b],d[b],u[b],c[b],m,1),v[S]=Xo(h[S],d[S],u[S],c[S],m,1)}return v}(a[e],a[t],a[r],a[i],o):function(c,u,d){const h=c.length,m=new Float32Array(h);for(let f=0;f<h;f+=3){const v=f+1,g=f+2;m[f]=wi(u[f],c[f],d),m[v]=wi(u[v],c[v],d),m[g]=wi(u[g],c[g],d)}return m}(a[e],a[t],o),this.structure.updatePosition(l),this._currentFrame=e,this.signals.frameChanged.dispatch(e)}setFrameInterpolated(e,t,r,i,o,s,a){if(e===void 0)return this;const l=this.frameCache,c=[];return l[i]||c.push(i),l[r]||c.push(r),l[t]||c.push(t),l[e]||c.push(e),c.length?this.loadFrame(c,()=>{this._interpolate(e,t,r,i,o,s),a&&a()}):(this._interpolate(e,t,r,i,o,s),a&&a()),this}loadFrame(e,t){Array.isArray(e)?e.forEach(r=>{this.loadQueue[r]||this.frameCache[r]||(this.loadQueue[r]=!0,this._loadFrame(r,()=>{delete this.loadQueue[r]}))}):this.loadQueue[e]||this.frameCache[e]||(this.loadQueue[e]=!0,this._loadFrame(e,()=>{delete this.loadQueue[e],t&&t()}))}_loadFrame(e,t){Be.error("Trajectory._loadFrame not implemented",e,t)}_updateStructure(e){this._disposed?console.error("updateStructure: traj disposed"):(e===-1?this.structureCoords&&this.structure.updatePosition(this.structureCoords):this.structure.updatePosition(this.frameCache[e]),this.structure.trajectory={name:this.trajPath,frame:e},this._currentFrame=e,this.inProgress=!1,this.signals.frameChanged.dispatch(e))}_doSuperpose(e){const t=3*this.selectionIndices.length,r=this.coords1,i=this.coords2;for(let o=0;o<t;o+=3){const s=3*this.selectionIndices[o/3];r[o+0]=e[s+0],r[o+1]=e[s+1],r[o+2]=e[s+2]}new PP(r,i).transform(e)}_process(e,t,r,i){if(this._setFrameCount(i),t){if(this.backboneIndices.length>0&&this.centerPbc){const o=[t[0],t[4],t[8]],s=function(a,l,c){return[e0(l,c[0],3,0,a),e0(l,c[1],3,1,a),e0(l,c[2],3,2,a)]}(this.backboneIndices,r,o);(function(a,l,c){if(c[0]===0||c[8]===0||c[4]===0)return;const u=a.length,d=c[0],h=c[1],m=c[2],f=-l[0]+d+d/2,v=-l[1]+h+h/2,g=-l[2]+m+m/2;for(let b=0;b<u;b+=3)a[b+0]=(a[b+0]+f)%d,a[b+1]=(a[b+1]+v)%h,a[b+2]=(a[b+2]+g)%m})(r,s,o)}if(this.removePeriodicity){const o=function(s){return[If(s,3,0),If(s,3,1),If(s,3,2)]}(r);(function(s,a,l){if(a[0]===0||a[8]===0||a[4]===0)return;const c=s.length;for(let u=3;u<c;u+=3)for(let d=0;d<3;++d){const h=(s[u+d]-l[d])/a[3*d+d];Math.abs(h)>.5&&(s[u+d]-=a[3*d+d]*Math.round(h))}})(r,t,o)}this.removePbc&&function(o,s){if(s[0]===0||s[8]===0||s[4]===0)return;const a=o.length;for(let l=3;l<a;l+=3)for(let c=0;c<3;++c){const u=o[l+c]-o[l-3+c];if(Math.abs(u)>.9*s[3*c+c])if(u>0)for(let d=0;d<3;++d)o[l+d]-=s[3*c+d];else for(let d=0;d<3;++d)o[l+d]+=s[3*c+d]}}(r,t)}this.selectionIndices.length>0&&this.coords1&&this.superpose&&this._doSuperpose(r),this.frameCache[e]=r,this.boxCache[e]=t,this.frameCacheSize+=1}_setFrameCount(e){e!==this._frameCount&&(this._frameCount=e,this.signals.countChanged.dispatch(e))}dispose(){this._resetCache(),this._disposed=!0,this.player&&this.player.stop()}setPlayer(e){this.player=e,this.signals.playerChanged.dispatch(e)}getFrameTime(e){return this.timeOffset+e*this.deltaTime}}class Kj extends Tm{constructor(e,t,r){const i=r||{};i.timeOffset=W(i.timeOffset,e.timeOffset),i.deltaTime=W(i.deltaTime,e.deltaTime),super("",t,i),this.name=e.name,this.path=e.path,this.frames=e.coordinates,this.boxes=e.boxes,this._init(t)}get type(){return"frames"}_makeAtomIndices(){this.structure.type==="StructureView"?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let r;const i=this.frames[e];if(this.atomIndices){const a=this.atomIndices,l=a.length;r=new Float32Array(3*l);for(let c=0;c<l;++c){const u=3*c,d=3*a[c];r[u+0]=i[d+0],r[u+1]=i[d+1],r[u+2]=i[d+2]}}else r=new Float32Array(i);const o=this.boxes[e],s=this.frames.length;this._process(e,o,r,s),typeof t=="function"&&t()}_loadFrameCount(){this.frames&&this._setFrameCount(this.frames.length)}}class Zj extends Tm{constructor(e,t,r){super("",t,r),this._init(t)}get type(){return"structure"}_makeAtomIndices(){this.structure.atomSet&&this.structure.atomSet.getSize()<this.structure.atomStore.count?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let r;const i=this.structure,o=i.frames[e];if(this.atomIndices){const l=this.atomIndices,c=l.length;r=new Float32Array(3*c);for(let u=0;u<c;++u){const d=3*u,h=3*l[u];r[d+0]=o[h+0],r[d+1]=o[h+1],r[d+2]=o[h+2]}}else r=new Float32Array(o);const s=i.boxes[e],a=i.frames.length;this._process(e,s,r,a),typeof t=="function"&&t()}_loadFrameCount(){this._setFrameCount(this.structure.frames.length)}}class Jj extends Tm{constructor(e,t,r){super(e,t,r),this._init(t)}get type(){return"remote"}_makeAtomIndices(){const e=[];if(this.structure.type==="StructureView"){const t=this.structure.getAtomIndices(),r=t.length;let i=t[0],o=t[0];for(let s=1;s<r;++s){const a=t[s];o+1<a&&(e.push([i,o+1]),i=a),o=a}e.push([i,o+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){const r=new XMLHttpRequest,i=Kg.getFrameUrl(this.trajPath,e),o=Kg.getFrameParams(this.trajPath,this.atomIndices);r.open("POST",i,!0),r.responseType="arraybuffer",r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.addEventListener("load",()=>{const s=r.response;if(!s)return void Be.error(`empty arrayBuffer for '${i}'`);const a=new Int32Array(s,0,1)[0],l=new Float32Array(s,8,9),c=new Float32Array(s,44);this._process(e,l,c,a),typeof t=="function"&&t()},!1),r.send(o)}_loadFrameCount(){const e=new XMLHttpRequest,t=Kg.getCountUrl(this.trajPath);e.open("GET",t,!0),e.addEventListener("load",()=>{this._setFrameCount(parseInt(e.response))},!1),e.send()}}class Qj extends Tm{constructor(e,t,r){super("",t,r),this.requestCallback=e,this._init(t)}get type(){return"callback"}_makeAtomIndices(){const e=[];if(this.structure.type==="StructureView"){const t=this.structure.getAtomIndices(),r=t.length;let i=t[0],o=t[0];for(let s=1;s<r;++s){const a=t[s];o+1<a&&(e.push([i,o+1]),i=a),o=a}e.push([i,o+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){this.requestCallback((r,i,o,s)=>{this._process(r,i,o,s),typeof t=="function"&&t()},e,this.atomIndices)}_loadFrameCount(){this.requestCallback(e=>this._setFrameCount(e))}}vo.prototype.getView=function(n){return new RP(this,n)};class RP extends vo{constructor(e,t){super(),this.structure=e,this.selection=t,this.center=new te,this.boundingBox=new Nn,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy(),this.selection&&this.selection.signals.stringChanged.add(this.refresh,this),this.structure.signals.refreshed.add(this.refresh,this),this.refresh()}init(){}get type(){return"StructureView"}get name(){return this.structure.name}get path(){return this.structure.path}get title(){return this.structure.title}get id(){return this.structure.id}get data(){return this.structure.data}get atomSetDict(){return this.structure.atomSetDict}get biomolDict(){return this.structure.biomolDict}get entityList(){return this.structure.entityList}get unitcell(){return this.structure.unitcell}get frames(){return this.structure.frames}get boxes(){return this.structure.boxes}get validation(){return this.structure.validation}get bondStore(){return this.structure.bondStore}get backboneBondStore(){return this.structure.backboneBondStore}get rungBondStore(){return this.structure.rungBondStore}get atomStore(){return this.structure.atomStore}get residueStore(){return this.structure.residueStore}get chainStore(){return this.structure.chainStore}get modelStore(){return this.structure.modelStore}get atomMap(){return this.structure.atomMap}get residueMap(){return this.structure.residueMap}get bondHash(){return this.structure.bondHash}get spatialHash(){return this.structure.spatialHash}get _hasCoords(){return this.structure._hasCoords}set _hasCoords(e){this.structure._hasCoords=e}refresh(){Xe&&Be.time("StructureView.refresh"),this.atomSetCache={};const e=this.structure;if(this.selection.isAllSelection()&&e!==this&&e.atomSet&&e.bondSet){this.atomSet=e.atomSet.clone(),this.bondSet=e.bondSet.clone();for(let t in this.atomSetDict){const r=this.atomSetDict[t];this.atomSetCache["__"+t]=r.clone()}this.atomCount=e.atomCount,this.bondCount=e.bondCount,this.boundingBox.copy(e.boundingBox),this.center.copy(e.center)}else if(this.selection.isNoneSelection()&&e!==this&&e.atomSet&&e.bondSet){this.atomSet=new Qn(e.atomCount),this.bondSet=new Qn(e.bondCount);for(let t in this.atomSetDict)this.atomSetCache["__"+t]=new Qn(e.atomCount);this.atomCount=0,this.bondCount=0,this.boundingBox.makeEmpty(),this.center.set(0,0,0)}else{this.atomSet=this.getAtomSet(this.selection,!0),e.atomSet&&(this.atomSet=this.atomSet.intersection(e.atomSet)),this.bondSet=this.getBondSet();for(let t in this.atomSetDict){const r=this.atomSetDict[t];this.atomSetCache["__"+t]=r.makeIntersection(this.atomSet)}this.atomCount=this.atomSet.getSize(),this.bondCount=this.bondSet.getSize(),this.boundingBox=this.getBoundingBox(),this.center=this.boundingBox.getCenter(new te)}Xe&&Be.timeEnd("StructureView.refresh"),this.signals.refreshed.dispatch()}setSelection(e){this.selection=e,this.refresh()}getSelection(e){const t=[];e&&e.string&&t.push(e.string);const r=this.structure.getSelection();r&&r.string&&t.push(r.string),this.selection&&this.selection.string&&t.push(this.selection.string);let i="";return t.length>0&&(i=`( ${t.join(" ) AND ( ")} )`),new yn(i)}getStructure(){return this.structure.getStructure()}eachBond(e,t){this.structure.eachBond(e,this.getSelection(t))}eachAtom(e,t){const r=this.getAtomProxy(),i=this.getAtomSet(t),o=this.atomStore.count;if(i.getSize()<o)i.forEach(function(s){r.index=s,e(r)});else for(let s=0;s<o;++s)r.index=s,e(r)}eachResidue(e,t){this.structure.eachResidue(e,this.getSelection(t))}eachResidueN(e,t){console.error("StructureView.eachResidueN() not implemented")}eachChain(e,t){this.structure.eachChain(e,this.getSelection(t))}eachModel(e,t){this.structure.eachModel(e,this.getSelection(t))}getAtomSet(e,t=!1){let r=this.structure.getAtomSet(e);return!t&&this.atomSet&&(r=r.makeIntersection(this.atomSet)),r}getAtomIndices(e){return this.structure.getAtomIndices(this.getSelection(e))}refreshPosition(){return this.structure.refreshPosition()}dispose(){this.selection&&this.selection.signals.stringChanged.remove(this.refresh,this),this.structure.signals.refreshed.remove(this.refresh,this),this.structure=new vo,delete this.atomSet,delete this.bondSet}}const eq=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]];function rS(n,e){let t,r=0;const i={};return e.forEach(function(o){t=0;const s={};o.forEach(function(a){s[n[t++]]=a}),i[n[r++]]=s}),i}const tq={blosum62:rS("ARNDCQEGHILKMFPSTWYVBZ?",[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]]),blosum62x:rS("ACDEFGHIKLMNPQRSTVWY",eq)};class nq{constructor(e,t,r=-10,i=-1,o="blosum62"){this.seq1=e,this.seq2=t,this.gapPenalty=r,this.gapExtensionPenalty=i,o&&(this.substMatrix=tq[o])}initMatrices(){this.n=this.seq1.length,this.m=this.seq2.length,this.score=void 0,this.ali="",this.S=[],this.V=[],this.H=[];for(let e=0;e<=this.n;++e){this.S[e]=[],this.V[e]=[],this.H[e]=[];for(let t=0;t<=this.m;++t)this.S[e][t]=0,this.V[e][t]=0,this.H[e][t]=0}for(let e=0;e<=this.n;++e)this.S[e][0]=this.gap(0),this.H[e][0]=-1/0;for(let e=0;e<=this.m;++e)this.S[0][e]=this.gap(0),this.V[0][e]=-1/0;this.S[0][0]=0}gap(e){return this.gapPenalty+e*this.gapExtensionPenalty}makeScoreFn(){const e=this.seq1,t=this.seq2,r=this.substMatrix;return r?function(i,o){const s=e[i],a=t[o];try{return r[s][a]}catch{return-4}}:(Be.warn("Alignment: no subst matrix"),function(i,o){return e[i]===t[o]?5:-3})}calc(){Xe&&Be.time("Alignment.calc"),this.initMatrices();const e=this.gap(0),t=this.makeScoreFn(),r=this.gapExtensionPenalty,i=this.V,o=this.H,s=this.S,a=this.n,l=this.m;let c,u,d,h,m;for(let f=1;f<=a;++f){u=s[f-1],c=i[f-1],d=i[f],h=o[f],m=s[f];for(let v=1;v<=l;++v)d[v]=Math.max(u[v]+e,c[v]+r),h[v]=Math.max(m[v-1]+e,h[v-1]+r),m[v]=Math.max(u[v-1]+t(f-1,v-1),d[v],h[v])}Xe&&Be.timeEnd("Alignment.calc"),Xe&&Be.log(this.S,this.V,this.H)}trace(){Xe&&Be.time("Alignment.trace"),this.ali1="",this.ali2="";const e=this.makeScoreFn();let t,r=this.n,i=this.m;for(this.S[r][i]>=this.V[r][i]?(t="S",this.score=this.S[r][i]):this.V[r][i]>=this.H[r][i]?(t="V",this.score=this.V[r][i]):(t="H",this.score=this.H[r][i]),Xe&&Be.log("Alignment: SCORE",this.score),Xe&&Be.log("Alignment: S, V, H",this.S[r][i],this.V[r][i],this.H[r][i]);r>0&&i>0;)t==="S"?this.S[r][i]===this.S[r-1][i-1]+e(r-1,i-1)?(this.ali1=this.seq1[r-1]+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--r,--i,t="S"):this.S[r][i]===this.V[r][i]?t="V":this.S[r][i]===this.H[r][i]?t="H":(--r,--i):t==="V"?this.V[r][i]===this.V[r-1][i]+this.gapExtensionPenalty?(this.ali1=this.seq1[r-1]+this.ali1,this.ali2="-"+this.ali2,--r,t="V"):this.V[r][i]===this.S[r-1][i]+this.gap(0)?(this.ali1=this.seq1[r-1]+this.ali1,this.ali2="-"+this.ali2,--r,t="S"):--r:t==="H"?this.H[r][i]===this.H[r][i-1]+this.gapExtensionPenalty?(this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i,t="H"):this.H[r][i]===this.S[r][i-1]+this.gap(0)?(this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i,t="S"):--i:Be.error("Alignment: no matrix");for(;r>0;)this.ali1=this.seq1[r-1]+this.ali1,this.ali2="-"+this.ali2,--r;for(;i>0;)this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i;Xe&&Be.timeEnd("Alignment.trace"),Xe&&Be.log([this.ali1,this.ali2])}}function rq(n,e,t=!1,r="",i=""){let o,s,a,l,c;if(t){let d=n,h=e;r&&i&&(d=n.getView(new yn(r)),h=e.getView(new yn(i)));const m=d.getSequence(),f=h.getSequence(),v=new nq(m.join(""),f.join(""));let g,b;v.calc(),v.trace(),o=0,s=0,a=v.ali1.length;const S=[],p=[];for(let A=0;A<a;++A){const C=v.ali1[A],T=v.ali2[A];g=0,b=0,C==="-"?p[s]=!1:(p[s]=!0,g=1),T==="-"?S[o]=!1:(S[o]=!0,b=1),o+=g,s+=b}const y=[],w=[],x=d.getAtomProxy(),_=h.getAtomProxy();o=0,d.eachResidue(function(A){A.traceAtomIndex!==void 0&&A.traceAtomIndex===A.getAtomIndexByName("CA")&&(S[o]&&(x.index=A.getAtomIndexByName("CA"),y.push(x.x,x.y,x.z)),o+=1)}),o=0,h.eachResidue(function(A){A.traceAtomIndex!==void 0&&A.traceAtomIndex===A.getAtomIndexByName("CA")&&(p[o]&&(_.index=A.getAtomIndexByName("CA"),w.push(_.x,_.y,_.z)),o+=1)}),l=new Float32Array(y),c=new Float32Array(w)}else l=n.getView(new yn(`${r} and .CA`)),c=e.getView(new yn(`${i} and .CA`));const u=new PP(l,c).transform(n);return n.refreshPosition(),u}const iq=Object.assign({sele:"",defaultAssembly:""},AP);class bv extends Mm{constructor(e,t,r={}){super(e,t,Object.assign({name:t.name},r)),this.structure=t,this.trajList=[],this.signals=Object.assign(this.signals,{trajectoryAdded:new Ft.Signal,trajectoryRemoved:new Ft.Signal,defaultAssemblyChanged:new Ft.Signal}),this.initSelection(this.parameters.sele),this.pickBuffer=function(i){let o=0,s=0;const a=[];return{has:function(l){return a.indexOf(l)!==-1},get:function(l){return a[l]},push:function(l){a[o]=l,o=(i+o+1)%i,++s},get count(){return s},get data(){return a.slice(0,Math.min(s,i))},clear:function(){s=0,o=0,a.length=0}}}(4),this.pickDict=function(){const i={};return{has:function(o){return i[JSON.stringify(o)]!==void 0},add:function(o,s){i[JSON.stringify(o)]=s},del:function(o){delete i[JSON.stringify(o)]},get values(){return Object.keys(i).map(o=>i[o])}}}(),this.spacefillRepresentation=this.addRepresentation("spacefill",{sele:"none",opacity:uu.opacity,color:uu.color,disablePicking:!0,radiusType:"data"},!0),this.distanceRepresentation=this.addRepresentation("distance",uu,!0),this.angleRepresentation=this.addRepresentation("angle",uu,!0),this.dihedralRepresentation=this.addRepresentation("dihedral",uu,!0),this.measureRepresentations=new TP([this.spacefillRepresentation,this.distanceRepresentation,this.angleRepresentation,this.dihedralRepresentation]),this.setDefaultAssembly(this.parameters.defaultAssembly),this.structure.signals.refreshed.add(()=>{this.updateRepresentations({position:!0})})}get defaultParameters(){return iq}get type(){return"structure"}initSelection(e){this.selection=new yn(e),this.structureView=new RP(this.structure,this.selection),this.selection.signals.stringChanged.add(()=>{this.structureView.setSelection(this.selection),this.rebuildRepresentations(),this.rebuildTrajectories()})}setSelection(e){return this.parameters.sele=e,this.selection.setString(e),this}setDefaultAssembly(e){if(this.structure.biomolDict[e]===void 0&&(e=""),this.parameters.defaultAssembly!==e){const t={defaultAssembly:e};this.reprList.forEach(r=>r.setParameters(t)),this.measureRepresentations.setParameters(t),this.parameters.defaultAssembly=e,this.signals.defaultAssemblyChanged.dispatch(e)}return this}rebuildRepresentations(){this.reprList.forEach(e=>{e.build()}),this.measureRepresentations.build()}rebuildTrajectories(){this.trajList.forEach(e=>{e.trajectory.setStructure(this.structureView)})}updateRepresentations(e){super.updateRepresentations(e),this.measureRepresentations.update(e)}updateRepresentationMatrices(){super.updateRepresentationMatrices(),this.measureRepresentations.setParameters({matrix:this.matrix})}addRepresentation(e,t={},r=!1){t.defaultAssembly=this.parameters.defaultAssembly;const i=this._addRepresentation(e,this.structureView,t,r);return r||i.signals.parametersChanged.add(()=>this.measureUpdate()),i}addTrajectory(e="",t={}){const r=function(o,s,a){let l;return l=o&&o instanceof EP?new Kj(o,s,a):!o&&s.frames?new Zj(o,s,a):o&&typeof o=="function"?new Qj(o,s,a):new Jj(o,s,a),l}(e,this.structureView,t),i=new qj(this.stage,r,t);return this.trajList.push(i),this.signals.trajectoryAdded.dispatch(i),i}removeTrajectory(e){const t=this.trajList.indexOf(e);t!==-1&&this.trajList.splice(t,1),e.dispose(),this.signals.trajectoryRemoved.dispatch(e)}dispose(){this.trajList.slice().forEach(e=>e.dispose()),this.trajList.length=0,this.structure.dispose(),this.measureRepresentations.dispose(),super.dispose()}autoView(e,t){typeof e=="number"&&(t=e,e=""),this.stage.animationControls.zoomMove(this.getCenter(e),this.getZoom(e),W(t,0))}getBoxUntransformed(e){let t;return t=e?this.structureView.getBoundingBox(new yn(e)):this.structureView.boundingBox,t}getCenterUntransformed(e){return e&&typeof e=="string"?this.structure.atomCenter(new yn(e)):this.structure.center}superpose(e,t,r,i){return rq(this.structureView,e.structureView,t,r,i),this.updateRepresentations({position:!0}),this}getMaxRepresentationRadius(e){let t=0;const r=this.structure.getAtomProxy(e);return this.eachRepresentation(i=>{if(i.getVisibility()){const o=i.repr;t=Math.max(o.getAtomRadius(r),t)}}),t}measurePick(e){const t=this.pickBuffer.count;if(this.lastPick===e.index&&t>=1){if(t>1){const r=this.pickBuffer.data,i=this.pickBuffer.data.sort();this.pickDict.has(i)?this.pickDict.del(i):this.pickDict.add(i,r),t===2?this.distanceRepresentation.setParameters({atomPair:this.pickDict.values.filter(o=>o.length===2)}):t===3?this.angleRepresentation.setParameters({atomTriple:this.pickDict.values.filter(o=>o.length===3)}):t===4&&this.dihedralRepresentation.setParameters({atomQuad:this.pickDict.values.filter(o=>o.length===4)})}this.pickBuffer.clear(),this.lastPick=void 0}else this.pickBuffer.has(e.index)||this.pickBuffer.push(e.index),this.lastPick=e.index;this.measureUpdate()}measureClear(){this.pickBuffer.clear(),this.lastPick=void 0,this.spacefillRepresentation.setSelection("none")}measureBuild(){const e=this.measureData();this.distanceRepresentation.setParameters({atomPair:e.distance}),this.angleRepresentation.setParameters({atomTriple:e.angle}),this.dihedralRepresentation.setParameters({atomQuad:e.dihedral})}measureUpdate(){const e=this.pickBuffer.data,t={};e.forEach(r=>{const i=Math.max(.1,this.getMaxRepresentationRadius(r));t[r]=i*(2.3-Nd(.1,2,i))}),this.spacefillRepresentation.setSelection(e.length?"@"+e.join(","):"none"),e.length&&this.spacefillRepresentation.setParameters({radiusData:t})}measureData(){const e=this.pickDict.values;return{distance:e.filter(t=>t.length===2),angle:e.filter(t=>t.length===3),dihedral:e.filter(t=>t.length===4)}}removeAllMeasurements(e){const t=this.pickDict,r=t.values,i=function(o){r.filter(s=>s.length===o).forEach(s=>t.del(s.slice().sort()))};(!e||1&e)&&i(2),(!e||2&e)&&i(3),(!e||4&e)&&i(4),this.measureBuild()}removeMeasurement(e){this.pickDict.del(e.slice().sort()),this.measureBuild()}addMeasurement(e){if(e.length<2||e.length>4)return;const t=e.slice().sort();this.pickDict.has(t)||this.pickDict.add(t,e),this.measureBuild()}}Mc.add("structure",bv),Mc.add("structureview",bv);class IP extends Mm{constructor(e,t,r={}){super(e,t,Object.assign({name:t.name},r)),this.surface=t}get type(){return"surface"}addRepresentation(e,t={}){return this._addRepresentation(e,this.surface,t)}getBoxUntransformed(){return this.surface.boundingBox}getCenterUntransformed(){return this.surface.center}dispose(){this.surface.dispose(),super.dispose()}}Mc.add("surface",IP);class DP extends Mm{constructor(e,t,r={}){super(e,t,Object.assign({name:t.name},r)),this.volume=t}get type(){return"volume"}addRepresentation(e,t={}){return this._addRepresentation(e,this.volume,t)}getBoxUntransformed(){return this.volume.boundingBox}getCenterUntransformed(){return this.volume.center}dispose(){this.volume.dispose(),super.dispose()}}Mc.add("volume",DP);class iS extends MP{addRepresentation(e,t){return this.forEach(r=>r.addRepresentation(e,t))}autoView(e){return this.forEach(t=>t.autoView(e))}}function oS(n,e){return n instanceof RegExp?e.name.match(n)!==null:e.name===n}const oq=new te,sq={impostor:!0,quality:"medium",workerDefault:!0,sampleLevel:0,backgroundColor:"black",rotateSpeed:2,zoomSpeed:1.2,panSpeed:1,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",fogNear:50,fogFar:100,cameraFov:40,cameraEyeSep:.3,cameraType:"perspective",lightColor:14540253,lightIntensity:1.2,ambientColor:14540253,ambientIntensity:.3,hoverTimeout:0,tooltip:!0,mousePreset:"default"};class aq{constructor(e,t={}){this.signals={parametersChanged:new Ft.Signal,fullscreenChanged:new Ft.Signal,componentAdded:new Ft.Signal,componentRemoved:new Ft.Signal,clicked:new Ft.Signal,hovered:new Ft.Signal},this.tasks=new HE,this.compList=[],this.defaultFileParams={},this.logList=[],this.viewer=new DG(e),this.viewer.renderer&&(this.tooltip=document.createElement("div"),Object.assign(this.tooltip.style,{display:"none",position:"fixed",zIndex:"1000000",pointerEvents:"none",backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.viewer.container.appendChild(this.tooltip),this.mouseObserver=new LG(this.viewer.renderer.domElement),this.viewerControls=new NG(this),this.trackballControls=new FG(this),this.pickingControls=new kG(this),this.animationControls=new VG(this),this.mouseControls=new NW(this),this.keyControls=new UW(this),this.pickingBehavior=new $W(this),this.mouseBehavior=new HW(this),this.animationBehavior=new VW(this),this.keyBehavior=new GW(this),this.spinAnimation=this.animationControls.spin([0,1,0],.005),this.spinAnimation.pause(!0),this.rockAnimation=this.animationControls.rock([0,1,0],.005),this.rockAnimation.pause(!0),this.parameters=hi(t,sq),this.setParameters(this.parameters),this.viewer.animate())}setParameters(e={}){DE(this.parameters,e);const t=e,r=this.parameters,i=this.viewer,o=this.trackballControls;return t.quality!==void 0&&this.setQuality(r.quality),t.impostor!==void 0&&this.setImpostor(r.impostor),t.rotateSpeed!==void 0&&(o.rotateSpeed=r.rotateSpeed),t.zoomSpeed!==void 0&&(o.zoomSpeed=r.zoomSpeed),t.panSpeed!==void 0&&(o.panSpeed=r.panSpeed),t.mousePreset!==void 0&&this.mouseControls.preset(r.mousePreset),this.mouseObserver.setParameters({hoverTimeout:r.hoverTimeout}),i.setClip(r.clipNear,r.clipFar,r.clipDist,r.clipMode,r.clipScale),i.setFog(void 0,r.fogNear,r.fogFar),i.setCamera(r.cameraType,r.cameraFov,r.cameraEyeSep),i.setSampling(r.sampleLevel),i.setBackground(r.backgroundColor),i.setLight(r.lightColor,r.lightIntensity,r.ambientColor,r.ambientIntensity),this.signals.parametersChanged.dispatch(this.getParameters()),this}log(e){console.log("STAGE LOG",e),this.logList.push(e)}getParameters(){return Object.assign({},this.parameters)}defaultFileRepresentation(e){if(e instanceof bv){let t,r,i;e.setSelection("/0");const o=e.structure;if(o.biomolDict.BU1){const d=o.biomolDict.BU1;t=d.getAtomCount(o),r=d.getResidueCount(o),i=d.getInstanceCount(),e.setDefaultAssembly("BU1")}else t=o.getModelProxy(0).atomCount,r=o.getModelProxy(0).residueCount,i=1;let s=t;zE&&(s*=4);const a=o.atomStore.count/o.residueStore.count<2;a&&(s*=10);let l="chainname",c="RdYlBu",u=!1;if(o.getChainnameCount(new yn("polymer and /0"))===1&&(l="residueindex",c="Spectral",u=!0),Xe&&console.log(s,t,i,a),r/i<4)e.addRepresentation("ball+stick",{colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"});else if(i>5&&s>15e3||s>7e5){let d=Math.min(2,Math.max(.1,6e3/(s/i)));a&&(d=Math.min(d,.5)),e.addRepresentation("surface",{colorScheme:l,colorScale:c,colorReverse:u,sele:"polymer",surfaceType:"av",probeRadius:1.4,scaleFactor:d,useWorker:!1})}else s>25e4?e.addRepresentation("backbone",{colorScheme:l,colorScale:c,colorReverse:u,lineOnly:!0}):s>1e5?e.addRepresentation("backbone",{colorScheme:l,colorScale:c,colorReverse:u,quality:"low",disableImpostor:!0,radiusScale:2}):s>8e4?e.addRepresentation("backbone",{colorScheme:l,colorScale:c,colorReverse:u,radiusScale:2}):(e.addRepresentation("cartoon",{colorScheme:l,colorScale:c,colorReverse:u,radiusScale:.7,aspectRatio:5,quality:"auto"}),s<5e4&&e.addRepresentation("base",{colorScheme:l,colorScale:c,colorReverse:u,quality:"auto"}),e.addRepresentation("ball+stick",{sele:"ligand",colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"}));e.structure.frames.length&&e.addTrajectory()}else(e instanceof IP||e instanceof DP)&&e.addRepresentation("surface");this.tasks.onZeroOnce(this.autoView,this)}loadFile(e,t={}){const r=Object.assign({},this.defaultFileParams,t),i=Kr(e).name;this.tasks.increment(),this.log(`loading file '${i}'`);const o=W(r.ext,Kr(e).ext);let s;return s=It.isTrajectory(o)?Promise.reject(new Error(`loadFile: ext '${o}' is a trajectory and must be loaded into a structure component`)):mw(e,r),s.then(a=>{this.log(`loaded '${i}'`);const l=this.addComponentFromObject(a,r);return r.defaultRepresentation&&this.defaultFileRepresentation(l),this.tasks.decrement(),l},a=>{this.tasks.decrement();const l=`error loading file: '${a}'`;throw this.log(l),l})}loadScript(e){const t=Kr(e).name;return this.log(`loading script '${t}'`),mw(e).then(r=>{this.tasks.increment(),this.log(`running script '${t}'`),r.run(this).then(()=>{this.tasks.decrement(),this.log(`finished script '${t}'`)}),this.log(`called script '${t}'`)},r=>{this.tasks.decrement();const i=`errored script '${t}' "${r}"`;throw this.log(i),i})}addComponent(e){e?(this.compList.push(e),this.signals.componentAdded.dispatch(e)):Be.warn("Stage.addComponent: no component given")}addComponentFromObject(e,t={}){const r=Mc.get(e.type);if(r){const i=new r(this,e,t);return this.addComponent(i),i}Be.warn("no component for object type",e.type)}removeComponent(e){const t=this.compList.indexOf(e);t!==-1&&(this.compList.splice(t,1),e.dispose(),this.signals.componentRemoved.dispatch(e))}removeAllComponents(){this.compList.slice().forEach(e=>this.removeComponent(e))}handleResize(){this.viewer.handleResize()}setSize(e,t){const r=this.viewer.container;r!==document.body&&(e!==void 0&&(r.style.width=e),t!==void 0&&(r.style.height=t),this.handleResize())}toggleFullscreen(e){if(!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled))return void Be.log("fullscreen mode (currently) not possible");const t=this;function r(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function i(){if(!r()&&t.lastFullscreenElement){const o=t.lastFullscreenElement;o.style.width=o.dataset.normalWidth||"",o.style.height=o.dataset.normalHeight||"",document.removeEventListener("fullscreenchange",i),document.removeEventListener("mozfullscreenchange",i),document.removeEventListener("webkitfullscreenchange",i),document.removeEventListener("MSFullscreenChange",i),t.handleResize(),t.signals.fullscreenChanged.dispatch(!1)}}e=e||this.viewer.container,this.lastFullscreenElement=e,r()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(e.dataset.normalWidth=e.style.width||"",e.dataset.normalHeight=e.style.height||"",e.style.width=window.screen.width+"px",e.style.height=window.screen.height+"px",e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),document.addEventListener("fullscreenchange",i),document.addEventListener("mozfullscreenchange",i),document.addEventListener("webkitfullscreenchange",i),document.addEventListener("MSFullscreenChange",i),this.handleResize(),this.signals.fullscreenChanged.dispatch(!0),setTimeout(function(){t.handleResize()},100))}setSpin(e){e?(this.spinAnimation.resume(!0),this.rockAnimation.pause(!0)):this.spinAnimation.pause(!0)}setRock(e){e?(this.rockAnimation.resume(!0),this.spinAnimation.pause(!0)):this.rockAnimation.pause(!0)}toggleSpin(){this.setSpin(this.spinAnimation.paused)}toggleRock(){this.setRock(this.rockAnimation.paused)}getFocus(){const e=this.parameters;if(e.clipMode!=="scene")return 0;let t=e.clipNear;return e.clipScale==="absolute"&&(t=this.viewer.absoluteToRelative(t)),2*t}setFocus(e){if(this.parameters.clipMode!=="scene")return;let t,r,i,o;this.parameters.clipScale==="relative"?(t=sv(e/2,0,49.9),r=100-t,i=50,o=function(s){return sv(s,0,100)}(2*r-50)):(t=this.viewer.relativeToAbsolute(e/2),r=t,i=0,o=2*r),this.setParameters({clipNear:t,clipFar:r,fogNear:i,fogFar:o})}getZoomForBox(e){const t=e.getSize(oq),r=Math.max(t.x,t.y,t.z),i=Math.min(t.x,t.y,t.z);let o=r+Math.sqrt(i);const s=kn(this.viewer.perspectiveCamera.fov),a=this.viewer.width,l=this.viewer.height,c=l<a?1:a/l;return o=Math.abs(.5*o/c/Math.sin(s/2)),o+=this.parameters.clipDist,-o}getBox(){return this.viewer.boundingBox}getZoom(){return this.getZoomForBox(this.getBox())}getCenter(e){return this.getBox().getCenter(e||new te)}autoView(e){this.animationControls.zoomMove(this.getCenter(),this.getZoom(),W(e,0))}makeImage(e={}){return new Promise((t,r)=>{this.tasks.onZeroOnce(()=>{this.tasks.increment(),this.viewer.makeImage(e).then(i=>{this.tasks.decrement(),t(i)}).catch(i=>{this.tasks.decrement(),r(i)})})})}setImpostor(e){this.parameters.impostor=e;const t=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation(function(r){if(!t.includes(r.getType()))return;const i=r.getParameters();i.disableImpostor=!e,r.build(i)})}setQuality(e){this.parameters.quality=e;const t=["tube","cartoon","ribbon","trace","rope"],r=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation(function(i){const o=i.getParameters();if(!t.includes(i.getType())){if(!r.includes(i.getType()))return;if(!o.disableImpostor)return void(i.repr.quality=e)}o.quality=e,i.build(o)})}eachComponent(e,t){this.compList.slice().forEach(r=>{t!==void 0&&t!==r.type||e(r)})}eachRepresentation(e,t){this.eachComponent(r=>{r.reprList.slice().forEach(i=>{t!==void 0&&t!==i.getType()||e(i,r)})})}getComponentsByName(e){const t=[];return this.eachComponent(r=>{(e===void 0||oS(e,r))&&t.push(r)}),new iS(t)}getComponentsByObject(e){const t=[];return this.eachComponent(r=>{r.object===e&&t.push(r)}),new iS(t)}getRepresentationsByName(e){const t=[];return this.eachRepresentation((r,i)=>{(e===void 0||oS(e,r))&&t.push(r)}),new TP(t)}measureClear(){this.eachComponent(e=>e.measureClear(),"structure")}measureUpdate(){this.eachComponent(e=>e.measureUpdate(),"structure")}dispose(){this.tasks.dispose(),this.viewer.dispose(),this.mouseObserver.dispose()}}class lq extends Mm{constructor(e,t,r={}){super(e,t,Object.assign({name:t.name},r)),this.shape=t}get type(){return"shape"}addRepresentation(e,t={}){return this._addRepresentation(e,this.shape,t)}getBoxUntransformed(){return this.shape.boundingBox}getCenterUntransformed(){return this.shape.center}dispose(){this.shape.dispose(),super.dispose()}}function ln(n,e,t,r){var i,o=arguments.length,s=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var a=n.length-1;a>=0;a--)(i=n[a])&&(s=(o<3?i(s):o>3?i(e,t,s):i(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s}function LP(n,e,t,r){return new(t||(t=Promise))(function(i,o){function s(c){try{l(r.next(c))}catch(u){o(u)}}function a(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?i(c.value):function(u){return u instanceof t?u:new t(function(d){d(u)})}(c.value).then(s,a)}l((r=r.apply(n,[])).next())})}Mc.add("shape",lq),typeof SuppressedError=="function"&&SuppressedError;class sS extends hn{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=W(e.reverse,!0)),this.scalePerModel={},e.structure.eachModel(t=>{this.parameters.domain=[t.atomOffset,t.atomEnd],this.scalePerModel[t.index]=this.getScale()})}atomColor(e){return this.scalePerModel[e.modelIndex](e.index)}}ln([an],sS.prototype,"atomColor",null),Xt.add("atomindex",sS);class aS extends hn{constructor(e){if(super(e),e.scale||(this.parameters.scale="OrRd"),!e.domain){let t,r=1/0,i=-1/0;e.sele&&(t=new yn(e.sele)),e.structure.eachAtom(function(o){const s=o.bfactor;r=Math.min(r,s),i=Math.max(i,s)},t),this.parameters.domain=[r,i]}this.bfactorScale=this.getScale()}atomColor(e){return this.bfactorScale(e.bfactor)}}ln([an],aS.prototype,"atomColor",null),Xt.add("bfactor",aS);class lS extends hn{constructor(e){super(e),this.chainidDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel(t=>{let r=0;const i={};t.eachChain(function(o){i[o.chainid]===void 0&&(i[o.chainid]=r,r+=1)}),this.parameters.domain=[0,r-1],this.chainidDictPerModel[t.index]=i,this.scalePerModel[t.index]=this.getScale()})}atomColor(e){const t=this.chainidDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainid])}}ln([an],lS.prototype,"atomColor",null),Xt.add("chainid",lS);class cS extends hn{constructor(e){super(e),this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel(t=>{this.parameters.domain=[t.chainOffset,t.chainEnd],this.scalePerModel[t.index]=this.getScale()})}atomColor(e){return this.scalePerModel[e.modelIndex](e.chainIndex)}}ln([an],cS.prototype,"atomColor",null),Xt.add("chainindex",cS);class uS extends hn{constructor(e){super(e),this.chainnameDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel(t=>{let r=0;const i={};t.eachChain(function(o){i[o.chainname]===void 0&&(i[o.chainname]=r,r+=1)}),this.parameters.domain=[0,r-1],this.chainnameDictPerModel[t.index]=i,this.scalePerModel[t.index]=this.getScale()})}atomColor(e){const t=this.chainnameDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainname])}}ln([an],uS.prototype,"atomColor",null),Xt.add("chainname",uS);class dS extends hn{constructor(e){super(e),this.rsrzDict={},this.rsccDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rsrzScale=this.getScale({domain:[2,0]}),this.rsccScale=this.getScale({domain:[.678,1]});const t=e.structure.validation;t&&(this.rsrzDict=t.rsrzDict,this.rsccDict=t.rsccDict)}atomColor(e){let t=e.resno+"";e.inscode&&(t+="^"+e.inscode),e.chainname&&(t+=":"+e.chainname),t+="/"+e.modelIndex;const r=this.rsrzDict[t];if(r!==void 0)return this.rsrzScale(r);const i=this.rsccDict[t];return i!==void 0?this.rsccScale(i):9474192}}ln([an],dS.prototype,"atomColor",null),Xt.add("densityfit",dS);const g0={ARG:{CD:.1,CZ:.5,NE:-.1},ASN:{CG:.55,OD1:-.55},ASP:{CB:-.16,CG:.36,OD1:-.6,OD2:-.6},CYS:{CB:.19,SG:-.19},GLN:{CD:.55,OE1:-.55},GLU:{CD:.36,CG:-.16,OE1:-.6,OE2:-.6},HIS:{CB:.1,CD2:.2,CE1:.45,CG:.15,ND1:.05,NE2:.05},LYS:{CE:.25,NZ:.75},MET:{CE:.06,CG:.06,SD:-.12},PTR:{C:.55,CA:.1,CZ:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SEP:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SER:{CB:.25,OG:-.25},THR:{CB:.25,OG1:-.25},TPO:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,OG1:-1.1,O1P:-.85,O2P:-.85,O3P:-.85,P:1.4},TRP:{CD1:.06,CD2:.1,CE2:-.04,CE3:-.03,CG:-.03,NE1:-.06},TYR:{CZ:.25,OH:-.25},backbone:{C:.55,O:-.55,N:-.35,CA:.1}};class hS extends hn{constructor(e){super(e),this.delta=new te,this.hCharges=[],e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-50,50]),this.scale=this.getScale(),this.charges=new Float32Array(e.structure.atomCount);const t=[];e.structure.eachAtom(i=>{var o;if(this.charges[i.index]=((o=i).partialCharge!==null?o.partialCharge:o.isProtein()&&(g0[o.resname]&&g0[o.resname][o.atomname]||g0.backbone[o.atomname])||0)*i.occupancy,i.atomname==="N"){if(i.bondCount>=3||i.bondToElementCount(1))return;const s=function(a,l=new te){let c=!1,u=!1,d=!1;return l.set(2*a.x,2*a.y,2*a.z),a.eachBondedAtom(function(h){if(!c)return h.atomname==="H"?(l.set(h.x,h.y,h.z),void(c=!0)):void(u||h.atomname!=="CA"?d||h.atomname!=="C"||(d=!0,l.sub(h)):(l.sub(h),u=!0))}),c?l:u&&d?(l.normalize(),l.multiplyScalar(1.04),l.add(a),l):void 0}(i);s!==void 0&&(t.push(s),this.hCharges.push(.25*i.occupancy))}});const r=e.structure.getBoundingBox();r.expandByScalar(1.04),this.hStore=function(i){const o=i.length,s=new Float32Array(o),a=new Float32Array(o),l=new Float32Array(o);for(let c=0;c<i.length;c++){const u=i[c];s[c]=u.x,a[c]=u.y,l[c]=u.z}return{x:s,y:a,z:l,count:o}}(t),this.hHash=new xd(this.hStore,r),this.hash=new xd(e.structure.atomStore,r)}positionColor(e){const t=this.charges,r=this.hCharges;let i=0;return this.hash.eachWithin(e.x,e.y,e.z,12,(o,s)=>{const a=t[o];a!==0&&(i+=a/s)}),this.hHash.eachWithin(e.x,e.y,e.z,12,(o,s)=>{const a=r[o];a!==0&&(i+=a/s)}),this.scale(332*i)}}ln([an],hS.prototype,"positionColor",null),Xt.add("electrostatic",hS);const fS={H:16777215,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215,D:16777152,T:16777120};class pS extends hn{constructor(e){e.value=W(e.value,fS.C),super(e)}atomColor(e){const t=e.element;return t==="C"?this.parameters.value:fS[t]||16777215}}ln([an],pS.prototype,"atomColor",null),Xt.add("element",pS);class mS extends hn{constructor(e){super(e),e.scale||(this.parameters.scale="Spectral"),e.domain||(this.parameters.domain=[0,e.structure.entityList.length-1]),this.entityindexScale=this.getScale()}atomColor(e){return this.entityindexScale(e.entityIndex)}}ln([an],mS.prototype,"atomColor",null),Xt.add("entityindex",mS);class gS extends hn{atomColor(e){const t=e.entity;switch(t?t.entityType:void 0){case 1:return 8374655;case 2:return 16629894;case 3:return 12496596;case 4:return 3697840;default:return 16777113}}}ln([an],gS.prototype,"atomColor",null),Xt.add("entitytype",gS);class vS extends hn{constructor(e){super(e),this.geoAtomDict={},this.geoDict={};const t=e.structure.validation;t&&(this.geoAtomDict=t.geoAtomDict,this.geoDict=t.geoDict)}atomColor(e){let t,r=e.resno+"";e.inscode&&(r+="^"+e.inscode),e.chainname&&(r+=":"+e.chainname),r+="/"+e.modelIndex;const i=this.geoAtomDict[r];i!==void 0?(o=i[e.atomname]||0,t=16843009*((o=(858993459&(o-=o>>1&1431655765))+(o>>2&858993459))+(o>>4)&252645135)>>24):t=this.geoDict[r]||0;var o;return t===0?2188972:t===1?16703627:t===2?16018755:t>=3?10813478:9474192}}ln([an],vS.prototype,"atomColor",null),Xt.add("geoquality",vS);class bS extends hn{constructor(e){super(e),this.resHF={},e.scale||(this.parameters.scale="RdYlGn");for(const t in Bw)this.resHF[t]=Bw[t][0];if(this.defaultResidueHydrophobicity=tW[0],!e.domain){let t=1/0,r=-1/0;for(const i in this.resHF){const o=this.resHF[i];t=Math.min(t,o),r=Math.max(r,o)}this.parameters.domain=[t,0,r]}this.hfScale=this.getScale()}atomColor(e){return this.hfScale(this.resHF[e.resname]||this.defaultResidueHydrophobicity)}}ln([an],bS.prototype,"atomColor",null),Xt.add("hydrophobicity",bS);class yS extends hn{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow"),e.domain||(this.parameters.domain=[0,e.structure.modelStore.count]),this.modelindexScale=this.getScale()}atomColor(e){return this.modelindexScale(e.modelIndex)}}ln([an],yS.prototype,"atomColor",null),Xt.add("modelindex",yS);class _S extends hn{atomColor(e){switch(e.residueType.moleculeType){case 1:return 3697840;case 2:return 15729279;case 3:return 12496596;case 4:return 16629894;case 5:return 12540695;case 6:return 8374655;default:return 16777113}}}ln([an],_S.prototype,"atomColor",null),Xt.add("moleculetype",_S);class xS extends hn{constructor(e){super(e),e.scale||(this.parameters.scale="PuBu"),e.domain||(this.parameters.domain=[0,1]),this.occupancyScale=this.getScale()}atomColor(e){return this.occupancyScale(e.occupancy)}}ln([an],xS.prototype,"atomColor",null),Xt.add("occupancy",xS);class wS extends hn{constructor(e){super(e),e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-1,1]),this.partialchargeScale=this.getScale()}atomColor(e){return this.partialchargeScale(e.partialCharge||0)}}function v0(){return 16777215*Math.random()}ln([an],wS.prototype,"atomColor",null),Xt.add("partialcharge",wS);class Kh extends hn{atomColor(){return v0()}volumeColor(){return v0()}positionColor(){return v0()}}ln([an],Kh.prototype,"atomColor",null),ln([an],Kh.prototype,"volumeColor",null),ln([an],Kh.prototype,"positionColor",null),Xt.add("random",Kh);class SS extends hn{constructor(e){super(e),this.rciDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rciScale=this.getScale({domain:[.6,0]});const t=e.structure.validation;t&&(this.rciDict=t.rciDict)}atomColor(e){let t=`[${e.resname}]${e.resno}`;e.chainname&&(t+=":"+e.chainname);const r=this.rciDict[t];return r!==void 0?this.rciScale(r):9474192}}ln([an],SS.prototype,"atomColor",null),Xt.add("randomcoilindex",SS);class CS extends hn{constructor(e){super(e),this.scalePerChain={},e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=W(e.reverse,!0)),e.structure.eachChain(t=>{this.parameters.domain=[t.residueOffset,t.residueEnd],this.scalePerChain[t.index]=this.getScale()})}atomColor(e){return this.scalePerChain[e.chainIndex](e.residueIndex)}}ln([an],CS.prototype,"atomColor",null),Xt.add("residueindex",CS);const cq={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935,ASH:16711935,GLH:16711935,A:14423100,G:3329330,I:10145074,X:8190976,C:16766720,T:4286945,U:4251856,D:35723,DA:14423100,DG:3329330,DI:10145074,DX:8190976,DC:16766720,DT:4286945,DU:4251856,DD:35723};class AS extends hn{atomColor(e){return cq[e.resname]||16711935}}ln([an],AS.prototype,"atomColor",null),Xt.add("resname",AS);const uq=16711808,dq=10485888,hq=6291584,fq=16762880,pq=6324479,mq=16777215,gq=11403518,vq=16580962,bq=10921722;class MS extends hn{constructor(e){super(e),this.residueProxy=e.structure.getResidueProxy()}atomColor(e){const t=e.sstruc,r=this.residueProxy;return t==="h"?uq:t==="g"?dq:t==="i"?hq:t==="e"||t==="b"?fq:t==="t"?pq:(r.index=e.residueIndex,r.isDna()?gq:r.isRna()?vq:r.isSaccharide()?bq:r.isProtein()||t==="s"||t==="l"?mq:8421504)}}ln([an],MS.prototype,"atomColor",null),Xt.add("sstruc",MS);class b0 extends hn{constructor(e){var t,r;super(e),e.scale||(this.parameters.scale="rwb"),this.atomData=(t=this.parameters.data)===null||t===void 0?void 0:t.atomData,this.bondData=(r=this.parameters.data)===null||r===void 0?void 0:r.bondData,this.scale=this.getScale(this.parameters)}atomColor(e){var t;const r=(t=this.atomData)===null||t===void 0?void 0:t[e.index];return r!==void 0?this.scale(r):this.parameters.value}bondColor(e,t){var r;const i=(r=this.bondData)===null||r===void 0?void 0:r[e.index];return i!==void 0?this.scale(i):this.atomProxy?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):this.parameters.value}}ln([an],b0.prototype,"atomColor",null),ln([an],b0.prototype,"bondColor",null),Xt.add("structuredata",b0);class pu extends hn{atomColor(){return this.parameters.value}bondColor(){return this.parameters.value}valueColor(){return this.parameters.value}volumeColor(){return this.parameters.value}}ln([an],pu.prototype,"atomColor",null),ln([an],pu.prototype,"bondColor",null),ln([an],pu.prototype,"valueColor",null),ln([an],pu.prototype,"volumeColor",null),Xt.add("uniform",pu);class TS extends hn{constructor(e){super(e),this.valueScale=this.getScale()}volumeColor(e){return this.valueScale(this.parameters.volume.data[e])}}ln([an],TS.prototype,"volumeColor",null),Xt.add("value",TS);class ES extends hn{constructor(e){super(e),this.vec=new te,this.valueScale=this.getScale()}positionColor(e){const t=this.parameters.volume;if(!t||!t.inverseMatrix)return this.parameters.value;const r=this.vec,i=t.data,o=t.nx,s=t.ny,a=o*s;r.copy(e),r.applyMatrix4(t.inverseMatrix);const l=Math.floor(r.x),c=Math.floor(r.y),u=Math.floor(r.z),d=(u*s+c)*o+l,h=d+1,m=d+o,f=d+a,v=m+1,g=f+1,b=m+a,S=b+1,p=i[d],y=i[h],w=i[m],x=i[f],_=i[v],A=i[g],C=i[b],T=i[S],I=r.x-l,M=r.y-c,P=r.z-u,E=wi(p,y,I),R=wi(x,A,I),B=wi(w,_,I),L=wi(C,T,I),F=wi(E,B,M),H=wi(R,L,M),$=wi(F,H,P);return this.valueScale($)}}ln([an],ES.prototype,"positionColor",null),Xt.add("volume",ES);class br extends $d{constructor(e,t,r){const i=r||{};if(super(e,t,i),this.type="structure",this.parameters=Object.assign({radiusType:{type:"select",options:is.types},radiusData:{type:"hidden"},radiusSize:{type:"number",precision:3,max:10,min:.001},radiusScale:{type:"number",precision:3,max:10,min:.001},assembly:null,defaultAssembly:{type:"hidden"}},this.parameters),this.selection=new yn(i.sele),this.dataList=[],this.structure=e,this.structureView=this.structure.getView(this.selection),e.biomolDict){const o={default:"default","":e.unitcell?"AU":"FULL"};Object.keys(e.biomolDict).forEach(function(s){o[s]=s}),this.parameters.assembly={type:"select",options:o,rebuild:!0}}else this.parameters.assembly=null}get defaultScale(){return{vdw:1,covalent:1,bfactor:.01,sstruc:1}}init(e){const t=e||{};t.colorScheme=W(t.colorScheme,"element"),this.setRadius(t.radius,t),this.radiusType=W(t.radiusType,"vdw"),this.radiusData=W(t.radiusData,{}),this.radiusSize=W(t.radiusSize,1),this.radiusScale=W(t.radiusScale,1),this.assembly=W(t.assembly,"default"),this.defaultAssembly=W(t.defaultAssembly,""),t.quality==="auto"&&(t.quality=this.getQuality()),super.init(t),this.selection.signals.stringChanged.add(()=>{this.build()}),this.build()}setRadius(e,t){const r=Object.keys(vP);return typeof e=="string"&&r.includes(e.toLowerCase())?t.radiusType=e:e!==void 0&&(t.radiusType="size",t.radiusSize=e),this}getAssembly(){const e=this.assembly==="default"?this.defaultAssembly:this.assembly;return this.structure.biomolDict[e]}getQuality(){let e;const t=this.structureView,r=this.getAssembly();return e=r?r.getAtomCount(t):t.atomCount,zE&&(e*=4),t.atomStore.count/t.residueStore.count<2&&(e*=10),e<15e3?"high":e<8e4?"medium":"low"}create(){if(this.structureView.atomCount===0)return;if(!this.structureView.hasCoords())return void(this.needsBuild=!0);this.needsBuild=!1;const e=this.getAssembly();if(e)e.partList.forEach((t,r)=>{const i=t.getView(this.structureView);if(i.atomCount===0)return;const o=this.createData(i,r);o&&(o.sview=i,o.instanceList=t.getInstanceList(),this.dataList.push(o))});else{const t=this.createData(this.structureView,0);t&&(t.sview=this.structureView,this.dataList.push(t))}}update(e){!this.lazy||this.visible?this.needsBuild?this.build():this.dataList.forEach(t=>{t.bufferList.length>0&&this.updateData(e,t)},this):Object.assign(this.lazyProps.what,e)}updateData(e,t){this.build()}getColorParams(){return Object.assign(Object.assign({},super.getColorParams()),{structure:this.structure})}getRadiusParams(e){return{type:this.radiusType,scale:this.radiusScale,size:this.radiusSize,data:this.radiusData}}getAtomParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getBondParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getAtomRadius(e){return this.structureView.atomSet.isSet(e.index)?new is(this.getRadiusParams()).atomRadius(e):0}setSelection(e,t){return this.selection.setString(e,t),this}setParameters(e,t={},r=!1){const i=e||{};return this.setRadius(i.radius,i),i.radiusType===void 0&&i.radiusData===void 0&&i.radiusSize===void 0&&i.radiusScale===void 0||(t.radius=!0,wo&&!this.disableImpostor||(r=!0)),i.defaultAssembly!==void 0&&i.defaultAssembly!==this.defaultAssembly&&(this.assembly==="default"&&i.assembly===void 0||i.assembly==="default")&&(r=!0),super.setParameters(i,t,r),this}getParameters(){return Object.assign(super.getParameters(),{sele:this.selection?this.selection.string:void 0,defaultAssembly:this.defaultAssembly})}attach(e){const t=this.viewer,r=this.bufferList;this.dataList.forEach(function(i){i.bufferList.forEach(function(o){r.push(o),t.add(o,i.instanceList)})}),this.setVisibility(this.visible),e()}clear(){this.dataList.length=0,super.clear()}dispose(){this.structureView.dispose(),super.dispose()}}class dy extends br{constructor(e,t,r){super(e,t,r),this.n=0,this.parameters=Object.assign({labelVisible:{type:"boolean"},labelSize:{type:"number",precision:3,max:10,min:.001},labelColor:{type:"color"},labelFontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:"fontFamily"},labelFontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:"fontStyle"},labelFontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:"fontWeight"},labelsdf:{type:"boolean",buffer:"sdf"},labelXOffset:{type:"number",precision:1,max:20,min:-20,buffer:"xOffset"},labelYOffset:{type:"number",precision:1,max:20,min:-20,buffer:"yOffset"},labelZOffset:{type:"number",precision:1,max:20,min:-20,buffer:"zOffset"},labelAttachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},labelBorder:{type:"boolean",buffer:"showBorder"},labelBorderColor:{type:"color",buffer:"borderColor"},labelBorderWidth:{type:"number",precision:2,max:.3,min:0,buffer:"borderWidth"},labelBackground:{type:"boolean",rebuild:!0},labelBackgroundColor:{type:"color",buffer:"backgroundColor"},labelBackgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},labelBackgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:"backgroundOpacity"},labelFixedSize:{type:"boolean",buffer:"fixedSize"},lineOpacity:{type:"range",min:0,max:1,step:.01},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters,{flatShaded:null})}init(e){const t=e||{};this.labelVisible=W(t.labelVisible,!0),this.labelSize=W(t.labelSize,2),this.labelColor=W(t.labelColor,16777215),this.labelFontFamily=W(t.labelFontFamily,"sans-serif"),this.labelFontStyle=W(t.labelFontstyle,"normal"),this.labelFontWeight=W(t.labelFontWeight,"bold"),this.labelsdf=W(t.labelsdf,BE==="Chrome"),this.labelXOffset=W(t.labelXOffset,0),this.labelYOffset=W(t.labelYOffset,0),this.labelZOffset=W(t.labelZOffset,.5),this.labelAttachment=W(t.labelAttachment,"bottom-left"),this.labelBorder=W(t.labelBorder,!1),this.labelBorderColor=W(t.labelBorderColor,"lightgrey"),this.labelBorderWidth=W(t.labelBorderWidth,.15),this.labelBackground=W(t.labelBackground,!1),this.labelBackgroundColor=W(t.labelBackgroundColor,"lightgrey"),this.labelBackgroundMargin=W(t.labelBackgroundMargin,.5),this.labelBackgroundOpacity=W(t.labelBackgroundOpacity,1),this.labelFixedSize=W(t.labelFixedSize,!1),this.lineOpacity=W(t.lineOpacity,1),this.linewidth=W(t.linewidth,2),super.init(t)}update(e){e.position?this.build():super.update(e)}updateData(e,t){const r={};if(e&&!e.labelSize||Object.assign(r,{size:fi(this.n,this.labelSize)}),!e||e.labelColor){const i=new _t(this.labelColor);Object.assign(r,{color:un(this.n,i.r,i.g,i.b)})}this.textBuffer.setAttributes(r)}setParameters(e,t={},r=!1){return e&&e.labelSize&&(t.labelSize=!0),e&&(e.labelColor||e.labelColor===0)&&(t.labelColor=!0,r=!0),super.setParameters(e,t,r),e&&e.opacity!==void 0&&this.textBuffer.setParameters({opacity:1}),e&&e.labelVisible!==void 0&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.textBuffer&&this.textBuffer.setVisibility(this.labelVisible&&this.visible),t||this.viewer.requestRender(),this}getLabelBufferParams(e={}){return super.getBufferParams(Object.assign({fontFamily:this.labelFontFamily,fontStyle:this.labelFontStyle,fontWeight:this.labelFontWeight,sdf:this.labelsdf,xOffset:this.labelXOffset,yOffset:this.labelYOffset,zOffset:this.labelZOffset,attachment:this.labelAttachment,showBorder:this.labelBorder,borderColor:this.labelBorderColor,borderWidth:this.labelBorderWidth,showBackground:this.labelBackground,backgroundColor:this.labelBackgroundColor,backgroundMargin:this.labelBackgroundMargin,backgroundOpacity:this.labelBackgroundOpacity,fixedSize:this.labelFixedSize,disablePicking:!0,visible:this.labelVisible},e,{opacity:1}))}getAtomRadius(){return 0}}function hy(n,e){const t=n.getAtomProxy(),r=new yn,i=e.length;if(i===0)return new Float32Array(0);const o=e[0].length,s=n.getAtomSet(),a=new Float32Array(i*o*3);let l=0;return e.forEach(function(c){let u=!1;for(let d=0;d<o;d++){const h=c[d];if(typeof h=="number"&&Number.isInteger(h)){if(!s.get(h)){u=!0;break}t.index=h}else{r.setString(h);const f=n.getAtomIndices(r);if(!f.length){u=!0;break}t.index=f[0]}let m=l+3*d;a[m++]=t.x,a[m++]=t.y,a[m++]=t.z}u||(l+=3*o)}),a.subarray(0,l)}function Hi(n,e,t,r,i){const o=Math.cos(i),s=Math.sin(i);n[0]=e[0]+t[0]*o+r[0]*s,n[1]=e[1]+t[1]*o+r[1]*s,n[2]=e[2]+t[2]*o+r[2]*s}function PS(n,e,t,r,i,o,s){for(let a=0;a<e;a++){for(let l=0;l<t;l++)r[l]=n[l*e+a];RS(r,i,o,s,t);for(let l=0;l<t;l++)n[l*e+a]=i[l]}for(let a=0;a<t;a++){for(let l=0;l<e;l++)r[l]=n[a*e+l];RS(r,i,o,s,e);for(let l=0;l<e;l++)n[a*e+l]=Math.sqrt(i[l])}}function RS(n,e,t,r,i){t[0]=0,r[0]=Number.MIN_SAFE_INTEGER,r[1]=Number.MAX_SAFE_INTEGER;for(let o=1,s=0;o<i;o++){let a=(n[o]+o*o-(n[t[s]]+t[s]*t[s]))/(2*o-2*t[s]);for(;a<=r[s];)s--,a=(n[o]+o*o-(n[t[s]]+t[s]*t[s]))/(2*o-2*t[s]);s++,t[s]=o,r[s]=a,r[s+1]=Number.MAX_SAFE_INTEGER}for(let o=0,s=0;o<i;o++){for(;r[s+1]<o;)s++;e[o]=(o-t[s])*(o-t[s])+n[t[s]]}}Qt.add("shader/SDFFont.vert",`uniform float clipNear;
uniform float clipRadius;
uniform vec3 clipCenter;
uniform float xOffset;
uniform float yOffset;
uniform float zOffset;
uniform bool ortho;
uniform float canvasHeight;
uniform float pixelRatio;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
varying vec2 texCoord;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#endif
attribute vec2 mapping;
attribute vec2 inputTexCoord;
attribute float inputSize;
#include matrix_scale
#include common
void main(void){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
texCoord = inputTexCoord;
float scale = matrixScale( modelViewMatrix );
float _xOffset = xOffset * scale;
float _yOffset = yOffset * scale;
float _zOffset = zOffset * scale;
if( texCoord.x == 10.0 ){
_zOffset -= 0.001;
}
vec4 cameraPos = modelViewMatrix * vec4( position, 1.0 );
#ifdef FIXED_SIZE
if ( ortho ) {
scale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPosition.z) * 0.1;
} else {
scale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPos.z) * 0.1;
}
#endif
vec4 cameraCornerPos = vec4( cameraPos.xyz, 1.0 );
cameraCornerPos.xy += mapping * inputSize * 0.01 * scale;
cameraCornerPos.x += _xOffset;
cameraCornerPos.y += _yOffset;
if( ortho ){
cameraCornerPos.xyz += normalize( -cameraPosition ) * _zOffset;
} else {
cameraCornerPos.xyz += normalize( -cameraCornerPos.xyz ) * _zOffset;
}
gl_Position = projectionMatrix * cameraCornerPos;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
vViewPosition = -cameraCornerPos.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
#include radiusclip_vertex
}`),Qt.add("shader/SDFFont.frag",`uniform sampler2D fontTexture;
uniform float opacity;
uniform bool showBorder;
uniform vec3 borderColor;
uniform float borderWidth;
uniform vec3 backgroundColor;
uniform float backgroundOpacity;
uniform float clipNear;
uniform float clipRadius;
varying vec3 vViewPosition;
varying vec2 texCoord;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
const vec3 vColor = vec3( 0.0 );
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#endif
const float gamma = 2.2 * 1.4142 / 128.0;
const float padding = 0.75;
void main(){
#include nearclip_fragment
#include radiusclip_fragment
if( texCoord.x > 1.0 ){
gl_FragColor = vec4( backgroundColor, backgroundOpacity );
}else{
float sdf = texture2D( fontTexture, texCoord ).a;
if( showBorder ) sdf += borderWidth;
float a = smoothstep(padding - gamma, padding + gamma, sdf);
if( a < 0.2 ) discard;
a *= opacity;
vec3 outgoingLight = vColor;
if( showBorder && sdf < ( padding + borderWidth ) ){
outgoingLight = borderColor;
}
gl_FragColor = vec4( outgoingLight, a );
}
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const y0={},yq={font:"sans-serif",size:36,style:"normal",variant:"normal",weight:"normal",outline:3,width:1024,height:1024};class _q{constructor(e={}){this.gamma=1,this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.25,this.parameters=hi(e,yq);const t=this.parameters;this.radius=t.size/8,this.padding=t.size/3;const r=this.lineHeight=t.size+2*t.outline+Math.round(t.size/4),i=this.maxWidth=t.width/4,o=this.canvas=document.createElement("canvas");o.width=i,o.height=r;const s=this.context=this.canvas.getContext("2d",{willReadFrequently:!0});s.font=`${t.style} ${t.variant} ${t.weight} ${t.size}px ${t.font}`,s.fillStyle="black",s.textAlign="left",s.textBaseline="bottom",s.lineJoin="round",this.gridOuter=new Float64Array(r*i),this.gridInner=new Float64Array(r*i),this.f=new Float64Array(Math.max(r,i)),this.d=new Float64Array(Math.max(r,i)),this.z=new Float64Array(Math.max(r,i)+1),this.v=new Int16Array(Math.max(r,i)),this.data=new Uint8Array(t.width*t.height*4),this.canvas2=document.createElement("canvas"),this.canvas2.width=t.width,this.canvas2.height=t.height,this.context2=this.canvas2.getContext("2d"),this.placeholder=this.map("�");for(let a=32;a<=126;++a)this.map(String.fromCharCode(a));this.map("°"),this.map("Å"),this.texture=new LV(this.canvas2),this.texture.flipY=!1,this.texture.needsUpdate=!0}map(e){const t=this.parameters;return this.mapped[e]===void 0&&(this.draw(e),this.currentX+this.scratchW>t.width&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>t.height&&console.warn("canvas to small"),this.mapped[e]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH},this.context2.drawImage(this.canvas,0,0,this.scratchW,this.scratchH,this.currentX,this.currentY,this.scratchW,this.scratchH),this.currentX+=this.scratchW),this.mapped[e]}get(e){return this.mapped[e]||this.placeholder}draw(e){const t=this.parameters,r=this.lineHeight,i=t.outline,o=this.context,s=this.maxWidth,a=i,l=r-t.outline,c=o.measureText(e),u=Math.min(s,Math.ceil(c.width+2*a+1)),d=u*r;o.clearRect(0,0,u,r),o.fillText(e,a,l);const h=o.getImageData(0,0,u,r),m=h.data;for(let f=0;f<d;f++){const v=h.data[4*f+3]/255;this.gridOuter[f]=v===1?0:v===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-v),2),this.gridInner[f]=v===1?Number.MAX_SAFE_INTEGER:v===0?0:Math.pow(Math.max(0,v-.5),2)}PS(this.gridOuter,u,r,this.f,this.d,this.v,this.z),PS(this.gridInner,u,r,this.f,this.d,this.v,this.z);for(let f=0;f<d;f++){const v=this.gridOuter[f]-this.gridInner[f];m[4*f+3]=Math.max(0,Math.min(255,Math.round(255-255*(v/this.radius+this.cutoff))))}o.putImageData(h,0,0),this.scratchW=u,this.scratchH=r}}const xq=Object.assign({fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"bold",fontSize:36,xOffset:0,yOffset:0,zOffset:.5,attachment:"bottom-left",showBorder:!1,borderColor:"lightgrey",borderWidth:.15,showBackground:!1,backgroundColor:"lightgrey",backgroundMargin:.5,backgroundOpacity:1,forceTransparent:!0,fixedSize:!1},zr),wq=Object.assign({fontFamily:{uniform:!0},fontStyle:{uniform:!0},fontWeight:{uniform:!0},fontSize:{uniform:!0},xOffset:{uniform:!0},yOffset:{uniform:!0},zOffset:{uniform:!0},showBorder:{uniform:!0},borderColor:{uniform:!0},borderWidth:{uniform:!0},backgroundColor:{uniform:!0},backgroundOpacity:{uniform:!0},fixedSize:{updateShader:!0}},vl);function IS(n,e){const t=n.position.length/3;let r=0;for(let i=0;i<t;++i)r+=n.text[i].length;return e.showBackground&&(r+=t),r}class Yc extends ly{constructor(e,t={}){super({position:new Float32Array(3*IS(e,t)),color:new Float32Array(3*IS(e,t)),picking:new RW},t),this.parameterTypes=wq,this.alwaysTransparent=!0,this.hasWireframe=!1,this.isText=!0,this.vertexShader="SDFFont.vert",this.fragmentShader="SDFFont.frag",this.text=e.text,this.positionCount=e.position.length/3,this.addUniforms({fontTexture:{value:null},xOffset:{value:this.parameters.xOffset},yOffset:{value:this.parameters.yOffset},zOffset:{value:this.parameters.zOffset},ortho:{value:!1},showBorder:{value:this.parameters.showBorder},borderColor:{value:new _t(this.parameters.borderColor)},borderWidth:{value:this.parameters.borderWidth},backgroundColor:{value:new _t(this.parameters.backgroundColor)},backgroundOpacity:{value:this.parameters.backgroundOpacity},canvasHeight:{value:1},pixelRatio:{value:1}}),this.addAttributes({inputTexCoord:{type:"v2",value:null},inputSize:{type:"f",value:null}}),this.setAttributes(e),this.makeTexture(),this.makeMapping()}get defaultParameters(){return xq}makeMaterial(){super.makeMaterial();const e=this.texture,t=this.material;t.transparent=!0,t.extensions.derivatives=!0,t.lights=!1,t.uniforms.fontTexture.value=e,t.needsUpdate=!0;const r=this.wireframeMaterial;r.transparent=!0,r.extensions.derivatives=!0,r.lights=!1,r.uniforms.fontTexture.value=e,r.needsUpdate=!0;const i=this.pickingMaterial;i.extensions.derivatives=!0,i.lights=!1,i.uniforms.fontTexture.value=e,i.needsUpdate=!0}setAttributes(e={}){let t,r,i,o,s,a;const l=this.text,c=this.geometry.attributes;e.position&&(t=e.position,o=c.position.array,c.position.needsUpdate=!0),e.size&&(r=e.size,s=c.inputSize.array,c.inputSize.needsUpdate=!0),e.color&&(i=e.color,a=c.color.array,c.color.needsUpdate=!0);const u=this.positionCount;let d,h,m,f,v,g=0;for(let b=0;b<u;++b)for(h=3*b,m=l[b],v=m.length,this.parameters.showBackground&&(v+=1),f=0;f<v;++f,++g)for(let S=0;S<4;S++)d=4*g*3+3*S,t&&(o[d]=t[h],o[d+1]=t[h+1],o[d+2]=t[h+2]),r&&(s[4*g+S]=r[b]),i&&(a[d]=i[h],a[d+1]=i[h+1],a[d+2]=i[h+2])}makeTexture(){this.textAtlas=function(e){const t=JSON.stringify(e);return y0[t]===void 0&&(y0[t]=new _q(e)),y0[t]}({font:this.parameters.fontFamily,style:this.parameters.fontStyle,weight:this.parameters.fontWeight,size:this.parameters.fontSize}),this.texture=this.textAtlas.texture}makeMapping(){const e=this.textAtlas,t=this.text,r=this.parameters.attachment,i=e.lineHeight*this.parameters.backgroundMargin*.1-10,o=this.geometry.attributes,s=o.inputTexCoord.array,a=o.mapping.array,l=this.positionCount;let c,u,d,h,m,f,v,g,b=0;for(let S=0;S<l;++S){for(d=t[S],h=0,f=d.length,m=0;m<f;++m)c=e.get(d[m]),h+=c.w-2*e.parameters.outline;for(g=r.startsWith("top")?e.lineHeight/1.25:r.startsWith("middle")?e.lineHeight/2.5:0,v=r.endsWith("right")?h:r.endsWith("center")?h/2:0,v+=e.parameters.outline,g+=e.parameters.outline,this.parameters.showBackground&&(u=2*b*4,a[u+0]=-e.lineHeight/6-v-i,a[u+1]=e.lineHeight-g+i,a[u+2]=-e.lineHeight/6-v-i,a[u+3]=0-g-i,a[u+4]=h+e.lineHeight/6-v+2*e.parameters.outline+i,a[u+5]=e.lineHeight-g+i,a[u+6]=h+e.lineHeight/6-v+2*e.parameters.outline+i,a[u+7]=0-g-i,s[u+0]=10,s[u+2]=10,s[u+4]=10,s[u+6]=10,b+=1),h=0,m=0;m<f;++m,++b){c=e.get(d[m]),u=2*b*4,a[u+0]=h-v,a[u+1]=c.h-g,a[u+2]=h-v,a[u+3]=0-g,a[u+4]=h+c.w-v,a[u+5]=c.h-g,a[u+6]=h+c.w-v,a[u+7]=0-g;const p=e.parameters.width,y=e.parameters.height,w=[c.x/p,c.y/y,c.x/p,(c.y+c.h)/y,(c.x+c.w)/p,c.y/y,(c.x+c.w)/p,(c.y+c.h)/y];s.set(w,u),h+=c.w-2*e.parameters.outline}}o.inputTexCoord.needsUpdate=!0,o.mapping.needsUpdate=!0}getDefines(e){const t=super.getDefines(e);return this.parameters.fixedSize&&(t.FIXED_SIZE=1),t}setUniforms(e){!e||e.fontFamily===void 0&&e.fontStyle===void 0&&e.fontWeight===void 0&&e.fontSize===void 0||(this.makeTexture(),this.makeMapping(),this.texture.needsUpdate=!0,e.fontTexture=this.texture),super.setUniforms(e)}}pi.add("text",Yc),Qt.add("shader/WideLine.vert",`
uniform float clipNear;
uniform vec3 clipCenter;
uniform float linewidth;
uniform vec2 resolution;
uniform mat4 projectionMatrixInverse;
attribute vec2 mapping;
attribute vec3 position1;
attribute vec3 position2;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor;
varying vec3 vColor2;
varying float flag;
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
void trimSegment( const in vec4 start, inout vec4 end ) {
float a = projectionMatrix[ 2 ][ 2 ]; float b = projectionMatrix[ 3 ][ 2 ]; float nearEstimate = - 0.5 * b / a;
float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );
end.xyz = mix( start.xyz, end.xyz, alpha );
}
void main() {
float aspect = resolution.x / resolution.y;
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
flag = mapping.y;
vColor = color;
vColor2 = color2;
#endif
vec4 start = modelViewMatrix * vec4( position1, 1.0 );
vec4 end = modelViewMatrix * vec4( position2, 1.0 );
bool perspective = ( projectionMatrix[ 2 ][ 3 ] == -1.0 ); if ( perspective ) {
if ( start.z < 0.0 && end.z >= 0.0 ) {
trimSegment( start, end );
} else if ( end.z < 0.0 && start.z >= 0.0 ) {
trimSegment( end, start );
}
}
vec4 clipStart = projectionMatrix * start;
vec4 clipEnd = projectionMatrix * end;
vec2 ndcStart = clipStart.xy / clipStart.w;
vec2 ndcEnd = clipEnd.xy / clipEnd.w;
vec2 dir = ndcEnd - ndcStart;
dir.x *= aspect;
dir = normalize( dir );
vec2 offset = vec2( dir.y, - dir.x );
dir.x /= aspect;
offset.x /= aspect;
if ( mapping.x < 0.0 ) offset *= - 1.0;
offset *= linewidth;
offset /= resolution.y;
vec4 clip = ( mapping.y < 0.5 ) ? clipStart : clipEnd;
offset *= clip.w;
clip.xy += offset;
gl_Position = clip;
#ifndef PICKING
vViewPosition = ( projectionMatrixInverse * clip ).xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),Qt.add("shader/WideLine.frag",`uniform vec3 diffuse;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include fog_pars_fragment
varying vec3 vViewPosition;
varying vec3 vColor;
varying vec3 vColor2;
varying float flag;
#endif
void main() {
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, 1.0 );
if ( flag < 0.0 ) {
diffuseColor.rgb *= vColor;
} else {
diffuseColor.rgb *= vColor2;
}
#include alphatest_fragment
outgoingLight = diffuseColor.rgb;
gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Sq=Object.assign({linewidth:2},zr),Cq=Object.assign({linewidth:{uniform:!0}},vl);class os extends ly{constructor(e,t={}){super(e,t),this.parameterTypes=Cq,this.vertexShader="WideLine.vert",this.fragmentShader="WideLine.frag",!e.color2&&e.color&&(e.color2=e.color),this.addUniforms({linewidth:{value:this.parameters.linewidth},resolution:{value:new Ut},projectionMatrixInverse:{value:new at}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return Sq}setParameters(e){super.setParameters(e)}}pi.add("wideline",os);class Aq extends dy{constructor(e,t,r){super(e,t,r),this.type="angle",this.parameters=Object.assign({atomTriple:{type:"hidden",rebuild:!0},vectorVisible:{type:"boolean",default:!0},arcVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(r)}init(e){const t=e||{};t.side=W(t.side,"double"),t.opacity=W(t.opacity,.5),this.atomTriple=W(t.atomTriple,[]),this.arcVisible=W(t.arcVisible,!0),this.sectorVisible=W(t.sectorVisible,!0),this.vectorVisible=W(t.vectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomTriple.length)return;const t=function(a,l){return function(c){const u=[],d=c.length/9;for(let f=0;f<d;f++){let v=!0;for(let g=f;g<f+3;g+=3)c[g]===c[g+3]&&c[g+1]===c[g+4]&&c[g+2]===c[g+5]&&(v=!1);v&&u.push(f)}const h=new Float32Array(9*u.length);let m=0;return u.forEach(function(f){Kn(c,h,9*f,9*m,9),m++}),h}(hy(a,l))}(e,this.atomTriple),r=function(a,l={}){const c=W(l.angleStep,Math.PI/90),u=a.length/9,d=new Float32Array(u),h=new Float32Array(3*u),m=new Array(u),f=new Float32Array(6*u),v=new Float32Array(6*u),g=new Array(u),b=new Array(u),S=new Array(u);let p=0;const y=Lt(),w=Lt(),x=Lt(),_=Lt(),A=Lt(),C=Lt(),T=Lt(),I=Lt(),M=Lt();for(var P=0;P<u;P++){let O=9*P;Fr(y,a,O),Fr(w,a,O+3),Fr(x,a,O+6);let k=6*P;Bt(y,f,k),Bt(w,v,k),Bt(w,f,k+3),Bt(x,v,k+3),In(_,y,w),In(A,x,w),On(_,_),On(A,A),Zr(C,_,A);const X=$s(C),ie=Gr(_,A),ne=d[P]=Math.atan2(X,ie);m[P]=(GE*ne).toFixed(1)+"°",$s(C)===0&&(C[0]=1,C[1]=0,C[2]=0),Zr(T,C,_),On(T,T),Hi(I,w,_,T,ne/2),Bt(I,h,3*P);const Q=Math.ceil(ne/c),ce=new Float32Array(9*Q);S[P]=ce;const Z=new Float32Array(3*Q),re=new Float32Array(3*Q);g[P]=Z,b[P]=re,Gi(M,w,_);const se=function(ue,U){const K=9*U,be=3*U;Bt(w,ce,K),Bt(M,ce,K+3),Bt(M,Z,be),Hi(M,w,_,T,ue),Bt(M,ce,K+6),Bt(M,re,be)};let fe=0;for(let ue=c;ue<ne;ue+=c)se(ue,fe),fe++;se(ne,fe),p+=Q}const E=3*p,R=9*p,B=new Float32Array(E),L=new Float32Array(E),F=new Float32Array(R);let H=0,$=0;for(let O=0;O<u;O++){const k=g[O],X=b[O];Kn(k,B,0,$,k.length),Kn(X,L,0,$,X.length),$+=k.length;const ie=S[O];Kn(ie,F,0,H,ie.length),H+=ie.length}return{labelPosition:h,labelText:m,vectorPosition1:f,vectorPosition2:v,arcPosition1:B,arcPosition2:L,sectorPosition:F}}(t),i=this.n=r.labelPosition.length/3,o=new _t(this.labelColor);this.textBuffer=new Yc({position:r.labelPosition,size:fi(i,this.labelSize),color:un(i,o.r,o.g,o.b),text:r.labelText},this.getLabelBufferParams());const s=new _t(this.colorValue);return this.vectorBuffer=new os(dv({position1:r.vectorPosition1,position2:r.vectorPosition2,color:un(2*i,s.r,s.g,s.b),color2:un(2*i,s.r,s.g,s.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.vectorVisible,opacity:this.lineOpacity})),this.arcLength=r.arcPosition1.length/3,this.arcBuffer=new os(dv({position1:r.arcPosition1,position2:r.arcPosition2,color:un(this.arcLength,s.r,s.g,s.b),color2:un(this.arcLength,s.r,s.g,s.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.arcVisible,opacity:this.lineOpacity})),this.sectorLength=r.sectorPosition.length/3,this.sectorBuffer=new rs({position:r.sectorPosition,color:un(this.sectorLength,s.r,s.g,s.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.vectorBuffer,this.arcBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const r={},i={},o={};if(e.color){const s=new _t(this.colorValue);Object.assign(r,{color:un(2*this.n,s.r,s.g,s.b),color2:un(2*this.n,s.r,s.g,s.b)}),Object.assign(i,{color:un(this.arcLength,s.r,s.g,s.b),color2:un(this.arcLength,s.r,s.g,s.b)}),Object.assign(o,{color:un(this.sectorLength,s.r,s.g,s.b)})}this.vectorBuffer.setAttributes(r),this.arcBuffer.setAttributes(i),this.sectorBuffer.setAttributes(o)}setParameters(e){return super.setParameters(e,{},!1),!e||e.vectorVisible===void 0&&e.arcVisible===void 0&&e.sectorVisible===void 0||this.setVisibility(this.visible),e&&e.lineOpacity&&(this.vectorBuffer.setParameters({opacity:e.lineOpacity}),this.arcBuffer.setParameters({opacity:e.lineOpacity})),e&&e.opacity!==void 0&&(this.vectorBuffer.setParameters({opacity:this.lineOpacity}),this.arcBuffer.setParameters({opacity:this.lineOpacity})),e&&e.linewidth&&(this.vectorBuffer.setParameters({linewidth:e.linewidth}),this.arcBuffer.setParameters({linewidth:e.linewidth})),this}setVisibility(e,t){return super.setVisibility(e,!0),this.vectorBuffer&&this.vectorBuffer.setVisibility(this.vectorVisible&&this.visible),this.arcBuffer&&this.arcBuffer.setVisibility(this.arcVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}xn.add("angle",Aq);const DS=new te,_0=new te,x0=new te,Mq=new te(0,1,0),fy=Object.assign({radialSegments:1,openEnded:!0},zr);function LS(n={}){const e=W(n.radialSegments,10),t=W(n.openEnded,!0),r=new at().makeRotationX(Math.PI/2),i=new dm(1,1,1,e,1,t);return i.applyMatrix4(r),i}class FP extends oa{constructor(e,t={}){super(function(o,s={}){const a=LS(s),l=o.position1.length,c=a.attributes.position.array.length/3,u=l/3,d=new Float32Array(2*u*c);return av(u,c,0,d),av(u,c,u*c,d),{position:new Float32Array(2*l),color:new Float32Array(2*l),primitiveId:d,picking:o.picking}}(e,t),t,LS(t)),this.updateNormals=!0;const r=e.position1.length,i=e.radius.length;this.__center=new Float32Array(r),this._position=new Float32Array(2*r),this._color=new Float32Array(2*r),this._from=new Float32Array(2*r),this._to=new Float32Array(2*r),this._radius=new Float32Array(2*i),this.setAttributes(e,!0)}get defaultParameters(){return fy}applyPositionTransform(e,t,r){_0.fromArray(this._from,r),x0.fromArray(this._to,r),e.lookAt(_0,x0,Mq);const i=this._radius[t];DS.set(i,i,_0.distanceTo(x0)),e.scale(DS)}setAttributes(e={},t){const r={};e.position1&&e.position2&&(So(e.position1,e.position2,this.__center),So(e.position1,this.__center,this._position),So(this.__center,e.position2,this._position,e.position1.length),this._from.set(e.position1),this._from.set(this.__center,e.position1.length),this._to.set(this.__center),this._to.set(e.position2,this.__center.length),r.position=this._position),e.color&&e.color2&&(this._color.set(e.color),this._color.set(e.color2,e.color.length),r.color=this._color),e.radius&&(this._radius.set(e.radius),this._radius.set(e.radius,e.radius.length),r.radius=this._radius),super.setAttributes(r,t)}}Qt.add("shader/CylinderImpostor.vert",`
attribute vec3 mapping;
attribute vec3 position1;
attribute vec3 position2;
attribute float radius;
varying vec3 axis;varying vec4 base_radius;varying vec4 end_b;varying vec3 U;varying vec3 V;
varying vec4 w;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor1;
varying vec3 vColor2;
#endif
uniform mat4 modelViewMatrixInverse;
uniform float ortho;
#include matrix_scale
void main(){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
vColor1 = color;
vColor2 = color2;
#endif
base_radius.w = radius * matrixScale( modelViewMatrix );
vec3 center = position;
vec3 dir = normalize( position2 - position1 );
float ext = length( position2 - position1 ) / 2.0;
vec3 cam_dir;
if( ortho == 0.0 ){
cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;
}else{
cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;
}
cam_dir = normalize( cam_dir );
vec3 ldir;
float b = dot( cam_dir, dir );
end_b.w = b;
if( b < 0.0 )
ldir = -ext * dir;
else
ldir = ext * dir;
vec3 left = radius * normalize( cross( cam_dir, ldir ) );
vec3 up = radius * normalize( cross( left, ldir ) );
axis = normalize( normalMatrix * ldir );
U = normalize( normalMatrix * up );
V = normalize( normalMatrix * left );
vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );
base_radius.xyz = base4.xyz / base4.w;
vec4 end4 = modelViewMatrix * vec4( center + ldir, 1.0 );
end_b.xyz = end4.xyz / end4.w;
w = modelViewMatrix * vec4(
center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0
);
gl_Position = projectionMatrix * w;
gl_Position.z = 0.99;
}`),Qt.add("shader/CylinderImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform mat4 projectionMatrix;
uniform float ortho;
varying vec3 axis;
varying vec4 base_radius;
varying vec4 end_b;
varying vec3 U;
varying vec3 V;
varying vec4 w;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
varying vec3 vColor1;
varying vec3 vColor2;
#include common
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool interior = false;
float distSq3( vec3 v3a, vec3 v3b ){
return (
( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +
( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +
( v3a.z - v3b.z ) * ( v3a.z - v3b.z )
);
}
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
float calcClip( vec3 cameraPos ){
return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
void main(){
vec3 ray_target = w.xyz / w.w;
vec3 base = base_radius.xyz; float vRadius = base_radius.w; vec3 end = end_b.xyz; float b = end_b.w;
vec3 ray_origin = vec3(0.0); vec3 ortho_ray_direction = vec3(0.0, 0.0, 1.0); vec3 persp_ray_direction = normalize(ray_origin - ray_target);
vec3 ray_direction = mix(persp_ray_direction, ortho_ray_direction, ortho);
mat3 basis = mat3( U, V, axis );
vec3 diff = ray_target - 0.5 * (base + end);
vec3 P = diff * basis;
float dz = dot( axis, ray_direction );
float radius2 = vRadius*vRadius;
vec3 D = vec3(dot(U, ray_direction),
dot(V, ray_direction),
dz);
float a0 = P.x*P.x + P.y*P.y - radius2;
float a1 = P.x*D.x + P.y*D.y;
float a2 = D.x*D.x + D.y*D.y;
float d = a1*a1 - a0*a2;
if (d < 0.0) {
discard;
}
float dist = (-a1 + sqrt(d)) / a2;
vec3 surface_point = ray_target + dist * ray_direction;
vec3 base_to_surface = surface_point - base;
vec3 _normal = normalize( base_to_surface - axis * dot(base_to_surface, axis) );
float base_cap_test = dot( base_to_surface, axis );
float end_cap_test = dot((surface_point - end), axis);
#ifndef CAP
vec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
vec3 tmp_point2 = new_point2 - base;
#endif
if (base_cap_test < 0.0) {
float dNV;
float near;
vec3 front_point;
if ( ortho == 1.0 ) {
front_point = ray_target;
} else {
dNV = dot(-axis, ray_direction);
near = dot(-axis, (base)) / dNV;
front_point = ray_direction * near + ray_origin;
}
if (dot(front_point - base, front_point-base) > radius2) {
discard;
}
#ifdef CAP
surface_point = front_point;
_normal = axis;
#else
surface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
dNV = dot(-axis, ray_direction);
near = dot(axis, end) / dNV;
new_point2 = ray_direction * near + ray_origin;
if (dot(new_point2 - end, new_point2-base) < radius2) {
discard;
}
interior = true;
#endif
}
if( end_cap_test > 0.0 )
{
float dNV;
float near;
vec3 end_point;
if ( ortho == 1.0 ) {
end_point = ray_target;
} else {
dNV = dot(axis, ray_direction);
if (dNV < 0.0) {
discard;
}
near = dot(axis, end) / dNV;
end_point = ray_direction * near + ray_origin;
}
if( dot(end_point - end, end_point-base) > radius2 ) {
discard;
}
#ifdef CAP
surface_point = end_point;
_normal = axis;
#else
surface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
dNV = dot(-axis, ray_direction);
near = dot(-axis, (base)) / dNV;
new_point2 = ray_direction * near + ray_origin;
if (dot(new_point2 - base, new_point2-base) < radius2) {
discard;
}
interior = true;
#endif
}
gl_FragDepthEXT = calcDepth( surface_point );
#ifdef NEAR_CLIP
if( calcClip( surface_point ) > 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
if( calcClip( surface_point ) > 0.0 ) {
discard;
}
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );
}
}else if( gl_FragDepthEXT <= 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
}
#else
if( gl_FragDepthEXT <= 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
}
#endif
if (gl_FragDepthEXT < 0.0) {
discard;
}
if (gl_FragDepthEXT > 1.0) {
discard;
}
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vViewPosition = -surface_point;
vec3 vNormal = _normal;
vec3 vColor;
if( distSq3( surface_point, end ) < distSq3( surface_point, base ) ){
if( b < 0.0 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
}else{
if( b > 0.0 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
}
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
vec3 normal = normalize( vNormal );
vec3 nonPerturbedNormal = normal;
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Tq=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),Eq=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]);class FS extends ay{constructor(e,t={}){super("v3",e,t)}get mapping(){return Tq}get mappingIndices(){return Eq}get mappingIndicesSize(){return 12}get mappingSize(){return 6}get mappingItemSize(){return 3}}const OP=Object.assign({openEnded:!1},zr),Pq=Object.assign({openEnded:{updateShader:!0}},vl);class Rq extends FS{constructor(e,t={}){super(e,t),this.parameterTypes=Pq,this.isImpostor=!0,this.vertexShader="CylinderImpostor.vert",this.fragmentShader="CylinderImpostor.frag",this.addUniforms({modelViewMatrixInverse:{value:new at},ortho:{value:0}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return OP}getDefines(e){const t=FS.prototype.getDefines.call(this,e);return this.parameters.openEnded||(t.CAP=1),t}}Object.assign({disableImpostor:!1},fy,OP);const cs=class{constructor(n,e={}){return!n.color2&&n.color&&(n.color2=n.color),!wo||e&&e.disableImpostor?new FP(n,e):new Rq(n,e)}};pi.add("cylinder",cs);class Iq extends br{constructor(e,t,r){super(e,t,r),this.type="axes",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0,showAxes:{type:"boolean",rebuild:!0},showBox:{type:"boolean",rebuild:!0}},this.parameters,{assembly:null}),this.init(r)}init(e){const t=e||{};t.radiusSize=W(t.radiusSize,.5),t.colorValue=W(t.colorValue,"lightgreen"),t.useInteriorColor=W(t.useInteriorColor,!0),this.showAxes=W(t.showAxes,!0),this.showBox=W(t.showBox,!1),super.init(t)}getPrincipalAxes(){let e;const t=this.getAssembly();return t&&(e=t.partList[0].getSelection()),this.structureView.getPrincipalAxes(e)}getAxesData(e){const t=this.getPrincipalAxes(),r=new _t(this.colorValue);let i=0,o=0;this.showAxes&&(i+=6,o+=3),this.showBox&&(i+=8,o+=12);const s=new Float32Array(3*i),a=un(i,r.r,r.g,r.b),l=fi(i,this.radiusSize),c=new Float32Array(3*o),u=new Float32Array(3*o),d=un(o,r.r,r.g,r.b),h=fi(o,this.radiusSize);let m=0;if(this.showAxes){const v=function(g,b){g.toArray(s,2*m),b.toArray(s,2*m+3),g.toArray(c,m),b.toArray(u,m),m+=3};v(t.begA,t.endA),v(t.begB,t.endB),v(t.begC,t.endC)}if(this.showBox){const v=new te,{d1a:g,d2a:b,d3a:S,d1b:p,d2b:y,d3b:w}=t.getProjectedScaleForAtoms(e);let x=2*m;const _=function(T,I,M){v.copy(t.center).addScaledVector(t.normVecA,T).addScaledVector(t.normVecB,I).addScaledVector(t.normVecC,M),v.toArray(s,x),x+=3};_(g,b,S),_(g,b,w),_(g,y,w),_(g,y,S),_(p,y,w),_(p,y,S),_(p,b,S),_(p,b,w);let A=m;const C=function(T,I){v.fromArray(s,2*m+3*T).toArray(c,A),v.fromArray(s,2*m+3*I).toArray(u,A),A+=3};C(0,1),C(0,3),C(0,6),C(1,2),C(1,7),C(2,3),C(2,4),C(3,5),C(4,5),C(4,7),C(5,6),C(6,7)}const f=new MW(t);return{vertex:{position:s,color:a,radius:l,picking:f},edge:{position1:c,position2:u,color:d,color2:d,radius:h,picking:f}}}create(){const e=this.getAxesData(this.structureView);this.sphereBuffer=new sa(e.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new cs(e.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const r=this.getAxesData(t.sview),i={},o={};e&&!e.position||(Object.assign(i,{position:r.vertex.position}),Object.assign(o,{position1:r.edge.position1,position2:r.edge.position2})),e&&!e.color||(Object.assign(i,{color:r.vertex.color}),Object.assign(o,{color:r.edge.color,color2:r.edge.color})),e&&!e.radius||(Object.assign(i,{radius:r.vertex.radius}),Object.assign(o,{radius:r.edge.radius})),this.sphereBuffer.setAttributes(i),this.cylinderBuffer.setAttributes(o)}}xn.add("axes",Iq);class Em extends br{constructor(e,t,r){super(e,t,r),this.type="ball+stick",this.parameters=Object.assign({sphereDetail:!0,radialSegments:!0,openEnded:!0,disableImpostor:!0,aspectRatio:{type:"number",precision:1,max:10,min:1},lineOnly:{type:"boolean",rebuild:!0},cylinderOnly:{type:"boolean",rebuild:!0},multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondScale:{type:"number",precision:2,max:1,min:.01},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters),this.init(r)}init(e){var t=e||{};t.radiusType=W(t.radiusType,"size"),t.radiusSize=W(t.radiusSize,.15),t.useInteriorColor=W(t.useInteriorColor,!0),this.aspectRatio=W(t.aspectRatio,2),this.lineOnly=W(t.lineOnly,!1),this.cylinderOnly=W(t.cylinderOnly,!1),this.multipleBond=W(t.multipleBond,"off"),this.bondSpacing=W(t.bondSpacing,1),this.bondScale=W(t.bondScale,.4),this.linewidth=W(t.linewidth,2),super.init(t)}getAtomRadius(e){return this.aspectRatio*super.getAtomRadius(e)}getAtomParams(e,t){var r=super.getAtomParams(e,t);return r.radiusParams.scale*=this.aspectRatio,r}getAtomData(e,t,r){return e.getAtomData(this.getAtomParams(t,r))}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,bondScale:this.bondScale},t),super.getBondParams(e,t)}getBondData(e,t,r){return e.getBondData(this.getBondParams(t,r))}createData(e){const t=[];if(this.lineOnly)this.lineBuffer=new os(this.getBondData(e,{position:!0,color:!0,picking:!0}),this.getBufferParams({linewidth:this.linewidth})),t.push(this.lineBuffer);else{const r=new cs(this.getBondData(e),this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}));if(t.push(r),!this.cylinderOnly){const i=new sa(this.getAtomData(e),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));t.push(i)}}return{bufferList:t}}updateData(e,t){this.multipleBond!=="off"&&e&&e.radius&&(e.position=!0);const r=this.getBondData(t.sview,e);if(this.lineOnly){const a={};e&&!e.position||Object.assign(a,{position1:r.position1,position2:r.position2}),e&&!e.color||Object.assign(a,{color:r.color,color2:r.color2}),t.bufferList[0].setAttributes(a)}else{var i={};if(e&&!e.position||Object.assign(i,{position1:r.position1,position2:r.position2}),e&&!e.color||Object.assign(i,{color:r.color,color2:r.color2}),e&&!e.radius||Object.assign(i,{radius:r.radius}),t.bufferList[0].setAttributes(i),!this.cylinderOnly){var o=this.getAtomData(t.sview,e),s={};e&&!e.position||Object.assign(s,{position:o.position}),e&&!e.color||Object.assign(s,{color:o.color}),e&&!e.radius||Object.assign(s,{radius:o.radius}),t.bufferList[1].setAttributes(s)}}}setParameters(e={}){let t=!1;const r={};return(e.aspectRatio||e.bondSpacing||e.bondScale)&&(Object.assign(r,{radius:!0}),wo&&!this.disableImpostor||(t=!0)),super.setParameters(e,r,t),this}}xn.add("ball+stick",Em);class Dq extends Em{constructor(e,t,r){super(e,t,r),this.type="backbone",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null}),this.init(r)}init(e){var t=e||{};t.aspectRatio=W(t.aspectRatio,1),t.radiusSize=W(t.radiusSize,.25),super.init(t)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}getAtomData(e,t,r){return e.getBackboneAtomData(this.getAtomParams(t,r))}getBondData(e,t,r){return e.getBackboneBondData(this.getBondParams(t,r))}}xn.add("backbone",Dq);class Lq extends Em{constructor(e,t,r){super(e,t,r),this.type="base",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){let t=e||{};t.aspectRatio=W(t.aspectRatio,1),t.radiusSize=W(t.radiusSize,.3),super.init(t)}getAtomData(e,t,r){return e.getRungAtomData(this.getAtomParams(t,r))}getBondData(e,t,r){let i=this.getBondParams(t,r);return Object.assign(i.colorParams,{rung:!0}),e.getRungBondData(i)}}xn.add("base",Lq);class Fq{constructor(e,t){this.m=e,this.tension=t,this.dt=1/this.m,this.delta=1e-4,this.vec1=new te,this.vec2=new te,this.vDir=new te,this.vTan=new te,this.vNorm=new te,this.vBin=new te,this.m2=Math.ceil(this.m/2)}interpolateToArr(e,t,r,i,o,s,a){s[a+0]=Xo(e.x,t.x,r.x,i.x,o,this.tension),s[a+1]=Xo(e.y,t.y,r.y,i.y,o,this.tension),s[a+2]=Xo(e.z,t.z,r.z,i.z,o,this.tension)}interpolateToVec(e,t,r,i,o,s){s.x=Xo(e.x,t.x,r.x,i.x,o,this.tension),s.y=Xo(e.y,t.y,r.y,i.y,o,this.tension),s.z=Xo(e.z,t.z,r.z,i.z,o,this.tension)}interpolatePosition(e,t,r,i,o,s){for(var a=0;a<this.m;++a){var l=s+3*a,c=this.dt*a;this.interpolateToArr(e,t,r,i,c,o,l)}}interpolateTangent(e,t,r,i,o,s){for(var a=0;a<this.m;++a){var l=this.dt*a,c=l-this.delta,u=l+this.delta,d=s+3*a;c<0&&(c=0),u>1&&(u=1),this.interpolateToVec(e,t,r,i,c,this.vec1),this.interpolateToVec(e,t,r,i,u,this.vec2),this.vec2.sub(this.vec1).normalize(),this.vec2.toArray(o,d)}}vectorSubdivide(e,t,r,i,o){let s,a=t.next(),l=t.next(),c=t.next();const u=t.size,d=u-1;let h=i||0;for(let m=0;m<d;++m)s=a,a=l,l=c,c=t.next(),e.apply(this,[s,a,l,c,r,h]),h+=3*this.m;o&&(s=t.get(u-2),a=t.get(u-1),l=t.get(0),c=t.get(1),e.apply(this,[s,a,l,c,r,h]),h+=3*this.m)}getPosition(e,t,r,i){e.reset(),this.vectorSubdivide(this.interpolatePosition,e,t,r,i);var o=e.size-1,s=o*this.m*3;i&&(s+=3*this.m);var a=e.get(i?0:o);t[s]=a.x,t[s+1]=a.y,t[s+2]=a.z}getTangent(e,t,r,i){e.reset(),this.vectorSubdivide(this.interpolateTangent,e,t,r,i);let o=(e.size-1)*this.m*3;i&&(o+=3*this.m),Kn(t,t,o-3,o,3)}interpolateNormalDir(e,t,r,i,o,s,a,l,c,u,d,h,m){for(let f=0;f<this.m;++f){let v=h+3*f;m&&(v+=3*this.m2);const g=this.dt*f;this.interpolateToVec(e,t,r,i,g,this.vec1),this.interpolateToVec(o,s,a,l,g,this.vec2),this.vDir.subVectors(this.vec2,this.vec1).normalize(),this.vTan.fromArray(c,v),this.vBin.crossVectors(this.vDir,this.vTan).normalize(),this.vBin.toArray(d,v),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(u,v)}}interpolateNormal(e,t,r,i,o){for(var s=0;s<this.m;++s){var a=o+3*s;e.copy(this.vNorm),this.vTan.fromArray(t,a),this.vBin.crossVectors(e,this.vTan).normalize(),this.vBin.toArray(i,a),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(r,a)}}getNormal(e,t,r,i,o,s){this.vNorm.set(0,0,1);const a=e-1;let l=o||0;for(var c=0;c<a;++c)this.interpolateNormal(this.vDir,t,r,i,l),l+=3*this.m;s&&(this.interpolateNormal(this.vDir,t,r,i,l),l+=3*this.m),this.vBin.toArray(i,l),this.vNorm.toArray(r,l)}getNormalDir(e,t,r,i,o,s,a,l){e.reset(),t.reset();const c=new te,u=new te,d=new te,h=new te,m=new te,f=new te().copy(e.next()),v=new te().copy(e.next()),g=new te().copy(e.next()),b=new te,S=new te().copy(t.next()),p=new te().copy(t.next()),y=new te().copy(t.next());this.vNorm.set(0,0,1);let w=e.size,x=w-1,_=s||0;for(var A=0;A<x;++A)m.copy(f),f.copy(v),v.copy(g),g.copy(e.next()),b.copy(S),S.copy(p),p.copy(y),y.copy(t.next()),A===0?(c.subVectors(b,m),u.subVectors(S,f),c.dot(u)<0&&(u.multiplyScalar(-1),S.addVectors(f,u)),d.subVectors(p,v),u.dot(d)<0&&(d.multiplyScalar(-1),p.addVectors(v,d))):d.copy(h),h.subVectors(y,g),d.dot(h)<0&&(h.multiplyScalar(-1),y.addVectors(g,h)),this.interpolateNormalDir(m,f,v,g,b,S,p,y,r,i,o,_,l),_+=3*this.m;if(a&&(m.copy(e.get(w-2)),f.copy(e.get(w-1)),v.copy(e.get(0)),g.copy(e.get(1)),b.copy(t.get(w-2)),S.copy(t.get(w-1)),p.copy(t.get(0)),y.copy(t.get(1)),d.copy(h),h.subVectors(y,g),d.dot(h)<0&&(h.multiplyScalar(-1),y.addVectors(g,h)),this.interpolateNormalDir(m,f,v,g,b,S,p,y,r,i,o,_,l),_+=3*this.m),l){this.vBin.fromArray(o,3*this.m2),this.vNorm.fromArray(i,3*this.m2);for(var C=0;C<this.m2;++C)this.vBin.toArray(o,3*C),this.vNorm.toArray(i,3*C)}else this.vBin.toArray(o,_),this.vNorm.toArray(i,_)}interpolateColor(e,t,r,i,o){var s,a;for(s=0;s<this.m2;++s)a=o+3*s,r.apply(this,[e,i,a]);for(s=this.m2;s<this.m;++s)a=o+3*s,r.apply(this,[t,i,a])}getColor(e,t,r,i,o){let s;e.reset(),e.next();let a=e.next();for(var l=e.size,c=l-1,u=i||0,d=0;d<c;++d)s=a,a=e.next(),this.interpolateColor(s,a,t,r,u),u+=3*this.m;o&&(s=e.get(l-1),a=e.get(0),this.interpolateColor(s,a,t,r,u),u+=3*this.m),r[u]=r[u-3],r[u+1]=r[u-2],r[u+2]=r[u-1]}interpolatePicking(e,t,r,i,o){var s;for(s=0;s<this.m2;++s)i[o+s]=r.apply(this,[e]);for(s=this.m2;s<this.m;++s)i[o+s]=r.apply(this,[t])}getPicking(e,t,r,i,o){let s;e.reset(),e.next();let a=e.next();const l=e.size,c=l-1;let u=i||0;for(var d=0;d<c;++d)s=a,a=e.next(),this.interpolatePicking(s,a,t,r,u),u+=this.m;o&&(s=e.get(l-1),a=e.get(0),this.interpolatePicking(s,a,t,r,u),u+=this.m),r[u]=r[u-1]}interpolateSize(e,t,r,i,o){const s=r.apply(this,[e]),a=r.apply(this,[t]);for(let l=0;l<this.m;++l){let c=l/this.m;i[o+l]=(1-c)*s+c*a}}getSize(e,t,r,i,o){let s;e.reset(),e.next();let a=e.next();const l=e.size,c=l-1;let u=i||0;for(var d=0;d<c;++d)s=a,a=e.next(),this.interpolateSize(s,a,t,r,u),u+=this.m;o&&(s=e.get(l-1),a=e.get(0),this.interpolateSize(s,a,t,r,u),u+=this.m),r[u]=r[u-1]}}class Pc{constructor(e,t){this.polymer=e,this.size=e.residueCount;var r=t||{};this.directional=r.directional||!1,this.positionIterator=r.positionIterator||!1,this.subdiv=r.subdiv||1,this.smoothSheet=r.smoothSheet||!1,r.tension?this.tension=r.tension:this.tension=this.polymer.isNucleic()?.5:.9,this.interpolator=new Fq(this.subdiv,this.tension)}getAtomIterator(e,t){const r=this.polymer,i=r.structure,o=r.residueCount;let s=0,a=-1;const l=[i.getAtomProxy(),i.getAtomProxy(),i.getAtomProxy(),i.getAtomProxy()],c=[new te,new te,new te,new te];var u=i.getAtomProxy(),d=i.getAtomProxy();function h(m){var f=l[s%4];if(f.index=r.getAtomIndexByType(m,e),t&&m>0&&m<o&&f.sstruc==="e"){var v=c[s%4];return u.index=r.getAtomIndexByType(m+1,e),d.index=r.getAtomIndexByType(m-1,e),v.addVectors(u,d).add(f).add(f).multiplyScalar(.25),s+=1,v}return s+=1,f}return{size:o,next:function(){var m=h(a);return a+=1,m},get:h,reset:function(){s=0,a=-1}}}getSubdividedColor(e){var t=this.subdiv,r=this.polymer,i=(r.residueCount-1)*t*3+3;r.isCyclic&&(i+=3*t);var o=new Float32Array(i),s=this.getAtomIterator("trace"),a=e||{};a.structure=r.structure;var l=Xt.getScheme(a);return this.interpolator.getColor(s,function(c,u,d){l.atomColorToArray(c,u,d)},o,0,r.isCyclic),{color:o}}getSubdividedPicking(){var e=this.subdiv,t=this.polymer,r=(t.residueCount-1)*e+1;t.isCyclic&&(r+=e);var i=t.structure,o=this.getAtomIterator("trace"),s=new Float32Array(r);return this.interpolator.getPicking(o,function(a){return a.index},s,0,t.isCyclic),{picking:new gl(s,i)}}getSubdividedPosition(){return{position:this.getPosition()}}getSubdividedOrientation(){const e=this.getTangent(),t=this.getNormals(e);return{tangent:e,normal:t.normal,binormal:t.binormal}}getSubdividedSize(e){var t=this.subdiv,r=this.polymer,i=(r.residueCount-1)*t+1;r.isCyclic&&(i+=t);var o=new Float32Array(i),s=this.getAtomIterator("trace"),a=new is(e);return this.interpolator.getSize(s,function(l){return a.atomRadius(l)},o,0,r.isCyclic),{size:o}}getPosition(){const e=this.subdiv,t=this.polymer;let r=(t.residueCount-1)*e*3+3;t.isCyclic&&(r+=3*e);const i=new Float32Array(r),o=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getPosition(o,i,0,t.isCyclic),i}getTangent(){const e=this.subdiv,t=this.polymer;let r=(this.size-1)*e*3+3;t.isCyclic&&(r+=3*e);const i=new Float32Array(r),o=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getTangent(o,i,0,t.isCyclic),i}getNormals(e){const t=this.subdiv,r=this.polymer,i=r.isProtein(),o=this.size;let s=(o-1)*t*3+3;r.isCyclic&&(s+=3*t);const a=new Float32Array(s),l=new Float32Array(s);if(this.directional&&!this.polymer.isCg()){const c=this.getAtomIterator("direction1"),u=this.getAtomIterator("direction2");this.interpolator.getNormalDir(c,u,e,a,l,0,r.isCyclic,i)}else this.interpolator.getNormal(o,e,a,l,0,r.isCyclic);return{normal:a,binormal:l}}}const OS=new te,Zh=new te,Oq=Object.assign({radialSegments:4,capped:!1,aspectRatio:1},zr);class kq extends rs{constructor(e,t={}){super(function(r,i={}){const o=W(i.radialSegments,4),s=W(i.capped,!1),a=s?o:0,l=s?o-2:0,c=r.position.length/3,u=c*o*3+2*a*3,d=2*(c-1)*o*3+2*l*3;return{position:new Float32Array(u),color:new Float32Array(u),index:To(d,u/3),normal:new Float32Array(u),picking:r.picking}}(e,t),t),this.capVertices=this.parameters.capped?this.parameters.radialSegments:0,this.capTriangles=this.parameters.capped?this.parameters.radialSegments-2:0,this.size2=e.position.length/3,e.primitiveId=Wc(this.size2),this.setAttributes(e),this.makeIndex()}get defaultParameters(){return Oq}setAttributes(e={}){const t=this.parameters.aspectRatio,r=this.size2,i=r-1,o=this.parameters.radialSegments,s=this.geometry.attributes;let a,l,c,u,d,h,m,f,v,g,b,S,p;e.position&&(a=e.position,l=e.normal,c=e.binormal,u=e.tangent,h=e.size,f=s.position.array,g=s.normal.array,s.position.needsUpdate=!0,s.normal.needsUpdate=!0),e.color&&(d=e.color,v=s.color.array,s.color.needsUpdate=!0),e.primitiveId&&(m=e.primitiveId,b=s.primitiveId.array,s.primitiveId.needsUpdate=!0);let y=0,w=0,x=0,_=0,A=0,C=0,T=0,I=0,M=0,P=0;const E=[],R=[],B=[],L=[],F=[],H=[];if(a)for(let $=0;$<o;++$){const O=$/o*2*Math.PI;E[$]=t*Math.cos(O),R[$]=Math.sin(O),B[$]=t*Math.cos(O-.01),L[$]=Math.sin(O-.01),F[$]=t*Math.cos(O+.01),H[$]=Math.sin(O+.01)}for(let $=0;$<r;++$){S=3*$,p=S*o,a&&u&&l&&c&&h&&(OS.set(u[S],u[S+1],u[S+2]),w=l[S],x=l[S+1],_=l[S+2],A=c[S],C=c[S+1],T=c[S+2],I=a[S],M=a[S+1],P=a[S+2],y=h[$]);for(let O=0;O<o;++O){const k=p+3*O;if(a){const X=-y*E[O],ie=y*R[O],ne=-y*B[O],Q=y*L[O],ce=-y*F[O],Z=y*H[O];f[k]=I+X*w+ie*A,f[k+1]=M+X*x+ie*C,f[k+2]=P+X*_+ie*T,Zh.set(ce*w+Z*A-(ne*w+Q*A),ce*x+Z*C-(ne*x+Q*C),ce*_+Z*T-(ne*_+Q*T)).cross(OS),g[k]=Zh.x,g[k+1]=Zh.y,g[k+2]=Zh.z}d&&(v[k]=d[S],v[k+1]=d[S+1],v[k+2]=d[S+2]),m&&(b[$*o+O]=m[$])}}S=0,p=3*r*o;for(let $=0;$<o;++$){const O=S+3*$,k=p+3*$;a&&u&&(f[k]=f[O],f[k+1]=f[O+1],f[k+2]=f[O+2],g[k]=u[S],g[k+1]=u[S+1],g[k+2]=u[S+2]),d&&(v[k]=v[O],v[k+1]=v[O+1],v[k+2]=v[O+2]),m&&(b[r*o+$]=b[0+$])}S=3*(r-1)*o,p=3*(r+1)*o;for(let $=0;$<o;++$){const O=S+3*$,k=p+3*$;a&&u&&(f[k]=f[O],f[k+1]=f[O+1],f[k+2]=f[O+2],g[k]=u[3*i],g[k+1]=u[3*i+1],g[k+2]=u[3*i+2]),d&&(v[k]=v[O],v[k+1]=v[O+1],v[k+2]=v[O+2]),m&&(b[(r+1)*o+$]=b[(r-1)*o+$])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void Be.error("Index is null");const t=e.array,r=this.size2,i=r-1,o=this.capTriangles,s=this.parameters.radialSegments,a=this.parameters.radialSegments+1;let l,c;for(let d=0;d<i;++d){const h=d*s*3*2,m=d*s,f=(d+1)*s;for(let v=0;v<s;++v)c=h+3*v*2,t[c]=m+v,t[c+1]=m+(v+1)%s,t[c+2]=f+v,t[c+3]=f+v,t[c+4]=m+(v+1)%s,t[c+5]=f+(v+1)%s}const u=[0];for(let d=1;d<a/2;++d)u.push(d),s-d!==d&&u.push(s-d);c=i*s*3*2,l=r*s;for(let d=0;d<u.length-2;++d)d%2==0?(t[c+3*d+0]=l+u[d+0],t[c+3*d+1]=l+u[d+1],t[c+3*d+2]=l+u[d+2]):(t[c+3*d+0]=l+u[d+2],t[c+3*d+1]=l+u[d+1],t[c+3*d+2]=l+u[d+0]);c=i*s*3*2+3*o,l=r*s+s;for(let d=0;d<u.length-2;++d)d%2==0?(t[c+3*d+0]=l+u[d+0],t[c+3*d+1]=l+u[d+1],t[c+3*d+2]=l+u[d+2]):(t[c+3*d+0]=l+u[d+2],t[c+3*d+1]=l+u[d+1],t[c+3*d+2]=l+u[d+0])}}class py extends br{constructor(e,t,r){super(e,t,r),this.type="cartoon",this.parameters=Object.assign({aspectRatio:{type:"number",precision:1,max:10,min:1,rebuild:!0},subdiv:{type:"integer",max:50,min:1,rebuild:!0},radialSegments:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},capped:{type:"boolean",rebuild:!0},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters),this.init(r)}init(e){var t=e||{};t.colorScheme=W(t.colorScheme,"chainname"),t.colorScale=W(t.colorScale,"RdYlBu"),t.radiusType=W(t.radiusType,"sstruc"),t.radiusScale=W(t.radiusScale,.7),t.useInteriorColor=W(t.useInteriorColor,!0),this.aspectRatio=W(t.aspectRatio,5),this.tension=W(t.tension,NaN),this.capped=W(t.capped,!0),this.smoothSheet=W(t.smoothSheet,!1),t.quality==="low"?(this.subdiv=3,this.radialSegments=6):t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=W(t.subdiv,6),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:this.aspectRatio!==1,smoothSheet:this.smoothSheet},e)}getSpline(e){return new Pc(e,this.getSplineParams())}getAspectRatio(e){return e.isCg()?1:this.aspectRatio}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){let t=[],r=[];return this.structure.eachPolymer(i=>{if(i.residueCount<4)return;r.push(i);const o=this.getSpline(i),s=this.getAspectRatio(i),a=o.getSubdividedPosition(),l=o.getSubdividedOrientation(),c=o.getSubdividedColor(this.getColorParams()),u=o.getSubdividedPicking(),d=o.getSubdividedSize(this.getRadiusParams());t.push(new kq(Object.assign({},a,l,c,u,d),this.getBufferParams({radialSegments:this.radialSegments,aspectRatio:s,capped:this.capped})))},e.getSelection()),{bufferList:t,polymerList:r}}updateData(e,t){Xe&&Be.time(this.type+" repr update"),e=e||{};for(var r=0,i=t.polymerList.length;r<i;++r){var o={},s=t.polymerList[r],a=this.getSpline(s),l=this.getAspectRatio(s);if(Object.assign(t.bufferList[r],{aspectRatio:l}),e.position||e.radius){var c=a.getSubdividedPosition(),u=a.getSubdividedOrientation(),d=a.getSubdividedSize(this.getRadiusParams(l));o.position=c.position,o.normal=u.normal,o.binormal=u.binormal,o.tangent=u.tangent,o.size=d.size}if(e.color){var h=a.getSubdividedColor(this.getColorParams());o.color=h.color}if(e.picking){var m=a.getSubdividedPicking();o.picking=m.picking}t.bufferList[r].setAttributes(o)}Xe&&Be.timeEnd(this.type+" repr update")}setParameters(e){var t={};return e&&e.aspectRatio&&(t.radius=!0),e&&e.tension&&(t.position=!0),super.setParameters(e,t,!1),this}}xn.add("cartoon",py);class Bq extends br{constructor(e,t,r){super(e,t,r),this.type="contact",this.parameters=Object.assign({hydrogenBond:{type:"boolean",rebuild:!0},weakHydrogenBond:{type:"boolean",rebuild:!0},waterHydrogenBond:{type:"boolean",rebuild:!0},backboneHydrogenBond:{type:"boolean",rebuild:!0},hydrophobic:{type:"boolean",rebuild:!0},halogenBond:{type:"boolean",rebuild:!0},ionicInteraction:{type:"boolean",rebuild:!0},metalCoordination:{type:"boolean",rebuild:!0},cationPi:{type:"boolean",rebuild:!0},piStacking:{type:"boolean",rebuild:!0},filterSele:{type:"text",rebuild:!0},labelVisible:{type:"boolean",rebuild:!0},labelFixedSize:{type:"boolean",buffer:"fixedSize"},labelSize:{type:"number",precision:3,max:10,min:.001,rebuild:!0},labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},maxHydrophobicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondSulfurDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondAccAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondDonAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondAccPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxHbondDonPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxPiStackingDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingAngle:{type:"integer",max:180,min:0,rebuild:!0},maxCationPiDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxCationPiOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxIonicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondAngle:{type:"integer",max:180,min:0,rebuild:!0},maxMetalDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},refineSaltBridges:{type:"boolean",rebuild:!0},masterModelIndex:{type:"integer",max:1e3,min:-1,rebuild:!0},lineOfSightDistFactor:{type:"number",precision:1,max:10,min:0,rebuild:!0},radialSegments:!0,disableImpostor:!0},this.parameters),this.init(r)}init(e){var t=e||{};t.radiusSize=W(t.radiusSize,.05),t.useInteriorColor=W(t.useInteriorColor,!0),this.hydrogenBond=W(t.hydrogenBond,!0),this.weakHydrogenBond=W(t.weakHydrogenBond,!1),this.waterHydrogenBond=W(t.waterHydrogenBond,!1),this.backboneHydrogenBond=W(t.backboneHydrogenBond,!1),this.hydrophobic=W(t.hydrophobic,!1),this.halogenBond=W(t.halogenBond,!0),this.ionicInteraction=W(t.ionicInteraction,!0),this.metalCoordination=W(t.metalCoordination,!0),this.cationPi=W(t.cationPi,!0),this.piStacking=W(t.piStacking,!0),this.filterSele=W(t.filterSele,""),this.labelVisible=W(t.labelVisible,!1),this.labelFixedSize=W(t.labelFixedSize,!1),this.labelSize=W(t.labelSize,2),this.labelUnit=W(t.labelUnit,""),this.maxHydrophobicDist=W(t.maxHydrophobicDist,4),this.maxHbondDist=W(t.maxHbondDist,3.5),this.maxHbondSulfurDist=W(t.maxHbondSulfurDist,4.1),this.maxHbondAccAngle=W(t.maxHbondAccAngle,45),this.maxHbondDonAngle=W(t.maxHbondDonAngle,45),this.maxHbondAccPlaneAngle=W(t.maxHbondAccPlaneAngle,90),this.maxHbondDonPlaneAngle=W(t.maxHbondDonPlaneAngle,30),this.maxPiStackingDist=W(t.maxPiStackingDist,5.5),this.maxPiStackingOffset=W(t.maxPiStackingOffset,2),this.maxPiStackingAngle=W(t.maxPiStackingAngle,30),this.maxCationPiDist=W(t.maxCationPiDist,6),this.maxCationPiOffset=W(t.maxCationPiOffset,2),this.maxIonicDist=W(t.maxIonicDist,5),this.maxHalogenBondDist=W(t.maxHalogenBondDist,3.5),this.maxHalogenBondAngle=W(t.maxHalogenBondAngle,30),this.maxMetalDist=W(t.maxMetalDist,3),this.refineSaltBridges=W(t.refineSaltBridges,!0),this.masterModelIndex=W(t.masterModelIndex,-1),this.lineOfSightDistFactor=W(t.lineOfSightDistFactor,1),super.init(t)}getAtomRadius(){return 0}getContactData(e){const t={maxHydrophobicDist:this.maxHydrophobicDist,maxHbondDist:this.maxHbondDist,maxHbondSulfurDist:this.maxHbondSulfurDist,maxHbondAccAngle:this.maxHbondAccAngle,maxHbondDonAngle:this.maxHbondDonAngle,maxHbondAccPlaneAngle:this.maxHbondAccPlaneAngle,maxHbondDonPlaneAngle:this.maxHbondDonPlaneAngle,maxPiStackingDist:this.maxPiStackingDist,maxPiStackingOffset:this.maxPiStackingOffset,maxPiStackingAngle:this.maxPiStackingAngle,maxCationPiDist:this.maxCationPiDist,maxCationPiOffset:this.maxCationPiOffset,maxIonicDist:this.maxIonicDist,maxHalogenBondDist:this.maxHalogenBondDist,maxHalogenBondAngle:this.maxHalogenBondAngle,maxMetalDist:this.maxMetalDist,refineSaltBridges:this.refineSaltBridges,masterModelIndex:this.masterModelIndex,lineOfSightDistFactor:this.lineOfSightDistFactor},r={hydrogenBond:this.hydrogenBond,weakHydrogenBond:this.weakHydrogenBond,waterHydrogenBond:this.waterHydrogenBond,backboneHydrogenBond:this.backboneHydrogenBond,hydrophobic:this.hydrophobic,halogenBond:this.halogenBond,ionicInteraction:this.ionicInteraction,metalCoordination:this.metalCoordination,cationPi:this.cationPi,piStacking:this.piStacking,radius:this.radiusSize*this.radiusScale,filterSele:this.filterSele};return AW(wW(e,t),e,r)}createData(e){const t=this.getContactData(e),r=[new cs(jG(t),this.getBufferParams({sphereDetail:1,dullInterior:!0,disableImpostor:this.disableImpostor}))];if(this.labelVisible){const i={size:this.labelSize,unit:this.labelUnit};r.push(new Yc(function(o,s){const a=So(o.position1,o.position2),l=[],c=pm(o.position1,o.position2),u=c.length/3;for(let d=0;d<u;d++){const h=3*d,m=Math.sqrt(Math.pow(c[h],2)+Math.pow(c[h+1],2)+Math.pow(c[h+2],2));switch(s.unit){case"angstrom":l[d]=m.toFixed(2)+" Å";break;case"nm":l[d]=(m/10).toFixed(2)+" nm";break;default:l[d]=m.toFixed(2)}}return{position:a,size:fi(a.length/3,s.size),color:o.color,text:l}}(t,i),this.getBufferParams({fixedSize:this.labelFixedSize})))}return{bufferList:r}}}xn.add("contact",Bq);class Nq extends dy{constructor(e,t,r){super(e,t,r),this.type="dihedral",this.parameters=Object.assign({atomQuad:{type:"hidden",rebuild:!0},extendLine:{type:"boolean",rebuild:!0,default:!0},lineVisible:{type:"boolean",default:!0},planeVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(r)}init(e){const t=e||{};t.side=W(t.side,"double"),t.opacity=W(t.opacity,.5),this.atomQuad=W(t.atomQuad,[]),this.extendLine=W(t.extendLine,!0),this.lineVisible=W(t.lineVisible,!0),this.planeVisible=W(t.planeVisible,!0),this.sectorVisible=W(t.sectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomQuad.length)return;const t=function(a,l={}){const c=W(l.angleStep,Math.PI/90),u=a.length,d=a.length/12,h=new Float32Array(d),m=new Float32Array(3*d),f=new Array(d),v=new Array(d),g=new Array(d),b=new Array(d),S=new Array(d);let p=0,y=0,w=0;const x=Lt(),_=Lt(),A=Lt(),C=Lt(),T=Lt(),I=Lt(),M=Lt(),P=Lt(),E=Lt(),R=Lt(),B=Lt(),L=Lt(),F=Lt(),H=Lt(),$=Lt();let O=0;for(var k=0;k<u;k+=12){if(Fr(x,a,k),Fr(_,a,k+3),Fr(A,a,k+6),Fr(C,a,k+9),In(T,x,_),In(I,A,_),$s(I)===0)continue;In(M,C,A),dn(P,I,.5),Gi(E,_,P),On(T,T),On(I,I),On(M,M),In(P,x,E);const fe=Gr(P,I)>0;In(P,C,E);const ue=Gr(P,I)<0;if(dn(P,I,Gr(I,T)),In(R,T,P),dn(P,I,Gr(I,M)),In(B,M,P),$s(R)===0||$s(B)===0)continue;On(R,R),On(B,B);const U=h[O]=WG(R,B);f[O]=(GE*U).toFixed(1)+"°",Zr(H,R,I),On(H,H),Gr(H,B)<0&&gm(H,H),Hi(P,E,R,H,U/2),Bt(P,m,3*O);const K=Math.ceil(U/c),be=K+(l.extendLine?4:2),me=l.extendLine?36:0,le=new Float32Array(3*be),xe=new Float32Array(3*be),pe=new Float32Array(9*K),ye=new Float32Array(me);v[O]=le,g[O]=xe,b[O]=pe,S[O]=ye,l.extendLine&&(fe?(In(P,x,A),On(P,P),dn(L,P,1/Gr(R,P)),Gi(L,L,A)):(dn(L,T,1/Gr(R,T)),Gi(L,L,_)),ue?(In(P,C,_),On(P,P),dn(F,P,1/Gr(B,P)),Gi(F,F,_)):(dn(F,M,1/Gr(B,M)),Gi(F,F,A))),Gi($,E,R);let Me=0;l.extendLine?(Bt(x,le,Me),Bt(L,xe,Me),Me+=3,Bt(L,le,Me),Bt($,xe,Me),Me+=3,Bt(L,ye,0),Bt($,ye,3),Bt(fe?A:_,ye,6),Bt(fe?A:_,ye,9),Bt($,ye,12),Bt(E,ye,15)):(Bt(E,le,Me),Bt($,xe,Me),Me+=3);const Ce=function(D,q){const _e=9*q;Bt(E,pe,_e),Bt($,pe,_e+3),Bt($,le,Me),Hi($,E,R,H,D),Bt($,pe,_e+6),Bt($,xe,Me),Me+=3};let z=0;for(let D=c;D<U;D+=c)Ce(D,z++);Ce(U,z++),l.extendLine?(Bt($,le,3*(be-2)),Bt(F,xe,3*(be-2)),Bt(F,le,3*(be-1)),Bt(C,xe,3*(be-1)),Bt(F,ye,18),Bt($,ye,21),Bt(ue?_:A,ye,24),Bt(ue?_:A,ye,27),Bt($,ye,30),Bt(E,ye,33)):(Bt($,le,Me),Bt(E,xe,Me),Me+=3),p+=3*be,y+=9*K,w+=me,O+=1}const X=O,ie=new Float32Array(p),ne=new Float32Array(p),Q=new Float32Array(y),ce=new Float32Array(w);let Z=0,re=0,se=0;for(let fe=0;fe<X;fe++){const ue=v[fe],U=g[fe],K=b[fe],be=S[fe];Kn(ue,ie,0,Z,ue.length),Kn(U,ne,0,Z,U.length),Kn(K,Q,0,re,K.length),Kn(be,ce,0,se,be.length),Z+=ue.length,re+=K.length,se+=be.length}return{labelPosition:m.subarray(0,3*X),labelText:f.slice(0,X),linePosition1:ie,linePosition2:ne,planePosition:ce,sectorPosition:Q}}(hy(e,this.atomQuad),{extendLine:this.extendLine}),r=this.n=t.labelText.length,i=new _t(this.labelColor);this.textBuffer=new Yc({position:t.labelPosition,size:fi(r,this.labelSize),color:un(r,i.r,i.g,i.b),text:t.labelText},this.getLabelBufferParams());const o=new _t(this.colorValue);this.lineLength=t.linePosition1.length/3;const s=un(this.lineLength,o.r,o.g,o.b);return this.lineBuffer=new os(dv({position1:t.linePosition1,position2:t.linePosition2,color:s,color2:s}),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),this.planeLength=t.planePosition.length/3,this.planeBuffer=new rs({position:t.planePosition,color:un(this.planeLength,o.r,o.g,o.b)},this.getBufferParams({visible:this.planeVisible})),this.sectorLength=t.sectorPosition.length/3,this.sectorBuffer=new rs({position:t.sectorPosition,color:un(this.sectorLength,o.r,o.g,o.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.lineBuffer,this.planeBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const r={},i={},o={};if(e.color){const s=new _t(this.colorValue);Object.assign(r,{color:un(this.lineLength,s.r,s.g,s.b),color2:un(this.lineLength,s.r,s.g,s.b)}),Object.assign(i,{color:un(this.planeLength,s.r,s.g,s.b)}),Object.assign(o,{color:un(this.sectorLength,s.r,s.g,s.b)})}this.lineBuffer.setAttributes(r),this.planeBuffer.setAttributes(i),this.sectorBuffer.setAttributes(o)}setParameters(e){return super.setParameters(e,{},!1),!e||e.lineVisible===void 0&&e.sectorVisible===void 0&&e.planeVisible===void 0||this.setVisibility(this.visible),e&&e.lineOpacity&&this.lineBuffer.setParameters({opacity:e.lineOpacity}),e&&e.opacity!==void 0&&this.lineBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.lineBuffer.setParameters({linewidth:e.linewidth}),this}setVisibility(e,t){return super.setVisibility(e,!0),this.lineBuffer&&this.lineBuffer.setVisibility(this.lineVisible&&this.visible),this.planeBuffer&&this.planeBuffer.setVisibility(this.planeVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}xn.add("dihedral",Nq);function w0(n,e){function t(i,o){return o in i}const r=Object.assign({},n);for(const i in r)t(r,i)&&t(e,i)&&(r[i]=W(e[i],r[i]));return r}function Bi(n,e){const t=new _t(n),r=new Float32Array(3*e);return un(e,t.r,t.g,t.b,r),r}class zq extends br{constructor(e,t,r){super(e,t,r),this.type="dihedral-histogram",this.parameters=Object.assign({histogramsData:{type:"hidden",rebuild:!0},histogramBinBorderVisible:{type:"boolean",default:!0},scaleBinToSectorArea:{type:"boolean",rebuild:!0,default:!1}},this.parameters),this.init(r)}init(e){const t=e||{},r=w0({histogramBinBorderColor:"grey",adjacentBondArrowColor:"black",distantBondArrowColor:"magenta",frontHistogramColor:"green",backHistogramColor:"blue",opaqueMiddleDiscColor:"white"},t);Object.assign(this,r);const i=w0({histogramsData:[],histogramOpacity:1,opaqueMiddleDiscVisible:!0,opaqueMiddleDiscOpacity:1,histogramBinBorderVisible:!0,histogramBinBorderWidth:1,histogramBinBorderOpacity:.5,bondArrowVisible:!0,bondArrowWidth:2,bondArrowOpacity:1,scaleBinToSectorArea:!1},t);Object.assign(this,i),this.histogramsData.forEach(o=>{const s=w0(r,o);Object.assign(o,s)}),t.side=W(t.side,"double"),t.opacity=W(t.opacity,.5),t.radiusType=W(t.radiusType,"size"),t.radiusSize=W(t.radiusSize,.15),super.init(t)}getHistogramBinBorderBufferParameters(){return this.getBufferParams({linewidth:this.histogramBinBorderWidth,visible:this.histogramBinBorderVisible,opacity:this.histogramBinBorderOpacity})}getBondArrowsBufferParameters(){return this.getBufferParams({linewidth:this.bondArrowWidth,visible:this.bondArrowVisible,opacity:this.bondArrowOpacity})}getOpaqueMiddleDiscBufferParameters(){return this.getBufferParams({visible:this.opaqueMiddleDiscVisible,opacity:this.opaqueMiddleDiscOpacity})}getHistogramBufferParameters(){return this.getBufferParams({visible:!0,opacity:this.histogramOpacity,side:"double"})}createData(e){if(!e.atomCount||!this.histogramsData.length)return;this.histogramsData.forEach(a=>a.atomPositions=hy(e,[a.atomQuad]));const t=this.scaleBinToSectorArea?function(a){return Math.sqrt(a)}:function(a){return a};function r(a){const l=a.map(d=>d.length),c=new Float32Array(Zb(l));let u=0;for(let d=0;d<a.length;d++)c.set(a[d],u),u+=a[d].length;return c}function i(a,l){return new os({position1:r(a.map(c=>c.startPoints)),position2:r(a.map(c=>c.endPoints)),color:r(a.map(c=>c.startColors)),color2:r(a.map(c=>c.endColors))},l)}function o(a,l){return new rs({position:r(a.map(c=>c.triangles)),color:r(a.map(c=>c.triangleColors))},l)}this.histogramsData.forEach(a=>a.histogram360Scaled=a.histogram360.map(t));const s=[];for(let a=0;a<this.histogramsData.length;a++){let l,c=this.histogramsData[a];c.histogram360.length>=3&&(l=Uq(c)),l!==void 0&&s.push(l)}return this.frontHistogramBinBordersBuffer=i(s.map(a=>a.frontHistogramBinBorders),this.getHistogramBinBorderBufferParameters()),this.backHistogramBinBordersBuffer=i(s.map(a=>a.backHistogramBinBorders),this.getHistogramBinBorderBufferParameters()),this.adjacentBondArrowsBuffer=i(s.map(a=>a.adjacentBondArrows),this.getBondArrowsBufferParameters()),this.distantBondArrowsBuffer=i(s.map(a=>a.distantBondArrows),this.getBondArrowsBufferParameters()),this.opaqueMiddleDiscBuffer=o(s.map(a=>a.opaqueMiddleDisc),this.getOpaqueMiddleDiscBufferParameters()),this.frontHistogramBuffer=o(s.map(a=>a.frontHistogram),this.getHistogramBufferParameters()),this.backHistogramBuffer=o(s.map(a=>a.backHistogram),this.getHistogramBufferParameters()),{bufferList:[].concat(this.frontHistogramBinBordersBuffer,this.backHistogramBinBordersBuffer,this.adjacentBondArrowsBuffer,this.distantBondArrowsBuffer,this.opaqueMiddleDiscBuffer,this.frontHistogramBuffer,this.backHistogramBuffer)}}setParameters(e){return super.setParameters(e,{},!1),e&&e.histogramBinBorderVisible!==void 0&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.frontHistogramBinBordersBuffer&&this.frontHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),this.backHistogramBinBordersBuffer&&this.backHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),t||this.viewer.requestRender(),this}}function Uq(n){const e=n.atomPositions,t=n.histogram360Scaled,r=t.length<=180?360:2*t.length,i={triangles:new Float32Array(3*r*3),triangleColors:Bi(n.opaqueMiddleDiscColor,3*r)},o={triangles:new Float32Array(3*t.length*3),triangleColors:Bi(n.frontHistogramColor,3*t.length)},s={triangles:new Float32Array(3*t.length*3),triangleColors:Bi(n.backHistogramColor,3*t.length)},a={startPoints:new Float32Array(3*t.length),endPoints:new Float32Array(3*t.length),startColors:Bi(n.histogramBinBorderColor,t.length),endColors:Bi(n.histogramBinBorderColor,t.length)},l={startPoints:new Float32Array(3*t.length),endPoints:new Float32Array(3*t.length),startColors:Bi(n.histogramBinBorderColor,t.length),endColors:Bi(n.histogramBinBorderColor,t.length)},c={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:Bi(n.adjacentBondArrowColor,t.length),endColors:Bi(n.adjacentBondArrowColor,t.length)},u={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:Bi(n.distantBondArrowColor,t.length),endColors:Bi(n.distantBondArrowColor,t.length)},d=Lt(),h=Lt(),m=Lt(),f=Lt(),v=Lt(),g=Lt(),b=Lt(),S=Lt(),p=Lt(),y=Lt(),w=Lt(),x=Lt(),_=Lt(),A=Lt(),C=Lt(),T=Lt(),I=[d,h,m,f];for(let H=0;H<I.length;H++)Fr(I[H],e,3*H);if(In(v,d,h),In(g,m,h),In(S,f,m),$s(g)===0||(dn(C,g,.5),Gi(p,h,C),On(v,v),On(g,g),On(S,S),gm(b,g),dn(C,b,Gr(b,v)),In(y,v,C),dn(C,g,Gr(g,S)),In(w,S,C),$s(y)===0||$s(w)===0))return;On(y,y),On(w,w);const M=Math.acos(Gr(y,w));Zr(x,b,y),Zr(_,g,w),On(x,x),On(_,_);let P=M;Gr(x,w)<0&&(P=-M),Gi(A,p,y);const E=Math.max.apply(null,t),R=2*Math.PI/t.length;function B(H,$,O,k,X){const ie=3*$*3;Bt(p,H,ie);const ne=Number(t[$])/E;dn(C,O,ne),dn(T,k,ne),Hi(A,p,C,T,$*X),Bt(A,H,ie+3),Hi(A,p,C,T,($+1)*X),Bt(A,H,ie+6)}function L(H,$,O,k,X){Kn(p,c.startPoints,0,3*O,p.length),Hi(C,p,k,X,0+0*R),Kn(C,c.endPoints,0,3*O,p.length),Kn(p,u.startPoints,0,3*O,p.length),Hi(C,p,k,X,P),Kn(C,u.endPoints,0,3*O,p.length);for(let ie=0;ie<t.length;ie++)Kn(p,$.startPoints,0,3*ie,p.length),Hi(C,p,k,X,0+R*ie),Kn(C,$.endPoints,0,3*ie,C.length);for(let ie=0;ie<t.length;ie++)B(H.triangles,ie,k,X,R)}const F=2*Math.PI/r;for(let H=0;H<r;H++){const $=3*H*3;Bt(p,i.triangles,$),Hi(A,p,y,x,H*F),Bt(A,i.triangles,$+3),Hi(A,p,y,x,(H+1)*F),Bt(A,i.triangles,$+6)}return dn(C,g,-.01),Gi(p,p,C),L(o,a,0,y,x),dn(C,g,.02),Gi(p,p,C),L(s,l,1,w,_),{opaqueMiddleDisc:i,frontHistogram:o,backHistogram:s,frontHistogramBinBorders:a,backHistogramBinBorders:l,adjacentBondArrows:c,distantBondArrows:u}}xn.add("dihedral-histogram",zq);class $q extends dy{constructor(e,t,r){super(e,t,r),this.type="distance",this.parameters=Object.assign({radialSegments:!0,openEnded:!0,disableImpostor:!0,labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},useCylinder:{type:"boolean",rebuild:!0},atomPair:{type:"hidden",rebuild:!0}},this.parameters),this.init(r)}init(e){const t=e||{};t.linewidth=W(t.linewidth,5),t.radiusType=W(t.radiusType,"size"),t.radiusSize=W(t.radiusSize,.2),this.labelUnit=W(t.labelUnit,""),this.useCylinder=W(t.useCylinder,!1),this.atomPair=W(t.atomPair,[]),super.init(t)}getDistanceData(e,t){let r=t.length;const i=new Array(r);let o=new Float32Array(3*r);const s=new yn,a=new yn,l=new Of,c=e.getAtomProxy(),u=e.getAtomProxy();let d=0;const h=e.getAtomSet();t.forEach((f,v)=>{let g=f[0],b=f[1];if(typeof g=="number"&&Number.isInteger(g)&&typeof b=="number"&&Number.isInteger(b)){if(!h.get(g)||!h.get(b))return void(d+=1);c.index=g,u.index=b}else{s.setString(g),a.setString(b);var S=e.getAtomIndices(s),p=e.getAtomIndices(a);if(!S.length||!p.length)return void(d+=1);c.index=S[0],u.index=p[0]}l.addBond(c,u,1),v-=d;var y=c.distanceTo(u);switch(this.labelUnit){case"angstrom":i[v]=y.toFixed(2)+" Å";break;case"nm":i[v]=(y/10).toFixed(2)+" nm";break;default:i[v]=y.toFixed(2)}var w=3*v;o[w+0]=(c.x+u.x)/2,o[w+1]=(c.y+u.y)/2,o[w+2]=(c.z+u.z)/2}),d>0&&(r-=d,o=o.subarray(0,3*r));var m=new Qn(l.count,!0);return{text:i,position:o,bondSet:m,bondStore:l}}getBondData(e,t,r){const i=e.getBondData(this.getBondParams(t,r));return i.picking&&(i.picking=new PW(i.picking.array,i.picking.structure,r.bondStore)),i}createData(e){if(!e.atomCount||!this.atomPair.length)return;const t=this.atomPair.length,r=new _t(this.labelColor),i=this.getDistanceData(e,this.atomPair);this.textBuffer=new Yc({position:i.position,size:fi(t,this.labelSize),color:un(t,r.r,r.g,r.b),text:i.text},this.getLabelBufferParams());const o={bondSet:i.bondSet,bondStore:i.bondStore},s=this.getBondData(e,{position:!0,color:!0,picking:!0,radius:this.useCylinder},o);return this.useCylinder?this.distanceBuffer=new cs(s,this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})):this.distanceBuffer=new os(YE(s),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),{bondSet:i.bondSet,bondStore:i.bondStore,position:i.position,bufferList:[this.textBuffer,this.distanceBuffer]}}updateData(e,t){super.updateData(e,t);const r={bondSet:t.bondSet,bondStore:t.bondStore},i=this.getBondData(t.sview,e,r),o={};e&&!e.color||Object.assign(o,{color:i.color,color2:i.color2}),e&&!e.radius||Object.assign(o,{radius:i.radius}),this.distanceBuffer.setAttributes(o)}setParameters(e){return super.setParameters(e,{},!1),this.useCylinder||(e&&e.lineOpacity&&this.distanceBuffer.setParameters({opacity:e.lineOpacity}),e&&e.opacity!==void 0&&this.distanceBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.distanceBuffer.setParameters({linewidth:e.linewidth})),this}}function S0(n){return 2*(n.position.length/3)*3}xn.add("distance",$q);const Hq=Object.assign({scale:1,color:"grey"},zr);class kS extends Eo{constructor(e,t={}){super({position:new Float32Array(S0(e)),color:new Float32Array(S0(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag";const r=new _t(this.parameters.color),i=this.geometry.attributes;un(S0(e)/3,r.r,r.g,r.b,i.color.array),this.setAttributes(e)}get defaultParameters(){return Hq}setAttributes(e={}){const t=this.geometry.attributes;let r,i,o;e.position&&e.vector&&(r=e.position,i=e.vector,o=t.position.array,t.position.needsUpdate=!0);const s=this.size/2,a=this.parameters.scale;if(r&&i)for(let l=0;l<s;l++){const c=2*l*3,u=3*l;o[c+0]=r[u+0],o[c+1]=r[u+1],o[c+2]=r[u+2],o[c+3]=r[u+0]+i[u+0]*a,o[c+4]=r[u+1]+i[u+1]*a,o[c+5]=r[u+2]+i[u+2]*a}}}class Vq extends br{constructor(e,t,r){super(e,t,r),this.type="helixorient",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(r)}init(e){const t=e||{};t.colorScheme=W(t.colorScheme,"sstruc"),t.radiusType=W(t.radiusType,"size"),t.radiusSize=W(t.radiusSize,.15),t.radiusScale=W(t.radiusScale,1),t.useInteriorColor=W(t.useInteriorColor,!0),super.init(t)}createData(e){const t=[],r=[];return this.structure.eachPolymer(i=>{if(i.residueCount<4)return;r.push(i);const o=new xp(i),s=o.getPosition(),a=o.getColor(this.getColorParams()),l=o.getSize(this.getRadiusParams()),c=o.getPicking();t.push(new sa({position:s.center,color:a.color,radius:l.size,picking:c.picking},this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),new kS({position:s.center,vector:s.axis},this.getBufferParams({color:"skyblue",scale:1})),new kS({position:s.center,vector:s.resdir},this.getBufferParams({color:"lightgreen",scale:1})))},e.getSelection()),{bufferList:t,polymerList:r}}updateData(e,t){Xe&&Be.time(this.type+" repr update"),e=e||{};for(let r=0,i=t.polymerList.length;r<i;++r){const o=3*r,s={},a=t.polymerList[r],l=new xp(a);if(e.position){const c=l.getPosition();Object.assign(s,{position:c.center}),t.bufferList[o+1].setAttributes({position:c.center,vector:c.axis}),t.bufferList[o+2].setAttributes({position:c.center,vector:c.resdir})}t.bufferList[o].setAttributes(s)}Xe&&Be.timeEnd(this.type+" repr update")}}xn.add("helixorient",Vq);class kP extends Em{constructor(e,t,r){super(e,t,r),this.type="licorice",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,super.init(t)}}xn.add("licorice",kP),Qt.add("shader/HyperballStickImpostor.vert",`
attribute vec3 mapping;
attribute float radius;
attribute float radius2;
attribute vec3 position1;
attribute vec3 position2;
varying mat4 matrix_near;
varying vec4 prime1;
varying vec4 prime2;
varying float vRadius;
varying float vRadius2;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor1;
varying vec3 vColor2;
#endif
uniform float shrink;
uniform mat4 modelViewProjectionMatrix;
uniform mat4 modelViewProjectionMatrixInverse;
void main(){
vRadius = radius;
vRadius2 = radius2;
vec4 spaceposition;
vec3 position_atom1;
vec3 position_atom2;
vec4 vertex_position;
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
vColor1 = color;
vColor2 = color2;
#endif
float radius1 = radius;
position_atom1 = position1;
position_atom2 = position2;
float distance = distance( position_atom1, position_atom2 );
spaceposition.z = mapping.z * distance;
if (radius1 > radius2) {
spaceposition.y = mapping.y * 1.5 * radius1;
spaceposition.x = mapping.x * 1.5 * radius1;
} else {
spaceposition.y = mapping.y * 1.5 * radius2;
spaceposition.x = mapping.x * 1.5 * radius2;
}
spaceposition.w = 1.0;
vec4 e3 = vec4( 1.0 );
vec3 e1, e1_temp, e2, e2_temp;
e3.xyz = normalize(position_atom1-position_atom2);
if (e3.z == 0.0) { e3.z = 0.0000000000001;}
if ( (position_atom1.x - position_atom2.x) == 0.0) { position_atom1.x += 0.001;}
if ( (position_atom1.y - position_atom2.y) == 0.0) { position_atom1.y += 0.001;}
if ( (position_atom1.z - position_atom2.z) == 0.0) { position_atom1.z += 0.001;}
vec4 focus = vec4( 1.0 );
focus.x = ( position_atom1.x*position_atom1.x - position_atom2.x*position_atom2.x +
( radius2*radius2 - radius1*radius1 )*e3.x*e3.x/shrink )/(2.0*(position_atom1.x - position_atom2.x));
focus.y = ( position_atom1.y*position_atom1.y - position_atom2.y*position_atom2.y +
( radius2*radius2 - radius1*radius1 )*e3.y*e3.y/shrink )/(2.0*(position_atom1.y - position_atom2.y));
focus.z = ( position_atom1.z*position_atom1.z - position_atom2.z*position_atom2.z +
( radius2*radius2 - radius1*radius1 )*e3.z*e3.z/shrink )/(2.0*(position_atom1.z - position_atom2.z));
e1.x = 1.0;
e1.y = 1.0;
e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;
e1_temp = e1 - focus.xyz;
e1 = normalize(e1_temp);
e2_temp = e1.yzx * e3.zxy - e1.zxy * e3.yzx;
e2 = normalize(e2_temp);
mat3 R= mat3( e1.xyz, e2.xyz, e3.xyz );
vertex_position.xyz = R * spaceposition.xyz;
vertex_position.w = 1.0;
vertex_position.x += (position_atom1.x+position_atom2.x) / 2.0;
vertex_position.y += (position_atom1.y+position_atom2.y) / 2.0;
vertex_position.z += (position_atom1.z+position_atom2.z) / 2.0;
gl_Position = modelViewProjectionMatrix * vertex_position;
vec4 i_near, i_far;
vec4 near = gl_Position;
near.z = 0.0 ;
near = modelViewProjectionMatrixInverse * near;
i_near = near;
vec4 far = gl_Position;
far.z = far.w ;
i_far = modelViewProjectionMatrixInverse * far;
prime1 = vec4( position_atom1 - (position_atom1 - focus.xyz)*shrink, 1.0 );
prime2 = vec4( position_atom2 - (position_atom2 - focus.xyz)*shrink, 1.0 );
float Rsquare = (radius1*radius1/shrink) - (
(position_atom1.x - focus.x)*(position_atom1.x - focus.x) +
(position_atom1.y - focus.y)*(position_atom1.y - focus.y) +
(position_atom1.z - focus.z)*(position_atom1.z - focus.z)
);
focus.w = Rsquare;
matrix_near = mat4( i_near, i_far, focus, e3 );
gl_Position.z = 1.0;
}`),Qt.add("shader/HyperballStickImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform float shrink;
uniform mat4 modelViewMatrix;
uniform mat4 modelViewProjectionMatrix;
uniform mat4 modelViewMatrixInverseTranspose;
uniform mat4 projectionMatrix;
varying mat4 matrix_near;
varying vec4 prime1;
varying vec4 prime2;
varying float vRadius;
varying float vRadius2;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
varying vec3 vColor1;
varying vec3 vColor2;
#include common
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool interior = false;
float calcClip( vec4 cameraPos ){
return dot( cameraPos, vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
float calcClip( vec3 cameraPos ){
return calcClip( vec4( cameraPos, 1.0 ) );
}
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
struct Ray {
vec3 origin ;
vec3 direction ;
};
bool cutoff_plane (vec3 M, vec3 cutoff, vec3 x3){
float a = x3.x;
float b = x3.y;
float c = x3.z;
float d = -x3.x*cutoff.x-x3.y*cutoff.y-x3.z*cutoff.z;
float l = a*M.x+b*M.y+c*M.z+d;
if (l<0.0) {return true;}
else{return false;}
}
vec3 isect_surf(Ray r, mat4 matrix_coef){
vec4 direction = vec4(r.direction, 0.0);
vec4 origin = vec4(r.origin, 1.0);
float a = dot(direction,(matrix_coef*direction));
float b = dot(origin,(matrix_coef*direction));
float c = dot(origin,(matrix_coef*origin));
float delta =b*b-a*c;
gl_FragColor.a = 1.0;
if (delta<0.0){
discard;
}
float t1 =(-b-sqrt(delta))/a;
return r.origin+t1*r.direction;
}
vec3 isect_surf2(Ray r, mat4 matrix_coef){
vec4 direction = vec4(r.direction, 0.0);
vec4 origin = vec4(r.origin, 1.0);
float a = dot(direction,(matrix_coef*direction));
float b = dot(origin,(matrix_coef*direction));
float c = dot(origin,(matrix_coef*origin));
float delta =b*b-a*c;
gl_FragColor.a = 1.0;
if (delta<0.0){
discard;
}
float t2 =(-b+sqrt(delta))/a;
return r.origin+t2*r.direction;
}
Ray primary_ray(vec4 near1, vec4 far1){
vec3 near=near1.xyz/near1.w;
vec3 far=far1.xyz/far1.w;
return Ray(near,far-near);
}
float update_z_buffer(vec3 M, mat4 ModelViewP){
float depth1;
vec4 Ms=(ModelViewP*vec4(M,1.0));
return depth1=(1.0+Ms.z/Ms.w)/2.0;
}
void main(){
float radius = max( vRadius, vRadius2 );
vec4 i_near, i_far, focus;
vec3 e3, e1, e1_temp, e2;
i_near = vec4(matrix_near[0][0],matrix_near[0][1],matrix_near[0][2],matrix_near[0][3]);
i_far = vec4(matrix_near[1][0],matrix_near[1][1],matrix_near[1][2],matrix_near[1][3]);
focus = vec4(matrix_near[2][0],matrix_near[2][1],matrix_near[2][2],matrix_near[2][3]);
e3 = vec3(matrix_near[3][0],matrix_near[3][1],matrix_near[3][2]);
e1.x = 1.0;
e1.y = 1.0;
e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;
e1_temp = e1 - focus.xyz;
e1 = normalize(e1_temp);
e2 = normalize(cross(e1,e3));
vec4 equation = focus;
float shrinkfactor = shrink;
float t1 = -1.0/(1.0-shrinkfactor);
float t2 = 1.0/(shrinkfactor);
vec4 colonne1, colonne2, colonne3, colonne4;
mat4 mat;
vec3 equation1 = vec3(t2,t2,t1);
float A1 = - e1.x*equation.x - e1.y*equation.y - e1.z*equation.z;
float A2 = - e2.x*equation.x - e2.y*equation.y - e2.z*equation.z;
float A3 = - e3.x*equation.x - e3.y*equation.y - e3.z*equation.z;
float A11 = equation1.x*e1.x*e1.x + equation1.y*e2.x*e2.x + equation1.z*e3.x*e3.x;
float A21 = equation1.x*e1.x*e1.y + equation1.y*e2.x*e2.y + equation1.z*e3.x*e3.y;
float A31 = equation1.x*e1.x*e1.z + equation1.y*e2.x*e2.z + equation1.z*e3.x*e3.z;
float A41 = equation1.x*e1.x*A1 + equation1.y*e2.x*A2 + equation1.z*e3.x*A3;
float A22 = equation1.x*e1.y*e1.y + equation1.y*e2.y*e2.y + equation1.z*e3.y*e3.y;
float A32 = equation1.x*e1.y*e1.z + equation1.y*e2.y*e2.z + equation1.z*e3.y*e3.z;
float A42 = equation1.x*e1.y*A1 + equation1.y*e2.y*A2 + equation1.z*e3.y*A3;
float A33 = equation1.x*e1.z*e1.z + equation1.y*e2.z*e2.z + equation1.z*e3.z*e3.z;
float A43 = equation1.x*e1.z*A1 + equation1.y*e2.z*A2 + equation1.z*e3.z*A3;
float A44 = equation1.x*A1*A1 + equation1.y*A2*A2 + equation1.z*A3*A3 - equation.w;
colonne1 = vec4(A11,A21,A31,A41);
colonne2 = vec4(A21,A22,A32,A42);
colonne3 = vec4(A31,A32,A33,A43);
colonne4 = vec4(A41,A42,A43,A44);
mat = mat4(colonne1,colonne2,colonne3,colonne4);
Ray ray = primary_ray(i_near,i_far) ;
vec3 M;
M = isect_surf(ray, mat);
if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }
vec4 M1 = vec4(M,1.0);
vec4 M2 = mat*M1;
vec3 _normal = ( modelViewMatrixInverseTranspose * M2 ).xyz;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
#ifdef NEAR_CLIP
if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 ){
M = isect_surf2(ray, mat);
if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 )
discard;
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / radius ) );
}
}else if( gl_FragDepthEXT <= 0.0 ){
M = isect_surf2(ray, mat);
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix);
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );
}
}
#else
if( gl_FragDepthEXT <= 0.0 ){
M = isect_surf2(ray, mat);
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );
}
}
#endif
if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
float distance_ratio = ((M.x-prime2.x)*e3.x + (M.y-prime2.y)*e3.y +(M.z-prime2.z)*e3.z) /
distance(prime2.xyz,prime1.xyz);
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vViewPosition = -( modelViewMatrix * vec4( M, 1.0 ) ).xyz;
vec3 vNormal = _normal;
vec3 vColor;
if( distance_ratio>0.5 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
vec3 normal = normalize( vNormal );
vec3 nonPerturbedNormal = normal;
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Gq=new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1]),Wq=new Uint16Array([0,1,2,0,2,3,1,5,6,1,6,2,4,6,5,4,7,6,0,7,4,0,3,7,0,5,1,0,4,5,3,2,6,3,6,7]);class jq extends ay{constructor(e,t={}){super("v3",e,t)}get mapping(){return Gq}get mappingIndices(){return Wq}get mappingIndicesSize(){return 36}get mappingSize(){return 8}get mappingItemSize(){return 3}}const BP=Object.assign({shrink:.14},zr),qq=Object.assign({shrink:{uniform:!0}},vl);class Xq extends jq{constructor(e,t={}){super(e,t),this.parameterTypes=qq,this.isImpostor=!0,this.vertexShader="HyperballStickImpostor.vert",this.fragmentShader="HyperballStickImpostor.frag",this.addUniforms({modelViewProjectionMatrix:{value:new at},modelViewProjectionMatrixInverse:{value:new at},modelViewMatrixInverseTranspose:{value:new at},shrink:{value:this.parameters.shrink}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null},radius2:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return BP}}Object.assign({disableImpostor:!1},fy,BP);const Yq=class{constructor(n,e={}){return!wo||e&&e.disableImpostor?(n.radius=function(t,r){const i=t.length,o=new Float32Array(i);for(let s=0;s<i;s++)o[s]=Math.min(t[s],r[s]);return o}(n.radius,n.radius2),new FP(n,e)):new Xq(n,e)}};class Kq extends kP{constructor(e,t,r){super(e,t,r),this.type="hyperball",this.parameters=Object.assign({shrink:{type:"number",precision:3,max:1,min:.001,buffer:!0}},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){var t=e||{};t.radiusScale=W(t.radiusScale,.2),t.radiusType=W(t.radiusType,"vdw"),t.useInteriorColor=W(t.useInteriorColor,!0),this.shrink=W(t.shrink,.12),super.init(t)}getBondParams(e,t){return e&&!e.radius||(t=Object.assign({radius2:!0},t)),super.getBondParams(e,t)}createData(e){var t=new sa(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));return this.__center=new Float32Array(3*e.bondCount),{bufferList:[t,new Yq(e.getBondData(this.getBondParams()),this.getBufferParams({shrink:this.shrink,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))]}}updateData(e,t){var r=t.sview.getAtomData(this.getAtomParams()),i=t.sview.getBondData(this.getBondParams()),o={},s={};if(!e||e.position){Object.assign(o,{position:r.position});var a=i.position1,l=i.position2;Object.assign(s,{position:So(a,l,this.__center),position1:a,position2:l})}e&&!e.color||(Object.assign(o,{color:r.color}),Object.assign(s,{color:i.color,color2:i.color2})),e&&!e.radius||(Object.assign(o,{radius:r.radius}),Object.assign(s,{radius:i.radius,radius2:i.radius2})),t.bufferList[0].setAttributes(o),t.bufferList[1].setAttributes(s)}}xn.add("hyperball",Kq);class yv{constructor(e,t={},r=""){this.type=e,this.text=t,this.format=r,this.errorLogged=!1}atomLabel(e){let t;switch(this.type){case"atomname":t=e.atomname;break;case"atomindex":t=`${e.index}`;break;case"occupancy":t=e.occupancy.toFixed(2);break;case"bfactor":t=e.bfactor.toFixed(2);break;case"serial":t=`${e.serial}`;break;case"element":t=e.element;break;case"atom":t=`${e.atomname}|${e.index}`;break;case"resname":t=e.resname;break;case"resno":t=`${e.resno}`;break;case"res":t=`${yp[e.resname.toUpperCase()]||e.resname}${e.resno}`;break;case"residue":const r=yp[e.resname.toUpperCase()];t=r&&!e.inscode?`${r}${e.resno}`:`[${e.resname}]${e.resno}${e.inscode}`;break;case"text":t=this.text[e.index];break;case"format":try{t=IE.sprintf(this.format,e)}catch(i){this.errorLogged||(this.errorLogged=!0,console.log(i.message))}break;default:t=e.qualifiedName()}return t===void 0?"":t}}yv.types={"":"",atomname:"atom name",atomindex:"atom index",occupancy:"occupancy",bfactor:"b-factor",serial:"serial",element:"element",atom:"atom name + index",resname:"residue name",resno:"residue no",res:"one letter code + no",residue:"[residue name] + no + inscode",text:"text",format:"format",qualified:"qualified name"};class Zq extends br{constructor(e,t,r){super(e,t,r),this.type="label",this.parameters=Object.assign({labelType:{type:"select",options:yv.types,rebuild:!0},labelText:{type:"hidden",rebuild:!0},labelFormat:{type:"text",rebuild:!0},labelGrouping:{type:"select",options:{atom:"atom",residue:"residue"},rebuild:!0},fontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:!0},fontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:!0},fontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:!0},xOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},yOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},zOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},attachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},showBorder:{type:"boolean",buffer:!0},borderColor:{type:"color",buffer:!0},borderWidth:{type:"number",precision:2,max:.3,min:0,buffer:!0},showBackground:{type:"boolean",rebuild:!0},backgroundColor:{type:"color",buffer:!0},backgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},backgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:!0},fixedSize:{type:"boolean",buffer:!0}},this.parameters,{side:null,flatShaded:null,wireframe:null,linewidth:null,roughness:null,metalness:null,diffuse:null}),this.init(r)}init(e){const t=e||{};this.labelType=W(t.labelType,"res"),this.labelText=W(t.labelText,{}),this.labelFormat=W(t.labelFormat,""),this.labelGrouping=W(t.labelGrouping,"atom"),this.fontFamily=W(t.fontFamily,"sans-serif"),this.fontStyle=W(t.fontStyle,"normal"),this.fontWeight=W(t.fontWeight,"bold"),this.xOffset=W(t.xOffset,0),this.yOffset=W(t.yOffset,0),this.zOffset=W(t.zOffset,.5),this.attachment=W(t.attachment,"bottom-left"),this.showBorder=W(t.showBorder,!1),this.borderColor=W(t.borderColor,"lightgrey"),this.borderWidth=W(t.borderWidth,.15),this.showBackground=W(t.showBackground,!1),this.backgroundColor=W(t.backgroundColor,"lightgrey"),this.backgroundMargin=W(t.backgroundMargin,.5),this.backgroundOpacity=W(t.backgroundOpacity,1),this.fixedSize=W(t.fixedSize,!1),super.init(t)}getTextData(e,t){const r=this.getAtomParams(t),i=new yv(this.labelType,this.labelText,this.labelFormat);let o,s,a,l,c,u,d;if(this.labelGrouping==="atom"){const h=e.getAtomData(r);o=h.position,s=h.radius,a=h.color,t&&!t.text||(l=[],e.eachAtom(m=>l.push(i.atomLabel(m))))}else if(this.labelGrouping==="residue"){t&&!t.position||(c=[]),t&&!t.color||(d=[]),t&&!t.radius||(u=[]),t&&!t.text||(l=[]),r.colorParams&&(r.colorParams.structure=e.getStructure());const h=Xt.getScheme(r.colorParams),m=new is(r.radiusParams),f=e.getAtomProxy();let v=0;e.eachResidue(g=>{const b=3*v;g.isProtein()||g.isNucleic()?(f.index=g.traceAtomIndex,t&&!t.position||f.positionToArray(c,b)):(f.index=g.atomOffset,t&&!t.position||g.positionToArray(c,b)),t&&!t.color||h.atomColorToArray(f,d,b),t&&!t.radius||(u[v]=m.atomRadius(f)),t&&!t.text||l.push(i.atomLabel(f)),++v}),t&&!t.position||(o=new Float32Array(c)),t&&!t.color||(a=new Float32Array(d)),t&&!t.radius||(s=new Float32Array(u))}return{position:o,size:s,color:a,text:l}}createData(e){return{bufferList:[new Yc(this.getTextData(e,{position:!0,color:!0,radius:!0,text:!0}),this.getBufferParams({fontFamily:this.fontFamily,fontStyle:this.fontStyle,fontWeight:this.fontWeight,xOffset:this.xOffset,yOffset:this.yOffset,zOffset:this.zOffset,attachment:this.attachment,showBorder:this.showBorder,borderColor:this.borderColor,borderWidth:this.borderWidth,showBackground:this.showBackground,backgroundColor:this.backgroundColor,backgroundMargin:this.backgroundMargin,backgroundOpacity:this.backgroundOpacity,fixedSize:this.fixedSize}))]}}updateData(e,t){t.bufferList[0].setAttributes(this.getTextData(t.sview,e))}getAtomRadius(){return 0}}function Jq(n){const e=n.getAtomSet(),t=n.getBondSet(),r=n.getBondProxy();return t.forEach(function(i){r.index=i,e.clear(r.atomIndex1),e.clear(r.atomIndex2)}),e}xn.add("label",Zq);class Qq extends br{constructor(e,t,r){super(e,t,r),this.type="line",this.parameters=Object.assign({multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0},lines:{type:"boolean",rebuild:!0},crosses:{type:"select",rebuild:!0,options:{off:"off",lone:"lone",all:"all"}},crossSize:{type:"number",precision:2,max:2,min:.1}},this.parameters,{flatShaded:null,side:null,wireframe:null,roughness:null,metalness:null}),this.init(r)}init(e){var t=e||{};this.multipleBond=W(t.multipleBond,"off"),this.bondSpacing=W(t.bondSpacing,1),this.linewidth=W(t.linewidth,2),this.lines=W(t.lines,!0),this.crosses=W(t.crosses,"lone"),this.crossSize=W(t.crossSize,.4),super.init(t)}getAtomRadius(e){return .1}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,radiusParams:{type:"size",size:.1,scale:1}},t),super.getBondParams(e,t)}_crossData(e,t){if(e&&!e.position&&!e.color)return;const r={};this.crosses==="lone"&&Object.assign(r,{atomSet:Jq(t)});const i=t.getAtomData(this.getAtomParams(e,r)),o={},s=i.position,a=i.color,l=i.picking,c=(s||a).length,u=3*c;let d=new Float32Array(0),h=new Float32Array(0),m=new Float32Array(0),f=new Float32Array(0),v=0,g=new Float32Array(0);e&&!e.position||(d=o.position1=new Float32Array(u),h=o.position2=new Float32Array(u),v=this.crossSize/2),e&&!e.color||(m=o.color=new Float32Array(u),f=o.color2=new Float32Array(u)),e&&!e.picking||(g=new Float32Array(3*i.picking.array.length));for(let b=0;b<c;b++){const S=3*b,p=3*S;if(!e||e.position){const y=s[S],w=s[S+1],x=s[S+2];d[p]=y-v,d[p+1]=w,d[p+2]=x,h[p]=y+v,h[p+1]=w,h[p+2]=x,d[p+3]=y,d[p+4]=w-v,d[p+5]=x,h[p+3]=y,h[p+4]=w+v,h[p+5]=x,d[p+6]=y,d[p+7]=w,d[p+8]=x-v,h[p+6]=y,h[p+7]=w,h[p+8]=x+v}if(!e||e.color){const y=p+9;for(let w=p;w<y;w+=3)m[w]=f[w]=a[S],m[w+1]=f[w+1]=a[S+1],m[w+2]=f[w+2]=a[S+2]}e&&!e.picking||(g[S]=g[S+1]=g[S+2]=l.array[b])}return e&&!e.picking||(o.picking=new gl(g,l.structure)),o}createData(e){const t={position:!0,color:!0,picking:!0},r=[];if(this.lines){const i=e.getBondData(this.getBondParams(t)),o=new os(i,this.getBufferParams({linewidth:this.linewidth}));r.push(o)}if(this.crosses!=="off"){const i=new os(this._crossData(t,e),this.getBufferParams({linewidth:this.linewidth}));r.push(i)}return{bufferList:r}}updateData(e,t){let r=0;if(this.lines){const i=t.sview.getBondData(this.getBondParams(e)),o={};e&&!e.position||Object.assign(o,{position1:i.position1,position2:i.position2}),e&&!e.color||Object.assign(o,{color:i.color,color2:i.color2}),t.bufferList[r++].setAttributes(o)}if(this.crosses!=="off"){const i=this._crossData(e,t.sview),o={};e&&!e.position||Object.assign(o,{position1:i.position1,position2:i.position2}),e&&!e.color||Object.assign(o,{color:i.color,color2:i.color2}),t.bufferList[r++].setAttributes(o)}}setParameters(e){var t={};return e&&(e.bondSpacing||e.crossSize)&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}function NP(n,e,t,r,i){const o=new(r=r||Int32Array)(n*e*t*(i=i||1));function s(a,l,c){return((a*e+l)*t+c)*i}return{data:o,index:s,set:function(a,l,c,...u){const d=s(a,l,c);for(let h=0;h<i;++h)o[d+h]=u[h]},toArray:function(a,l,c,u=[],d=0){const h=s(a,l,c);for(let m=0;m<i;++m)u[d+m]=o[h+m]},fromArray:function(a,l,c,u,d=0){const h=s(a,l,c);for(let m=0;m<i;++m)o[h+m]=u[d+m]},copy:function(a){o.set(a.data)}}}function kf(n,e,t){var r=hP(e),i=bd(n);n.length===0&&(i[0].set([0,0,0]),i[1].set([0,0,0]));var o,s,a,l,c,u,d,h,m,f,v,g,b,S,p,y=i[0],w=i[1];function x(L,F,H,$,O){o=F||1.4,s=H||2,g=O||!0;var k=0;for(var X in r)k=Math.max(k,X);var ie=Sd(y,w,k,s,L?o:0);l=ie.dim[0],c=ie.dim[1],u=ie.dim[2],d=ie.matrix,h=ie.tran,s=ie.scaleFactor,m={},f={},I(L),v=o*s,a=$||o/s,b=new Uint8Array(l*c*u),L&&(S=new Float64Array(l*c*u)),g&&(p=new Int32Array(l*c*u))}var _=1,A=2,C=4,T=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];function I(L){var F,H,$,O,k,X,ie,ne,Q,ce;for(var Z in r)if(F=parseFloat(Z),!m[Z]){for(X=(ie=L?(F+o)*s+.5:F*s+.5)*ie,ne=Math.floor(ie)+1,Q=new Int32Array(ne*ne),ce=0,H=0;H<ne;++H)for($=0;$<ne;++$)(O=H*H+$*$)>X?Q[ce]=-1:(k=Math.sqrt(X-O),Q[ce]=Math.floor(k)),++ce;f[Z]=ne,m[Z]=Q}}function M(L){var F,H,$,O,k,X,ie,ne,Q,ce,Z,re,se,fe,ue,U,K,be,me=3*L,le=L;F=Math.floor(.5+s*(n[me]+h[0])),H=Math.floor(.5+s*(n[me+1]+h[1])),$=Math.floor(.5+s*(n[me+2]+h[2]));var xe,pe=e[le],ye=m[pe],Me=0,Ce=c*u,z=f[pe];for(ce=0;ce<z;++ce)for(Z=0;Z<z;++Z){if((xe=ye[Me])!==-1){for(U=-1;U<2;++U)for(K=-1;K<2;++K)for(be=-1;be<2;++be)if(U!==0&&K!==0&&be!==0){for(ie=U*ce,Q=be*Z,re=0;re<=xe;++re)if(fe=H+(ne=re*K),ue=$+Q,!((se=F+ie)<0||fe<0||ue<0||se>=l||fe>=c||ue>=u)){var D=se*Ce+fe*u+ue;if(g)if(b[D]&_){if(b[D]&_){var q=p[D];q!==me&&ie*ie+ne*ne+Q*Q<(O=F+ie-Math.floor(.5+s*(n[q]+h[0])))*O+(k=H+ne-Math.floor(.5+s*(n[q+1]+h[1])))*k+(X=$+Q-Math.floor(.5+s*(n[q+2]+h[2])))*X&&(p[D]=L)}}else b[D]|=_,p[D]=L;else b[D]|=_}}}Me++}}function P(L){var F,H;for(console.time("EDTSurface fillvoxels"),F=0,H=b.length;F<H;++F)b[F]=0,L&&(S[F]=-1),g&&(p[F]=-1);for(F=0,H=n.length/3;F<H;++F)M(F);for(F=0,H=b.length;F<H;++F)b[F]&_&&(b[F]|=A);console.timeEnd("EDTSurface fillvoxels")}function E(L){var F,H,$,O,k,X,ie,ne,Q,ce,Z,re,se,fe,ue,U,K,be,me,le=3*L,xe=L,pe=0;F=Math.floor(.5+s*(n[le]+h[0])),H=Math.floor(.5+s*(n[le+1]+h[1])),$=Math.floor(.5+s*(n[le+2]+h[2]));var ye=e[xe],Me=c*u;for(se=0,me=f[ye];se<me;++se)for(fe=0;fe<me;++fe){if(m[ye][pe]!==-1){for(U=-1;U<2;++U)for(K=-1;K<2;++K)for(be=-1;be<2;++be)if(U!==0&&K!==0&&be!==0){for(ie=U*se,Q=be*fe,ue=0;ue<=m[ye][pe];++ue)if(Z=H+(ne=ue*K),re=$+Q,!((ce=F+ie)<0||Z<0||re<0||ce>=l||Z>=c||re>=u)){var Ce=ce*Me+Z*u+re;if(b[Ce]&A){if(g){var z=p[Ce];ie*ie+ne*ne+Q*Q<(O=Math.floor(.5+s*(n[z]+h[0])))*O+(k=Math.floor(.5+s*(n[z+1]+h[1])))*k+(X=Math.floor(.5+s*(n[z+2]+h[2])))*X&&(p[Ce]=L)}}else b[Ce]|=A,g&&(p[Ce]=L)}}}pe++}}function R(){var L,F,H,$;console.time("EDTSurface fastdistancemap");var O,k=NP(l,c,u,Uint16Array,3),X=c*u,ie=v*v,ne=0;for(L=0;L<l;++L)for(F=0;F<c;++F)for(H=0;H<u;++H)b[O=L*X+F*u+H]&=~A,b[O]&_&&b[O]&C&&(k.set(L,F,H,L,F,H),S[O]=0,b[O]|=A,ne+=1);var Q=new Int32Array(3*ne),ce=0,Z=new Int32Array(3*ne),re=0;for(L=0;L<l;++L)for(F=0;F<c;++F)for(H=0;H<u;++H)b[O=L*X+F*u+H]&C&&(Q[ce]=L,Q[ce+1]=F,Q[ce+2]=H,ce+=3,b[O]&=~C);do for(re=B(Q,k,ce,Z),ce=0,L=0,$=re;L<$;L+=3)O=X*Z[L]+u*Z[L+1]+Z[L+2],b[O]&=~C,S[O]<=1.0404*ie&&(Q[ce]=Z[L],Q[ce+1]=Z[L+1],Q[ce+2]=Z[L+2],ce+=3);while(ce>0);var se,fe=a*a,ue=new Uint16Array(3);for(L=0;L<l;++L)for(F=0;F<c;++F)for(H=0;H<u;++H)b[O=L*X+F*u+H]&=~C,b[O]&_&&(b[O]&A&&!(b[O]&A&&S[O]>=fe)||(b[O]|=C,g&&b[O]&A&&(k.toArray(L,F,H,ue),se=ue[0]*X+ue[1]*u+ue[2],p[O]=p[se])));console.timeEnd("EDTSurface fastdistancemap")}function B(L,F,H,$){var O,k,X,ie,ne,Q,ce,Z,re,se,fe,ue,U=new Uint16Array(3),K=0;if(H===0)return K;var be=-1,me=-1,le=-1,xe=c*u;for(ce=0,re=H;ce<re;ce+=3)for(O=L[ce],k=L[ce+1],X=L[ce+2],F.toArray(O,k,X,U),Z=0;Z<6;++Z)be=O+(ue=T[Z])[0],me=k+ue[1],le=X+ue[2],be<l&&be>-1&&me<c&&me>-1&&le<u&&le>-1&&(b[fe=be*xe+u*me+le]&_&&!(b[fe]&A)?(F.fromArray(be,me,le,U),se=(ie=be-U[0])*ie+(ne=me-U[1])*ne+(Q=le-U[2])*Q,S[fe]=se,b[fe]|=A,b[fe]|=C,$[K]=be,$[K+1]=me,$[K+2]=le,K+=3):b[fe]&_&&b[fe]&A&&(se=(ie=be-U[0])*ie+(ne=me-U[1])*ne+(Q=le-U[2])*Q)<S[fe]&&(F.fromArray(be,me,le,U),S[fe]=se,b[fe]&C||(b[fe]|=C,$[K]=be,$[K+1]=me,$[K+2]=le,K+=3)));for(ce=0,re=H;ce<re;ce+=3)for(O=L[ce],k=L[ce+1],X=L[ce+2],F.toArray(O,k,X,U),Z=6;Z<18;Z++)be=O+(ue=T[Z])[0],me=k+ue[1],le=X+ue[2],be<l&&be>-1&&me<c&&me>-1&&le<u&&le>-1&&(b[fe=be*xe+u*me+le]&_&&!(b[fe]&A)?(F.fromArray(be,me,le,U),se=(ie=be-U[0])*ie+(ne=me-U[1])*ne+(Q=le-U[2])*Q,S[fe]=se,b[fe]|=A,b[fe]|=C,$[K]=be,$[K+1]=me,$[K+2]=le,K+=3):b[fe]&_&&b[fe]&A&&(se=(ie=be-U[0])*ie+(ne=me-U[1])*ne+(Q=le-U[2])*Q)<S[fe]&&(F.fromArray(be,me,le,U),S[fe]=se,b[fe]&C||(b[fe]|=C,$[K]=be,$[K+1]=me,$[K+2]=le,K+=3)));for(ce=0,re=H;ce<re;ce+=3)for(O=L[ce],k=L[ce+1],X=L[ce+2],F.toArray(O,k,X,U),Z=18;Z<26;Z++)be=O+(ue=T[Z])[0],me=k+ue[1],le=X+ue[2],be<l&&be>-1&&me<c&&me>-1&&le<u&&le>-1&&(b[fe=be*xe+u*me+le]&_&&!(b[fe]&A)?(F.fromArray(be,me,le,U),se=(ie=be-U[0])*ie+(ne=me-U[1])*ne+(Q=le-U[2])*Q,S[fe]=se,b[fe]|=A,b[fe]|=C,$[K]=be,$[K+1]=me,$[K+2]=le,K+=3):b[fe]&_&&b[fe]&A&&(se=(ie=be-U[0])*ie+(ne=me-U[1])*ne+(Q=le-U[2])*Q)<S[fe]&&(F.fromArray(be,me,le,U),S[fe]=se,b[fe]&C||(b[fe]|=C,$[K]=be,$[K+1]=me,$[K+2]=le,K+=3)));return K}this.getVolume=function(L,F,H,$,O){console.time("EDTSurface.getVolume");var k=L!=="vws";x(k,F,H,$,O),P(k),function(){var ne,Q,ce,Z=c*u;for(ne=0;ne<l;++ne)for(Q=0;Q<u;++Q)for(ce=0;ce<c;++ce){var re=ne*Z+ce*u+Q;if(b[re]&_)for(var se=0;se<26;){var fe=ne+T[se][0],ue=Q+T[se][2],U=ce+T[se][1];if(fe>-1&&fe<l&&U>-1&&U<c&&ue>-1&&ue<u&&!(b[fe*Z+U*u+ue]&_)){b[re]|=C;break}se++}}}(),L!=="ms"&&L!=="ses"||R(),L==="ses"&&(I(!1),function(){var ne,Q;for(ne=0,Q=b.length;ne<Q;++ne)b[ne]&=~A;for(ne=0,Q=n.length/3;ne<Q;++ne)E(ne)}()),function(ne){var Q,ce=b.length;if(ne==="vws")for(Q=0;Q<ce;++Q)b[Q]&=~C,b[Q]=b[Q]&A?1:0;else if(ne==="ms")for(Q=0;Q<ce;++Q)b[Q]&=~A,b[Q]&C&&(b[Q]|=A),b[Q]&=~C,b[Q]=b[Q]&A?1:0;else if(ne==="ses")for(Q=0;Q<ce;++Q)b[Q]&C&&b[Q]&A?b[Q]&=~C:b[Q]&C&&!(b[Q]&A)&&(b[Q]|=A),b[Q]=b[Q]&A?1:0;else if(ne==="sas")for(Q=0;Q<ce;++Q)b[Q]&=~C,b[Q]=b[Q]&A?1:0}(L);for(var X=0,ie=p.length;X<ie;++X)p[X]=t[p[X]];return console.timeEnd("EDTSurface.getVolume"),{data:b,nx:u,ny:c,nz:l,atomindex:p}},this.getSurface=function(L,F,H,$,O,k,X){var ie=this.getVolume(L,F,H,$,O);return new Hs(ie.data,ie.nx,ie.ny,ie.nz,ie.atomindex).getSurface(1,k,void 0,d,X)}}function zP(n,e,t,r,i,o,s){s=Math.max(.1,s);var a=n.length,l=i[0],c=i[1],u=i[2],d=o[0],h=o[1],m=o[2];function f(H,$){return Math.floor((H-$)/s)}for(var v,g,b,S=f(d,l)+1,p=f(h,c)+1,y=f(m,u)+1,w=S*p*y,x=p*y,_=[],A=0;A<a;A++){var C=(v=n[A],g=e[A],b=t[A],(f(v,l)*p+f(g,c))*y+f(b,u));_[C]===void 0?_[C]=[A]:_[C].push(A)}var T=new Uint32Array(w),I=new Uint16Array(w),M=new Uint32Array(a),P=0,E=0;for(A=0;A<w;A++){var R=T[A]=P,B=_[A];if(B!==void 0)for(var L=0;L<B.length;L++)M[P]=B[L],P++;var F=P-R;I[A]=F,F>E&&(E=F)}return{neighbourListLength:27*E+1,withinRadii:function(H,$,O,k,X){for(var ie=0,ne=f(H,l),Q=f($,c),ce=f(O,u),Z=Math.max(0,ne-1),re=Math.max(0,Q-1),se=Math.max(0,ce-1),fe=Math.min(S,ne+2),ue=Math.min(p,Q+2),U=Math.min(y,ce+2),K=Z;K<fe;++K)for(var be=K*x,me=re;me<ue;++me)for(var le=me*y,xe=se;xe<U;++xe)for(var pe=be+le+xe,ye=T[pe],Me=ye+I[pe],Ce=ye;Ce<Me;Ce++){var z=M[Ce],D=n[z]-H,q=e[z]-$,_e=t[z]-O,ve=r[z]+k;D*D+q*q+_e*_e<=ve*ve&&(X[ie++]=M[Ce])}X[ie]=-1}}}function Bf(n,e,t){const r=e.length,i=new Float32Array(r),o=new Float32Array(r),s=new Float32Array(r);for(let ne=0;ne<r;ne++){const Q=3*ne;i[ne]=n[Q],o[ne]=n[Q+1],s[ne]=n[Q+2]}let a=bd(n);n.length===0&&(a[0].set([0,0,0]),a[1].set([0,0,0]));const l=a[0],c=a[1];let u,d,h,m,f,v,g,b,S,p,y,w,x,_,A,C,T,I,M=-1;const P=new Float32Array([0,0,0]),E=new Float32Array([0,0,0]),R=new Float32Array([0,0,0]),B=new Float32Array([0,0,0]);let L;function F(ne,Q,ce,Z){m=W(ne,1.4),f=W(Q,2),v=W(ce,!0),g=W(Z,30),u=new Float32Array(r),d=new Float32Array(r);for(let se=0;se<u.length;++se){var re=e[se]+m;u[se]=re,d[se]=re*re}h=0;for(let se=0;se<u.length;++se)u[se]>h&&(h=u[se]);(function(){const se=Sd(l,c,h,f,0);f=se.scaleFactor,b=se.dim,S=se.matrix,L=Math.max(5,2+Math.floor(m*f)),p=fi(b[0]*b[1]*b[2],-1001),y=new Int32Array(p.length),w=new Float32Array(b[0]),x=new Float32Array(b[1]),_=new Float32Array(b[2]),H(w,l[0],1/f),H(x,l[1],1/f),H(_,l[2],1/f)})(),function(){var se=0,fe=2*Math.PI/g;C=new Float32Array(g),A=new Float32Array(g);for(var ue=0;ue<g;ue++)C[ue]=Math.cos(se),A[ue]=Math.sin(se),se+=fe}(),T=zP(i,o,s,u,l,c,2.01*h),I=new Int32Array(T.neighbourListLength),M=-1}function H(ne,Q,ce){for(let Z=0;Z<ne.length;Z++)ne[Z]=Q+ce*Z}function $(ne,Q,ce,Z,re){let se;if(M!==-1){if(se=M,se!==Z&&se!==re&&O(se,ne,Q,ce))return se;M=-1}var fe=0;for(se=I[fe];se>=0;){if(se!==Z&&se!==re&&O(se,ne,Q,ce))return M=se,se;se=I[++fe]}return M=-1,-1}function O(ne,Q,ce,Z){var re=3*ne,se=d[ne],fe=n[re]-Q,ue=n[re+1]-ce,U=n[re+2]-Z;return fe*fe+ue*ue+U*U<se}function k(){for(var ne=0;ne<r;ne++){var Q=i[ne],ce=o[ne],Z=s[ne],re=u[ne],se=d[ne];T.withinRadii(Q,ce,Z,re,I);for(var fe=Math.ceil(re*f),ue=Math.floor(f*(Q-l[0])),U=Math.floor(f*(ce-l[1])),K=Math.floor(f*(Z-l[2])),be=Math.max(0,ue-fe),me=Math.max(0,U-fe),le=Math.max(0,K-fe),xe=Math.min(b[0],ue+fe+2),pe=Math.min(b[1],U+fe+2),ye=Math.min(b[2],K+fe+2),Me=be;Me<xe;Me++)for(var Ce=w[Me]-Q,z=b[1]*b[2]*Me,D=me;D<pe;D++)for(var q=x[D]-ce,_e=Ce*Ce+q*q,ve=z+b[2]*D,Re=le;Re<ye;Re++){var ze=_[Re]-Z,Le=_e+ze*ze;if(Le<se){var Ve=Re+ve;p[Ve]<0&&(p[Ve]=-p[Ve]);var Ze=Math.sqrt(Le),ut=re/Ze,Ne=Ce*ut,ct=q*ut,he=ze*ut;if($(Ne+=Q,ct+=ce,he+=Z,ne,-1)===-1){var Ae=re-Ze;Ae<p[Ve]&&(p[Ve]=Ae,v&&(y[Ve]=ne))}}}}}function X(ne,Q){var ce=u[ne],Z=u[Q],re=P[0]=i[Q]-i[ne],se=P[1]=o[Q]-o[ne],fe=P[2]=s[Q]-s[ne],ue=re*re+se*se+fe*fe,U=Math.sqrt(ue),K=ce*((ce*ce+U*U-Z*Z)/(2*ce*U));On(P,P),function(We,ee){We[0]=We[1]=We[2]=1,ee[0]!==0?We[0]=(ee[1]+ee[2])/-ee[0]:ee[1]!==0?We[1]=(ee[0]+ee[2])/-ee[1]:ee[2]!==0&&(We[2]=(ee[0]+ee[1])/-ee[2])}(R,P),On(R,R),Zr(B,P,R),On(B,B);var be=Math.sqrt(ce*ce-K*K);dn(R,R,be),dn(B,B,be),dn(P,P,K),E[0]=P[0]+i[ne],E[1]=P[1]+o[ne],E[2]=P[2]+s[ne],M=-1;for(var me=L,le=0;le<g;le++){var xe=C[le],pe=A[le],ye=E[0]+xe*R[0]+pe*B[0],Me=E[1]+xe*R[1]+pe*B[1],Ce=E[2]+xe*R[2]+pe*B[2];if($(ye,Me,Ce,ne,Q)===-1)for(var z=Math.floor(f*(ye-l[0])),D=Math.floor(f*(Me-l[1])),q=Math.floor(f*(Ce-l[2])),_e=Math.max(0,z-me),ve=Math.max(0,D-me),Re=Math.max(0,q-me),ze=Math.min(b[0],z+me+2),Le=Math.min(b[1],D+me+2),Ve=Math.min(b[2],q+me+2),Ze=_e;Ze<ze;Ze++){re=ye-w[Ze];for(var ut=b[1]*b[2]*Ze,Ne=ve;Ne<Le;Ne++)for(var ct=re*re+(se=Me-x[Ne])*se,he=ut+b[2]*Ne,Ae=Re;Ae<Ve;Ae++){ue=ct+(fe=Ce-_[Ae])*fe;var Fe=Ae+he,ke=p[Fe];if(ke>0&&ue<ke*ke&&(p[Fe]=Math.sqrt(ue),v)){const We=re*P[0]+se*P[1]+fe*P[2];y[Fe]=We<0?Q:ne}}}}}function ie(ne,Q,ce){console.time("AVSurface.getVolume"),console.time("AVSurface.init"),F(ne,Q,ce),console.timeEnd("AVSurface.init"),console.time("AVSurface.projectPoints"),k(),console.timeEnd("AVSurface.projectPoints"),console.time("AVSurface.projectTorii"),function(){for(var Z=0;Z<r;Z++){T.withinRadii(i[Z],o[Z],s[Z],u[Z],I);for(var re=0,se=I[re];se>=0;)Z<se&&X(Z,se),se=I[++re]}}(),console.timeEnd("AVSurface.projectTorii"),function(){for(var Z=0;Z<p.length;Z++)p[Z]<0&&(p[Z]=0)}(),function(){for(var Z=0;Z<y.length;Z++)y[Z]=t[y[Z]]}(),console.timeEnd("AVSurface.getVolume")}this.getSurface=function(ne,Q,ce,Z,re,se,fe){return ie(Q,ce,re),new Hs(p,b[2],b[1],b[0],y).getSurface(Q,!1,void 0,S,fe)}}xn.add("line",Qq),Object.assign(kf,{__deps:[Sd,hP,Hs,bd,NP]}),Object.assign(Bf,{__deps:[Sd,Hs,fi,bd,dn,Zr,On,zP,W]}),ju.add("molsurf",function(n,e){const t=n.data.args,r=n.data.params;if(t&&r){const i=new(r.type==="av"?Bf:kf)(t.coordList,t.radiusList,t.indexList).getSurface(r.type,r.probeRadius,r.scaleFactor,r.cutoff,!0,r.smooth,r.contour),o=[i.position.buffer,i.index.buffer];i.normal&&o.push(i.normal.buffer),i.atomindex&&o.push(i.atomindex.buffer),e({sd:i,p:r},o)}},[kf,Bf]);class eX{constructor(e){this.structure=e}_getAtomData(e){return this.structure.getAtomData({what:{position:!0,radius:!0,index:!0},radiusParams:W(e.radiusParams,{type:"vdw",scale:1})})}_makeSurface(e,t){var r=new wm(t.name,"",e);return r.info.type=t.type,r.info.probeRadius=t.probeRadius,r.info.scaleFactor=t.scaleFactor,r.info.smooth=t.smooth,r.info.cutoff=t.cutoff,r}getSurface(e){const t=e||{},r=this._getAtomData(e),i=r.position,o=r.radius,s=r.index,a=new(t.type==="av"?Bf:kf)(i,o,s).getSurface(t.type,t.probeRadius,t.scaleFactor,t.cutoff,!0,t.smooth,t.contour);return this._makeSurface(a,t)}getSurfaceWorker(e,t){const r=Object.assign({},e);if(window.hasOwnProperty("Worker")){this.worker===void 0&&(this.worker=new WE("molsurf"));const i=this._getAtomData(e),o=i.position,s=i.radius,a=i.index,l={args:{coordList:o,radiusList:s,indexList:a},params:r},c=[o.buffer,s.buffer,a.buffer];this.worker.post(l,c,u=>{t(this._makeSurface(u.data.sd,r))},u=>{console.warn("MolecularSurface.getSurfaceWorker error - trying without worker",u),this.worker.terminate(),this.worker=void 0;const d=this.getSurface(r);t(d)})}else{const i=this.getSurface(r);t(i)}}dispose(){this.worker&&this.worker.terminate()}}class tX extends br{constructor(e,t,r){super(e,t,r),this.type="surface",this.parameters=Object.assign({surfaceType:{type:"select",rebuild:!0,options:{vws:"vws",sas:"sas",ms:"ms",ses:"ses",av:"av"}},probeRadius:{type:"number",precision:1,max:20,min:0,rebuild:!0},smooth:{type:"integer",precision:1,max:10,min:0,rebuild:!0},scaleFactor:{type:"number",precision:1,max:5,min:0,rebuild:!0},cutoff:{type:"number",precision:2,max:50,min:0,rebuild:!0},contour:{type:"boolean",rebuild:!0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},filterSele:{type:"text",rebuild:!0},colorVolume:{type:"hidden"},useWorker:{type:"boolean",rebuild:!0}},this.parameters,{radius:null,scale:null}),this.__infoList=[],this.structure.signals.refreshed.add(()=>{this.__forceNewMolsurf=!0}),this.toBePrepared=!0,this.init(r)}init(e){const t=e||{};t.colorScheme=W(t.colorScheme,"uniform"),t.colorValue=W(t.colorValue,14540253),t.disablePicking=W(t.disablePicking,!0),this.surfaceType=W(t.surfaceType,"ms"),this.probeRadius=W(t.probeRadius,1.4),this.smooth=W(t.smooth,2),this.scaleFactor=W(t.scaleFactor,2),this.cutoff=W(t.cutoff,0),this.contour=W(t.contour,!1),this.background=W(t.background,!1),this.opaqueBack=W(t.opaqueBack,!0),this.filterSele=W(t.filterSele,""),this.colorVolume=W(t.colorVolume,void 0),this.useWorker=W(t.useWorker,!0),super.init(e)}prepareData(e,t,r){let i=this.__infoList[t];if(i||(i={},this.__infoList[t]=i),i.molsurf&&i.sele===e.selection.string)r(t);else{if(this.filterSele){const a=e.structure.getView(new yn(this.filterSele)),l=a.boundingBox.getSize(new te),c=Math.max(l.x,l.y,l.z),u=e.getAtomSetWithinPoint(a.center,c/2+6);if((e=e.getView(new yn(e.getAtomSetWithinSelection(u,3).toSeleString()))).atomCount===0)return void r(t)}i.sele=e.selection.string,i.molsurf=new eX(e);const o=this.getSurfaceParams(),s=a=>{i.surface=a,r(t)};this.useWorker?i.molsurf.getSurfaceWorker(o,s):s(i.molsurf.getSurface(o))}}prepare(e){if((this.__forceNewMolsurf||this.__sele!==this.selection.string||this.__surfaceParams!==JSON.stringify(this.getSurfaceParams()))&&(this.__infoList.forEach(o=>{o&&o.molsurf&&o.molsurf.dispose()}),this.__infoList.length=0),this.structureView.atomCount===0)return void e();const t=()=>{this.__sele=this.selection.string,this.__surfaceParams=JSON.stringify(this.getSurfaceParams()),this.__forceNewMolsurf=!1,e()},r=this.assembly==="default"?this.defaultAssembly:this.assembly,i=this.structure.biomolDict[r];i?i.partList.forEach((o,s)=>{const a=o.getView(this.structureView);this.prepareData(a,s,l=>{l===i.partList.length-1&&t()})}):this.prepareData(this.structureView,0,t)}createData(e,t){const r=this.__infoList[t],i=r.surface;if(!i)return;const o={position:i.getPosition(),color:i.getColor(this.getColorParams()),index:i.getFilteredIndex(this.filterSele,e)},s=[];if(i.contour){const a=new mP(o,this.getBufferParams({wireframe:!1}));s.push(a)}else{Object.assign(o,{normal:i.getNormal(),picking:i.getPicking(e.getStructure())});const a=new fP(o,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));if(this.getBufferParams().side=="double"){const l=new pP(a);s.push(l)}else s.push(a)}return{bufferList:s,info:r}}updateData(e,t){const r={};if(e.position||e.radius)return this.__forceNewMolsurf=!0,void this.build();e.color&&(r.color=t.info.surface.getColor(this.getColorParams())),e.index&&(r.index=t.info.surface.getFilteredIndex(this.filterSele,t.sview)),t.bufferList[0].setAttributes(r)}setParameters(e,t={},r){return e&&e.filterSele&&(t.index=!0),e&&e.colorVolume!==void 0&&(t.color=!0),e&&e.wireframe&&(e.contour||e.contour===void 0&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,r),this}getSurfaceParams(e={}){return Object.assign({type:this.surfaceType,probeRadius:this.probeRadius,scaleFactor:this.scaleFactor,smooth:this.smooth&&!this.contour,cutoff:this.cutoff,contour:this.contour,useWorker:this.useWorker,radiusParams:this.getRadiusParams()},e)}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}getAtomRadius(){return 0}clear(){super.clear()}dispose(){this.__infoList.forEach(e=>{e&&e.molsurf&&e.molsurf.dispose()}),this.__infoList.length=0,super.dispose()}}xn.add("surface",tX);class nX extends br{constructor(e,t,r){super(e,t,r),this.type="point",this.parameters=Object.assign({pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{flatShaded:null,wireframe:null,linewidth:null,side:null,roughness:null,metalness:null}),this.init(r)}init(e){var t=e||{};this.pointSize=W(t.pointSize,1),this.sizeAttenuation=W(t.sizeAttenuation,!0),this.sortParticles=W(t.sortParticles,!1),this.useTexture=W(t.useTexture,!1),this.alphaTest=W(t.alphaTest,.5),this.forceTransparent=W(t.forceTransparent,!1),this.edgeBleach=W(t.edgeBleach,0),super.init(t)}createData(e){var t=e.getAtomData(this.getAtomParams({position:!0,color:!0,picking:!0}));return{bufferList:[new cy(t,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach}))]}}updateData(e,t){var r=t.sview.getAtomData(this.getAtomParams(e)),i={};e&&!e.position||Object.assign(i,{position:r.position}),e&&!e.color||Object.assign(i,{color:r.color}),t.bufferList[0].setAttributes(i)}getAtomRadius(){return .1}}xn.add("point",nX),Qt.add("shader/Ribbon.vert",`#define STANDARD
uniform float clipNear;
uniform vec3 clipCenter;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
attribute vec3 dir;
attribute float size;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#endif
#include common
void main(void){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#include beginnormal_vertex
#include defaultnormal_vertex
#ifndef FLAT_SHADED
vNormal = normalize( transformedNormal );
#endif
#endif
#include begin_vertex
transformed += normalize( dir ) * size;
#include project_vertex
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`);const rX=new Uint16Array([0,1,2,1,3,2]);function mu(n){return 3*(4*(n.position.length/3-1))}class iX extends rs{constructor(e,t={}){super({position:new Float32Array(mu(e)),color:new Float32Array(mu(e)),index:To(mu(e),mu(e)/3),normal:new Float32Array(mu(e)),picking:e.picking},t),this.vertexShader="Ribbon.vert";const r=e.position.length/3-1,i=4*r,o=3*i;this.addAttributes({dir:{type:"v3",value:new Float32Array(o)}}),this.addAttributes({size:{type:"f",value:new Float32Array(i)}}),e.primitiveId=Wc(r),this.setAttributes(e),this.makeIndex()}setAttributes(e={}){const t=this.size/4,r=this.geometry.attributes;let i,o,s,a,l,c,u,d,h,m,f,v,g,b,S,p,y,w,x;e.position&&(i=e.position,u=r.position.array,r.position.needsUpdate=!0),e.normal&&(o=e.normal,d=r.normal.array,r.normal.needsUpdate=!0),e.size&&(s=e.size,h=r.size.array,r.size.needsUpdate=!0),e.dir&&(a=e.dir,m=r.dir.array,r.dir.needsUpdate=!0),e.color&&(l=e.color,f=r.color.array,r.color.needsUpdate=!0),e.primitiveId&&(c=e.primitiveId,v=r.primitiveId.array,r.primitiveId.needsUpdate=!0);let _=s?s[0]:null;for(g=0;g<t;++g){for(w=3*g,S=3*g*4,y=4*g,i&&(u[S]=u[S+3]=i[w],u[S+1]=u[S+4]=i[w+1],u[S+2]=u[S+5]=i[w+2],u[S+6]=u[S+9]=i[w+3],u[S+7]=u[S+10]=i[w+4],u[S+8]=u[S+11]=i[w+5]),o&&(d[S]=d[S+3]=-o[w],d[S+1]=d[S+4]=-o[w+1],d[S+2]=d[S+5]=-o[w+2],d[S+6]=d[S+9]=-o[w+3],d[S+7]=d[S+10]=-o[w+4],d[S+8]=d[S+11]=-o[w+5]),b=0;b<4;++b)p=S+3*b,l&&(f[p]=l[w],f[p+1]=l[w+1],f[p+2]=l[w+2]),c&&(v[y+b]=c[g]);s&&(x=s[g],_!==s[g]?(h[y]=_,h[y+1]=_,h[y+2]=x,h[y+3]=x):(h[y]=x,h[y+1]=x,h[y+2]=x,h[y+3]=x),_=x),a&&(m[S]=a[w],m[S+1]=a[w+1],m[S+2]=a[w+2],m[S+3]=-a[w],m[S+4]=-a[w+1],m[S+5]=-a[w+2],m[S+6]=a[w+3],m[S+7]=a[w+4],m[S+8]=a[w+5],m[S+9]=-a[w+3],m[S+10]=-a[w+4],m[S+11]=-a[w+5])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void Be.error("Index is null");const t=e.array,r=t.length/4/3;for(let i=0;i<r;++i){const o=6*i,s=4*i;t.set(rX,o);for(let a=0;a<6;++a)t[o+a]+=s}}}class oX extends br{constructor(e,t,r){super(e,t,r),this.type="ribbon",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{side:null,wireframe:null,linewidth:null}),this.init(r)}init(e){var t=e||{};t.colorScheme=W(t.colorScheme,"chainname"),t.colorScale=W(t.colorScale,"RdYlBu"),t.radiusType=W(t.radiusType,"sstruc"),t.radiusScale=W(t.radiusScale,4),t.quality==="low"?this.subdiv=3:t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=W(t.subdiv,6),this.tension=W(t.tension,NaN),this.smoothSheet=W(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!0,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){var t=[],r=[];return this.structure.eachPolymer(i=>{if(!(i.residueCount<4)){r.push(i);var o=new Pc(i,this.getSplineParams()),s=o.getSubdividedPosition(),a=o.getSubdividedOrientation(),l=o.getSubdividedColor(this.getColorParams()),c=o.getSubdividedPicking(),u=o.getSubdividedSize(this.getRadiusParams());t.push(new iX({position:s.position,normal:a.binormal,dir:a.normal,color:l.color,size:u.size,picking:c.picking},this.getBufferParams()))}},e.getSelection()),{bufferList:t,polymerList:r}}updateData(e,t){e=e||{};var r=0,i=t.polymerList.length;for(r=0;r<i;++r){var o={},s=new Pc(t.polymerList[r],this.getSplineParams());if(e.position){var a=s.getSubdividedPosition(),l=s.getSubdividedOrientation();Object.assign(o,{position:a.position,normal:l.binormal,dir:l.normal})}if(e.radius||e.scale){var c=s.getSubdividedSize(this.getRadiusParams());Object.assign(o,{size:c.size})}if(e.color){var u=s.getSubdividedColor(this.getColorParams());Object.assign(o,{color:u.color})}t.bufferList[r].setAttributes(o)}}setParameters(e){var t={};return e&&e.tension&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}xn.add("ribbon",oX);class sX extends br{constructor(e,t,r){super(e,t,r),this.type="rocket",this.parameters=Object.assign({localAngle:{type:"integer",max:180,min:0,rebuild:!0},centerDist:{type:"number",precision:1,max:10,min:0,rebuild:!0},ssBorder:{type:"boolean",rebuild:!0},radialSegments:!0,openEnded:!0,disableImpostor:!0},this.parameters),this.init(r)}init(e){let t=e||{};t.colorScheme=W(t.colorScheme,"sstruc"),t.radiusSize=W(t.radiusSize,1.5),t.radiusScale=W(t.radiusScale,1),t.openEnded=W(t.openEnded,!1),t.useInteriorColor=W(t.useInteriorColor,!0),this.localAngle=W(t.localAngle,30),this.centerDist=W(t.centerDist,2.5),this.ssBorder=W(t.ssBorder,!1),super.init(t)}createData(e){let t=0;const r=[],i=[];this.structure.eachPolymer(l=>{if(l.residueCount<4||l.isNucleic())return;const c=new yP(l),u=c.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());t+=u.size.length,r.push(u),i.push(c)},e.getSelection());const o={begin:new Float32Array(3*t),end:new Float32Array(3*t),size:new Float32Array(t),color:new Float32Array(3*t),picking:{}};let s=new Float32Array(t),a=0;return r.forEach(function(l){o.begin.set(l.begin,3*a),o.end.set(l.end,3*a),o.size.set(l.size,a),o.color.set(l.color,3*a),s.set(l.picking.array,a),a+=l.size.length}),t&&(o.picking=new gl(s,e.getStructure())),{bufferList:[new cs({position1:o.begin,position2:o.end,color:o.color,color2:o.color,radius:o.size,picking:o.picking},this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))],axisList:r,helixbundleList:i,axisData:o}}updateData(e,t){if((e=e||{}).position)this.build();else{var r={};if(e.color||e.radius){var i=0;t.helixbundleList.forEach(o=>{var s=o.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());e.color&&t.axisData.color.set(s.color,3*i),(e.radius||e.scale)&&t.axisData.size.set(s.size,i),i+=s.size.length}),e.color&&Object.assign(r,{color:t.axisData.color,color2:t.axisData.color}),(e.radius||e.scale)&&Object.assign(r,{radius:t.axisData.size})}t.bufferList[0].setAttributes(r)}}}xn.add("rocket",sX);class aX extends py{constructor(e,t,r){super(e,t,r),this.type="rope",this.parameters=Object.assign({smooth:{type:"integer",max:15,min:0,rebuild:!0}},this.parameters,{aspectRatio:null,smoothSheet:null})}init(e){var t=e||{};t.aspectRatio=1,t.tension=W(t.tension,.5),t.radiusScale=W(t.radiusScale,5),t.smoothSheet=!1,this.smooth=W(t.smooth,2),super.init(t)}getSpline(e){var t=new xp(e);return new Pc(e,this.getSplineParams({directional:!1,positionIterator:t.getCenterIterator(this.smooth)}))}}xn.add("rope",aX);class lX extends br{constructor(e,t,r){super(e,t,r),this.type="spacefill",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(r)}init(e){var t=e||{};t.useInteriorColor=W(t.useInteriorColor,!0),super.init(t)}createData(e){return{bufferList:[new sa(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0,disableImpostor:this.disableImpostor}))]}}updateData(e,t){var r=t.sview.getAtomData(this.getAtomParams(e)),i={};e&&!e.position||Object.assign(i,{position:r.position}),e&&!e.color||Object.assign(i,{color:r.color}),e&&!e.radius||Object.assign(i,{radius:r.radius}),t.bufferList[0].setAttributes(i)}}function BS(n){return 3*(n.position.length/3-1)*2}xn.add("spacefill",lX);class cX extends Eo{constructor(e,t={}){super({position:new Float32Array(BS(e)),color:new Float32Array(BS(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag",this.setAttributes(e)}setAttributes(e){let t,r,i,o;const s=this.geometry.attributes;if(e.position&&(t=e.position,i=s.position.array,s.position.needsUpdate=!0),e.color&&(r=e.color,o=s.color.array,s.color.needsUpdate=!0),!t&&!r)return void Be.warn("TraceBuffer.prototype.setAttributes no data");let a,l;const c=this.size-1;for(let u=0;u<c;++u)a=3*u,l=3*u*2,t&&(i[l]=t[a],i[l+1]=t[a+1],i[l+2]=t[a+2],i[l+3]=t[a+3],i[l+4]=t[a+4],i[l+5]=t[a+5]),r&&(o[l]=r[a],o[l+1]=r[a+1],o[l+2]=r[a+2],o[l+3]=r[a+3],o[l+4]=r[a+4],o[l+5]=r[a+5])}}class uX extends br{constructor(e,t,r){super(e,t,r),this.type="trace",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null}),this.init(r)}init(e){var t=e||{};t.colorScheme=W(t.colorScheme,"chainname"),t.colorScale=W(t.colorScale,"RdYlBu"),t.quality==="low"?this.subdiv=3:t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=W(t.subdiv,6),this.tension=W(t.tension,NaN),this.smoothSheet=W(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!1,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?.1:0}createData(e){var t=[],r=[];return this.structure.eachPolymer(i=>{if(!(i.residueCount<4)){r.push(i);var o=new Pc(i,this.getSplineParams()),s=o.getSubdividedPosition(),a=o.getSubdividedColor(this.getColorParams());t.push(new cX(Object.assign({},s,a),this.getBufferParams()))}},e.getSelection()),{bufferList:t,polymerList:r}}updateData(e,t){e=e||{};var r=0,i=t.polymerList.length;for(r=0;r<i;++r){var o={},s=new Pc(t.polymerList[r],this.getSplineParams());if(e.position){var a=s.getSubdividedPosition();Object.assign(o,{position:a.position})}if(e.color){var l=s.getSubdividedColor(this.getColorParams());Object.assign(o,{color:l.color})}t.bufferList[r].setAttributes(o)}}setParameters(e){var t={};return e&&e.tension&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}xn.add("trace",uX);class dX extends py{constructor(e,t,r){super(e,t,r),this.type="tube",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,t.radiusScale=W(t.radiusScale,2),t.quality==="low"&&(this.radialSegments=5),super.init(t)}getSplineParams(){return super.getSplineParams({directional:!1})}}xn.add("tube",dX);class hX extends br{constructor(e,t,r){super(e,t,r),this.type="unitcell",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0},this.parameters,{assembly:null}),this.init(r)}init(e){const t=e||{};let r=.5;this.structure.unitcell&&(r=Math.cbrt(this.structure.unitcell.volume)/200),t.radiusSize=W(t.radiusSize,r),t.colorValue=W(t.colorValue,"orange"),t.useInteriorColor=W(t.useInteriorColor,!0),super.init(t)}getUnitcellData(e){return e.unitcell.getData(e)}create(){const e=this.structureView.getStructure();if(!e.unitcell)return;const t=this.getUnitcellData(e);this.sphereBuffer=new sa(t.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new cs(t.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const r=t.sview.getStructure();if(!r.unitcell)return;const i=this.getUnitcellData(r),o={},s={};e&&!e.position||(Object.assign(o,{position:i.vertex.position}),Object.assign(s,{position1:i.edge.position1,position2:i.edge.position2})),e&&!e.color||(Object.assign(o,{color:i.vertex.color}),Object.assign(s,{color:i.edge.color,color2:i.edge.color2})),e&&!e.radius||(Object.assign(o,{radius:i.vertex.radius}),Object.assign(s,{radius:i.edge.radius})),this.sphereBuffer.setAttributes(o),this.cylinderBuffer.setAttributes(s)}}xn.add("unitcell",hX);class fX extends br{constructor(e,t,r){super(e,t,r),this.type="validation",this.parameters=Object.assign({},this.parameters,{radiusType:null,radiusSize:null,radiusScale:null}),this.init(r)}init(e){const t=e||{};t.colorValue=W(t.colorValue,"#f0027f"),t.useInteriorColor=W(t.useInteriorColor,!0),super.init(t)}createData(e){if(!e.validation)return;const t=e.validation.getClashData({structure:e,color:this.colorValue});return{bufferList:[new cs(t,this.getBufferParams({openEnded:!1}))]}}}xn.add("validation",fX);const NS=new te,C0=new te,A0=new te,pX=new te(0,1,0),mX=Object.assign({radialSegments:60,openEnded:!1},zr);class UP extends oa{constructor(e,t={}){super({position:new Float32Array(e.position1.length),color:e.color,picking:e.picking},t,function(r={}){const i=new Hb(1,1,W(r.radialSegments,60),1,W(r.openEnded,!1));return i.applyMatrix4(new at().makeRotationX(-Math.PI/2)),i}(t)),this.updateNormals=!0,this._position=new Float32Array(e.position1.length),this.setAttributes(e,!0)}get defaultParameters(){return mX}applyPositionTransform(e,t,r){C0.fromArray(this._position1,r),A0.fromArray(this._position2,r),e.lookAt(C0,A0,pX);const i=this._radius[t];NS.set(i,i,C0.distanceTo(A0)),e.scale(NS)}setAttributes(e={},t){e.position1&&e.position2&&(So(e.position1,e.position2,this._position),this._position1=e.position1,this._position2=e.position2,e.position=this._position),e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}pi.add("cone",UP);class gX{constructor(e=[]){this.geometryList=e}computeBoundingBox(){this.boundingBox?this.boundingBox.empty():this.boundingBox=new Nn,this.geometryList.forEach(e=>{e.boundingBox||e.computeBoundingBox(),this.boundingBox.union(e.boundingBox)})}}const vX=Object.assign({aspectRatio:1.5,radialSegments:50,openEnded:!1,disableImpostor:!1},zr);class bX{constructor(e,t={}){this.group=new mn,this.wireframeGroup=new mn,this.pickingGroup=new mn,this.visible=!0,this.parameters=hi(t,this.defaultParameters),this.splitPosition=new Float32Array(e.position1.length),this.cylinderRadius=new Float32Array(e.radius.length);const r=this.makeAttributes(e),i={radialSegments:this.parameters.radialSegments,openEnded:this.parameters.openEnded,disableImpostor:this.parameters.disableImpostor};this.cylinderBuffer=new cs(r.cylinder,i),this.coneBuffer=new UP(r.cone,i),this.geometry=new gX([this.cylinderBuffer.geometry,this.coneBuffer.geometry]),this.matrix=W(t.matrix,new at),this.picking=e.picking}get defaultParameters(){return vX}set matrix(e){Eo.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking}makeAttributes(e={}){const t=this.splitPosition,r=this.cylinderRadius,i=this.parameters.aspectRatio;let o,s;const a={},l={};if(e.radius){for(o=0,s=r.length;o<s;++o)r[o]=e.radius[o]/i;a.radius=r,l.radius=e.radius}if(e.position1&&e.position2){const c=new te,u=new te,d=new te,h=new te;for(o=0,s=t.length;o<s;o+=3){c.fromArray(e.position1,o),u.fromArray(e.position2,o),d.subVectors(c,u);const m=d.length(),f=r[o/3]*i*2,v=Math.min(m,f);d.setLength(v),h.copy(u).add(d),h.toArray(t,o)}a.position1=e.position1,a.position2=t,l.position1=t,l.position2=e.position2}return e.color&&(a.color=e.color,a.color2=e.color,l.color=e.color),{cylinder:a,cone:l}}getMesh(){return new mn().add(this.cylinderBuffer.getMesh(),this.coneBuffer.getMesh())}getWireframeMesh(){return new mn().add(this.cylinderBuffer.getWireframeMesh(),this.coneBuffer.getWireframeMesh())}getPickingMesh(){return new mn().add(this.cylinderBuffer.getPickingMesh(),this.coneBuffer.getPickingMesh())}setAttributes(e={}){const t=this.makeAttributes(e);this.cylinderBuffer.setAttributes(t.cylinder),this.coneBuffer.setAttributes(t.cone)}setParameters(e={}){(e=Object.assign({},e))&&e.matrix!==void 0&&(this.matrix=e.matrix),delete e.matrix,e&&e.wireframe!==void 0&&(this.parameters.wireframe=e.wireframe,this.setVisibility(this.visible)),this.cylinderBuffer.setParameters(e),this.coneBuffer.setParameters(e)}setVisibility(e){Eo.prototype.setVisibility.call(this,e)}dispose(){this.cylinderBuffer.dispose(),this.coneBuffer.dispose()}}pi.add("arrow",bX);const zS=new te,M0=new te,T0=new te,yX=new te(0,0,0);class _X extends oa{constructor(e,t={}){super(e,t,new Hc(1,1,1)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,r){M0.fromArray(this._heightAxis,r),T0.fromArray(this._depthAxis,r),e.lookAt(yX,M0,T0),zS.set(this._size[t],T0.length(),M0.length()),e.scale(zS)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}pi.add("box",_X);const US=new te,E0=new te,P0=new te,xX=new te(0,0,0),wX=Object.assign({sphereDetail:2},zr);class SX extends oa{constructor(e,t={}){super(e,t,new hm(1,W(t.sphereDetail,2))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return wX}applyPositionTransform(e,t,r){E0.fromArray(this._majorAxis,r),P0.fromArray(this._minorAxis,r),e.lookAt(xX,E0,P0),US.set(this._radius[t],P0.length(),E0.length()),e.scale(US)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}}pi.add("ellipsoid",SX);const $S=new te,R0=new te,I0=new te,CX=new te(0,0,0);class AX extends oa{constructor(e,t={}){super(e,t,new Vb(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,r){R0.fromArray(this._heightAxis,r),I0.fromArray(this._depthAxis,r),e.lookAt(CX,R0,I0),$S.set(this._size[t],I0.length(),R0.length()),e.scale($S)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}pi.add("octahedron",AX);const HS=new te,D0=new te,L0=new te,MX=new te(0,0,0);class TX extends oa{constructor(e,t={}){super(e,t,new Gb(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,r){D0.fromArray(this._heightAxis,r),L0.fromArray(this._depthAxis,r),e.lookAt(MX,D0,L0),HS.set(this._size[t],L0.length(),D0.length()),e.scale(HS)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}pi.add("tetrahedron",TX);const VS=new te,GS=new te,WS=new te,EX=new te(0,0,0),PX=Object.assign({radiusRatio:.2,radialSegments:16,tubularSegments:32},zr);class RX extends oa{constructor(e,t={}){super(e,t,new Wb(1,W(t.radiusRatio,.2),W(t.radialSegments,16),W(t.tubularSegments,32))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return PX}applyPositionTransform(e,t,r){GS.fromArray(this._majorAxis,r),WS.fromArray(this._minorAxis,r),e.lookAt(EX,GS,WS);const i=this._radius[t];VS.set(i,i,i),e.scale(VS)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}}function tc(n,e){return{start:e&&e.start!==void 0?Math.max(Math.min(e.start,n-1),0):0,end:e&&e.end!==void 0?Math.min(e.end,n):n}}function Hd(n,e){const t=e&&e.array!==void 0?e.array:Array,{start:r,end:i}=tc(n,e);return{array:new t(i-r),start:r,end:i}}function wr(n,e,t){const{array:r,start:i}=Hd(n,t);return function(o,s,a){for(let l=0,c=s.length;l<c;l++)s[l]=o(a+l);return s}(e,r,i)}function my(n){return!!n.buffer&&typeof n.byteLength=="number"&&typeof n.BYTES_PER_ELEMENT=="number"}function Cp(n,e){const{constructor:t,buffer:r,length:i,byteOffset:o,BYTES_PER_ELEMENT:s}=n,{start:a,end:l}=tc(i,e);return a===0&&l===i?n:new t(r,o+s*a,Math.min(i,l-a))}pi.add("torus",RX);const Un=1e-6;function dr(n,e,t){return Math.abs(n-e)<=t}function jS(n,e,t){return Math.max(e,Math.min(t,n))}function F0(n,e,t,r,i,o){const s=(t-n)*o,a=(r-e)*o,l=i*i;return(2*e-2*t+s+a)*(i*l)+(-3*e+3*t-2*s-a)*l+s*i+e}function O0(n,e,t,r){const i=1-r;return i*i*n+2*i*r*e+r*r*t}const k0=isFinite;function on(){return on.zero()}(function(n){function e(){const M=[.1,0,0];return M[0]=0,M}function t(M,P,E){const R=e();return R[0]=M,R[1]=P,R[2]=E,R}function r(M,P){return M[0]=P[0],M[1]=P[1],M[2]=P[2],M}function i(M,P,E){return M[0]=P[0]+E[0],M[1]=P[1]+E[1],M[2]=P[2]+E[2],M}function o(M,P,E){return M[0]=P[0]-E[0],M[1]=P[1]-E[1],M[2]=P[2]-E[2],M}function s(M,P,E){return M[0]=P[0]*E,M[1]=P[1]*E,M[2]=P[2]*E,M}function a(M,P,E,R){return M[0]=P[0]+E[0]*R,M[1]=P[1]+E[1]*R,M[2]=P[2]+E[2]*R,M}function l(M){const P=M[0],E=M[1],R=M[2];return P*P+E*E+R*R}function c(M,P){return M[0]=-P[0],M[1]=-P[1],M[2]=-P[2],M}function u(M,P){const E=P[0],R=P[1],B=P[2];let L=E*E+R*R+B*B;return L>0&&(L=1/Math.sqrt(L),M[0]=P[0]*L,M[1]=P[1]*L,M[2]=P[2]*L),M}function d(M,P){return M[0]*P[0]+M[1]*P[1]+M[2]*P[2]}function h(M,P,E){const R=P[0],B=P[1],L=P[2],F=E[0],H=E[1],$=E[2];return M[0]=B*$-L*H,M[1]=L*F-R*$,M[2]=R*H-B*F,M}n.zero=e,n.clone=function(M){const P=e();return P[0]=M[0],P[1]=M[1],P[2]=M[2],P},n.isFinite=function(M){return k0(M[0])&&k0(M[1])&&k0(M[2])},n.hasNaN=function(M){return isNaN(M[0])||isNaN(M[1])||isNaN(M[2])},n.setNaN=function(M){return M[0]=NaN,M[1]=NaN,M[2]=NaN,M},n.fromObj=function(M){return t(M.x,M.y,M.z)},n.toObj=function(M){return{x:M[0],y:M[1],z:M[2]}},n.fromArray=function(M,P,E){return M[0]=P[E+0],M[1]=P[E+1],M[2]=P[E+2],M},n.toArray=function(M,P,E){return P[E+0]=M[0],P[E+1]=M[1],P[E+2]=M[2],P},n.create=t,n.ofArray=function(M){const P=e();return P[0]=M[0],P[1]=M[1],P[2]=M[2],P},n.set=function(M,P,E,R){return M[0]=P,M[1]=E,M[2]=R,M},n.copy=r,n.add=i,n.sub=o,n.mul=function(M,P,E){return M[0]=P[0]*E[0],M[1]=P[1]*E[1],M[2]=P[2]*E[2],M},n.div=function(M,P,E){return M[0]=P[0]/E[0],M[1]=P[1]/E[1],M[2]=P[2]/E[2],M},n.scale=s,n.scaleAndAdd=a,n.scaleAndSub=function(M,P,E,R){return M[0]=P[0]-E[0]*R,M[1]=P[1]-E[1]*R,M[2]=P[2]-E[2]*R,M},n.addScalar=function(M,P,E){return M[0]=P[0]+E,M[1]=P[1]+E,M[2]=P[2]+E,M},n.subScalar=function(M,P,E){return M[0]=P[0]-E,M[1]=P[1]-E,M[2]=P[2]-E,M},n.round=function(M,P){return M[0]=Math.round(P[0]),M[1]=Math.round(P[1]),M[2]=Math.round(P[2]),M},n.ceil=function(M,P){return M[0]=Math.ceil(P[0]),M[1]=Math.ceil(P[1]),M[2]=Math.ceil(P[2]),M},n.floor=function(M,P){return M[0]=Math.floor(P[0]),M[1]=Math.floor(P[1]),M[2]=Math.floor(P[2]),M},n.trunc=function(M,P){return M[0]=Math.trunc(P[0]),M[1]=Math.trunc(P[1]),M[2]=Math.trunc(P[2]),M},n.abs=function(M,P){return M[0]=Math.abs(P[0]),M[1]=Math.abs(P[1]),M[2]=Math.abs(P[2]),M},n.min=function(M,P,E){return M[0]=Math.min(P[0],E[0]),M[1]=Math.min(P[1],E[1]),M[2]=Math.min(P[2],E[2]),M},n.max=function(M,P,E){return M[0]=Math.max(P[0],E[0]),M[1]=Math.max(P[1],E[1]),M[2]=Math.max(P[2],E[2]),M},n.clamp=function(M,P,E,R){return M[0]=Math.max(E[0],Math.min(R[0],P[0])),M[1]=Math.max(E[1],Math.min(R[1],P[1])),M[2]=Math.max(E[2],Math.min(R[2],P[2])),M},n.distance=function(M,P){const E=P[0]-M[0],R=P[1]-M[1],B=P[2]-M[2];return Math.sqrt(E*E+R*R+B*B)},n.squaredDistance=function(M,P){const E=P[0]-M[0],R=P[1]-M[1],B=P[2]-M[2];return E*E+R*R+B*B},n.magnitude=function(M){const P=M[0],E=M[1],R=M[2];return Math.sqrt(P*P+E*E+R*R)},n.squaredMagnitude=l,n.setMagnitude=function(M,P,E){return s(M,u(M,P),E)},n.negate=c,n.inverse=function(M,P){return M[0]=1/P[0],M[1]=1/P[1],M[2]=1/P[2],M},n.normalize=u,n.dot=d,n.cross=h,n.lerp=function(M,P,E,R){const B=P[0],L=P[1],F=P[2];return M[0]=B+R*(E[0]-B),M[1]=L+R*(E[1]-L),M[2]=F+R*(E[2]-F),M};const m=e();function f(M,P){const E=Math.sqrt(l(M)*l(P));if(E===0)return Math.PI/2;const R=d(M,P)/E;return Math.acos(jS(R,-1,1))}n.slerp=function(M,P,E,R){const B=jS(d(P,E),-1,1),L=Math.acos(B)*R;return a(m,E,P,-B),u(m,m),i(M,s(M,P,Math.cos(L)),s(m,m,Math.sin(L)))},n.hermite=function(M,P,E,R,B,L){const F=L*L,H=F*(2*L-3)+1,$=F*(L-2)+L,O=F*(L-1),k=F*(3-2*L);return M[0]=P[0]*H+E[0]*$+R[0]*O+B[0]*k,M[1]=P[1]*H+E[1]*$+R[1]*O+B[1]*k,M[2]=P[2]*H+E[2]*$+R[2]*O+B[2]*k,M},n.bezier=function(M,P,E,R,B,L){const F=1-L,H=F*F,$=L*L,O=H*F,k=3*L*H,X=3*$*F,ie=$*L;return M[0]=P[0]*O+E[0]*k+R[0]*X+B[0]*ie,M[1]=P[1]*O+E[1]*k+R[1]*X+B[1]*ie,M[2]=P[2]*O+E[2]*k+R[2]*X+B[2]*ie,M},n.quadraticBezier=function(M,P,E,R,B){return M[0]=O0(P[0],E[0],R[0],B),M[1]=O0(P[1],E[1],R[1],B),M[2]=O0(P[2],E[2],R[2],B),M},n.spline=function(M,P,E,R,B,L,F){return M[0]=F0(P[0],E[0],R[0],B[0],L,F),M[1]=F0(P[1],E[1],R[1],B[1],L,F),M[2]=F0(P[2],E[2],R[2],B[2],L,F),M},n.random=function(M,P){const E=2*Math.random()*Math.PI,R=2*Math.random()-1,B=Math.sqrt(1-R*R)*P;return M[0]=Math.cos(E)*B,M[1]=Math.sin(E)*B,M[2]=R*P,M},n.transformMat4=function(M,P,E){const R=P[0],B=P[1],L=P[2],F=1/(E[3]*R+E[7]*B+E[11]*L+E[15]||1);return M[0]=(E[0]*R+E[4]*B+E[8]*L+E[12])*F,M[1]=(E[1]*R+E[5]*B+E[9]*L+E[13])*F,M[2]=(E[2]*R+E[6]*B+E[10]*L+E[14])*F,M},n.transformDirection=function(M,P,E){const R=P[0],B=P[1],L=P[2];return M[0]=E[0]*R+E[4]*B+E[8]*L,M[1]=E[1]*R+E[5]*B+E[9]*L,M[2]=E[2]*R+E[6]*B+E[10]*L,u(M,M)},n.transformMat4Offset=function(M,P,E,R,B,L){const F=P[0+B],H=P[1+B],$=P[2+B],O=1/(E[3+L]*F+E[7+L]*H+E[11+L]*$+E[15+L]||1);return M[0+R]=(E[0+L]*F+E[4+L]*H+E[8+L]*$+E[12+L])*O,M[1+R]=(E[1+L]*F+E[5+L]*H+E[9+L]*$+E[13+L])*O,M[2+R]=(E[2+L]*F+E[6+L]*H+E[10+L]*$+E[14+L])*O,M},n.transformDirectionOffset=function(M,P,E,R,B,L){const F=P[0+B],H=P[1+B],$=P[2+B];M[0+R]=E[0+L]*F+E[4+L]*H+E[8+L]*$,M[1+R]=E[1+L]*F+E[5+L]*H+E[9+L]*$,M[2+R]=E[2+L]*F+E[6+L]*H+E[10+L]*$;const O=Math.hypot(M[0+R],M[1+R],M[2+R]);return O>0&&(M[0+R]/=O,M[1+R]/=O,M[2+R]/=O),M},n.transformMat3=function(M,P,E){const R=P[0],B=P[1],L=P[2];return M[0]=R*E[0]+B*E[3]+L*E[6],M[1]=R*E[1]+B*E[4]+L*E[7],M[2]=R*E[2]+B*E[5]+L*E[8],M},n.transformQuat=function(M,P,E){const R=P[0],B=P[1],L=P[2],F=E[0],H=E[1],$=E[2],O=E[3],k=O*R+H*L-$*B,X=O*B+$*R-F*L,ie=O*L+F*B-H*R,ne=-F*R-H*B-$*L;return M[0]=k*O+ne*-F+X*-$-ie*-H,M[1]=X*O+ne*-H+ie*-F-k*-$,M[2]=ie*O+ne*-$+k*-H-X*-F,M},n.angle=f;const v=e(),g=e(),b=e(),S=e(),p=e(),y=e(),w=e();n.dihedralAngle=function(M,P,E,R){o(v,M,P),o(g,E,P),o(b,P,E),o(S,R,E),h(p,v,g),h(y,b,S);const B=f(p,y);return h(w,p,y),d(g,w)>0?B:-B},n.directionFromSpherical=function(M,P,E,R){return n.set(M,R*Math.cos(E)*Math.sin(P),R*Math.sin(E)*Math.sin(P),R*Math.cos(P))},n.exactEquals=function(M,P){return M[0]===P[0]&&M[1]===P[1]&&M[2]===P[2]},n.equals=function(M,P){const E=M[0],R=M[1],B=M[2],L=P[0],F=P[1],H=P[2];return Math.abs(E-L)<=Un*Math.max(1,Math.abs(E),Math.abs(L))&&Math.abs(R-F)<=Un*Math.max(1,Math.abs(R),Math.abs(F))&&Math.abs(B-H)<=Un*Math.max(1,Math.abs(B),Math.abs(H))};const x=e();n.makeRotation=function(M,P,E){const R=f(P,E);if(Math.abs(R)<1e-4)return ks.setIdentity(M);if(Math.abs(R-Math.PI)<Un)return ks.fromScaling(M,n.negUnit);const B=h(x,P,E);return ks.fromRotation(M,R,B)},n.isZero=function(M){return M[0]===0&&M[1]===0&&M[2]===0},n.projectPointOnVector=function(M,P,E,R){return o(M,P,R),i(M,s(M,E,d(E,M)/l(E)),R)};const _=e();function A(M,P,E){return s(M,E,d(E,P)/l(E))}n.projectPointOnPlane=function(M,P,E,R){return u(_,E),o(M,P,R),o(M,P,s(_,_,d(M,_)))},n.projectOnVector=A;const C=e();n.projectOnPlane=function(M,P,E){return A(C,P,E),o(M,P,C)},n.orthogonalize=function(M,P,E){return u(M,h(M,h(M,P,E),P))},n.matchDirection=function(M,P,E){return d(P,E)>0?r(M,P):c(M,r(M,P)),M};const T=e(),I=e();n.triangleNormal=function(M,P,E,R){return o(T,E,P),o(I,R,P),u(M,h(M,T,I))},n.toString=function(M,P){return`[${M[0].toPrecision(P)} ${M[1].toPrecision(P)} ${M[2].toPrecision(P)}]`},n.origin=t(0,0,0),n.unit=t(1,1,1),n.negUnit=t(-1,-1,-1),n.unitX=t(1,0,0),n.unitY=t(0,1,0),n.unitZ=t(0,0,1),n.negUnitX=t(-1,0,0),n.negUnitY=t(0,-1,0),n.negUnitZ=t(0,0,-1)})(on||(on={}));const IX=Math.PI/180;function Aa(n){return n*IX}function ks(){return ks.zero()}function Nf(){return Nf.zero()}function _v(){return _v.zero()}function xv(){return xv.zero()}function Ap(n){throw new Error("unreachable")}function wv(){return wv.zero()}var Pu,An,qS,Lr;function pc(n,e,t){let r=e,i=0,o=1;for(n.charCodeAt(r)===45?(o=-1,++r):n.charCodeAt(r)===43&&++r;r<t;r++){const s=n.charCodeAt(r)-48;if(s>9||s<0)return o*i|0;i=10*i+s|0}return o*i}function XS(n,e,t,r){return e.charCodeAt(t)===43&&t++,n*Math.pow(10,pc(e,t,r))}function Yu(n,e,t){let r=e,i=1,o=0,s=0,a=1;for(n.charCodeAt(r)===45?(i=-1,++r):n.charCodeAt(r)===43&&++r;r<t;){let l=n.charCodeAt(r)-48;if(!(l>=0&&l<10)){if(l===-2){for(++r;r<t;){if(l=n.charCodeAt(r)-48,!(l>=0&&l<10))return l===53||l===21?XS(i*(o+s/a),n,r+1,t):i*(o+s/a);s=10*s+l,a*=10,++r}return i*(o+s/a)}if(l===53||l===21)return XS(i*o,n,r+1,t);break}o=10*o+l,++r}return i*o}function YS(n,e,t,r){return{schema:t,__array:void 0,isDefined:r===0,rowCount:e,value:i=>n,valueKind:i=>r,toArray:i=>{const{array:o}=Hd(e,i);for(let s=0,a=o.length;s<a;s++)o[s]=n;return o},areValuesEqual:(i,o)=>!0}}function Jh({value:n,valueKind:e,areValuesEqual:t,rowCount:r,schema:i}){return{schema:i,__array:void 0,isDefined:!0,rowCount:r,value:n,valueKind:e||(o=>0),toArray:o=>{const{array:s,start:a}=Hd(r,o);for(let l=0,c=s.length;l<c;l++)s[l]=n(l+a);return s},areValuesEqual:t||((o,s)=>n(o)===n(s))}}function qo({array:n,schema:e,valueKind:t}){const r=n.length,i=e.T,o=e.valueType==="str"?e.transform==="lowercase"?a=>{const l=n[a];return typeof l=="string"?l.toLowerCase():`${l??i}`.toLowerCase()}:e.transform==="uppercase"?a=>{const l=n[a];return typeof l=="string"?l.toUpperCase():`${l??i}`.toUpperCase()}:a=>{const l=n[a];return typeof l=="string"?l:`${l??i}`}:a=>n[a],s=my(n);return{schema:e,__array:n,isDefined:!0,rowCount:r,value:o,valueKind:t||(a=>0),toArray:e.valueType==="str"?e.transform==="lowercase"?a=>{const{start:l,end:c}=tc(r,a),u=new(a&&a.array!==void 0?a.array:n.constructor)(c-l);for(let d=0,h=c-l;d<h;d++){const m=n[l+d];u[d]=typeof m=="string"?m.toLowerCase():`${m??i}`.toLowerCase()}return u}:e.transform==="uppercase"?a=>{const{start:l,end:c}=tc(r,a),u=new(a&&a.array!==void 0?a.array:n.constructor)(c-l);for(let d=0,h=c-l;d<h;d++){const m=n[l+d];u[d]=typeof m=="string"?m.toUpperCase():`${m??i}`.toUpperCase()}return u}:a=>{const{start:l,end:c}=tc(r,a),u=new(a&&a.array!==void 0?a.array:n.constructor)(c-l);for(let d=0,h=c-l;d<h;d++){const m=n[l+d];u[d]=typeof m=="string"?m:`${m??i}`}return u}:s?a=>Cp(n,a):a=>{const{start:l,end:c}=tc(r,a);if(l===0&&c===n.length)return n;const u=new(a&&a.array!==void 0?a.array:n.constructor)(c-l);for(let d=0,h=c-l;d<h;d++)u[d]=n[l+d];return u},areValuesEqual:(a,l)=>n[a]===n[l]}}function DX(n,e,t){return n.isDefined?e===0&&t===n.rowCount?n:n.__array&&my(n.__array)?function(r,i,o){const s=Cp(r.__array,{start:i,end:o}),a=r.valueKind;return qo({array:s,schema:r.schema,valueKind:l=>a(i+l)})}(n,e,t):function(r,i,o){const s=r.value,a=r.valueKind,l=r.areValuesEqual,c=i===0?s:d=>s(d+i),u=o-i;return{schema:r.schema,__array:void 0,isDefined:r.isDefined,rowCount:u,value:c,valueKind:i===0?a:d=>a(d+i),toArray:d=>{const{array:h}=Hd(u,d);for(let m=0,f=h.length;m<f;m++)h[m]=s(m+i);return h},areValuesEqual:i===0?l:(d,h)=>l(d+i,h+i)}}(n,e,t):An.Undefined(t-e,n.schema)}function LX(n,e,t){return n.rowCount===0||t&&function(r,i){if(r.length!==i)return!1;for(let o=0,s=r.length;o<s;o++)if(r[o]!==o)return!1;return!0}(e,n.rowCount)?n:n.__array&&typeof n.value(0)==typeof n.__array[0]?function(r,i){const o=r.__array,s=new o.constructor(i.length);for(let l=0,c=i.length;l<c;l++)s[l]=o[i[l]];const a=r.valueKind;return qo({array:s,schema:r.schema,valueKind:l=>a(i[l])})}(n,e):function(r,i){const o=r.value,s=r.valueKind,a=r.areValuesEqual,l=u=>o(i[u]),c=i.length;return{schema:r.schema,__array:void 0,isDefined:r.isDefined,rowCount:c,value:l,valueKind:u=>s(i[u]),toArray:u=>{const{array:d}=Hd(c,u);for(let h=0,m=d.length;h<m;h++)d[h]=o(i[h]);return d},areValuesEqual:(u,d)=>a(i[u],i[d])}}(n,e)}function zf(n,e,t){return n[e]-n[t]}function Ru(n,e,t){const r=n[e];n[e]=n[t],n[t]=r}function $P(n,e,t,r){const i=t+r>>1;return e(n,t,r)>0?e(n,t,i)>0?e(n,i,r)>0?i:r:t:e(n,r,i)>0?e(n,i,t)>0?i:t:r}function FX(n,e,t){const{cmp:r,swap:i,data:o,parts:s}=n;let a=e+1,l=t;for(i(o,e,$P(o,r,e,t));r(o,l,e)>0;)--l;for(let c=e+1;c<=l;c++){const u=r(o,c,e);if(u>0){for(i(o,c,l),--l;r(o,l,e)>0;)--l;c--}else u===0&&(i(o,c,a),a++)}for(let c=e;c<a;c++)i(o,c,e+l-c);s[0]=l-a+e+1,s[1]=l}function OX({data:n,cmp:e,swap:t},r,i){for(let o=r+1;o<=i;o++){let s=o-1;for(;s>=r&&e(n,s,s+1)>0;)t(n,s,s+1),s-=1}}function Sv(n,e,t){const{parts:r}=n;for(;e<t;){if(t-e<16)return void OX(n,e,t);FX(n,e,t);const i=r[0],o=r[1];i-e<t-o?(Sv(n,e,i-1),e=o+1):(Sv(n,o+1,t),t=i-1)}}function kX(n,e,t,r){let i=t+1,o=r;Ru(n,t,$P(n,zf,t,r));const s=n[t];for(;n[o]>s;)--o;for(let a=t+1;a<=o;a++){const l=n[a];if(l>s){for(Ru(n,a,o),--o;n[o]>s;)--o;a--}else l===s&&(Ru(n,a,i),++i)}for(let a=t;a<i;a++)Ru(n,a,t+o-a);e[0]=o-i+t+1,e[1]=o}function BX(n,e,t){for(let r=e+1;r<=t;r++){const i=n[r];let o=r-1;for(;o>=e&&n[o]>i;)n[o+1]=n[o],o-=1;n[o+1]=i}}function Cv(n,e,t,r){for(;t<r;){if(r-t<16)return void BX(n,t,r);kX(n,e,t,r);const i=e[0],o=e[1];i-t<r-o?(Cv(n,e,t,i-1),t=o+1):(Cv(n,e,o+1,r),r=i-1)}}function NX(n,e=zf){return function(t,r,i,o=zf){return o===zf?Cv(t,[0,0],r,i-1):Sv({data:t,cmp:o,swap:Ru,parts:[0,0]},r,i-1),t}(n,0,n.length,e)}(function(n){function e(){const p=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return p[0]=0,p}function t(){const p=e();return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function r(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function i(p){for(let y=0;y<16;y++)p[y]=0;return p}n.zero=e,n.identity=t,n.setIdentity=r,n.setZero=i,n.ofRows=function(p){const y=e();for(let w=0;w<4;w++){const x=p[w];for(let _=0;_<4;_++)y[4*_+w]=x[_]}return y};const o=t();function s(p,y,w){for(let x=0;x<16;x++)if(Math.abs(p[x]-y[x])>w)return!1;return!0}function a(p,y,w,x){p[4*w+y]=x}function l(p,y){return p[0]=y[0],p[1]=y[1],p[2]=y[2],p[3]=y[3],p[4]=y[4],p[5]=y[5],p[6]=y[6],p[7]=y[7],p[8]=y[8],p[9]=y[9],p[10]=y[10],p[11]=y[11],p[12]=y[12],p[13]=y[13],p[14]=y[14],p[15]=y[15],p}function c(p,y){const w=y[0]+y[5]+y[10];let x=0;return w>0?(x=2*Math.sqrt(w+1),p[3]=.25*x,p[0]=(y[6]-y[9])/x,p[1]=(y[8]-y[2])/x,p[2]=(y[1]-y[4])/x):y[0]>y[5]&&y[0]>y[10]?(x=2*Math.sqrt(1+y[0]-y[5]-y[10]),p[3]=(y[6]-y[9])/x,p[0]=.25*x,p[1]=(y[1]+y[4])/x,p[2]=(y[8]+y[2])/x):y[5]>y[10]?(x=2*Math.sqrt(1+y[5]-y[0]-y[10]),p[3]=(y[8]-y[2])/x,p[0]=(y[1]+y[4])/x,p[1]=.25*x,p[2]=(y[6]+y[9])/x):(x=2*Math.sqrt(1+y[10]-y[0]-y[5]),p[3]=(y[1]-y[4])/x,p[0]=(y[8]+y[2])/x,p[1]=(y[6]+y[9])/x,p[2]=.25*x),p}function u(p,y){const w=y[0],x=y[1],_=y[2],A=y[3],C=y[4],T=y[5],I=y[6],M=y[7],P=y[8],E=y[9],R=y[10],B=y[11],L=y[12],F=y[13],H=y[14],$=y[15],O=w*T-x*C,k=w*I-_*C,X=w*M-A*C,ie=x*I-_*T,ne=x*M-A*T,Q=_*M-A*I,ce=P*F-E*L,Z=P*H-R*L,re=P*$-B*L,se=E*H-R*F,fe=E*$-B*F,ue=R*$-B*H;let U=O*ue-k*fe+X*se+ie*re-ne*Z+Q*ce;return!!U&&(U=1/U,p[0]=(T*ue-I*fe+M*se)*U,p[1]=(_*fe-x*ue-A*se)*U,p[2]=(F*Q-H*ne+$*ie)*U,p[3]=(R*ne-E*Q-B*ie)*U,p[4]=(I*re-C*ue-M*Z)*U,p[5]=(w*ue-_*re+A*Z)*U,p[6]=(H*X-L*Q-$*k)*U,p[7]=(P*Q-R*X+B*k)*U,p[8]=(C*fe-T*re+M*ce)*U,p[9]=(x*re-w*fe-A*ce)*U,p[10]=(L*ne-F*X+$*O)*U,p[11]=(E*X-P*ne-B*O)*U,p[12]=(T*Z-C*se-I*ce)*U,p[13]=(w*se-x*Z+_*ce)*U,p[14]=(F*k-L*ie-H*O)*U,p[15]=(P*ie-E*k+R*O)*U,!0)}function d(p,y,w){const x=y[0],_=y[1],A=y[2],C=y[3],T=y[4],I=y[5],M=y[6],P=y[7],E=y[8],R=y[9],B=y[10],L=y[11],F=y[12],H=y[13],$=y[14],O=y[15];let k=w[0],X=w[1],ie=w[2],ne=w[3];return p[0]=k*x+X*T+ie*E+ne*F,p[1]=k*_+X*I+ie*R+ne*H,p[2]=k*A+X*M+ie*B+ne*$,p[3]=k*C+X*P+ie*L+ne*O,k=w[4],X=w[5],ie=w[6],ne=w[7],p[4]=k*x+X*T+ie*E+ne*F,p[5]=k*_+X*I+ie*R+ne*H,p[6]=k*A+X*M+ie*B+ne*$,p[7]=k*C+X*P+ie*L+ne*O,k=w[8],X=w[9],ie=w[10],ne=w[11],p[8]=k*x+X*T+ie*E+ne*F,p[9]=k*_+X*I+ie*R+ne*H,p[10]=k*A+X*M+ie*B+ne*$,p[11]=k*C+X*P+ie*L+ne*O,k=w[12],X=w[13],ie=w[14],ne=w[15],p[12]=k*x+X*T+ie*E+ne*F,p[13]=k*_+X*I+ie*R+ne*H,p[14]=k*A+X*M+ie*B+ne*$,p[15]=k*C+X*P+ie*L+ne*O,p}function h(p,y,w){let x=w[0],_=w[1],A=w[2],C=Math.sqrt(x*x+_*_+A*A);if(Math.abs(C)<Un)return r(p);C=1/C,x*=C,_*=C,A*=C;const T=Math.sin(y),I=Math.cos(y),M=1-I;return p[0]=x*x*M+I,p[1]=_*x*M+A*T,p[2]=A*x*M-_*T,p[3]=0,p[4]=x*_*M-A*T,p[5]=_*_*M+I,p[6]=A*_*M+x*T,p[7]=0,p[8]=x*A*M+_*T,p[9]=_*A*M-x*T,p[10]=A*A*M+I,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}n.isIdentity=function(p,y){return s(p,o,y===void 0?Un:y)},n.hasNaN=function(p){for(let y=0;y<16;y++)if(isNaN(p[y]))return!0;return!1},n.areEqual=s,n.setValue=a,n.getValue=function(p,y,w){return p[4*w+y]},n.toArray=function(p,y,w){return y[w+0]=p[0],y[w+1]=p[1],y[w+2]=p[2],y[w+3]=p[3],y[w+4]=p[4],y[w+5]=p[5],y[w+6]=p[6],y[w+7]=p[7],y[w+8]=p[8],y[w+9]=p[9],y[w+10]=p[10],y[w+11]=p[11],y[w+12]=p[12],y[w+13]=p[13],y[w+14]=p[14],y[w+15]=p[15],y},n.fromArray=function(p,y,w){return p[0]=y[w+0],p[1]=y[w+1],p[2]=y[w+2],p[3]=y[w+3],p[4]=y[w+4],p[5]=y[w+5],p[6]=y[w+6],p[7]=y[w+7],p[8]=y[w+8],p[9]=y[w+9],p[10]=y[w+10],p[11]=y[w+11],p[12]=y[w+12],p[13]=y[w+13],p[14]=y[w+14],p[15]=y[w+15],p},n.fromBasis=function(p,y,w,x){return i(p),a(p,0,0,y[0]),a(p,1,0,y[1]),a(p,2,0,y[2]),a(p,0,1,w[0]),a(p,1,1,w[1]),a(p,2,1,w[2]),a(p,0,2,x[0]),a(p,1,2,x[1]),a(p,2,2,x[2]),a(p,3,3,1),p},n.copy=l,n.clone=function(p){return l(e(),p)},n.getTranslation=function(p,y){return p[0]=y[12],p[1]=y[13],p[2]=y[14],p},n.getScaling=function(p,y){const w=y[0],x=y[1],_=y[2],A=y[4],C=y[5],T=y[6],I=y[8],M=y[9],P=y[10];return p[0]=Math.sqrt(w*w+x*x+_*_),p[1]=Math.sqrt(A*A+C*C+T*T),p[2]=Math.sqrt(I*I+M*M+P*P),p},n.getRotation=c,n.extractRotation=function(p,y){const w=1/Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]),x=1/Math.sqrt(y[4]*y[4]+y[5]*y[5]+y[6]*y[6]),_=1/Math.sqrt(y[8]*y[8]+y[9]*y[9]+y[10]*y[10]);return p[0]=y[0]*w,p[1]=y[1]*w,p[2]=y[2]*w,p[3]=0,p[4]=y[4]*x,p[5]=y[5]*x,p[6]=y[6]*x,p[7]=0,p[8]=y[8]*_,p[9]=y[9]*_,p[10]=y[10]*_,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},n.transpose=function(p,y){if(p===y){const w=y[1],x=y[2],_=y[3],A=y[6],C=y[7],T=y[11];p[1]=y[4],p[2]=y[8],p[3]=y[12],p[4]=w,p[6]=y[9],p[7]=y[13],p[8]=x,p[9]=A,p[11]=y[14],p[12]=_,p[13]=C,p[14]=T}else p[0]=y[0],p[1]=y[4],p[2]=y[8],p[3]=y[12],p[4]=y[1],p[5]=y[5],p[6]=y[9],p[7]=y[13],p[8]=y[2],p[9]=y[6],p[10]=y[10],p[11]=y[14],p[12]=y[3],p[13]=y[7],p[14]=y[11],p[15]=y[15];return p},n.tryInvert=u,n.invert=function(p,y){return u(p,y)||console.warn("non-invertible matrix.",y),p},n.mul=d,n.mulOffset=function(p,y,w,x,_,A){const C=y[0+_],T=y[1+_],I=y[2+_],M=y[3+_],P=y[4+_],E=y[5+_],R=y[6+_],B=y[7+_],L=y[8+_],F=y[9+_],H=y[10+_],$=y[11+_],O=y[12+_],k=y[13+_],X=y[14+_],ie=y[15+_];let ne=w[0+A],Q=w[1+A],ce=w[2+A],Z=w[3+A];return p[0+x]=ne*C+Q*P+ce*L+Z*O,p[1+x]=ne*T+Q*E+ce*F+Z*k,p[2+x]=ne*I+Q*R+ce*H+Z*X,p[3+x]=ne*M+Q*B+ce*$+Z*ie,ne=w[4+A],Q=w[5+A],ce=w[6+A],Z=w[7+A],p[4+x]=ne*C+Q*P+ce*L+Z*O,p[5+x]=ne*T+Q*E+ce*F+Z*k,p[6+x]=ne*I+Q*R+ce*H+Z*X,p[7+x]=ne*M+Q*B+ce*$+Z*ie,ne=w[8+A],Q=w[9+A],ce=w[10+A],Z=w[11+A],p[8+x]=ne*C+Q*P+ce*L+Z*O,p[9+x]=ne*T+Q*E+ce*F+Z*k,p[10+x]=ne*I+Q*R+ce*H+Z*X,p[11+x]=ne*M+Q*B+ce*$+Z*ie,ne=w[12+A],Q=w[13+A],ce=w[14+A],Z=w[15+A],p[12+x]=ne*C+Q*P+ce*L+Z*O,p[13+x]=ne*T+Q*E+ce*F+Z*k,p[14+x]=ne*I+Q*R+ce*H+Z*X,p[15+x]=ne*M+Q*B+ce*$+Z*ie,p},n.mul3=function(p,y,w,x){return d(p,d(p,y,w),x)},n.translate=function(p,y,w){const x=w[0],_=w[1],A=w[2];let C,T,I,M,P,E,R,B,L,F,H,$;return y===p?(p[12]=y[0]*x+y[4]*_+y[8]*A+y[12],p[13]=y[1]*x+y[5]*_+y[9]*A+y[13],p[14]=y[2]*x+y[6]*_+y[10]*A+y[14],p[15]=y[3]*x+y[7]*_+y[11]*A+y[15]):(C=y[0],T=y[1],I=y[2],M=y[3],P=y[4],E=y[5],R=y[6],B=y[7],L=y[8],F=y[9],H=y[10],$=y[11],p[0]=C,p[1]=T,p[2]=I,p[3]=M,p[4]=P,p[5]=E,p[6]=R,p[7]=B,p[8]=L,p[9]=F,p[10]=H,p[11]=$,p[12]=C*x+P*_+L*A+y[12],p[13]=T*x+E*_+F*A+y[13],p[14]=I*x+R*_+H*A+y[14],p[15]=M*x+B*_+$*A+y[15]),p},n.fromTranslation=function(p,y){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=y[0],p[13]=y[1],p[14]=y[2],p[15]=1,p},n.setTranslation=function(p,y){return p[12]=y[0],p[13]=y[1],p[14]=y[2],p},n.setAxes=function(p,y,w,x){return p[0]=w[0],p[4]=w[1],p[8]=w[2],p[1]=x[0],p[5]=x[1],p[9]=x[2],p[2]=y[0],p[6]=y[1],p[10]=y[2],p},n.rotate=function(p,y,w,x){let _=x[0],A=x[1],C=x[2],T=Math.sqrt(_*_+A*A+C*C);if(Math.abs(T)<Un)return t();T=1/T,_*=T,A*=T,C*=T;const I=Math.sin(w),M=Math.cos(w),P=1-M,E=y[0],R=y[1],B=y[2],L=y[3],F=y[4],H=y[5],$=y[6],O=y[7],k=y[8],X=y[9],ie=y[10],ne=y[11],Q=_*_*P+M,ce=A*_*P+C*I,Z=C*_*P-A*I,re=_*A*P-C*I,se=A*A*P+M,fe=C*A*P+_*I,ue=_*C*P+A*I,U=A*C*P-_*I,K=C*C*P+M;return p[0]=E*Q+F*ce+k*Z,p[1]=R*Q+H*ce+X*Z,p[2]=B*Q+$*ce+ie*Z,p[3]=L*Q+O*ce+ne*Z,p[4]=E*re+F*se+k*fe,p[5]=R*re+H*se+X*fe,p[6]=B*re+$*se+ie*fe,p[7]=L*re+O*se+ne*fe,p[8]=E*ue+F*U+k*K,p[9]=R*ue+H*U+X*K,p[10]=B*ue+$*U+ie*K,p[11]=L*ue+O*U+ne*K,y!==p&&(p[12]=y[12],p[13]=y[13],p[14]=y[14],p[15]=y[15]),p},n.fromRotation=h,n.scale=function(p,y,w){const x=w[0],_=w[1],A=w[2];return p[0]=y[0]*x,p[1]=y[1]*x,p[2]=y[2]*x,p[3]=y[3]*x,p[4]=y[4]*_,p[5]=y[5]*_,p[6]=y[6]*_,p[7]=y[7]*_,p[8]=y[8]*A,p[9]=y[9]*A,p[10]=y[10]*A,p[11]=y[11]*A,p[12]=y[12],p[13]=y[13],p[14]=y[14],p[15]=y[15],p},n.scaleUniformly=function(p,y,w){return p[0]=y[0]*w,p[1]=y[1]*w,p[2]=y[2]*w,p[3]=y[3]*w,p[4]=y[4]*w,p[5]=y[5]*w,p[6]=y[6]*w,p[7]=y[7]*w,p[8]=y[8]*w,p[9]=y[9]*w,p[10]=y[10]*w,p[11]=y[11]*w,p[12]=y[12],p[13]=y[13],p[14]=y[14],p[15]=y[15],p},n.fromScaling=function(p,y){return p[0]=y[0],p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=y[1],p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=y[2],p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},n.fromUniformScaling=function(p,y){return p[0]=y,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=y,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=y,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},n.fromMat3=function(p,y){return p[0]=y[0],p[1]=y[1],p[2]=y[2],p[4]=y[3],p[5]=y[4],p[6]=y[5],p[8]=y[6],p[9]=y[7],p[10]=y[8],p},n.compose=function(p,y,w,x){const[_,A,C,T]=w,I=_+_,M=A+A,P=C+C,E=_*I,R=_*M,B=_*P,L=A*M,F=A*P,H=C*P,$=T*I,O=T*M,k=T*P,[X,ie,ne]=x;return p[0]=(1-(L+H))*X,p[1]=(R+k)*X,p[2]=(B-O)*X,p[3]=0,p[4]=(R-k)*ie,p[5]=(1-(E+H))*ie,p[6]=(F+$)*ie,p[7]=0,p[8]=(B+O)*ne,p[9]=(F-$)*ne,p[10]=(1-(E+L))*ne,p[11]=0,p[12]=y[0],p[13]=y[1],p[14]=y[2],p[15]=1,p};const m=[0,0,0],f=e();function v(p){const y=p[0],w=p[1],x=p[2],_=p[3],A=p[4],C=p[5],T=p[6],I=p[7],M=p[8],P=p[9],E=p[10],R=p[11],B=p[12],L=p[13],F=p[14],H=p[15];return(y*C-w*A)*(E*H-R*F)-(y*T-x*A)*(P*H-R*L)+(y*I-_*A)*(P*F-E*L)+(w*T-x*C)*(M*H-R*B)-(w*I-_*C)*(M*F-E*B)+(x*I-_*T)*(M*L-P*B)}n.decompose=function(p,y,w,x){let _=on.magnitude(on.set(m,p[0],p[1],p[2]));const A=on.magnitude(on.set(m,p[4],p[5],p[6])),C=on.magnitude(on.set(m,p[8],p[9],p[10]));v(p)<0&&(_=-_),y[0]=p[12],y[1]=p[13],y[2]=p[14],l(f,p);const T=1/_,I=1/A,M=1/C;return f[0]*=T,f[1]*=T,f[2]*=T,f[4]*=I,f[5]*=I,f[6]*=I,f[8]*=M,f[9]*=M,f[10]*=M,c(w,f),x[0]=_,x[1]=A,x[2]=C,p},n.makeTable=function(p){let y="";for(let w=0;w<4;w++){for(let x=0;x<4;x++)y+=p[4*x+w].toString(),x<3&&(y+=" ");w<3&&(y+=`
`)}return y},n.determinant=v,n.isRotationAndTranslation=function(p,y){return function(w,x){const _=w[0],A=w[1],C=w[2],T=w[3],I=w[4],M=w[5],P=w[6],E=w[7],R=w[8],B=w[9],L=w[10],F=w[11],H=w[15];return!(!(dr(H,1,x)&&dr(T,0,x)&&dr(E,0,x)&&dr(F,0,x))||!dr(Math.abs(_*(M*L-P*B)-A*(I*L-P*R)+C*(I*B-M*R)),1,x))}(p,y!==void 0?y:Un)},n.isTranslationAndUniformScaling=function(p,y){return function(w,x){const _=w[0];return dr(w[1],0,x)&&dr(w[2],0,x)&&dr(w[3],0,x)&&dr(w[4],0,x)&&dr(w[5],_,x)&&dr(w[6],0,x)&&dr(w[7],0,x)&&dr(w[8],0,x)&&dr(w[9],0,x)&&dr(w[10],_,x)&&dr(w[11],0,x)&&dr(w[15],1,x)}(p,y!==void 0?y:Un)},n.fromQuat=function(p,y){const w=y[0],x=y[1],_=y[2],A=y[3],C=w+w,T=x+x,I=_+_,M=w*C,P=x*C,E=x*T,R=_*C,B=_*T,L=_*I,F=A*C,H=A*T,$=A*I;return p[0]=1-E-L,p[1]=P+$,p[2]=R-H,p[3]=0,p[4]=P-$,p[5]=1-M-L,p[6]=B+F,p[7]=0,p[8]=R+H,p[9]=B-F,p[10]=1-M-E,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},n.fromEuler=function(p,y,w){const x=y[0],_=y[1],A=y[2],C=Math.cos(x),T=Math.sin(x),I=Math.cos(_),M=Math.sin(_),P=Math.cos(A),E=Math.sin(A);if(w==="XYZ"){const R=C*P,B=C*E,L=T*P,F=T*E;p[0]=I*P,p[4]=-I*E,p[8]=M,p[1]=B+L*M,p[5]=R-F*M,p[9]=-T*I,p[2]=F-R*M,p[6]=L+B*M,p[10]=C*I}else if(w==="YXZ"){const R=I*P,B=I*E,L=M*P,F=M*E;p[0]=R+F*T,p[4]=L*T-B,p[8]=C*M,p[1]=C*E,p[5]=C*P,p[9]=-T,p[2]=B*T-L,p[6]=F+R*T,p[10]=C*I}else if(w==="ZXY"){const R=I*P,B=I*E,L=M*P,F=M*E;p[0]=R-F*T,p[4]=-C*E,p[8]=L+B*T,p[1]=B+L*T,p[5]=C*P,p[9]=F-R*T,p[2]=-C*M,p[6]=T,p[10]=C*I}else if(w==="ZYX"){const R=C*P,B=C*E,L=T*P,F=T*E;p[0]=I*P,p[4]=L*M-B,p[8]=R*M+F,p[1]=I*E,p[5]=F*M+R,p[9]=B*M-L,p[2]=-M,p[6]=T*I,p[10]=C*I}else if(w==="YZX"){const R=C*I,B=C*M,L=T*I,F=T*M;p[0]=I*P,p[4]=F-R*E,p[8]=L*E+B,p[1]=E,p[5]=C*P,p[9]=-T*P,p[2]=-M*P,p[6]=B*E+L,p[10]=R-F*E}else if(w==="XZY"){const R=C*I,B=C*M,L=T*I,F=T*M;p[0]=I*P,p[4]=-E,p[8]=M*P,p[1]=R*E+F,p[5]=C*P,p[9]=B*E-L,p[2]=L*E-B,p[6]=T*P,p[10]=F*E+R}return p[3]=0,p[7]=0,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},n.perspective=function(p,y,w,x,_,A,C){const T=2*A/(w-y),I=2*A/(x-_),M=(w+y)/(w-y),P=(x+_)/(x-_),E=-(C+A)/(C-A),R=-2*C*A/(C-A);return p[0]=T,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=I,p[6]=0,p[7]=0,p[8]=M,p[9]=P,p[10]=E,p[11]=-1,p[12]=0,p[13]=0,p[14]=R,p[15]=0,p},n.ortho=function(p,y,w,x,_,A,C){const T=1/(w-y),I=1/(x-_),M=1/(C-A),P=(w+y)*T,E=(x+_)*I,R=(C+A)*M;return p[0]=2*T,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=2*I,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=-2*M,p[11]=0,p[12]=-P,p[13]=-E,p[14]=-R,p[15]=1,p},n.lookAt=function(p,y,w,x){let _,A,C,T,I,M,P,E,R,B;const L=y[0],F=y[1],H=y[2],$=x[0],O=x[1],k=x[2],X=w[0],ie=w[1],ne=w[2];return Math.abs(L-X)<Un&&Math.abs(F-ie)<Un&&Math.abs(H-ne)<Un?r(p):(P=L-X,E=F-ie,R=H-ne,B=1/Math.sqrt(P*P+E*E+R*R),P*=B,E*=B,R*=B,_=O*R-k*E,A=k*P-$*R,C=$*E-O*P,B=Math.sqrt(_*_+A*A+C*C),B?(B=1/B,_*=B,A*=B,C*=B):(_=0,A=0,C=0),T=E*C-R*A,I=R*_-P*C,M=P*A-E*_,B=Math.sqrt(T*T+I*I+M*M),B?(B=1/B,T*=B,I*=B,M*=B):(T=0,I=0,M=0),p[0]=_,p[1]=T,p[2]=P,p[3]=0,p[4]=A,p[5]=I,p[6]=E,p[7]=0,p[8]=C,p[9]=M,p[10]=R,p[11]=0,p[12]=-(_*L+A*F+C*H),p[13]=-(T*L+I*F+M*H),p[14]=-(P*L+E*F+R*H),p[15]=1,p)},n.targetTo=function(p,y,w,x){const _=y[0],A=y[1],C=y[2],T=x[0],I=x[1],M=x[2];let P=_-w[0],E=A-w[1],R=C-w[2],B=P*P+E*E+R*R;B>0&&(B=1/Math.sqrt(B),P*=B,E*=B,R*=B);let L=I*R-M*E,F=M*P-T*R,H=T*E-I*P;return B=L*L+F*F+H*H,B>0&&(B=1/Math.sqrt(B),L*=B,F*=B,H*=B),p[0]=L,p[1]=F,p[2]=H,p[3]=0,p[4]=E*H-R*F,p[5]=R*L-P*H,p[6]=P*F-E*L,p[7]=0,p[8]=P,p[9]=E,p[10]=R,p[11]=0,p[12]=_,p[13]=A,p[14]=C,p[15]=1,p},n.fromPermutation=function(p,y){i(p);for(let w=0;w<4;w++)a(p,w,y[w],1);return p},n.getMaxScaleOnAxis=function(p){const y=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],w=p[4]*p[4]+p[5]*p[5]+p[6]*p[6],x=p[8]*p[8]+p[9]*p[9]+p[10]*p[10];return Math.sqrt(Math.max(y,w,x))};const g=[1,0,0],b=[0,1,0],S=[0,0,1];n.rotX90=h(e(),Aa(90),g),n.rotX180=h(e(),Aa(180),g),n.rotY90=h(e(),Aa(90),b),n.rotY180=h(e(),Aa(180),b),n.rotY270=h(e(),Aa(270),b),n.rotZ90=h(e(),Aa(90),S),n.rotZ180=h(e(),Aa(180),S),n.rotXY90=d(e(),n.rotX90,n.rotY90),n.rotZY90=d(e(),n.rotZ90,n.rotY90),n.rotZYZ90=d(e(),n.rotZY90,n.rotZ90),n.rotZ90X180=d(e(),n.rotZ90,n.rotX180),n.rotY90Z180=d(e(),n.rotY90,n.rotZ180),n.id=t()})(ks||(ks={})),function(n){function e(){const x=[.1,0,0,0,0,0,0,0,0];return x[0]=0,x}function t(){const x=e();return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=1,x[5]=0,x[6]=0,x[7]=0,x[8]=1,x}function r(x,_){return x[0]=_[0],x[1]=_[1],x[2]=_[2],x[3]=_[4],x[4]=_[5],x[5]=_[6],x[6]=_[8],x[7]=_[9],x[8]=_[10],x}n.zero=e,n.identity=t,n.setIdentity=function(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=1,x[5]=0,x[6]=0,x[7]=0,x[8]=1,x},n.toArray=function(x,_,A){return _[A+0]=x[0],_[A+1]=x[1],_[A+2]=x[2],_[A+3]=x[3],_[A+4]=x[4],_[A+5]=x[5],_[A+6]=x[6],_[A+7]=x[7],_[A+8]=x[8],_},n.fromArray=function(x,_,A){return x[0]=_[A+0],x[1]=_[A+1],x[2]=_[A+2],x[3]=_[A+3],x[4]=_[A+4],x[5]=_[A+5],x[6]=_[A+6],x[7]=_[A+7],x[8]=_[A+8],x},n.fromColumns=function(x,_,A,C){return x[0]=_[0],x[1]=_[1],x[2]=_[2],x[3]=A[0],x[4]=A[1],x[5]=A[2],x[6]=C[0],x[7]=C[1],x[8]=C[2],x},n.fromMat4=r;const i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];n.fromEuler=function(x,_,A){return ks.fromEuler(i,_,A),r(x,i)},n.create=function(x,_,A,C,T,I,M,P,E){const R=e();return R[0]=x,R[1]=_,R[2]=A,R[3]=C,R[4]=T,R[5]=I,R[6]=M,R[7]=P,R[8]=E,R};const o=t();function s(x,_,A){for(let C=0;C<9;C++)if(Math.abs(x[C]-_[C])>A)return!1;return!0}function a(x,_){return x[0]=_[0],x[1]=_[1],x[2]=_[2],x[3]=_[3],x[4]=_[4],x[5]=_[5],x[6]=_[6],x[7]=_[7],x[8]=_[8],x}function l(x,_){if(x===_){const A=_[1],C=_[2],T=_[5];x[1]=_[3],x[2]=_[6],x[3]=A,x[5]=_[7],x[6]=C,x[7]=T}else x[0]=_[0],x[1]=_[3],x[2]=_[6],x[3]=_[1],x[4]=_[4],x[5]=_[7],x[6]=_[2],x[7]=_[5],x[8]=_[8];return x}function c(x,_){const A=_[0],C=_[1],T=_[2],I=_[3],M=_[4],P=_[5],E=_[6],R=_[7],B=_[8],L=B*M-P*R,F=-B*I+P*E,H=R*I-M*E;let $=A*L+C*F+T*H;return $?($=1/$,x[0]=L*$,x[1]=(-B*C+T*R)*$,x[2]=(P*C-T*M)*$,x[3]=F*$,x[4]=(B*A-T*E)*$,x[5]=(-P*A+T*I)*$,x[6]=H*$,x[7]=(-R*A+C*E)*$,x[8]=(M*A-C*I)*$,x):(console.warn("non-invertible matrix.",_),x)}function u(x){const _=x[0],A=x[1],C=x[2],T=x[3],I=x[4],M=x[5],P=x[6],E=x[7],R=x[8];return _*(R*I-M*E)+A*(-R*T+M*P)+C*(E*T-I*P)}function d(x){return x[0]+x[4]+x[8]}function h(x,_,A){return x[0]=_[0]-A[0],x[1]=_[1]-A[1],x[2]=_[2]-A[2],x[3]=_[3]-A[3],x[4]=_[4]-A[4],x[5]=_[5]-A[5],x[6]=_[6]-A[6],x[7]=_[7]-A[7],x[8]=_[8]-A[8],x}function m(x,_,A){return x[0]=_[0]*A,x[1]=_[1]*A,x[2]=_[2]*A,x[3]=_[3]*A,x[4]=_[4]*A,x[5]=_[5]*A,x[6]=_[6]*A,x[7]=_[7]*A,x[8]=_[8]*A,x}n.isIdentity=function(x,_){return s(x,o,_===void 0?Un:_)},n.hasNaN=function(x){for(let _=0;_<9;_++)if(isNaN(x[_]))return!0;return!1},n.clone=function(x){return a(e(),x)},n.areEqual=s,n.setValue=function(x,_,A,C){x[3*A+_]=C},n.getValue=function(x,_,A){return x[3*A+_]},n.copy=a,n.transpose=l,n.invert=c,n.symmtricFromUpper=function(x,_){return x===_?(x[3]=_[1],x[6]=_[2],x[7]=_[5]):(x[0]=_[0],x[1]=_[1],x[2]=_[2],x[3]=_[1],x[4]=_[4],x[5]=_[5],x[6]=_[2],x[7]=_[5],x[8]=_[8]),x},n.symmtricFromLower=function(x,_){return x===_?(x[1]=_[3],x[2]=_[6],x[5]=_[7]):(x[0]=_[0],x[1]=_[3],x[2]=_[6],x[3]=_[3],x[4]=_[4],x[5]=_[7],x[6]=_[6],x[7]=_[7],x[8]=_[8]),x},n.determinant=u,n.trace=d,n.sub=h,n.add=function(x,_,A){return x[0]=_[0]+A[0],x[1]=_[1]+A[1],x[2]=_[2]+A[2],x[3]=_[3]+A[3],x[4]=_[4]+A[4],x[5]=_[5]+A[5],x[6]=_[6]+A[6],x[7]=_[7]+A[7],x[8]=_[8]+A[8],x},n.mul=function(x,_,A){const C=_[0],T=_[1],I=_[2],M=_[3],P=_[4],E=_[5],R=_[6],B=_[7],L=_[8],F=A[0],H=A[1],$=A[2],O=A[3],k=A[4],X=A[5],ie=A[6],ne=A[7],Q=A[8];return x[0]=F*C+H*M+$*R,x[1]=F*T+H*P+$*B,x[2]=F*I+H*E+$*L,x[3]=O*C+k*M+X*R,x[4]=O*T+k*P+X*B,x[5]=O*I+k*E+X*L,x[6]=ie*C+ne*M+Q*R,x[7]=ie*T+ne*P+Q*B,x[8]=ie*I+ne*E+Q*L,x},n.subScalar=function(x,_,A){return x[0]=_[0]-A,x[1]=_[1]-A,x[2]=_[2]-A,x[3]=_[3]-A,x[4]=_[4]-A,x[5]=_[5]-A,x[6]=_[6]-A,x[7]=_[7]-A,x[8]=_[8]-A,x},n.addScalar=function(x,_,A){return x[0]=_[0]+A,x[1]=_[1]+A,x[2]=_[2]+A,x[3]=_[3]+A,x[4]=_[4]+A,x[5]=_[5]+A,x[6]=_[6]+A,x[7]=_[7]+A,x[8]=_[8]+A,x},n.mulScalar=m;const f=Math.PI/3,v=e();n.symmetricEigenvalues=function(x,_){const A=_[1]*_[1]+_[2]*_[2]+_[5]*_[5];if(A===0)x[0]=_[0],x[1]=_[4],x[2]=_[8];else{const C=d(_)/3,T=_[0]-C,I=_[4]-C,M=_[8]-C,P=T*T+I*I+M*M+2*A,E=Math.sqrt(P/6);m(v,n.Identity,C),h(v,_,v),m(v,v,1/E);const R=u(v)/2,B=R<=-1?f:R>=1?0:Math.acos(R)/3;x[0]=C+2*E*Math.cos(B),x[2]=C+2*E*Math.cos(B+2*f),x[1]=3*C-x[0]-x[2]}return x};const g=[.1,0,0],b=[.1,0,0],S=[.1,0,0],p=[.1,0,0],y=[.1,0,0],w=[.1,0,0];n.eigenvector=function(x,_,A){on.set(g,_[0]-A,_[1],_[2]),on.set(b,_[1],_[4]-A,_[5]),on.set(S,_[2],_[5],_[8]-A),on.cross(p,g,b),on.cross(y,g,S),on.cross(w,b,S);const C=on.dot(p,p),T=on.dot(y,y),I=on.dot(w,w);let M=C,P=0;return T>M&&(M=T,P=1),I>M&&(P=2),P===0?on.scale(x,p,1/Math.sqrt(C)):P===1?on.scale(x,y,1/Math.sqrt(T)):on.scale(x,w,1/Math.sqrt(I)),x},n.directionTransform=function(x,_){return r(x,_),c(x,x),l(x,x),x},n.Identity=t(),n.innerProduct=function(x,_){return x[0]*_[0]+x[1]*_[1]+x[2]*_[2]+x[3]*_[3]+x[4]*_[4]+x[5]*_[5]+x[6]*_[6]+x[7]*_[7]+x[8]*_[8]}}(Nf||(Nf={})),function(n){function e(){const t=[.1,0];return t[0]=0,t}n.zero=e,n.clone=function(t){const r=e();return r[0]=t[0],r[1]=t[1],r},n.create=function(t,r){const i=e();return i[0]=t,i[1]=r,i},n.hasNaN=function(t){return isNaN(t[0])||isNaN(t[1])},n.toArray=function(t,r,i){return r[i+0]=t[0],r[i+1]=t[1],r},n.fromArray=function(t,r,i){return t[0]=r[i+0],t[1]=r[i+1],t},n.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t},n.set=function(t,r,i){return t[0]=r,t[1]=i,t},n.add=function(t,r,i){return t[0]=r[0]+i[0],t[1]=r[1]+i[1],t},n.sub=function(t,r,i){return t[0]=r[0]-i[0],t[1]=r[1]-i[1],t},n.mul=function(t,r,i){return t[0]=r[0]*i[0],t[1]=r[1]*i[1],t},n.div=function(t,r,i){return t[0]=r[0]/i[0],t[1]=r[1]/i[1],t},n.scale=function(t,r,i){return t[0]=r[0]*i,t[1]=r[1]*i,t},n.round=function(t,r){return t[0]=Math.round(r[0]),t[1]=Math.round(r[1]),t},n.ceil=function(t,r){return t[0]=Math.ceil(r[0]),t[1]=Math.ceil(r[1]),t},n.floor=function(t,r){return t[0]=Math.floor(r[0]),t[1]=Math.floor(r[1]),t},n.distance=function(t,r){const i=r[0]-t[0],o=r[1]-t[1];return Math.sqrt(i*i+o*o)},n.squaredDistance=function(t,r){const i=r[0]-t[0],o=r[1]-t[1];return i*i+o*o},n.magnitude=function(t){const r=t[0],i=t[1];return Math.sqrt(r*r+i*i)},n.squaredMagnitude=function(t){const r=t[0],i=t[1];return r*r+i*i},n.inverse=function(t,r){return t[0]=1/r[0],t[1]=1/r[1],t},n.areEqual=function(t,r){return t[0]===r[0]&&t[1]===r[1]},n.toString=function(t,r){return`[${t[0].toPrecision(r)} ${t[1].toPrecision(r)}}]`}}(_v||(_v={})),function(n){function e(){const r=[.1,0,0,0];return r[0]=0,r}function t(r,i){return r[0]=i.center[0],r[1]=i.center[1],r[2]=i.center[2],r[3]=i.radius,r}n.zero=e,n.clone=function(r){const i=e();return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i},n.create=function(r,i,o,s){const a=e();return a[0]=r,a[1]=i,a[2]=o,a[3]=s,a},n.fromSphere=t,n.ofSphere=function(r){return t(e(),r)},n.hasNaN=function(r){return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])||isNaN(r[3])},n.toArray=function(r,i,o){return i[o+0]=r[0],i[o+1]=r[1],i[o+2]=r[2],i[o+3]=r[3],i},n.fromArray=function(r,i,o){return r[0]=i[o+0],r[1]=i[o+1],r[2]=i[o+2],r[3]=i[o+3],r},n.toVec3Array=function(r,i,o){i[o+0]=r[0],i[o+1]=r[1],i[o+2]=r[2]},n.fromVec3Array=function(r,i,o){return r[0]=i[o+0],r[1]=i[o+1],r[2]=i[o+2],r[3]=0,r},n.copy=function(r,i){return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r},n.set=function(r,i,o,s,a){return r[0]=i,r[1]=o,r[2]=s,r[3]=a,r},n.add=function(r,i,o){return r[0]=i[0]+o[0],r[1]=i[1]+o[1],r[2]=i[2]+o[2],r[3]=i[3]+o[3],r},n.distance=function(r,i){const o=i[0]-r[0],s=i[1]-r[1],a=i[2]-r[2],l=i[3]-r[3];return Math.sqrt(o*o+s*s+a*a+l*l)},n.scale=function(r,i,o){return r[0]=i[0]*o,r[1]=i[1]*o,r[2]=i[2]*o,r[4]=i[4]*o,r},n.round=function(r,i){return r[0]=Math.round(i[0]),r[1]=Math.round(i[1]),r[2]=Math.round(i[2]),r[3]=Math.round(i[3]),r},n.ceil=function(r,i){return r[0]=Math.ceil(i[0]),r[1]=Math.ceil(i[1]),r[2]=Math.ceil(i[2]),r[3]=Math.ceil(i[3]),r},n.floor=function(r,i){return r[0]=Math.floor(i[0]),r[1]=Math.floor(i[1]),r[2]=Math.floor(i[2]),r[3]=Math.floor(i[3]),r},n.squaredDistance=function(r,i){const o=i[0]-r[0],s=i[1]-r[1],a=i[2]-r[2],l=i[3]-r[3];return o*o+s*s+a*a+l*l},n.norm=function(r){const i=r[0],o=r[1],s=r[2],a=r[3];return Math.sqrt(i*i+o*o+s*s+a*a)},n.squaredNorm=function(r){const i=r[0],o=r[1],s=r[2],a=r[3];return i*i+o*o+s*s+a*a},n.transformMat4=function(r,i,o){const s=i[0],a=i[1],l=i[2],c=i[3];return r[0]=o[0]*s+o[4]*a+o[8]*l+o[12]*c,r[1]=o[1]*s+o[5]*a+o[9]*l+o[13]*c,r[2]=o[2]*s+o[6]*a+o[10]*l+o[14]*c,r[3]=o[3]*s+o[7]*a+o[11]*l+o[15]*c,r},n.dot=function(r,i){return r[0]*i[0]+r[1]*i[1]+r[2]*i[2]+r[3]*i[3]},n.inverse=function(r,i){return r[0]=1/i[0],r[1]=1/i[1],r[2]=1/i[2],r[3]=1/i[3],r},n.exactEquals=function(r,i){return r[0]===i[0]&&r[1]===i[1]&&r[2]===i[2]&&r[3]===i[3]},n.equals=function(r,i){const o=r[0],s=r[1],a=r[2],l=r[3],c=i[0],u=i[1],d=i[2],h=i[3];return Math.abs(o-c)<=Un*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(s-u)<=Un*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(a-d)<=Un*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(l-h)<=Un*Math.max(1,Math.abs(l),Math.abs(h))},n.toString=function(r,i){return`[${r[0].toPrecision(i)} ${r[1].toPrecision(i)} ${r[2].toPrecision(i)}  ${r[3].toPrecision(i)}]`}}(xv||(xv={})),function(n){function e(){const f=[.1,0,0,0];return f[0]=0,f}function t(){const f=e();return f[3]=1,f}function r(f,v,g){g*=.5;const b=Math.sin(g);return f[0]=b*v[0],f[1]=b*v[1],f[2]=b*v[2],f[3]=Math.cos(g),f}function i(f,v,g,b){const S=v[0],p=v[1],y=v[2],w=v[3];let x,_,A,C,T,I=g[0],M=g[1],P=g[2],E=g[3];return _=S*I+p*M+y*P+w*E,_<0&&(_=-_,I=-I,M=-M,P=-P,E=-E),1-_>1e-6?(x=Math.acos(_),A=Math.sin(x),C=Math.sin((1-b)*x)/A,T=Math.sin(b*x)/A):(C=1-b,T=b),f[0]=C*S+T*I,f[1]=C*p+T*M,f[2]=C*y+T*P,f[3]=C*w+T*E,f}function o(f,v){const g=v[0]+v[4]+v[8];let b;if(g>0)b=Math.sqrt(g+1),f[3]=.5*b,b=.5/b,f[0]=(v[5]-v[7])*b,f[1]=(v[6]-v[2])*b,f[2]=(v[1]-v[3])*b;else{let S=0;v[4]>v[0]&&(S=1),v[8]>v[3*S+S]&&(S=2);const p=(S+1)%3,y=(S+2)%3;b=Math.sqrt(v[3*S+S]-v[3*p+p]-v[3*y+y]+1),f[S]=.5*b,b=.5/b,f[3]=(v[3*p+y]-v[3*y+p])*b,f[p]=(v[3*p+S]+v[3*S+p])*b,f[y]=(v[3*y+S]+v[3*S+y])*b}return f}n.zero=e,n.identity=t,n.setIdentity=function(f){f[0]=0,f[1]=0,f[2]=0,f[3]=1},n.hasNaN=function(f){return isNaN(f[0])||isNaN(f[1])||isNaN(f[2])||isNaN(f[3])},n.create=function(f,v,g,b){const S=t();return S[0]=f,S[1]=v,S[2]=g,S[3]=b,S},n.setAxisAngle=r,n.getAxisAngle=function(f,v){const g=2*Math.acos(v[3]),b=Math.sin(g/2);return b!==0?(f[0]=v[0]/b,f[1]=v[1]/b,f[2]=v[2]/b):(f[0]=1,f[1]=0,f[2]=0),g},n.multiply=function(f,v,g){const b=v[0],S=v[1],p=v[2],y=v[3],w=g[0],x=g[1],_=g[2],A=g[3];return f[0]=b*A+y*w+S*_-p*x,f[1]=S*A+y*x+p*w-b*_,f[2]=p*A+y*_+b*x-S*w,f[3]=y*A-b*w-S*x-p*_,f},n.rotateX=function(f,v,g){g*=.5;const b=v[0],S=v[1],p=v[2],y=v[3],w=Math.sin(g),x=Math.cos(g);return f[0]=b*x+y*w,f[1]=S*x+p*w,f[2]=p*x-S*w,f[3]=y*x-b*w,f},n.rotateY=function(f,v,g){g*=.5;const b=v[0],S=v[1],p=v[2],y=v[3],w=Math.sin(g),x=Math.cos(g);return f[0]=b*x-p*w,f[1]=S*x+y*w,f[2]=p*x+b*w,f[3]=y*x-S*w,f},n.rotateZ=function(f,v,g){g*=.5;const b=v[0],S=v[1],p=v[2],y=v[3],w=Math.sin(g),x=Math.cos(g);return f[0]=b*x+S*w,f[1]=S*x-b*w,f[2]=p*x+y*w,f[3]=y*x-p*w,f},n.calculateW=function(f,v){const g=v[0],b=v[1],S=v[2];return f[0]=g,f[1]=b,f[2]=S,f[3]=Math.sqrt(Math.abs(1-g*g-b*b-S*S)),f},n.slerp=i,n.invert=function(f,v){const g=v[0],b=v[1],S=v[2],p=v[3],y=g*g+b*b+S*S+p*p,w=y?1/y:0;return f[0]=-g*w,f[1]=-b*w,f[2]=-S*w,f[3]=p*w,f},n.conjugate=function(f,v){return f[0]=-v[0],f[1]=-v[1],f[2]=-v[2],f[3]=v[3],f},n.dot=function(f,v){return f[0]*v[0]+f[1]*v[1]+f[2]*v[2]+f[3]*v[3]},n.fromMat3=o,n.fromEuler=function(f,v,g){const[b,S,p]=v,y=Math.cos(b/2),w=Math.cos(S/2),x=Math.cos(p/2),_=Math.sin(b/2),A=Math.sin(S/2),C=Math.sin(p/2);switch(g){case"XYZ":f[0]=_*w*x+y*A*C,f[1]=y*A*x-_*w*C,f[2]=y*w*C+_*A*x,f[3]=y*w*x-_*A*C;break;case"YXZ":f[0]=_*w*x+y*A*C,f[1]=y*A*x-_*w*C,f[2]=y*w*C-_*A*x,f[3]=y*w*x+_*A*C;break;case"ZXY":f[0]=_*w*x-y*A*C,f[1]=y*A*x+_*w*C,f[2]=y*w*C+_*A*x,f[3]=y*w*x-_*A*C;break;case"ZYX":f[0]=_*w*x-y*A*C,f[1]=y*A*x+_*w*C,f[2]=y*w*C-_*A*x,f[3]=y*w*x+_*A*C;break;case"YZX":f[0]=_*w*x+y*A*C,f[1]=y*A*x+_*w*C,f[2]=y*w*C-_*A*x,f[3]=y*w*x-_*A*C;break;case"XZY":f[0]=_*w*x-y*A*C,f[1]=y*A*x-_*w*C,f[2]=y*w*C+_*A*x,f[3]=y*w*x+_*A*C;break;default:Ap()}return f};const s=[0,0,0];function a(f,v){const g=v[0],b=v[1],S=v[2],p=v[3];let y=g*g+b*b+S*S+p*p;return y>0&&(y=1/Math.sqrt(y),f[0]=g*y,f[1]=b*y,f[2]=S*y,f[3]=p*y),f}n.fromUnitVec3=function(f,v,g){let b=on.dot(v,g)+1;return b<Un?(b=0,Math.abs(v[0])>Math.abs(v[2])?on.set(s,-v[1],v[0],0):on.set(s,0,-v[2],v[1])):on.cross(s,v,g),f[0]=s[0],f[1]=s[1],f[2]=s[2],f[3]=b,a(f,f),f},n.clone=function(f){const v=e();return v[0]=f[0],v[1]=f[1],v[2]=f[2],v[3]=f[3],v},n.toArray=function(f,v,g){return v[g+0]=f[0],v[g+1]=f[1],v[g+2]=f[2],v[g+3]=f[3],v},n.fromArray=function(f,v,g){return f[0]=v[g+0],f[1]=v[g+1],f[2]=v[g+2],f[3]=v[g+3],f},n.copy=function(f,v){return f[0]=v[0],f[1]=v[1],f[2]=v[2],f[3]=v[3],f},n.set=function(f,v,g,b,S){return f[0]=v,f[1]=g,f[2]=b,f[3]=S,f},n.exactEquals=function(f,v){return f[0]===v[0]&&f[1]===v[1]&&f[2]===v[2]&&f[3]===v[3]},n.equals=function(f,v){const g=f[0],b=f[1],S=f[2],p=f[3],y=v[0],w=v[1],x=v[2],_=v[3];return Math.abs(g-y)<=Un*Math.max(1,Math.abs(g),Math.abs(y))&&Math.abs(b-w)<=Un*Math.max(1,Math.abs(b),Math.abs(w))&&Math.abs(S-x)<=Un*Math.max(1,Math.abs(S),Math.abs(x))&&Math.abs(p-_)<=Un*Math.max(1,Math.abs(p),Math.abs(_))},n.add=function(f,v,g){return f[0]=v[0]+g[0],f[1]=v[1]+g[1],f[2]=v[2]+g[2],f[3]=v[3]+g[3],f},n.normalize=a;const l=[0,0,0],c=[1,0,0],u=[0,1,0];n.rotationTo=function(f,v,g){const b=on.dot(v,g);return b<-.999999?(on.cross(l,c,v),on.magnitude(l)<1e-6&&on.cross(l,u,v),on.normalize(l,l),r(f,l,Math.PI),f):b>.999999?(f[0]=0,f[1]=0,f[2]=0,f[3]=1,f):(on.cross(l,v,g),f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=1+b,a(f,f))};const d=e(),h=e();n.sqlerp=function(f,v,g,b,S,p){return i(d,v,S,p),i(h,g,b,p),i(f,d,h,2*p*(1-p)),f};const m=[0,0,0,0,0,0,0,0,0];n.setAxes=function(f,v,g,b){return m[0]=g[0],m[3]=g[1],m[6]=g[2],m[1]=b[0],m[4]=b[1],m[7]=b[2],m[2]=-v[0],m[5]=-v[1],m[8]=-v[2],a(f,o(f,m))},n.toString=function(f,v){return`[${f[0].toPrecision(v)} ${f[1].toPrecision(v)} ${f[2].toPrecision(v)}  ${f[3].toPrecision(v)}]`},n.Identity=t()}(wv||(wv={})),function(n){function e(s,a,l){const c=function(v,g,b){const S=[];for(let y=0;y<g.length;y++)S[y]=g[g.length-y-1];const p=[1];for(let y=1;y<v.length;y++)p[y]=v[S[y-1]];return{dimensions:v,axisOrderFastToSlow:S,axisOrderSlowToFast:g,accessDimensions:p,defaultCtor:b||Float64Array}}(s,a,l),{get:u,set:d,add:h,dataOffset:m,getCoords:f}=t(c);return{rank:s.length,dimensions:s,axisOrderSlowToFast:a,create:r(c),get:u,set:d,add:h,dataOffset:m,getCoords:f}}function t(s){const{dimensions:a,axisOrderFastToSlow:l}=s;switch(a.length){case 1:return{get:(c,u)=>c[u],set:(c,u,d)=>c[u]=d,add:(c,u,d)=>c[u]+=d,dataOffset:c=>c,getCoords:(c,u)=>(u[0]=c,u)};case 2:if(l[0]===0&&l[1]===1){const c=a[0];return{get:(u,d,h)=>u[h*c+d],set:(u,d,h,m)=>u[h*c+d]=m,add:(u,d,h,m)=>u[h*c+d]+=m,dataOffset:(u,d)=>d*c+u,getCoords:(u,d)=>(d[0]=u%c,d[1]=Math.floor(u/c),d)}}if(l[0]===1&&l[1]===0){const c=a[1];return{get:(u,d,h)=>u[d*c+h],set:(u,d,h,m)=>u[d*c+h]=m,add:(u,d,h,m)=>u[d*c+h]+=m,dataOffset:(u,d)=>u*c+d,getCoords:(u,d)=>(d[0]=Math.floor(u/c),d[1]=u%c,d)}}throw new Error("bad axis order");case 3:if(l[0]===0&&l[1]===1&&l[2]===2){const c=a[0],u=a[1],d=c*u;return{get:(h,m,f,v)=>h[m+f*c+v*d],set:(h,m,f,v,g)=>h[m+f*c+v*d]=g,add:(h,m,f,v,g)=>h[m+f*c+v*d]+=g,dataOffset:(h,m,f)=>h+m*c+f*d,getCoords:(h,m)=>{const f=Math.floor(h/c);return m[0]=h%c,m[1]=f%u,m[2]=Math.floor(f/u),m}}}if(l[0]===0&&l[1]===2&&l[2]===1){const c=a[0],u=a[2],d=c*u;return{get:(h,m,f,v)=>h[m+v*c+f*d],set:(h,m,f,v,g)=>h[m+v*c+f*d]=g,add:(h,m,f,v,g)=>h[m+v*c+f*d]+=g,dataOffset:(h,m,f)=>h+f*c+m*d,getCoords:(h,m)=>{const f=Math.floor(h/c);return m[0]=h%c,m[1]=Math.floor(f/u),m[2]=f%u,m}}}if(l[0]===1&&l[1]===0&&l[2]===2){const c=a[1],u=a[0],d=c*u;return{get:(h,m,f,v)=>h[f+m*c+v*d],set:(h,m,f,v,g)=>h[f+m*c+v*d]=g,add:(h,m,f,v,g)=>h[f+m*c+v*d]+=g,dataOffset:(h,m,f)=>m+h*c+f*d,getCoords:(h,m)=>{const f=Math.floor(h/c);return m[0]=f%u,m[1]=h%c,m[2]=Math.floor(f/u),m}}}if(l[0]===1&&l[1]===2&&l[2]===0){const c=a[1],u=a[2],d=c*u;return{get:(h,m,f,v)=>h[f+v*c+m*d],set:(h,m,f,v,g)=>h[f+v*c+m*d]=g,add:(h,m,f,v,g)=>h[f+v*c+m*d]+=g,dataOffset:(h,m,f)=>m+f*c+h*d,getCoords:(h,m)=>{const f=Math.floor(h/c);return m[0]=Math.floor(f/u),m[1]=h%c,m[2]=f%u,m}}}if(l[0]===2&&l[1]===0&&l[2]===1){const c=a[2],u=a[0],d=c*u;return{get:(h,m,f,v)=>h[v+m*c+f*d],set:(h,m,f,v,g)=>h[v+m*c+f*d]=g,add:(h,m,f,v,g)=>h[v+m*c+f*d]+=g,dataOffset:(h,m,f)=>f+h*c+m*d,getCoords:(h,m)=>{const f=Math.floor(h/c);return m[0]=f%u,m[1]=Math.floor(f/u),m[2]=h%c,m}}}if(l[0]===2&&l[1]===1&&l[2]===0){const c=a[2],u=a[1],d=c*u;return{get:(h,m,f,v)=>h[v+f*c+m*d],set:(h,m,f,v,g)=>h[v+f*c+m*d]=g,add:(h,m,f,v,g)=>h[v+f*c+m*d]+=g,dataOffset:(h,m,f)=>f+m*c+h*d,getCoords:(h,m)=>{const f=Math.floor(h/c);return m[0]=Math.floor(f/u),m[1]=f%u,m[2]=h%c,m}}}throw new Error("bad axis order");default:return{get:(c,...u)=>c[i(s,u)],set:(c,...u)=>c[i(s,u)]=u[u.length-1],add:(c,...u)=>c[i(s,u)]+=u[u.length-1],dataOffset:(...c)=>i(s,c),getCoords:(c,u)=>function(d,h,m){const{dimensions:f,axisOrderFastToSlow:v}=d,g=f.length;let b=h;for(let S=0;S<g;S++){const p=f[v[S]];m[v[S]]=b%p,b=Math.floor(b/p)}return m[v[g+1]]=b,m}(s,c,u)}}}function r(s){const{dimensions:a}=s;let l=1;for(let c=0,u=a.length;c<u;c++)l*=a[c];return c=>new(c||s.defaultCtor)(l)}function i(s,a){const{accessDimensions:l,axisOrderFastToSlow:c}=s,u=l.length-1;let d=l[u]*a[c[u]];for(let h=u-1;h>=0;h--)d=(d+a[c[h]])*l[h];return d}function o(s,a){const l=[];for(let c=0;c<s.length;c++)l[c]=s[a[c]];return l}n.create=function(s,a){return{space:s,data:a}},n.Space=e,n.Data1=function(s){return s},n.Vector=function(s,a){return e([s],[0],a)},n.ColumnMajorMatrix=function(s,a,l){return e([s,a],[1,0],l)},n.RowMajorMatrix=function(s,a,l){return e([s,a],[0,1],l)},n.toMat4=function(s,a,l){if(a.rank!==2)throw new Error("Invalid tensor rank");const c=Math.min(4,a.dimensions[0]),u=Math.min(4,a.dimensions[1]);for(let d=0;d<c;d++)for(let h=0;h<u;h++)ks.setValue(s,d,h,a.get(l,d,h));return s},n.toMat3=function(s,a,l){if(a.rank!==2)throw new Error("Invalid tensor rank");const c=Math.min(3,a.dimensions[0]),u=Math.min(3,a.dimensions[1]);for(let d=0;d<c;d++)for(let h=0;h<u;h++)Nf.setValue(s,d,h,a.get(l,d,h));return s},n.toVec3=function(s,a,l){if(a.rank!==1)throw new Error("Invalid tensor rank");const c=Math.min(3,a.dimensions[0]);for(let u=0;u<c;u++)s[u]=l[u];return s},n.toVec4=function(s,a,l){if(a.rank!==1)throw new Error("Invalid tensor rank");const c=Math.min(4,a.dimensions[0]);for(let u=0;u<c;u++)s[u]=l[u];return s},n.areEqualExact=function(s,a){const l=s.length;if(l!==a.length)return!1;for(let c=0;c<l;c++)if(s[c]!==a[c])return!1;return!0},n.invertAxisOrder=function(s){const a=[];for(let l=0;l<s.length;l++)a[l]=s[s.length-l-1];return a},n.convertToCanonicalAxisIndicesFastToSlow=function(s){const a=new Int32Array(s.length);for(let l=0;l<s.length;l++)a[s[l]]=l;return l=>o(l,a)},n.convertToCanonicalAxisIndicesSlowToFast=function(s){const a=new Int32Array(s.length);for(let l=0;l<s.length;l++)a[s[s.length-l-1]]=l;return l=>o(l,a)}}(Pu||(Pu={})),function(n){let e;function t(i,o){return YS(o.T,i,o,1)}function r(i){return Jh(i)}(function(i){function o(s,a=i.float){return{"@type":"tensor",T:s.create(),space:s,valueType:"tensor",baseType:a}}i.str={"@type":"str",T:"",valueType:"str"},i.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},i.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},i.int={"@type":"int",T:0,valueType:"int"},i.coord={"@type":"coord",T:0,valueType:"float"},i.float={"@type":"float",T:0,valueType:"float"},i.Str=function(s){var a;return{"@type":"str",T:(a=s==null?void 0:s.defaultValue)!==null&&a!==void 0?a:"",transform:s==null?void 0:s.transform,valueType:"str"}},i.Int=function(s=0){return{"@type":"int",T:s,valueType:"int"}},i.Float=function(s=0){return{"@type":"float",T:s,valueType:"float"}},i.Tensor=o,i.Vector=function(s,a=i.float){return o(Pu.Vector(s,a["@type"]==="int"?Int32Array:Float64Array),a)},i.Matrix=function(s,a,l=i.float){return o(Pu.ColumnMajorMatrix(s,a,l["@type"]==="int"?Int32Array:Float64Array),l)},i.Aliased=function(s){return s},i.List=function(s,a,l=[]){return{"@type":"list",T:l,separator:s,itemParse:a,valueType:"list"}}})(e=n.Schema||(n.Schema={})),n.is=function(i){return!!i&&!!i.schema&&!!i.value},n.ValueKind={Present:0,NotPresent:1,Unknown:2},n.Undefined=t,n.ofConst=function(i,o,s){return YS(i,o,s,0)},n.ofLambda=r,n.range=function(i,o){return r({value:s=>s+i,rowCount:Math.max(o-i+1,0),schema:e.int})},n.ofArray=function(i){return qo(i)},n.ofIntArray=function(i){return qo({array:i,schema:e.int})},n.ofFloatArray=function(i){return qo({array:i,schema:e.float})},n.ofStringArray=function(i){return qo({array:i,schema:e.str})},n.ofStringAliasArray=function(i){return qo({array:i,schema:e.Aliased(e.str)})},n.ofStringListArray=function(i,o=","){return qo({array:i,schema:e.List(o,s=>s)})},n.ofIntTokens=function(i){const{count:o,data:s,indices:a}=i;return Jh({value:l=>pc(s,a[2*l],a[2*l+1])||0,rowCount:o,schema:e.int})},n.ofFloatTokens=function(i){const{count:o,data:s,indices:a}=i;return Jh({value:l=>Yu(s,a[2*l],a[2*l+1])||0,rowCount:o,schema:e.float})},n.ofStringTokens=function(i){const{count:o,data:s,indices:a}=i;return Jh({value:l=>{const c=s.substring(a[2*l],a[2*l+1]);return c==="."||c==="?"?"":c},rowCount:o,schema:e.str})},n.window=function(i,o,s){return DX(i,o,s)},n.view=function(i,o,s=!0){return LX(i,o,s)},n.createFirstIndexMap=function(i){return function(o){const s=new Map;for(let a=0,l=o.rowCount;a<l;a++){const c=o.value(a);s.has(c)||s.set(o.value(a),a)}return s}(i)},n.createIndexer=function(i){return function(o){const s=new Map;for(let a=0,l=o.rowCount;a<l;a++){const c=o.value(a);s.has(c)||s.set(o.value(a),a)}return a=>s.has(a)?s.get(a):-1}(i)},n.mapToArray=function(i,o,s){return function(a,l,c){const u=new c(a.rowCount);for(let d=0,h=a.rowCount;d<h;d++)u[d]=l(a.value(d));return u}(i,o,s||Array)},n.areEqual=function(i,o){return function(s,a){return s===a||s.rowCount===a.rowCount&&s.isDefined===a.isDefined&&s.schema.valueType===a.schema.valueType&&(s.__array&&a.__array?function(l,c){const u=l.__array,d=c.__array;for(let h=0,m=l.rowCount;h<m;h++)if(u[h]!==d[h])return!1;return!0}(s,a):function(l,c){const u=l.value,d=c.value;for(let h=0,m=l.rowCount;h<m;h++)if(u(h)!==d(h))return!1;return!0}(s,a))}(i,o)},n.indicesOf=function(i,o){return function(s,a){const l=[],c=s.value;for(let u=0,d=s.rowCount;u<d;u++)a(c(u))&&(l[l.length]=u);return l}(i,o)},n.asArrayColumn=function(i,o){return i.__array?i:i.isDefined?qo({array:i.toArray({array:o}),schema:i.schema,valueKind:i.valueKind}):t(i.rowCount,i.schema)},n.copyToArray=function(i,o,s=0){if(!i.isDefined)return;const a=i.__array;if(a)for(let l=0,c=a.length;l<c;l++)o[s+l]=a[l];else for(let l=0,c=i.rowCount;l<c;l++)o[s+l]=i.value(l)},n.isIdentity=function(i){for(let o=0,s=i.rowCount;o<s;o++)if(o!==i.value(o))return!1;return!0}}(An||(An={})),function(n){n.create=function(e){return e},n.has=function(e,t){return!!(e&t)},n.hasAll=function(e,t){return!!t&&(e&t)===t}}(qS||(qS={})),function(n){n.create=function(i=512){return{current:[],offset:0,capacity:i,chunks:[]}},n.getString=function(i){return i.chunks.length?(i.offset>0&&(i.chunks[i.chunks.length]=i.current.length===i.offset?i.current.join(""):i.current.slice(0,i.offset).join("")),i.chunks.join("")):i.current.length===i.offset?i.current.join(""):i.current.splice(0,i.offset).join("")},n.getSize=function(i){let o=0;for(const s of i.chunks)o+=s.length;for(let s=0;s<i.offset;s++)o+=i.current[s].length;return o},n.getChunks=function(i){return i.offset>0&&(i.current.length===i.offset?i.chunks[i.chunks.length]=i.current.join(""):i.chunks[i.chunks.length]=i.current.slice(0,i.offset).join(""),i.offset=0),i.chunks};const e=[];function t(i,o){o>0&&r(i,e[o])}function r(i,o){i.offset===i.capacity&&(i.chunks[i.chunks.length]=i.current.join(""),i.offset=0),i.current[i.offset++]=o}(function(){let i="";for(let o=0;o<512;o++)e[o]=i,i+=" "})(),n.newline=function(i){r(i,`
`)},n.whitespace=t,n.whitespace1=function(i){r(i," ")},n.write=function(i,o){o&&(i.offset===i.capacity&&(i.chunks[i.chunks.length]=i.current.join(""),i.offset=0),i.current[i.offset++]=o)},n.writeSafe=r,n.writePadLeft=function(i,o,s){if(!o)return void t(i,s);t(i,s-o.length),r(i,o)},n.writePadRight=function(i,o,s){if(!o)return void t(i,s);const a=s-o.length;r(i,o),t(i,a)},n.writeInteger=function(i,o){r(i,""+o)},n.writeIntegerAndSpace=function(i,o){r(i,o+" ")},n.writeIntegerPadLeft=function(i,o,s){const a=""+o;t(i,s-a.length),r(i,a)},n.writeIntegerPadRight=function(i,o,s){const a=""+o,l=s-a.length;r(i,a),t(i,l)},n.writeFloat=function(i,o,s){r(i,""+Math.round(s*o)/s)},n.writeFloatPadLeft=function(i,o,s,a){const l=""+Math.round(s*o)/s;t(i,a-l.length),r(i,l)},n.writeFloatPadRight=function(i,o,s,a){const l=""+Math.round(s*o)/s,c=a-l.length;r(i,l),t(i,c)}}(Lr||(Lr={}));const Co=function(){if(typeof window<"u"&&window.performance){const n=window.performance;return()=>n.now()}return typeof process<"u"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?()=>{const n=process.hrtime();return 1e3*n[0]+n[1]/1e6}:Date.now?()=>Date.now():()=>+new Date}();var KS,ZS,Ku;function zX(n,e){return n-e}function HP(n=0,e=Number.MAX_SAFE_INTEGER){let t=n;return()=>{const r=t;return t=(t+1)%e,r}}(function(n){const e=typeof btoa<"u"?btoa:r=>Buffer.from(r).toString("base64"),t=[];n.create22=function(){let r=+new Date+Co();for(let i=0;i<16;i++)t[i]=String.fromCharCode((r+255*Math.random())%255|0),r=Math.floor(r/255);return e(t.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)},n.createv4=function(){let r=+new Date+Co();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const o=(r+16*Math.random())%16|0;return r=Math.floor(r/16),(i==="x"?o:3&o|8).toString(16)})},n.is=function(r){return typeof r=="string"}})(KS||(KS={})),function(n){class e{has(c){return!1}forEach(c,u){return u}constructor(){this.size=0}}class t{has(c){return c===this.idx}forEach(c,u){return c(this.idx,u),u}constructor(c){this.idx=c,this.size=1}}class r{has(c){return c<this.length&&!!this.mask[c]}_forEach(c,u){for(let d=0;d<this.length;d++)this.mask[d]&&c(d,u)}forEach(c,u){return this._forEach(c,u),u}constructor(c,u){this.mask=c,this.size=u,this.length=c.length}}class i{has(c){return!0}_forEach(c,u){for(let d=0;d<this.size;d++)c(d,u)}forEach(c,u){return this._forEach(c,u),u}constructor(c){this.size=c}}class o{has(c){return this.set.has(c)}_forEach(c,u){for(const d of this.flatten())c(d,u)}flatten(){if(this._flat)return this._flat;const c=new Int32Array(this.size);let u=0;return this.set.forEach(d=>c[u++]=d),function(d){Array.prototype.sort.call(d,zX)}(c),this._flat=c,this._flat}forEach(c,u){return this._forEach(c,u),u}constructor(c){this.set=c,this._flat=void 0,this.size=c.size}}function s(l){return new o(l)}function a(l,c){return new r(l,c)}n.always=function(l){return new i(l)},n.never=new e,n.ofSet=s,n.singleton=function(l){return new t(l)},n.ofUniqueIndices=function(l){const c=l.length;if(c===0)return new e;if(c===1)return new t(l[0]);let u=0;for(const h of l)h>u&&(u=h);if(c===u)return new i(c);if(c/u<1/12){const h=new Set;for(const m of l)h.add(m);return new o(h)}const d=new Int8Array(u+1);for(const h of l)d[h]=1;return new r(d,l.length)},n.ofMask=a,n.hasAny=function(l,c){for(const u of c)if(l.has(u))return!0;return!1},n.complement=function(l,c){let u=0,d=0;if(c.forEach(h=>{l.has(h)||(u++,h>d&&(d=h))}),u/d<1/12){const h=new Set;return c.forEach(m=>{l.has(m)||h.add(m)}),s(h)}{const h=new Uint8Array(d+1);return c.forEach(m=>{l.has(m)||(h[m]=1)}),a(h,u)}}}(ZS||(ZS={})),function(n){n.create=function(e){return{ref:e}},n.set=function(e,t){return e.ref=t,e}}(Ku||(Ku={}));const UX=HP(0,2147483647);var Qh,JS,ef,Av,mc;function $X(n){const{data:e,indices:t}=n;return function(r,i){const o=t[2*r],s=t[2*i],a=t[2*r+1]-o;if(a!==t[2*i+1]-s)return!1;for(let l=0;l<a;l++)if(e.charCodeAt(l+o)!==e.charCodeAt(l+s))return!1;return!0}}function VP(n,e){return{name:e,blocks:n}}function gy(n,e,t,r=[]){return{categoryNames:n,header:t,categories:e,saveFrames:r,getField(i){const[o,s]=i.split(".");return e[o].getField(s||"")}}}function Mp(n,e,t,r){return{rowCount:e,name:n,fieldNames:[...t],getField:i=>r[i]}}(function(n){n.create=function(e,t){return{id:UX(),version:0,value:e,metadata:t}},n.withValue=function(e,t){return{id:e.id,version:e.version+1,value:t,metadata:e.metadata}}})(Qh||(Qh={})),function(n){function e(t,r){return Ku.set(t,Qh.withValue(t.ref,r))}n.create=function(t,r){return Ku.create(Qh.create(t,r))},n.update=e,n.set=function(t,r){return Ku.set(t,r)},n.updateIfChanged=function(t,r){return t.ref.value!==r?e(t,r):t}}(JS||(JS={})),function(n){function e(r,i,o){const s=Object.create(null),a=Object.keys(i);s._rowCount=o.length,s._columns=a,s._schema=i;for(const l of a)s[l]=An.view(r[l],o);return s}function t(r,i){const o=Object.create(null),{_columns:s}=r;for(let a=0;a<s.length;a++){const l=s[a];o[l]=r[l].value(i)}return o}n.is=function(r){return r&&typeof r._rowCount=="number"&&!!r._columns&&!!r._schema},n.pickColumns=function(r,i,o={}){const s=Object.create(null),a=Object.keys(r);s._rowCount=i._rowCount,s._columns=a,s._schema=r;for(const l of a)if(i[l])s[l]=i[l];else{if(!o[l])throw Error(`Cannot find column '${l}'.`);s[l]=o[l]}return s},n.ofColumns=function(r,i){const o=Object.keys(i);return{_rowCount:i[o[0]].rowCount,_columns:o,_schema:r,...i}},n.ofPartialColumns=function(r,i,o){const s=Object.create(null),a=Object.keys(r);s._rowCount=o,s._columns=a,s._schema=r;for(const l of a)s[l]=l in i?i[l]:An.Undefined(o,r[l]);return s},n.ofUndefinedColumns=function(r,i){const o=Object.create(null),s=Object.keys(r);o._rowCount=i,o._columns=s,o._schema=r;for(const a of s)o[a]=An.Undefined(i,r[a]);return o},n.ofRows=function(r,i){const o=Object.create(null),s=i.length,a=Object.keys(r);o._rowCount=s,o._columns=a,o._schema=r;for(const l of a)o[l]=An.ofLambda({rowCount:s,schema:r[l],value:c=>i[c][l],valueKind:c=>i[c][l]===void 0?1:0});return o},n.ofArrays=function(r,i){var o;const s=Object.create(null),a=Object.keys(r);s._rowCount=0,s._columns=a,s._schema=r;for(const l of a)i[l]!==void 0?(s[l]=An.ofArray({array:i[l],schema:r[l]}),s._rowCount=(o=i[l])===null||o===void 0?void 0:o.length):s[l]=An.Undefined(s._rowCount,r[l]);return s},n.view=e,n.pick=function(r,i,o){const s=[];for(let a=0,l=r._rowCount;a<l;++a)o(a)&&s.push(a);return e(r,i,s)},n.window=function(r,i,o,s){if(o===0&&s===r._rowCount)return r;const a=Object.create(null),l=Object.keys(i);a._rowCount=s-o,a._columns=l,a._schema=i;for(const c of l)a[c]=An.window(r[c],o,s);return a},n.concat=function(r,i){const o=Object.create(null),s=Object.keys(i);o._rowCount=0;for(const c of r)o._rowCount+=c._rowCount;const a={};for(const c of s)a[c]=new Array(o._rowCount);o._columns=s,o._schema=i;let l=0;for(const c of r){for(const u of s)An.copyToArray(c[u],a[u],l);l+=c._rowCount}for(const c of s)o[c]=An.ofArray({array:a[c],schema:i[c]});return o},n.columnToArray=function(r,i,o){r[i]=An.asArrayColumn(r[i],o)},n.sort=function(r,i){const o=new Int32Array(r._rowCount);for(let l=0,c=o.length;l<c;l++)o[l]=l;NX(o,(l,c,u)=>i(c,u));let s=!0;for(let l=0,c=o.length;l<c;l++)if(o[l]!==l){s=!1;break}if(s)return r;const a=Object.create(null);a._rowCount=r._rowCount,a._columns=r._columns,a._schema=r._schema;for(const l of r._columns)a[l]=An.view(r[l],o,!1);return a},n.areEqual=function(r,i){if(r._rowCount!==i._rowCount||r._columns.length!==i._columns.length)return!1;for(const o of r._columns)if(!i[o])return!1;for(const o of r._columns)if(!An.areEqual(r[o],i[o]))return!1;return!0},n.getRow=t,n.pickRow=function(r,i){for(let o=0,s=r._rowCount;o<s;++o)if(i(o))return t(r,o)},n.getRows=function(r){const i=[],{_rowCount:o}=r;for(let s=0;s<o;s++)i[s]=t(r,s);return i},n.toArrays=function(r){const i={},{_columns:o}=r;for(let s=0;s<o.length;s++){const a=o[s];i[a]=r[a].toArray()}return i},n.formatToString=function(r){const i=Lr.create(),{_columns:o,_rowCount:s}=r;let a=1;Lr.write(i,"|");for(let l=0;l<o.length;l++)Lr.write(i,o[l]),Lr.write(i,"|"),a+=o[l].length+1;Lr.newline(i),Lr.write(i,new Array(a+1).join("-")),Lr.newline(i);for(let l=0;l<s;l++){Lr.write(i,"|");for(let c=0;c<o.length;c++){const u=r[o[c]];u.valueKind(l)===0?(Lr.write(i,u.value(l)),Lr.write(i,"|")):Lr.write(i,".|")}Lr.newline(i)}return Lr.getString(i)}}(ef||(ef={})),function(n){n.ofTables=function(e,t,r){const i=Object.keys(r),o=Object.create(null),s=[];o._name=e,o._tableNames=s,o._schema=t;for(const a of i)ef.is(r[a])&&(o[a]=r[a],s[s.length]=a);return o},n.getTablesAsRows=function(e){const t={};for(const r of e._tableNames)t[r]=ef.getRows(e[r]);return t}}(Av||(Av={})),function(n){function e(t,r){const i=Object.keys(r);return{rowCount:i.length>0?r[i[0]].rowCount:0,name:t,fieldNames:i,getField:o=>r[o]}}n.empty=function(t){return{rowCount:0,name:t,fieldNames:[],getField(r){}}},n.ofFields=e,n.ofTable=function(t,r){const i={};for(const o of r._columns)i[o]=mc.ofColumn(r[o]);return e(t,i)}}(Mp||(Mp={})),function(n){function e(r){const i=r.length,o=l=>{const c=r[l];return c&&c!=="."&&c!=="?"?c:""},s=l=>{const c=r[l];return pc(c,0,c.length)||0},a=l=>{const c=r[l];return Yu(c,0,c.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:i,str:o,int:s,float:a,valueKind:l=>{const c=r[l],u=c.length;if(u>1)return 0;if(u===0)return 1;const d=c.charCodeAt(0);return d===46?1:d===63?2:0},areValuesEqual:(l,c)=>r[l]===r[c],toStringArray:l=>l?wr(i,o,l):r,toIntArray:l=>wr(i,s,l),toFloatArray:l=>wr(i,a,l)}}function t(r){const{rowCount:i,valueKind:o,areValuesEqual:s,isDefined:a}=r;let l,c,u;switch(r.schema.valueType){case"float":case"int":l=h=>""+r.value(h),c=r.value,u=r.value;break;case"str":l=r.value,c=h=>{const m=r.value(h);return pc(m,0,m.length)||0},u=h=>{const m=r.value(h);return Yu(m,0,m.length)||0};break;case"list":const{separator:d}=r.schema;l=h=>r.value(h).join(d),c=h=>NaN,u=h=>NaN;break;default:throw new Error(`unsupported valueType '${r.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:a,rowCount:i,str:l,int:c,float:u,valueKind:o,areValuesEqual:s,toStringArray:d=>wr(i,l,d),toIntArray:d=>wr(i,c,d),toFloatArray:d=>wr(i,u,d)}}n.ofString=function(r){return e([r])},n.ofStrings=e,n.ofNumbers=function(r){const i=r.length,o=l=>""+r[l],s=l=>r[l],a=l=>!l||l.array&&r instanceof l.array?r:wr(i,s,l);return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:i,str:o,int:s,float:s,valueKind:l=>0,areValuesEqual:(l,c)=>r[l]===r[c],toStringArray:l=>wr(i,o,l),toIntArray:a,toFloatArray:a}},n.ofTokens=function(r){const{data:i,indices:o,count:s}=r,a=u=>{const d=i.substring(o[2*u],o[2*u+1]);return d==="."||d==="?"?"":d},l=u=>pc(i,o[2*u],o[2*u+1])||0,c=u=>Yu(i,o[2*u],o[2*u+1])||0;return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:s,str:a,int:l,float:c,valueKind:u=>{const d=o[2*u],h=o[2*u+1]-d;if(h>1)return 0;if(h===0)return 1;const m=i.charCodeAt(d);return m===46?1:m===63?2:0},areValuesEqual:$X(r),toStringArray:u=>wr(s,a,u),toIntArray:u=>wr(s,l,u),toFloatArray:u=>wr(s,c,u)}},n.ofColumn=t,n.ofUndefined=function(r,i){return t(An.Undefined(r,i))}}(mc||(mc={}));const Mv=typeof setImmediate<"u"?typeof window<"u"?{setImmediate:(n,...e)=>window.setImmediate(n,...e),clearImmediate:n=>window.clearImmediate(n)}:{setImmediate,clearImmediate}:function(){const n=function(){const a=typeof window<"u"&&window,l=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self;return a||typeof global<"u"&&global||l}(),e={},t=typeof document<"u"?document:void 0;let r,i=1;function o(a){delete e[a]}function s(a){const l=e[a];o(a),function(c){const u=c.callback,d=c.args;switch(d.length){case 0:u();break;case 1:u(d[0]);break;case 2:u(d[0],d[1]);break;case 3:u(d[0],d[1],d[2]);break;default:u.apply(void 0,d)}}(l)}return typeof process<"u"&&{}.toString.call(process)==="[object process]"?r=function(a){process.nextTick(function(){s(a)})}:function(){if(n&&n.postMessage&&!n.importScripts){let a=!0;const l=n.onmessage;return n.onmessage=function(){a=!1},n.postMessage("","*"),n.onmessage=l,a}}()?function(){const a="setImmediate$"+Math.random()+"$",l=function(c){c.source===n&&typeof c.data=="string"&&c.data.indexOf(a)===0&&s(+c.data.slice(a.length))};window.addEventListener?window.addEventListener("message",l,!1):window.attachEvent("onmessage",l),r=function(c){window.postMessage(a+c,"*")}}():typeof MessageChannel<"u"?function(){const a=new MessageChannel;a.port1.onmessage=function(l){s(l.data)},r=function(l){a.port2.postMessage(l)}}():t&&"onreadystatechange"in t.createElement("script")?function(){const a=t.documentElement;r=function(l){let c=t.createElement("script");c.onreadystatechange=function(){s(l),c.onreadystatechange=null,a.removeChild(c),c=null},a.appendChild(c)}}():r=function(a){setTimeout(s,0,a)},{setImmediate:function(a,...l){typeof a!="function"&&(a=new Function(""+a));const c={callback:a,args:l};return e[i]=c,r(i),i++},clearImmediate:o}}();function HX(n){Mv.setImmediate(n)}const VX={setImmediate:Mv.setImmediate,clearImmediate:Mv.clearImmediate,immediatePromise:()=>new Promise(HX),delay:(n,e=void 0)=>new Promise(t=>setTimeout(t,n,e))};(function(){try{return!0}catch{return!1}})(),function(){try{const n=UV.DEBUG;return n==="*"||n==="molstar"}catch{return!1}}();const B0=typeof performance<"u"&&!!performance.mark&&performance.measure&&!1;var Zu;function GX(n,e,t=250){const r=function(i,o,s){const a={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:s,lastNotified:Co(),observer:o,abortToken:a,taskId:i.id,root:{progress:GP(i),children:[]},tryAbort:WX(a)}}(n,e,t);return vy(n,new by(r,r.root))}function GP(n){return{taskId:n.id,taskName:n.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function WX(n){return e=>{n.abortRequested=!0,n.reason=e||n.reason}}function WP(n){return{progress:{...n.progress},children:n.children.map(WP)}}function jP(n){return n.progress.canAbort&&n.children.every(jP)}async function vy(n,e){Zu.markStart(n),e.node.progress.startedTime=Co();try{const t=await n.f(e);return Zu.markEnd(n),Zu.measure(n),e.info.abortToken.abortRequested&&qP(e.info),t}catch(t){throw al.isAbort(t)&&(e.isAborted=!0,e.node.children.length>0&&await new Promise(r=>{e.onChildrenFinished=r}),n.onAbort&&n.onAbort()),t}}function qP(n){throw n.abortToken.treeAborted||(n.abortToken.treeAborted=!0,XP(n.root),YP(n,Co())),al.Aborted(n.abortToken.reason)}function XP(n){const e=n.progress;e.isIndeterminate=!0,e.canAbort=!1,e.message="Aborting...";for(const t of n.children)XP(t)}function YP(n,e){n.lastNotified=e;const t=function(r){return{root:WP(r.root),canAbort:jP(r.root),requestAbort:r.tryAbort}}(n);n.observer(t)}(function(n){function e(r){return`startTask${r.id}`}function t(r){return`endTask${r.id}`}n.markStart=function(r){B0&&performance.mark(e(r))},n.markEnd=function(r){B0&&performance.mark(t(r))},n.measure=function(r){B0&&performance.measure(`✳️ ${r.name}`,e(r),t(r))}})(Zu||(Zu={}));class by{checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,qP(this.info))}get shouldUpdate(){return this.checkAborted(),Co()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(e){if(this.checkAborted(),!e)return;const t=this.node.progress;typeof e=="string"?(t.message=e,t.isIndeterminate=!0):(e.canAbort!==void 0&&(t.canAbort=e.canAbort),e.message!==void 0&&(t.message=e.message),e.current!==void 0&&(t.current=e.current),e.max!==void 0&&(t.max=e.max),t.isIndeterminate=t.current===void 0||t.max===void 0,e.isIndeterminate!==void 0&&(t.isIndeterminate=e.isIndeterminate))}update(e,t){if(this.lastUpdatedTime=Co(),this.updateProgress(e),!t)return YP(this.info,this.lastUpdatedTime),this.checkAborted(),VX.immediatePromise()}async runChild(e,t){this.updateProgress(t);const r={progress:GP(e),children:[]},i=this.node.children;i.push(r);const o=new by(this.info,r);try{return await vy(e,o)}catch(s){if(al.isAbort(s)&&this.isAborted)return;throw s}finally{const s=i.indexOf(r);if(s>=0){for(let a=s,l=i.length-1;a<l;a++)i[a]=i[a+1];i.pop()}i.length===0&&this.onChildrenFinished&&this.onChildrenFinished()}}constructor(e,t){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=t,this.info=e}}const tf=new class{constructor(){this.shouldUpdate=!1,this.isSynchronous=!0}update(n,e){}};var al,QS,eC,Ui,Ya,Gt;async function Tv(n,e,t,r,i){let o=Math.max(e,0),s=0,a=0;if(n.isSynchronous)return r(Number.MAX_SAFE_INTEGER,t),t;let l=Co(),c=0,u=0;for(;(c=r(o,t))>0;){s+=c;const d=Co()-l;u+=d,a+=d,n.shouldUpdate&&(await i(n,t,s),o=Math.round(u*s/a)+1,l=Co(),u=0)}return n.shouldUpdate&&await i(n,t,s),t}function Ev(n){return{data:n,position:0,length:n.length,lineNumber:1,tokenStart:0,tokenEnd:0}}function tC(n){for(;n.position<n.length;)switch(n.data.charCodeAt(n.position)){case 9:case 10:case 13:case 32:return void(n.tokenEnd=n.position);default:++n.position}n.tokenEnd=n.position}function nC(n){return!(n.length-n.position<2)&&n.data.charCodeAt(n.position+1)===39&&n.data.charCodeAt(n.position+2)===39}function jX(n,e,t){let r;const i=t-e,o=n.tokenStart-e,s=n.tokenEnd-n.tokenStart;if(s<i)return!1;for(r=e;r<t;++r)if(n.data.charCodeAt(r)!==n.data.charCodeAt(r+o))return!1;return i===s||n.data.charCodeAt(r+o)===46}function KP(n){let e;for(e=n.tokenStart;e<n.tokenEnd;++e)if(n.data.charCodeAt(e)===46)return e;return e}function ZP(n,e){return n.data.substring(n.tokenStart,e)}function Pv(n){return n.data.substring(n.tokenStart,n.tokenEnd)}function rC(n){const e=function(r){let i=10;for(;r.position<r.length;){const o=r.data.charCodeAt(r.position);switch(o){case 9:case 32:i=o,++r.position;break;case 10:i!==13&&++r.lineNumber,i=o,++r.position;break;case 13:i=o,++r.position,++r.lineNumber;break;default:return i}}return i}(n);if(n.position>=n.length)return void(n.tokenType=6);n.tokenStart=n.position,n.tokenEnd=n.position,n.isEscaped=!1;const t=n.data.charCodeAt(n.position);switch(t){case 35:(function(r){for(;r.position<r.length;){const i=r.data.charCodeAt(r.position);if(i===10||i===13)return;++r.position}})(n),n.tokenType=5;break;case 39:if(nC(n)){(function(r){for(r.position+=3;r.position<r.length;){if(r.data.charCodeAt(r.position)===39&&nC(r))return r.tokenStart+=3,r.tokenEnd=r.position,r.isEscaped=!0,void(r.position+=3);++r.position}r.tokenEnd=r.position})(n),n.tokenType=3;break}case 34:(function(r,i){let o,s;for(++r.position;r.position<r.length;)if(s=r.data.charCodeAt(r.position),s===i)switch(o=r.data.charCodeAt(r.position+1),o){case 9:case 10:case 13:case 32:return r.tokenStart++,r.tokenEnd=r.position,r.isEscaped=!0,void++r.position;default:if(o===void 0)return r.tokenStart++,r.tokenEnd=r.position,r.isEscaped=!0,void++r.position;++r.position}else{if(s===10||s===13)return void(r.tokenEnd=r.position);++r.position}r.tokenEnd=r.position})(n,t),n.tokenType=3;break;case 59:e===10||e===13?function(r){let i,o=59,s=r.position+1;for(;s<r.length;){if(i=r.data.charCodeAt(s),i===59&&(o===10||o===13)){for(r.position=s+1,r.tokenStart++,s--,i=r.data.charCodeAt(s);i===10||i===13;)s--,i=r.data.charCodeAt(s);return r.tokenEnd=s+1,void(r.isEscaped=!0)}(i===13||i===10&&o!==13)&&r.lineNumber++,o=i,++s}r.position=s}(n):tC(n),n.tokenType=3;break;default:n.isImportGet?function(r){for(;r.position<r.length;){if(r.data.charCodeAt(r.position)===93)return++r.position,r.tokenEnd=r.position,void(r.isImportGet=!1);++r.position}}(n):tC(n),n.isEscaped?n.tokenType=3:n.data.charCodeAt(n.tokenStart)===95?(n.inSaveFrame&&function(r){return r.tokenEnd-r.tokenStart==11&&r.data.charCodeAt(r.tokenStart+1)===105&&r.data.charCodeAt(r.tokenStart+2)===109&&r.data.charCodeAt(r.tokenStart+3)===112&&r.data.charCodeAt(r.tokenStart+4)===111&&r.data.charCodeAt(r.tokenStart+5)===114&&r.data.charCodeAt(r.tokenStart+6)===116&&r.data.charCodeAt(r.tokenStart+7)===46&&r.data.charCodeAt(r.tokenStart+8)===103&&r.data.charCodeAt(r.tokenStart+9)===101&&r.data.charCodeAt(r.tokenStart+10)===116}(n)&&(n.isImportGet=!0),n.tokenType=4):n.tokenEnd-n.tokenStart>=5&&n.data.charCodeAt(n.tokenStart+4)===95?function(r){let i=r.data.charCodeAt(r.tokenStart);return!(i!==68&&i!==100||(i=r.data.charCodeAt(r.tokenStart+1),i!==65&&i!==97||(i=r.data.charCodeAt(r.tokenStart+2),i!==84&&i!==116||(i=r.data.charCodeAt(r.tokenStart+3),i!==65&&i!==97))))}(n)?n.tokenType=0:function(r){let i=r.data.charCodeAt(r.tokenStart);return!(i!==83&&i!==115||(i=r.data.charCodeAt(r.tokenStart+1),i!==65&&i!==97||(i=r.data.charCodeAt(r.tokenStart+2),i!==86&&i!==118||(i=r.data.charCodeAt(r.tokenStart+3),i!==69&&i!==101))))}(n)?n.tokenType=1:function(r){if(r.tokenEnd-r.tokenStart!=5)return!1;let i=r.data.charCodeAt(r.tokenStart);return!(i!==76&&i!==108||(i=r.data.charCodeAt(r.tokenStart+1),i!==79&&i!==111||(i=r.data.charCodeAt(r.tokenStart+2),i!==79&&i!==111||(i=r.data.charCodeAt(r.tokenStart+3),i!==80&&i!==112))))}(n)?n.tokenType=2:n.tokenType=3:n.tokenType=3}}function Vs(n){for(rC(n);n.tokenType===5;)rC(n)}function nf(){return{categoryNames:[],categoryData:Object.create(null)}}function yy(n,e){const t=Object.create(null);for(const r of n){const i=e[r];t[r]=Mp(i.name,i.rowCount,i.fieldNames,i.fields)}return t}function iC(n,e,t){return gy(n.categoryNames,yy(n.categoryNames,n.categoryData),e,t)}function qX(n,e){return gy(n.categoryNames,yy(n.categoryNames,n.categoryData),e)}function Rv(n,e,t,r,i){if(e in n.categoryData){const o=n.categoryData[e];o.fieldNames.push(...r),Object.assign(o.fields,i)}else n.categoryData[e]={name:e,rowCount:t,fieldNames:r,fields:i},n.categoryNames.push(e)}function XX(n,e){const t=n.tokenStart,r=KP(n),i=ZP(n,r),o=Object.create(null),s=[];let a=!0;for(;a;){if(n.tokenType!==4||!jX(n,t,r)){a=!1;break}const l=Pv(n).substring(i.length+1);if(Vs(n),n.tokenType!==3)return{hasError:!0,errorLine:n.lineNumber,errorMessage:"Expected value."};o[l]=mc.ofTokens({data:n.data,indices:[n.tokenStart,n.tokenEnd],count:1}),s[s.length]=l,Vs(n)}return Rv(e,i.substr(1),1,s,o),{hasError:!1,errorLine:0,errorMessage:""}}function YX(n,e){const{tokenizer:t,tokens:r,fieldCount:i}=e;let o=e.tokenCount,s=0;for(;t.tokenType===3&&s<n;)Ui.add(r[o++%i],t.tokenStart,t.tokenEnd),Vs(t),s++;return e.tokenCount=o,s}function KX(n,e){return n.update({message:"Parsing...",current:e.tokenizer.position,max:e.tokenizer.data.length})}async function ZX(n,e){const t=n.lineNumber;Vs(n);const r=ZP(n,KP(n)),i=function(d){let h;for(h=d.tokenStart;h<d.tokenEnd;++h)if(d.data.charCodeAt(h)===46)return!1;return!0}(n),o=[];for(;n.tokenType===4;)o[o.length]=i?Pv(n):Pv(n).substring(r.length+1),Vs(n);const s=r==="_atom_site"?n.data.length/100|0:32,a=[],l=o.length;for(let d=0;d<l;d++)a[d]=Ui.create(n.data,s);const c={fieldCount:l,tokenCount:0,tokenizer:n,tokens:a};if(await Tv(n.runtimeCtx,1e6,c,YX,KX),c.tokenCount%l!=0)return{hasError:!0,errorLine:n.lineNumber,errorMessage:`The number of values for loop starting at line ${t} is not a multiple of the number of columns.`};const u=c.tokenCount/l|0;if(i)for(let d=0;d<l;d++){const h={"":mc.ofTokens(a[d])};Rv(e,o[d].substr(1),u,[""],h)}else{const d=Object.create(null);for(let h=0;h<l;h++)d[o[h]]=mc.ofTokens(a[h]);Rv(e,r.substr(1),u,o,d)}return{hasError:!1,errorLine:0,errorMessage:""}}function Vl(n,e){return Ya.error(e,n)}async function JX(n,e){const t=[],r=function(u,d){return{data:u,length:u.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:d}}(n,e);let i="",o=nf(),s=[],a=nf();const l=function(u,d,h){return{categoryNames:u,header:h,categories:d}}(a.categoryNames,yy(a.categoryNames,a.categoryData),"");let c="";for(e.update({message:"Parsing...",current:0,max:n.length}),Vs(r);r.tokenType!==6;){const u=r.tokenType;if(u===0){if(r.inSaveFrame)return Vl(r.lineNumber,"Unexpected data block inside a save frame.");o.categoryNames.length>0&&t.push(iC(o,i,s)),i=n.substring(r.tokenStart+5,r.tokenEnd),o=nf(),s=[],Vs(r)}else if(u===1){if(r.tokenEnd-r.tokenStart==5)a.categoryNames.length>0&&(s[s.length]=qX(a,c)),r.inSaveFrame=!1;else{if(r.inSaveFrame)return Vl(r.lineNumber,"Save frames cannot be nested.");r.inSaveFrame=!0,c=n.substring(r.tokenStart+5,r.tokenEnd),a=nf()}Vs(r)}else if(u===2){const d=await ZX(r,r.inSaveFrame?a:o);if(d.hasError)return Vl(d.errorLine,d.errorMessage)}else{if(u!==4)return console.log(r.tokenType,Ev.getTokenString(r)),Vl(r.lineNumber,"Unexpected token. Expected data_, loop_, or data name.");{const d=XX(r,r.inSaveFrame?a:o);if(d.hasError)return Vl(d.errorLine,d.errorMessage)}}}return r.inSaveFrame?Vl(r.lineNumber,`Unfinished save frame (${l.header}).`):((o.categoryNames.length>0||s.length>0)&&t.push(iC(o,i,s)),function(u){return Ya.success(u)}(VP(t)))}function oC(n){return al.create("Parse CIF",async e=>await JX(n,e))}(function(n){class e{run(s,a=250){return s?GX(this,s,a):this.f(tf)}runAsChild(s,a){return s.isSynchronous?this.f(tf):function(l,c,u){return l.runChild(c,u)}(s,this,a)}runInContext(s){return s.isSynchronous?this.f(tf):function(a,l){return vy(l,a)}(s,this)}constructor(s,a,l){this.name=s,this.f=a,this.onAbort=l,this.id=i()}}function t(o){const s=o;return!!o&&typeof s.id=="number"&&typeof s.name=="string"&&!!s.run}function r(o,s,a){return new e(o,s,a)}n.is=t,n.isAbort=function(o){return!!o&&!!o.isAborted},n.Aborted=function(o){return{isAborted:!0,reason:o,toString:()=>"Aborted"+(o?": "+o:"")}},n.create=r,n.constant=function(o,s){return r(o,async a=>s)},n.empty=function(){return r("",async o=>{})},n.fail=function(o,s){return r(o,async a=>{throw new Error(s)})},n.resolveInContext=function(o,s){return t(o)?s?o.runInContext(s):o.run():o};const i=HP(0,1073741823)})(al||(al={})),function(n){n.Synchronous=tf}(QS||(QS={})),function(n){function e(t,r=""){const i=t.progress;if(!t.children.length)return i.isIndeterminate?`${r}${i.taskName}: ${i.message}`:`${r}${i.taskName}: [${i.current}/${i.max}] ${i.message}`;const o=r+"  |_ ",s=t.children.map(a=>e(a,o));return i.isIndeterminate?`${r}${i.taskName}: ${i.message}
${s.join(`
`)}`:`${r}${i.taskName}: [${i.current}/${i.max}] ${i.message}
${s.join(`
`)}`}n.format=function(t){return e(t.root)}}(eC||(eC={})),function(n){function e(s){return s.data.substring(s.tokenStart,s.tokenEnd)}function t(s){const{data:a}=s;for(;s.position<s.length;)switch(a.charCodeAt(s.position)){case 10:return s.tokenEnd=s.position,++s.position,++s.lineNumber,!0;case 13:return s.tokenEnd=s.position,++s.position,++s.lineNumber,a.charCodeAt(s.position)===10&&++s.position,!0;default:++s.position}return s.tokenEnd=s.position,s.tokenStart!==s.tokenEnd}function r(s){return s.tokenStart=s.position,t(s)}function i(s,a,l){let c=0;for(let u=0;u<a;u++){if(!r(s))return c;Ui.addUnchecked(l,s.tokenStart,s.tokenEnd),c++}return c}function o(s,a,l){const{data:c}=s;let u=a,d=l-1,h=c.charCodeAt(u);for(;(h===9||h===32)&&u<=d;)h=c.charCodeAt(++u);for(h=c.charCodeAt(d);(h===9||h===32)&&d>=u;)h=c.charCodeAt(--d);return s.tokenStart=u,s.tokenEnd=d+1,s.position=l,s}n.getTokenString=e,n.reset=function(s){s.position=0,s.lineNumber=1,s.tokenStart=0,s.tokenEnd=0},n.eatLine=t,n.markStart=function(s){s.tokenStart=s.position},n.markLine=r,n.readLine=function(s){return r(s),e(s)},n.readLineTrim=function(s){r(s);const a=s.position;return o(s,s.tokenStart,s.tokenEnd),s.position=a,e(s)},n.markLines=function(s,a){const l=Ui.create(s.data,2*a);return i(s,a,l),l},n.readLines=function(s,a){const l=[];for(let c=0;c<a;c++)l.push(n.readLine(s));return l},n.readLinesAsync=async function(s,a,l,c=1e5){const u=Ui.create(s.data,2*a);let d=0;return await Tv(l,c,s,(h,m)=>{const f=Math.min(a-d,h);return i(m,f,u),d+=f,f},(h,m)=>h.update({message:"Parsing...",current:m.position,max:m.length})),u},n.readAllLines=function(s){const a=n(s),l=Ui.create(a.data,Math.max(s.length/80,2));for(;r(a);)Ui.add(l,a.tokenStart,a.tokenEnd);return l},n.readAllLinesAsync=async function(s,a,l=1e5){const c=n(s),u=Ui.create(c.data,Math.max(s.length/80,2));return await Tv(a,l,c,(d,h)=>(function(m,f,v){let g=0;for(let b=0;b<f;b++){if(!r(m))return g;Ui.add(v,m.tokenStart,m.tokenEnd),g++}}(h,d,u),h.position<h.length?d:0),(d,h)=>d.update({message:"Parsing...",current:h.position,max:h.length})),u},n.eatValue=function(s){for(;s.position<s.length;)switch(s.data.charCodeAt(s.position)){case 9:case 10:case 13:case 32:return void(s.tokenEnd=s.position);default:++s.position}s.tokenEnd=s.position},n.skipWhitespace=function(s){let a=-1;for(;s.position<s.length;){const l=s.data.charCodeAt(s.position);switch(l){case 9:case 32:a=l,++s.position;break;case 10:a!==13&&++s.lineNumber,a=l,++s.position;break;case 13:a=l,++s.position,++s.lineNumber;break;default:return a}}return a},n.trim=o}(Ev||(Ev={})),function(n){function e(t,r,i){const o=t;o.offset>o.indicesLenMinus2&&function(s){const a=new Uint32Array(1.61*s.indices.length|0);a.set(s.indices),s.indices=a,s.indicesLenMinus2=a.length-2|0}(o),o.indices[o.offset++]=r,o.indices[o.offset++]=i,t.count++}n.add=e,n.addToken=function(t,r){e(t,r.tokenStart,r.tokenEnd)},n.addUnchecked=function(t,r,i){t.indices[t.offset++]=r,t.indices[t.offset++]=i,t.count++},n.create=function(t,r){return{data:t,indicesLenMinus2:(r=Math.max(10,r))-2|0,count:0,offset:0,indices:new Uint32Array(r)}}}(Ui||(Ui={})),function(n){n.error=function(r,i=-1){return new e(r,i)},n.success=function(r,i=[]){return new t(r,i)};class e{toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}constructor(i,o){this.message=i,this.line=o,this.isError=!0}}n.Error=e;class t{constructor(i,o){this.result=i,this.warnings=o,this.isError=!1}}n.Success=t}(Ya||(Ya={})),function(n){var e,t;(e=n.IntDataType||(n.IntDataType={}))[e.Int8=1]="Int8",e[e.Int16=2]="Int16",e[e.Int32=3]="Int32",e[e.Uint8=4]="Uint8",e[e.Uint16=5]="Uint16",e[e.Uint32=6]="Uint32",(t=n.FloatDataType||(n.FloatDataType={}))[t.Float32=32]="Float32",t[t.Float64=33]="Float64",n.getDataType=function(r){let i;return i=r instanceof Int8Array?n.IntDataType.Int8:r instanceof Int16Array?n.IntDataType.Int16:r instanceof Int32Array?n.IntDataType.Int32:r instanceof Uint8Array?n.IntDataType.Uint8:r instanceof Uint16Array?n.IntDataType.Uint16:r instanceof Uint32Array?n.IntDataType.Uint32:r instanceof Float32Array?n.FloatDataType.Float32:r instanceof Float64Array?n.FloatDataType.Float64:n.IntDataType.Int32,i},n.isSignedIntegerDataType=function(r){if(r instanceof Int8Array||r instanceof Int16Array||r instanceof Int32Array)return!0;for(let i=0,o=r.length;i<o;i++)if(i<0)return!1;return!0}}(Gt||(Gt={}));const QX=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function Tp(n){let e=n.data;for(let t=n.encoding.length-1;t>=0;t--)e=eY(e,n.encoding[t]);return e}function eY(n,e){switch(e.kind){case"ByteArray":switch(e.type){case Gt.IntDataType.Uint8:return n;case Gt.IntDataType.Int8:return function(t){return new Int8Array(t.buffer,t.byteOffset)}(n);case Gt.IntDataType.Int16:return function(t){return Gl(t,2,Int16Array)}(n);case Gt.IntDataType.Uint16:return function(t){return Gl(t,2,Uint16Array)}(n);case Gt.IntDataType.Int32:return function(t){return Gl(t,4,Int32Array)}(n);case Gt.IntDataType.Uint32:return function(t){return Gl(t,4,Uint32Array)}(n);case Gt.FloatDataType.Float32:return function(t){return Gl(t,4,Float32Array)}(n);case Gt.FloatDataType.Float64:return function(t){return Gl(t,8,Float64Array)}(n);default:Ap(e.type)}case"FixedPoint":return function(t,r){const i=t.length,o=aC(r.srcType,i),s=1/r.factor;for(let a=0;a<i;a++)o[a]=s*t[a];return o}(n,e);case"IntervalQuantization":return function(t,r){const i=t.length,o=aC(r.srcType,i),s=(r.max-r.min)/(r.numSteps-1),a=r.min;for(let l=0;l<i;l++)o[l]=a+s*t[l];return o}(n,e);case"RunLength":return function(t,r){const i=sC(r.srcType,r.srcSize);let o=0;for(let s=0,a=t.length;s<a;s+=2){const l=t[s],c=t[s+1];for(let u=0;u<c;++u)i[o++]=l}return i}(n,e);case"Delta":return function(t,r){const i=t.length,o=sC(r.srcType,i);if(!i)return t;o[0]=t[0]+(0|r.origin);for(let s=1;s<i;++s)o[s]=t[s]+o[s-1];return o}(n,e);case"IntegerPacking":return function(t,r){return t.length===r.srcSize?t:r.isUnsigned?function(i,o){const s=o.byteCount===1?255:65535,a=i.length,l=new Int32Array(o.srcSize);let c=0,u=0;for(;c<a;){let d=0,h=i[c];for(;h===s;)d+=h,c++,h=i[c];d+=h,l[u]=d,c++,u++}return l}(t,r):function(i,o){const s=o.byteCount===1?127:32767,a=-s-1,l=i.length,c=new Int32Array(o.srcSize);let u=0,d=0;for(;u<l;){let h=0,m=i[u];for(;m===s||m===a;)h+=m,u++,m=i[u];h+=m,c[d]=h,u++,d++}return c}(t,r)}(n,e);case"StringArray":return function(t,r){const i=Tp({encoding:r.offsetEncoding,data:r.offsets}),o=Tp({encoding:r.dataEncoding,data:t}),s=r.stringData,a=new Array(i.length);a[0]="";for(let u=1,d=i.length;u<d;u++)a[u]=s.substring(i[u-1],i[u]);let l=0;const c=new Array(o.length);for(let u=0,d=o.length;u<d;u++)c[l++]=a[o[u]+1];return c}(n,e)}}function sC(n,e){switch(n){case Gt.IntDataType.Int8:return new Int8Array(e);case Gt.IntDataType.Int16:return new Int16Array(e);case Gt.IntDataType.Int32:return new Int32Array(e);case Gt.IntDataType.Uint8:return new Uint8Array(e);case Gt.IntDataType.Uint16:return new Uint16Array(e);case Gt.IntDataType.Uint32:return new Uint32Array(e);default:return new Int32Array(e)}}function aC(n,e){switch(n){case Gt.FloatDataType.Float32:return new Float32Array(e);case Gt.FloatDataType.Float64:default:return new Float64Array(e)}}function Gl(n,e,t){return new t(QX?n.buffer:function(r,i){const o=new ArrayBuffer(r.length),s=new Uint8Array(o);for(let a=0,l=r.length;a<l;a+=i)for(let c=0;c<i;c++)s[a+i-c-1]=r[a+c];return o}(n,e))}var nc,Iu,lC,cC,Zt;function tY(n,e,t){let r,i=1;for(r=0;r<e;r++){const o=i*n;if(Math.abs(Math.round(o)-o)<=t)return r;i*=10}return-1}function uC(n){return Iu.classify(n)}(function(n){function e(r){const i=r.growBy*r.elementSize;r.currentSize=i,r.currentIndex=0,r.currentChunk=new r.ctor(i),r.allocatedSize+=i,r.chunks[r.chunks.length]=r.currentChunk}function t(r,i){const{ctor:o,chunks:s,currentIndex:a}=r;if(!s.length)return new o(0);if(s.length===1&&(i||a===r.allocatedSize))return s[0];let l=0;for(let h=0,m=s.length-1;h<m;h++)l+=s[h].length;l+=r.currentIndex;const c=new o(l);let u=0;if(c.buffer)for(let h=0,m=s.length-1;h<m;h++)c.set(s[h],u),u+=s[h].length;else for(let h=0,m=s.length-1;h<m;h++){const f=s[h];for(let v=0,g=f.length;v<g;v++)c[u+v]=f[v];u+=f.length}const d=s[s.length-1];if(c.buffer&&a>=r.currentSize)c.set(d,u);else for(let h=0,m=d.length;h<m;h++)c[u+h]=d[h];return c}n.is=function(r){return r.creator&&r.chunkSize},n.add4=function(r,i,o,s,a){r.currentIndex>=r.currentSize&&e(r);const l=r.currentChunk,c=r.currentIndex;return l[c]=i,l[c+1]=o,l[c+2]=s,l[c+3]=a,r.currentIndex+=4,r.elementCount++},n.add3=function(r,i,o,s){r.currentIndex>=r.currentSize&&e(r);const a=r.currentChunk,l=r.currentIndex;return a[l]=i,a[l+1]=o,a[l+2]=s,r.currentIndex+=3,r.elementCount++},n.add2=function(r,i,o){r.currentIndex>=r.currentSize&&e(r);const s=r.currentChunk,a=r.currentIndex;return s[a]=i,s[a+1]=o,r.currentIndex+=2,r.elementCount++},n.add=function(r,i){return r.currentIndex>=r.currentSize&&e(r),r.currentChunk[r.currentIndex]=i,r.currentIndex+=1,r.elementCount++},n.addRepeat=function(r,i,o){for(let s=0;s<i;s++)r.currentIndex>=r.currentSize&&e(r),r.currentChunk[r.currentIndex++]=o,r.elementCount++;return r.elementCount},n.addMany=function(r,i){const{elementSize:o}=r;for(let s=0,a=i.length;s<a;s+=o){r.currentIndex>=r.currentSize&&e(r);const{currentChunk:l}=r;for(let c=0;c<o;c++)l[r.currentIndex++]=i[s+c];r.elementCount++}return r.elementCount},n.compact=function(r,i=!1){return t(r,i)},n._compact=t,n.create=function(r,i,o,s){const a={ctor:r,elementSize:i,growBy:Math.max(1,Math.ceil(o)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(s===void 0)return a;if(typeof s=="number")return a.currentChunk=new r(s*i),a.allocatedSize=s*i,a.currentSize=a.currentChunk.length,a.chunks[0]=a.currentChunk,a;const l=s;if(l.length%i!=0)throw new Error("initialChunk length must be a multiple of the element size.");return a.currentChunk=l,a.allocatedSize=l.length,a.currentSize=l.length,a.chunks[0]=l,a}})(nc||(nc={})),function(n){function e(u,d){return u>=0?Math.ceil((u+1)/d):Math.ceil((u+1)/(-d-1))}function t({limit8:u,limit16:d},h,m){h.pack8+=e(m,u),h.pack16+=e(m,d),h.count+=1}function r(u,d){u.pack8+=e(d,127),u.pack16+=e(d,32767),u.count+=1}function i(u){return 4*u.count<2*u.pack16?{length:4*u.count,elem:4}:2*u.pack16<u.pack8?{length:2*u.pack16,elem:2}:{length:u.pack8,elem:1}}function o(u,d){const h={pack8:0,pack16:0,count:0};for(let m=0,f=u.length;m<f;m++)t(d,h,u[m]);return{...i(h),kind:"pack"}}function s(u,d){const h={pack8:0,pack16:0,count:0};let m=u[0];for(let f=1,v=u.length;f<v;f++)r(h,u[f]-m),m=u[f];return{...i(h),kind:"delta"}}function a(u,d){const h={pack8:0,pack16:0,count:0};let m=1;for(let f=1,v=u.length;f<v;f++)u[f-1]!==u[f]?(t(d,h,u[f-1]),t(d,h,m),m=1):m++;return t(d,h,u[u.length-1]),t(d,h,m),{...i(h),kind:"rle"}}function l(u,d){const h={pack8:0,pack16:0,count:0};let m=1,f=0,v=0;for(let g=1,b=u.length;g<b;g++){const S=u[g]-f;v!==S?(r(h,v),r(h,m),m=1):m++,v=S,f=u[g]}return r(h,v),r(h,m),{...i(h),kind:"delta-rle"}}function c(u){const d=function(m){let f=!1;for(let v=0,g=m.length;v<g;v++)if(m[v]<0){f=!0;break}return f?{signed:f,limit8:127,limit16:32767}:{signed:f,limit8:255,limit16:65535}}(u),h=[o(u,d),a(u,d),s(u),l(u)];return h.sort((m,f)=>m.length-f.length),h}n.getSize=c,n.classify=function(u){if(u.length<2)return Zt.by(Zt.byteArray);switch(c(u)[0].kind){case"pack":return Zt.by(Zt.integerPacking);case"rle":return Zt.by(Zt.runLength).and(Zt.integerPacking);case"delta":return Zt.by(Zt.delta).and(Zt.integerPacking);case"delta-rle":return Zt.by(Zt.delta).and(Zt.runLength).and(Zt.integerPacking);default:Ap()}}}(Iu||(Iu={})),function(n){n.classify=function(e){const{mantissaDigits:t,integerDigits:r}=function(l,c,u){let d=1,h=0;for(let m=0,f=l.length;m<f;m++){if(d>=0){const g=tY(l[m],c,u);g<0?d=-1:g>d&&(d=g)}const v=Math.abs(l[m]);if(v>u){const g=Math.floor(Math.log10(Math.abs(v)))+1;g>h&&(h=g)}}return{mantissaDigits:d,integerDigits:h}}(e,4,1e-6);if(t<0||t+r>10)return Zt.by(Zt.byteArray);if(t===0)return Iu.classify(e);const i=function(l){let c=1;for(let u=0;u<l;u++)c*=10;return c}(t),o=new Int32Array(e.length);for(let l=0,c=e.length;l<c;l++)o[l]=Math.round(i*e[l]);const s=Iu.getSize(o)[0],a=Zt.by(Zt.fixedPoint(i));switch(s.kind){case"pack":return a.and(Zt.integerPacking);case"rle":return a.and(Zt.runLength).and(Zt.integerPacking);case"delta":return a.and(Zt.delta).and(Zt.integerPacking);case"delta-rle":return a.and(Zt.delta).and(Zt.runLength).and(Zt.integerPacking);default:Ap()}}}(lC||(lC={}));class Ep{and(e){return new Ep(this.providers.concat([e]))}encode(e){const t=[];for(const r of this.providers){const i=r(e);if(!i.encodings.length)throw new Error("Encodings must be non-empty.");e=i.data;for(const o of i.encodings)t.push(o)}if(!(e instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:t,data:e}}constructor(e){this.providers=e}}(function(n){function e(r){return new Ep([r])}function t(r){switch(r.kind){case"ByteArray":return Zt.byteArray;case"FixedPoint":return Zt.fixedPoint(r.factor);case"IntervalQuantization":return Zt.intervalQuantizaiton(r.min,r.max,r.numSteps);case"RunLength":return Zt.runLength;case"Delta":return Zt.delta;case"IntegerPacking":return Zt.integerPacking;case"StringArray":return Zt.stringArray}}n.by=e,n.fromEncoding=function(r){let i=e(t(r[0]));for(let o=1;o<r.length&&r[o-1].kind!=="IntegerPacking";o++)i=i.and(t(r[o]));return i}})(cC||(cC={})),function(n){n.by=function(s){return new Ep([s])};const e={[Gt.IntDataType.Int16]:function(s,a,l){s.setInt16(2*a,l,!0)},[Gt.IntDataType.Uint16]:function(s,a,l){s.setUint16(2*a,l,!0)},[Gt.IntDataType.Int32]:function(s,a,l){s.setInt32(4*a,l,!0)},[Gt.IntDataType.Uint32]:function(s,a,l){s.setUint32(4*a,l,!0)},[Gt.FloatDataType.Float32]:function(s,a,l){s.setFloat32(4*a,l,!0)},[Gt.FloatDataType.Float64]:function(s,a,l){s.setFloat64(8*a,l,!0)}},t={[Gt.IntDataType.Int16]:2,[Gt.IntDataType.Uint16]:2,[Gt.IntDataType.Int32]:4,[Gt.IntDataType.Uint32]:4,[Gt.FloatDataType.Float32]:4,[Gt.FloatDataType.Float64]:8};function r(s){const a=Gt.getDataType(s);if(a===Gt.IntDataType.Int8)return function(d){return{encodings:[{kind:"ByteArray",type:Gt.IntDataType.Int8}],data:new Uint8Array(d.buffer,d.byteOffset)}}(s);if(a===Gt.IntDataType.Uint8)return function(d){return{encodings:[{kind:"ByteArray",type:Gt.IntDataType.Uint8}],data:d}}(s);const l=new Uint8Array(s.length*t[a]),c=e[a],u=new DataView(l.buffer);for(let d=0,h=s.length;d<h;d++)c(u,d,s[d]);return{encodings:[{kind:"ByteArray",type:a}],data:l}}function i(s,a){let l=0;for(let c=0,u=s.length;c<u;c++)l+=s[c]/a|0;return l+=s.length,l}function o(s,a){const l=-a-1;let c=0;for(let u=0,d=s.length;u<d;u++){const h=s[u];c+=h>=0?h/a|0:h/l|0}return c+=s.length,c}n.byteArray=r,n.fixedPoint=function(s){return a=>function(l,c){const u=Gt.getDataType(l),d=new Int32Array(l.length);for(let h=0,m=l.length;h<m;h++)d[h]=Math.round(l[h]*c);return{encodings:[{kind:"FixedPoint",factor:c,srcType:u}],data:d}}(a,s)},n.intervalQuantizaiton=function(s,a,l,c=Int32Array){return u=>function(d,h,m,f,v){const g=Gt.getDataType(d);if(!d.length)return{encodings:[{kind:"IntervalQuantization",min:h,max:m,numSteps:f,srcType:g}],data:new Int32Array(0)};if(m<h){const p=h;h=m,m=p}const b=(m-h)/(f-1),S=new v(d.length);for(let p=0,y=d.length;p<y;p++){const w=d[p];S[p]=w<=h?0:w>=m?f-1:0|Math.round((w-h)/b)}return{encodings:[{kind:"IntervalQuantization",min:h,max:m,numSteps:f,srcType:g}],data:S}}(u,s,a,l,c)},n.runLength=function(s){let a=Gt.getDataType(s);if(a===void 0&&(s=new Int32Array(s),a=Gt.IntDataType.Int32),!s.length)return{encodings:[{kind:"RunLength",srcType:a,srcSize:0}],data:new Int32Array(0)};let l=2;for(let h=1,m=s.length;h<m;h++)s[h-1]!==s[h]&&(l+=2);const c=new Int32Array(l);let u=0,d=1;for(let h=1,m=s.length;h<m;h++)s[h-1]!==s[h]?(c[u]=s[h-1],c[u+1]=d,d=1,u+=2):++d;return c[u]=s[s.length-1],c[u+1]=d,{encodings:[{kind:"RunLength",srcType:a,srcSize:s.length}],data:c}},n.delta=function(s){if(!Gt.isSignedIntegerDataType(s))throw new Error("Only signed integer types can be encoded using delta encoding.");let a=Gt.getDataType(s);if(a===void 0&&(s=new Int32Array(s),a=Gt.IntDataType.Int32),!s.length)return{encodings:[{kind:"Delta",origin:0,srcType:a}],data:new s.constructor(0)};const l=new s.constructor(s.length),c=s[0];l[0]=s[0];for(let u=1,d=s.length;u<d;u++)l[u]=s[u]-s[u-1];return l[0]=0,{encodings:[{kind:"Delta",origin:c,srcType:a}],data:l}},n.integerPacking=function(s){const a=function(l){const c=function(h){for(let m=0,f=h.length;m<f;m++)if(h[m]<0)return!0;return!1}(l),u=c?o(l,127):i(l,255),d=c?o(l,32767):i(l,65535);return 4*l.length<2*d?{isSigned:c,size:l.length,bytesPerElement:4}:2*d<u?{isSigned:c,size:d,bytesPerElement:2}:{isSigned:c,size:u,bytesPerElement:1}}(s);return a.bytesPerElement===4?r(s):function(l,c){const u=c.isSigned?c.bytesPerElement===1?127:32767:c.bytesPerElement===1?255:65535,d=-u-1,h=l.length,m=c.isSigned?c.bytesPerElement===1?new Int8Array(c.size):new Int16Array(c.size):c.bytesPerElement===1?new Uint8Array(c.size):new Uint16Array(c.size);let f=0;for(let g=0;g<h;g++){let b=l[g];if(b>=0)for(;b>=u;)m[f]=u,++f,b-=u;else for(;b<=d;)m[f]=d,++f,b-=d;m[f]=b,++f}const v=r(m);return{encodings:[{kind:"IntegerPacking",byteCount:c.bytesPerElement,isUnsigned:!c.isSigned,srcSize:h},v.encodings[0]],data:v.data}}(s,a)},n.stringArray=function(s){const a=Object.create(null),l=[],c=new Int32Array(s.length),u=nc.create(Int32Array,1,Math.min(1024,s.length<32?s.length+1:Math.round(s.length/8)+1));nc.add(u,0);let d=0,h=0;for(const g of s){if(g==null){c[h++]=-1;continue}let b=a[g];b===void 0&&(d+=g.length,b=l.length,l[b]=g,a[g]=b,nc.add(u,d)),c[h++]=b}const m=nc.compact(u),f=uC(m).encode(m),v=uC(c).encode(c);return{encodings:[{kind:"StringArray",dataEncoding:v.encoding,stringData:l.join(""),offsetEncoding:f.encoding,offsets:f.data}],data:v.data}}}(Zt||(Zt={}));const nY=function(){const n=[];for(let e=0;e<1024;e++)n[e]=String.fromCharCode(e);return n}();function rY(n){throw new Error(n)}const dC=typeof TextDecoder<"u"?new TextDecoder:void 0;function iY(n,e,t){if(dC){const r=e||t!==n.length?n.subarray(e,e+t):n;return dC.decode(r)}return function(r,i,o){const s=nY;let a,l=0;const c=[];for(let u=i,d=i+o;u<d;u++){const h=r[u];128&h?(224&h)==192?c[l++]=s[(15&h)<<6|63&r[++u]]:(240&h)==224?c[l++]=String.fromCharCode((15&h)<<12|(63&r[++u])<<6|63&r[++u]):(248&h)==240?c[l++]=String.fromCharCode((7&h)<<18|(63&r[++u])<<12|(63&r[++u])<<6|63&r[++u]):rY("Invalid byte "+h.toString(16)):c[l++]=s[h],l===512&&(a=a||[],a[a.length]=c.join(""),l=0)}return a?(l>0&&(a[a.length]=c.slice(0,l).join("")),a.join("")):c.slice(0,l).join("")}(n,e,t)}function N0(n,e){const t={};for(let r=0;r<e;r++)t[Pp(n)]=Pp(n);return t}function z0(n,e){const t=new Uint8Array(e),r=n.offset;for(let i=0;i<e;i++)t[i]=n.buffer[i+r];return n.offset+=e,t}function rf(n,e){const t=iY(n.buffer,n.offset,e);return n.offset+=e,t}function U0(n,e){const t=new Array(e);for(let r=0;r<e;r++)t[r]=Pp(n);return t}function Pp(n){const e=n.buffer[n.offset];let t,r;if(!(128&e))return n.offset++,e;if((240&e)==128)return r=15&e,n.offset++,N0(n,r);if((240&e)==144)return r=15&e,n.offset++,U0(n,r);if((224&e)==160)return r=31&e,n.offset++,rf(n,r);if(!(224&~e))return t=n.dataView.getInt8(n.offset),n.offset++,t;switch(e){case 192:return n.offset++,null;case 194:return n.offset++,!1;case 195:return n.offset++,!0;case 196:return r=n.dataView.getUint8(n.offset+1),n.offset+=2,z0(n,r);case 197:return r=n.dataView.getUint16(n.offset+1),n.offset+=3,z0(n,r);case 198:return r=n.dataView.getUint32(n.offset+1),n.offset+=5,z0(n,r);case 202:return t=n.dataView.getFloat32(n.offset+1),n.offset+=5,t;case 203:return t=n.dataView.getFloat64(n.offset+1),n.offset+=9,t;case 204:return t=n.buffer[n.offset+1],n.offset+=2,t;case 205:return t=n.dataView.getUint16(n.offset+1),n.offset+=3,t;case 206:return t=n.dataView.getUint32(n.offset+1),n.offset+=5,t;case 208:return t=n.dataView.getInt8(n.offset+1),n.offset+=2,t;case 209:return t=n.dataView.getInt16(n.offset+1),n.offset+=3,t;case 210:return t=n.dataView.getInt32(n.offset+1),n.offset+=5,t;case 217:return r=n.dataView.getUint8(n.offset+1),n.offset+=2,rf(n,r);case 218:return r=n.dataView.getUint16(n.offset+1),n.offset+=3,rf(n,r);case 219:return r=n.dataView.getUint32(n.offset+1),n.offset+=5,rf(n,r);case 220:return r=n.dataView.getUint16(n.offset+1),n.offset+=3,U0(n,r);case 221:return r=n.dataView.getUint32(n.offset+1),n.offset+=5,U0(n,r);case 222:return r=n.dataView.getUint16(n.offset+1),n.offset+=3,N0(n,r);case 223:return r=n.dataView.getUint32(n.offset+1),n.offset+=5,N0(n,r)}throw new Error("Unknown type 0x"+e.toString(16))}function oY(n){const e=Object.create(null),t=Object.create(null);for(const r of n.columns)e[r.name]=r;return{rowCount:n.rowCount,name:n.name.substr(1),fieldNames:n.columns.map(r=>r.name),getField(r){const i=e[r];if(i)return t[r]||(t[r]=function(o){const s=o.mask?Tp(o.mask):void 0,a=Tp(o.data),l=my(a),c=l?s?f=>s[f]===0?""+a[f]:"":f=>""+a[f]:s?f=>s[f]===0?a[f]:"":f=>a[f],u=l?f=>a[f]:f=>{const v=a[f];return pc(v,0,v.length)},d=l?f=>a[f]:f=>{const v=a[f];return Yu(v,0,v.length)},h=s?f=>s[f]:f=>0,m=a.length;return{__array:a,binaryEncoding:o.data.encoding,isDefined:!0,rowCount:m,str:c,int:u,float:d,valueKind:h,areValuesEqual:(f,v)=>a[f]===a[v],toStringArray:f=>wr(m,c,f),toIntArray:l?f=>Cp(a,f):f=>wr(m,u,f),toFloatArray:l?f=>Cp(a,f):f=>wr(m,d,f)}}(i)),t[r]}}}function hC(n){return al.create("Parse BinaryCIF",async e=>{const t=[0,3];try{const i=Pp({buffer:r=n,offset:0,dataView:new DataView(r.buffer)});if(!function(s,a){for(let l=0;l<2;l++)if(s[l]>a[l])return!1;return!0}(t,i.version.match(/(\d)\.(\d)\.\d/).slice(1).map(s=>+s)))return Ya.error(`Unsupported format version. Current ${i.version}, required ${t.join(".")}.`);const o=VP(i.dataBlocks.map(s=>{const a=Object.create(null);for(const l of s.categories)a[l.name.substr(1)]=oY(l);return gy(s.categories.map(l=>l.name.substr(1)),a,s.header)}));return Ya.success(o)}catch(i){return Ya.error(""+i)}var r})}var gc;function zo(n,e,t){return function(r,i,o){const s=Object.create(null);for(const a of Object.keys(r))s[a]=dY(a,r[a],i,o);return Av.ofTables(i.header,r,s)}(n,e,t)}function sY(n){switch(n.valueType){case"str":return(e,t,r)=>function(i,o,s,a){return{schema:i,__array:o.__array,isDefined:o.isDefined,rowCount:o.rowCount,value:i.transform==="lowercase"?l=>s(l).toLowerCase():i.transform==="uppercase"?l=>s(l).toUpperCase():s,valueKind:o.valueKind,areValuesEqual:o.areValuesEqual,toArray:i.transform==="lowercase"?l=>Array.from(a(l)).map(c=>c.toLowerCase()):i.transform==="uppercase"?l=>Array.from(a(l)).map(c=>c.toUpperCase()):a}}(n,e,e.str,e.toStringArray);case"int":return(e,t,r)=>fC(n,e,e.int,e.toIntArray);case"float":return(e,t,r)=>fC(n,e,e.float,e.toFloatArray);case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function fC(n,e,t,r){return{schema:n,__array:e.__array,isDefined:e.isDefined,rowCount:e.rowCount,value:t,valueKind:e.valueKind,areValuesEqual:e.areValuesEqual,toArray:r}}function aY(n,e,t){const r=n.separator,i=n.itemParse,o=e.getField(t),s=o?a=>o.str(a).split(r).map(l=>i(l.trim())).filter(l=>!!l):a=>[];return{schema:n,__array:void 0,isDefined:!!o,rowCount:e.rowCount,value:s,valueKind:o?o.valueKind:()=>1,areValuesEqual:(a,l)=>function(c,u){const d=c.length;if(d!==u.length)return!1;for(let h=0;h<d;h++)if(c[h]!==u[h])return!1;return!0}(s(a),s(l)),toArray:a=>wr(e.rowCount,s,a)}}function lY(n,e,t){const r=n.space,i=e.fieldNames.includes(`${t}[0]`)||e.fieldNames.includes(`${t}[0][0]`)||e.fieldNames.includes(`${t}[0][0][0]`),o=i?0:1,s=e.fieldNames.includes(`${t}_1`)||e.fieldNames.includes(`${t}_11`)||e.fieldNames.includes(`${t}_111`)?"underscore":"brackets",a=function(u,d,h,m){const f=h?0:1;switch(d){case 1:return m==="brackets"?v=>`${u}[${v+f}]`:v=>`${u}_${v+f}`;case 2:return m==="brackets"?(v,g)=>`${u}[${v+f}][${g+f}]`:(v,g)=>`${u}_${v+f}${g+f}`;case 3:return m==="brackets"?(v,g,b)=>`${u}[${v+f}][${g+f}][${b+f}]`:(v,g,b)=>`${u}_${v+f}${g+f}${b+f}`;default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}(t,r.rank,i,s),l=e.getField(a(o,o,o))||An.Undefined(e.rowCount,n),c=u=>function(d,h,m,f){const v=h.create();if(h.rank===1){const g=h.dimensions[0];for(let b=0;b<g;b++){const S=d.getField(f(b));h.set(v,b,S?S.float(m):0)}}else if(h.rank===2){const g=h.dimensions[0],b=h.dimensions[1];for(let S=0;S<g;S++)for(let p=0;p<b;p++){const y=d.getField(f(S,p));h.set(v,S,p,y?y.float(m):0)}}else{if(h.rank!==3)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");{const g=h.dimensions[0],b=h.dimensions[1],S=h.dimensions[2];for(let p=0;p<g;p++)for(let y=0;y<b;y++)for(let w=0;w<S;w++){const x=d.getField(f(p,y,w));h.set(v,p,y,w,x?x.float(m):0)}}}return v}(e,r,u,a);return{schema:n,__array:void 0,isDefined:l.isDefined,rowCount:e.rowCount,value:c,valueKind:l.valueKind,areValuesEqual:(u,d)=>Pu.areEqualExact(c(u),c(d)),toArray:u=>wr(e.rowCount,c,u)}}(function(n){function e(t){return t.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}n.canonical=e,n.equal=function(t,r){return e(t)===e(r)},n.create=function(t,r,i=!1){const o=`${t}${r?`.${r}`:""}`;return i?e(o):o}})(gc||(gc={}));class cY{constructor(e,t,r){this._isDefined=r;const i=Object.keys(t);this._rowCount=e.rowCount,this._columns=i,this._schema=t;const o=Object.create(null);for(const s of i)Object.defineProperty(this,s,{get:function(){if(o[s])return o[s];const a=t[s];if(a.valueType==="list")o[s]=aY(a,e,s);else if(a.valueType==="tensor")o[s]=lY(a,e,s);else{const l=sY(a),c=e.getField(s);o[s]=c?l(c,e,s):An.Undefined(e.rowCount,a)}return o[s]},enumerable:!0,configurable:!1})}}function uY(n,e,t,r){const i=gc.create(e,n),o=gc.canonical(i);if(o in t)return t[o];if(r&&i in r)for(const s of r[i]){const a=gc.canonical(s);if(a in t)return t[a]}}function dY(n,e,t,r){let i=t.categories[n];if(r){const o=function(c){const u=Object.create(null);for(const d of Object.keys(c.categories))for(const h of c.categories[d].fieldNames)u[gc.create(d,h,!0)]=c.categories[d].getField(h);return u}(t),s=Object.create(null),a=[];let l=0;for(const c of Object.keys(e)){const u=uY(c,n,o,r);u&&(s[c]=u,a.push(c),l=u.rowCount)}i={rowCount:l,name:n,fieldNames:[...a],getField:c=>s[c]}}return new cY(i||Mp.empty(n),e,!!i)}var us=An.Schema;const V=us.str,Te=us.int,Et=us.float,$0=us.coord,st=us.Aliased,Cs=us.Matrix,of=us.Vector,Kt=us.lstr,Ma=us.List,hY={atom_site:{auth_asym_id:V,auth_atom_id:V,auth_comp_id:V,auth_seq_id:Te,B_iso_or_equiv:Et,Cartn_x:$0,Cartn_y:$0,Cartn_z:$0,group_PDB:st(V),id:Te,label_alt_id:V,label_asym_id:V,label_atom_id:V,label_comp_id:V,label_entity_id:V,label_seq_id:Te,occupancy:Et,type_symbol:V,pdbx_PDB_ins_code:V,pdbx_PDB_model_num:Te,pdbx_formal_charge:Te,pdbx_label_index:Te,pdbx_sifts_xref_db_name:V,pdbx_sifts_xref_db_acc:V,pdbx_sifts_xref_db_num:V,pdbx_sifts_xref_db_res:V,ihm_model_id:Te},atom_site_anisotrop:{id:Te,type_symbol:V,U:Cs(3,3),U_esd:Cs(3,3),pdbx_auth_seq_id:V,pdbx_auth_asym_id:V,pdbx_auth_atom_id:V,pdbx_auth_comp_id:V,pdbx_label_seq_id:Te,pdbx_label_alt_id:V,pdbx_label_asym_id:V,pdbx_label_atom_id:V,pdbx_label_comp_id:V,pdbx_PDB_ins_code:V},atom_sites:{entry_id:V,fract_transf_matrix:Cs(3,3),fract_transf_vector:of(3)},audit_author:{name:V,pdbx_ordinal:Te,identifier_ORCID:V},audit_conform:{dict_location:V,dict_name:V,dict_version:V},cell:{angle_alpha:Et,angle_beta:Et,angle_gamma:Et,entry_id:V,length_a:Et,length_b:Et,length_c:Et,Z_PDB:Te,pdbx_unique_axis:V},chem_comp:{formula:V,formula_weight:Et,id:V,mon_nstd_flag:st(Kt),name:V,type:st(Kt),pdbx_synonyms:Ma(";",n=>n)},chem_comp_bond:{atom_id_1:V,atom_id_2:V,comp_id:V,value_order:st(Kt),pdbx_ordinal:Te,pdbx_stereo_config:st(Kt),pdbx_aromatic_flag:st(Kt)},citation:{book_publisher:V,country:V,id:V,journal_abbrev:V,journal_id_ASTM:V,journal_id_CSD:V,journal_id_ISSN:V,journal_volume:V,page_first:V,page_last:V,title:V,year:Te,pdbx_database_id_DOI:V,pdbx_database_id_PubMed:Te},citation_author:{citation_id:V,name:V,ordinal:Te},database_2:{database_id:st(Kt),database_code:V},entity:{details:V,formula_weight:Et,id:V,src_method:st(Kt),type:st(Kt),pdbx_description:Ma(",",n=>n),pdbx_number_of_molecules:Te,pdbx_mutation:V,pdbx_fragment:V,pdbx_ec:Ma(",",n=>n)},entity_poly:{entity_id:V,nstd_linkage:st(Kt),nstd_monomer:st(Kt),type:st(V),pdbx_strand_id:Ma(",",n=>n),pdbx_seq_one_letter_code:V,pdbx_seq_one_letter_code_can:V,pdbx_target_identifier:V},entity_poly_seq:{entity_id:V,hetero:st(Kt),mon_id:V,num:Te},entry:{id:V},exptl:{entry_id:V,method:st(V)},software:{classification:V,date:V,description:V,name:V,type:st(Kt),version:V,pdbx_ordinal:Te},struct:{entry_id:V,title:V,pdbx_descriptor:V},struct_asym:{details:V,entity_id:V,id:V,pdbx_modified:V,pdbx_blank_PDB_chainid_flag:st(V)},struct_conf:{beg_label_asym_id:V,beg_label_comp_id:V,beg_label_seq_id:Te,beg_auth_asym_id:V,beg_auth_comp_id:V,beg_auth_seq_id:Te,conf_type_id:st(Kt),details:V,end_label_asym_id:V,end_label_comp_id:V,end_label_seq_id:Te,end_auth_asym_id:V,end_auth_comp_id:V,end_auth_seq_id:Te,id:V,pdbx_beg_PDB_ins_code:V,pdbx_end_PDB_ins_code:V,pdbx_PDB_helix_class:V,pdbx_PDB_helix_length:Te,pdbx_PDB_helix_id:V},struct_conn:{conn_type_id:st(Kt),details:V,id:V,ptnr1_label_asym_id:V,ptnr1_label_atom_id:V,ptnr1_label_comp_id:V,ptnr1_label_seq_id:Te,ptnr1_auth_asym_id:V,ptnr1_auth_comp_id:V,ptnr1_auth_seq_id:Te,ptnr1_symmetry:V,ptnr2_label_asym_id:V,ptnr2_label_atom_id:V,ptnr2_label_comp_id:V,ptnr2_label_seq_id:Te,ptnr2_auth_asym_id:V,ptnr2_auth_comp_id:V,ptnr2_auth_seq_id:Te,ptnr2_symmetry:V,pdbx_ptnr1_PDB_ins_code:V,pdbx_ptnr1_label_alt_id:V,pdbx_ptnr1_standard_comp_id:V,pdbx_ptnr2_PDB_ins_code:V,pdbx_ptnr2_label_alt_id:V,pdbx_ptnr3_PDB_ins_code:V,pdbx_ptnr3_label_alt_id:V,pdbx_ptnr3_label_asym_id:V,pdbx_ptnr3_label_atom_id:V,pdbx_ptnr3_label_comp_id:V,pdbx_ptnr3_label_seq_id:Te,pdbx_PDB_id:V,pdbx_dist_value:Et,pdbx_value_order:st(Kt)},struct_conn_type:{criteria:V,id:st(Kt),reference:V},struct_keywords:{entry_id:V,text:Ma(",",n=>n),pdbx_keywords:V},struct_ncs_oper:{code:st(V),details:V,id:Te,matrix:Cs(3,3),vector:of(3)},struct_sheet_range:{beg_label_asym_id:V,beg_label_comp_id:V,beg_label_seq_id:Te,end_label_asym_id:V,end_label_comp_id:V,end_label_seq_id:Te,beg_auth_asym_id:V,beg_auth_comp_id:V,beg_auth_seq_id:Te,end_auth_asym_id:V,end_auth_comp_id:V,end_auth_seq_id:Te,id:V,sheet_id:V,pdbx_beg_PDB_ins_code:V,pdbx_end_PDB_ins_code:V},struct_site:{details:V,id:V,pdbx_num_residues:Te,pdbx_evidence_code:V,pdbx_auth_asym_id:V,pdbx_auth_comp_id:V,pdbx_auth_seq_id:V,pdbx_auth_ins_code:V},struct_site_gen:{details:V,id:V,label_alt_id:V,label_asym_id:V,label_atom_id:V,label_comp_id:V,label_seq_id:Te,auth_asym_id:V,auth_comp_id:V,auth_seq_id:V,site_id:V,symmetry:V,pdbx_auth_ins_code:V,pdbx_num_res:Te},symmetry:{entry_id:V,cell_setting:st(Kt),Int_Tables_number:Te,space_group_name_Hall:V,"space_group_name_H-M":V},pdbx_database_status:{status_code:st(V),status_code_sf:st(V),status_code_mr:st(V),entry_id:V,recvd_initial_deposition_date:V,SG_entry:st(Kt),deposit_site:st(V),process_site:st(V),status_code_cs:st(V),methods_development_category:st(V),pdb_format_compatible:st(Kt)},pdbx_nonpoly_scheme:{asym_id:V,entity_id:V,mon_id:V,pdb_strand_id:V,ndb_seq_num:V,pdb_seq_num:V,auth_seq_num:V,pdb_mon_id:V,auth_mon_id:V,pdb_ins_code:V},pdbx_database_related:{db_name:V,details:V,db_id:V,content_type:st(V)},pdbx_entity_nonpoly:{entity_id:V,comp_id:V,name:V},pdbx_chem_comp_synonyms:{name:V,comp_id:V,provenance:st(V)},pdbx_chem_comp_identifier:{comp_id:V,identifier:V,type:st(V),program:V,program_version:V},pdbx_unobs_or_zero_occ_residues:{id:Te,polymer_flag:st(Kt),occupancy_flag:st(Te),PDB_model_num:Te,auth_asym_id:V,auth_comp_id:V,auth_seq_id:V,PDB_ins_code:V,label_asym_id:V,label_comp_id:V,label_seq_id:Te},pdbx_struct_mod_residue:{id:Te,auth_asym_id:V,auth_comp_id:V,auth_seq_id:Te,PDB_ins_code:V,label_asym_id:V,label_comp_id:V,label_seq_id:Te,parent_comp_id:V,details:V},pdbx_struct_oper_list:{id:V,type:st(V),name:V,symmetry_operation:V,matrix:Cs(3,3),vector:of(3)},pdbx_struct_assembly:{method_details:V,oligomeric_details:V,oligomeric_count:Te,details:V,id:V},pdbx_struct_assembly_gen:{asym_id_list:Ma(",",n=>n),assembly_id:V,oper_expression:V},pdbx_reference_entity_list:{prd_id:V,ref_entity_id:V,type:st(Kt),details:V,component_id:Te},pdbx_reference_entity_link:{link_id:Te,prd_id:V,details:V,ref_entity_id_1:V,ref_entity_id_2:V,entity_seq_num_1:Te,entity_seq_num_2:Te,comp_id_1:V,comp_id_2:V,atom_id_1:V,atom_id_2:V,value_order:st(Kt),component_1:Te,component_2:Te,link_class:st(V)},pdbx_reference_entity_poly_link:{link_id:Te,prd_id:V,ref_entity_id:V,component_id:Te,entity_seq_num_1:Te,entity_seq_num_2:Te,comp_id_1:V,comp_id_2:V,atom_id_1:V,atom_id_2:V,value_order:st(Kt)},pdbx_molecule:{prd_id:V,instance_id:Te,asym_id:V},pdbx_molecule_features:{prd_id:V,class:st(Kt),type:st(Kt),name:V,details:V},entity_src_nat:{entity_id:V,pdbx_organism_scientific:V,pdbx_plasmid_name:V,pdbx_src_id:Te,pdbx_beg_seq_num:Te,pdbx_end_seq_num:Te},entity_src_gen:{entity_id:V,pdbx_gene_src_gene:Ma(",",n=>n),pdbx_gene_src_scientific_name:V,plasmid_name:V,pdbx_src_id:Te,pdbx_beg_seq_num:Te,pdbx_end_seq_num:Te},pdbx_entity_src_syn:{organism_scientific:V,entity_id:V,pdbx_src_id:Te,pdbx_beg_seq_num:Te,pdbx_end_seq_num:Te},pdbx_entity_branch_descriptor:{entity_id:V,descriptor:V,type:st(Kt),program:V,program_version:V,ordinal:Te},pdbx_entity_instance_feature:{details:V,feature_type:st(V),auth_asym_id:V,asym_id:V,auth_seq_num:V,seq_num:Te,comp_id:V,auth_comp_id:V,ordinal:Te},pdbx_entity_branch_list:{entity_id:V,hetero:st(Kt),comp_id:V,num:Te},pdbx_entity_branch_link:{link_id:Te,details:V,entity_id:V,entity_branch_list_num_1:Te,entity_branch_list_num_2:Te,comp_id_1:V,comp_id_2:V,atom_id_1:V,leaving_atom_id_1:V,atom_stereo_config_1:st(Kt),atom_id_2:V,leaving_atom_id_2:V,atom_stereo_config_2:st(Kt),value_order:st(Kt)},pdbx_entity_branch:{entity_id:V,type:st(V)},pdbx_branch_scheme:{entity_id:V,hetero:st(Kt),asym_id:V,mon_id:V,num:Te,pdb_asym_id:V,pdb_seq_num:V,pdb_mon_id:V,auth_asym_id:V,auth_seq_num:V,auth_mon_id:V},pdbx_chem_comp_related:{comp_id:V,related_comp_id:V,relationship_type:st(V),details:V},ihm_starting_model_details:{starting_model_id:V,entity_id:V,entity_description:V,asym_id:V,entity_poly_segment_id:Te,starting_model_source:st(V),starting_model_auth_asym_id:V,starting_model_sequence_offset:Te,dataset_list_id:Te},ihm_starting_comparative_models:{id:Te,starting_model_id:V,starting_model_auth_asym_id:V,starting_model_seq_id_begin:Te,starting_model_seq_id_end:Te,template_auth_asym_id:V,template_seq_id_begin:Te,template_seq_id_end:Te,template_sequence_identity:Et,template_sequence_identity_denominator:st(Te),template_dataset_list_id:Te,alignment_file_id:Te},ihm_starting_model_seq_dif:{id:Te,entity_id:V,asym_id:V,seq_id:Te,comp_id:V,starting_model_id:V,db_asym_id:V,db_seq_id:Te,db_comp_id:V,details:V},ihm_model_representation:{id:Te,name:V,details:V},ihm_model_representation_details:{id:Te,representation_id:Te,entity_poly_segment_id:Te,entity_id:V,entity_description:V,entity_asym_id:V,model_object_primitive:st(V),starting_model_id:V,model_mode:st(V),model_granularity:st(V),model_object_count:Te},ihm_struct_assembly_details:{id:Te,assembly_id:Te,parent_assembly_id:Te,entity_description:V,entity_id:V,asym_id:V,entity_poly_segment_id:Te},ihm_struct_assembly:{id:Te,name:V,description:V},ihm_modeling_protocol:{id:Te,num_steps:Te,protocol_name:V},ihm_modeling_protocol_details:{id:Te,protocol_id:Te,step_id:Te,struct_assembly_id:Te,dataset_group_id:Te,struct_assembly_description:V,step_name:V,step_method:V,num_models_begin:Te,num_models_end:Te,multi_scale_flag:st(Kt),multi_state_flag:st(Kt),ordered_flag:st(Kt),script_file_id:Te,software_id:Te},ihm_multi_state_modeling:{state_id:Te,state_group_id:Te,population_fraction:Et,population_fraction_sd:Et,state_type:V,state_name:V,experiment_type:st(V),details:V},ihm_modeling_post_process:{id:Te,protocol_id:Te,analysis_id:Te,step_id:Te,type:st(V),feature:st(V),num_models_begin:Te,num_models_end:Te},ihm_ensemble_info:{ensemble_id:Te,ensemble_name:V,post_process_id:Te,model_group_id:Te,ensemble_clustering_method:st(V),ensemble_clustering_feature:st(V),num_ensemble_models:Te,num_ensemble_models_deposited:Te,ensemble_precision_value:Et,ensemble_file_id:Te},ihm_model_list:{model_id:Te,model_name:V,assembly_id:Te,protocol_id:Te,representation_id:Te},ihm_model_group:{id:Te,name:V,details:V},ihm_model_group_link:{model_id:Te,group_id:Te},ihm_model_representative:{id:Te,model_group_id:Te,model_id:Te,selection_criteria:st(V)},ihm_dataset_list:{id:Te,data_type:st(V),database_hosted:st(Kt)},ihm_dataset_group:{id:Te,name:V,application:st(V),details:V},ihm_dataset_group_link:{dataset_list_id:Te,group_id:Te},ihm_related_datasets:{dataset_list_id_derived:Te,dataset_list_id_primary:Te},ihm_dataset_related_db_reference:{id:Te,dataset_list_id:Te,db_name:st(V),accession_code:V,version:V,details:V},ihm_external_reference_info:{reference_id:Te,reference_provider:V,reference_type:st(V),reference:V,refers_to:st(V),associated_url:V},ihm_external_files:{id:Te,reference_id:Te,file_path:V,content_type:st(V),file_size_bytes:Et,details:V},ihm_dataset_external_reference:{id:Te,dataset_list_id:Te,file_id:Te},ihm_localization_density_files:{id:Te,file_id:Te,ensemble_id:Te,entity_id:V,entity_poly_segment_id:Te,asym_id:V},ihm_predicted_contact_restraint:{id:Te,group_id:Te,entity_id_1:V,entity_id_2:V,asym_id_1:V,asym_id_2:V,comp_id_1:V,comp_id_2:V,seq_id_1:Te,seq_id_2:Te,rep_atom_1:st(V),rep_atom_2:st(V),distance_lower_limit:Et,distance_upper_limit:Et,probability:Et,restraint_type:st(V),model_granularity:st(V),dataset_list_id:Te,software_id:Te},ihm_cross_link_list:{id:Te,group_id:Te,entity_description_1:V,entity_description_2:V,entity_id_1:V,entity_id_2:V,comp_id_1:V,comp_id_2:V,seq_id_1:Te,seq_id_2:Te,linker_type:st(V),dataset_list_id:Te},ihm_cross_link_restraint:{id:Te,group_id:Te,entity_id_1:V,entity_id_2:V,asym_id_1:V,asym_id_2:V,comp_id_1:V,comp_id_2:V,seq_id_1:Te,seq_id_2:Te,atom_id_1:V,atom_id_2:V,restraint_type:st(V),conditional_crosslink_flag:st(V),model_granularity:st(V),distance_threshold:Et,psi:Et,sigma_1:Et,sigma_2:Et},ihm_cross_link_result_parameters:{id:Te,restraint_id:Te,model_id:Te,psi:Et,sigma_1:Et,sigma_2:Et},ihm_2dem_class_average_restraint:{id:Te,dataset_list_id:Te,number_raw_micrographs:Te,pixel_size_width:Et,pixel_size_height:Et,image_resolution:Et,image_segment_flag:st(Kt),number_of_projections:Te,struct_assembly_id:Te,details:V},ihm_2dem_class_average_fitting:{id:Te,restraint_id:Te,model_id:Te,cross_correlation_coefficient:Et,rot_matrix:Cs(3,3),tr_vector:of(3)},ihm_3dem_restraint:{id:Te,dataset_list_id:Te,model_id:Te,struct_assembly_id:Te,fitting_method:V,number_of_gaussians:Te,cross_correlation_coefficient:Et},ihm_sas_restraint:{id:Te,dataset_list_id:Te,model_id:Te,struct_assembly_id:Te,profile_segment_flag:st(Kt),fitting_atom_type:V,fitting_method:V,fitting_state:st(V),radius_of_gyration:Et,chi_value:Et,details:V},ihm_starting_model_coord:{ordinal_id:Te,starting_model_id:V,group_PDB:st(V),id:Te,type_symbol:V,entity_id:V,atom_id:V,comp_id:V,seq_id:Te,asym_id:V,Cartn_x:Et,Cartn_y:Et,Cartn_z:Et,B_iso_or_equiv:Et},ihm_sphere_obj_site:{id:Te,entity_id:V,seq_id_begin:Te,seq_id_end:Te,asym_id:V,Cartn_x:Et,Cartn_y:Et,Cartn_z:Et,object_radius:Et,rmsf:Et,model_id:Te},ihm_gaussian_obj_site:{id:Te,entity_id:V,seq_id_begin:Te,seq_id_end:Te,asym_id:V,mean_Cartn_x:Et,mean_Cartn_y:Et,mean_Cartn_z:Et,weight:Et,covariance_matrix:Cs(3,3),model_id:Te},ihm_gaussian_obj_ensemble:{id:Te,entity_id:V,seq_id_begin:Te,seq_id_end:Te,asym_id:V,mean_Cartn_x:Et,mean_Cartn_y:Et,mean_Cartn_z:Et,weight:Et,covariance_matrix:Cs(3,3),ensemble_id:Te},ihm_feature_list:{feature_id:Te,feature_type:st(V),entity_type:st(V)},ihm_poly_residue_feature:{ordinal_id:Te,feature_id:Te,entity_id:V,asym_id:V,comp_id_begin:V,comp_id_end:V,seq_id_begin:Te,seq_id_end:Te},ihm_derived_distance_restraint:{id:Te,group_id:Te,feature_id_1:Te,feature_id_2:Te,group_conditionality:st(V),random_exclusion_fraction:Et,distance_upper_limit:Et,restraint_type:st(V),dataset_list_id:Te},ma_model_list:{ordinal_id:Te,model_id:Te,model_group_id:Te,model_name:V,model_group_name:V,model_type:st(V),data_id:Te},ma_target_entity:{entity_id:V,data_id:Te,origin:st(V)},ma_target_entity_instance:{asym_id:V,entity_id:V,details:V},ma_target_ref_db_details:{target_entity_id:V,db_name:st(V),db_code:V,db_accession:V,seq_db_isoform:V,seq_db_align_begin:V,seq_db_align_end:V,ncbi_taxonomy_id:V,organism_scientific:V},ma_data:{id:Te,content_type:st(V),content_type_other_details:V,name:V},ma_software_group:{ordinal_id:Te,group_id:Te,software_id:Te},ma_qa_metric:{id:Te,name:V,type:st(V),mode:st(V),software_group_id:Te},ma_qa_metric_global:{ordinal_id:Te,model_id:Te,metric_id:Te,metric_value:Et},ma_qa_metric_local:{ordinal_id:Te,model_id:Te,label_asym_id:V,label_seq_id:Te,label_comp_id:V,metric_id:Te,metric_value:Et}};var bl=An.Schema;const nn=bl.str,fY=bl.float,pC=bl.List,ao=bl.lstr,oi=bl.Aliased,gu=bl.int,Wl=bl.coord,pY={chem_comp:{formula:nn,formula_weight:fY,id:nn,mon_nstd_parent_comp_id:pC(",",n=>n),name:nn,one_letter_code:nn,three_letter_code:nn,type:oi(ao),pdbx_synonyms:pC(";",n=>n),pdbx_type:nn,pdbx_ambiguous_flag:nn,pdbx_replaced_by:nn,pdbx_replaces:nn,pdbx_formal_charge:gu,pdbx_model_coordinates_details:nn,pdbx_model_coordinates_db_code:nn,pdbx_ideal_coordinates_details:nn,pdbx_ideal_coordinates_missing_flag:oi(ao),pdbx_model_coordinates_missing_flag:oi(ao),pdbx_initial_date:nn,pdbx_modified_date:nn,pdbx_release_status:oi(nn),pdbx_processing_site:oi(nn)},chem_comp_atom:{alt_atom_id:nn,atom_id:nn,charge:gu,model_Cartn_x:Wl,model_Cartn_y:Wl,model_Cartn_z:Wl,comp_id:nn,type_symbol:nn,pdbx_align:gu,pdbx_ordinal:gu,pdbx_model_Cartn_x_ideal:Wl,pdbx_model_Cartn_y_ideal:Wl,pdbx_model_Cartn_z_ideal:Wl,pdbx_stereo_config:oi(ao),pdbx_aromatic_flag:oi(ao),pdbx_leaving_atom_flag:oi(ao)},chem_comp_bond:{atom_id_1:nn,atom_id_2:nn,comp_id:nn,value_order:oi(ao),pdbx_ordinal:gu,pdbx_stereo_config:oi(ao),pdbx_aromatic_flag:oi(ao)},pdbx_chem_comp_descriptor:{comp_id:nn,descriptor:nn,type:oi(ao),program:nn,program_version:nn},pdbx_chem_comp_identifier:{comp_id:nn,identifier:nn,type:oi(nn),program:nn,program_version:nn}};var Vd=An.Schema;const xt=Vd.str,mY=Vd.float,Uo=Vd.lstr,Rr=Vd.Aliased,yi=Vd.int,gY={pdbx_reference_molecule:{prd_id:xt,formula_weight:mY,formula:xt,type:Rr(Uo),type_evidence_code:xt,class:Rr(Uo),class_evidence_code:xt,name:xt,represent_as:Rr(Uo),chem_comp_id:xt,compound_details:xt,description:xt,representative_PDB_id_code:xt,release_status:Rr(Uo),replaces:xt,replaced_by:xt},pdbx_reference_entity_list:{prd_id:xt,ref_entity_id:xt,type:Rr(Uo),details:xt,component_id:yi},pdbx_reference_entity_nonpoly:{prd_id:xt,ref_entity_id:xt,name:xt,chem_comp_id:xt},pdbx_reference_entity_link:{link_id:yi,prd_id:xt,details:xt,ref_entity_id_1:xt,ref_entity_id_2:xt,entity_seq_num_1:yi,entity_seq_num_2:yi,comp_id_1:xt,comp_id_2:xt,atom_id_1:xt,atom_id_2:xt,value_order:Rr(Uo),component_1:yi,component_2:yi,link_class:Rr(xt)},pdbx_reference_entity_poly_link:{link_id:yi,prd_id:xt,ref_entity_id:xt,component_id:yi,entity_seq_num_1:yi,entity_seq_num_2:yi,comp_id_1:xt,comp_id_2:xt,atom_id_1:xt,atom_id_2:xt,value_order:Rr(Uo)},pdbx_reference_entity_poly:{prd_id:xt,ref_entity_id:xt,type:Rr(xt),db_code:xt,db_name:xt},pdbx_reference_entity_poly_seq:{prd_id:xt,ref_entity_id:xt,mon_id:xt,parent_mon_id:xt,num:yi,observed:Rr(Uo),hetero:Rr(Uo)},pdbx_reference_entity_sequence:{prd_id:xt,ref_entity_id:xt,type:Rr(xt),NRP_flag:Rr(xt),one_letter_codes:xt},pdbx_reference_entity_src_nat:{prd_id:xt,ref_entity_id:xt,ordinal:yi,organism_scientific:xt,taxid:xt,db_code:xt,db_name:xt},pdbx_prd_audit:{prd_id:xt,date:xt,processing_site:Rr(xt),action_type:Rr(xt)}};var JP=An.Schema;const zn=JP.str,vY={datablock:{id:zn,description:zn},dictionary:{title:zn,datablock_id:zn,version:zn},dictionary_history:{version:zn,update:zn,revision:zn},sub_category:{id:zn,description:zn},category_group_list:{id:zn,parent_id:zn,description:zn},item_type_list:{code:zn,primitive_code:zn,construct:zn,detail:zn},item_units_list:{code:zn,detail:zn},item_units_conversion:{from_code:zn,to_code:zn,operator:zn,factor:JP.float}};var Gd=An.Schema;const Du=Gd.str,sf=Gd.int,$o=Gd.float,af=Gd.Aliased,Ds=Gd.Vector;af(Du),af(Du),af(Du),af(Du),Ds(3),Ds(3);const QP={volume_data_3d_info:{name:Du,axis_order:Ds(3,sf),origin:Ds(3),dimensions:Ds(3),sample_rate:sf,sample_count:Ds(3,sf),spacegroup_number:sf,spacegroup_cell_size:Ds(3),spacegroup_cell_angles:Ds(3),mean_source:$o,mean_sampled:$o,sigma_source:$o,sigma_sampled:$o,min_source:$o,min_sampled:$o,max_source:$o,max_sampled:$o},volume_data_3d:{values:$o}};var Pm=An.Schema;const Pn=Pm.float,H0=Pm.int,rn=Pm.str,bY={cell:{angle_alpha:Pn,angle_beta:Pn,angle_gamma:Pn,formula_units_z:H0,length_a:Pn,length_b:Pn,length_c:Pn,volume:Pn},chemical:{melting_point:Pn,name_common:rn,name_systematic:rn},chemical_formula:{moiety:rn,sum:rn,weight:Pn},space_group:{crystal_system:rn,it_number:H0,"name_h-m_full":rn},space_group_symop:{operation_xyz:rn},geom_bond:{atom_site_label_1:rn,atom_site_label_2:rn,distance:Pn,publ_flag:rn,site_symmetry_1:rn,site_symmetry_2:rn,valence:Pn},audit:{block_doi:rn},database_code:{cod:rn,csd:rn,depnum_ccdc_archive:rn,depnum_ccdc_fiz:rn,icsd:rn,mdf:rn,nbs:rn},atom_site:{adp_type:rn,calc_flag:rn,disorder_assembly:rn,disorder_group:rn,fract_x:Pn,fract_y:Pn,fract_z:Pn,label:rn,occupancy:Pn,refinement_flags:rn,site_symmetry_multiplicity:H0,type_symbol:rn,u_iso_or_equiv:Pn},atom_site_aniso:{label:rn,u_11:Pn,u:(0,Pm.Matrix)(3,3),u_12:Pn,u_13:Pn,u_22:Pn,u_23:Pn,u_33:Pn},atom_type:{description:rn,symbol:rn},atom_type_scat:{dispersion_imag:Pn,dispersion_real:Pn,source:rn}},yY={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},V0=An.Schema.int,_Y={volume_data_3d_info:QP.volume_data_3d_info,segmentation_data_table:{set_id:V0,segment_id:V0},segmentation_data_3d:{values:V0}},mC={parse:n=>typeof n=="string"?oC(n):hC(n),parseText:oC,parseBinary:hC,toDatabaseCollection:function(n,e,t){const r={};for(const i of e.blocks)r[i.header]=zo(n,i,t);return r},toDatabase:zo,schema:{mmCIF:n=>zo(hY,n),CCD:n=>zo(pY,n),BIRD:n=>zo(gY,n),dic:n=>zo(vY,n),cifCore:n=>zo(bY,n,yY),densityServer:n=>zo(QP,n),segmentation:n=>zo(_Y,n)}};class eo{constructor(e,t){var r=t||{};this.streamer=e,this.name=W(r.name,""),this.path=W(r.path,"")}get type(){return""}get __objName(){return""}get isBinary(){return!1}get isJson(){return!1}get isXml(){return!1}parse(){return this.streamer.read().then(()=>LP(this,void 0,void 0,function*(){return yield this._beforeParse(),yield this._parse(),yield this._afterParse(),this[this.__objName]}))}_parse(){}_beforeParse(){}_afterParse(){Xe&&Be.log(this[this.__objName])}}class ds extends eo{constructor(e,t){var r=t||{};super(e,r),this.firstModelOnly=W(r.firstModelOnly,!1),this.asTrajectory=W(r.asTrajectory,!1),this.cAlphaOnly=W(r.cAlphaOnly,!1),this.structure=new vo(this.name,this.path),this.structureBuilder=new lj(this.structure)}get type(){return"structure"}get __objName(){return"structure"}}class Rp{constructor(e,t,r="",i,o=[]){this.structure=e,this.index=t,this.description=r,this.entityType=function(s){switch(s=s.toLowerCase()){case"polymer":return 1;case"non-polymer":return 2;case"macrolide":return 3;case"water":return 4;default:return 0}}(i||""),this.chainIndexList=o,o.forEach(function(s){e.chainStore.entityIndex[s]=t})}get type(){return function(e){switch(e){case 1:return"polymer";case 2:return"non-polymer";case 3:return"macrolide";case 4:return"water";default:return}}(this.entityType)}getEntityType(){return this.entityType}isPolymer(){return this.entityType===1}isNonPolymer(){return this.entityType===2}isMacrolide(){return this.entityType===3}isWater(){return this.entityType===4}eachChain(e){const t=this.structure.getChainProxy();this.chainIndexList.forEach(function(r){t.index=r,e(t)})}}const xY={a:1,b:1,c:1,alpha:90,beta:90,gamma:90,spacegroup:"P 1"};class Ip{constructor(e=xY){this.cartToFrac=new at,this.fracToCart=new at,this.a=e.a,this.b=e.b,this.c=e.c,this.alpha=e.alpha,this.beta=e.beta,this.gamma=e.gamma,this.spacegroup=e.spacegroup;const t=kn(this.alpha),r=kn(this.beta),i=kn(this.gamma),o=Math.cos(t),s=Math.cos(r),a=Math.cos(i),l=Math.sin(r),c=Math.sin(i);if(this.volume=this.a*this.b*this.c*Math.sqrt(1-o*o-s*s-a*a+2*o*s*a),e.cartToFrac===void 0){const u=this.a*this.b*c/this.volume,d=(s*a-o)/(l*c);this.fracToCart.set(this.a,0,0,0,this.b*a,this.b*c,0,0,this.c*s,-this.c*l*d,1/u,0,0,0,0,1).transpose(),this.cartToFrac.copy(this.fracToCart).invert()}else this.cartToFrac.copy(e.cartToFrac),this.fracToCart.copy(this.cartToFrac).invert()}getPosition(e){const t=new Float32Array(24);if(e.unitcell){const r=e.unitcell,i=e.center.clone().applyMatrix4(r.cartToFrac).floor(),o=new te;let s=0;const a=function(l,c,u){o.set(l,c,u).add(i).applyMatrix4(r.fracToCart).toArray(t,s),s+=3};a(0,0,0),a(1,0,0),a(0,1,0),a(0,0,1),a(1,1,0),a(1,0,1),a(0,1,1),a(1,1,1)}return t}getCenter(e){return function(t,r=new te){const i=t.length;for(let o=0;o<i;o+=3)r.x+=t[o],r.y+=t[o+1],r.z+=t[o+2];return r.divideScalar(i/3),r}(this.getPosition(e))}getData(e,t={}){const r=W(t.colorValue,"orange"),i=W(t.radius,Math.cbrt(this.volume)/200),o=new _t(r),s=new te,a=this.getPosition(e),l=un(8,o.r,o.g,o.b),c=fi(8,i),u=new Float32Array(36),d=new Float32Array(36),h=un(12,o.r,o.g,o.b),m=fi(12,i);let f=0;function v(b,S){s.fromArray(a,3*b).toArray(u,f),s.fromArray(a,3*S).toArray(d,f),f+=3}v(0,1),v(0,2),v(0,3),v(1,4),v(1,5),v(2,6),v(3,5),v(4,7),v(5,7),v(2,4),v(7,6),v(3,6);const g=new LW(this,e);return{vertex:{position:a,color:l,radius:c,picking:g},edge:{position1:u,position2:d,color:h,color2:h,radius:m,picking:g}}}}const Dp={1:"h",2:"h",3:"i",4:"h",5:"g",6:"h",7:"h",8:"h",9:"h",10:"h",0:"h"},wY=["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"],SY=["MOL_ID","MOLECULE","CHAIN","FRAGMENT","SYNONYM","EC","ENGINEERED","MUTATION","OTHER_DETAILS"],gC=/\s+/;function vC(n,e,t){let r=`${n}`;return e&&(r+=`:${e}`),t&&(r+=`^${t}`),r}class Ju extends ds{constructor(e,t){const r=t||{};super(e,r),this.hex=W(r.hex,!1),this.inferBonds=W(r.inferBonds,"all")}get type(){return"pdb"}_parse(){Xe&&Be.time("PdbParser._parse "+this.name);let e=!1;const t=this.streamer.peekLines(1)[0],r=t.substr(62,4),i=t.substr(72,4);r===i&&i.trim()&&(e=!0);const o=this.type==="pqr",s=this.type==="pdbqt",a=this.structure,l=this.structureBuilder,c=this.hex;let u=10,d=10;const h=this.firstModelOnly,m=this.asTrajectory,f=this.cAlphaOnly,v=a.frames,g=a.boxes;let b,S,p=!1;const y=a.biomolDict;let w,x,_,A,C,T,I,M,P,E,R,B,L,F,H,$,O,k,X,ie,ne,Q,ce={};const Z={},re={},se=[];let fe,ue;const U={},K={},be={};let me,le,xe,pe,ye,Me,Ce;const z={};let D;const q={helices:[],sheets:[]},_e=q.helices,ve=q.sheets,Re=a.atomMap,ze=a.atomStore;ze.resize(Math.round(this.streamer.data.length/80)),(o||s)&&ze.addField("partialCharge",1,"float32"),o&&ze.addField("radius",1,"float32");const Le=a.getAtomProxy(),Ve=a.getAtomProxy();let Ze=0,ut=0,Ne=!0;this.streamer.eachChunkOfLines(function(he){(function(Ae,Fe,ke){for(let We=Ae;We<Fe;++We)if(A=ke[We],C=A.substr(0,6),C==="ATOM  "||C==="HETATM"){if(Ne&&(m?(p?(b=new Float32Array(3*ze.count),v.push(b)):b=[],S=0):h||(ce={}),me=1,le=me.toString(),xe=!0,Ne=!1),h&&ut>0)continue;let ee,Ie,Se,Ee,Ge,ft=0;if(o){if(Ee=A.split(gC),ft=Ee.length===10?1:0,B=Ee[2],f&&B!=="CA")continue;ee=parseFloat(Ee[6-ft]),Ie=parseFloat(Ee[7-ft]),Se=parseFloat(Ee[8-ft])}else{if(B=A.substr(12,4).trim(),f&&B!=="CA")continue;ee=parseFloat(A.substr(30,8)),Ie=parseFloat(A.substr(38,8)),Se=parseFloat(A.substr(46,8))}if(m){const St=3*S;if(b[St+0]=ee,b[St+1]=Ie,b[St+2]=Se,S+=1,p)continue}o?(T=parseInt(Ee[1]),Ge="",L=A[0]==="H",I=ft?"":Ee[4],M=parseInt(Ee[5-ft]),R="",P=Ee[3],H="",E=1):(T=parseInt(A.substr(6,5),u),c&&T===99999&&(u=16),L=A[0]==="H",I=A[21].trim(),M=parseInt(A.substr(22,4),d),c&&M===9999&&(d=16),R=A[26].trim(),P=A.substr(17,4).trim()||"MOL",F=parseFloat(A.substr(60,6)),H=A[16].trim(),E=parseFloat(A.substr(54,6)),e||(s?(Ge=A.substr(76,3).trim(),Ge in Nw&&(Ge=Nw[Ge])):(Ge=A.substr(76,2).trim(),I||(I=A.substr(72,4).trim())),$=parseInt((A.substr(79,1)+A.substr(78,1)).trim()))),ze.growIfFull(),ze.atomTypeId[Ze]=Re.add(B,Ge),ze.x[Ze]=ee,ze.y[Ze]=Ie,ze.z[Ze]=Se,ze.serial[Ze]=T,ze.altloc[Ze]=H.charCodeAt(0),ze.occupancy[Ze]=isNaN(E)?0:E,o?(ze.partialCharge[Ze]=parseFloat(Ee[9-ft]),ze.radius[Ze]=parseFloat(Ee[10-ft])):(ze.bfactor[Ze]=isNaN(F)?0:F,s&&(ze.partialCharge[Ze]=parseFloat(A.substr(70,6))),isFinite($)&&(ze.formalCharge||ze.addField("formalCharge",1,"int8"),ze.formalCharge[Ze]=$));const Rt=vC(M,I,R);!L||K[Rt]||wY.includes(P)?xe||pe===I||(me+=1,le=me.toString()):pe===I&&Me===P&&(_p.includes(P)||ye===M&&Ce===R)||(me+=1,le=me.toString(),ye=M,Me=P,Ce=R),l.addAtom(ut,I,le,P,M,L,void 0,R),ce[T]=Ze,Ze+=1,xe=!1,pe=I}else if(C==="CONECT"){const ee=ce[parseInt(A.substr(6,5))],Ie=[11,16,21,26],Se={};if(ee===void 0)continue;for(let Ee=0;Ee<4;++Ee){let Ge=parseInt(A.substr(Ie[Ee],5));if(!Number.isNaN(Ge)&&(Ge=ce[Ge],Ge!==void 0))if(ee<Ge?(Le.index=ee,Ve.index=Ge):(Le.index=Ge,Ve.index=ee),Se[Ge]!==void 0)a.bondStore.bondOrder[Se[Ge]]+=1;else{const ft=Le.index+"|"+Ve.index;re[ft]===void 0&&(re[ft]=!0,Se[Ge]=a.bondStore.count,a.bondStore.addBond(Le,Ve,1))}}}else if(C==="HELIX "){O=A[19].trim(),k=parseInt(A.substr(21,4)),X=A[25].trim(),ie=A[31].trim(),ne=parseInt(A.substr(33,4)),Q=A[37].trim();let ee=parseInt(A.substr(39,1));ee=(Dp[ee]||Dp[0]).charCodeAt(0),_e.push([O,k,X,ie,ne,Q,ee])}else if(C==="SHEET ")O=A[21].trim(),k=parseInt(A.substr(22,4)),X=A[26].trim(),ie=A[32].trim(),ne=parseInt(A.substr(33,4)),Q=A[37].trim(),ve.push([O,k,X,ie,ne,Q]);else if(C==="HETNAM")U[A.substr(11,3)]=A.substr(15).trim();else if(C==="SEQRES"){const ee=A[11].trim();ee!==D&&(z[ee]=[],D=ee),z[ee].push(...A.substr(19).trim().split(gC))}else if(C==="MODRES"){const ee=A.substr(12,3).trim(),Ie=A[16].trim(),Se=A[22].trim(),Ee=parseInt(A.substr(18,4).trim()),Ge=vC(Ee,Ie,Se);K[Ge]={resname:ee,chainname:Ie,inscode:Se,resno:Ee}}else if(C==="COMPND"){const ee=A.substr(10,70).trim(),Ie=ee.indexOf(":"),Se=ee.substring(0,Ie);let Ee;SY.includes(Se)?(ue=Se,Ee=ee.substring(Ie+2)):Ee=ee,Ee=Ee.replace(/;$/,""),ue==="MOL_ID"?(fe={chainList:[],name:""},se.push(fe)):ue==="MOLECULE"?(fe.name&&(fe.name+=" "),fe.name+=Ee):ue==="CHAIN"&&Array.prototype.push.apply(fe.chainList,Ee.split(/\s*,\s*/))}else if(A.startsWith("TER")){const ee=a.getChainProxy(a.chainStore.count-1);be[ee.chainname]=ee.index,me+=1,le=me.toString(),xe=!0}else if(C==="REMARK"&&A.substr(7,3)==="350"){if(A.substr(11,12)==="BIOMOLECULE:"){let ee=A.substr(23).trim();/^(0|[1-9][0-9]*)$/.test(ee)&&(ee="BU"+ee),w=new Js(ee),y[ee]=w}else if(A.substr(13,5)==="BIOMT"){const ee=A.split(/\s+/),Ie=parseInt(A[18])-1;Ie===0&&(_=new at,x.matrixList.push(_));const Se=_.elements;Se[0+Ie]=parseFloat(ee[4]),Se[4+Ie]=parseFloat(ee[5]),Se[8+Ie]=parseFloat(ee[6]),Se[12+Ie]=parseFloat(ee[7])}else if(A.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||A.substr(11,30)==="                   AND CHAINS:"){A.substr(11,5)==="APPLY"&&(x=w.addPart());const ee=A.substr(41,30).split(",");for(let Ie=0,Se=ee.length;Ie<Se;++Ie){const Ee=ee[Ie].trim();Ee&&x.chainList.push(Ee)}}}else if(C==="HEADER")a.id=A.substr(62,4);else if(C==="TITLE ")a.title+=(a.title?" ":"")+A.substr(10,70).trim();else if(C==="MODEL ")Ne=!0;else if(C==="ENDMDL"||A.trim()==="END"){if(Ne)continue;m&&!p&&(v.push(new Float32Array(b)),p=!0),ut+=1,Ne=!0}else if(A.substr(0,5)==="MTRIX"){if(A[59]==="1")continue;if(!w||w.name!=="NCS"){const Ee="NCS";w=new Js(Ee),y[Ee]=w,x=w.addPart()}const ee=A.split(/\s+/),Ie=parseInt(A[5])-1;Ie===0&&(_=new at,x.matrixList.push(_));const Se=_.elements;Se[0+Ie]=parseFloat(ee[2]),Se[4+Ie]=parseFloat(ee[3]),Se[8+Ie]=parseFloat(ee[4]),Se[12+Ie]=parseFloat(ee[5])}else if(A.substr(0,5)==="ORIGX"){Z.origx||(Z.origx=new at);const ee=A.split(/\s+/),Ie=parseInt(A[5])-1,Se=Z.origx.elements;Se[0+Ie]=parseFloat(ee[1]),Se[4+Ie]=parseFloat(ee[2]),Se[8+Ie]=parseFloat(ee[3]),Se[12+Ie]=parseFloat(ee[4])}else if(A.substr(0,5)==="SCALE"){Z.scale||(Z.scale=new at);const ee=A.split(/\s+/),Ie=parseInt(A[5])-1,Se=Z.scale.elements;Se[0+Ie]=parseFloat(ee[1]),Se[4+Ie]=parseFloat(ee[2]),Se[8+Ie]=parseFloat(ee[3]),Se[12+Ie]=parseFloat(ee[4])}else if(C==="CRYST1"){const ee=parseFloat(A.substr(6,9)),Ie=parseFloat(A.substr(15,9)),Se=parseFloat(A.substr(24,9)),Ee=parseFloat(A.substr(33,7)),Ge=parseFloat(A.substr(40,7)),ft=parseFloat(A.substr(47,7)),Rt=A.substr(55,11).trim(),St=new Float32Array(9);St[0]=ee,St[4]=Ie,St[8]=Se,g.push(St),ut===0&&(Z.a=ee,Z.b=Ie,Z.c=Se,Z.alpha=Ee,Z.beta=Ge,Z.gamma=ft,Z.spacegroup=Rt)}})(0,he.length,he)}),l.finalize();const ct=se.length;if(ct){a.eachChain(function(ke){ke.entityIndex=ct}),se.forEach(function(ke,We){const ee=ke.chainList.map(function(Ie){return be[Ie]});a.entityList.push(new Rp(a,We,ke.name,"polymer",ee))});let he=se.length;const Ae=a.getResidueProxy(),Fe={};a.eachChain(function(ke){ke.entityIndex===ct&&(Ae.index=ke.residueOffset,Fe[Ae.resname]||(Fe[Ae.resname]=[]),Fe[Ae.resname].push(ke.index))}),Object.keys(Fe).forEach(function(ke){const We=Fe[ke];let ee="non-polymer",Ie=U[ke]||ke;_p.includes(ke)&&(Ie="water",ee="water"),a.entityList.push(new Rp(a,he,Ie,ee,We)),he+=1})}Z.a!==void 0?a.unitcell=new Ip(Z):a.unitcell=void 0,(_e.length||ve.length)&&wP(a,q),a.finalizeAtoms(),e||Am(a),wp(a,this.inferBonds),a.finalizeBonds(),_e.length||ve.length||Cm(a),Sp(a),Xe&&Be.timeEnd("PdbParser._parse "+this.name)}}It.add("pdb",Ju),It.add("pdb1",Ju),It.add("ent",Ju);class CY{constructor(e){this.structure=e,this.dict={},this.structure=e}add(e,t,r){this.dict[e]={chemCompType:t},r&&(this.dict[e].bonds=r)}addBond(e,t,r,i){const o=this.dict[e];if(!o)return;o.bonds||(o.bonds={atom1:[],atom2:[],bondOrders:[]});const s=o.bonds;s.atom1.push(t),s.atom2.push(r),s.bondOrders.push(i)}getBonds(e,t){var r;const i=(r=this.dict[e])===null||r===void 0?void 0:r.bonds;if(!i)return;const o=this.structure.atomMap,s=new Map(t.map((h,m)=>{var f;return[(f=o.get(h))===null||f===void 0?void 0:f.atomname,m]})),a=[],l=[],c=[];let u,d;for(let h=0;h<i.atom1.length;h++)(u=s.get(i.atom1[h]))!==void 0&&(d=s.get(i.atom2[h]))!==void 0&&(a.push(u),l.push(d),c.push(i.bondOrders[h]));return{atomIndices1:a,atomIndices2:l,bondOrders:c}}}const AY=/^\D{1,2}/,MY={HELX_RH_AL_P:"h",STRN:"e",HELX_RH_3T_P:"g",HELX_RH_PI_P:"i",HELX_LH_PP_P:"e",TURN_TY1_P:"t",BEND:"s",OTHER:" "},TY={AROM:1,DELO:2,DIRECTED:0,DOUB:2,PI:0,POLY:0,QUAD:4,SING:1,TRIP:3};function bC(n){switch(n.toLowerCase()){case"?":case"sing":return 1;case"doub":return 2;case"trip":return 3;case"quad":return 4}return 0}class lf extends ds{get type(){return"cif"}get isBinary(){return!1}_parse(){var e,t,r,i,o,s,a,l,c,u,d,h,m,f,v,g,b,S,p,y,w;return LP(this,void 0,void 0,function*(){Be.time("CifParser._parse "+this.name);const x=this.structure,_=this.structureBuilder,A=this.firstModelOnly,C=this.asTrajectory,T=x.frames;let I,M;const P=this.isBinary?mC.parseBinary(this.streamer.data):mC.parseText(this.streamer.compressed?vd(this.streamer.data):this.streamer.data),E=yield P.run();if(E.isError)throw E;const R=E.result.blocks[0];if("chem_comp"in R.categories&&"chem_comp_atom"in R.categories&&!("struct"in R.categories))(function(B,L,F){const H=L.atomStore,$=L.atomMap;let O,k;const X=B.chem_comp,ie=B.chem_comp_atom,ne=B.chem_comp_bond;let Q;X&&((Q=X.getField("name"))&&(L.title=Q.str(0)),(Q=X.getField("id"))&&(L.id=Q.str(0)));const ce={};if(ie){let Z,re,se,fe;k=ie.rowCount,H.resize(2*k);const ue=ie.getField("atom_id"),U=ie.getField("type_symbol"),K=ie.getField("pdbx_component_comp_id"),be=ie.getField("pdbx_residue_numbering");[["model_Cartn_x","model_Cartn_y","model_Cartn_z"],["pdbx_model_Cartn_x_ideal","pdbx_model_Cartn_y_ideal","pdbx_model_Cartn_z_ideal"]].forEach(([me,le,xe],pe)=>{var ye;const Me=ie.getField(me),Ce=ie.getField(le),z=ie.getField(xe),D=pe*k;for(let q=0;q<k;++q){const _e=q+D;H.growIfFull(),Z=ue==null?void 0:ue.str(q),re=U==null?void 0:U.str(q),ce[Z]=q,H.atomTypeId[_e]=$.add(Z,re),H.x[_e]=Me.float(q),H.y[_e]=Ce.float(q),H.z[_e]=z.float(q),H.serial[_e]=q,se=K.str(q),fe=(ye=be==null?void 0:be.int(q))!==null&&ye!==void 0?ye:1,F.addAtom(pe,"","",se,fe,!0)}})}if(ie&&ne){let Z,re,se;k=ne.rowCount;const fe=ie.rowCount,ue=L.getAtomProxy(),U=L.getAtomProxy(),K=ne.getField("atom_id_1"),be=ne.getField("atom_id_2"),me=ne.getField("value_order");for(O=0;O<k;++O)Z=K.str(O),re=be.str(O),se=bC(me.str(O)),ue.index=ce[Z],U.index=ce[re],L.bondStore.growIfFull(),L.bondStore.addBond(ue,U,se),ue.index+=fe,U.index+=fe,L.bondStore.growIfFull(),L.bondStore.addBond(ue,U,se)}})(R.categories,x,_),_.finalize(),x.finalizeAtoms(),x.finalizeBonds(),sl(x);else if("atom_site_type_symbol"in R.categories&&"atom_site_label"in R.categories&&"atom_site_fract_x"in R.categories)(function(B,L,F){var H,$,O=L.atomStore,k=L.atomMap;B.header&&(L.id=B.header,L.name=B.header),L.unitcell=new Ip({a:B.getField("cell_length_a").float(0),b:B.getField("cell_length_b").float(0),c:B.getField("cell_length_c").float(0),alpha:B.getField("cell_angle_alpha").float(0),beta:B.getField("cell_angle_beta").float(0),gamma:B.getField("cell_angle_gamma").float(0),spacegroup:B.getField("symmetry_space_group_name_H-M").str(0)});const X=new te,ie=new te,ne=B.getField("atom_site_type_symbol");if(!ne)return;const Q=(H=ne.rowCount)!==null&&H!==void 0?H:0,ce=B.getField("atom_site_type_symbol"),Z=B.getField("atom_site_fract_x"),re=B.getField("atom_site_fract_y"),se=B.getField("atom_site_fract_z"),fe=B.getField("atom_site_occupancy"),ue={};for(let pe=0;pe<Q;++pe){O.growIfFull();const ye=ce.str(pe),Me=ne.str(pe);let Ce=ue[Me];if(!Ce){const z=Me.match(AY);ue[Me]=Ce=($=z==null?void 0:z[0])!==null&&$!==void 0?$:Me}O.atomTypeId[pe]=k.add(ye,Ce),X.set(Z.float(pe),re.float(pe),se.float(pe)),X.applyMatrix4(L.unitcell.fracToCart),ie.add(X),O.x[pe]=X.x,O.y[pe]=X.y,O.z[pe]=X.z,fe&&(O.occupancy[pe]=fe.float(pe)),O.serial[pe]=pe,F.addAtom(0,"","","HET",1,!0)}ie.divideScalar(Q),L.center=ie,Sp(L);const U=new te,K=new te,be=L.biomolDict.SUPERCELL.partList[0].matrixList;let me=Q;function le(pe){return k.get(O.atomTypeId[pe]).covalent}const xe=new at;for(let pe=0;pe<Q;++pe){const ye=le(pe);X.set(O.x[pe],O.y[pe],O.z[pe]),be.forEach(function(Me){if(!xe.equals(Me)){U.copy(X),U.applyMatrix4(Me);for(let Ce=0;Ce<Q;++Ce){K.set(O.x[Ce],O.y[Ce],O.z[Ce]);const z=U.distanceToSquared(K),D=le(Ce)+ye,q=D+.3,_e=D-.5;if(z<q*q&&z>_e*_e)return O.growIfFull(),O.atomTypeId[me]=O.atomTypeId[pe],O.x[me]=U.x,O.y[me]=U.y,O.z[me]=U.z,O.occupancy[me]=O.occupancy[pe],O.serial[me]=me,O.altloc[me]=65,F.addAtom(0,"","","HET",1,!0),void(me+=1)}}})}})(R,x,_),_.finalize(),x.finalizeAtoms(),wp(x),x.finalizeBonds();else{const B={},L={},F=x.atomMap,H=x.atomStore,$=R.categories.atom_site;let O=$.rowCount;const k=$.getField("pdbx_PDB_model_num");if(!((e=k==null?void 0:k.areValuesEqual(0,O-1))===null||e===void 0||e)&&(C||A)){const pe=k.int(0);for(let ye=0;ye<O;ye++)if(k.int(ye)>pe){O=ye;break}}x.chemCompMap=new CY(x);const X=R.categories.chem_comp;let ie=X.getField("id");const ne=X.getField("type");for(let pe=0;pe<X.rowCount;pe++)x.chemCompMap.add(ie.str(pe),ne.str(pe).toUpperCase());if(R.categoryNames.includes("chem_comp_bond")){const pe=R.categories.chem_comp_bond;ie=pe.getField("comp_id");const ye=pe.getField("atom_id_1"),Me=pe.getField("atom_id_2"),Ce=pe.getField("value_order");for(let z=0;z<pe.rowCount;z++){const D=TY[Ce.str(z)];D&&x.chemCompMap.addBond(ie.str(z),ye.str(z),Me.str(z),D)}}const Q=(pe,ye,Me)=>{const Ce=pe.getField(ye);return Ce?Ce.toFloatArray({array:Float32Array,start:0,end:Me}):new Float32Array(Me)};H.resize(O),H.x=Q($,"Cartn_x",O),H.y=Q($,"Cartn_y",O),H.z=Q($,"Cartn_z",O),H.serial=$.getField("id").toIntArray({start:0,end:O}),H.bfactor=Q($,"B_iso_or_equiv",O),H.occupancy=Q($,"occupancy",O);const ce=$.getField("label_alt_id");ce!=null&&ce.isDefined&&(H.altloc=Uint8Array.from(ce.toStringArray(),pe=>pe.charCodeAt(0)));const Z=$.getField("label_atom_id"),re=$.getField("type_symbol");ie=$.getField("label_comp_id");const se=(t=$.getField("auth_seq_id"))!==null&&t!==void 0?t:$.getField("label_seq_id"),fe=$.getField("pdbx_PDB_ins_code"),ue=$.getField("auth_asym_id"),U=$.getField("label_asym_id"),K=$.getField("group_PDB"),be=$.getField("label_entity_id");for(let pe=0;pe<O;pe++){const ye=(r=k==null?void 0:k.int(pe))!==null&&r!==void 0?r:1,Me=(i=ue==null?void 0:ue.str(pe))!==null&&i!==void 0?i:"",Ce=(o=U==null?void 0:U.str(pe))!==null&&o!==void 0?o:"",z=(s=ie==null?void 0:ie.str(pe))!==null&&s!==void 0?s:"",D=(a=se==null?void 0:se.int(pe))!==null&&a!==void 0?a:0,q=(K==null?void 0:K.str(pe)[0])==="H",_e=(l=fe==null?void 0:fe.str(pe))!==null&&l!==void 0?l:"",ve=(c=be==null?void 0:be.int(pe))!==null&&c!==void 0?c:1;H.atomTypeId[pe]=F.add((Z==null?void 0:Z.str(pe))||"",re==null?void 0:re.str(pe)),_.addAtom(ye-1,Me,Ce,z,D,q,void 0,_e),B[Ce]=Me,L[ve]||(L[ve]=new Set),L[ve].add(x.chainStore.count-1)}if(C){const pe=$.rowCount/O|0,ye=$.getField("Cartn_x"),Me=$.getField("Cartn_y"),Ce=$.getField("Cartn_z");for(let z=0;z<pe;z++){I=new Float32Array(3*O);const D=z*O,q=D+O;M=0;for(let _e=D;_e<q;_e++)I[M+0]=ye.float(_e),I[M+1]=Me.float(_e),I[M+2]=Ce.float(_e),M+=3;T.push(I)}}const me=function(pe,ye,Me){var Ce,z,D,q,_e,ve;const Re=[],ze=[];let Le,Ve,Ze,ut;const Ne=pe.struct_conf;if(Ne!=null&&Ne.fieldNames.includes("pdbx_PDB_helix_class")){const he=Ne.getField("pdbx_beg_PDB_ins_code"),Ae=Ne.getField("pdbx_end_PDB_ins_code"),Fe=Ne.getField("pdbx_PDB_helix_class"),ke=Ne.getField("beg_label_asym_id"),We=Ne.getField("end_label_asym_id"),ee=Ne.getField("beg_auth_seq_id"),Ie=Ne.getField("end_auth_seq_id");for(Le=0,Ve=Ne.rowCount;Le<Ve;++Le){const Se=Fe==null?void 0:Fe.int(Le);Number.isFinite(Se)&&(Ze=(Ce=he==null?void 0:he.str(Le))!==null&&Ce!==void 0?Ce:"",ut=(z=Ae==null?void 0:Ae.str(Le))!==null&&z!==void 0?z:"",Re.push([Me[ke.str(Le)],ee.int(Le),Ze,Me[We.str(Le)],Ie.int(Le),ut,(Dp[Se]||Dp[0]).charCodeAt(0)]))}}else if(Ne!=null&&Ne.fieldNames.includes("conf_type_id")){const he=Ne.getField("conf_type_id"),Ae=Ne.getField("pdbx_beg_PDB_ins_code"),Fe=Ne.getField("pdbx_end_PDB_ins_code"),ke=Ne.getField("beg_label_asym_id"),We=Ne.getField("end_label_asym_id"),ee=Ne.getField("beg_auth_seq_id"),Ie=Ne.getField("end_auth_seq_id");let Se;for(Le=0,Ve=Ne.rowCount;Le<Ve;++Le){const Ee=he.str(Le);(Se=MY[Ee])&&(Ze=(D=Ae==null?void 0:Ae.str(Le))!==null&&D!==void 0?D:"",ut=(q=Fe==null?void 0:Fe.str(Le))!==null&&q!==void 0?q:"",Se==="h"||Se==="g"||Se==="i"?Re.push([Me[ke.str(Le)],ee.int(Le),Ze,Me[We.str(Le)],Ie.int(Le),ut,Se.charCodeAt(0)]):Se==="e"&&ze.push([Me[ke.str(Le)],ee.int(Le),Ze,Me[We.str(Le)],Ie.int(Le),ut]))}}const ct=pe.struct_sheet_range;if(ct&&ze.length===0){const he=ct.getField("pdbx_beg_PDB_ins_code"),Ae=ct.getField("pdbx_end_PDB_ins_code"),Fe=ct.getField("beg_label_asym_id"),ke=ct.getField("end_label_asym_id"),We=ct.getField("beg_auth_seq_id"),ee=ct.getField("end_auth_seq_id");for(Le=0,Ve=ct.rowCount;Le<Ve;++Le)Ze=(_e=he==null?void 0:he.str(Le))!==null&&_e!==void 0?_e:"",ut=(ve=Ae==null?void 0:Ae.str(Le))!==null&&ve!==void 0?ve:"",ze.push([Me[Fe.str(Le)],We.int(Le),Ze,Me[ke.str(Le)],ee.int(Le),ut])}return!(!Ne&&!ct)&&{helices:Re,sheets:ze}}(R.categories,0,B);let le,xe;if(function(pe,ye,Me){const Ce={},z=ye.biomolDict;if(pe.pdbx_struct_oper_list){const ve=pe.pdbx_struct_oper_list,Re=ve.getField("id"),ze=ve.getField("matrix[1][1]"),Le=ve.getField("matrix[1][2]"),Ve=ve.getField("matrix[1][3]"),Ze=ve.getField("matrix[2][1]"),ut=ve.getField("matrix[2][2]"),Ne=ve.getField("matrix[2][3]"),ct=ve.getField("matrix[3][1]"),he=ve.getField("matrix[3][2]"),Ae=ve.getField("matrix[3][3]"),Fe=ve.getField("vector[1]"),ke=ve.getField("vector[2]"),We=ve.getField("vector[3]");for(let ee=0;ee<ve.rowCount;ee++){const Ie=new at,Se=Ie.elements;Se[0]=ze.float(ee),Se[1]=Le.float(ee),Se[2]=Ve.float(ee),Se[4]=Ze.float(ee),Se[5]=ut.float(ee),Se[6]=Ne.float(ee),Se[8]=ct.float(ee),Se[9]=he.float(ee),Se[10]=Ae.float(ee),Se[3]=Fe.float(ee),Se[7]=ke.float(ee),Se[11]=We.float(ee),Ie.transpose(),Ce[Re.str(ee)]=Ie}}if(pe.pdbx_struct_assembly_gen){const ve=pe.pdbx_struct_assembly_gen,Re=function(Ze){const ut={};return Ze.replace(/[()']/g,"").split(",").forEach(function(Ne){if(Ne.includes("-"))for(var ct=Ne.split("-"),he=parseInt(ct[0]),Ae=parseInt(ct[1]);he<=Ae;++he)ut[he]=Ce[he];else ut[Ne]=Ce[Ne]}),ut},ze=ve.getField("assembly_id"),Le=ve.getField("oper_expression"),Ve=ve.getField("asym_id_list");for(let Ze=0;Ze<ve.rowCount;Ze++){const ut=ze.int(Ze);let Ne={},ct=Le.str(Ze).replace(/['"]\(|['"]/g,"");if(ct.includes(")(")||ct.indexOf("(")>0){const[ke,We]=ct.split("(").filter(Se=>!!Se),ee=Re(ke),Ie=Re(We);Object.keys(ee).forEach(function(Se){Object.keys(Ie).forEach(function(Ee){const Ge=new at;Ge.multiplyMatrices(ee[Se],Ie[Ee]),Ne[Se+"x"+Ee]=Ge})})}else Ne=Re(ct);const he=[];for(let ke in Ne)he.push(Ne[ke]);let Ae=""+ut;/^(0|[1-9][0-9]*)$/.test(Ae)&&(Ae="BU"+Ae);const Fe=Ve.str(Ze).split(",").map(ke=>Me[ke]);z[Ae]===void 0&&(z[Ae]=new Js(Ae)),z[Ae].addPart(he,Fe)}}if(pe.struct_ncs_oper){const ve=pe.struct_ncs_oper,Re="NCS";z[Re]=new Js(Re);const ze=z[Re].addPart(),Le=ve.getField("code"),Ve=ve.getField("matrix[1][1]"),Ze=ve.getField("matrix[1][2]"),ut=ve.getField("matrix[1][3]"),Ne=ve.getField("matrix[2][1]"),ct=ve.getField("matrix[2][2]"),he=ve.getField("matrix[2][3]"),Ae=ve.getField("matrix[3][1]"),Fe=ve.getField("matrix[3][2]"),ke=ve.getField("matrix[3][3]"),We=ve.getField("vector[1]"),ee=ve.getField("vector[2]"),Ie=ve.getField("vector[3]");for(let Se=0;Se<ve.rowCount;Se++){if(Le.str(Se)==="given")return;const Ee=new at,Ge=Ee.elements;Ge[0]=Ve.float(Se),Ge[1]=Ze.float(Se),Ge[2]=ut.float(Se),Ge[4]=Ne.float(Se),Ge[5]=ct.float(Se),Ge[6]=he.float(Se),Ge[8]=Ae.float(Se),Ge[9]=Fe.float(Se),Ge[10]=ke.float(Se),Ge[3]=We.float(Se),Ge[7]=ee.float(Se),Ge[11]=Ie.float(Se),Ee.transpose(),ze.matrixList.push(Ee)}ze.matrixList.length===0&&delete z[Re]}const D={};if(pe.cell){const ve=pe.cell,Re=ve.getField("length_a").float(0),ze=ve.getField("length_b").float(0),Le=ve.getField("length_c").float(0),Ve=new Float32Array(9);Ve[0]=Re,Ve[4]=ze,Ve[8]=Le,ye.boxes.push(Ve),D.a=Re,D.b=ze,D.c=Le,D.alpha=ve.getField("angle_alpha").float(0),D.beta=ve.getField("angle_beta").float(0),D.gamma=ve.getField("angle_gamma").float(0)}pe.symmetry&&(D.spacegroup=pe.symmetry.getField("space_group_name_H-M").str(0));const q=new at;if(pe.database_PDB_matrix){const ve=pe.database_PDB_matrix,Re=q.elements,ze=ve.getField("origx[1][1]"),Le=ve.getField("origx[1][2]"),Ve=ve.getField("origx[1][3]"),Ze=ve.getField("origx[2][1]"),ut=ve.getField("origx[2][2]"),Ne=ve.getField("origx[2][3]"),ct=ve.getField("origx[3][1]"),he=ve.getField("origx[3][2]"),Ae=ve.getField("origx[3][3]"),Fe=ve.getField("origx_vector[1]"),ke=ve.getField("origx_vector[2]"),We=ve.getField("origx_vector[3]");Re[0]=ze.float(0),Re[1]=Le.float(0),Re[2]=Ve.float(0),Re[4]=Ze.float(0),Re[5]=ut.float(0),Re[6]=Ne.float(0),Re[8]=ct.float(0),Re[9]=he.float(0),Re[10]=Ae.float(0),Re[3]=Fe.float(0),Re[7]=ke.float(0),Re[11]=We.float(0),q.transpose(),D.origx=q}const _e=new at;if(pe.atom_sites){const ve=pe.atom_sites,Re=_e.elements,ze=ve.getField("fract_transf_matrix[1][1]"),Le=ve.getField("fract_transf_matrix[1][2]"),Ve=ve.getField("fract_transf_matrix[1][3]"),Ze=ve.getField("fract_transf_matrix[2][1]"),ut=ve.getField("fract_transf_matrix[2][2]"),Ne=ve.getField("fract_transf_matrix[2][3]"),ct=ve.getField("fract_transf_matrix[3][1]"),he=ve.getField("fract_transf_matrix[3][2]"),Ae=ve.getField("fract_transf_matrix[3][3]"),Fe=ve.getField("fract_transf_vector[1]"),ke=ve.getField("fract_transf_vector[2]"),We=ve.getField("fract_transf_vector[3]");Re[0]=ze.float(0),Re[1]=Le.float(0),Re[2]=Ve.float(0),Re[4]=Ze.float(0),Re[5]=ut.float(0),Re[6]=Ne.float(0),Re[8]=ct.float(0),Re[9]=he.float(0),Re[10]=Ae.float(0),Re[3]=Fe.float(0),Re[7]=ke.float(0),Re[11]=We.float(0),_e.transpose(),D.scale=_e}D.a!==void 0?ye.unitcell=new Ip(D):ye.unitcell=void 0}(R.categories,x,B),function(pe,ye,Me){const Ce=pe.struct_conn;if(Ce){const q=ye.getAtomProxy(),_e=ye.getAtomProxy(),ve={},Re=Ce.getField("conn_type_id"),ze=Ce.getField("ptnr1_symmetry"),Le=Ce.getField("pdbx_ptnr1_PDB_ins_code"),Ve=Ce.getField("pdbx_ptnr1_label_alt_id"),Ze=Ce.getField("ptnr1_auth_seq_id"),ut=Ce.getField("ptnr1_label_asym_id"),Ne=Ce.getField("ptnr1_label_atom_id"),ct=Ce.getField("ptnr2_symmetry"),he=Ce.getField("pdbx_ptnr2_PDB_ins_code"),Ae=Ce.getField("pdbx_ptnr2_label_alt_id"),Fe=Ce.getField("ptnr2_auth_seq_id"),ke=Ce.getField("ptnr2_label_asym_id"),We=Ce.getField("ptnr2_label_atom_id"),ee=Ce.getField("pdbx_value_order");for(let Ie=0,Se=Ce.rowCount;Ie<Se;++Ie){const Ee=Re.str(Ie);if(Ee==="hydrog"||Ee==="mismat"||Ee==="saltbr"||ze.str(Ie)!=="1_555"||ct.str(Ie)!=="1_555")continue;const Ge=Le.str(Ie),ft=Ve.str(Ie),Rt=Ze.str(Ie)+(Ge?"^"+Ge:"")+":"+Me[ut.str(Ie)]+"."+Ne.str(Ie)+(ft?"%"+ft:"");let St=ve[Rt];if(!St){const de=new yn(Rt);if(de.selection.error){Xe&&Be.warn("invalid selection for connection",Rt);continue}St=ye.getAtomIndices(de),ve[Rt]=St}const N=he.str(Ie),j=Ae.str(Ie),Y=Fe.str(Ie)+(N?"^"+N:"")+":"+Me[ke.str(Ie)]+"."+We.str(Ie)+(j?"%"+j:"");let oe=ve[Y];if(!oe){const de=new yn(Y);if(de.selection.error){Xe&&Be.warn("invalid selection for connection",Y);continue}oe=ye.getAtomIndices(de),ve[Y]=oe}var z=St.length,D=oe.length;if(z>D&&([z,D]=[D,z],[St,oe]=[oe,St]),z!==0&&D!==0)for(let de=0;de<D;++de)q.index=St[de%z],_e.index=oe[de],q&&_e?ye.bondStore.addBond(q,_e,bC(ee.str(Ie))):Be.log("atoms for connection not found");else Xe&&Be.warn("no atoms found for",Rt,Y)}}}(R.categories,x,B),function(pe,ye,Me){var Ce;if(pe.entity){const z=pe.entity,D=z.getField("id"),q=z.getField("pdbx_description"),_e=z.getField("type"),ve=z.rowCount;for(let Re=0;Re<ve;++Re){const ze=Array.from((Ce=Me[D.int(Re)])!==null&&Ce!==void 0?Ce:[]);ye.entityList[Re]=new Rp(ye,Re,q==null?void 0:q.str(Re),_e.str(Re),ze)}}}(R.categories,x,L),(le=(u=R.categories.struct)===null||u===void 0?void 0:u.getField("title"))&&(xe=le.str(0))&&(x.title=xe),(le=(d=R.categories.entry)===null||d===void 0?void 0:d.getField("id"))&&(xe=le.str(0))&&(x.id=xe),R.categories.pdbx_audit_revision_history){if(le=(h=R.categories.pdbx_audit_revision_history)===null||h===void 0?void 0:h.getField("revision_date")){for(let pe=0;pe<le.rowCount;pe++)if(xe=le.str(pe)){x.header.releaseDate=xe;break}}if(le=(m=R.categories.pdbx_database_status)===null||m===void 0?void 0:m.getField("recvd_initial_deposition_date")){for(let pe=0;pe<le.rowCount;pe++)if(xe=le.str(pe)){x.header.depositionDate=xe;break}}}else if(R.categories.database_PDB_rev){if(le=(f=R.categories.database_PDB_rev)===null||f===void 0?void 0:f.getField("date")){for(let pe=0;pe<le.rowCount;pe++)if(xe=le.str(pe)){x.header.releaseDate=xe;break}}if(le=(v=R.categories.database_PDB_rev)===null||v===void 0?void 0:v.getField("date_original")){for(let pe=0;pe<le.rowCount;pe++)if(xe=le.str(pe)){x.header.depositionDate=xe;break}}}(le=(b=(g=R.categories.reflns)===null||g===void 0?void 0:g.getField("d_resolution_high"))!==null&&b!==void 0?b:(S=R.categories.refine)===null||S===void 0?void 0:S.getField("ls_d_res_high"))&&le.valueKind(0)===0&&(x.header.resolution=le.float(0)),(le=(p=R.categories.refine)===null||p===void 0?void 0:p.getField("ls_R_factor_R_free"))&&le.valueKind(0)===0&&(x.header.rFree=le.float(0)),(le=(y=R.categories.refine)===null||y===void 0?void 0:y.getField("ls_R_factor_R_work"))&&le.valueKind(0)===0&&(x.header.rFree=le.float(0)),(le=(w=R.categories.exptl)===null||w===void 0?void 0:w.getField("method"))&&(x.header.experimentalMethods=le.toStringArray().slice()),_.finalize(),x.finalizeAtoms(),wp(x),x.finalizeBonds(),me?wP(x,me):Cm(x),Sp(x),x.extraData.cif=R}Xe&&Be.timeEnd("CifParser._parse "+this.name)})}}It.add("bcif",class extends lf{get type(){return"bcif"}get isBinary(){return!0}}),It.add("cif",lf),It.add("mcif",lf),It.add("mmcif",lf);It.add("gro",class extends ds{get type(){return"gro"}_parse(){Xe&&Be.time("GroParser._parse "+this.name);var n,e,t=this.structure,r=this.structureBuilder,i=this.firstModelOnly,o=this.asTrajectory,s=this.cAlphaOnly,a=t.frames,l=t.boxes,c=this.streamer.peekLines(3);t.title=c[0].trim();var u,d,h,m,f=5+(c[2].length-c[2].lastIndexOf(".")-1),v=20+f,g=20+2*f,b=parseInt(c[1]),S=b+3,p=t.atomMap,y=t.atomStore;y.resize(b);var w=0,x=0,_=0;this.streamer.eachChunkOfLines(function(A){(function(C,T,I){for(var M=C;M<T;++M){var P=++_-1,E=I[M];if(E){if(P%S==0)o&&(n=new Float32Array(3*b),a.push(n),e=0);else if(P%S!=1)if(P%S==S-1){var R=E.trim().split(/\s+/),B=new Float32Array(9);if(B[0]=10*parseFloat(R[0]),B[4]=10*parseFloat(R[1]),B[8]=10*parseFloat(R[2]),l.push(B),i)return!0;x+=1}else{if(u=E.substr(10,5).trim(),s&&u!=="CA")continue;var L=10*parseFloat(E.substr(20,f)),F=10*parseFloat(E.substr(v,f)),H=10*parseFloat(E.substr(g,f));if(o){var $=3*e;if(n[$+0]=L,n[$+1]=F,n[$+2]=H,e+=1,P>S)continue}d=E.substr(5,5).trim(),h=parseInt(E.substr(0,5)),m=parseInt(E.substr(15,5)),y.growIfFull(),y.atomTypeId[w]=p.add(u),y.x[w]=L,y.y[w]=F,y.z[w]=H,y.serial[w]=m,r.addAtom(x,"","",d,h,!1,"l"),w+=1}}}})(0,A.length,A)}),r.finalize(),t.finalizeAtoms(),Am(t),wp(t),t.finalizeBonds(),Cm(t),Xe&&Be.timeEnd("GroParser._parse "+this.name)}});var EY=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"].concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]);function Wd(n,e,t){return e?new n(e.buffer,e.byteOffset,e.byteLength/(t||1)):void 0}function Iv(n){return Wd(DataView,n)}function G0(n){return Wd(Int8Array,n)}function Lp(n){return Wd(Int32Array,n,4)}function vu(n,e){var t=n.length/2;e||(e=new Int16Array(t));for(var r=0,i=0;r<t;++r,i+=2)e[r]=n[i]<<8^n[i+1];return e}function lo(n,e){var t=n.length/4;e||(e=new Int32Array(t));for(var r=0,i=0;r<t;++r,i+=4)e[r]=n[i]<<24^n[i+1]<<16^n[i+2]<<8^n[i+3];return e}function Fp(n,e,t){var r=n.length,i=1/e;t||(t=new Float32Array(r));for(var o=0;o<r;++o)t[o]=n[o]*i;return t}function cf(n,e){var t,r;if(!e){var i=0;for(t=0,r=n.length;t<r;t+=2)i+=n[t+1];e=new n.constructor(i)}var o=0;for(t=0,r=n.length;t<r;t+=2)for(var s=n[t],a=n[t+1],l=0;l<a;++l)e[o]=s,++o;return e}function eR(n,e){var t=n.length;e||(e=new n.constructor(t)),t&&(e[0]=n[0]);for(var r=1;r<t;++r)e[r]=n[r]+e[r-1];return e}function Op(n,e){var t,r,i=n instanceof Int8Array?127:32767,o=-i-1,s=n.length;if(!e){var a=0;for(t=0;t<s;++t)n[t]<i&&n[t]>o&&++a;e=new Int32Array(a)}for(t=0,r=0;t<s;){for(var l=0;n[t]===i||n[t]===o;)l+=n[t],++t;l+=n[t],++t,e[r]=l,++r}return e}function yC(n,e,t){return Fp(Op(n,Lp(t)),e,t)}function PY(n,e,t){var r=Op(n,Lp(t));return function(i,o,s){return Fp(eR(i,Lp(s)),o,s)}(r,e,Wd(Float32Array,r,4))}function tR(n){var e=0,t=new DataView(n.buffer);function r(l){for(var c={},u=0;u<l;u++)c[a()]=a();return c}function i(l){var c=n.subarray(e,e+l);return e+=l,c}function o(l){var c=n.subarray(e,e+l);e+=l;var u=65535;if(l>u){for(var d=[],h=0;h<c.length;h+=u)d.push(String.fromCharCode.apply(null,c.subarray(h,h+u)));return d.join("")}return String.fromCharCode.apply(null,c)}function s(l){for(var c=new Array(l),u=0;u<l;u++)c[u]=a();return c}function a(){var l,c,u=n[e];if(!(128&u))return e++,u;if((240&u)==128)return e++,r(c=15&u);if((240&u)==144)return e++,s(c=15&u);if((224&u)==160)return e++,o(c=31&u);if(!(224&~u))return l=t.getInt8(e),e++,l;switch(u){case 192:return e++,null;case 194:return e++,!1;case 195:return e++,!0;case 196:return c=t.getUint8(e+1),e+=2,i(c);case 197:return c=t.getUint16(e+1),e+=3,i(c);case 198:return c=t.getUint32(e+1),e+=5,i(c);case 202:return l=t.getFloat32(e+1),e+=5,l;case 203:return l=t.getFloat64(e+1),e+=9,l;case 204:return l=n[e+1],e+=2,l;case 205:return l=t.getUint16(e+1),e+=3,l;case 206:return l=t.getUint32(e+1),e+=5,l;case 208:return l=t.getInt8(e+1),e+=2,l;case 209:return l=t.getInt16(e+1),e+=3,l;case 210:return l=t.getInt32(e+1),e+=5,l;case 217:return c=t.getUint8(e+1),e+=2,o(c);case 218:return c=t.getUint16(e+1),e+=3,o(c);case 219:return c=t.getUint32(e+1),e+=5,o(c);case 220:return c=t.getUint16(e+1),e+=3,s(c);case 221:return c=t.getUint32(e+1),e+=5,s(c);case 222:return c=t.getUint16(e+1),e+=3,r(c);case 223:return c=t.getUint32(e+1),e+=5,r(c)}throw new Error("Unknown type 0x"+u.toString(16))}return a()}function RY(n,e,t,r){switch(n){case 1:return function(a,l){var c=a.length;l||(l=new Float32Array(c/4));for(var u=Iv(l),d=Iv(a),h=0,m=0,f=c/4;h<f;++h,m+=4)u.setFloat32(m,d.getFloat32(m),!0);return l}(e);case 2:return G0(e);case 3:return vu(e);case 4:return lo(e);case 5:return Wd(Uint8Array,e);case 6:return cf(lo(e),new Uint8Array(t));case 7:return cf(lo(e));case 8:return function(a,l){return eR(cf(a),l)}(lo(e));case 9:return i=lo(e),o=lo(r)[0],Fp(cf(i,Lp(s)),o,s);case 10:return PY(vu(e),lo(r)[0]);case 11:return Fp(vu(e),lo(r)[0]);case 12:return yC(vu(e),lo(r)[0]);case 13:return yC(G0(e),lo(r)[0]);case 14:return Op(vu(e));case 15:return Op(G0(e))}var i,o,s}function IY(n,e){var t=(e=e||{}).ignoreFields,r={};return EY.forEach(function(i){var o,s,a,l,c,u=!!t&&t.indexOf(i)!==-1,d=n[i];u||d===void 0||(d instanceof Uint8Array?r[i]=RY.apply(null,(s=Iv(o=d),a=s.getInt32(0),l=s.getInt32(4),c=o.subarray(8,12),[a,o=o.subarray(12),l,c])):r[i]=d)}),r}const DY={0:105,1:115,2:104,3:101,4:103,5:98,6:116,7:108,"-1":NaN};It.add("mmtf",class extends ds{get type(){return"mmtf"}get isBinary(){return!0}_parse(){let n,e,t,r,i;Xe&&Be.time("MmtfParser._parse "+this.name);const o=this.structure,s=IY(tR(this.streamer.data));let a,l,c,u,d,h;if(["depositionDate","releaseDate","resolution","rFree","rWork","experimentalMethods"].forEach(function(F){s[F]!==void 0&&(o.header[F]=s[F])}),o.id=s.structureId,o.title=s.title,o.atomStore.addField("formalCharge",1,"int8"),this.firstModelOnly||this.asTrajectory){for(d=1,u=s.chainsPerModel[0],c=0,n=0,e=u;n<e;++n)c+=s.groupsPerChain[n];for(l=0,n=0,e=c;n<e;++n)i=s.groupList[s.groupTypeList[n]],l+=i.atomNameList.length;a=s.numBonds,h=[u]}else a=s.numBonds,l=s.numAtoms,c=s.numGroups,u=s.numChains,d=s.numModels,h=s.chainsPerModel;if(a+=c,this.asTrajectory)for(n=0,e=s.numModels;n<e;++n){const F=new Float32Array(3*l),H=l*n;for(t=0;t<l;++t){const $=3*t,O=t+H;F[$]=s.xCoordList[O],F[$+1]=s.yCoordList[O],F[$+2]=s.zCoordList[O]}o.frames.push(F)}const m=new Uint32Array(a),f=new Uint32Array(a),v=new Uint8Array(a),g=new Uint32Array(l),b=new Int8Array(l),S=new Uint32Array(c),p=new Uint32Array(c),y=new Uint32Array(c),w=new Uint16Array(u),x=new Uint32Array(u),_=new Uint32Array(u),A=new Uint32Array(d),C=new Uint32Array(d);let T=0;for(n=0,e=d;n<e;++n){const F=h[n];for(A[n]=T,C[n]=F,t=0;t<F;++t)w[t+T]=n;T+=F}const I=s.groupsPerChain;let M=0;for(n=0,e=u;n<e;++n){const F=I[n];for(x[n]=M,_[n]=F,t=0;t<F;++t)S[t+M]=n;M+=F}let P=0,E=0;for(n=0,e=c;n<e;++n){i=s.groupList[s.groupTypeList[n]];const F=i.atomNameList.length,H=i.formalChargeList,$=i.bondAtomList,O=i.bondOrderList;for(t=0,r=O.length;t<r;++t)m[E]=P+$[2*t],f[E]=P+$[2*t+1],v[E]=O[t],E+=1;for(p[n]=P,y[n]=F,t=0;t<F;++t)g[P]=n,b[P]=H[t],P+=1}const R=s.bondAtomList;if(R)for(s.bondOrderList&&v.set(s.bondOrderList,E),n=0,e=R.length;n<e;n+=2){const F=R[n],H=R[n+1];F<l&&H<l&&(m[E]=F,f[E]=H,E+=1)}o.bondStore.length=v.length,o.bondStore.count=E,o.bondStore.atomIndex1=m,o.bondStore.atomIndex2=f,o.bondStore.bondOrder=v,o.atomStore.length=l,o.atomStore.count=l,o.atomStore.residueIndex=g,o.atomStore.atomTypeId=new Uint16Array(l),o.atomStore.x=s.xCoordList.subarray(0,l),o.atomStore.y=s.yCoordList.subarray(0,l),o.atomStore.z=s.zCoordList.subarray(0,l),o.atomStore.serial=s.atomIdList.subarray(0,l),o.atomStore.bfactor=s.bFactorList.subarray(0,l),o.atomStore.altloc=s.altLocList.subarray(0,l),o.atomStore.occupancy=s.occupancyList.subarray(0,l),o.atomStore.formalCharge=b,o.residueStore.length=c,o.residueStore.count=c,o.residueStore.chainIndex=S,o.residueStore.residueTypeId=s.groupTypeList,o.residueStore.atomOffset=p,o.residueStore.atomCount=y,o.residueStore.resno=s.groupIdList.subarray(0,c),o.residueStore.sstruc=s.secStructList.subarray(0,c),o.residueStore.inscode=s.insCodeList.subarray(0,c),o.chainStore.length=u,o.chainStore.count=u,o.chainStore.entityIndex=new Uint16Array(u),o.chainStore.modelIndex=w,o.chainStore.residueOffset=x,o.chainStore.residueCount=_,o.chainStore.chainname=s.chainNameList.subarray(0,4*u),o.chainStore.chainid=s.chainIdList.subarray(0,4*u),o.modelStore.length=d,o.modelStore.count=d,o.modelStore.chainOffset=A,o.modelStore.chainCount=C;let B={};for(n=0,e=s.groupList.length;n<e;++n){const F=s.groupList[n],H=[];for(t=0,r=F.atomNameList.length;t<r;++t){const Q=F.elementList[t].toUpperCase(),ce=F.atomNameList[t];H.push(o.atomMap.add(ce,Q))}const $=F.chemCompType.toUpperCase(),O=ZG.includes($),k=F.bondOrderList.length,X=new Array(k),ie=new Array(k);for(t=0;t<k;++t)X[t]=F.bondAtomList[2*t],ie[t]=F.bondAtomList[2*t+1];const ne={atomIndices1:X,atomIndices2:ie,bondOrders:F.bondOrderList};B[n]=o.residueMap.add(F.groupName,H,O,$,ne)}for(n=0,e=c;n<e;++n)o.residueStore.residueTypeId[n]=B[o.residueStore.residueTypeId[n]];for(n=0,e=o.atomStore.count;n<e;++n){const F=o.atomStore.residueIndex[n],H=o.residueMap.list[o.residueStore.residueTypeId[F]],$=o.residueStore.atomOffset[F];o.atomStore.atomTypeId[n]=H.atomTypeIdList[n-$]}if(s.secStructList){const F=s.secStructList.length;for(n=0,e=o.residueStore.count;n<e;++n){const H=DY[o.residueStore.sstruc[n%F]];H!==void 0&&(o.residueStore.sstruc[n]=H)}}if(s.entityList&&s.entityList.forEach(function(F,H){o.entityList[H]=new Rp(o,H,F.description,F.type,F.chainIndexList)}),s.bioAssemblyList&&s.bioAssemblyList.forEach(function(F,H){const $=H+1,O=new Js(""+$);o.biomolDict["BU"+$]=O;let k={};F.transformList.forEach(function(X){const ie=new at().fromArray(X.matrix).transpose(),ne=X.chainIndexList.map(function(ce){let Z="";for(let re=0;re<4;++re){const se=s.chainNameList[4*ce+re];if(!se)break;Z+=String.fromCharCode(se)}return Z}),Q=k[ne.toString()];Q?Q.matrixList.push(ie):k[ne.toString()]=O.addPart([ie],ne)})}),s.ncsOperatorList){const F="NCS",H=new Js(F),$=H.addPart();s.ncsOperatorList.forEach(function(O){const k=new at().fromArray(O).transpose();$.matrixList.push(k)}),$.matrixList.length>0&&(o.biomolDict[F]=H)}const L=s.unitCell;L&&Array.isArray(L)&&L[0]?o.unitcell=new Ip({a:L[0],b:L[1],c:L[2],alpha:L[3],beta:L[4],gamma:L[5],spacegroup:s.spaceGroup}):o.unitcell=void 0,Xc(o,!0),qc(o,!0),o.finalizeAtoms(),o.finalizeBonds(),Sp(o),Xe&&Be.timeEnd("MmtfParser._parse "+this.name)}});const W0=/\s+/,LY={1:1,2:2,3:3,am:1,ar:1,du:1,un:1,nc:0};It.add("mol2",class extends ds{get type(){return"mol2"}_parse(){Xe&&Be.time("Mol2Parser._parse "+this.name);const n=this.structure,e=this.structureBuilder,t=this.firstModelOnly,r=this.asTrajectory,i=n.frames;let o,s,a=!1;const l=n.atomMap,c=n.atomStore;c.resize(Math.round(this.streamer.data.length/60)),c.addField("partialCharge",1,"float32");let u=0,d=0,h=0,m=-1,f=0,v=0;const g=n.getAtomProxy(),b=n.getAtomProxy();this.streamer.eachChunkOfLines(function(S){(function(p,y,w){for(let x=p;x<y;++x){const _=w[x].trim();if(_!==""&&_[0]!=="#"){if(_[0]==="@")_==="@<TRIPOS>MOLECULE"?(v=1,d=0,++m):_==="@<TRIPOS>ATOM"?(v=2,h=c.count,r&&(s=0,o=new Float32Array(3*f),i.push(o),m>0&&(a=!0))):v=_==="@<TRIPOS>BOND"?3:0;else if(v===1){if(d===0)n.title=_,n.id=_;else if(d===1){const A=_.split(W0);f=parseInt(A[0])}++d}else if(v===2){const A=_.split(W0);if(t&&m>0)continue;const C=parseFloat(A[2]),T=parseFloat(A[3]),I=parseFloat(A[4]);if(r){const F=3*s;if(o[F+0]=C,o[F+1]=T,o[F+2]=I,s+=1,a)continue}const M=A[0],P=A[1],E=A[5].split(".")[0],R=A[6]?parseInt(A[6]):1,B=A[7]?A[7]:"",L=A[8]?parseFloat(A[8]):0;c.growIfFull(),c.atomTypeId[u]=l.add(P,E),c.x[u]=C,c.y[u]=T,c.z[u]=I,c.serial[u]=+M,c.partialCharge[u]=L,e.addAtom(m,"","",B,R,!0),u+=1}else if(v===3){if(t&&m>0||r&&m>0)continue;const A=_.split(W0);g.index=parseInt(A[1])-1+h,b.index=parseInt(A[2])-1+h;const C=LY[A[3]];n.bondStore.addBond(g,b,C)}}}})(0,S.length,S)}),e.finalize(),n.finalizeAtoms(),Am(n),qc(n,!0),Xc(n,!0),n.finalizeBonds(),sl(n),Cm(n),Xe&&Be.timeEnd("Mol2Parser._parse "+this.name)}});It.add("pdbqt",class extends Ju{get type(){return"pdbqt"}});It.add("pqr",class extends Ju{get type(){return"pqr"}});const FY=/> +<(.+)>/;class j0 extends ds{get type(){return"sdf"}_parse(){Xe&&Be.time("SdfParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,r=this.firstModelOnly,i=this.asTrajectory,o=this.streamer.peekLines(2);e.id=o[0].trim(),e.title=o[1].trim();const s=e.frames;let a,l,c=!1;const u=e.atomMap,d=e.atomStore;d.resize(Math.round(this.streamer.data.length/50)),d.addField("formalCharge",1,"int8");const h=e.getAtomProxy(),m=e.getAtomProxy();let f=0,v=0,g=0,b=0;const S=[];let p,y,w,x,_,A,C,T,I,M,P,E,R,B,L=!1,F={};e.extraData.sdf=S;let H=!1,$=!1,O=!1,k=[],X=[];const ie=new Map;this.streamer.eachChunkOfLines(function(ne){(function(Q,ce,Z){for(let re=Q;re<ce;++re){const se=Z[re];if(H&&se&&(k=se.substring(7).split(" "),X.length&&(k=[...X,...k],X=[]),k[k.length-1]==="-"))k.pop(),X=k;else{if(se.substr(0,4)==="$$$$")v=-1,++g,b=d.count,S.push(F),F={},L=!1,H=!1;else if(v===3)H=se.indexOf(" V3000")>-1,H?ie.clear():(y=parseInt(se.substr(0,3)),w=parseInt(se.substr(3,3)),x=4,_=x+y,A=_,C=A+w,i&&(l=0,a=new Float32Array(3*y),s.push(a),g>0&&(c=!0)));else if(H&&k[0]==="COUNTS")y=parseInt(k[1]),i&&(l=0,a=new Float32Array(3*y),s.push(a),g>0&&(c=!0));else if(H&&k.length==2)k[1]==="ATOM"?k[0]==="BEGIN"?$=!0:k[0]==="END"&&($=!1):k[1]==="BOND"&&(k[0]==="BEGIN"?O=!0:k[0]==="END"&&(O=!1));else if($||!H&&v>=x&&v<_){if(r&&g>0)continue;let fe=0;if(H){if(T=parseFloat(k[2]),I=parseFloat(k[3]),M=parseFloat(k[4]),E=k[1],R=parseInt(k[0]),ie.set(R,f),P=E+R,k.length>6){let ue=k.slice(6).find(U=>U.indexOf("CHG=")===0);ue&&(fe=parseInt(ue.substring(4)))}}else T=parseFloat(se.substr(0,10)),I=parseFloat(se.substr(10,10)),M=parseFloat(se.substr(20,10)),E=se.substr(31,3).trim(),P=E+(f-b+1);if(i){const ue=3*l;if(a[ue+0]=T,a[ue+1]=I,a[ue+2]=M,l+=1,c)continue}d.growIfFull(),d.atomTypeId[f]=u.add(P,E),d.x[f]=T,d.y[f]=I,d.z[f]=M,d.serial[f]=H?R:f,d.formalCharge[f]=fe,t.addAtom(g,"","","HET",1,!0),f+=1}else if(O||!H&&v>=A&&v<C){if(r&&g>0||i&&g>0)continue;H?(h.index=ie.get(parseInt(k[2])),m.index=ie.get(parseInt(k[3])),B=parseInt(k[1])):(h.index=parseInt(se.substr(0,3))-1+b,m.index=parseInt(se.substr(3,3))-1+b,B=parseInt(se.substr(6,3))),e.bondStore.addBond(h,m,B)}else if(se.substr(0,6)==="M  CHG"){const fe=parseInt(se.substr(6,3));for(let ue=0,U=10;ue<fe;++ue,U+=8){const K=parseInt(se.substr(U,3))-1+b,be=parseInt(se.substr(U+4,3));d.formalCharge[K]=be}}else se.charAt(0)===">"&&(p=se.match(FY))?(L=p[1],F[L]=[]):L!==!1&&se&&F[L].push(se);++v}}})(0,ne.length,ne)}),t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),sl(e),Xe&&Be.timeEnd("SdfParser._parse "+this.name)}_postProcess(){sl(this.structure)}}It.add("sdf",j0),It.add("sd",j0),It.add("mol",j0);function bu(n,e,t){return parseInt(n.substr(e,t).trim())}class _C extends ds{get type(){return"prmtop"}_parse(){Xe&&Be.time("PrmtopParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,r=e.atomMap,i=e.atomStore;i.addField("partialCharge",1,"float32"),i.addField("radius",1,"float32");const o=[],s={},a=["NATOM","NTYPES","NBONH","MBONA","NTHETH","MTHETA","NPHIH","MPHIA","NHPARM","NPARM","NNB","NRES","NBONA","NTHETA","NPHIA","NUMBND","NUMANG","NPTRA","NATYP","NPHB","IFPERT","NBPER","NGPER","NDPER","MBPER","MGPER","MDPER","IFBOX","NMXRS","IFCAP","NUMEXTRA","NCOPY"];let l,c,u,d,h;a.forEach(_=>{s[_]=0});let m,f,v,g,b,S=new Uint8Array(0);this.streamer.eachChunkOfLines(function(_){(function(A,C,T){for(let I=A;I<C;++I){const M=T[I],P=M.trim();if(P&&!M.startsWith("%FORMAT")){if(M.startsWith("%FLAG")){const E=M.substr(5).trim();g=0,E==="TITLE"?v=0:E==="POINTERS"?v=1:E==="ATOM_NAME"?v=2:E==="CHARGE"?v=3:E==="MASS"?v=4:E==="RESIDUE_LABEL"?v=5:E==="RESIDUE_POINTER"?v=6:E==="BONDS_INC_HYDROGEN"?(b=0,v=7):E==="BONDS_WITHOUT_HYDROGEN"?(b=s.NBONH,v=8):v=E==="RADII"?9:void 0}else if(v===0)o.push(P);else if(v===1){const E=Math.min(g+10,32);for(let B=0;g<E;++B,++g)s[a[g]]=parseInt(M.substr(8*B,8).trim());l=new Array(s.NATOM),c=new Float32Array(s.NATOM),u=new Float32Array(s.NATOM),i.resize(s.NATOM);const R=s.NBONH+s.MBONA;d=new Uint32Array(R),h=new Uint32Array(R),S=new Uint8Array(R),m=new Array(s.NRES),f=new Uint32Array(s.NRES)}else if(v===2){const E=Math.min(g+20,s.NATOM);for(let R=0;g<E;++R,++g)l[g]=M.substr(4*R,4).trim()}else if(v===3){const E=Math.min(g+5,s.NATOM);for(let R=0;g<E;++R,++g)c[g]=parseFloat(M.substr(16*R,16))/18.2223}else if(v!==4){if(v===5){const E=Math.min(g+20,s.NRES);for(let R=0;g<E;++R,++g)m[g]=M.substr(4*R,4).trim()}else if(v===6){const E=Math.min(g+10,s.NRES);for(let R=0;g<E;++R,++g)f[g]=bu(M,8*R,8)}else if(v===7){const E=Math.min(g+10,3*s.NBONH);for(let R=0;g<E;++R,++g){const B=g%3;B===0&&(d[b]=bu(M,8*R,8)/3),B===1&&(h[b]=bu(M,8*R,8)/3,S[b]=1,++b)}}else if(v===8){const E=Math.min(g+10,3*s.MBONA);for(let R=0;g<E;++R,++g){const B=g%3;B===0&&(d[b]=bu(M,8*R,8)/3),B===1&&(h[b]=bu(M,8*R,8)/3,S[b]=1,++b)}}else if(v===9){const E=Math.min(g+5,s.NATOM);for(let R=0;g<E;++R,++g)u[g]=parseFloat(M.substr(16*R,16))}}}}})(0,_.length,_)}),e.title=o.join(" ");const p=s.NATOM;let y=0,w=m[0],x=1;for(let _=0;_<p;++_)_+1===f[y+1]&&(++y,w=m[y],x=y+1),i.atomTypeId[_]=r.add(l[_]),i.serial[_]=_+1,t.addAtom(0,"","",w,x,!1);i.partialCharge.set(c),i.radius.set(u),e.bondStore.length=S.length,e.bondStore.count=S.length,e.bondStore.atomIndex1=d,e.bondStore.atomIndex2=h,e.bondStore.bondOrder=S,t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),qc(e,!0),Xc(e,!0,!0),Am(e,!0),sl(e),Xe&&Be.timeEnd("PrmtopParser._parse "+this.name)}}It.add("prmtop",_C),It.add("parm7",_C);const uf=/\s+/,OY=/(^\*|REMARK)*/;It.add("psf",class extends ds{get type(){return"psf"}_parse(){Xe&&Be.time("PsfParser._parse "+this.name);const n=this.structure,e=this.structureBuilder,t=n.atomMap,r=n.atomStore;r.addField("partialCharge",1,"float32");const i=[];let o,s,a,l,c,u,d=0,h=0,m=0;this.streamer.eachChunkOfLines(function(f){(function(v,g,b){for(let S=v;S<g;++S){const p=b[S].trim();if(p){if(o===2){const y=p.split(uf),w=parseInt(y[0]),x=y[1],_=parseInt(y[2]),A=y[3],C=y[4],T=parseFloat(y[6]);x!==a&&(s=Cd(h),++h),r.growIfFull(),r.atomTypeId[d]=t.add(C),r.serial[d]=w,r.partialCharge[d]=T,e.addAtom(0,s,s,A,_,!1),d+=1,a=x}else if(o===3){const y=p.split(uf);for(let w=0,x=y.length;w<x;w+=2)l[m]=parseInt(y[w])-1,c[m]=parseInt(y[w+1])-1,u[m]=1,m+=1}else if(o===1)i.push(p.replace(OY,"").trim());else if(o!==4){if(o!==5){if(o!==6)if(p.includes("!NATOM")){o=2;const y=parseInt(p.split(uf)[0]);r.resize(y)}else if(p.includes("!NBOND")){o=3;const y=parseInt(p.split(uf)[0]);l=new Uint32Array(y),c=new Uint32Array(y),u=new Uint8Array(y)}else p.includes("!NTITLE")?o=1:p.includes("!NTHETA")?o=4:p.includes("!NPHI")?o=5:p.includes("!NIMPHI")&&(o=6)}}}else o=void 0}})(0,f.length,f)}),n.title=i.join(" "),n.bondStore.length=u.length,n.bondStore.count=m,n.bondStore.atomIndex1=l,n.bondStore.atomIndex2=c,n.bondStore.bondOrder=u,e.finalize(),n.finalizeAtoms(),n.finalizeBonds(),qc(n,!0),Xc(n,!0,!0),sl(n),Xe&&Be.timeEnd("PsfParser._parse "+this.name)}});const kY=/\[ (.+) \]/,df=/\s+/;It.add("top",class extends ds{get type(){return"top"}_parse(){Xe&&Be.time("TopParser._parse "+this.name);const n=this.structure,e=this.structureBuilder,t=n.atomMap,r=n.bondStore,i=n.atomStore;i.addField("partialCharge",1,"float32");const o=[],s={};let a,l;this.streamer.eachChunkOfLines(function(S){(function(p,y,w){for(let x=p;x<y;++x){const _=w[x];let A=_.trim();if(!A||A[0]==="*"||A[0]===";")continue;if(A.startsWith("#include"))throw new Error("TopParser: #include statements not allowed");const C=_.match(kY);if(C!==null){const I=C[1];I==="moleculetype"?(l=2,a={atoms:[],bonds:[]}):l=I==="atoms"?3:I==="bonds"?4:I==="system"?0:I==="molecules"?1:void 0;continue}const T=A.indexOf(";");if(T!==-1&&(A=A.substring(0,T).trim()),l===2){const I=A.split(df)[0];s[I]=a}else if(l===3){const I=A.split(df);a.atoms.push([parseInt(I[2]),I[3],I[4],parseFloat(I[6])])}else if(l===4){const I=A.split(df);a.bonds.push([parseInt(I[0]),parseInt(I[1])])}else if(l===0)n.title=A;else if(l===1){const I=A.split(df);o.push([I[0],parseInt(I[1])])}}})(0,S.length,S)});let c=0,u=0;o.forEach(function(S){const[p,y]=S,w=s[p];c+=y*w.atoms.length,u+=y*w.bonds.length}),i.resize(c),r.resize(u);let d,h=0,m=0,f=0,v=0,g=0,b=0;o.forEach(function(S){const[p,y]=S,w=s[p],x=Cd(v);for(let _=0;_<y;++_){d=-1;const A=_p.includes(p)?x:Cd(f);w.atoms.forEach(function(C){const[T,I,M,P]=C;T!==d&&++m,i.atomTypeId[h]=t.add(M),i.serial[h]=h+1,i.partialCharge[h]=P,e.addAtom(0,x,A,I,m+1,!1),++h,d=T}),w.bonds.forEach(function(C){r.atomIndex1[g]=b+C[0]-1,r.atomIndex2[g]=b+C[1]-1,++g}),++f,b+=w.atoms.length}++v}),r.count=u,e.finalize(),n.finalizeAtoms(),n.finalizeBonds(),qc(n,!0),Xc(n,!0,!0),sl(n),Xe&&Be.timeEnd("TopParser._parse "+this.name)}});class Rm extends eo{constructor(e,t){super(e,t),this.frames=new EP(this.name,this.path)}get type(){return"trajectory"}get __objName(){return"frames"}}function si(n,e){if(n)throw new TypeError("Not a valid NetCDF v3.x file: "+e)}function nR(n){n.offset%4!=0&&n.skip(4-n.offset%4)}function Dv(n){const e=n.readUint32(),t=n.readChars(e);return nR(n),t}It.add("dcd",class extends Rm{get type(){return"dcd"}get isBinary(){return!0}_parse(){Xe&&Be.time("DcdParser._parse "+this.name);const n=Gc(this.streamer.data),e=new DataView(n),t=this.frames,r=t.coordinates,i=t.boxes,o={};let s=0;const a=new Int32Array(n,0,23),l=a[0]!==e.getInt32(0);if(a[0]!==84){const g=n.byteLength;for(let b=0;b<g;b+=4)e.setFloat32(b,e.getFloat32(b),!0)}a[0]!==84&&Be.error("dcd bad format, header block start"),String.fromCharCode(e.getUint8(4),e.getUint8(5),e.getUint8(6),e.getUint8(7))!=="CORD"&&Be.error("dcd bad format, format string");let c=!1,u=!1,d=!1;a[22]!==0&&(c=!0,a[12]!==0&&(u=!0),a[13]===1&&(d=!0)),o.NSET=a[2],o.ISTART=a[3],o.NSAVC=a[4],o.NAMNF=a[10],o.DELTA=c?e.getFloat32(44,l):e.getFloat64(44,l),a[22]!==84&&Be.error("dcd bad format, header block end"),s=s+84+8;const h=e.getInt32(s,l),m=s+1;if((h-4)%80!=0&&Be.error("dcd bad format, title block start"),o.TITLE=vd(new Uint8Array(n,m,h)),e.getInt32(m+h+4-1,l)!==h&&Be.error("dcd bad format, title block end"),s=s+h+8,e.getInt32(s,l)!==4&&Be.error("dcd bad format, natom block start"),o.NATOM=e.getInt32(s+4,l),e.getInt32(s+8,l)!==4&&Be.error("dcd bad format, natom block end"),s=s+4+8,o.NAMNF>0)return void Be.error("dcd format with fixed atoms unsupported, aborting");const f=o.NATOM,v=4*f;for(let g=0,b=o.NSET;g<b;++g){if(u){s+=4;const p=new Float32Array(9);p[0]=e.getFloat64(s,l),p[4]=e.getFloat64(s+16,l),p[8]=e.getFloat64(s+40,l),i.push(p),s+=48,s+=4}const S=new Float32Array(3*f);for(let p=0;p<3;++p){e.getInt32(s,l)!==v&&Be.error("dcd bad format, coord block start",g,p),s+=4;const y=new Float32Array(n,s,f);for(let w=0;w<f;++w)S[3*w+p]=y[w];s+=v,e.getInt32(s,l)!==v&&Be.error("dcd bad format, coord block end",g,p),s+=4}r.push(S),d&&(s+=4+e.getInt32(s,l)+4)}o.DELTA&&(t.deltaTime=20.45482949774598*o.DELTA),o.ISTART>=1&&(t.timeOffset=(o.ISTART-1)*t.deltaTime),Xe&&Be.timeEnd("DcdParser._parse "+this.name)}});const Ln={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function rR(n){switch(Number(n)){case Ln.BYTE:return"byte";case Ln.CHAR:return"char";case Ln.SHORT:return"short";case Ln.INT:return"int";case Ln.FLOAT:return"float";case Ln.DOUBLE:return"double";default:return"undefined"}}function xC(n){switch(Number(n)){case Ln.BYTE:case Ln.CHAR:return 1;case Ln.SHORT:return 2;case Ln.INT:case Ln.FLOAT:return 4;case Ln.DOUBLE:return 8;default:return-1}}function wC(n){switch(String(n)){case"byte":return Ln.BYTE;case"char":return Ln.CHAR;case"short":return Ln.SHORT;case"int":return Ln.INT;case"float":return Ln.FLOAT;case"double":return Ln.DOUBLE;default:return-1}}function hf(n,e){if(n!==1){const t=new Array(n);for(let r=0;r<n;r++)t[r]=e();return t}return e()}function Lv(n,e,t){switch(e){case Ln.BYTE:return n.readBytes(t);case Ln.CHAR:return function(r){return r.charCodeAt(r.length-1)===0?r.substring(0,r.length-1):r}(n.readChars(t));case Ln.SHORT:return hf(t,n.readInt16.bind(n));case Ln.INT:return hf(t,n.readInt32.bind(n));case Ln.FLOAT:return hf(t,n.readFloat32.bind(n));case Ln.DOUBLE:return hf(t,n.readFloat64.bind(n));default:return void si(!0,"non valid type "+e)}}const rc=0,BY=10,NY=11,zY=12;function UY(n,e){const t={recordDimension:{length:n.readUint32()}};t.version=e;const r=function(o){let s,a,l;const c=o.readUint32();if(c===rc)return si(o.readUint32()!==rc,"wrong empty tag for list of dimensions"),[];{si(c!==BY,"wrong tag for list of dimensions");const u=o.readUint32();s=new Array(u);for(let d=0;d<u;d++){const h=Dv(o),m=o.readUint32();m===0&&(a=d,l=h),s[d]={name:h,size:m}}return{dimensions:s,recordId:a,recordName:l}}}(n);t.recordDimension.id=r.recordId,t.recordDimension.name=r.recordName,t.dimensions=r.dimensions,t.globalAttributes=SC(n);const i=function(o,s,a){const l=o.readUint32();let c,u=0;if(l===rc)return si(o.readUint32()!==rc,"wrong empty tag for list of variables"),[];{si(l!==NY,"wrong tag for list of variables");const d=o.readUint32();c=new Array(d);for(let h=0;h<d;h++){const m=Dv(o),f=o.readUint32(),v=new Array(f);for(let y=0;y<f;y++)v[y]=o.readUint32();const g=SC(o),b=o.readUint32();si(b<1&&b>6,"non valid type "+b);const S=o.readUint32();let p=o.readUint32();a===2&&(si(p>0,"offsets larger than 4GB not supported"),p=o.readUint32()),v[0]===s&&(u+=S),c[h]={name:m,dimensions:v,attributes:g,type:rR(b),size:S,offset:p,record:v[0]===s}}}return{variables:c,recordStep:u}}(n,r.recordId,e);return t.variables=i.variables,t.recordDimension.recordStep=i.recordStep,t}function SC(n){let e;const t=n.readUint32();if(t===rc)return si(n.readUint32()!==rc,"wrong empty tag for list of attributes"),[];{si(t!==zY,"wrong tag for list of attributes");const r=n.readUint32();e=new Array(r);for(let i=0;i<r;i++){const o=Dv(n),s=n.readUint32();si(s<1||s>6,"non valid type "+s);const a=n.readUint32(),l=Lv(n,s,a);nR(n),e[i]={name:o,type:rR(s),value:l}}}return e}class iR{constructor(e){const t=new wG(e);t.setBigEndian(),si(t.readChars(3)!=="CDF","should start with CDF");const r=t.readByte();si(r>2,"unknown version"),this.header=UY(t,r),this.buffer=t}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(e){return this.header.variables.findIndex(function(t){return t.name===e})!==-1}getDataVariable(e){let t;return t=typeof e=="string"?this.header.variables.find(function(r){return r.name===e}):e,si(t===void 0,"variable not found"),this.buffer.seek(t.offset),t.record?function(r,i,o){const s=wC(i.type),a=i.size?i.size/xC(s):1,l=o.length,c=new Array(l),u=o.recordStep;for(let d=0;d<l;d++){const h=r.offset;c[d]=Lv(r,s,a),r.seek(h+u)}return c}(this.buffer,t,this.header.recordDimension):function(r,i){const o=wC(i.type),s=i.size/xC(o),a=new Array(s);for(let l=0;l<s;l++)a[l]=Lv(r,o,1);return a}(this.buffer,t)}}class q0 extends Rm{get type(){return"nctraj"}get isBinary(){return!0}_parse(){Xe&&Be.time("NctrajParser._parse "+this.name);const e=new iR(this.streamer.data),t=this.frames,r=t.coordinates,i=t.boxes,o=t.times;e.getDataVariable("coordinates").forEach(function(s){r.push(new Float32Array(s))}),e.hasDataVariable("cell_lengths")&&e.getDataVariable("cell_lengths").forEach(function(s){i.push(new Float32Array(s))}),e.hasDataVariable("time")&&e.getDataVariable("time").forEach(function(s){o.push(s)}),o.length>=1&&(t.timeOffset=o[0]),o.length>=2&&(t.deltaTime=o[1]-o[0]),Xe&&Be.timeEnd("NctrajParser._parse "+this.name)}}It.add("nctraj",q0),It.add("ncdf",q0),It.add("nc",q0);It.add("trr",class extends Rm{get type(){return"trr"}get isBinary(){return!0}_parse(){Xe&&Be.time("TrrParser._parse "+this.name);const n=Gc(this.streamer.data),e=new DataView(n),t=this.frames,r=t.coordinates,i=t.boxes,o=t.times;let s=0;for(;;){s+=8;const a=e.getInt32(s);s+=4,s+=a;const l=e.getInt32(s+8),c=e.getInt32(s+12),u=e.getInt32(s+16),d=e.getInt32(s+28),h=e.getInt32(s+32),m=e.getInt32(s+36),f=e.getInt32(s+40);s+=52;const v=l/9,g=3*f;if(v===8?o.push(e.getFloat64(s)):o.push(e.getFloat32(s)),s+=2*v,l){const b=new Float32Array(9);if(v===8)for(let S=0;S<9;++S)b[S]=10*e.getFloat64(s),s+=8;else for(let S=0;S<9;++S)b[S]=10*e.getFloat32(s),s+=4;i.push(b)}if(s+=c,s+=u,d){let b;if(v===8){b=new Float32Array(g);for(let S=0;S<g;++S)b[S]=10*e.getFloat64(s),s+=8}else{const S=new Uint32Array(n,s,g);for(let p=0;p<g;++p){const y=S[p];S[p]=(255&y)<<24|(65280&y)<<8|y>>8&65280|y>>24&255}b=new Float32Array(n,s,g);for(let p=0;p<g;++p)b[p]*=10,s+=4}r.push(b)}if(s+=h,s+=m,s>=n.byteLength)break}o.length>=1&&(t.timeOffset=o[0]),o.length>=2&&(t.deltaTime=o[1]-o[0]),Xe&&Be.timeEnd("TrrParser._parse "+this.name)}});const jl=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]);function X0(n){let e=1,t=0;for(;n>=e&&t<32;)t++,e<<=1;return t}const yu=new Uint8Array(32);function $Y(n,e){let t=1,r=0;yu[0]=1;for(let o=0;o<n;o++){let s,a=0;for(s=0;s<t;s++)a+=yu[s]*e[o],yu[s]=255&a,a>>=8;for(;a!==0;)yu[s++]=255&a,a>>=8;t=s}let i=1;for(t--;yu[t]>=i;)r++,i*=2;return r+8*t}function Fa(n,e,t,r){const i=(1<<t)-1;let o=r[1],s=r[2],a=n[0],l=0;for(;t>=8;)s=s<<8|e[a++],l|=s>>o<<t-8,t-=8;return t>0&&(o<t&&(o+=8,s=s<<8|e[a++]),o-=t,l|=s>>o&(1<<t)-1),l&=i,n[0]=a,n[1]=o,n[2]=s,l}const Ni=new Int32Array(32);function CC(n,e,t,r,i,o,s){let a=0;for(Ni[1]=0,Ni[2]=0,Ni[3]=0;r>8;)Ni[a++]=Fa(n,e,8,s),r-=8;r>0&&(Ni[a++]=Fa(n,e,r,s));for(let l=t-1;l>0;l--){let c=0;for(let u=a-1;u>=0;u--){c=c<<8|Ni[u];const d=c/i[l]|0;Ni[u]=d,c-=d*i[l]}o[l]=c}o[0]=Ni[0]|Ni[1]<<8|Ni[2]<<16|Ni[3]<<24}It.add("xtc",class extends Rm{get type(){return"xtc"}get isBinary(){return!0}_parse(){Xe&&Be.time("XtcParser._parse "+this.name);const n=Gc(this.streamer.data),e=new DataView(n),t=this.frames,r=t.coordinates,i=t.boxes,o=t.times,s=new Int32Array(6),a=new Int32Array(3),l=new Int32Array(3),c=new Uint32Array(3),u=new Float32Array(3),d=new Float32Array(3);let h=0;const m=new Int32Array(3),f=new Uint32Array(m.buffer);for(;;){let v;const g=e.getInt32(h+4);h+=12;const b=3*g;o.push(e.getFloat32(h)),h+=4;const S=new Float32Array(9);for(let p=0;p<9;++p)S[p]=10*e.getFloat32(h),h+=4;if(i.push(S),g<=9){v=new Float32Array(g);for(let p=0;p<g;++p)v[p]=e.getFloat32(h),h+=4}else{m[0]=m[1]=m[2]=0,a[0]=a[1]=a[2]=0,c[0]=c[1]=c[2]=0,l[0]=l[1]=l[2]=0,u[0]=u[1]=u[2]=0,d[0]=d[1]=d[2]=0,v=new Float32Array(b);let p=0;const y=e.getInt32(h);h+=4;const w=e.getFloat32(h);let x;h+=4,s[0]=e.getInt32(h),s[1]=e.getInt32(h+4),s[2]=e.getInt32(h+8),s[3]=e.getInt32(h+12),s[4]=e.getInt32(h+16),s[5]=e.getInt32(h+20),a[0]=s[3]-s[0]+1,a[1]=s[4]-s[1]+1,a[2]=s[5]-s[2]+1,h+=24,(a[0]|a[1]|a[2])>16777215?(l[0]=X0(a[0]),l[1]=X0(a[1]),l[2]=X0(a[2]),x=0):x=$Y(3,a);let _=e.getInt32(h);h+=4;let A=_-1;A=9>A?9:A;let C=jl[A]/2|0,T=jl[_]/2|0;c[0]=c[1]=c[2]=jl[_];let I=4*Math.ceil(e.getInt32(h)/4);h+=4;const M=1/w;let P=0,E=0;const R=new Uint8Array(n,h);for(u[0]=u[1]=u[2]=0;E<y;){x===0?(u[0]=Fa(m,R,l[0],f),u[1]=Fa(m,R,l[1],f),u[2]=Fa(m,R,l[2],f)):CC(m,R,3,x,a,u,f),E++,u[0]+=s[0],u[1]+=s[1],u[2]+=s[2],d[0]=u[0],d[1]=u[1],d[2]=u[2];let B=0;if(Fa(m,R,1,f)===1&&(P=Fa(m,R,5,f),B=P%3,P-=B,B--),P>0){u[0]=u[1]=u[2]=0;for(let L=0;L<P;L+=3){if(CC(m,R,3,_,c,u,f),E++,u[0]+=d[0]-T,u[1]+=d[1]-T,u[2]+=d[2]-T,L===0){let F=u[0];u[0]=d[0],d[0]=F,F=u[1],u[1]=d[1],d[1]=F,F=u[2],u[2]=d[2],d[2]=F,v[p++]=d[0]*M,v[p++]=d[1]*M,v[p++]=d[2]*M}else d[0]=u[0],d[1]=u[1],d[2]=u[2];v[p++]=u[0]*M,v[p++]=u[1]*M,v[p++]=u[2]*M}}else v[p++]=u[0]*M,v[p++]=u[1]*M,v[p++]=u[2]*M;if(_+=B,B<0?(T=C,C=_>9?jl[_-1]/2|0:0):B>0&&(C=T,T=jl[_]/2|0),c[0]=c[1]=c[2]=jl[_],c[0]===0||c[1]===0||c[2]===0)return void console.error("(xdrfile error) Undefined error.")}h+=I}for(let p=0;p<b;p++)v[p]*=10;if(r.push(v),h>=n.byteLength)break}o.length>=1&&(t.timeOffset=o[0]),o.length>=2&&(t.deltaTime=o[1]-o[0]),Xe&&Be.timeEnd("XtcParser._parse "+this.name)}});class jd extends eo{constructor(e,t){const r=t||{};super(e,r),this.volume=new Wr(this.name,this.path),this.voxelSize=W(r.voxelSize,1)}get type(){return"volume"}get __objName(){return"volume"}_afterParse(){this.volume.setMatrix(this.getMatrix()),super._afterParse()}getMatrix(){return new at}}const HY=/\s+/,VY=/-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,ff=.529177210859;class AC extends jd{get type(){return"cube"}_parse(){Xe&&Be.time("CubeParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(6),r={},i=ff*this.voxelSize;function o(u,d){var h=t[u].trim().split(HY)[d];return parseFloat(h)}r.atomCount=Math.abs(o(2,0)),r.originX=o(2,1)*ff,r.originY=o(2,2)*ff,r.originZ=o(2,3)*ff,r.NVX=o(3,0),r.NVY=o(4,0),r.NVZ=o(5,0),r.basisX=new te(o(3,1),o(3,2),o(3,3)).multiplyScalar(i),r.basisY=new te(o(4,1),o(4,2),o(4,3)).multiplyScalar(i),r.basisZ=new te(o(5,1),o(5,2),o(5,3)).multiplyScalar(i);const s=new Float32Array(r.NVX*r.NVY*r.NVZ);let a=0,l=0;const c=o(2,0)>0?0:1;this.streamer.eachChunkOfLines(function(u){(function(d,h,m){for(let f=d;f<h;++f){const v=m[f].trim();if(v!==""&&l>=r.atomCount+6+c){const g=v.match(VY);for(let b=0,S=g.length;b<S;++b)s[a]=parseFloat(g[b]),++a}++l}})(0,u.length,u)}),e.header=r,e.setData(s,r.NVZ,r.NVY,r.NVX),Xe&&Be.timeEnd("CubeParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=new at;return t.multiply(new at().makeTranslation(e.originX,e.originY,e.originZ)),t.multiply(new at().makeBasis(e.basisZ,e.basisY,e.basisX)),t}}It.add("cub",AC),It.add("cube",AC);class MC extends jd{get type(){return"dsn6"}get isBinary(){return!0}_parse(){Xe&&Be.time("Dsn6Parser._parse "+this.name);const e=this.volume,t={};let r,i;const o=Gc(this.streamer.data),s=new Int16Array(o),a=new Uint8Array(o),l=String.fromCharCode.apply(null,a.subarray(0,512));if(l.startsWith(":-)"))t.xStart=parseInt(l.substr(10,5)),t.yStart=parseInt(l.substr(15,5)),t.zStart=parseInt(l.substr(20,5)),t.xExtent=parseInt(l.substr(32,5)),t.yExtent=parseInt(l.substr(38,5)),t.zExtent=parseInt(l.substr(42,5)),t.xRate=parseInt(l.substr(52,5)),t.yRate=parseInt(l.substr(58,5)),t.zRate=parseInt(l.substr(62,5)),t.xlen=parseFloat(l.substr(73,10))*this.voxelSize,t.ylen=parseFloat(l.substr(83,10))*this.voxelSize,t.zlen=parseFloat(l.substr(93,10))*this.voxelSize,t.alpha=parseFloat(l.substr(103,10)),t.beta=parseFloat(l.substr(113,10)),t.gamma=parseFloat(l.substr(123,10)),r=parseFloat(l.substr(138,12))/100,i=parseInt(l.substr(155,8)),t.sigma=100*parseFloat(l.substr(170,12));else{if(s[18]!==100)for(let C=0,T=s.length;C<T;++C){const I=s[C];s[C]=(255&I)<<8|I>>8&255}t.xStart=s[0],t.yStart=s[1],t.zStart=s[2],t.xExtent=s[3],t.yExtent=s[4],t.zExtent=s[5],t.xRate=s[6],t.yRate=s[7],t.zRate=s[8];const _=1/s[17],A=_*this.voxelSize;t.xlen=s[9]*A,t.ylen=s[10]*A,t.zlen=s[11]*A,t.alpha=s[12]*_,t.beta=s[13]*_,t.gamma=s[14]*_,r=s[15]/100,i=s[16],t.gamma=s[14]*_}e.header=t,Xe&&Be.log(t,r,i);const c=new Float32Array(t.xExtent*t.yExtent*t.zExtent);let u=512;const d=Math.ceil(t.xExtent/8),h=Math.ceil(t.yExtent/8),m=Math.ceil(t.zExtent/8);for(var f=0;f<m;++f)for(var v=0;v<h;++v)for(var g=0;g<d;++g)for(var b=0;b<8;++b)for(var S=8*f+b,p=0;p<8;++p)for(var y=8*v+p,w=0;w<8;++w){var x=8*g+w;if(!(x<t.xExtent&&y<t.yExtent&&S<t.zExtent)){u+=8-w;break}c[(x*t.yExtent+y)*t.zExtent+S]=(a[u]-i)/r,++u}e.setData(c,t.zExtent,t.yExtent,t.xExtent),t.sigma&&e.setStats(void 0,void 0,void 0,t.sigma),Xe&&Be.timeEnd("Dsn6Parser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],r=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],i=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const o=[[],t,r,i],s=[0,e.xRate,e.yRate,e.zRate],a=[0,1,2,3],l=new at;return l.set(o[a[1]][0]/s[a[1]],o[a[2]][0]/s[a[2]],o[a[3]][0]/s[a[3]],0,o[a[1]][1]/s[a[1]],o[a[2]][1]/s[a[2]],o[a[3]][1]/s[a[3]],0,o[a[1]][2]/s[a[1]],o[a[2]][2]/s[a[2]],o[a[3]][2]/s[a[3]],0,0,0,0,1),l.multiply(new at().makeRotationY(kn(90))),l.multiply(new at().makeTranslation(-e.zStart,e.yStart,e.xStart)),l.multiply(new at().makeScale(-1,1,1)),l}}It.add("dsn6",MC),It.add("brix",MC);const pf=/\s+/;class oR extends jd{get type(){return"dx"}_parse(){Xe&&Be.time("DxParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(30),r=this.parseHeaderLines(t),i=this.volume.header,o=r.dataLineStart,s=i.nx*i.ny*i.nz,a=new Float32Array(s);let l=0,c=0;this.streamer.eachChunkOfLines(function(u){(function(d,h,m){for(let f=d;f<h;++f){if(l<s&&c>o){const v=m[f].trim();if(v!==""){const g=v.split(pf);for(let b=0,S=g.length;b<S;++b)a[l]=parseFloat(g[b]),++l}}++c}})(0,u.length,u)}),e.setData(a,i.nz,i.ny,i.nx),Xe&&Be.timeEnd("DxParser._parse "+this.name)}parseHeaderLines(e){const t={},r=e.length;let i=0,o=0,s=0;for(let a=0;a<r;++a){let l;const c=e[a];if(c.startsWith("object 1"))l=c.split(pf),t.nx=parseInt(l[5]),t.ny=parseInt(l[6]),t.nz=parseInt(l[7]);else if(c.startsWith("origin"))l=c.split(pf),t.xmin=parseFloat(l[1]),t.ymin=parseFloat(l[2]),t.zmin=parseFloat(l[3]);else if(c.startsWith("delta"))l=c.split(pf),s===0?t.hx=parseFloat(l[1])*this.voxelSize:s===1?t.hy=parseFloat(l[2])*this.voxelSize:s===2&&(t.hz=parseFloat(l[3])*this.voxelSize),s+=1;else if(c.startsWith("object 3")){i=a,o+=c.length+1;break}o+=c.length+1}return this.volume.header=t,{dataLineStart:i,headerByteCount:o}}getMatrix(){const e=this.volume.header,t=new at;return t.multiply(new at().makeRotationY(kn(90))),t.multiply(new at().makeTranslation(-e.zmin,e.ymin,e.xmin)),t.multiply(new at().makeScale(-e.hz,e.hy,e.hx)),t}}It.add("dx",oR);It.add("dxbin",class extends oR{get type(){return"dxbin"}get isBinary(){return!0}_parse(){Xe&&Be.time("DxbinParser._parse "+this.name);const n=Gc(this.streamer.data),e=function(l,c=10485760,u=`
`){let d="",h=[];for(let m=0;m<l.length;m+=c){const f=vd(l.subarray(m,m+c)),v=f.lastIndexOf(u);if(v===-1)d+=f;else{const g=d+f.substr(0,v);h=h.concat(g.split(u)),d=v===f.length-u.length?"":f.substr(v+u.length)}}return d!==""&&h.push(d),h}(new Uint8Array(n,0,1e3)),t=this.parseHeaderLines(e),r=this.volume.header,i=t.headerByteCount,o=r.nx*r.ny*r.nz,s=new DataView(n),a=new Float32Array(o);for(let l=0;l<o;++l)a[l]=s.getFloat64(8*l+i,!0);this.volume.setData(a,r.nz,r.ny,r.nx),Xe&&Be.timeEnd("DxbinParser._parse "+this.name)}});class Y0 extends jd{get type(){return"mrc"}get isBinary(){return!0}_parse(){Xe&&Be.time("MrcParser._parse "+this.name);const e=this.volume,t={},r=Gc(this.streamer.data),i=new Int32Array(r,0,56),o=new Float32Array(r,0,56),s=new DataView(r);if(t.MAP=String.fromCharCode(s.getUint8(208),s.getUint8(209),s.getUint8(210),s.getUint8(211)),t.MACHST=[s.getUint8(212),s.getUint8(213)],t.MACHST[0]===17&&t.MACHST[1]===17){const l=r.byteLength;for(let c=0;c<l;c+=4)s.setFloat32(c,s.getFloat32(c),!0)}let a;if(t.NX=i[0],t.NY=i[1],t.NZ=i[2],t.MODE=i[3],t.NXSTART=i[4],t.NYSTART=i[5],t.NZSTART=i[6],t.MX=i[7],t.MY=i[8],t.MZ=i[9],t.xlen=o[10]*this.voxelSize,t.ylen=o[11]*this.voxelSize,t.zlen=o[12]*this.voxelSize,t.alpha=o[13],t.beta=o[14],t.gamma=o[15],t.MAPC=i[16],t.MAPR=i[17],t.MAPS=i[18],t.DMIN=o[19],t.DMAX=o[20],t.DMEAN=o[21],t.ISPG=i[22],t.NSYMBT=i[23],t.LSKFLG=i[24],t.originX=o[49],t.originY=o[50],t.originZ=o[51],t.ARMS=o[54],e.header=t,t.MODE===2)a=new Float32Array(r,1024+t.NSYMBT,t.NX*t.NY*t.NZ);else if(t.MODE===0){if(a=new Float32Array(new Int8Array(r,1024+t.NSYMBT,t.NX*t.NY*t.NZ)),i[39]===-128&&i[40]===127){const l=(t.DMAX-t.DMIN)/255,c=.5*(t.DMIN+t.DMAX+l);for(let u=0,d=a.length;u<d;++u)a[u]=l*a[u]+c}}else Be.error("MrcParser unknown mode",t.MODE);e.setData(a,t.NX,t.NY,t.NZ),t.ARMS!==0&&e.setStats(t.DMIN,t.DMAX,t.DMEAN,t.ARMS),Xe&&Be.timeEnd("MrcParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],r=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],i=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const o=[[],t,r,i],s=[0,e.MX,e.MY,e.MZ],a=[0,e.MAPC,e.MAPR,e.MAPS],l=new at;return l.set(o[a[1]][0]/s[a[1]],o[a[2]][0]/s[a[2]],o[a[3]][0]/s[a[3]],0,o[a[1]][1]/s[a[1]],o[a[2]][1]/s[a[2]],o[a[3]][1]/s[a[3]],0,o[a[1]][2]/s[a[1]],o[a[2]][2]/s[a[2]],o[a[3]][2]/s[a[3]],0,0,0,0,1),l.setPosition(new te(e.originX,e.originY,e.originZ)),l.multiply(new at().makeTranslation(e.NXSTART,e.NYSTART,e.NZSTART)),l}}It.add("mrc",Y0),It.add("ccp4",Y0),It.add("map",Y0);const GY=/\s+/;function K0(n){return n.trim().split(GY).map(parseFloat)}class TC extends jd{get type(){return"xplor"}_parse(){Xe&&Be.time("XplorParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(8),r={};let i;i=t[2].startsWith("REMARKS")?parseInt(t[1].substring(0,8))+2:5;const o=i+3,s=K0(t[i]);r.NA=s[0],r.AMIN=s[1],r.AMAX=s[2],r.NB=s[3],r.BMIN=s[4],r.BMAX=s[5],r.NC=s[6],r.CMIN=s[7],r.CMAX=s[8];const a=K0(t[i+1]);r.a=a[0]*this.voxelSize,r.b=a[1]*this.voxelSize,r.c=a[2]*this.voxelSize,r.alpha=a[3],r.beta=a[4],r.gamma=a[5];const l=r.AMAX-r.AMIN+1,c=r.BMAX-r.BMIN+1,u=r.CMAX-r.CMIN+1,d=l*c*u,h=new Float32Array(d),m=Math.ceil(1+l*c/6);let f=0,v=0;this.streamer.eachChunkOfLines(function(g){(function(b,S,p){for(let y=b;y<S;++y){const w=p[y];if(v>=o&&(v-o)%m!=0&&f<d)for(let x=0,_=6;x<_;++x){const A=parseFloat(w.substr(12*x,12));if(isNaN(A))break;h[f++]=A}else if(f===d){const x=w.trim();if(x&&x!=="-9999"){const _=K0(w);r.RAVE=_[0],r.RSIGMA=_[1]}}++v}})(0,g.length,g)}),e.header=r,e.setData(h,l,c,u),r.RAVE!==0&&r.RSIGMA!==1&&e.setStats(void 0,void 0,r.RAVE,r.RSIGMA),Xe&&Be.timeEnd("XplorParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.a,0,0],r=[e.b*Math.cos(Math.PI/180*e.gamma),e.b*Math.sin(Math.PI/180*e.gamma),0],i=[e.c*Math.cos(Math.PI/180*e.beta),e.c*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.c*e.c*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const o=[[],t,r,i],s=[0,e.NA,e.NB,e.NC],a=[0,1,2,3],l=new at;return l.set(o[a[1]][0]/s[a[1]],o[a[2]][0]/s[a[2]],o[a[3]][0]/s[a[3]],0,o[a[1]][1]/s[a[1]],o[a[2]][1]/s[a[2]],o[a[3]][1]/s[a[3]],0,o[a[1]][2]/s[a[1]],o[a[2]][2]/s[a[2]],o[a[3]][2]/s[a[3]],0,0,0,0,1),l.multiply(new at().makeTranslation(e.AMIN,e.BMIN,e.CMIN)),l}}function wn(n,e,t){let r,i,o;n/=360,e/=100,t/=100;const s=Math.floor(6*n),a=6*n-s,l=t*(1-e),c=t*(1-a*e),u=t*(1-(1-a)*e);switch(s%6){case 0:r=t,i=u,o=l;break;case 1:r=c,i=t,o=l;break;case 2:r=l,i=t,o=u;break;case 3:r=l,i=c,o=t;break;case 4:r=u,i=l,o=t;break;case 5:r=t,i=l,o=c}return[r,i,o]}It.add("xplor",TC),It.add("cns",TC);const Fv={red:wn(0,100,100),orange:wn(20,100,100),gold:wn(40,100,100),yellow:wn(60,100,100),lime:wn(80,100,100),green:wn(120,80,100),sea:wn(150,100,100),cyan:wn(180,100,85),sky:wn(210,75,95),blue:wn(240,70,100),purple:wn(275,75,100),magenta:wn(300,95,100),hotpink:wn(335,100,100),pink:wn(350,55,100),peach:wn(25,75,100),lilac:wn(275,55,100),pinktint:wn(340,30,100),peachtint:wn(25,50,100),yellowtint:wn(60,50,100),greentint:wn(135,40,100),bluetint:wn(220,40,100),lilactint:wn(275,35,100),white:wn(0,0,100),gray:wn(0,0,50),brown:wn(20,45,75),deadwhite:[1,1,1],deadblack:[0,0,0],invisible:[0,0,0]},WY=/[\s,]+/,sR=/[^{}\s]*{[^{}]+}|[^{}\s]+/g,Ov=/^{+|}+$/g,jY=/^['"]+|['"]+$/g,aR=/\s*=\s*/g;function mf(n){let e,t,r,i=[];const o=(n=n.replace(aR,"=")).match(sR);for(let s=1;s<o.length;++s){const a=o[s];if(a[0]==="{")e=a.substring(1,a.length-1);else{const l=a.split("=");l.length===2&&(l[0]==="color"?t=Fv[l[1]]:l[0]==="width"?r=parseInt(l[1]):l[0]==="master"&&i.push(l[1].replace(Ov,"")))}}return{listName:e,listColor:t,listMasters:i,listWidth:r}}function gf(n){const e=(n=n.trim()).indexOf("{"),t=n.indexOf("}"),r=n.substr(t+1).split(WY),i=n.substr(e+1,t-1),o=[parseFloat(r[r.length-3]),parseFloat(r[r.length-2]),parseFloat(r[r.length-1])];let s,a,l,c=!1,u=!1;for(let d=4;d<=r.length;d++){const h=r[r.length-d];h in Fv&&(s=Fv[r[r.length-d]]),h.startsWith("width")&&(a=parseInt(h.substring(5))),h.startsWith("r=")&&(l=parseFloat(h.split("=")[1])),h.startsWith("P")&&(c=!0),h.startsWith("X")&&(u=!0)}return{label:i,position:o,color:s,radius:l,width:a,isLineBreak:c,isTriangleBreak:u}}function Z0(n){const e=n.indexOf("{"),t=n.indexOf("}");return n.substring(e!==-1?e+1:0,t!==-1?t:void 0).trim()}function qY(n){const e=n.indexOf("}");return e===-1?void 0:n.substr(e+1).trim()}function J0(n){let e="",t=[],r={};const i=(n=n.replace(aR,"=")).match(sR);for(let o=1;o<i.length;++o){const s=i[o];if(s[0]==="{")e=s.substring(1,s.length-1);else{const a=s.split("=");a.length===2?a[0]==="master"?t.push(a[1].replace(Ov,"")):r[a[0]]=a[1].replace(Ov,""):r[a[0]]=!0}}return{groupName:e,groupFlags:r,groupMasters:t}}It.add("kin",class extends eo{get type(){return"kin"}get __objName(){return"kinemage"}_parse(){Xe&&Be.time(`KinParser._parse ${this.name}`);const n={kinemage:void 0,onewidth:void 0,"1viewid":void 0,pdbfile:void 0,texts:[],text:"",captions:[],caption:"",groupDict:{},subgroupDict:{},masterDict:{},pointmasterDict:{},dotLists:[],vectorLists:[],ballLists:[],ribbonLists:[]};let e,t;this.kinemage=n;let r,i,o,s,a,l,c,u,d,h,m,f,v,g,b,S,p,y,w,x,_,A,C=!1,T="",I=!1,M="",P=null,E=null,R=!1,B="",L=!1,F="",H=!1,$=!1;if(this.streamer.eachChunkOfLines(function(O){(function(k,X,ie){for(let Q=k;Q<X;++Q){const ce=ie[Q];if(ce[0]==="@"&&(C=!1,I=!1,R=!1,L=!1,H=!1,$=!1),ce)if(ce.startsWith("@dotlist")){let{listColor:Z,listName:re,listMasters:se}=mf(ce);C=!0,T="",i=[],o=[],s=[],r=Z,e&&(se=se.concat(e)),t&&(se=se.concat(t)),n.dotLists.push({name:re,masterArray:se,labelArray:i,positionArray:o,colorArray:s})}else if(ce.startsWith("@vectorlist")){let{listMasters:Z,listName:re,listWidth:se,listColor:fe}=mf(ce);Z&&Z.forEach(function(ue){n.masterDict[ue]||(n.masterDict[ue]={indent:!1,visible:!1})}),I=!0,M="",P=null,E=null,c=[],u=[],d=[],h=[],m=[],f=[],a=fe,l=[],se&&l.push(se),e&&(Z=Z.concat(e)),t&&(Z=Z.concat(t)),n.vectorLists.push({name:re,masterArray:Z,label1Array:c,label2Array:u,position1Array:d,position2Array:h,color1Array:m,color2Array:f,width:l})}else if(ce.startsWith("@balllist")){let{listName:Z,listColor:re,listMasters:se}=mf(ce);se&&se.forEach(function(fe){n.masterDict[fe]||(n.masterDict[fe]={indent:!1,visible:!1})}),R=!0,B="",b=[],v=[],S=[],p=[],g=re,e&&(se=se.concat(e)),t&&(se=se.concat(t)),n.ballLists.push({name:Z,masterArray:se,labelArray:b,radiusArray:v,positionArray:S,colorArray:p})}else if(ce.startsWith("@ribbonlist")||ce.startsWith("@trianglelist")){let{listMasters:Z,listName:re,listColor:se}=mf(ce);Z&&Z.forEach(function(fe){n.masterDict[fe]||(n.masterDict[fe]={indent:!1,visible:!1})}),L=!0,F="",w=[],x=[],_=[],A=[],y=se,e&&(Z=Z.concat(e)),t&&(Z=Z.concat(t)),n.ribbonLists.push({name:re,masterArray:Z,labelArray:w,positionArray:x,breakArray:_,colorArray:A})}else if(ce.startsWith("@text"))H=!0,n.texts.push(ce.substr(5));else if(ce.startsWith("@caption"))$=!0,n.captions.push(ce.substr(8));else if(C){let{label:Z,color:re,position:se}=gf(ce);Z==='"'?Z=T:T=Z,re===void 0&&(re=r),i.push(Z),o.push(...se),s.push(...re)}else if(I){let Z=ce.replace(/(?!^){/g,`
{`).split(/\n/);for(var ne=0;ne<Z.length;ne++){let re=Z[ne],{label:se,color:fe,width:ue,position:U,isLineBreak:K}=gf(re);se==='"'?se=M:M=se,fe===void 0&&(fe=a),K||P!==null&&(ue&&l.push(ue),c.push(M),d.push(...P),m.push(...E),u.push(se),h.push(...U),f.push(...fe)),M=se,P=U,E=fe}}else if(R){let{label:Z,radius:re,color:se,position:fe}=gf(ce);Z==='"'?Z=B:B=Z,re===void 0&&(re=1),se===void 0&&(se=g),b.push(Z),v.push(re),S.push(...fe),p.push(...se)}else if(L){let{label:Z,color:re,position:se,isTriangleBreak:fe}=gf(ce);Z==='"'?Z=F:F=Z,re===void 0&&(re=y),w.push(Z),x.push(...se),_.push(fe),A.push(...re)}else if(H)n.texts.push(ce);else if($)n.captions.push(ce);else if(ce.startsWith("@kinemage"))n.kinemage=parseInt(ce.substr(9).trim());else if(ce.startsWith("@onewidth"))n.onewidth=!0;else if(ce.startsWith("@1viewid"))n["1viewid"]=Z0(ce);else if(ce.startsWith("@pdbfile"))n.pdbfile=Z0(ce);else if(ce.startsWith("@group")){let{groupName:Z,groupFlags:re,groupMasters:se}=J0(ce);n.groupDict[Z]||(n.groupDict[Z]={dominant:!1,animate:!1},e=se),e&&e.forEach(function(fe){n.masterDict[fe]||(n.masterDict[fe]={indent:!1,visible:!1})});for(let fe in re)n.groupDict[Z][fe]=re[fe]}else if(ce.startsWith("@subgroup")){const{groupName:Z,groupFlags:re,groupMasters:se}=J0(ce);n.subgroupDict[Z]||(n.subgroupDict[Z]={dominant:!1,animate:!1},t=se),t&&t.forEach(function(fe){n.masterDict[fe]||(n.masterDict[fe]={indent:!1,visible:!1})});for(let fe in re)n.subgroupDict[Z][fe]=re[fe]}else if(ce.startsWith("@master")){const Z=Z0(ce),re=qY(ce);n.masterDict[Z]||(n.masterDict[Z]={indent:!1,visible:!1}),re==="on"?n.masterDict[Z].visible=!0:re==="off"?n.masterDict[Z].visible=!1:re==="indent"&&(n.masterDict[Z].indent=!0)}else if(ce.startsWith("@pointmaster")){const{groupName:Z,groupFlags:re}=J0(ce);n.pointmasterDict[Z]={id:Object.keys(re)[0].replace(jY,"")}}else console.log(ce);else C=!1,I=!1,R=!1,L=!1}})(0,O.length,O)}),n.text=n.texts.join(`
`).trim(),n.caption=n.captions.join(`
`).trim(),n.ribbonLists){let O=[];n.ribbonLists.forEach(function(k){O.push(function(X){let{labelArray:ie,positionArray:ne,colorArray:Q,breakArray:ce}=X,Z=[],re=[],se=[],fe=[];for(let ue=0;ue<ce.length/3;ue++){let U=3*ue,K=9*ue;ce[U+1]||ce[U+2]||(Z.push(ie[U]),Z.push(ie[U+1]),Z.push(ie[U+2]),fe.push(ce[U]),fe.push(ce[U+1]),fe.push(ce[U+2]),re.push(ne[K]),re.push(ne[K+1]),re.push(ne[K+2]),re.push(ne[K+3]),re.push(ne[K+4]),re.push(ne[K+5]),re.push(ne[K+6]),re.push(ne[K+7]),re.push(ne[K+8]),se.push(Q[K]),se.push(Q[K+1]),se.push(Q[K+2]),se.push(Q[K+3]),se.push(Q[K+4]),se.push(Q[K+5]),se.push(Q[K+6]),se.push(Q[K+7]),se.push(Q[K+8]))}return{name:X.name,masterArray:X.masterArray,labelArray:Z,positionArray:re,breakArray:fe,colorArray:se}}(function(X){let{labelArray:ie,positionArray:ne,colorArray:Q,breakArray:ce}=X,Z=[];for(let U=0;U<3*(ie.length-2);++U)Z[U]=ie[U-2*Math.floor(U/3)];let re=[];for(let U=0;U<3*(ce.length-2);++U)re[U]=ce[U-2*Math.floor(U/3)];let se=[];for(let U=0;U<9*(ne.length/3-2);++U)se[U]=ne[U-6*Math.floor(U/9)];let fe=[];for(let U=0;U<9*(Q.length/3-2);++U)fe[U]=Q[U-6*Math.floor(U/9)];let ue=[];for(let U=0;U<se.length/3;++U)ue.push(new te(se[3*U],se[3*U]+1,se[3*U]+2));return{name:X.name,masterArray:X.masterArray,labelArray:Z,positionArray:se,breakArray:re,colorArray:fe}}(k)))}),n.ribbonLists=O}Xe&&Be.timeEnd(`KinParser._parse ${this.name}`)}});class XY extends eo{constructor(e,t){super(e,t),this.loader=this.getLoader(),this.surface=new wm(this.name,this.path)}get type(){return"surface"}get __objName(){return"surface"}_parse(){var e=this.loader.parse(this.streamer.asText());this.surface.fromGeometry(e)}}const kv=function(){this.regexp={vertex_pattern:/^v\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,normal_pattern:/^vn\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,uv_pattern:/^vt\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};kv.prototype={constructor:kv,setPath:function(n){this.path=n},_createParserState:function(){var n={objects:[],object:{},vertices:[],normals:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);this.object={name:e||"",geometry:{vertices:[],normals:[]},fromDeclaration:t!==!1},this.objects.push(this.object)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},addVertex:function(e,t,r){var i=this.vertices,o=this.object.geometry.vertices;o.push(i[e+0]),o.push(i[e+1]),o.push(i[e+2]),o.push(i[t+0]),o.push(i[t+1]),o.push(i[t+2]),o.push(i[r+0]),o.push(i[r+1]),o.push(i[r+2])},addVertexLine:function(e){var t=this.vertices,r=this.object.geometry.vertices;r.push(t[e+0]),r.push(t[e+1]),r.push(t[e+2])},addNormal:function(e,t,r){var i=this.normals,o=this.object.geometry.normals;o.push(i[e+0]),o.push(i[e+1]),o.push(i[e+2]),o.push(i[t+0]),o.push(i[t+1]),o.push(i[t+2]),o.push(i[r+0]),o.push(i[r+1]),o.push(i[r+2])},addFace:function(e,t,r,i,o,s,a,l){var c,u=this.vertices.length,d=this.parseVertexIndex(e,u),h=this.parseVertexIndex(t,u),m=this.parseVertexIndex(r,u);if(i===void 0?this.addVertex(d,h,m):(c=this.parseVertexIndex(i,u),this.addVertex(d,h,c),this.addVertex(h,m,c)),o!==void 0){var f=this.normals.length;d=this.parseNormalIndex(o,f),h=o===s?d:this.parseNormalIndex(s,f),m=o===a?d:this.parseNormalIndex(a,f),i===void 0?this.addNormal(d,h,m):(c=this.parseNormalIndex(l,f),this.addNormal(d,h,c),this.addNormal(h,m,c))}},addLineGeometry:function(e){this.object.geometry.type="Line";for(var t=this.vertices.length,r=0,i=e.length;r<i;r++)this.addVertexLine(this.parseVertexIndex(e[r],t))}};return n.startObject("",!1),n},parse:function(n){var e,t,r=this._createParserState();n.indexOf(`\r
`)!==-1&&(n=n.replace(/\r\n/g,`
`)),n.indexOf(`\\
`)!==-1&&(n=n.replace(/\\\n/g,""));var i=n.split(`
`),o="",s="",a="",l=[],c=typeof"".trimLeft=="function";for(e=0,t=i.length;e<t;e++)if(o=i[e],(o=c?o.trimLeft():o.trim()).length!==0&&(s=o.charAt(0))!=="#"){if(s==="v"){if((a=o.charAt(1))===" "&&(l=this.regexp.vertex_pattern.exec(o))!==null)r.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if(a==="n"&&(l=this.regexp.normal_pattern.exec(o))!==null)r.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if(a!=="t"||this.regexp.uv_pattern.exec(o)===null)throw new Error("Unexpected vertex/normal/uv line: '"+o+"'")}else if(s==="f"){if((l=this.regexp.face_vertex_uv_normal.exec(o))!==null)r.addFace(l[1],l[4],l[7],l[10],l[3],l[6],l[9],l[12]);else if(this.regexp.face_vertex_uv.exec(o)===null)if((l=this.regexp.face_vertex_normal.exec(o))!==null)r.addFace(l[1],l[3],l[5],l[7],l[2],l[4],l[6],l[8]);else{if((l=this.regexp.face_vertex.exec(o))===null)throw new Error("Unexpected face line: '"+o+"'");r.addFace(l[1],l[2],l[3],l[4])}}else if(s==="l"){var u=o.substring(1).trim().split(" "),d=[],h=[];if(o.indexOf("/")===-1)d=u;else for(var m=0,f=u.length;m<f;m++){var v=u[m].split("/");v[0]!==""&&d.push(v[0]),v[1]!==""&&h.push(v[1])}r.addLineGeometry(d,h)}else if((l=this.regexp.object_pattern.exec(o))!==null){var g=l[0].substr(1).trim();r.startObject(g)}else if(!this.regexp.material_use_pattern.test(o)){if(!this.regexp.material_library_pattern.test(o)){if(this.regexp.smoothing_pattern.exec(o)===null){if(o==="\0")continue;throw new Error("Unexpected line: '"+o+"'")}}}}var b=[];for(e=0,t=r.objects.length;e<t;e++){var S=r.objects[e].geometry;if(S.vertices.length!==0){var p=new tr;p.setAttribute("position",new Wn(new Float32Array(S.vertices),3)),S.normals.length>0?p.setAttribute("normal",new Wn(new Float32Array(S.normals),3)):p.computeVertexNormals(),b.push(p)}}return b}};It.add("obj",class extends XY{get type(){return"obj"}getLoader(){return new kv}});It.add("csv",class extends eo{constructor(n,e){const t=e||{};super(n,t),this.delimiter=W(t.delimiter,","),this.comment=W(t.comment,"#"),this.columnNames=W(t.columnNames,!1),this.table={name:this.name,path:this.path,columnNames:[],data:[]}}get type(){return"csv"}get __objName(){return"table"}_parse(){const n=this.table.data,e=new RegExp("\\s*"+this.delimiter+"\\s*");let t=0;this.streamer.eachChunkOfLines(r=>{const i=r.length;for(let o=0;o<i;++o){const s=r[o].trim();if(s.startsWith(this.comment))continue;const a=s.split(e);t===0?this.table.columnNames=a:s&&n.push(a),++t}})}});It.add("json",class extends eo{constructor(n,e){const t=e||{};super(n,t),this.string=W(t.string,!1),this.json={name:this.name,path:this.path,data:{}}}get type(){return"json"}get __objName(){return"json"}get isJson(){return!0}_parse(){this.streamer.isBinary()||this.string?this.json.data=JSON.parse(this.streamer.asText()):this.json.data=this.streamer.data}});It.add("msgpack",class extends eo{constructor(n,e){super(n,e||{}),this.msgpack={name:this.name,path:this.path,data:void 0}}get type(){return"msgpack"}get __objName(){return"msgpack"}get isBinary(){return!0}_parse(){Xe&&Be.time("MsgpackParser._parse "+this.name),this.msgpack.data=tR(this.streamer.data),Xe&&Be.timeEnd("MsgpackParser._parse "+this.name)}});It.add("netcdf",class extends eo{constructor(n,e){super(n,e||{}),this.netcdf={name:this.name,path:this.path,data:void 0}}get type(){return"netcdf"}get __objName(){return"netcdf"}get isBinary(){return!0}_parse(){Xe&&Be.time("NetcdfParser._parse "+this.name),this.netcdf.data=new iR(this.streamer.data),Xe&&Be.timeEnd("NetcdfParser._parse "+this.name)}});class EC extends eo{constructor(e,t){super(e,t),this.text={name:this.name,path:this.path,data:""}}get type(){return"text"}get __objName(){return"text"}_parse(){this.text.data=this.streamer.asText()}}It.add("txt",EC),It.add("text",EC);const YY=/^['"]|['"]$/g,KY=/^<([\w-:.]+)\s*/,ZY=/^([^<]*)/,JY=/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/;function QY(n){return n=n.trim().replace(/<!--[\s\S]*?-->/g,""),{declaration:e(),root:t()};function e(){if(!i(/^<\?xml\s*/))return;const a={attributes:{}};for(;!o()&&!s("?>");){const l=r();if(!l)return a;a.attributes[l.name]=l.value}return i(/\?>\s*/),a}function t(){const a=i(KY);if(!a)return;const l={name:a[1],attributes:{},children:[]};for(;!(o()||s(">")||s("?>")||s("/>"));){const u=r();if(!u)return l;l.attributes[u.name]=u.value}if(i(/^\s*\/>\s*/))return l;let c;for(i(/\??>\s*/),l.content=function(){const u=i(ZY);return u?u[1]:""}();c=t();)l.children.push(c);return i(/^<\/[\w-:.]+>\s*/),l}function r(){const a=i(JY);var l;if(a)return{name:a[1],value:(l=a[2],l.replace(YY,""))}}function i(a){const l=n.match(a);if(l)return n=n.slice(l[0].length),l}function o(){return n.length===0}function s(a){return n.indexOf(a)===0}}class lR extends eo{constructor(e,t){const r=t||{};super(e,r),this.useDomParser=W(r.useDomParser,!1),this.xml={name:this.name,path:this.path,data:{}}}get type(){return"xml"}get __objName(){return"xml"}get isXml(){return!0}__xmlParser(e){return QY(e)}__domParser(e){return new window.DOMParser().parseFromString(e,"text/xml")}_parse(){Xe&&Be.time("XmlParser._parse "+this.name),this.useDomParser?this.streamer.data instanceof Document?this.xml.data=this.streamer.data:this.xml.data=this.__domParser(this.streamer.asText()):this.xml.data=this.__xmlParser(this.streamer.asText()),Xe&&Be.timeEnd("XmlParser._parse "+this.name)}}function Xn(n,e){const t=n.getNamedItem(e);return t!==null?t.value:""}function PC(n,e,t=!1){const r=Xn(n,"icode").trim(),i=Xn(n,"chain").trim(),o=Xn(n,"altcode");let s=Xn(n,"resnum");return r&&(s+="^"+r),i&&(s+=":"+i),e&&(s+="."+e),t&&o.trim()&&(s+="%"+o),s+="/"+(parseInt(Xn(n,"model"))-1),s}function eK(n){const e=Xn(n,"chain").trim();let t=`[${Xn(n,"rescode")}]${Xn(n,"resnum")}`;return e&&(t+=`:${e}`),t}function Q0(n,e,t){n[e]===void 0?n[e]=t:n[e]|=t}function e1(n,e){return n!==null&&n.value===e}function tK(n,e,t){let r=0;const i=e.getElementsByTagName("clash");for(let o=0,s=i.length;o<s;++o)if(n[Xn(i[o].attributes,"cid")]){r+=1;break}return e.getElementsByTagName("angle-outlier").length>0&&(r+=1),e.getElementsByTagName("bond-outlier").length>0&&(r+=1),e.getElementsByTagName("plane-outlier").length>0&&(r+=1),e1(t.getNamedItem("rota"),"OUTLIER")&&(r+=1),e1(t.getNamedItem("rama"),"OUTLIER")&&(r+=1),e1(t.getNamedItem("RNApucker"),"outlier")&&(r+=1),r}It.add("xml",lR);class nK{constructor(e,t){this.name=e,this.path=t,this.rsrzDict={},this.rsccDict={},this.rciDict={},this.clashDict={},this.clashArray=[],this.geoDict={},this.geoAtomDict={},this.atomDict={},this.clashSele="NONE"}get type(){return"validation"}fromXml(e){Xe&&Be.time("Validation.fromXml");const t=this.rsrzDict,r=this.rsccDict,i=this.rciDict,o=this.clashDict,s=this.clashArray,a=this.geoDict,l=this.geoAtomDict,c=this.atomDict,u=e.getElementsByTagName("Entry");if(u.length===1){const f=u[0].getElementsByTagName("chemical_shift_list");if(f.length===1){const v=f[0].getElementsByTagName("random_coil_index");for(let g=0,b=v.length;g<b;++g){const S=v[g].attributes;i[eK(S)]=parseFloat(Xn(S,"value"))}}}const d=e.getElementsByTagName("ModelledSubgroup"),h={},m=[];Xe&&Be.time("Validation.fromXml#clashDict");for(let f=0,v=d.length;f<v;++f){const g=d[f],b=g.attributes,S=PC(b);b.getNamedItem("rsrz")!==null&&(t[S]=parseFloat(Xn(b,"rsrz"))),b.getNamedItem("rscc")!==null&&(r[S]=parseFloat(Xn(b,"rscc")));const p=e.createAttribute("sele");p.value=S,b.setNamedItem(p);const y=g.getElementsByTagName("clash");for(let w=0,x=y.length;w<x;++w){const _=y[w].attributes,A=Xn(_,"atom");if(ny(A)!=="H"){const C=Xn(_,"cid"),T=PC(b,A,!0);if(c[T]=!0,h[C]===void 0)h[C]={sele1:T,res1:S};else{const I=h[C];I.res1!==S&&(I.sele2=T,I.res2=S,m.push(I.res1,S),o[C]=I,s.push(I))}}}}Xe&&Be.timeEnd("Validation.fromXml#clashDict");for(let f=0,v=d.length;f<v;++f){const g=d[f],b=g.attributes,S=Xn(b,"sele");if(Xn(b,"seq")!=="."){const p=tK(o,g,b);p>0&&(a[S]=p)}else{const p=g.getElementsByTagName("clash"),y=g.getElementsByTagName("mog-bond-outlier"),w=g.getElementsByTagName("mog-angle-outlier");if(y.length>0||w.length>0||p.length>0){const x={};l[S]=x;for(let _=0,A=p.length;_<A;++_){const C=p[_].attributes;o[Xn(C,"cid")]&&Q0(x,Xn(C,"atom"),1)}for(let _=0,A=y.length;_<A;++_)Xn(y[_].attributes,"atoms").split(",").forEach(function(C){Q0(x,C,2)});for(let _=0,A=w.length;_<A;++_)Xn(w[_].attributes,"atoms").split(",").forEach(function(C){Q0(x,C,4)})}}}this.clashSele=m.length?m.join(" OR "):"NONE",Xe&&Be.timeEnd("Validation.fromXml")}getClashData(e){Xe&&Be.time("Validation.getClashData");const t=e||{},r=t.structure,i=r.atomSet,o=new _t(W(t.color,"#f0027f")),s=r.getAtomProxy(),a=r.getAtomProxy(),l=new te,c=new te,u=new te,d=this.clashArray,h=d.length,m=new Float32Array(3*h),f=new Float32Array(3*h),v=un(h,o.r,o.g,o.b),g=new Float32Array(h),b=new Float32Array(h);Xe&&Be.time("Validation.getClashData#atomDict");const S=this.atomDict;r.eachAtom(function(y){const w=function(x){const _=x.inscode,A=x.chainname,C=x.atomname,T=x.altloc;let I=x.resno+"";return _&&(I+="^"+_),A&&(I+=":"+A),C&&(I+="."+C),T&&(I+="%"+T),I+="/"+x.modelIndex,I}(y);S[w]===!0&&(S[w]=y.index)}),Xe&&Be.timeEnd("Validation.getClashData#atomDict");let p=0;return d.forEach(function(y,w){if(s.index=S[y.sele1],a.index=S[y.sele2],s.index===void 0||a.index===void 0||!i.isSet(s.index,a.index))return;l.subVectors(a,s).setLength(s.vdw),c.copy(s).add(l),l.subVectors(s,a).setLength(a.vdw),u.copy(a).add(l);const x=s.distanceTo(a)/2,_=Math.sqrt(s.vdw*s.vdw-x*x),A=Math.sqrt(a.vdw*a.vdw-x*x);c.toArray(m,3*p),u.toArray(f,3*p),g[p]=(_+A)/2,b[p]=w,++p}),Xe&&Be.timeEnd("Validation.getClashData"),{position1:m.subarray(0,3*p),position2:f.subarray(0,3*p),color:v.subarray(0,3*p),color2:v.subarray(0,3*p),radius:g.subarray(0,p),picking:new EW(b.subarray(0,p),this,r)}}}function cR(n,e){return n.length===e?n:n.subarray?n.subarray(0,e):(n.length=e,n)}function vc(n,e,t,r,i){if(e.subarray&&n.subarray)n.set(e.subarray(t,t+r),i);else for(var o=0;o<r;o++)n[i+o]=e[t+o]}function Bv(n,e,t,r){for(var i=65535&n,o=n>>>16&65535,s=0;t!==0;){t-=s=t>2e3?2e3:t;do o=o+(i=i+e[r++]|0)|0;while(--s);i%=65521,o%=65521}return i|o<<16}It.add("validation",class extends lR{constructor(n,e){super(n,e||{}),this.useDomParser=!0,this.validation=new nK(this.name,this.path)}get __objName(){return"validation"}get isXml(){return!0}_parse(){super._parse(),Xe&&Be.time("ValidationParser._parse "+this.name),this.validation.fromXml(this.xml.data),Xe&&Be.timeEnd("ValidationParser._parse "+this.name)}});var rK=function(){for(var n,e=[],t=0;t<256;t++){n=t;for(var r=0;r<8;r++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}();function co(n,e,t,r){var i=rK,o=r+t;n^=-1;for(var s=r;s<o;s++)n=n>>>8^i[255&(n^e[s])];return~n}var vf=30,iK=12;function oK(n,e){var t,r,i,o,s,a,l,c,u,d,h,m,f,v,g,b,S,p,y,w,x,_,A,C,T;t=n.state,r=n.next_in,C=n.input,i=r+(n.avail_in-5),o=n.next_out,T=n.output,s=o-(e-n.avail_out),a=o+(n.avail_out-257),l=t.dmax,c=t.wsize,u=t.whave,d=t.wnext,h=t.window,m=t.hold,f=t.bits,v=t.lencode,g=t.distcode,b=(1<<t.lenbits)-1,S=(1<<t.distbits)-1;e:do{f<15&&(m+=C[r++]<<f,f+=8,m+=C[r++]<<f,f+=8),p=v[m&b];t:for(;;){if(m>>>=y=p>>>24,f-=y,(y=p>>>16&255)===0)T[o++]=65535&p;else{if(!(16&y)){if(64&y){if(32&y){t.mode=iK;break e}n.msg="invalid literal/length code",t.mode=vf;break e}p=v[(65535&p)+(m&(1<<y)-1)];continue t}for(w=65535&p,(y&=15)&&(f<y&&(m+=C[r++]<<f,f+=8),w+=m&(1<<y)-1,m>>>=y,f-=y),f<15&&(m+=C[r++]<<f,f+=8,m+=C[r++]<<f,f+=8),p=g[m&S];;){if(m>>>=y=p>>>24,f-=y,16&(y=p>>>16&255)){if(x=65535&p,f<(y&=15)&&(m+=C[r++]<<f,(f+=8)<y&&(m+=C[r++]<<f,f+=8)),(x+=m&(1<<y)-1)>l){n.msg="invalid distance too far back",t.mode=vf;break e}if(m>>>=y,f-=y,x>(y=o-s)){if((y=x-y)>u&&t.sane){n.msg="invalid distance too far back",t.mode=vf;break e}if(_=0,A=h,d===0){if(_+=c-y,y<w){w-=y;do T[o++]=h[_++];while(--y);_=o-x,A=T}}else if(d<y){if(_+=c+d-y,(y-=d)<w){w-=y;do T[o++]=h[_++];while(--y);if(_=0,d<w){w-=y=d;do T[o++]=h[_++];while(--y);_=o-x,A=T}}}else if(_+=d-y,y<w){w-=y;do T[o++]=h[_++];while(--y);_=o-x,A=T}for(;w>2;)T[o++]=A[_++],T[o++]=A[_++],T[o++]=A[_++],w-=3;w&&(T[o++]=A[_++],w>1&&(T[o++]=A[_++]))}else{_=o-x;do T[o++]=T[_++],T[o++]=T[_++],T[o++]=T[_++],w-=3;while(w>2);w&&(T[o++]=T[_++],w>1&&(T[o++]=T[_++]))}break}if(64&y){n.msg="invalid distance code",t.mode=vf;break e}p=g[(65535&p)+(m&(1<<y)-1)]}}break}}while(r<i&&o<a);r-=w=f>>3,m&=(1<<(f-=w<<3))-1,n.next_in=r,n.next_out=o,n.avail_in=r<i?i-r+5:5-(r-i),n.avail_out=o<a?a-o+257:257-(o-a),t.hold=m,t.bits=f}var ql=15,RC=852,IC=592,DC=0,t1=1,LC=2,sK=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],aK=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],lK=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],cK=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function Qu(n,e,t,r,i,o,s,a){var l,c,u,d,h,m,f,v,g,b=a.bits,S=0,p=0,y=0,w=0,x=0,_=0,A=0,C=0,T=0,I=0,M=null,P=0,E=new Uint16Array(ql+1),R=new Uint16Array(ql+1),B=null,L=0;for(S=0;S<=ql;S++)E[S]=0;for(p=0;p<r;p++)E[e[t+p]]++;for(x=b,w=ql;w>=1&&E[w]===0;w--);if(x>w&&(x=w),w===0)return i[o++]=20971520,i[o++]=20971520,a.bits=1,0;for(y=1;y<w&&E[y]===0;y++);for(x<y&&(x=y),C=1,S=1;S<=ql;S++)if(C<<=1,(C-=E[S])<0)return-1;if(C>0&&(n===DC||w!==1))return-1;for(R[1]=0,S=1;S<ql;S++)R[S+1]=R[S]+E[S];for(p=0;p<r;p++)e[t+p]!==0&&(s[R[e[t+p]]++]=p);if(n===DC?(M=B=s,m=19):n===t1?(M=sK,P-=257,B=aK,L-=257,m=256):(M=lK,B=cK,m=-1),I=0,p=0,S=y,h=o,_=x,A=0,u=-1,d=(T=1<<x)-1,n===t1&&T>RC||n===LC&&T>IC)return 1;for(;;){f=S-A,s[p]<m?(v=0,g=s[p]):s[p]>m?(v=B[L+s[p]],g=M[P+s[p]]):(v=96,g=0),l=1<<S-A,y=c=1<<_;do i[h+(I>>A)+(c-=l)]=f<<24|v<<16|g;while(c!==0);for(l=1<<S-1;I&l;)l>>=1;if(l!==0?(I&=l-1,I+=l):I=0,p++,--E[S]==0){if(S===w)break;S=e[t+s[p]]}if(S>x&&(I&d)!==u){for(A===0&&(A=x),h+=y,C=1<<(_=S-A);_+A<w&&!((C-=E[_+A])<=0);)_++,C<<=1;if(T+=1<<_,n===t1&&T>RC||n===LC&&T>IC)return 1;i[u=I&d]=x<<24|_<<16|h-o}}return I!==0&&(i[h+I]=S-A<<24|64<<16),a.bits=x,0}var uR=1,dR=2,Rc=0,Ao=-2,hR=1,Ho=12,Rn=30,uK=852,dK=592;function FC(n){return(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24)}function hK(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function fK(n){var e;return n&&n.state?((e=n.state).wsize=0,e.whave=0,e.wnext=0,function(t){var r;return t&&t.state?(r=t.state,t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=hR,r.last=0,r.havedict=0,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(uK),r.distcode=r.distdyn=new Int32Array(dK),r.sane=1,r.back=-1,Rc):Ao}(n)):Ao}function pK(n,e){var t,r;return n?(r=new hK,n.state=r,r.window=null,t=function(i,o){var s,a;return i&&i.state?(a=i.state,o<0?(s=0,o=-o):(s=1+(o>>4),o<48&&(o&=15)),o&&(o<8||o>15)?Ao:(a.window!==null&&a.wbits!==o&&(a.window=null),a.wrap=s,a.wbits=o,fK(i))):Ao}(n,e),t!==Rc&&(n.state=null),t):Ao}var n1,r1,OC=!0;function mK(n){if(OC){var e;for(n1=new Int32Array(512),r1=new Int32Array(32),e=0;e<144;)n.lens[e++]=8;for(;e<256;)n.lens[e++]=9;for(;e<280;)n.lens[e++]=7;for(;e<288;)n.lens[e++]=8;for(Qu(uR,n.lens,0,288,n1,0,n.work,{bits:9}),e=0;e<32;)n.lens[e++]=5;Qu(dR,n.lens,0,32,r1,0,n.work,{bits:5}),OC=!1}n.lencode=n1,n.lenbits=9,n.distcode=r1,n.distbits=5}function fR(n,e,t,r){var i,o=n.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(vc(o.window,e,t-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>r&&(i=r),vc(o.window,e,t-r,i,o.wnext),(r-=i)?(vc(o.window,e,t-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}function gK(n,e){var t,r,i,o,s,a,l,c,u,d,h,m,f,v,g,b,S,p,y,w,x,_,A,C,T=0,I=new Uint8Array(4),M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!n||!n.state||!n.output||!n.input&&n.avail_in!==0)return Ao;(t=n.state).mode===Ho&&(t.mode=13),s=n.next_out,i=n.output,l=n.avail_out,o=n.next_in,r=n.input,a=n.avail_in,c=t.hold,u=t.bits,d=a,h=l,_=Rc;e:for(;;)switch(t.mode){case hR:if(t.wrap===0){t.mode=13;break}for(;u<16;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}if(2&t.wrap&&c===35615){t.check=0,I[0]=255&c,I[1]=c>>>8&255,t.check=co(t.check,I,2,0),c=0,u=0,t.mode=2;break}if(t.flags=0,t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&c)<<8)+(c>>8))%31){n.msg="incorrect header check",t.mode=Rn;break}if((15&c)!=8){n.msg="unknown compression method",t.mode=Rn;break}if(u-=4,x=8+(15&(c>>>=4)),t.wbits===0)t.wbits=x;else if(x>t.wbits){n.msg="invalid window size",t.mode=Rn;break}t.dmax=1<<x,n.adler=t.check=1,t.mode=512&c?10:Ho,c=0,u=0;break;case 2:for(;u<16;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}if(t.flags=c,(255&t.flags)!=8){n.msg="unknown compression method",t.mode=Rn;break}if(57344&t.flags){n.msg="unknown header flags set",t.mode=Rn;break}t.head&&(t.head.text=c>>8&1),512&t.flags&&(I[0]=255&c,I[1]=c>>>8&255,t.check=co(t.check,I,2,0)),c=0,u=0,t.mode=3;case 3:for(;u<32;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}t.head&&(t.head.time=c),512&t.flags&&(I[0]=255&c,I[1]=c>>>8&255,I[2]=c>>>16&255,I[3]=c>>>24&255,t.check=co(t.check,I,4,0)),c=0,u=0,t.mode=4;case 4:for(;u<16;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}t.head&&(t.head.xflags=255&c,t.head.os=c>>8),512&t.flags&&(I[0]=255&c,I[1]=c>>>8&255,t.check=co(t.check,I,2,0)),c=0,u=0,t.mode=5;case 5:if(1024&t.flags){for(;u<16;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}t.length=c,t.head&&(t.head.extra_len=c),512&t.flags&&(I[0]=255&c,I[1]=c>>>8&255,t.check=co(t.check,I,2,0)),c=0,u=0}else t.head&&(t.head.extra=null);t.mode=6;case 6:if(1024&t.flags&&((m=t.length)>a&&(m=a),m&&(t.head&&(x=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Array(t.head.extra_len)),vc(t.head.extra,r,o,m,x)),512&t.flags&&(t.check=co(t.check,r,m,o)),a-=m,o+=m,t.length-=m),t.length))break e;t.length=0,t.mode=7;case 7:if(2048&t.flags){if(a===0)break e;m=0;do x=r[o+m++],t.head&&x&&t.length<65536&&(t.head.name+=String.fromCharCode(x));while(x&&m<a);if(512&t.flags&&(t.check=co(t.check,r,m,o)),a-=m,o+=m,x)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=8;case 8:if(4096&t.flags){if(a===0)break e;m=0;do x=r[o+m++],t.head&&x&&t.length<65536&&(t.head.comment+=String.fromCharCode(x));while(x&&m<a);if(512&t.flags&&(t.check=co(t.check,r,m,o)),a-=m,o+=m,x)break e}else t.head&&(t.head.comment=null);t.mode=9;case 9:if(512&t.flags){for(;u<16;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}if(c!==(65535&t.check)){n.msg="header crc mismatch",t.mode=Rn;break}c=0,u=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),n.adler=t.check=0,t.mode=Ho;break;case 10:for(;u<32;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}n.adler=t.check=FC(c),c=0,u=0,t.mode=11;case 11:if(t.havedict===0)return n.next_out=s,n.avail_out=l,n.next_in=o,n.avail_in=a,t.hold=c,t.bits=u,2;n.adler=t.check=1,t.mode=Ho;case Ho:case 13:if(t.last){c>>>=7&u,u-=7&u,t.mode=27;break}for(;u<3;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}switch(t.last=1&c,u-=1,3&(c>>>=1)){case 0:t.mode=14;break;case 1:mK(t),t.mode=20;break;case 2:t.mode=17;break;case 3:n.msg="invalid block type",t.mode=Rn}c>>>=2,u-=2;break;case 14:for(c>>>=7&u,u-=7&u;u<32;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){n.msg="invalid stored block lengths",t.mode=Rn;break}t.length=65535&c,c=0,u=0,t.mode=15;case 15:t.mode=16;case 16:if(m=t.length){if(m>a&&(m=a),m>l&&(m=l),m===0)break e;vc(i,r,o,m,s),a-=m,o+=m,l-=m,s+=m,t.length-=m;break}t.mode=Ho;break;case 17:for(;u<14;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}if(t.nlen=257+(31&c),c>>>=5,u-=5,t.ndist=1+(31&c),c>>>=5,u-=5,t.ncode=4+(15&c),c>>>=4,u-=4,t.nlen>286||t.ndist>30){n.msg="too many length or distance symbols",t.mode=Rn;break}t.have=0,t.mode=18;case 18:for(;t.have<t.ncode;){for(;u<3;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}t.lens[M[t.have++]]=7&c,c>>>=3,u-=3}for(;t.have<19;)t.lens[M[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,A={bits:t.lenbits},_=Qu(0,t.lens,0,19,t.lencode,0,t.work,A),t.lenbits=A.bits,_){n.msg="invalid code lengths set",t.mode=Rn;break}t.have=0,t.mode=19;case 19:for(;t.have<t.nlen+t.ndist;){for(;b=(T=t.lencode[c&(1<<t.lenbits)-1])>>>16&255,S=65535&T,!((g=T>>>24)<=u);){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}if(S<16)c>>>=g,u-=g,t.lens[t.have++]=S;else{if(S===16){for(C=g+2;u<C;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}if(c>>>=g,u-=g,t.have===0){n.msg="invalid bit length repeat",t.mode=Rn;break}x=t.lens[t.have-1],m=3+(3&c),c>>>=2,u-=2}else if(S===17){for(C=g+3;u<C;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}u-=g,x=0,m=3+(7&(c>>>=g)),c>>>=3,u-=3}else{for(C=g+7;u<C;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}u-=g,x=0,m=11+(127&(c>>>=g)),c>>>=7,u-=7}if(t.have+m>t.nlen+t.ndist){n.msg="invalid bit length repeat",t.mode=Rn;break}for(;m--;)t.lens[t.have++]=x}}if(t.mode===Rn)break;if(t.lens[256]===0){n.msg="invalid code -- missing end-of-block",t.mode=Rn;break}if(t.lenbits=9,A={bits:t.lenbits},_=Qu(uR,t.lens,0,t.nlen,t.lencode,0,t.work,A),t.lenbits=A.bits,_){n.msg="invalid literal/lengths set",t.mode=Rn;break}if(t.distbits=6,t.distcode=t.distdyn,A={bits:t.distbits},_=Qu(dR,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,A),t.distbits=A.bits,_){n.msg="invalid distances set",t.mode=Rn;break}t.mode=20;case 20:t.mode=21;case 21:if(a>=6&&l>=258){n.next_out=s,n.avail_out=l,n.next_in=o,n.avail_in=a,t.hold=c,t.bits=u,oK(n,h),s=n.next_out,i=n.output,l=n.avail_out,o=n.next_in,r=n.input,a=n.avail_in,c=t.hold,u=t.bits,t.mode===Ho&&(t.back=-1);break}for(t.back=0;b=(T=t.lencode[c&(1<<t.lenbits)-1])>>>16&255,S=65535&T,!((g=T>>>24)<=u);){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}if(b&&!(240&b)){for(p=g,y=b,w=S;b=(T=t.lencode[w+((c&(1<<p+y)-1)>>p)])>>>16&255,S=65535&T,!(p+(g=T>>>24)<=u);){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}c>>>=p,u-=p,t.back+=p}if(c>>>=g,u-=g,t.back+=g,t.length=S,b===0){t.mode=26;break}if(32&b){t.back=-1,t.mode=Ho;break}if(64&b){n.msg="invalid literal/length code",t.mode=Rn;break}t.extra=15&b,t.mode=22;case 22:if(t.extra){for(C=t.extra;u<C;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}t.length+=c&(1<<t.extra)-1,c>>>=t.extra,u-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=23;case 23:for(;b=(T=t.distcode[c&(1<<t.distbits)-1])>>>16&255,S=65535&T,!((g=T>>>24)<=u);){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}if(!(240&b)){for(p=g,y=b,w=S;b=(T=t.distcode[w+((c&(1<<p+y)-1)>>p)])>>>16&255,S=65535&T,!(p+(g=T>>>24)<=u);){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}c>>>=p,u-=p,t.back+=p}if(c>>>=g,u-=g,t.back+=g,64&b){n.msg="invalid distance code",t.mode=Rn;break}t.offset=S,t.extra=15&b,t.mode=24;case 24:if(t.extra){for(C=t.extra;u<C;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}t.offset+=c&(1<<t.extra)-1,c>>>=t.extra,u-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){n.msg="invalid distance too far back",t.mode=Rn;break}t.mode=25;case 25:if(l===0)break e;if(m=h-l,t.offset>m){if((m=t.offset-m)>t.whave&&t.sane){n.msg="invalid distance too far back",t.mode=Rn;break}m>t.wnext?(m-=t.wnext,f=t.wsize-m):f=t.wnext-m,m>t.length&&(m=t.length),v=t.window}else v=i,f=s-t.offset,m=t.length;m>l&&(m=l),l-=m,t.length-=m;do i[s++]=v[f++];while(--m);t.length===0&&(t.mode=21);break;case 26:if(l===0)break e;i[s++]=t.length,l--,t.mode=21;break;case 27:if(t.wrap){for(;u<32;){if(a===0)break e;a--,c|=r[o++]<<u,u+=8}if(h-=l,n.total_out+=h,t.total+=h,h&&(n.adler=t.check=t.flags?co(t.check,i,h,s-h):Bv(t.check,i,h,s-h)),h=l,(t.flags?c:FC(c))!==t.check){n.msg="incorrect data check",t.mode=Rn;break}c=0,u=0}t.mode=28;case 28:if(t.wrap&&t.flags){for(;u<32;){if(a===0)break e;a--,c+=r[o++]<<u,u+=8}if(c!==(4294967295&t.total)){n.msg="incorrect length check",t.mode=Rn;break}c=0,u=0}t.mode=29;case 29:_=1;break e;case Rn:_=-3;break e;case 31:return-4;default:return Ao}return n.next_out=s,n.avail_out=l,n.next_in=o,n.avail_in=a,t.hold=c,t.bits=u,(t.wsize||h!==n.avail_out&&t.mode<Rn&&(t.mode<27||e!==4))&&fR(n,n.output,n.next_out,h-n.avail_out),d-=n.avail_in,h-=n.avail_out,n.total_in+=d,n.total_out+=h,t.total+=h,t.wrap&&h&&(n.adler=t.check=t.flags?co(t.check,i,h,n.next_out-h):Bv(t.check,i,h,n.next_out-h)),n.data_type=t.bits+(t.last?64:0)+(t.mode===Ho?128:0)+(t.mode===20||t.mode===15?256:0),(d===0&&h===0||e===4)&&_===Rc&&(_=-5),_}function vK(n,e){var t,r=e.length;return n&&n.state?(t=n.state).wrap!==0&&t.mode!==11?Ao:t.mode===11&&Bv(1,e,r,0)!==t.check?-3:fR(n,e,r,r)?(t.mode=31,-4):(t.havedict=1,Rc):Ao}var pR=!0,mR=!0;try{String.fromCharCode.apply(null,[0])}catch{pR=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{mR=!1}for(var Ad=new Uint8Array(256),As=0;As<256;As++)Ad[As]=As>=252?6:As>=248?5:As>=240?4:As>=224?3:As>=192?2:1;function bK(n){var e,t,r,i,o,s=n.length,a=0;for(i=0;i<s;i++)(64512&(t=n.charCodeAt(i)))==55296&&i+1<s&&(64512&(r=n.charCodeAt(i+1)))==56320&&(t=65536+(t-55296<<10)+(r-56320),i++),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),o=0,i=0;o<a;i++)(64512&(t=n.charCodeAt(i)))==55296&&i+1<s&&(64512&(r=n.charCodeAt(i+1)))==56320&&(t=65536+(t-55296<<10)+(r-56320),i++),t<128?e[o++]=t:t<2048?(e[o++]=192|t>>>6,e[o++]=128|63&t):t<65536?(e[o++]=224|t>>>12,e[o++]=128|t>>>6&63,e[o++]=128|63&t):(e[o++]=240|t>>>18,e[o++]=128|t>>>12&63,e[o++]=128|t>>>6&63,e[o++]=128|63&t);return e}function yK(n,e){var t,r,i,o,s=e||n.length,a=new Array(2*s);for(r=0,t=0;t<s;)if((i=n[t++])<128)a[r++]=i;else if((o=Ad[i])>4)a[r++]=65533,t+=o-1;else{for(i&=o===2?31:o===3?15:7;o>1&&t<s;)i=i<<6|63&n[t++],o--;o>1?a[r++]=65533:i<65536?a[r++]=i:(i-=65536,a[r++]=55296|i>>10&1023,a[r++]=56320|1023&i)}return function(l,c){if(c<65537&&(l.subarray&&mR||!l.subarray&&pR))return String.fromCharCode.apply(null,cR(l,c));for(var u="",d=0;d<c;d++)u+=String.fromCharCode(l[d]);return u}(a,r)}function _K(n,e){var t;for((e=e||n.length)>n.length&&(e=n.length),t=e-1;t>=0&&(192&n[t])==128;)t--;return t<0||t===0?e:t+Ad[n[t]]>e?t:e}Ad[254]=Ad[254]=1;var Zl=0,xK={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function wK(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function SK(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var kC=Object.prototype.toString;function ic(n){if(!(this instanceof ic))return new ic(n);this.options=function(s){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var l=a.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var c in l)l.hasOwnProperty(c)&&(s[c]=l[c])}}return s}({chunkSize:16384,windowBits:0,to:""},n||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||n&&n.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new wK,this.strm.avail_out=0;var t,r,i,o=pK(this.strm,e.windowBits);if(o!==Zl)throw new Error(xK[o]);this.header=new SK,t=this.strm,r=this.header,t&&t.state&&2&(i=t.state).wrap&&(i.head=r,r.done=!1)}ic.prototype.push=function(n,e){var t,r,i,o,s,a,l=this.strm,c=this.options.chunkSize,u=this.options.dictionary,d=!1;if(this.ended)return!1;r=e===~~e?e:e===!0?4:0,typeof n=="string"?l.input=function(h){for(var m=new Uint8Array(h.length),f=0,v=m.length;f<v;f++)m[f]=h.charCodeAt(f);return m}(n):kC.call(n)==="[object ArrayBuffer]"?l.input=new Uint8Array(n):l.input=n,l.next_in=0,l.avail_in=l.input.length;do{if(l.avail_out===0&&(l.output=new Uint8Array(c),l.next_out=0,l.avail_out=c),(t=gK(l,0))===2&&u&&(a=typeof u=="string"?bK(u):kC.call(u)==="[object ArrayBuffer]"?new Uint8Array(u):u,t=vK(this.strm,a)),t===-5&&d===!0&&(t=Zl,d=!1),t!==1&&t!==Zl)return this.onEnd(t),this.ended=!0,!1;l.next_out&&(l.avail_out!==0&&t!==1&&(l.avail_in!==0||r!==4&&r!==2)||(this.options.to==="string"?(i=_K(l.output,l.next_out),o=l.next_out-i,s=yK(l.output,i),l.next_out=o,l.avail_out=c-o,o&&vc(l.output,l.output,i,o,0),this.onData(s)):this.onData(cR(l.output,l.next_out)))),l.avail_in===0&&l.avail_out===0&&(d=!0)}while((l.avail_in>0||l.avail_out===0)&&t!==1);return t===1&&(r=4),r===4?(t=function(h){if(!h||!h.state)return Ao;var m=h.state;return m.window&&(m.window=null),h.state=null,Rc}(this.strm),this.onEnd(t),this.ended=!0,t===Zl):r!==2||(this.onEnd(Zl),l.avail_out=0,!0)},ic.prototype.onData=function(n){this.chunks.push(n)},ic.prototype.onEnd=function(n){n===Zl&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=function(e){var t,r,i,o,s,a;for(i=0,t=0,r=e.length;t<r;t++)i+=e[t].length;for(a=new Uint8Array(i),o=0,t=0,r=e.length;t<r;t++)s=e[t],a.set(s,o),o+=s.length;return a}(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg},Kb.add("gz",function(n){let e;n instanceof ArrayBuffer&&(n=new Uint8Array(n));try{e=function(t,r){var i=new ic(r);if(i.push(t,!0),i.err)throw i.msg;return i.result}(n)}catch{e=n}return e});class qd{}const BC="https:";Us.add("rcsb",new class extends qd{getUrl(n){const e=Kr(n),t=e.name.indexOf("_")>-1?e.name:e.name.substring(0,4);return!["pdb","cif"].includes(e.ext)||e.compressed!==!1&&e.compressed!=="gz"?(e.ext==="mmtf"&&(Be.warn(`MMTF files distribution has been discontinued by RCSB PDB as of July 2024.
 Defaulting to bcif format instead. See https://www.rcsb.org/news/65a1af31c76ca3abcc925d0c for the deprecation notice`),e.base.endsWith(".bb")&&Be.warn("Backbone only files are not available from RCSB PDB anymore."),e.ext=""),e.ext?Be.warn("unsupported ext",e.ext):Be.warn(`mmCif files available from RCSB PDB lack connectivity information.
 Consider using PDBe as the data provider for using "Updated mmCif files" that contain residues connectivity records.`),BC+"//models.rcsb.org/"+t+".bcif.gz"):BC+"//files.rcsb.org/download/"+e.path}getExt(n){return Kr(n).ext||"bcif"}});const _u="//www.ebi.ac.uk/pdbe/entry-files/download/";Us.add("pdbe",new class extends qd{getUrl(n){const e=Kr(n);let t,r=e.name.indexOf("_")>-1?e.name:e.name.substring(0,4);switch(e.ext){case"cif":t=_u+r+"_updated.cif";break;case"pdb":case"ent":r.startsWith("pdb")||(r="pdb"+r),t=_u+r+".ent";break;case"bcif":t=_u+e.path;break;case"":t=_u+r+".bcif";break;default:Be.warn("unsupported ext",e.ext),t=_u+r+".bcif"}return"https://"+t}getExt(n){return Kr(n).ext||"bcif"}});const NC="//pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/",zC="/SDF?record_type=3d";Us.add("pubchem",new class extends qd{getUrl(n){const e=Kr(n),t=e.name;let r;return e.ext&&e.ext!=="sdf"&&Be.warn("unsupported ext",e.ext),r=NC+t+zC,function(){const i=window.location.protocol;return i.match(/http(s)?:/gi)===null?"http:":i}()+r}getExt(n){return Kr(n).ext||"sdf"}});class i1 extends qd{getUrl(e){return e}getExt(e){return Kr(e).ext}}Us.add("ftp",new i1),Us.add("http",new i1),Us.add("https",new i1);const UC="//alphafold.ebi.ac.uk/files/AF-",$C="-F1-model_v4.pdb";Us.add("alphafold",new class extends qd{getUrl(n){const e=Kr(n),t=e.name;let r;return e.ext&&e.ext!=="pdb"&&Be.warn("unsupported AF ext",e.ext),r=UC+t+$C,"https://"+r}getExt(n){return Kr(n).ext||"pdb"}});function HC(n,e){return{type:"integer",max:n,min:e}}function Xl(n,e,t){return{type:"number",precision:n,max:e,min:t}}function Yl(n,e,t){return{type:"range",step:n,max:e,min:t}}function xu(...n){return{type:"select",options:n.reduce((e,t)=>Object.assign(Object.assign({},e),{[t]:t}),{})}}xu("auto","low","medium","high"),Yl(1,5,-1),Xl(1,10,0),Xl(1,10,0),Xl(1,10,0),Yl(1,100,0),Yl(1,100,0),HC(200,0),xu("scene","camera"),xu("relative","absolute"),Yl(1,100,0),Yl(1,100,0),xu("perspective","orthographic","stereo"),Xl(3,1,.01),Yl(1,120,15),Xl(2,10,0),Xl(2,10,0),HC(1e4,-1),xu(...Object.keys(gP));const CK={__name:"ngl",props:{datasetUrl:String,settings:Object},setup(n){const e=n,t=Je(null),r=Je("");let i=null;function o(){t.value.innerHTML="",i=new aq(t.value,{backgroundColor:e.settings.backcolor});const s={radius:e.settings.radius,assembly:e.settings.assembly,color:e.settings.colorscheme,opacity:e.settings.opacity},a={ext:"pdb",defaultRepresentation:!0};try{i.loadFile(e.datasetUrl,a).then(function(c){c.addRepresentation(e.settings.mode,s)})}catch(c){r.value=`Failed to render visualization: ${String(c)}`}i.setQuality(e.settings.quality),String(e.settings.spin).toLowerCase()=="true"&&i.setSpin([0,1,0],.01)}return Er(()=>{o(),window.onresize=function(){i.handleResize()}}),bn(()=>e.settings,()=>{o()},{deep:!0}),(s,a)=>r.value?(Mn(),js(hr(qT),{key:0,title:"Visualization Plugin Error!",type:"error",class:"m-2"},{default:bo(()=>[Ja(ac(r.value),1)]),_:1})):(Mn(),fr("div",{key:1,ref_key:"viewport",ref:t},null,512))}},AK={__name:"App",setup(n){const e={dataset_url:"test-data/1ACB.pdb",settings:{mode:"contact",radius:.62}};return(t,r)=>(Mn(),js(C8,{config:e,xml:"xml/ngl.xml"},{default:bo(({datasetUrl:i,settings:o})=>[pn(CK,{"dataset-url":i,settings:o},null,8,["dataset-url","settings"])]),_:1}))}};VI(AK).mount("#app")});export default MK();
